<!doctype html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <title>Reference Guide</title>

    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->

    <!-- No caching headers -->
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="expires" content="-1" />


    <!-- TODO: need to (re)instate CDN in the future (not using for now just so can develop off-line -->
    <link href="../css/foundation/5.5.1/foundation.css" rel="stylesheet" />
    <script src="../js/foundation/5.5.1/vendor/modernizr.js"></script>
    <link href="../css/asciidoctor/colony.css" rel="stylesheet">
    <link href="../css/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">




    <link href="../css/github-fork-ribbon-css/0.1.1/gh-fork-ribbon.css" rel="stylesheet" />
    <!--[if lt IE 9]>
      <link href="../css/github-fork-ribbon-css/0.1.1/gh-fork-ribbon.ie.css" rel="stylesheet" />
    <![endif]-->


    <style type="text/css">
        /* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{font-weight: normal}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#00}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}

        pre.CodeRay code {
            background-color: inherit;
            border-style: none;
        }

        pre.CodeRay code > span:first-child {
            margin-left: -5px;
        }

        .literalblock pre,
        .listingblock pre:not(.highlight),
        .listingblock pre[class="highlight"],
        .listingblock pre[class^="highlight "],
        .listingblock pre.CodeRay,
        .listingblock pre.prettyprint {
            background: rgb(253, 250, 246);
         }
        .sidebarblock .literalblock pre,
        .sidebarblock .listingblock pre:not(.highlight),
        .sidebarblock .listingblock pre[class="highlight"],
        .sidebarblock .listingblock pre[class^="highlight "],
        .sidebarblock .listingblock pre.CodeRay,
        .sidebarblock .listingblock pre.prettyprint {
            background: rgb(253, 250, 246);
         }

    <style>

    <style>
    .github-fork-ribbon-wrapper.right {
        position: fixed;
    }
    .github-fork-ribbon {
        background: #090;
    }
    .github-fork-ribbon a:hover {
        background:#0D0;
        color:#fff;
        font-size: 1.1em;
    }
    </style>

    <style>
        @media only screen and (min-width: 40.063em) {
          .top-bar {
            .contain-to-grid .top-bar {
                max-width: 80rem;
            }
          }
        }
        .row {
            max-width: 80rem;
        }
    </style>

    <style>
        .extended-quote,
        .extended-quote-first {
            margin-left: 40px;
            margin-right: 40px;
            font-style: italic;
        }
        .extended-quote-attribution {
            text-align: right;
            margin-right: 100px;
            color: #10B061;
        }

        .extended-quote-first:before {
            content: "\201c";
            float: left;
            font-size: 2.75em;
            font-weight: bold;
            line-height: 0.6em;
            margin-left: -0.6em;
            color: #003b6b;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
    </style>

    <style>
        body {
          position: relative;
        }

        *:not(pre) a > code {
            color: #210DDC;
        }

        *:not(pre) > code {
            background-color: inherit;
            border: none;
            font-weight: normal;
        }

        body div#toc li,
        body div#toc2 li {
            list-style-type: none;
        }

        div#doc-content {
            margin-top: 30px;
        }

        div.documentation-page table.frame-all {
            border-left: none;
            border-right: none;
        }

        body div#toc li.active-region:before,
        body div#toc2 li.active-region:before {
            content: "\00BB \0020";
            margin-left: -12px;
        }

        body div#toc li a.active,
        body div#toc2 li a.active {
            color: red;
        }

        body div#toc.toc,
        body div#toc.toc2 {
            position: fixed;
            left: auto;
            padding-top: 60px;
            z-index: auto;
            background-color: white;
            border-left-color: #eee;
            border-left-style: solid;
            border-right: none;
            min-height: 2000px;
        }

    </style>

    <style>

        @media only screen and (min-width: 768px) {
          #toc.toc2 ul ul { margin-left: -10px; }
        }


        body div#toc .tocify-subheader ul {
            margin-bottom: 0px;
        }

        body div#toc .tocify-subheader li {
            font-size: 14px;
        }
        .tocify li.tocify-item, .tocify ul.tocify-item {
            line-height: 24px;
        }

        body div#toc li.tocify-item.active:before,
        body div#toc2 li.tocify-item.active:before {
            content: "\00BB \0020";
            margin-left: -12px;
        }

        body div#toc li.tocify-item.active a,
        body div#toc2 li.tocify-item.active a {
            color: red;
        }
    </style>

    <style>
        footer {
            margin-top: 1000px;
        }
    </style>

    <style>
        /* overriding colony.css stylesheet */
        .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] {
           /*padding: 1.25em 1.5625em 1.125em 1.5625em;*/
           padding: 0.3em 0.6em 0.25em 0.6em;
        }
        @media only screen and (min-width: 1280px)
        #toc.toc2 {
          /*width: 20em;*/
          width: 25em;
        }

        #doc-content a {
          color: #210DDC;
        }

        .top-bar h1 {
            border-bottom: inherit;
        }

        h2 {
          margin-top: 80px;
        }
        h3 {
          margin-top: 40px;
        }
        h4,h5 {
          margin-top: 30px;
        }

        .admonitionblock.tip > table td.content {
            color: #10B061;
        }
        .admonitionblock.note > table td.content {
            color: #B509AB;
        }
        .admonitionblock.important > table td.content {
            color: #D5810A;
        }

        .admonitionblock .title {
            font-size: larger;
            font-style: italic;
        }

        .imageblock img {
            margin-bottom: 10px;
        }
    </style>

    <style>
        /* from http://ben.balter.com/2014/03/13/pages-anchor-links/ */
        .header-link {
          position: absolute;
          left: -0.5em;
          opacity: 0;

          /*
          -webkit-transition: opacity 0.2s ease-in-out 0.1s;
          -moz-transition: opacity 0.2s ease-in-out 0.1s;
          -ms-transition: opacity 0.2s ease-in-out 0.1s;
          */
        }

        h2:hover .header-link,
        h3:hover .header-link,
        h4:hover .header-link,
        h5:hover .header-link,
        h6:hover .header-link {
          opacity: 1;
        }
    </style>

    <style>
        .top-bar
        {
            -webkit-transition-duration: .5s;
            transition-duration: .5s;

            -webkit-transition-timing-function: cubic-bezier( 0.215, 0.610, 0.355, 1.000 );
            transition-timing-function: cubic-bezier( 0.215, 0.610, 0.355, 1.000 );

            -webkit-transition-property: -webkit-transform;
            transition-property: transform;
        }

        /*
        http://osvaldas.info/auto-hide-sticky-header
        MIT license
        */
        .header--hidden
        {
            -webkit-transform: translateY( -100% );
            -ms-transform: translateY( -100% );
            transform: translateY( -100% );

            transition-duration: .5s;
            transition-timing-function: cubic-bezier( 0.215, 0.610, 0.355, 1.000 );
            -webkit-transition-property: -webkit-transform;
            transition-property: transform;
        }
    </style>

    <style>
        #doc-content a.guide {
            color: white;
        }
    </style>

    <style>
        .tocify {
            margin-top: 80px;
        }
    </style>


</script>

</head>
<body>

<<div class="github-fork-ribbon-wrapper right" style="position: fixed;">
    <div class="github-fork-ribbon">
        <a href="https://github.com/apache/isis/fork">Fork me on GitHub</a>
    </div>
</div>


<div class="row">

    <div class="fixed contain-to-grid header">
        <nav class="top-bar" data-topbar role="navigation" style="max-width: 80rem">
            <ul class="title-area">
                <li class="name">
                    <h1>
                        <a href="/index.html">Apache Isis&trade;</a>
                    </h1>
                </li>
                <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
                <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
            </ul>

            <section class="top-bar-section">
                <ul class="right">

                    <li class="has-form">
                       <FORM class="searchbox navbar-form navbar-right" id="searchbox_012614087480249044419:dn-q5gtwxya" action="http://www.google.com/cse">
                        <div class="row collapse">
                            <input type="hidden" name="cx" value="012614087480249044419:dn-q5gtwxya">
                            <INPUT type="hidden" name="cof" value="FORID:0">
                            <INPUT class="form-control" name="q" type="text" placeholder="Search">
                        </div>
                    </FORM>
                     </li>

                </ul>

                <!-- Left Nav Section -->
                <ul class="left">

                    <li><a href="/documentation.html">Documentation</a></li>
                    <li><a href="/downloads.html">Downloads</a></li>
                    <li><a href="/help.html">Help</a></li>
                    <li><a href="/asf.html">@ASF</a></li>

                </ul>

            </section>
        </nav>
    </div>
</div>

<div class="row">

    <div id="doc-content-left" class="large-9 medium-9 columns">


        <div id="doc-content">
          <div class="sect1">
<h2 id="_rg">1. Reference Guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This reference guide describes in detail the various elements of the Apache Isis Programming Model.  Most notably these are the <a href="#_rg_annotations">annotations</a> (such as <code>@DomainObject</code>), and the reserved and prefix <a href="#_rg_methods">methods</a> (such as <code>title()</code> and <code>validate&#8230;&#8203;()</code>); it also includes various utility and supporting <a href="#_rg_classes">classes</a>.</p>
</div>
<div class="paragraph">
<p>This guide also documents the domain services, both those that act as an <a href="#_rg_services-api">API</a> (implemented by the framework for your domain objects to call), and those domain services that act as an <a href="#_rg_services-spi">SPI</a> (implemented by your domain application and which are called by the framework).</p>
</div>
<div class="paragraph">
<p>Also part of the reference manual are the details of how to influence the <a href="#_rg_object-layout">UI layout</a> of your domain objects (this is ultimately just a type of metadata), and it catalogues all the various <a href="#_rg_runtime">configuration properties</a> available that influence the behaviour of the framework and the API domain services.</p>
</div>
<div class="paragraph">
<p>This reference guide does <em>not</em> describe how to actually build an Apache Isis application; for that see the <strong><a href="ug.html#_ug">Users' Guide</a></strong>.  The reference guide also doesn&#8217;t explain how to setup your development environment; for that see the <strong><a href="cg.html#_cg">Contributors' Guide</a></strong>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rg_annotations">2. Annotations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apache Isis uses annotations to provide additional metadata about the domain objects.</p>
</div>
<div class="paragraph">
<p>To give just a few examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if a property is read-only, then this can be annotated with <code>@Property(editing=EditingDISABLED)</code>.</p>
</li>
<li>
<p>if a class has a small fixed set of instances (eg a picklist), then it can be annotated using <code>@DomainObject(bounded=true)</code></p>
</li>
<li>
<p>if a class is a domain service and should be automatically instantiated as a singleton, then it can be annotated using <code>@DomainService</code></p>
</li>
<li>
<p>if an action is idempotent, then it can be annotated using <code>@Action(semantics=SemanticsOf.IDEMPOTENT)</code>.</p>
</li>
<li>
<p>if an action parameter is optional, it can be annotated using <code>@Parameter(optionality=Optionality.OPTIONAL)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some annotations act as UI hints, for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if a collection should be rendered "open" rather than collapsed, it can be annotated using <code>@CollectionLayout(render=RenderType.EAGERLY)</code></p>
</li>
<li>
<p>if an action has a tooltip, it can be annotated using <code>@ActionLayout(describedAs=&#8230;&#8203;)</code></p>
</li>
<li>
<p>if a domain object is bookmarkable, it can be annotated using <code>@DomainObjectLayout(bookmarking=BookmarkPolicy.AS_ROOT</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This chapter documents all the annotations currently supported by Apache Isis.  It also identifies a number of annotations that are now deprecated, and indicates their replacement.</p>
</div>
<div class="sect2">
<h3 id="_rg_annotations_aaa">2.1. Summary</h3>
<div class="paragraph">
<p>This section summarizes the various annotations supported by Apache Isis.  They break out into five categories.</p>
</div>
<div class="sect3">
<h4 id="_rg_annotations_aaa_main">2.1.1. Core annotations</h4>
<div class="paragraph">
<p>In Apache Isis every domain object is either a domain entity, a view model or a domain service.  And each of these are made up of properties, collections and actions (domain services only have actions).</p>
</div>
<div class="paragraph">
<p>For each of these domain types and members there are two annotations.  One covers the semantics intrinsic to the domain (eg whether an action parameter is optional or not), then other (suffix <code>&#8230;&#8203;Layout</code>) captures semantics relating to the UI/presentation layer.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Most UI semantics can also be specified using <a href="#_rg_object-layout_dynamic">dynamic object layout</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The table below summarizes these most commonly used annotations in Apache Isis.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Core annotations for domain objects, services and members (as of 1.8.0)</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 12%;">
<col style="width: 12%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Layer</th>
<th class="tableblock halign-left valign-top"><a href="#_rg_object-layout_dynamic">Dynamic layout</a>?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Action"><code>@Action</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Domain semantics for actions</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-ActionLayout"><code>@ActionLayout</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>User interface hints for actions</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Collection"><code>@Collection</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Domain semantics for collections</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-CollectionLayout"><code>@CollectionLayout</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>User interface hints for collections</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainObject"><code>@DomainObject</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Domain semantics for domain object (entities and optionally view models, see also <code>@ViewModel)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainObjectLayout"><code>@DomainObjectLayout</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>User interface hints for domain object (entities and optionally view models, see also <code>@ViewModelLayout)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainService"><code>@DomainService</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Class is a domain service (rather than an entity or view model)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainServiceLayout"><code>@DomainServiceLayout</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>User interface hints for domain services</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Parameter"><code>@Parameter</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Domain semantics for action parameters</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-ParameterLayout"><code>@ParameterLayout</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Layout hints for an action parameter (currently: its label position either to top or the left).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Property"><code>@Property</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Domain semantics for properties</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-PropertyLayout"><code>@PropertyLayout</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Layout hints for a property</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-ViewModel"><code>@ViewModel</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Specify that a class is a view model (as opposed to an entity or domain service); equivalent to <code>@DomainObject(nature</code>=VIEW_MODEL).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain, Persistence</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-ViewModelLayout"><code>@ViewModelLayout</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>User interface hints for view models.
For use with <code>@ViewModel</code>. If specifying view models using <code>@DomainObject(nature=VIEW_MODEL)</code> then use <code>@DomainObjectLayout</code>)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_rg_annotations_aaa_other">2.1.2. Other Isis Annotations</h4>
<div class="paragraph">
<p>These annotations are also commonly used, but relate <em>not</em> to objects or object members but instead to other aspects of the Apache Isis metamodel.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Other Isis Annotations</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 12%;">
<col style="width: 12%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Layer</th>
<th class="tableblock halign-left valign-top"><a href="#_rg_object-layout_dynamic">Dynamic layout</a>?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Facets"><code>@Facets</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Install arbitrary facets within the Apache Isis metamodel.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(any)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-HomePage"><code>@HomePage</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Query-only action (on domain service) to be invoked, result of which is rendered as the user&#8217;s home page.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-MemberGroupLayout"><code>@MemberGroupLayout</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Grouping of properties into groups, and organizing of properties, collections into columns.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-MemberOrder"><code>@MemberOrder</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Ordering of properties, collections and actions, and also associating actions with either a property or a collection.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-MinLength"><code>@MinLength</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Minimum number of characters required for an auto-complete search argument.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Programmatic"><code>@Programmatic</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Ignore a public method, excluded from the Apache Isis metamodel.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_rg_annotations_aaa_jee">2.1.3. JDO Annotations</h4>
<div class="paragraph">
<p>Apache Isis uses JDO/DataNucleus as its ORM, and infers some of its own metadata from the JDO annotations.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Isis (currently) builds up metadata by parsing the JDO annotations from source, <em>not</em> by querying the JDO metamodel.  The upshot is that, for the annotations documented here at least, your domain entities must use JDO annotations rather than XML.</p>
</div>
<div class="paragraph">
<p>Furthermore, note that although JDO (the property-related) annotations to be placed on either the field or on the getter, Apache Isis requires that annotations are placed on the getter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The table below lists the JDO annotations currently recognized by Apache Isis.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. JDO Annotations</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 12%;">
<col style="width: 12%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Layer</th>
<th class="tableblock halign-left valign-top">Applies to</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Column"><code>@javax.jdo.annotations.</code><br>
<code>Column</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Used to determine whether a property is mandatory or optional.  For <code>String</code> and <code>BigDecimal</code> properties, used to determine length/precision/scale.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain / persistence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Discriminator"><code>@javax.jdo.annotations.</code><br>
<code>Discriminator</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Override for the object type, as used in `Bookmark`s, URLs for <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a> and elsewhere.<br></p>
</div>
<div class="paragraph">
<p>Note that the discriminator overrides the object type that may otherwise be inferred from the <a href="#_rg_annotations_manpage-PersistenceCapable"><code>@PersistenceCapable</code></a> annotation.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain / persistence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-NotPersistent"><code>@javax.jdo.annotations.</code><br>
<code>NotPersistent</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Used to determine whether to enforce or skip some <a href="ug.html#_ug_extending_programming-model_custom-validator">metamodel validation</a> for <code>@Column</code> versus equivalent Isis annotations.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain / persistence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-PersistenceCapable"><code>@javax.jdo.annotations.</code><br>
<code>PersistenceCapable</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Used to build Apache Isis' own internal identifier for objects.<br></p>
</div>
<div class="paragraph">
<p>If the <code>schema()</code> attribute is specified (and if <a href="#<em>rg_annotations_manpage-Discriminator"><code>@Discriminator</code></a> _hasn&#8217;t</em> been specified), is also used to derive the object type, as used in `Bookmark`s, URLs for <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a> and elsewhere.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain / persistence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-PrimaryKey"><code>@javax.jdo.annotations.</code><br>
<code>PrimaryKey</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Used to ensure Apache Isis does not overwrite application-defined primary keys, and to ensure is read-only in the UI.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain / persistence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Isis also parses the following JDO annotations, but the metadata is currently unused.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. JDO Annotations (unused within Apache Isis)</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 12%;">
<col style="width: 12%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Layer</th>
<th class="tableblock halign-left valign-top">Applies to</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@javax.jdo.annotations.</code><br>
<code>DataStoreIdentity</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Unused</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Persistence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@javax.jdo.annotations.</code><br>
<code>EmbeddedOnly</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Unused</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Persistence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@javax.jdo.annotations.</code><br>
<code>Query</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Unused</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Persistence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_rg_annotations_aaa_jee">2.1.4. Java EE Annotations</h4>
<div class="paragraph">
<p>While Apache Isis does, as of today, define a good number of its own annotations, the policy is to reuse standard Java/JEE annotations wherever they exist or are added to the Java platform.</p>
</div>
<div class="paragraph">
<p>The table below lists the JEE annotations currently recognized.  Expect to see more added in future releases of Apache Isis.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. Java EE Annotations</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 12%;">
<col style="width: 12%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Layer</th>
<th class="tableblock halign-left valign-top"><a href="#_rg_object-layout_dynamic">Dynamic layout</a>?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Digits"><code>@javax.validation.</code><br>
<code>constraints.</code><br>
<code>Digits</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Precision/scale for BigDecimal values.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Inject"><code>@javax.inject.</code><br>
<code>Inject</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Inject domain service into a domain object (entity or view model) or another domain service.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-PostConstruct"><code>@javax.annotations.</code><br>
<code>PostConstruct</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Callback for domain services (either singleton or <a href="#_rg_annotations_manpage-RequestScoped">request-scoped</a>) to initialize themselves once instantiated.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-PreDestroy"><code>@javax.annotations.</code><br>
<code>PreDestroy</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Callback for domain services (either singleton or <a href="#_rg_annotations_manpage-RequestScoped">request-scoped</a>) to clean up resources prior to destruction.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-RequestScoped"><code>@javax.enterprise.</code><br>
<code>context.</code><br>
<code>RequestScoped</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Specify that a domain service has request-scope (rather than a singleton).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_rg_annotations_aaa_deprecated">2.1.5. Deprecated Annotations</h4>
<div class="paragraph">
<p>As Apache Isis has evolved and grown, we found ourselves adding more and more annotations; but most of these related to either an object type (entity, view model, service) or an object member (property, collection, action).  Over time it became harder and harder for end programmers to discover these new features.</p>
</div>
<div class="paragraph">
<p>Accordingly, (in v1.8.0) we decided to unify the semantics into the main (core) annotations listed <a href="#_rg_annotations_aaa_main">above</a>.</p>
</div>
<div class="paragraph">
<p>The annotations listed in the table below are still supported by Apache Isis, but will be retired in Apache Isis v2.0.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 6. Deprecated Annotations</caption>
<colgroup>
<col style="width: 18%;">
<col style="width: 36%;">
<col style="width: 27%;">
<col style="width: 9%;">
<col style="width: 9%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Use instead</th>
<th class="tableblock halign-left valign-top">Layer</th>
<th class="tableblock halign-left valign-top"><a href="#_rg_object-layout_dynamic">Dynamic layout</a>?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ActionOrder</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Order of buttons and menu items representing actions.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-MemberOrder"><code>@MemberOrder</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ActionInteraction</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Enable subscribers on the Event Bus Service to either veto, validate or take further steps before/after an action has been invoked.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-Action_domainEvent"><code>@Action#domainEvent()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ActionSemantics</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Query-only, idempotent or non-idempotent.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-Action_semantics"><code>@Action#semantics()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Audited</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Audit changes to an object.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-DomainObject_auditing"><code>@DomainObject#</code><br>
<code>auditing()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@AutoComplete</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Repository method to search for entities</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-DomainObject_autoCompleteRepository"><code>@DomainObject</code><br>
<code>#autoCompleteRepository()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI/Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Bookmarkable</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Whether (and how) to create a bookmark for visited object.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-DomainObjectLayout_bookmarking"><code>@DomainObjectLayout</code><br>
<code>#bookmarking()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Bounded</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Bounded (and limited) number of instances of an entity type, translates into a drop-down for any property of that type.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-DomainObject_bounded"><code>@DomainObject#bounded()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Bulk</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Indicates an action is a bulk action, can be applied to multiple instances.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-Action_invokeOn"><code>@Action#invokeOn()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI, Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@CollectionInteraction</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Enable subscribers on the Event Bus Service to either veto, validate or take further steps before/after a collection has been added to or removed from.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-Collection_domainEvent"><code>@Collection#domainEvent()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Command</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Action invocation should be reified as a command object, optionally persistable for profiling and enhanced auditing, and background/async support.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-Action_command"><code>@Action#command()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@CssClass</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Allow visual representation of individual objects or object members layout to be customized by application-specific CSS.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>#cssClass()</code> attribute for: <a href="#_rg_annotations_manpage-DomainObjectLayout_cssClass"><code>@DomainObjectLayout</code></a>, <a href="#_rg_annotations_manpage-PropertyLayout_cssClass"><code>@PropertyLayout</code></a>,  <a href="#_rg_annotations_manpage-CollectionLayout_cssClass"><code>@CollectionLayout</code></a>, <a href="#_rg_annotations_manpage-ActionLayout_cssClass"><code>@ActionLayout</code></a> and <a href="#_rg_annotations_manpage-ParameterLayout_cssClass"><code>@ParameterLayout</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@CssClassFa</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>So that font awesome icons can be applied to action buttons/menu items and optionally as an object icon.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>cssClassFa()</code> attribute for: <a href="#_rg_annotations_manpage-ActionLayout_cssClassFa"><code>@ActionLayout</code></a>, <a href="#_rg_annotations_manpage-DomainObjectLayout_cssClassFa"><code>DomainObjectLayout</code></a> and <a href="#_rg_annotations_manpage-ViewModelLayout_cssClassFa"><code>ViewModelLayout</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Debug</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Action only invokable in debug mode.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Not supported by either the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> or the <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a>; use prototype mode instead (<a href="#_rg_annotations_manpage-Action_restrictTo"><code>@Action#restrictTo()</code></a>)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@DescribedAs</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Provide a longer description/tool-tip of an object or object member.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>#describedAs()</code> attribute for <a href="#_rg_annotations_manpage-DomainObject_describedAs"><code>@DomainObjectLayout</code></a>, <a href="#_rg_annotations_manpage-PropertyLayout_describedAs"><code>@PropertyLayout</code></a>, <a href="#_rg_annotations_manpage-CollectionLayout_describedAs"><code>@CollectionLayout</code></a>, <a href="#_rg_annotations_manpage-ActionLayout_describedAs"><code>@ActionLayout</code></a> and <a href="#_rg_annotations_manpage-ParameterLayout_describedAs"><code>@ParameterLayout</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Disabled</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Object property cannot be edited, an object collection cannot be added to/removed from, or an object action cannot be invoked.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>#editing()</code> attribute for <a href="#_rg_annotations_manpage-Property_editing"><code>@Property</code></a>,  <a href="#_rg_annotations_manpage-Collection_editing"><code>@Collection</code></a> and <a href="#_rg_annotations_manpage-DomainObject_editing"><code>@DomainObject</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI, Domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Exploration</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Action available in special 'exploration' mode.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Not supported by either the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> or the <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a>; use prototype mode instead (<a href="#_rg_annotations_manpage-Action_restrictTo"><code>@Action#restrictTo()</code></a>)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@FieldOrder</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Order of properties and collections.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-MemberOrder"><code>@MemberOrder</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Hidden</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Object member is not visible, or on domain service (to indicate that none of its actions are visible).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>For domain object members, use <code>#hidden()</code> attribute of <a href="#_rg_annotations_manpage-Action_hidden"><code>Action</code></a>, <a href="#_rg_annotations_manpage-Property_hidden"><code>Property</code></a> or <a href="#_rg_annotations_manpage-Collection_hidden"><code>Collection</code></a>. <br>
For domain service, use <a href="#_rg_annotations_manpage-DomainService_nature"><code>@DomainService(</code><br>
<code>nature=DOMAIN)</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI, Domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Idempotent</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Whether an action is idempotent (can be invoked multiple times with same post-condition).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-Action_semantics"><code>@Action#semantics</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Ignore</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Exclude this method from the metamodel.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-Programmatic"><code>@Programmatic</code></a>.<br></p>
</div>
<div class="paragraph">
<p><code>@Ignore</code> was deprecated because it can easily clash with <code>@org.junit.Ignore</code>.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Immutable</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>An object&#8217;s state cannot be changed (properties cannot be edited, collections cannot be added to or removed from). Actions can still be invoked.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-DomainObject_editing"><code>@DomainObject#editing()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Mask</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>How to parse/render values (never properly supported)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>(None)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI/domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@MaxLength</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Maximum length of a property value (strings).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>#maxLength()</code> attribute for <a href="#_rg_annotations_manpage-Property_maxLength"><code>@Property</code></a> or <a href="#_rg_annotations_manpage-Parameter_maxLength"><code>@Parameter</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@MemberGroups</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Layout of properties and collections of a domain object or view model object.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-MemberGroupLayout"><code>@MemberGroupLayout</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@MultiLine</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Render string property over multiple lines (a textarea rather than a textbox).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>#multiLine()</code> attribute for <a href="#_rg_annotations_manpage-Property_multiLine"><code>@Property</code></a> or <a href="#_rg_annotations_manpage-Parameter_multiLine"><code>@Parameter</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@MustSatisfy</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Specify arbitrary specification constraints on a property or action parameter.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>#mustSatisfy()</code> attribute for <a href="#_rg_annotations_manpage-Property_mustSatisfy"><code>@Property</code></a> or <a href="#_rg_annotations_manpage-Parameter_mustSatisfy"><code>@Parameter</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Named</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Override name inferred from class. Required for parameter names (prior to Java8).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>#named()</code> attribute for <a href="#_rg_annotations_manpage-DomainServiceLayout_named"><code>@DomainServiceLayout</code></a>, <a href="#_rg_annotations_manpage-DomainObjectLayout_named"><code>@DomainObjectLayout</code></a>, <a href="#_rg_annotations_manpage-PropertyLayout_named"><code>@PropertyLayout</code></a>, <a href="#_rg_annotations_manpage-CollectionLayout_named"><code>@CollectionLayout</code></a>, <a href="#_rg_annotations_manpage-ActionLayout_named"><code>@ActionLayout</code></a> and <a href="#_rg_annotations_manpage-ParameterLayout_named"><code>@ParameterLayout</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@NotContributed</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Indicates that a domain service action is not rendered as an action on the (entity) types of its parameters. For 1-arg query-only actions, controls whether the domain service action is rendered as a property or collection on the entity type of its parameter.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Use <a href="#_rg_annotations_manpage-DomainService_nature"><code>@DomainService#nature()</code></a> to specify whether any of the actions in a domain service should appear in the menu bars (applies at type level, not action level).
For individual actions, use <a href="#_rg_annotations_manpage-ActionLayout_contributedAs"><code>@ActionLayout#</code><br>
<code>contributedAs()</code></a> to specify whether any individual action should be contributed only as an action or as an association (property or collection).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@NotInServiceMenu</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Indicates that a domain service should not be rendered in the application menu (at top of page in Wicket viewer).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-DomainService_nature"><code>@DomainService#nature()</code></a> to signify that none of the actions in a domain service should appear in the menu bars</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@NotPersisted</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Indicates that an object property is not persisted (meaning it is excluded from view model mementos, and should not be audited).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>#notPersisted()</code> attribute of <a href="#_rg_annotations_manpage-Property_notPersisted"><code>@Property</code></a> and <a href="#_rg_annotations_manpage-Collection_notPersisted"><code>@Collection</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain, Persistence</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ObjectType</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>For constructing the external identifier (URI) of an entity instance (part of its URL in both Wicket viewer and Restful Objects viewer). Also part of the toString representation of bookmarks, if using the Bookmark Service</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-DomainObject_objectType"><code>@DomainObject#objectType()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Optional</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Specifies that a property or action parameter is not mandatory.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>#optionality()</code> attribute for <a href="#_rg_annotations_manpage-Property_optionality"><code>@Property</code></a> or  <a href="#_rg_annotations_manpage-Parameter_optionality"><code>@Parameter</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Paged</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Number of instances to display in tables representing (standalone or parented) collections.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>#paged()</code> attribute for <a href="#_rg_annotations_manpage-DomainObjectLayout_paged"><code>@DomainObjectLayout</code></a> or <a href="#_rg_annotations_manpage-CollectionLayout_paged"><code>@CollectionLayout</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Plural</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>For the irregular plural form of an entity type.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-DomainObject_plural"><code>@DomainObjectLayout</code><br>
<code>#plural()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@PostsAction</code><br>
<code>InvokedEvent</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Post a domain event to the Event Bus Service indicating that an action has been invoked.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-Action_domainEvent"><code>@Action#domainEvent()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@PostsCollection</code><br>
<code>AddedToEvent</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Post a domain event to the Event Bus Service indicating that an element has been added to a collection.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-Collection_domainEvent"><code>@Collection#domainEvent()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@PostsCollection</code><br>
<code>RemovedFromEvent</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Post a domain event to the Event Bus Service indicating that an element has been removed from a collection.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-Collection_domainEvent"><code>@Collection#domainEvent()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@PostsProperty</code><br>
<code>ChangedEvent</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Post a domain event to the Event Bus Service indicating that the value of a property has changed.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-Property_domainEvent"><code>@Property#domainEvent()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@PropertyInteraction</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Enable subscribers on the Event Bus Service to either veto, validate or take further steps before/after a property has been modified or cleared.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-Property_domainEvent"><code>@Property#domainEvent()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Prototype</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Indicates that an action should only be visible in 'prototype' mode.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-Action_restrictTo"><code>@Action#restrictTo()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@PublishedAction</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Action invocation should be serialized and published by configured PublishingService (if any), eg to other systems.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-Action_publishing"><code>@Action#publishing()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@PublishedObject</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Change to object should be serialized and published by configured PublishingService (if any), eg to other systems.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-DomainObject_publishing"><code>@DomainObject#publishing()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@QueryOnly</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Whether an action is query-only (has no side-effects).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-Action_semantics"><code>@Action#semantics()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RegEx</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Validate change to value of string property.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>#regexPattern()</code> for <a href="#_rg_annotations_manpage-Property_regexPattern"><code>@Property</code></a> or  <a href="#_rg_annotations_manpage-Property_regexPattern"><code>@Parameter</code></a>.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Render</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Eagerly (or lazily) render the contents of a collection.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-CollectionLayout_render"><code>@CollectionLayout</code><br>
<code>#render()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RenderedAsDayBefore</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Render dates as the day before; ie store [a,b) internally but render [a,b-1]) to end-user.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>#renderedAsDayBefore()</code> attribute for <a href="#_rg_annotations_manpage-PropertyLayout_renderedAsDayBefore"><code>@PropertyLayout</code></a> and <a href="#_rg_annotations_manpage-ParameterLayout_renderedAsDayBefore"><code>@ParameterLayout</code></a>.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Resolve</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Eagerly (or lazily) render the contents of a collection (same as <code>@Render)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-CollectionLayout_render"><code>@CollectionLayout</code><br>
<code>#render()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@SortedBy</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Display instances in collections in the order determined by the provided Comparator.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#_rg_annotations_manpage-CollectionLayout_sortedBy"><code>@CollectionLayout</code><br>
<code>#sortedBy()</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@TypeOf</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The type of entity stored within a collection, or as the result of invoking an action, if cannot be otherwise inferred, eg from generics.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>#typeOf()</code> attribute for <a href="#_rg_annotations_manpage-Collection_typeOf"><code>@Collection</code></a> and <a href="#_rg_annotations_manpage-Action_typeOf"><code>@Action</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@TypicalLength</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The typical length of a string property, eg to determine a sensible length for a textbox.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>#typicalLength()</code> attribute for <a href="#_rg_annotations_manpage-PropertyLayout_typicalLength"><code>@PropertyLayout</code></a> and <a href="#_rg_annotations_manpage-ParameterLayout_typicalLength"><code>@ParameterLayout</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_rg_annotations_aaa_partial">2.1.6. Incomplete/partial support</h4>
<div class="paragraph">
<p>These annotations have only incomplete/partial support, primarily relating to the management of value types.  We recommend that you do not use them for now.  Future versions of Apache Isis may either formally deprecate/retire them, or we may go the other way and properly support them.  This will depend in part on the interactions between the Apache Isis runtime, its two viewer implementations, and DataNucleus persistence.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 7. Annotations with incomplete/partial support</caption>
<colgroup>
<col style="width: 28%;">
<col style="width: 57%;">
<col style="width: 14%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Layer</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Aggregated</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Indicates that the object is aggregated, or wholly owned, by a root object.<br></p>
</div>
<div class="paragraph">
<p>This information could in theory provide useful semantics for some object store implementations, eg to store the aggregated objects "inline". <br></p>
</div>
<div class="paragraph">
<p>Currently neither the JDO ObjectStore nor any of the viewers exploit this metadata.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain, Persistence</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Defaulted</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Indicates that a (value) class has a default value.<br></p>
</div>
<div class="paragraph">
<p>The concept of "defaulted" means being able to provide a default value for the type by way of the <code>o.a.i.applib.adapters.DefaultsProvider</code> interface. Generally this only applies to value types, where the <code>@Value</code> annotation implies encodability through the <code>ValueSemanticsProvider</code> interface.<br></p>
</div>
<div class="paragraph">
<p>For these reasons the <code>@Defaulted</code> annotation is generally never applied directly, but can be thought of as a placeholder for future enhancements whereby non-value types might also have a default value provided for them.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Encodable</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Indicates that a (value) class can be serialized/encoded.<br></p>
</div>
<div class="paragraph">
<p>Encodability means the ability to convert an object to-and-from a string, by way of the <code>o.a.i.applib.adapters.EncoderDecoder</code> interface. Generally this only applies to value types, where the <code>@Value</code> annotation implies encodability through the <code>ValueSemanticsProvider</code> interface.</p>
</div>
<div class="paragraph">
<p>For these reasons the <code>@Encodable</code> annotation is generally never applied directly, but can be thought of as a placeholder for future enhancements whereby non-value types might also be directly encoded.</p>
</div>
<div class="paragraph">
<p>Currently neither the Wicket viewer nor the RO viewer use this API.  The Wicket viewer uses Wicket APIs, while RO viewer has its own mechanisms (parsing data from input JSON representations, etc.)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Persistence</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@NotPersistable</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Indicates that a domain object may not be programmatically persisted.<br></p>
</div>
<div class="paragraph">
<p>+
This annotation  indicates that transient instances of this class may be created but may not be persisted. The framework will not provide the user with an option to 'save' the object, and attempting to persist such an object programmatically would be an error.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NotPersistable</span>(By.USER)
<span class="directive">public</span> <span class="type">class</span> <span class="class">InputForm</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default the annotated object is effectively transient (ie default to <code>By.USER_OR_PROGRAM</code>).</p>
</div>
<div class="paragraph">
<p>This annotation is not supported by: Wicket viewer (which does not support transient objects).  See also <a href="https://issues.apache.org/jira/browse/ISIS-743">ISIS-743</a> contemplating the removal of this annotation.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain, Persistence</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Parseable</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Indicates that a (value) class can be reconstructed from a string.<br></p>
</div>
<div class="paragraph">
<p>Parseability means being able to parse a string representation into an object by way of the <code>o.a.i.applib.adapters.Parser</code> interface. Generally this only applies to value types, where the <code>@Value</code> annotation implies encodability through the <code>ValueSemanticsProvider</code> interface.<br></p>
</div>
<div class="paragraph">
<p>For these reasons the <code>@Parser</code> annotation is generally never applied directly, but can be thought of as a placeholder for future enhancements whereby non-value types might also have be able to be parsed.<br></p>
</div>
<div class="paragraph">
<p>Note that the Wicket viewer uses Apache Wicket&#8217;s Converter API instead.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI, Domain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Value</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Specify that a class has value-semantics.<br></p>
</div>
<div class="paragraph">
<p>The <code>@Value</code> annotation indicates that a class should be treated as a value type rather than as a reference (or entity) type. It does this providing an implementation of a <code>o.a.i.applib.adapters.ValueSemanticsProvider</code>.<br></p>
</div>
<div class="paragraph">
<p>For example:<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Value</span>(semanticsProviderClass=
    ComplexNumberValueSemanticsProvider.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ComplexNumber</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ValueSemanticsProvider</code> allows the framework to interact with the value, parsing strings and displaying as text, and encoding/decoding (for serialization).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-Action">2.2. <code>@Action</code></h3>
<div class="paragraph">
<p>The <code>@Action</code> annotation groups together all domain-specific metadata for an invokable action on a domain object or domain service.</p>
</div>
<div class="paragraph">
<p>The table below summarizes the annotation&#8217;s attributes.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 8. <code>@Action</code> attributes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Values (default)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Action_command"><code>command()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AS_CONFIGURED</code>, <code>ENABLED</code>, <code>DISABLED</code><br>
(<code>AS_CONFIGURED</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>whether the action invocation should be reified into a <code>o.a.i.applib.</code><br>
<code>services.command.Command</code> object through the <a href="#_rg_services-api_manpage-CommandContext"><code>CommandContext</code></a> service.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>commandExecuteIn()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FOREGROUND</code>,<code>BACKGROUND</code><br>
(<code>FOREGROUND</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>whether to execute the command immediately, or to persist it (assuming that an appropriate implementation of <a href="#_rg_services-spi_manpage-CommandService"><code>CommandService</code></a> has been configured) such that a background scheduler can execute the command asynchronously</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>commandPersistence()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PERSISTED</code>, <code>NOT_PERSISTED</code>, <code>IF_HINTED</code><br>
(<code>PERSISTED</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>whether the reified <code>Command</code> (as provided by the <code>CommandContext</code> domain service) should actually be persisted (assuming an appropriate implementation of <a href="#_rg_services-spi_manpage-CommandService"><code>CommandService</code></a> has been configured).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Action_domainEvent"><code>domainEvent()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">subtype of <code>ActionDomainEvent</code><br>
(<code>ActionDomainEvent.Default</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>the event type to be posted to the <a href="#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a> to broadcast the action&#8217;s business rule checking (hide, disable, validate) and its invocation (pre-execute and post-execution).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Action_hidden"><code>hidden()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EVERYWHERE</code>, <code>NOWHERE</code><br>
(<code>NOWHERE</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>indicates where (in the UI) the action should be hidden from the user.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Action_invokeOn"><code>invokeOn()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OBJECT_ONLY</code>, <code>COLLECTION_ONLY</code>, <code>OBJECT_AND_COLLECTION</code><br>
(<code>OBJECT_ONLY</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>whether an action can be invoked on a single object and/or on many objects in a collection.</p>
</div>
<div class="paragraph">
<p>Currently this is only supported for no-arg actions.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Action_publishing"><code>publishing()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AS_CONFIGURED</code>, <code>ENABLED</code>, <code>DISABLED</code><br>
(<code>AS_CONFIGURED</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>whether the action invocation should be published to the registered <a href="#_rg_services-spi_manpage-PublishingService"><code>PublishingService</code></a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>publishing-</code><br>
<code>PayloadFactory()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">subtype of <code>PublishingPayloadFactory-</code> <code>ForAction</code> (none)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>specifies that a custom implementation of <code>PublishingPayloadFactoryForAction</code> be used to create the (payload of the) published event representing the action invocation</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Action_restrictTo"><code>restrictTo()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NO_RESTRICTIONS</code>,<code>PROTOTYPING</code><br>
(<code>NO_RESTRICTIONS</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>whether the action is only available in prototyping mode, or whether it is available also in production mode.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Action_semantics"><code>semantics()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SAFE_AND_REQUEST_CACHEABLE</code>, <code>SAFE</code>, <code>IDEMPOTENT</code>, <code>NON_IDEMPOTENT</code><br>
(<code>NON_IDEMPOTENT</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>the action&#8217;s semantics (ie whether objects are modified as the result of invoking this action, and if so whether reinvoking the action would result in no further change; if not whether the results can be cached for the remainder of the request)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Action_typeOf"><code>typeOf()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(none)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>if the action returns a collection, hints as to the run-time type of the objects within that collection (as a fallback)</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">CompletedEvent</span> <span class="directive">extends</span> ActionDomainEvent&lt;ToDoItem&gt; {
        <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1L</span>;
        <span class="directive">public</span> CompletedEvent(
                <span class="directive">final</span> ToDoItem source,
                <span class="directive">final</span> Identifier identifier,
                <span class="directive">final</span> <span class="predefined-type">Object</span>... arguments) {
            <span class="local-variable">super</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">completed</span><span class="delimiter">&quot;</span></span>, source, identifier, arguments);
        }
    }
    <span class="annotation">@Action</span>(
        command=CommandReification.ENABLED,
        commandExecuteIn=CommandExecuteIn.FOREGROUND,          <i class="conum" data-value="1"></i><b>(1)</b>
        commandPersistence=CommandPersistence.NOT_PERSISTED,   <i class="conum" data-value="2"></i><b>(2)</b>
        domainEvent=CompletedEvent.class,
        hidden = Where.NOWHERE,                                <i class="conum" data-value="3"></i><b>(3)</b>
        invokeOn = InvokeOn.OBJECT_ONLY,                       <i class="conum" data-value="4"></i><b>(4)</b>
        publishing = Publishing.ENABLED,
        semantics = SemanticsOf.IDEMPOTENT
    )
    <span class="directive">public</span> ToDoItem completed() { ... }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>default value, so could be omitted</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>default value, so could be omitted</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>default value, so could be omitted</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>default value, so could be omitted</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Action_command">2.2.1. <code>command()</code></h4>
<div class="paragraph">
<p>The <code>@Action(command=&#8230;&#8203;)</code> attribute (and the related <code>@Action(commandPersistence=&#8230;&#8203;)</code> and  <code>@Action(commandExecuteIn=&#8230;&#8203;)</code> attributes) allows an action invocation to be made into a concrete object such that it can be inspected and persisted.  The primary use case for this is enhanced profiling/auditing, and it also supports the deferring the execution of the action such that it can be invoked in the background.</p>
</div>
<div class="paragraph">
<p>The annotation works with (and is influenced by the behaviour of) a number of domain services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_rg_services-api_manpage-CommandContext"><code>CommandContext</code></a></p>
</li>
<li>
<p><a href="#_rg_services-spi_manpage-CommandService"><code>CommandService</code></a></p>
</li>
<li>
<p><a href="#_rg_services-spi_manpage-BackgroundService"><code>BackgroundService</code></a> and</p>
</li>
<li>
<p><a href="#_rg_services-spi_manpage-BackgroundCommandService"><code>BackgroundCommandService</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each action invocation is reified by the <a href="#_rg_services-api_manpage-CommandContext"><code>CommandContext</code></a> service into a <code>Command</code> object, capturing details of the target object, the action, the parameter arguments, the user, a timestamp and so on.</p>
</div>
<div class="paragraph">
<p>If an appropriate <code>CommandService</code> is configured (for example using (non-ASF) <a href="http://github.com/isisaddons/isis-module-command">Isis addons' command</a> module), then the <code>Command</code> itself is persisted.</p>
</div>
<div class="paragraph">
<p>By default, actions are invoked in directly in the thread of the invocation.   If there is an implementation of <code>BackgroundCommandService</code> (as the <a href="http://github.com/isisaddons/isis-module-command">Isis addons' command</a> module does provide), then this means in turn that the <code>BackgroundService</code> can be used by the domain object code to programmatically create background <code>Command</code>s.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If background <code>Command</code>s are used, then an external scheduler, using <a href="ug.html#_ug_headless-access_BackgroundCommandExecution">headless access</a>, must also be configured.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>command()</code> attribute determines whether the action invocation should be reified into a <code>Command</code> object (by the <a href="#_rg_services-api_manpage-CommandContext"><code>CommandContext</code></a> service).</p>
</div>
<div class="paragraph">
<p>The default is <code>AS_CONFIGURED</code>, meaning that the <a href="#_rg_runtime_configuring-core">configuration property</a> <code>isis.services.command.actions</code> is used to determine the whether the action is reified:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>all</code><br></p>
<div class="paragraph">
<p>all actions are reified</p>
</div>
</li>
<li>
<p><code>ignoreSafe</code> (or <code>ignoreQueryOnly</code>)<br></p>
<div class="paragraph">
<p>actions with safe (read-only) semantics are ignored, but actions which may modify data are not ignored</p>
</div>
</li>
<li>
<p><code>none</code><br></p>
<div class="paragraph">
<p>no actions are reified.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If there is no configuration property in <code>isis.properties</code> then all actions are reified into <code>Command</code>s.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note: <code>Command</code> reification does not necessarily imply that <code>Command</code> objects will be persisted; that depends on whether there is a <a href="#_rg_services-spi_manpage-CommandService"><code>CommandService</code></a> configured that will persist said <code>Command</code>s.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This default can be overridden on an action-by-action basis; if <code>command()</code> is set to <code>ENABLED</code> then the action is reified irrespective of the configured value; if set to <code>DISABLED</code> then the action is NOT reified irrespective of the configured value.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Order</span> {
    <span class="annotation">@Action</span>(command=CommandReification.ENABLED)
    <span class="directive">public</span> Invoice generateInvoice(...) { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>corresponds to the behaviour described above; the <code>Command</code> object is persisted (assuming an appropriate <code>CommandService</code> is defined, and executed immediately in the foreground).</p>
</div>
<div class="sect4">
<h5 id="__code_commandpersistence_code"><code>commandPersistence()</code></h5>
<div class="paragraph">
<p>If the action has been reified, then the <code>commandPersistence()</code> attribute determines whether that <code>Command</code> object
should then also be persisted (the default), or not persisted, or only if hinted.</p>
</div>
<div class="paragraph">
<p>To explain this last alternative:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Order</span> {
    <span class="annotation">@Action</span>(
        command=CommandReification.ENABLED,
        commandPersistence=CommandPersistence.IF_HINTED
    )
    <span class="directive">public</span> Invoice generateInvoice(...) { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will suppress the persistence of the <code>Command</code> object <em>unless</em> a child background <code>Command</code> has been created in the body of the action by way of the <a href="#_rg_services-api_manpage-BackgroundService"><code>BackgroundService</code></a>.</p>
</div>
<div class="paragraph">
<p>On the other hand:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Order</span> {
    <span class="annotation">@Action</span>(
        command=CommandReification.ENABLED,
        commandExecuteIn=CommandExecuteIn.FOREGROUND,
        commandPersistence=CommandPersistence.NOT_PERSISTED
    )
    <span class="directive">public</span> Invoice generateInvoice(...) { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will prevent the parent <code>Command</code> object from being persisted, <em>even if</em> a child background <code>Command</code> is created.</p>
</div>
</div>
<div class="sect4">
<h5 id="__code_commandexecutein_code"><code>commandExecuteIn()</code></h5>
<div class="paragraph">
<p>For persisted commands, the <code>commandExecuteIn()</code> attribute determines whether the <code>Command</code> should be executed in the foreground (the default) or executed in the background.</p>
</div>
<div class="paragraph">
<p>Background execution means that the command is not executed immediately, but is available for a configured <a href="#_rg_services-spi_manpage-BackgroundCommandService"><code>BackgroundCommandService</code></a> to execute, eg by way of an in-memory scheduler such as Quartz.  See <a href="ug.html#_ug_headless-access_BackgroundCommandExecution">here</a> for further information on this topic.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Order</span> {
    <span class="annotation">@Action</span>(
        command=CommandReification.ENABLED,
        commandExecuteIn=CommandExecuteIn.BACKGROUND)
    <span class="directive">public</span> Invoice generateInvoice(...) { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will result in the <code>Command</code> being persisted but its execution deferred to a background execution mechanism. The
returned object from this action is the persisted <code>Command</code> itself.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Action_domainEvent">2.2.2. domainEvent()</h4>
<div class="paragraph">
<p>Whenever a domain object (or list of domain objects) is to be rendered, the framework fires off multiple domain events for every property, collection and action of the domain object.  In the cases of the domain object&#8217;s actions, the events that are fired are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>hide phase: to check that the action is visible (has not been hidden)</p>
</li>
<li>
<p>disable phase: to check that the action is usable (has not been disabled)</p>
</li>
<li>
<p>validate phase: to check that the action&#8217;s arguments are valid</p>
</li>
<li>
<p>pre-execute phase: before the invocation of the action</p>
</li>
<li>
<p>post-execute: after the invocation of the action</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Subscribers subscribe through the <a href="#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a> using either <a href="https://github.com/google/guava">Guava</a> or <a href="http://www.axonframework.org/">Axon Framework</a> annotations and can influence each of these phases.</p>
</div>
<div class="paragraph">
<p>By default the event raised is <code>ActionDomainEvent.Default</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    <span class="annotation">@Action</span>()
    <span class="directive">public</span> ToDoItem completed() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The purpose of the <code>domainEvent()</code> attribute is to allows a custom subclass to be emitted instead.  This attribute is also supported for <a href="#_rg_annotations_manpage-Collection_domainEvent">collections</a> and <a href="#_rg_annotations_manpage-Property_domainEvent">properties</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">CompletedEvent</span> <span class="directive">extends</span> ActionDomainEvent&lt;ToDoItem&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1L</span>;
        <span class="directive">public</span> CompletedEvent(                                               <i class="conum" data-value="2"></i><b>(2)</b>
                <span class="directive">final</span> ToDoItem source,                                       <i class="conum" data-value="3"></i><b>(3)</b>
                <span class="directive">final</span> Identifier identifier,                                 <i class="conum" data-value="4"></i><b>(4)</b>
                <span class="directive">final</span> <span class="predefined-type">Object</span>... arguments) {                                 <i class="conum" data-value="5"></i><b>(5)</b>
            <span class="local-variable">super</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">completed</span><span class="delimiter">&quot;</span></span>, source, identifier, arguments);
        }
    }
    <span class="annotation">@Action</span>(domainEvent=CompletedEvent.class)
    <span class="directive">public</span> ToDoItem completed() { ... }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>inherit from <code>ActionDomainEvent&lt;T&gt;</code> where <code>T</code> is the type of the domain object being interacted with</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>constructor called reflectively by the framework</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>populated with the object being interacted with (the source of the event)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>identifier of the collection</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>action argument(s)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The benefit is that subscribers can be more targetted as to the events that they subscribe to.</p>
</div>
<div class="sect4">
<h5 id="_subscribers">Subscribers</h5>
<div class="paragraph">
<p>Subscribers (which must be domain services) subscribe using either the <a href="https://github.com/google/guava">Guava</a> API or (if the <a href="#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a> has been appropriately configured) using the <a href="http://www.axonframework.org/">Axon Framework</a> API.  The examples below use the Guava API.</p>
</div>
<div class="paragraph">
<p>Subscribers can be either coarse-grained (if they subscribe to the top-level event type):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeSubscriber</span> {
    <span class="annotation">@Programmatic</span>
    <span class="annotation">@com</span>.google.common.eventbus.Subscribe
    <span class="directive">public</span> <span class="type">void</span> on(ActionInteractionEvent ev) {
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or can be fine-grained (by subscribing to specific event subtypes):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeSubscriber</span> {
    <span class="annotation">@Programmatic</span>
    <span class="annotation">@com</span>.google.common.eventbus.Subscribe
    <span class="directive">public</span> <span class="type">void</span> on(ToDoItem.CompletedEvent ev) {
        ...
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the AxonFramework is being used, replace <code>@com.google.common.eventbus.Subscribe</code> with <code>@org.axonframework.eventhandling.annotation.EventHandler</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The subscriber&#8217;s method is called (up to) 5 times:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>whether to veto visibility (hide)</p>
</li>
<li>
<p>whether to veto usability (disable)</p>
</li>
<li>
<p>whether to veto execution (validate)</p>
</li>
<li>
<p>steps to perform prior to the action being invoked.</p>
</li>
<li>
<p>steps to perform after the action has been invoked.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The subscriber can distinguish these by calling <code>ev.getEventPhase()</code>. Thus the general form is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Programmatic</span>
<span class="annotation">@com</span>.google.common.eventbus.Subscribe
<span class="directive">public</span> <span class="type">void</span> on(ActionDomainEvent ev) {
    <span class="keyword">switch</span>(ev.getPhase()) {
        <span class="keyword">case</span> HIDE:
            <span class="comment">// call ev.hide() or ev.veto(&quot;&quot;) to hide the action</span>
            <span class="keyword">break</span>;
        <span class="keyword">case</span> DISABLE:
            <span class="comment">// call ev.disable(&quot;...&quot;) or ev.veto(&quot;...&quot;) to disable the action</span>
            <span class="keyword">break</span>;
        <span class="keyword">case</span> VALIDATE:
            <span class="comment">// call ev.invalidate(&quot;...&quot;) or ev.veto(&quot;...&quot;)</span>
            <span class="comment">// if action arguments are invalid</span>
            <span class="keyword">break</span>;
        <span class="keyword">case</span> EXECUTING:
            <span class="keyword">break</span>;
        <span class="keyword">case</span> EXECUTED:
            <span class="keyword">break</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to abort the transaction during the executing or executed phases by throwing an exception. If the exception is a subtype of <code>RecoverableException</code> then the exception will be rendered as a user-friendly warning (eg Growl/toast) rather than an error.</p>
</div>
</div>
<div class="sect4">
<h5 id="_raising_events_programmatically">Raising events programmatically</h5>
<div class="paragraph">
<p>Normally events are only raised for interactions through the UI. However, events can be raised programmatically either by calling the <a href="#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a> API directly, or by emulating the UI by
wrapping the target object using the <a href="#_rg_services-api_manpage-WrapperFactory"><code>WrapperFactory</code></a> domain service.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Action_hidden">2.2.3. <code>hidden()</code></h4>
<div class="paragraph">
<p>Actions can be hidden at the domain-level, indicating that they are not visible to the end-user.  This attribute can also be applied to <a href="#_rg_annotations_manpage-Property_hidden">properties</a> and <a href="#_rg_annotations_manpage-Collection_hidden">collections</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is also possible to use <a href="#_rg_annotations_manpage-ActionLayout_hidden"><code>@ActionLayout#hidden()</code></a> or <a href="#_rg_object-layout_dynamic">dynamic layouts</a> such that the action can be hidden at the view layer. Both options are provided with a view that in the future the view-layer semantics may be under the control of (expert) users, whereas domain-layer semantics should never be overridden or modified by the user.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@Action</span>(hidden=Where.EVERYWHERE)
    <span class="directive">public</span> <span class="type">void</span> updateStatus() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The acceptable values for the <code>where</code> parameter are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Where.EVERYWHERE</code> or <code>Where.ANYWHERE</code><br></p>
<div class="paragraph">
<p>The action should be hidden at all times.</p>
</div>
</li>
<li>
<p><code>Where.NOWHERE</code><br></p>
<div class="paragraph">
<p>The action should not be hidden.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The other values of the <code>Where</code> enum have no meaning for a collection.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For actions of domain services the visibility is dependent upon its <a href="#_rg_annotations_manpage-DomainService_nature"><code>@DomainService#nature()</code></a> and also on whether it is contributed (as per  <a href="#_rg_annotations_manpage-ActionLayout_contributedAs"><code>@ActionLayout#contributedAs()</code></a>).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Action_invokeOn">2.2.4. <code>invokeOn()</code></h4>
<div class="paragraph">
<p>The <code>invokeOn()</code> attribute indicates whether the an action can be invoked on a single object (the default) and/or on many objects in a collection.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    <span class="annotation">@Action</span>(invokeOn=InvokeOn.OBJECT_AND_COLLECTION)
    <span class="directive">public</span> <span class="type">void</span> markAsCompleted() {
        setCompleted(<span class="predefined-constant">true</span>);
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Actions to be invoked on collection (currently) have a number of constraints.  It:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>must take no arguments</p>
</li>
<li>
<p>cannot be hidden (any annotations or supporting methods to that effect will be ignored)</p>
</li>
<li>
<p>cannot be disabled (any annotations or supporting methods to that effect will be ignored).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The example given above is probably ok, because <code>setCompleted()</code> is most likely idempotent. However, if the action also called some other method, then we should add a guard.</p>
</div>
<div class="paragraph">
<p>For example, for this non-idempotent action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Action</span>(invokeOn=InvokeOn.OBJECT_AND_COLLECTION)
<span class="directive">public</span> <span class="type">void</span> markAsCompleted() {
    setCompleted(<span class="predefined-constant">true</span>);
    todoTotalizer.incrementNumberCompleted();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>we should instead write it as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Action</span>(invokeOn=InvokeOn.OBJECT_AND_COLLECTION)
<span class="directive">public</span> <span class="type">void</span> markAsCompleted() {
    <span class="keyword">if</span>(isCompleted()) {
        <span class="keyword">return</span>;
    }
    setCompleted(<span class="predefined-constant">true</span>);
    todoTotalizer.incrementNumberCompleted();
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This attribute has no meaning if annotated on an action of a domain service.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Action_publishing">2.2.5. <code>publishing()</code></h4>
<div class="paragraph">
<p>The <code>publishing()</code> attribute determines whether and how an action invocation is published via the registered implementation of a <a href="#_rg_services-spi_manpage-PublishingService"><code>PublishingService</code></a>).  This attribute is also supported for <a href="#_rg_annotations_manpage-DomainObject_publishing">domain objects</a>, where it controls whether changed objects are published as events.</p>
</div>
<div class="paragraph">
<p>A common use case is to notify external "downstream" systems of changes in the state of the Isis application.
The default value for the attribute is <code>AS_CONFIGURED</code>, meaning that the <a href="#_rg_runtime_configuring-core">configuration property</a> <code>isis.services.publish.actions</code> is used to determine the whether the action is published:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>all</code><br></p>
<div class="paragraph">
<p>all actions are published</p>
</div>
</li>
<li>
<p><code>ignoreSafe</code> (or <code>ignoreQueryOnly</code>)<br></p>
<div class="paragraph">
<p>actions with safe (read-only) semantics are ignored, but actions which may modify data are not ignored</p>
</div>
</li>
<li>
<p><code>none</code><br></p>
<div class="paragraph">
<p>no actions are published</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If there is no configuration property in <code>isis.properties</code> then publishing is automatically enabled.</p>
</div>
<div class="paragraph">
<p>This default can be overridden on an action-by-action basis; if <code>publishing()</code> is set to <code>ENABLED</code> then the action invocation is published irrespective of the configured value; if set to <code>DISABLED</code> then the action invocation is <em>not</em> published, again irrespective of the configured value.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Order</span> {
    <span class="annotation">@Action</span>(publishing=Publishing.ENABLED)        <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> Invoice generateInvoice(...) { ... }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>because set to enabled, will be published irrespective of the configured value.</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="__code_publishingpayloadfactory_code"><code>publishingPayloadFactory()</code></h5>
<div class="paragraph">
<p>The (optional) related <code>publishingPayloadFactory()</code> specifies the class to use to create the (payload of the) event to be published by the publishing factory.</p>
</div>
<div class="paragraph">
<p>Rather than simply broadcast that the action was invoked, the payload factory allows a "fatter" payload to be instantiated that can eagerly push commonly-required information to all subscribers. For at least some subscribers this should avoid the necessity to query back for additional information.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Action_restrictTo">2.2.6. <code>restrictTo()</code></h4>
<div class="paragraph">
<p>By default actions are available irrespective of the <a href="#_rg_runtime_deployment-types">deployment mode</a>.  The <code>restrictTo()</code> attribute specifies whether the action should instead be restricted to only available in prototyping mode.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">public</span> Order placeNewOrder() { ... }
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Order&gt; listRecentOrders() { ... }

    <span class="annotation">@Action</span>(restrictTo=RestrictTo.PROTOTYPING)
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Order&gt; listAllOrders() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the listing of all orders (in the <code>listAllOrders()</code> action) probably doesn&#8217;t make sense for production; there could be thousands or millions.  However, it would be useful to disaply how for a test or demo system where there are only a handful of orders.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Action_semantics">2.2.7. <code>semantics()</code></h4>
<div class="paragraph">
<p>The <code>semantics()</code> attribute describes whether the invocation modifies state of the system, and if so whether it does so idempotently.  If the action invocation does <em>not</em> modify the state of the system, in other words is safe, then it also can beused to specify whether the results of the action can be cached automatically for the remainder of the request.</p>
</div>
<div class="paragraph">
<p>The attribute was originally introduced for the <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a> in order that action invocations could be using the appropriate <code>HTTP</code> verb (<code>GET</code>, <code>PUT</code> and <code>POST</code>).</p>
</div>
<div class="paragraph">
<p>The table below summarizes the semantics:</p>
</div>
<div class="paragraph">
<p>Action semantics</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 16%;">
<col style="width: 33%;">
<col style="width: 16%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Semantic</th>
<th class="tableblock halign-left valign-top">Changes state</th>
<th class="tableblock halign-left valign-top">Effect of multiple calls</th>
<th class="tableblock halign-left valign-top">HTTP verb<br>
(Restful Objects)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAFE_AND_REQUEST_CACHEABLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Will always return the same result each time invoked (within a given request scope)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAFE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Might result in different results each invocation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IDEMPOTENT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Will make no further changes if called multiple times (eg sets a property or adds to a <code>Set</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NON_IDEMPOTENT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Might change the state of the system each time called (eg increments a counter or adds to a <code>List</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The actions' semantics are also used by the core runtime as part of the in-built concurrency checkng; invocation of a safe action (which includes request-cacheable) does <em>not</em> perform a concurrency check, whereas non-safe actions <em>do</em> perform a concurrency check.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@Action</span>(semantics=SemanticsOf.SAFE_AND_REQUEST_CACHEABLE)
    <span class="directive">public</span> CreditRating checkCredit() { ... }

    <span class="annotation">@Action</span>(semantics=SemanticsOf.IDEMPOTENT)
    <span class="directive">public</span> <span class="type">void</span> changeOfAddress(Address address) { ... }

    <span class="annotation">@Action</span>(semantics=SemanticsOf.NON_IDEMPOTENT)
    <span class="directive">public</span> Order placeNewOrder() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Actions that are safe and request-cacheable automatically use the <a href="#_rg_services-api_manpage-QueryResultsCache"><code>QueryResultsCache</code></a> service to cache the result of the method.  Note though that the results of this caching will only be apparent if the action is invoked from another method using the <a href="#_rg_services-api_manpage-WrapperFactory"><code>WrapperFactory</code></a> service.</p>
</div>
<div class="paragraph">
<p>Continuing the example above, imagine code that loops over a set of <code>Order</code>s where each <code>Order</code> has an associated <code>Customer</code>.  We want to check the credit rating of each <code>Customer</code> (a potentially expensive operation) but we don&#8217;t want to do it more than once per <code>Customer</code>.  Invoking through the <code>WrapperFactory</code> will allow us to accomplish this by exploiting the semantics of <code>checkCredit()</code> action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> dispatchToCreditWorthyCustomers(<span class="directive">final</span> <span class="predefined-type">List</span>&lt;Order&gt; orders) {
    <span class="keyword">for</span>(Order order: orders) {
        Customer customer = order.getCustomer();
        CreditRating creditRating = wrapperFactory.wrapSkipRules(customer).checkCredit();  <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="keyword">if</span>(creditRating.isWorthy()) {
            order.dispatch();
        }
    }
}
<span class="annotation">@Inject</span>
WrapperFactory wrapperFactory;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>wrap the customer to dispatch.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the above example we&#8217;ve used <code>wrapSkipRules(&#8230;&#8203;)</code> but if we wanted to enforce any business rules associated with the <code>checkCredit()</code> method, we would have used <code>wrap(&#8230;&#8203;)</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Action_typeOf">2.2.8. <code>typeOf()</code></h4>
<div class="paragraph">
<p>The <code>typeOf()</code> attribute specifies the expected type of an element returned by the action (returning a collection), when for whatever reason the type cannot be inferred from the generic type, or to provide a hint about the actual run-time (as opposed to compile-time) type.  This attribute can also be specified for <a href="#_rg_annotations_manpage-Collection_typeOf">collections</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> AccountService {
    <span class="annotation">@Action</span>(typeOf=Customer.class)
    <span class="directive">public</span> <span class="predefined-type">List</span> errantAccounts() {
        <span class="keyword">return</span> customers.allNewCustomers();
    }
    ...

    <span class="annotation">@Inject</span>
    CustomerRepository customers;
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In general we recommend that you use generics instead, eg <code>List&lt;Customer&gt;</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-ActionLayout">2.3. <code>@ActionLayout</code></h3>
<div class="paragraph">
<p>The <code>@ActionLayout</code> annotation applies to actions, collecting together all UI hints within a single annotation.</p>
</div>
<div class="paragraph">
<p>The table below summarizes the annotation&#8217;s attributes.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 9. <code>@ActionLayout</code> attributes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Values (default)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-ActionLayout_bookmarking"><code>bookmarking()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AS_ROOT</code>, <code>NEVER</code><br>
(<code>NEVER</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>indicates if an action (with safe <a href="#_rg_annotations_manpage-Action_semantics">action semantics</a>) is automatically bookmarked.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-ActionLayout_contributedAs"><code>contributedAs()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AS_BOTH</code>, <code>AS_ACTION</code>, <code>AS_ASSOCIATION</code>, <code>AS_NEITHER</code><br>
(<code>AS_BOTH</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>for a domain service action that can be contributed, whether to contribute as an action or as an association (ie a property or collection).<br></p>
</div>
<div class="paragraph">
<p>For a domain service action to be contributed, the domain services must have a <a href="#_rg_annotations_manpage-DomainService_nature">nature</a> nature of either <code>VIEW</code> or <code>VIEW_CONTRIBUTIONS_ONLY</code>, and the action must have <a href="#_rg_annotations_manpage-Action_semantics">safe action semantics</a>, and takes a single argument, namely the contributee domain object.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-ActionLayout_cssClass"><code>cssClass()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any string valid as a CSS class</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>an additional CSS class around the HTML that represents for the action, to allow targetted styling in <a href="#_rg_runtime_application-specific_application-css"><code>application.css</code></a>.<br></p>
</div>
<div class="paragraph">
<p>Supported by the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> but currently ignored by the <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-ActionLayout_cssClassFa"><code>cssClassFa()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any valid <a href="http://fortawesome.github.io/Font-Awesome/">Font awesome</a> icon name</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>specify a font awesome icon for the action&#8217;s menu link or icon.<br></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cssClassFaPosition()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LEFT</code>, <code>RIGHT</code><br>
(<code>LEFT</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Positioning of the icon on the button/menu item.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-ActionLayout_describedAs"><code>describedAs()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>provides a short description of the action, eg for rendering as a 'tool tip'.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-ActionLayout_hidden"><code>hidden()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EVERYWHERE</code>, <code>NOWHERE</code><br>
(<code>NOWHERE</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>indicates where (in the UI) the action should be hidden from the user.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-ActionLayout_named"><code>named()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>to override the name inferred from the action&#8217;s name in code.<br></p>
</div>
<div class="paragraph">
<p>A typical use case is if the desired name is a reserved Java keyword, such as <code>default</code> or <code>package</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-ActionLayout_position"><code>position()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BELOW</code>, <code>RIGHT</code>, <code>PANEL</code>, <code>PANEL_DROPDOWN</code> (<code>BELOW</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>for actions associated (using <a href="#_rg_annotations_manpage-MemberOrder"><code>@MemberOrder#named()</code></a>) with properties, the positioning of the action&#8217;s button with respect to the property</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItems</span> {
    <span class="annotation">@Action</span>(semantics=SemanticsOf.SAFE)             <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@ActionLayout</span>(
        bookmarking=BookmarkPolicy.AS_ROOT,
        cssClass=<span class="string"><span class="delimiter">&quot;</span><span class="content">x-key</span><span class="delimiter">&quot;</span></span>,
        cssClassFa=<span class="string"><span class="delimiter">&quot;</span><span class="content">fa-checkbox</span><span class="delimiter">&quot;</span></span>,
        describedAs=<span class="string"><span class="delimiter">&quot;</span><span class="content">Mark the todo item as not complete after all</span><span class="delimiter">&quot;</span></span>,
        hidden=Where.NOWHERE                        <i class="conum" data-value="2"></i><b>(2)</b>
    )
    <span class="annotation">@MemberOrder</span>(sequence = <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;ToDoItem&gt; notYetComplete() {
        ...
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>required for bookmarkable actions</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>default value, so could be omitted</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As an alternative to using the <code>@ActionLayout</code> annotation, a dynamic layout using  <a href="#_rg_object-layout_dynamic"><code>.layout.json</code></a> file can be specified; for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="string"><span class="delimiter">&quot;</span><span class="content">notYetComplete</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">actionLayout</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">bookmarking</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">AS_ROOT</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">cssClass</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">x-key</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">cssClassFa</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">fa-checkbox</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">describedAs</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Mark the todo item as not complete after all</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">NOWHERE</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-ActionLayout_bookmarking">2.3.1. <code>bookmarking()</code></h4>
<div class="paragraph">
<p>The <code>bookmarking()</code> attribute indicates if an action (with safe <a href="#_rg_annotations_manpage-Action_semantics">action semantics</a>) is automatically bookmarked. This attribute is also supported for  <a href="#_rg_annotations_manpage-DomainObjectLayout_bookmarking">domain objects</a>.</p>
</div>
<div class="paragraph">
<p>In the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a>, a link to a bookmarked object is shown in the bookmarks panel:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-annotations/ActionLayout/bookmarking.png"><img src="images/reference-annotations/ActionLayout/bookmarking.png" alt="bookmarking" width="720px"></a>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that this screenshot shows an earlier version of the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> UI (specifically, pre 1.8.0).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> supports <code>alt-[</code> as a shortcut for opening the bookmark panel.  <code>Esc</code> will close.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItems</span> {
    <span class="annotation">@Action</span>(semantics=SemanticsOf.SAFE)
    <span class="annotation">@ActionLayout</span>(bookmarking=BookmarkPolicy.AS_ROOT)
    <span class="annotation">@MemberOrder</span>(sequence = <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;ToDoItem&gt; notYetComplete() {
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>indicates that the <code>notYetComplete()</code> action is bookmarkable.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The enum value <code>AS_CHILD</code> has no meaning for actions; it relates only to bookmarked <a href="#_rg_annotations_manpage-DomainObject_bookmarking">domain object</a>s.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As an alternative to using the annotation, the dynamic <a href="#_rg_object-layout_dynamic"><code>.layout.json</code></a>
can be used instead, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="string"><span class="delimiter">&quot;</span><span class="content">notYetComplete</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">actionLayout</span><span class="delimiter">&quot;</span></span>: { <span class="key"><span class="delimiter">&quot;</span><span class="content">bookmarking</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">AS_ROOT</span><span class="delimiter">&quot;</span></span> }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-ActionLayout_contributedAs">2.3.2. <code>contributedAs()</code></h4>
<div class="paragraph">
<p>For a domain service action that <em>can</em> be contributed, the <code>contributedAs()</code> attribute determines how it is contributed: as an action or as an association (ie a property or collection).</p>
</div>
<div class="paragraph">
<p>The distinction between property or collection is automatic: if the action returns a <code>java.util.Collection</code> (or subtype) then the action is contributed as a collection; otherwise it is contributed as a property.</p>
</div>
<div class="paragraph">
<p>For a domain service action to be contributed, the domain services must have a <a href="#_rg_annotations_manpage-DomainService_nature">nature</a> nature of either <code>VIEW</code> or <code>VIEW_CONTRIBUTIONS_ONLY</code>, and the action must have <a href="#_rg_annotations_manpage-Action_semantics">safe action semantics</a>, and takes a single argument, namely the contributee domain object.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature=NatureOfService.VIEW_CONTRIBUTIONS_ONLY)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerContributions</span> {
    <span class="annotation">@Action</span>(semantics=SemanticsOf.SAFE)
    <span class="annotation">@ActionLayout</span>(contributedAs=Contributed.AS_ASSOCIATION)
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Order&gt; mostRecentOrders(Customer customer) { ... }
    ...
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>@ActionLayout</code> is not required if the action does not have safe semantics, or if the action takes more than one argument; in these cases the action can only be contributed <em>as</em> an action.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It&#8217;s also possible to use the attribute to suppress the action completely:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature=NatureOfService.VIEW)
<span class="directive">public</span> <span class="type">class</span> <span class="class">OrderContributions</span> {
    <span class="annotation">@ActionLayout</span>(contributedAs=Contributed.AS_NEITHER)
    <span class="directive">public</span> <span class="type">void</span> cancel(Order order);
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In such cases, though, it would probably make more sense to annotate the action as either <a href="#_rg_annotations_manpage-Action_hidden">hidden</a> or indeed <a href="#_rg_annotations_manpage-Programmatic"><code>@Programmatic</code></a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Unlike other <code>@ActionLayout</code> attributes, this attribute <em>cannot</em> be specified dynamically in the <code>.layout.json</code> <a href="#_rg_object-layout_dynamic">dynamic layout file</a> because it relates to the contributor domain service, not the contributee domain object.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-ActionLayout_cssClass">2.3.3. <code>cssClass()</code></h4>
<div class="paragraph">
<p>The <code>cssClass()</code> attribute can be used to render additional CSS classes in the HTML (a wrapping <code>&lt;div&gt;</code>) that represents the action.   <a href="#_rg_runtime_application-specific_application-css">Application-specific CSS</a> can then be used to target and adjust the UI representation of that particular element.</p>
</div>
<div class="paragraph">
<p>This attribute can also be applied to <a href="#_rg_annotations_manpage-DomainObjectLayout_cssClass">domain objects</a>, <a href="#_rg_annotations_manpage-ViewModelLayout_cssClass">view models</a>,  <a href="#_rg_annotations_manpage-PropertyLayout_cssClass">properties</a>,  <a href="#_rg_annotations_manpage-CollectionLayout_cssClass">collections</a> and <a href="#_rg_annotations_manpage-ParameterLayout_cssClass">parameters</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    <span class="annotation">@ActionLayout</span>(cssClass=<span class="string"><span class="delimiter">&quot;</span><span class="content">x-key</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> ToDoItem postpone(LocalDate until) { ... }
    ...
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The similar <a href="#_rg_annotations_manpage-ActionLayout_cssClassFa"><code>@ActionLayout#cssClassFa()</code></a> annotation attribute is also used as a hint
to apply CSS, specifically to add <a href="http://fortawesome.github.io/Font-Awesome/icons/">Font Awesome icons</a> on action menu items or buttons.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As an alternative to using the annotation, the dynamic <a href="#_rg_object-layout_dynamic"><code>.layout.json</code></a>
can be used instead, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="string"><span class="delimiter">&quot;</span><span class="content">postpone</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">actionLayout</span><span class="delimiter">&quot;</span></span>: { <span class="key"><span class="delimiter">&quot;</span><span class="content">cssClass</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">x-key</span><span class="delimiter">&quot;</span></span> }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-ActionLayout_cssClassFa">2.3.4. <code>cssClassFa()</code></h4>
<div class="paragraph">
<p>The <code>cssClassFa()</code> attribute is used to specify the name of a <a href="http://fortawesome.github.io/Font-Awesome/icons/">Font Awesome icon</a> name, to be rendered on the action&#8217;s representation as a button or menu item.    The related <code>cssClassFaPosition()</code> attribute specifies the positioning of the icon, to the left or the right of the text.</p>
</div>
<div class="paragraph">
<p>These attributes can also be applied to <a href="#_rg_annotations_manpage-DomainObjectLayout_cssClassFa">domain objects</a> and to <a href="#_rg_annotations_manpage-ViewModelLayout_cssClassFa">view models</a> to specify the object&#8217;s icon.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    <span class="annotation">@ActionLayout</span>(
        cssClassFa=<span class="string"><span class="delimiter">&quot;</span><span class="content">fa-step-backward</span><span class="delimiter">&quot;</span></span>
    )
    <span class="directive">public</span> ToDoItem previous() { ... }

    <span class="annotation">@ActionLayout</span>(
        cssClassFa=<span class="string"><span class="delimiter">&quot;</span><span class="content">fa-step-forward</span><span class="delimiter">&quot;</span></span>,
        cssClassFaPosition=ActionLayout.CssClassFaPosition.RIGHT
    )
    <span class="directive">public</span> ToDoItem next() { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There can be multiple "fa-" classes, eg to mirror or rotate the icon. There is no need to include the mandatory <code>fa</code> "marker" CSS class; it will be automatically added to the list.  The <code>fa-</code> prefix can also be omitted from the class names; it will be prepended to each if required.</p>
</div>
<div class="paragraph">
<p>As an alternative to using the annotation, the dynamic <a href="#_rg_object-layout_dynamic"><code>.layout.json</code></a>
can be used instead, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="string"><span class="delimiter">&quot;</span><span class="content">previous</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">actionLayout</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">cssClassFa</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">fa-step-backward</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">cssClassFaPosition</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">LEFT</span><span class="delimiter">&quot;</span></span>
    }
},
<span class="key"><span class="delimiter">&quot;</span><span class="content">next</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">actionLayout</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">cssClassFa</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">fa-step-forward</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">cssClassFaPosition</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">RIGHT</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The similar <a href="#_rg_annotations_manpage-ActionLayout_cssClass"><code>@ActionLayout#cssClass()</code></a> annotation attribute is also used as a hint to apply CSS, but for wrapping the representation of an object or object member so that it can be styled in an application-specific way.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-ActionLayout_describedAs">2.3.5. <code>describedAs()</code></h4>
<div class="paragraph">
<p>The <code>describedAs()</code> attribute is used to provide a short description of the action to the user.  In the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> it is displayed as a 'tool tip'.</p>
</div>
<div class="paragraph">
<p>This attribute can also be specified for <a href="#_rg_annotations_manpage-CollectionLayout_describedAs">collections</a>,  <a href="#_rg_annotations_manpage-PropertyLayout_describedAs">properties</a>, <a href="#_rg_annotations_manpage-ParameterLayout_describedAs">parameters</a>, <a href="#_rg_annotations_manpage-DomainObjectLayout_describedAs">domain objects</a> and <a href="#_rg_annotations_manpage-ViewModelLayout_describedAs">view models</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@ActionLayout</span>(describedAs=<span class="string"><span class="delimiter">&quot;</span><span class="content">Place a repeat order of the last (most recently placed) order</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Order placeRepeatOrder(...) { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an alternative to using the annotation, the dynamic <a href="#_rg_object-layout_dynamic"><code>.layout.json</code></a>
can be used instead, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="string"><span class="delimiter">&quot;</span><span class="content">postpone</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">actionLayout</span><span class="delimiter">&quot;</span></span>: { <span class="key"><span class="delimiter">&quot;</span><span class="content">describedAs</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Place a repeat order of the last (most recently placed) order</span><span class="delimiter">&quot;</span></span> }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-ActionLayout_hidden">2.3.6. <code>hidden()</code></h4>
<div class="paragraph">
<p>The <code>hidden()</code> attribute indicates where (in the UI) the action should be hidden from the user.  This attribute can also be applied to <a href="#_rg_annotations_manpage-PropertyLayout_hidden">properties</a> and <a href="#_rg_annotations_manpage-CollectionLayout_hidden">collections</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is also possible to use <a href="#_rg_annotations_manpage-Action_hidden"><code>@Action#hidden()</code></a> to hide an action at the domain layer.  Both options are provided with a view that in the future the view-layer semantics may be under the control of (expert) users, whereas domain-layer semantics should never be overridden or modified by the user.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@ActionLayout</span>(hidden=Where.EVERYWHERE)
    <span class="directive">public</span> <span class="type">void</span> updateStatus() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The acceptable values for the <code>where</code> parameter are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Where.EVERYWHERE</code> or <code>Where.ANYWHERE</code><br></p>
<div class="paragraph">
<p>The action should be hidden at all times.</p>
</div>
</li>
<li>
<p><code>Where.NOWHERE</code><br></p>
<div class="paragraph">
<p>The action should not be hidden.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The other values of the <code>Where</code> enum have no meaning for a collection.</p>
</div>
<div class="paragraph">
<p>As an alternative to using the annotation, the dynamic <a href="#_rg_object-layout_dynamic"><code>.layout.json</code></a>
can be used instead, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="string"><span class="delimiter">&quot;</span><span class="content">updateStatus</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">actionLayout</span><span class="delimiter">&quot;</span></span>: { <span class="key"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">EVERYWHERE</span><span class="delimiter">&quot;</span></span> }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For actions of domain services the visibility is dependent upon its <a href="#_rg_annotations_manpage-DomainService_nature"><code>@DomainService#nature()</code></a> and also on whether it is contributed (as per  <a href="#_rg_annotations_manpage-ActionLayout_contributedAs"><code>@ActionLayout#contributedAs()</code></a>).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-ActionLayout_named">2.3.7. <code>named()</code></h4>
<div class="paragraph">
<p>The <code>named()</code> attribute explicitly specifies the action&#8217;s name, overriding the name that would normally be inferred from the Java source code.  This attribute can also be specified for <a href="#_rg_annotations_manpage-CollectionLayout_named">collections</a>, <a href="#_rg_annotations_manpage-PropertyLayout_named">properties</a>, <a href="#_rg_annotations_manpage-ParameterLayout_named">parameters</a>, <a href="#_rg_annotations_manpage-DomainObjectLayout_named">domain objects</a>, <a href="#_rg_annotations_manpage-ViewModelLayout_named">view models</a> and <a href="#_rg_annotations_manpage-DomainServiceLayout_named">domain services</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Following the <a href="http://en.wikipedia.org/wiki/Don%27t_repeat_yourself">don&#8217;t repeat yourself</a> principle, we recommend that you only use this attribute when the desired name cannot be used in Java source code.  Examples of that include a name that would be a reserved Java keyword (eg "package"), or a name that has punctuation, eg apostrophes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@ActionLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Get credit rating</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> CreditRating obtainCreditRating() { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an alternative to using the annotation, the dynamic <a href="#_rg_object-layout_dynamic"><code>.layout.json</code></a>
can be used instead, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="string"><span class="delimiter">&quot;</span><span class="content">obtainCreditRating</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">actionLayout</span><span class="delimiter">&quot;</span></span>: { <span class="key"><span class="delimiter">&quot;</span><span class="content">named</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Get credit rating</span><span class="delimiter">&quot;</span></span> }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The framework also provides a separate, powerful mechanism for <a href="ug.html#_ug_more-advanced_i18n">internationalization</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-ActionLayout_position">2.3.8. <code>position()</code></h4>
<div class="paragraph">
<p>The <code>position()</code> attribute pertains only to actions that have been associated with properties using <a href="#_rg_annotations_manpage-MemberOrder"><code>@MemberOrder#named()</code></a>.  For these actions, it specifies the positioning of the action&#8217;s button with respect to the field representing the object property.</p>
</div>
<div class="paragraph">
<p>The attribute can take one of four values: <code>BELOW</code>, <code>RIGHT</code>, <code>PANEL</code> or <code>PANEL_DROPDOWN</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {

    <span class="annotation">@Property</span>(
        editing=Editing.DISABLED                 <i class="conum" data-value="1"></i><b>(1)</b>
    )
    <span class="directive">public</span> CustomerStatus getStatus() { ... }
    <span class="directive">public</span> <span class="type">void</span> setStatus(CustomerStatus customerStatus) { ... }

    <span class="annotation">@MemberOrder</span>(
        named=<span class="string"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>,                          <i class="conum" data-value="2"></i><b>(2)</b>
        sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>
    )
    <span class="annotation">@ActionLayout</span>(
        named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Update</span><span class="delimiter">&quot;</span></span>,                          <i class="conum" data-value="3"></i><b>(3)</b>
        position=<span class="predefined-type">Position</span>.BELOW
    )
    <span class="directive">public</span> CreditRating updateStatus(Customer ) { ... }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>indicate the property as read-only, such that it can only be updated using an action</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>associate the "updateStatus" action with the "status" property</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>give the action an abbreviated name, because the fact that the "status" property is to be updated is implied by its positioning</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The default is <code>BELOW</code>, which is rendered (by the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a>) as shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-annotations/ActionLayout/position-BELOW.png"><img src="images/reference-annotations/ActionLayout/position-BELOW.png" alt="position BELOW" width="720px"></a>
</div>
</div>
<div class="paragraph">
<p>If the action is positioned as <code>RIGHT</code>, then the action&#8217;s button is rendered to the right of the property&#8217;s field, in a compact drop-down.  This is ideal if there are many actions associated with a property:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-annotations/ActionLayout/position-RIGHT.png"><img src="images/reference-annotations/ActionLayout/position-RIGHT.png" alt="position RIGHT" width="720px"></a>
</div>
</div>
<div class="paragraph">
<p>If the action is positioned as <code>PANEL</code>, then the action&#8217;s button is rendered on the header of the panel that contains the property:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-annotations/ActionLayout/position-PANEL.png"><img src="images/reference-annotations/ActionLayout/position-PANEL.png" alt="position PANEL" width="720px"></a>
</div>
</div>
<div class="paragraph">
<p>And finally, if the action is positioned as <code>PANEL_DROPDOWN</code>, then the action&#8217;s button is again rendered on the panel header, but as a drop-down:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-annotations/ActionLayout/position-PANEL_DROPDOWN.png"><img src="images/reference-annotations/ActionLayout/position-PANEL_DROPDOWN.png" alt="position PANEL DROPDOWN" width="720px"></a>
</div>
</div>
<div class="paragraph">
<p>If there are multiple actions associated with a single property then the positioning can be mix&#8217;ed-and-match&#8217;ed as required.  If the <code>PANEL</code> or <code>PANEL_DROPDOWN</code> are used, then (as the screenshots above show) the actions from potentially multiple properties grouped by that panel will be shown together.</p>
</div>
<div class="paragraph">
<p>As an alternative to using the annotation, the dynamic <a href="#_rg_object-layout_dynamic"><code>.layout.json</code></a>
can be used instead, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="string"><span class="delimiter">&quot;</span><span class="content">obtainCreditRating</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">actionLayout</span><span class="delimiter">&quot;</span></span>: { <span class="key"><span class="delimiter">&quot;</span><span class="content">named</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Get credit rating</span><span class="delimiter">&quot;</span></span> }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The fact that the layout is dynamic (does not require a rebuild/restart) is particularly useful in that the look-n-feel can be easily experimented with and adjusted.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-Collection">2.4. <code>@Collection</code></h3>
<div class="paragraph">
<p>The <code>@Collection</code> annotation applies to collections collecting together all domain semantics within a single annotation.</p>
</div>
<div class="paragraph">
<p>The table below summarizes the annotation&#8217;s attributes.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 10. <code>@Collection</code> attributes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Values (default)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Collection_domainEvent"><code>domainEvent()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">subtype of <code>CollectionDomainEvent</code><br>
(<code>CollectionDomainEvent.Default</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>the event type to be posted to the <a href="#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a> to broadcast the collection&#8217;s business rule checking (hide, disable, validate) and its modification (before and after).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Collection_editing"><code>editing()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ENABLED</code>, <code>DISABLED</code>, <code>AS_CONFIGURED</code><br>
(<code>AS_CONFIGURED</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>whether a collection can be added to or removed from within the UI</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>editingDisabledReason()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String value</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>if <code>editing()</code> is <code>DISABLED</code>, provides a reason as to why.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Collection_hidden"><code>hidden()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EVERYWHERE</code>, <code>OBJECT_FORMS</code>, <code>NOWHERE</code><br>
(<code>NOWHERE</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>indicates where (in the UI) the collection should be hidden from the user.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Collection_notPersisted"><code>notPersisted()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code><br>
(<code>false</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>whether to exclude from snapshots.<br></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Collection must also be annotated with <code>@javax.jdo.annotations.NotPersistent</code> in order to not be persisted.</p>
</div>
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Collection_typeOf"><code>typeOf()</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>hints as to the run-time type of the objects within that collection (as a fallback)</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">DependenciesChangedEvent</span>
            <span class="directive">extends</span> CollectionDomainEvent&lt;ToDoItem, ToDoItem&gt; {
        <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1L</span>;
        <span class="directive">public</span> DependenciesChangedEvent(
                ToDoItem source,
                Identifier identifier,
                Of of,
                ToDoItem value) {
            <span class="local-variable">super</span>(source, identifier, of, value);
        }
    }
    <span class="annotation">@Collection</span>(
        domainEvent=DependenciesChangedEvent.class,
        editing = Editing.ENABLED,
        hidden = Where.NOWHERE,                       <i class="conum" data-value="1"></i><b>(1)</b>
        notPersisted = <span class="predefined-constant">false</span>,                         <i class="conum" data-value="2"></i><b>(2)</b>
        typeOf = ToDoItem.class                       <i class="conum" data-value="3"></i><b>(3)</b>
    )
    <span class="directive">public</span> <span class="predefined-type">SortedSet</span>&lt;ToDoItem&gt; getDependencies() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>default value, so could be omitted</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>default value, so could be omitted</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>default value, so could be omitted</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Collection_domainEvent">2.4.1. <code>domainEvent()</code></h4>
<div class="paragraph">
<p>Whenever a domain object (or list of domain objects) is to be rendered, the framework fires off multiple domain events for every property, collection and action of the domain object.  In the cases of the domain object&#8217;s collections, the events that are fired are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>hide phase: to check that the collection is visible (has not been hidden)</p>
</li>
<li>
<p>disable phase: to check that the collection is usable (has not been disabled)</p>
</li>
<li>
<p>validate phase: to check that the collection&#8217;s arguments are valid (to add or remove an element)</p>
</li>
<li>
<p>pre-execute phase: before the modification of the collection</p>
</li>
<li>
<p>post-execute: after the modification of the collection</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Subscribers subscribe through the <a href="#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a> using either <a href="https://github.com/google/guava">Guava</a> or <a href="http://www.axonframework.org/">Axon Framework</a> annotations and can influence each of these phases.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="ug.html#<em>ug_wicket-viewer">Wicket viewer</a> does _not</em> currently support the modification of collections; they are rendered read-only.  However, domain events are still relevant to determine if such collections should be hidden.</p>
</div>
<div class="paragraph">
<p>The workaround is to create add/remove actions and use <a href="#_rg_annotations_manpage-MemberOrder">UI hints</a> to render them close to the collection.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default the event raised is <code>CollectionDomainEvent.Default</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    <span class="annotation">@Collection</span>()
    <span class="directive">public</span> <span class="predefined-type">SortedSet</span>&lt;ToDoItem&gt; getDependencies() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The purpose of the <code>domainEvent()</code> attribute is to allows a custom subclass to be emitted instead.  This attribute is also supported for <a href="#_rg_annotations_manpage-Action_domainEvent">actions</a> and <a href="#_rg_annotations_manpage-Property_domainEvent">properties</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">DependenciesChangedEvent</span>
            <span class="directive">extends</span> CollectionDomainEvent&lt;ToDoItem, ToDoItem&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1L</span>;
        <span class="directive">public</span> DependenciesChangedEvent(                        <i class="conum" data-value="2"></i><b>(2)</b>
                ToDoItem source,                                <i class="conum" data-value="3"></i><b>(3)</b>
                Identifier identifier,                          <i class="conum" data-value="4"></i><b>(4)</b>
                Of of,                                          <i class="conum" data-value="5"></i><b>(5)</b>
                ToDoItem value) {                               <i class="conum" data-value="6"></i><b>(6)</b>
            <span class="local-variable">super</span>(source, identifier, of, value);
        }
    }
    <span class="annotation">@Collection</span>(
        domainEvent=DependenciesChangedEvent.class
    )
    <span class="directive">public</span> <span class="predefined-type">SortedSet</span>&lt;ToDoItem&gt; getDependencies() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>inherit from <code>CollectionDomainEvent&lt;T,E&gt;</code> where <code>T</code> is the type of the domain object being interacted with, and <code>E</code> is the type of the element in the collection (both <code>ToDoItem</code> in this example)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>constructor called reflectively by the framework</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>populated with the object being interacted with (the source of the event)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>identifier of the collection</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>indicates if the collection is being accessed, added to or removed from.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>the element being added or removed from the collection</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The benefit is that subscribers can be more targetted as to the events that they subscribe to.</p>
</div>
<div class="sect4">
<h5 id="_subscribers_2">Subscribers</h5>
<div class="paragraph">
<p>Subscribers (which must be domain services) subscribe using either the <a href="https://github.com/google/guava">Guava</a> API or (if the <a href="#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a> has been appropriately configured) using the <a href="http://www.axonframework.org/">Axon Framework</a> API.  The examples below use the Guava API.</p>
</div>
<div class="paragraph">
<p>Subscribers can be either coarse-grained (if they subscribe to the top-level event type):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeSubscriber</span> {
    <span class="annotation">@Programmatic</span>
    <span class="annotation">@com</span>.google.common.eventbus.Subscribe
    <span class="directive">public</span> <span class="type">void</span> on(CollectionInteractionEvent ev) {
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or can be fine-grained (by subscribing to specific event subtypes):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeSubscriber</span> {
    <span class="annotation">@Programmatic</span>
    <span class="annotation">@com</span>.google.common.eventbus.Subscribe
    <span class="directive">public</span> <span class="type">void</span> on(ToDoItem.DependenciesChangedEvent ev) {
        ...
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the AxonFramework is being used, replace <code>@com.google.common.eventbus.Subscribe</code> with <code>@org.axonframework.eventhandling.annotation.EventHandler</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The subscriber&#8217;s method is called (up to) 5 times:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>whether to veto visibility (hide)</p>
</li>
<li>
<p>whether to veto usability (disable)</p>
</li>
<li>
<p>whether to veto execution (validate) the element being added to/removed from the collection</p>
</li>
<li>
<p>steps to perform prior to the collection being added to/removed from</p>
</li>
<li>
<p>steps to perform after the collection has been added to/removed from.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The subscriber can distinguish these by calling <code>ev.getPhase()</code>. Thus the general form is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Programmatic</span>
<span class="annotation">@com</span>.google.common.eventbus.Subscribe
<span class="directive">public</span> <span class="type">void</span> on(CollectionDomainEvent ev) {
    <span class="keyword">switch</span>(ev.getPhase()) {
        <span class="keyword">case</span> HIDE:
            <span class="comment">// call ev.hide() or ev.veto(&quot;&quot;) to hide the collection</span>
            <span class="keyword">break</span>;
        <span class="keyword">case</span> DISABLE:
            <span class="comment">// call ev.disable(&quot;...&quot;) or ev.veto(&quot;...&quot;) to disable the collection</span>
            <span class="keyword">break</span>;
        <span class="keyword">case</span> VALIDATE:
            <span class="comment">// call ev.invalidate(&quot;...&quot;) or ev.veto(&quot;...&quot;)</span>
            <span class="comment">// if object being added/removed to collection is invalid</span>
            <span class="keyword">break</span>;
        <span class="keyword">case</span> EXECUTING:
            <span class="keyword">break</span>;
        <span class="keyword">case</span> EXECUTED:
            <span class="keyword">break</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to abort the transaction during the executing or executed phases by throwing an exception. If the exception is a subtype of <code>RecoverableException</code> then the exception will be rendered as a user-friendly warning (eg Growl/toast) rather than an error.</p>
</div>
</div>
<div class="sect4">
<h5 id="_raising_events_programmatically_2">Raising events programmatically</h5>
<div class="paragraph">
<p>Normally events are only raised for interactions through the UI. However, events can be raised programmatically either by calling the <a href="#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a> API directly, or by emulating the UI by
wrapping the target object using the <a href="#_rg_services-api_manpage-WrapperFactory"><code>WrapperFactory</code></a> domain service.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Collection_editing">2.4.2. <code>editing()</code></h4>
<div class="paragraph">
<p>The <code>editing()</code> annotation indicates whether a collection can be added to or removed from within the UI.  This attribute can also be specified for <a href="#_rg_annotations_manpage-Property_editing">properties</a>, and can also be specified for the <a href="#_rg_annotations_manpage-DomainObject_editing">domain object</a></p>
</div>
<div class="paragraph">
<p>The related <code>editingDisabledReason()</code> attribute specifies the a hard-coded reason why the collection cannot be modified directly.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> does <strong>not</strong> currently support the modification of collections; they are rendered read-only.</p>
</div>
<div class="paragraph">
<p>The workaround is to create add/remove actions and use <a href="#_rg_annotations_manpage-MemberOrder">UI hints</a> to render them close to the collection.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Whether a collection is enabled or disabled depends upon these factors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>whether the domain object has been configured as immutable through the <a href="#_rg_annotations_manpage-DomainObject_editing"><code>@DomainObject#editing()</code></a> attribute</p>
</li>
<li>
<p>else (that is, if the domain object&#8217;s editability is specified as being <code>AS_CONFIGURED</code>), then the value of the <a href="#_rg_runtime_configuring-core">configuration property</a> <code>isis.objects.editing</code>.  If set to <code>false</code>, then the object&#8217;s collections (and properties) are <strong>not</strong> editable</p>
</li>
<li>
<p>else, then the value of the <code>@Collection(editing=&#8230;&#8203;)</code> attribute itself.</p>
</li>
<li>
<p>else, the result of invoking any supporting <a href="#_rg_methods_prefixes_manpage-disable"><code>disable&#8230;&#8203;()</code></a> supporting methods</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Thus, to make a collection read-only even if the object would otherwise be editable, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    <span class="annotation">@Collection</span>(
        editing=Editing.DISABLED,
        editingDisabledReason=<span class="string"><span class="delimiter">&quot;</span><span class="content">Use the add and remove actions to modify</span><span class="delimiter">&quot;</span></span>
    )
    <span class="directive">public</span> <span class="predefined-type">SortedSet</span>&lt;ToDoItem&gt; getDependencies() { ... }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To reiterate, it is <em>not</em> possible to enable editing for a collection if editing has been disabled at the object-level.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Collection_hidden">2.4.3. <code>hidden()</code></h4>
<div class="paragraph">
<p>Collections can be hidden at the domain-level, indicating that they are not visible to the end-user.  This attribute can also be applied to <a href="#_rg_annotations_manpage-Action_hidden">actions</a> and <a href="#_rg_annotations_manpage-Property_hidden">properties</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is also possible to use <a href="#_rg_annotations_manpage-CollectionLayout_hidden"><code>@CollectionLayout#hidden()</code></a> or <a href="#_rg_object-layout_dynamic">dynamic layouts</a> such that the collection can be hidden at the view layer. Both options are provided with a view that in the future the view-layer semantics may be under the control of (expert) users, whereas domain-layer semantics should never be overridden or modified by the user.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@Collection</span>(where=Where.EVERYWHERE)
    <span class="directive">public</span> <span class="predefined-type">SortedSet</span>&lt;Address&gt; getAddresses() { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The acceptable values for the <code>where</code> parameter are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Where.EVERYWHERE</code> or <code>Where.ANYWHERE</code><br></p>
<div class="paragraph">
<p>The collection should be hidden everywhere.</p>
</div>
</li>
<li>
<p><code>Where.ANYWHERE</code><br></p>
<div class="paragraph">
<p>Synonym for everywhere.</p>
</div>
</li>
<li>
<p><code>Where.OBJECT_FORMS</code><br></p>
<div class="paragraph">
<p>The collection should be hidden when displayed within an object form.</p>
</div>
</li>
<li>
<p><code>Where.NOWHERE</code><br></p>
<div class="paragraph">
<p>The collection should not be hidden.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The other values of the <code>Where</code> enum have no meaning for a collection.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> suppresses collections when displaying lists of objects.</p>
</div>
<div class="paragraph">
<p>The <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a> by default suppress collections when rendering a domain object.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Collection_notPersisted">2.4.4. <code>notPersisted()</code></h4>
<div class="paragraph">
<p>The (somewhat misnamed) <code>notPersisted()</code> attribute indicates that the collection should be excluded from any snapshots generated by the <a href="#_rg_services-api_manpage-XmlSnapshotService"><code>XmlSnapshotService</code></a>.  This attribute is also supported for <a href="#_rg_annotations_manpage-Property_notPersisted">properties</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This annotation does <em>not</em> specify that a collection is not persisted in the JDO/DataNucleus objectstore.  See below for details as to how to additionally annotate the collection for this.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@Collection</span>(notPersisted=<span class="predefined-constant">true</span>)
    <span class="directive">public</span> <span class="predefined-type">SortedSet</span>&lt;Order&gt; getPreviousOrders() {...}
    <span class="directive">public</span> <span class="type">void</span> setPreviousOrder(<span class="predefined-type">SortedSet</span>&lt;Order&gt; previousOrders) {...}
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Historically this annotation also hinted as to whether the collection&#8217;s contents should be persisted in the object store.  However, the JDO/DataNucleus objectstore does not recognize this annotation.  Thus, to ensure that a collection is actually not persisted, it should <strong>also</strong> be annotated with <code>@javax.jdo.annotations.NotPersistent</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@Collection</span>(notPersisted=<span class="predefined-constant">true</span>)             <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@javax</span>.jdo.annotations.NotPersistent       <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> <span class="predefined-type">SortedSet</span>&lt;Order&gt; getPreviousOrders() {...}
    <span class="directive">public</span> <span class="type">void</span> setPreviousOrder(<span class="predefined-type">SortedSet</span>&lt;Order&gt; previousOrders) {...}
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>ignored by Apache Isis</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>ignored by JDO/DataNucleus</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, if the collection is derived, then providing only a "getter" will also work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">public</span> <span class="predefined-type">SortedSet</span>&lt;Order&gt; getPreviousOrders() {...}
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Collection_typeOf">2.4.5. <code>typeOf()</code></h4>
<div class="paragraph">
<p>The <code>typeOf()</code> attribute specifies the expected type of an element contained within a collection when for whatever reason the type cannot be inferred from the generic type, or to provide a hint about the actual run-time (as opposed to compile-time) type.  This attribute can also be specified for <a href="#_rg_annotations_manpage-Action_typeOf">actions</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> Customer {
    <span class="annotation">@TypeOf</span>(Order.class)
    <span class="directive">public</span> <span class="predefined-type">SortedSet</span> getOutstandingOrders() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In general we recommend that you use generics instead, eg <code>SortedSet&lt;Order&gt;</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Unresolved directive in _rg_annotations.adoc - include::_rg_annotations_manpage-Collectionlayout.adoc[leveloffset=+1]
:leveloffset: +1</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rg_annotations_manpage-Column">3. <code>@Column</code> (<code>javax.jdo</code>)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The JDO <code>@javax.jdo.annotation.Column</code> provides metadata describing how JDO/DataNucleus should persist the property to a database RDBMS table column (or equivalent concept for other persistence stores).</p>
</div>
<div class="paragraph">
<p>Apache Isis also parses and interprets this annotation in order to build up aspects of its metamodel.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Isis parses the <code>@Column</code> annotation from the Java source code; it does not query the JDO metamodel.  This means that it the <code>@Column</code> annotation must be used rather than the equivalent <code>&lt;column&gt;</code> <a href="http://www.datanucleus.org/products/accessplatform_4_0/jdo/orm/schema_mapping.html">XML metadata</a>.</p>
</div>
<div class="paragraph">
<p>Moreover, while JDO/DataNucleus will recognize annotations on either the field or the getter method, Apache Isis (currently) only inspects the getter method.  Therefore ensure that the annotation is placed there.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This section identifies which attributes of <code>@Column</code> are recognized and used by Apache Isis.</p>
</div>
<div class="sect2">
<h3 id="_nullability">3.1. Nullability</h3>
<div class="paragraph">
<p>The <code>allowsNull()</code> attribute is used to specify if a property is mandatory or is optional.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@javax</span>.jdo.annotations.Column(allowNulls=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getMiddleInitial() { ... }
    <span class="directive">public</span> <span class="type">void</span> setMiddleInitial(<span class="predefined-type">String</span> middleInitial) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Isis also provides <a href="#_rg_annotations_manpage-Property_optionality"><code>@Property#optionality()</code></a> attribute.  If both are specified, Apache Isis will check when it initializes for any contradictions, and will fail-fast with an appropriate error message in the log if there are.</p>
</div>
<div class="paragraph">
<p>You should also be aware that in the lack of either the <code>@Column#allowsNull()</code> or the <code>@Property#optionality()</code> attributes, that the JDO and Apache Isis defaults differ.  Apache Isis rule is straight-forward: properties are assumed to be required.  JDO on the other hand specifies that only primitive types are mandatory; everything else is assumed to be optional.  Therefore a lack of either annotation can also trigger the fail-fast validation check.</p>
</div>
<div class="paragraph">
<p>In the vast majority of cases you should be fine just to add the <code>@Column#allowsNull()</code> attribute to the getter.  But see the documentation for <a href="#_rg_annotations_manpage-Property_optionality"><code>@Property#optionality()</code></a> attribute for discussion on one or two minor edge cases.</p>
</div>
</div>
<div class="sect2">
<h3 id="_length_for_code_string_code_s">3.2. Length for <code>String</code>s</h3>
<div class="paragraph">
<p>The <code>length()</code> attribute is used to specify the length of <code>java.lang.String</code> property types as they map to <code>varchar(n)</code> columns.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@javax</span>.jdo.annotations.Column(length=<span class="integer">20</span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getFirstName() { ... }
    <span class="directive">public</span> <span class="type">void</span> setFirstName(<span class="predefined-type">String</span> firstName) { ... }
    <span class="annotation">@javax</span>.jdo.annotations.Column(allowNulls=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>, length=<span class="integer">1</span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getMiddleInitial() { ... }
    <span class="directive">public</span> <span class="type">void</span> setMiddleInitial(<span class="predefined-type">String</span> middleInitial) { ... }
    <span class="annotation">@javax</span>.jdo.annotations.Column(length=<span class="integer">30</span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getLastName() { ... }
    <span class="directive">public</span> <span class="type">void</span> setLastName(<span class="predefined-type">String</span> lastName) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Isis also provides <a href="#_rg_annotations_manpage-Property_maxLength"><code>@Property#maxLength()</code></a> attribute.  If both are specified, Apache Isis will check when it initializes for any contradictions, and will fail-fast with an appropriate error message in the log if there are.</p>
</div>
</div>
<div class="sect2">
<h3 id="_length_scale_for_code_bigdecimal_code_s">3.3. Length/scale for <code>BigDecimal</code>s</h3>
<div class="paragraph">
<p>The <code>length()</code> and <code>scale()</code> attributes are used to infer the precision/scale of <code>java.math.BigDecimal</code> property types as they map to <code>decimal(n,p)</code> columns.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@javax</span>.jdo.annotations.Column(length=<span class="integer">10</span>, scale=<span class="integer">2</span>)
    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> getTotalOrdersToDate() { ... }
    <span class="directive">public</span> <span class="type">void</span> setTotalOrdersToDate(<span class="predefined-type">BigDecimal</span> totalOrdersToDate) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <code>BigDecimal</code>s it is also possible to specify the <a href="#<em>rg_annotations_manpage-Digits"><code>@Digits</code></a> annotation, whose form is <code>@Digits(integer, fraction)</code>.  There is a subtle difference here: while <code>@Column#scale()</code> corresponds to <code>@Digits#fraction()</code>, the value of <code>@Column#length()</code> (ie the precision) is actually the _sum</em> of the <code>@Digits&#8217; `integer()</code> and <code>fraction()</code> parts.</p>
</div>
<div class="paragraph">
<p>If both are specified, Apache Isis will check when it initializes for any contradictions, and will fail-fast with an appropriate error message in the log if there are.</p>
</div>
</div>
<div class="sect2">
<h3 id="_hints_and_tips">3.4. Hints and Tips</h3>
<div class="paragraph">
<p>This seems to be a good place to describe some additional common mappings that use <code>@Column</code>.  Unlike the sections above, the attributes specified in these hints and tips aren&#8217;t actually part of Apache Isis metamodel.</p>
</div>
<div class="sect3">
<h4 id="_mapping_foreign_keys">3.4.1. Mapping foreign keys</h4>
<div class="paragraph">
<p>The <code>name()</code> attribute can be used to override the name of the column.  References to other objects are generally mapped as foreign key columns.  If there are multiple references to a given type, then you will want to override the name that JDO/DataNucleus would otherwise default.</p>
</div>
<div class="paragraph">
<p>For example (taken from <a href="http://github.com/estatio/estatio">estatio</a> app):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">PartyRelationship</span> {
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">fromPartyId</span><span class="delimiter">&quot;</span></span>, allowsNull = <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Party getFrom() { ... }
    <span class="directive">public</span> <span class="type">void</span> setFrom(Party from) { ... }
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">toPartyId</span><span class="delimiter">&quot;</span></span>, allowsNull = <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Party getTo() { ... }
    <span class="directive">public</span> <span class="type">void</span> setTo(Party to) { ... }
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mapping_code_blob_code_s_and_code_clob_code_s">3.5. Mapping <code>Blob</code>s and <code>Clob</code>s</h3>
<div class="paragraph">
<p>Isis provides custom value types for <a href="#_rg_classes_value-types_manpage-Blob"><code>Blob</code></a>s and <a href="#_rg_classes_value-types_manpage-Clob"><code>Clob</code></a>s.  These value types have multiple internal fields, meaning that they corresponding to multiple columns in the database.  Mapping this correctly requires using  <code>@Column</code> within JDO&#8217;s <code>@Persistent</code> annotation.</p>
</div>
<div class="paragraph">
<p>For example, here&#8217;s how to map a <code>Blob</code> (taken from (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="predefined-type">Blob</span> attachment;
<span class="annotation">@javax</span>.jdo.annotations.Persistent(defaultFetchGroup=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>, columns = {
        <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_name</span><span class="delimiter">&quot;</span></span>),
        <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_mimetype</span><span class="delimiter">&quot;</span></span>),
        <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_bytes</span><span class="delimiter">&quot;</span></span>, jdbcType = <span class="string"><span class="delimiter">&quot;</span><span class="content">BLOB</span><span class="delimiter">&quot;</span></span>, sqlType = <span class="string"><span class="delimiter">&quot;</span><span class="content">LONGVARBINARY</span><span class="delimiter">&quot;</span></span>)
})
<span class="annotation">@Property</span>(
        domainEvent = AttachmentDomainEvent.class,
        optionality = Optionality.OPTIONAL
)
<span class="directive">public</span> <span class="predefined-type">Blob</span> getAttachment() { ... }
<span class="directive">public</span> <span class="type">void</span> setAttachment(<span class="predefined-type">Blob</span> attachment) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here&#8217;s how to map a <code>Clob</code> (also taken from the todoapp):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="predefined-type">Clob</span> doc;
<span class="annotation">@javax</span>.jdo.annotations.Persistent(defaultFetchGroup=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>, columns = {
        <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">doc_name</span><span class="delimiter">&quot;</span></span>),
        <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">doc_mimetype</span><span class="delimiter">&quot;</span></span>),
        <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">doc_chars</span><span class="delimiter">&quot;</span></span>, jdbcType = <span class="string"><span class="delimiter">&quot;</span><span class="content">CLOB</span><span class="delimiter">&quot;</span></span>, sqlType = <span class="string"><span class="delimiter">&quot;</span><span class="content">LONGVARCHAR</span><span class="delimiter">&quot;</span></span>)
})
<span class="annotation">@Property</span>(
        optionality = Optionality.OPTIONAL
)
<span class="directive">public</span> <span class="predefined-type">Clob</span> getDoc() { ... }
<span class="directive">public</span> <span class="type">void</span> setDoc(<span class="directive">final</span> <span class="predefined-type">Clob</span> doc) { ... }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-Digits">3.6. <code>@Digits</code> (<code>javax</code>)</h3>
<div class="paragraph">
<p>The <code>@javax.validation.constraints.Digits</code> annotation is recognized by Apache Isis as a means to specify the precision for properties and action parameters of type <code>java.math.BigDecimal</code>.</p>
</div>
<div class="paragraph">
<p>For example (taken from the (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Column(
    scale=<span class="integer">2</span>                                              <i class="conum" data-value="1"></i><b>(1)</b>
)
<span class="annotation">@javax</span>.validation.constraints.Digits(
    integer=<span class="integer">10</span>,
    fraction=<span class="integer">2</span>                                           <i class="conum" data-value="2"></i><b>(2)</b>
)
<span class="directive">public</span> <span class="predefined-type">BigDecimal</span> getCost() {
    <span class="keyword">return</span> cost;
}
<span class="directive">public</span> <span class="type">void</span> setCost(<span class="directive">final</span> <span class="predefined-type">BigDecimal</span> cost) {
    <span class="local-variable">this</span>.cost = cost!=<span class="predefined-constant">null</span>
        ? cost.setScale(<span class="integer">2</span>, <span class="predefined-type">BigDecimal</span>.ROUND_HALF_EVEN)   <i class="conum" data-value="3"></i><b>(3)</b>
        :<span class="predefined-constant">null</span>;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <a href="#_rg_annotations_manpage-Column"><code>@Column#scale()</code></a> attribute must be &#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>&#8230;&#8203; consistent with <code>@Digits#fraction()</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the correct idiom when setting a new value is to normalized to the correct scale</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-Discriminator">3.7. <code>@Discriminator</code> (<code>javax.jdo</code>)</h3>
<div class="paragraph">
<p>The <code>@javax.jdo.annotation.Discriminator</code> is used by JDO/DataNucleus to specify how to discriminate between subclasses of an inheritance hierarchy.</p>
</div>
<div class="paragraph">
<p>It is valid to add a <code>@Discriminator</code> for any class, even those not part of an explicitly mapped inheritance hierarchy.  Apache Isis also checks for this annotation, and if present will use the <code>@Discriminator#value()</code> as the object type, a unique alias for the object&#8217;s class name.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Isis parses the <code>@Discriminator</code> annotation from the Java source code; it does not query the JDO metamodel.  This means that it the <code>@Discriminator</code> annotation must be used rather than the equivalent <code>&lt;discriminator&gt;</code> <a href="http://www.datanucleus.org/products/accessplatform_4_0/jdo/orm/inheritance.html">XML metadata</a>.</p>
</div>
<div class="paragraph">
<p>Moreover, while JDO/DataNucleus will recognize annotations on either the field or the getter method, Apache Isis (currently) only inspects the getter method.  Therefore ensure that the annotation is placed there.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The object type is used internally by Apache Isis to generate a string representation of an objects identity (the <code>Oid</code>).  This can appear in several contexts, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>as the value of <code>o.a.i.applib.services.bookmark.Bookmark#getObjectType()</code></p>
</li>
<li>
<p>in the <code>toString()</code> value of <code>Bookmark</code></p>
</li>
<li>
<p>in the URLs of the <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a></p>
</li>
<li>
<p>in the URLs of the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> (in general and in particular if <a href="ug.html#_ug_wicket-viewer_features_hints-and-copy-url">copying URLs</a>)</p>
</li>
<li>
<p>in XML snapshots generated by the <a href="#_rg_services-api_manpage-XmlSnapshotService"><code>XmlSnapshotService</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Discriminator(value=<span class="string"><span class="delimiter">&quot;</span><span class="content">custmgmt.Customer</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>has an object type of <code>custmgmt.Customer</code>.</p>
</div>
<div class="paragraph">
<p>If the object type has not been specified, then Apache Isis will use the fully qualified class name of the entity.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This might be obvious, but to make explicit: we recommend that you use namespaces of some form or other.</p>
</div>
<div class="paragraph">
<p>If the object type has not been specified (by either this annotation, or by <a href="#_rg_annotations_manpage-PersistenceCapable"><code>@PersistenceCapable</code></a>, or by Apache Isis' own <a href="#_rg_annotations_manpage-DomainObject_objectType"><code>@DomainObject#objectType()</code></a> annotation/attribute), then (as noted above) Apache Isis will use the fully qualified class name of the entity.</p>
</div>
<div class="paragraph">
<p>However, chances are that the fully qualified class name is liable to change over time, for example if the code is refactored or (more fundamentally) if your company/organization reorganizes/renames itself/is acquired.</p>
</div>
<div class="paragraph">
<p>We therefore strongly recommend that you specify an object type for all entities, one way or another.  Specifying <code>@Discriminator</code> will override <code>@PersistenceCapable</code>, which overrides <code>@DomainObject#objectType()</code>.  Using <code>@PersistenceCapable#schema()</code> is probably the best choice in most cases.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the object type is not unique across all domain classes then the framework will fail-fast and fail to boot.  An error message will be printed in the log to help you determine which classes have duplicate object tyoes.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-DomainObject">3.8. <code>@DomainObject</code></h3>
<div class="paragraph">
<p>The <code>@DomainObject</code> annotation applies to domain objects, collecting together all domain semantics within a single annotation.</p>
</div>
<div class="paragraph">
<p>The table below summarizes the annotation&#8217;s attributes.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 11. <code>@DomainObject</code> attributes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Values (default)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainObject_auditing"><code>auditing()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AS_CONFIGURED</code>, <code>ENABLED</code>, <code>DISABLED</code><br>
(<code>AS_CONFIGURED</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>indicates whether each of the changed properties of an object should be submitted to the registered <a href="#_rg_services-spi_manpage-AuditingService"><code>AuditingService</code></a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainObject_autoCompleteRepository"><code>autoCompleteRepository()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain service class</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>nominate a method on a domain service to be used for looking up instances of the domain object</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>autoCompleteAction()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method name<br>
(<code>autoComplete()</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>override the method name to use on the auto-complete repository</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainObject_bounded"><code>bounded()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code><br>
(<code>false</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Whether the number of instances of this domain class is relatively small (a "bounded" set), such that instances could be selected from a drop-down list box or similar.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainObject_editing"><code>editing()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AS_CONFIGURED</code>, <code>ENABLED</code>, <code>DISABLED</code><br>
(<code>AS_CONFIGURED</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>whether the object&#8217;s properties and collections can be edited or not (ie whether the instance should be considered to be immutable)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainObject_nature"><code>nature()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOT_SPECIFIED</code>, <code>JDO_ENTITY</code>, <code>EXTERNAL_ENTITY</code>, <code>INMEMORY_ENTITY</code>, <code>VIEW_MODEL</code> (<code>NOT_SPECIFIED</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>whether the domain object logically is an entity (part of the domain layer) or is a view model (part of the application layer); and if an entity, how is its persistence managed</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainObject_objectType"><code>objectType()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(none, which implies fully qualified class name)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>specify an alias for the domain class used to uniquely identify the object both within the Apache Isis runtime and externally</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainObject_publishing"><code>publishing()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AS_CONFIGURED</code>, <code>ENABLED</code>, <code>DISABLED</code><br>
(<code>AS_CONFIGURED</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>whether changes to the object should be published to the registered <a href="#_rg_services-spi_manpage-PublishingService"><code>PublishingService</code></a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>publishing-</code><br>
<code>PayloadFactory()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">subtype of <code>PublishingPayloadFactory-</code> <code>ForObject</code> (none)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>specifies that a custom implementation of <code>PublishingPayloadFactoryForObject</code> be used to create the (payload of the) published event representing the change to the object</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObject</span>(
    auditing=Auditing.ENABLED,
    autoCompleteRepository=CustomerRepository.class
    editing=Editing.ENABLED,               <i class="conum" data-value="1"></i><b>(1)</b>
    publishing=Publishing.ENABLED
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>default value, so could be omitted</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-DomainObject_auditing">3.8.1. <code>auditing()</code></h4>
<div class="paragraph">
<p>The <code>auditing()</code> attribute indicates that if the object is modified, then each of its changed properties should be submitted to the <a href="#_rg_services-spi_manpage-AuditingService"><code>AuditingService</code></a>, if one has been configured.</p>
</div>
<div class="paragraph">
<p>The default value for the attribute is <code>AS_CONFIGURED</code>, meaning that the <a href="#_rg_runtime_configuring-core">configuration property</a> <code>isis.services.audit.objects</code> is used to determine the whether the action is published:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>all</code><br></p>
<div class="paragraph">
<p>all changed objects are published</p>
</div>
</li>
<li>
<p><code>none</code><br></p>
<div class="paragraph">
<p>no changed objects are published</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If there is no configuration property in <code>isis.properties</code> then auditing is automatically enabled for domain objects.</p>
</div>
<div class="paragraph">
<p>This default can be overridden on an object-by-object basis; if <code>auditing()</code> is set to <code>ENABLED</code> then changed properties of instances of the domain class are audited irrespective of the configured value; if set to <code>DISABLED</code> then the changed properties of instances are <em>not</em> audited, again irrespective of the configured value.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObject</span>(
    auditing=Auditing.ENABLED  <i class="conum" data-value="1"></i><b>(1)</b>
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>because set to enabled, will be audited irrespective of the configured value.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-DomainObject_autoCompleteRepository">3.8.2. <code>autoCompleteRepository()</code></h4>
<div class="paragraph">
<p>The <code>autoCompleteRepository()</code> attribute nominates a single method on a domain service as the fallback means for lookuping up instances of the domain object using a simple string.</p>
</div>
<div class="paragraph">
<p>For example, this might search for a customer by their name or number.  Or it could search for a country based on its ISO-3 code or user-friendly name.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you require additional control - for example restricting the returned results based on the object being interacted with - then use the <a href="#_rg_methods_prefixes_manpage-autoComplete"><code>autoComplete&#8230;&#8203;()</code></a> supporting method instead.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@AutoComplete</span>(
    autoCompleteRepository=Customers.class
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> <span class="directive">extends</span> AbstractDomainObject {
   ....
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Customers</span> {
    <span class="annotation">@Programmatic</span>                                <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="predefined-type">List</span>&lt;Customer&gt; autoComplete(<span class="predefined-type">String</span> search);  <i class="conum" data-value="2"></i><b>(2)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>do not expose in the UI</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>is assumed to be called "autoComplete", and accepts a single string</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="__code_autocompleteaction_code"><code>autoCompleteAction()</code></h5>
<div class="paragraph">
<p>As noted above, by default the method invoked on the repository is assumed to be called "autoComplete".  The optional <code>autoCompleteAction()</code> attribute allows the method on the repository to be overridden.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@AutoComplete</span>(
    autoCompleteRepository=Customers.class,
    autoCompleteAction=<span class="string"><span class="delimiter">&quot;</span><span class="content">findByCustomerName</span><span class="delimiter">&quot;</span></span>
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> <span class="directive">extends</span> AbstractDomainObject {
   ....
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where in this case <code>findByCustomerName</code> might be an existing method already defined:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Customers</span> {
    <span class="annotation">@Action</span>(semantics=SemanticsOf.SAFE)
    <span class="predefined-type">List</span>&lt;Customer&gt; findByCustomerName(<span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name);
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-DomainObject_bounded">3.8.3. <code>bounded()</code></h4>
<div class="paragraph">
<p>Some domain classes are immutable to the user, and moreover have only a fixed number of instances.  Often these are "reference" ("standing") data, or lookup data/pick lists.  Typical examples could include categories, countries, states, and tax or interest rate tables.</p>
</div>
<div class="paragraph">
<p>Where the number of instances is relatively small, ie bounded, then the <code>bounded()</code> attribute can be used as a hint.  For such domain objects the framework will automatically allow instances to be selected; <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> displays these as a drop-down list.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObject</span>(
    bounded=<span class="predefined-constant">true</span>,
    editing=Editing.DISABLED  <i class="conum" data-value="1"></i><b>(1)</b>
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Currency</span> {
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This attribute is commonly combined with <code>editing=DISABLED</code> to enforce the fact that reference data is immutable</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There is nothing to prevent you from using this attribute for regular mutable entities, and indeed this is sometimes worth doing during early prototyping.  However, if there is no realistic upper bound to the number of instances of an entity that might be created, generally you should use <a href="#_rg_methods_prefixes_manpage-autoComplete"><code>autoComplete&#8230;&#8203;()</code></a> supporting method or the <a href="#_rg_annotations_manpage-DomainObject_autoCompleteRepository"><code>@DomainObject#autoCompleteRepository()</code></a> attribute instead.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-DomainObject_editing">3.8.4. <code>editing()</code></h4>
<div class="paragraph">
<p>The <code>editing()</code> attribute determines whether a domain object&#8217;s properties and collections are not editable (are read-only).</p>
</div>
<div class="paragraph">
<p>The default is <code>AS_CONFIGURED</code>, meaning that the <a href="#_rg_runtime_configuring-core">configuration property</a> <code>isis.objects.editing</code> is used to determine the whether the object is modifiable:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>true</code><br></p>
<div class="paragraph">
<p>the object&#8217;s properties and collections are modifiable.</p>
</div>
</li>
<li>
<p><code>false</code><br></p>
<div class="paragraph">
<p>the object&#8217;s properties and collections are read-only, ie <em>not</em> modifiable.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If there is no configuration property in <code>isis.properties</code> then object are assumed to be modifiable.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In other words, editing can be disabled globally for an application by setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.objects.editing=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>We recommend enabling this feature; it will help drive out the underlying business operations (processes and procedures) that require objects to change; these can then be captured as business actions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The related <code>editingDisabledReason()</code> attribute specifies the a hard-coded reason why the object&#8217;s properties and collections cannot be modified directly.</p>
</div>
<div class="paragraph">
<p>This default can be overridden on an object-by-object basis; if <code>editing()</code> is set to <code>ENABLED</code> then the object&#8217;s properties and collections are editable irrespective of the configured value; if set to <code>DISABLED</code> then the object&#8217;s properties and collections are not editable irrespective of the configured value.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObject</span>(
    editing=Editing.DISABLED,
    editingDisabledReason=<span class="string"><span class="delimiter">&quot;</span><span class="content">Reference data, so cannot be modified</span><span class="delimiter">&quot;</span></span>
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Country</span> {
    ...
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Another interesting example of immutable reference data is to define an entity to represent individual dates; after all, for a system with an expected lifetime of 20 years that equates to only 7,300 days, a comparatively tiny number of rows to hold in a database.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-DomainObject_nature">3.8.5. <code>nature()</code></h4>
<div class="paragraph">
<p>The <code>nature()</code> attribute is used to characterize the domain object as either an entity (part of the domain layer) or as a view model (part of the application layer).  If the domain object should be thought of as an entity, it also captures how the persistence of that entity is managed.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObject</span>(nature=Nature.VIEW_MODEL)
<span class="directive">public</span> <span class="type">class</span> <span class="class">PieChartAnalysis</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Specifically, the nature must be one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NOT_SPECIFIED,</code><br></p>
<div class="paragraph">
<p>(the default); specifies no paricular semantics for the domain class.</p>
</div>
</li>
<li>
<p><code>JDO_ENTITY</code><br></p>
<div class="paragraph">
<p>indicates that the domain object is an entity whose persistence is managed internally by Apache Isis, using the JDO/DataNucleus objectstore.</p>
</div>
</li>
<li>
<p><code>EXTERNAL_ENTITY</code><br></p>
<div class="paragraph">
<p>indicates that the domain objecct is a wrapper/proxy/stub (choose your term) to an entity that is managed by some related external system.  For example, the domain object may hold just the URI to a RESTful resource of some third party REST service, or the id of some system accessible over SOAP.<br></p>
</div>
<div class="paragraph">
<p>The identity of an external entity is determined solely by the state of entity&#8217;s properties.  The framework will automatically recreate the domain object each time it is interacted with.</p>
</div>
</li>
<li>
<p><code>INMEMORY_ENTITY</code><br></p>
<div class="paragraph">
<p>indicates that the domain object is a wrapper/proxy/stub to a "synthetic" entity, for example one that is constructed from some sort of internal memory data structure.<br></p>
</div>
<div class="paragraph">
<p>The identity of an inmemory entity is determined solely by the state of entity&#8217;s properties.  The framework will automatically recreate the domain object each time it is interacted with.</p>
</div>
</li>
<li>
<p><code>VIEW_MODEL</code><br></p>
<div class="paragraph">
<p>indicates that the domain object is conceptually part of the application layer, and exists to surfaces behaviour and/or state that is aggregate of one or more domain entities.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The identity of an inmemory entity is determined solely by the state of entity&#8217;s properties.  The framework will automatically recreate the domain object each time it is interacted with.</p>
</div>
<div class="paragraph">
<p>Those natures that indicate the domain object is an entity (of some sort or another) mean then that the domain object is considered to be part of the domain model layer.  As such the domain object&#8217;s class cannot be annotated with <a href="#_rg_annotations_manpage-ViewModel"><code>@ViewModel</code></a> or implement the <a href="#_rg_classes_super_manpage-ViewModel"><code>ViewModel</code></a> interface.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Under the covers Apache Isis' support for <code>VIEW_MODEL</code>, <code>EXTERNAL_ENTITY</code> and <code>INMEMORY_ENTITY</code> domain objects is identical; the state of the object is encoded into its internal OID (represented ultimately as its URL), and is recreated directly from that URL.</p>
</div>
<div class="paragraph">
<p>Because this particular implementation was originally added to Apache Isis in support of view models, the term was also used for the logically different external entities and inmemory entities.</p>
</div>
<div class="paragraph">
<p>The benefit of <code>nature()</code> is that it allows the developer to properly characterize the layer (domain vs application) that an entity lives, thus avoiding confusion as "view model" (the implementation technique) and "view model" (the application layer concept).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-DomainObject_objectType">3.8.6. <code>objectType()</code></h4>
<div class="paragraph">
<p>The <code>objectType()</code> attribute is used to provide a unique alias for the object&#8217;s class name.</p>
</div>
<div class="paragraph">
<p>This value is used internally to generate a string representation of an objects identity (the <code>Oid</code>).  This can appear in several contexts, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>as the value of <code>o.a.i.applib.services.bookmark.Bookmark#getObjectType()</code></p>
</li>
<li>
<p>in the <code>toString()</code> value of <code>Bookmark</code></p>
</li>
<li>
<p>in the URLs of the <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a></p>
</li>
<li>
<p>in the URLs of the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> (in general and in particular if <a href="ug.html#_ug_wicket-viewer_features_hints-and-copy-url">copying URLs</a>)</p>
</li>
<li>
<p>in XML snapshots generated by the <a href="#_rg_services-api_manpage-XmlSnapshotService"><code>XmlSnapshotService</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObject</span>(
    objectType=<span class="string"><span class="delimiter">&quot;</span><span class="content">ORD</span><span class="delimiter">&quot;</span></span>
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Order</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the object type has not been specified, then Apache Isis will use the fully qualified class name of the entity.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This might be obvious, but to make explicit: we recommend that you use namespaces of some form or other for object types.</p>
</div>
<div class="paragraph">
<p>As noted above, if the object type has not been specified, then Apache Isis will use the fully qualified class name of the entity.  However, this is liable to change over time, for example if the code is refactored or (more fundamentally) if your company/organization reorganizes/renames itself/is acquired.</p>
</div>
<div class="paragraph">
<p>We therefore strongly recommend that you specify an object type for all entities, either using <code>objectType()</code> or using the JDO <a href="#_rg_annotations_manpage-PersistenceCapable"><code>@PersistenceCapable</code></a> (with a <code>schema()</code> attribute) or <a href="#_rg_annotations_manpage-Discriminator"><code>@Discriminator</code></a> annotations.  Specifying <code>@Discriminator</code> will override <code>@PersistenceCapable</code>, which in turn overrides <code>objectType()</code>.  Using <code>@PersistenceCapable#schema()</code> is probably the best choice in most cases.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the object type is not unique across all domain classes then the framework will fail-fast and fail to boot.  An error message will be printed in the log to help you determine which classes have duplicate object tyoes.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-DomainObject_publishing">3.8.7. <code>publishing()</code></h4>
<div class="paragraph">
<p>The <code>publishing()</code> attribute determines whether and how a modified object instance is published via the registered implementation of a <a href="#_rg_services-spi_manpage-PublishingService"><code>PublishingService</code></a>).  This attribute is also supported for <a href="#_rg_annotations_manpage-Action_publishing">actions</a>, where it controls whether action invocations are published as events.</p>
</div>
<div class="paragraph">
<p>A common use case is to notify external "downstream" systems of changes in the state of the Isis application.</p>
</div>
<div class="paragraph">
<p>The default value for the attribute is <code>AS_CONFIGURED</code>, meaning that the <a href="#_rg_runtime_configuring-core">configuration property</a> <code>isis.services.publish.objects</code> is used to determine the whether the action is published:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>all</code><br></p>
<div class="paragraph">
<p>all changed objects are published</p>
</div>
</li>
<li>
<p><code>none</code><br></p>
<div class="paragraph">
<p>no changed objects are published</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If there is no configuration property in <code>isis.properties</code> then publishing is automatically enabled for domain objects.</p>
</div>
<div class="paragraph">
<p>This default can be overridden on an object-by-object basis; if <code>publishing()</code> is set to <code>ENABLED</code> then changed instances of the domain class are published irrespective of the configured value; if set to <code>DISABLED</code> then the changed instances are <em>not</em> published, again irrespective of the configured value.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObject</span>(
    publishing=Publishing.ENABLED  <i class="conum" data-value="1"></i><b>(1)</b>
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">InterestRate</span> {
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>because set to enabled, will be published irrespective of the configured value.</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="__code_publishingpayloadfactory_code_2"><code>publishingPayloadFactory()</code></h5>
<div class="paragraph">
<p>The (optional) related <code>publishingPayloadFactory()</code> specifies the class to use to create the (payload of the) event to be published by the publishing factory.</p>
</div>
<div class="paragraph">
<p>Rather than simply broadcast that the object was changed, the payload factory allows a "fatter" payload to be instantiated that can eagerly push commonly-required information to all subscribers. For at least some subscribers this should avoid the necessity to query back for additional information.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-DomainObjectLayout">3.9. <code>@DomainObjectLayout</code></h3>
<div class="paragraph">
<p>The <code>@DomainObjectLayout</code> annotation applies to domain classes, collecting together all UI hints within a single annotation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For view models that have been annotated with <code>@ViewModel</code> the equivalent <a href="#_rg_annotations_manpage-ViewModelLayout"><code>@ViewModelLayout</code></a> can be used.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The table below summarizes the annotation&#8217;s attributes.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 12. <code>@DomainObjectLayout</code> attributes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Values (default)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainObjectLayout_bookmarking"><code>bookmarking()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AS_ROOT</code>, <code>AS_CHILD</code>, <code>NEVER</code><br>
(<code>NEVER</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>whether (and how) this domain object should be automatically bookmarked</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainObjectLayout_cssclass"><code>cssClass()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any string valid as a CSS class</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>the css class that a domain class (type) should have, to allow more targetted styling in <a href="#_rg_runtime_application-specific_application-css"><code>application.css</code></a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainObjectLayout_cssClassFa"><code>cssClassFa()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any valid <a href="http://fortawesome.github.io/Font-Awesome/">Font awesome</a> icon name</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>specify a font awesome icon for the action&#8217;s menu link or icon.<br></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cssClassFaPosition()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LEFT</code>, <code>RIGHT</code><br>
(<code>LEFT</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Currently unused.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainObjectLayout_describedAs"><code>describedAs()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>description of this class, eg to be rendered in a tooltip.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainObjectLayout_named"><code>named()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>to override the name inferred from the action&#8217;s name in code.<br></p>
</div>
<div class="paragraph">
<p>A typical use case is if the desired name is a reserved Java keyword, such as <code>default</code> or <code>package</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainObjectLayout_paged"><code>paged()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Positive integer</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>the page size for instances of this class when rendered within a table (as returned from an action invocation)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainObjectLayout_plural"><code>plural()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>the plural name of the class</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObjectLayout</span>(
    cssClass=<span class="string"><span class="delimiter">&quot;</span><span class="content">x-key</span><span class="delimiter">&quot;</span></span>,
    cssClassFa=<span class="string"><span class="delimiter">&quot;</span><span class="content">fa-checklist</span><span class="delimiter">&quot;</span></span>,
    describedAs=<span class="string"><span class="delimiter">&quot;</span><span class="content">Capture a task that you need to do</span><span class="delimiter">&quot;</span></span>,
    named=<span class="string"><span class="delimiter">&quot;</span><span class="content">ToDo</span><span class="delimiter">&quot;</span></span>,
    paged=<span class="integer">30</span>,
    plural=<span class="string"><span class="delimiter">&quot;</span><span class="content">ToDo List</span><span class="delimiter">&quot;</span></span>)
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    ...
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that there is (currently) no support for specifying UI hints for domain objects through the dynamic <a href="#_rg_object-layout_dynamic"><code>.layout.json</code></a> file (only for properties, collections and actions are supported).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-DomainObjectLayout_bookmarking">3.9.1. <code>bookmarking()</code></h4>
<div class="paragraph">
<p>The <code>bookmarking()</code> attribute indicates that an entity is automatically bookmarked. This attribute is also supported for  <a href="#_rg_annotations_manpage-Action_bookmarking">domain objects</a>.</p>
</div>
<div class="paragraph">
<p>(In the Wicket viewer), a link to a bookmarked object is shown in the bookmarks panel:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-annotations/DomainObjectLayout/bookmarking.png"><img src="images/reference-annotations/DomainObjectLayout/bookmarking.png" alt="bookmarking" width="720px"></a>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that this screenshot shows an earlier version of the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> UI (specifically, pre 1.8.0).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObject</span>(bookmarking=BookmarkPolicy.AS_ROOT)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> ... {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>indicates that the <code>ToDoItem</code> class is bookmarkable:</p>
</div>
<div class="paragraph">
<p>It is also possible to nest bookmarkable entities. For example, this screenshot is taken from <a href="http://github.com/estatio/estatio">Estatio</a>:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-annotations/DomainObjectLayout/bookmarking-nested.png"><img src="images/reference-annotations/DomainObjectLayout/bookmarking-nested.png" alt="bookmarking nested" width="720px"></a>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that this screenshot shows an earlier version of the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> UI (specifically, pre 1.8.0).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, the <code>Property</code> entity "[OXF] Oxford Super Mall" is a root bookmark, but the <code>Unit</code> child entity "[OXF-001] Unit 1" only appears as a bookmark <em>but only if</em> its parent <code>Property</code> has already been bookmarked.</p>
</div>
<div class="paragraph">
<p>This is accomplished with the following annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObject</span>(bookmarking=BookmarkPolicy.AS_ROOT)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Property</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObject</span>(bookmarking=BookmarkPolicy.AS_CHILD)
<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">Unit</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The nesting can be done to any level; the Estatio screenshot also shows a bookmark nesting <code>Lease</code> &gt; <code>LeaseItem</code> &gt;  <code>LeaseTerm</code> (3 levels deep).</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-DomainObjectLayout_cssClass">3.9.2. <code>cssClass()</code></h4>
<div class="paragraph">
<p>The <code>cssClass()</code> attribute can be used to render additional CSS classes in the HTML (a wrapping <code>&lt;div&gt;</code>) that represents the domain object.   <a href="#_rg_runtime_application-specific_application-css">Application-specific CSS</a> can then be used to target and adjust the UI representation of that particular element.</p>
</div>
<div class="paragraph">
<p>This attribute can also be applied to <a href="#_rg_annotations_manpage-DomainObjectLayout_cssClass">domain objects</a>, <a href="#_rg_annotations_manpage-ViewModelLayout_cssClass">view models</a>, <a href="#_rg_annotations_manpage-ActionLayout_cssClass">actions</a> <a href="#_rg_annotations_manpage-PropertyLayout_cssClass">properties</a>,  <a href="#_rg_annotations_manpage-CollectionLayout_cssClass">collections</a> and <a href="#_rg_annotations_manpage-ParameterLayout_cssClass">parameters</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObject</span>(
    cssClass=<span class="string"><span class="delimiter">&quot;</span><span class="content">x-core-entity</span><span class="delimiter">&quot;</span></span>
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> { ... }</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The similar <a href="#_rg_annotations_manpage-DomainObjectLayout_cssClassFa"><code>@DomainObjectLayout#cssClassFa()</code></a> annotation attribute is also used as a hint to apply CSS, but in particular to allow <a href="http://fortawesome.github.io/Font-Awesome/icons/">Font Awesome icons</a>
to be rendered as the icon for classes.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-DomainObjectLayout_cssClassFa">3.9.3. <code>cssClassFa()</code></h4>
<div class="paragraph">
<p>The <code>cssClassFa()</code> attribute is used to specify the name of a <a href="http://fortawesome.github.io/Font-Awesome/icons/">Font Awesome icon</a> name, to be rendered as the domain object&#8217;s icon.</p>
</div>
<div class="paragraph">
<p>These attributes can also be applied to <a href="#_rg_annotations_manpage-ViewModelLayout_cssClassFa">view models</a> to specify the object&#8217;s icon, and to <a href="#_rg_annotations_manpage-ActionLayout_cssClassFa">actions</a> to specify an icon for the action&#8217;s representation as a button or menu item.</p>
</div>
<div class="paragraph">
<p>If necessary the icon specified can be overridden by a particular object instance using the <a href="#_rg_methods_reserved_manpage-iconName"><code>iconName()</code></a> method.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObjectLayout</span>(
    cssClassFa=<span class="string"><span class="delimiter">&quot;</span><span class="content">fa-check-circle</span><span class="delimiter">&quot;</span></span>
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>There can be multiple "fa-" classes, eg to mirror or rotate the icon. There is no need to include the mandatory <code>fa</code> "marker" CSS class; it will be automatically added to the list.  The <code>fa-</code> prefix can also be omitted from the class names; it will be prepended to each if required.</p>
</div>
<div class="paragraph">
<p>The related <code>cssClassFaPosition()</code> attribute is currently unused for domain objects; the icon is always rendered to the left.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The similar <a href="#_rg_annotations_manpage-DomainObjectLayout_cssClass"><code>@DomainObjectLayout#cssClass()</code></a> annotation attribute is also used as a hint
to apply CSS, but for wrapping the representation of an object or object
member so that it can be styled in an application-specific way.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-DomainObjectLayout_describedAs">3.9.4. <code>describedAs()</code></h4>
<div class="paragraph">
<p>The <code>describedAs()</code> attribute is used to provide a short description of the domain object to the user.  In the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> it is displayed as a 'tool tip'.  The attribute can also be specified for <a href="#_rg_annotations_manpage-CollectionLayout_describedAs">collections</a>,  <a href="#_rg_annotations_manpage-PropertyLayout_describedAs">properties</a>, <a href="#_rg_annotations_manpage-ActionLayout_describedAs">actions</a>, <a href="#_rg_annotations_manpage-ParameterLayout_describedAs">parameters</a> and <a href="#_rg_annotations_manpage-ViewModelLayout_describedAs">view models</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DescribedAs</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">A customer who may have originally become known to us via </span><span class="delimiter">&quot;</span></span> +
             <span class="string"><span class="delimiter">&quot;</span><span class="content">the marketing system or who may have contacted us directly.</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ProspectiveSale</span> {
   ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-DomainObjectLayout_named">3.9.5. <code>named()</code></h4>
<div class="paragraph">
<p>The <code>named()</code> attribute explicitly specifies the domain object&#8217;s name, overriding the name that would normally be inferred from the Java source code.  The attribute can also be specified for <a href="#_rg_annotations_manpage-ActionLayout_named">actions</a>, <a href="#_rg_annotations_manpage-CollectionLayout_named">collections</a>, <a href="#_rg_annotations_manpage-PropertyLayout_named">properties</a>, <a href="#_rg_annotations_manpage-ParameterLayout_named">parameters</a>, <a href="#_rg_annotations_manpage-ViewModelLayout_named">view models</a> and <a href="#_rg_annotations_manpage-DomainServiceLayout_named">domain services</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Following the <a href="http://en.wikipedia.org/wiki/Don%27t_repeat_yourself">don&#8217;t repeat yourself</a> principle, we recommend that you only use this attribute when the desired name cannot be used in Java source code.  Examples of that include a name that would be a reserved Java keyword (eg "package"), or a name that has punctuation, eg apostrophes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObjectLayout</span>(
   named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Customer</span><span class="delimiter">&quot;</span></span>
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerImpl</span> <span class="directive">implements</span> Customer{
   ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s also possible to specify a <a href="#_rg_annotations_manpage-DomainObjectLayout_plural">plural form</a> of the name, used by the framework when rendering a standalone collection of the domain object.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The framework also provides a separate, powerful mechanism for <a href="ug.html#_ug_more-advanced_i18n">internationalization</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-DomainObjectLayout_paged">3.9.6. <code>paged()</code></h4>
<div class="paragraph">
<p>The <code>paged()</code> attribute specifies the number of rows to display in a standalone collection, as returned from an action invocation. This attribute can also be applied to <a href="#_rg_annotations_manpage-CollectionLayout_paged">collections</a> and <a href="#_rg_annotations_manpage-ViewModelLayout_paged">view models</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="ug.html#<em>ug_restfulobjects-viewer">RestfulObjects viewer</a> currently does not support paging.   The <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> _does</em> support paging, but note that the paging is performed client-side rather than server-side.</p>
</div>
<div class="paragraph">
<p>We therefore recommend that large collections should instead be modelled as actions (to allow filtering to be applied to limit the number of rows).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObjectLayout</span>(paged=<span class="integer">15</span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Order</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to specify a global default for the page size of standalone collections, using the <a href="#_rg_runtime_configuring-core">configuration property</a> <code>isis.viewer.paged.standalone</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-DomainObjectLayout_plural">3.9.7. <code>plural()</code></h4>
<div class="paragraph">
<p>When Apache Isis displays a standalone collection of several objects, it will label the collection using the plural form of the object type.</p>
</div>
<div class="paragraph">
<p>By default the plural name will be derived from the end of the singular name, with support for some basic English language defaults (eg using "ies" for names ending with a "y").</p>
</div>
<div class="paragraph">
<p>The <code>plural()</code> attribute allows the plural form of the class name to be specified explicitly.  This attribute is also supported for <a href="#_rg_annotations_manpage-ViewModelLayout_plural">view models</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObjectLayout</span>(plural=<span class="string"><span class="delimiter">&quot;</span><span class="content">Children</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Child</span> {
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-DomainService">3.10. <code>@DomainService</code></h3>
<div class="paragraph">
<p>The <code>@DomainService</code> annotation indicates that the (concrete) class should be automatically instantiated as a domain service.</p>
</div>
<div class="paragraph">
<p>Domain services with this annotation do NOT need to be registered explicitly in <code>isis.properties</code>; they will be
discovered automatically on the CLASSPATH.</p>
</div>
<div class="paragraph">
<p>The table below summarizes the annotation&#8217;s attributes.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 13. <code>@DomainService</code> attributes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Values (default)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainService_nature"><code>nature()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VIEW</code>, <code>VIEW_MENU_ONLY</code>, <code>VIEW_CONTRIBUTIONS_ONLY</code>, <code>VIEW_REST_ONLY</code>, <code>DOMAIN</code> (<code>VIEW</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>the nature of this service: providing actions for menus, or as contributed actions, or for the <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects REST API</a>, or neither</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainService_repositoryFor"><code>repositoryFor()</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>if this domain service acts as a repository for an entity type, specify that entity type. (This is currently informational only)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>menuOrder()</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Deprecated in 1.8.0; use instead <a href="#_rg_annotations_manpage-DomainServiceLayout_menuOrder"><code>@DomainServiceLayout#menuOrder()</code></a></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(
    nature=NatureOfService.DOMAIN,
    repositoryFor=Loan.class
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">LoanRepository</span> {
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Loan&gt; findLoansFor(Borrower borrower) { ... }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-DomainService_nature">3.10.1. <code>nature()</code></h4>
<div class="paragraph">
<p>By default, a domain service&#8217;s actions will be rendered in the application menu bar <em>and</em> be contributed <em>and</em> appear in the REST API <em>and</em> (of course) be available to invoke programmatically wherever that domain service is injected.  This is great for initial prototyping, but later on you may prefer to add a little more structure.  This is the purpose of the <code>nature()</code> attribute: to indicates the intent of (all of) the actions defined within the domain service.</p>
</div>
<div class="paragraph">
<p>The values of the enum are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VIEW</code><br></p>
<div class="paragraph">
<p>The default; the service&#8217;s actions appear on menu bars, can be contributed, appear in the REST API</p>
</div>
</li>
<li>
<p><code>VIEW_MENU_ONLY</code><br></p>
<div class="paragraph">
<p>The service&#8217;s actions appear on menus and in the REST API, but are not contributed to domain objects or view models</p>
</div>
</li>
<li>
<p><code>VIEW_CONTRIBUTIONS_ONLY</code><br></p>
<div class="paragraph">
<p>The service&#8217;s actions are intended only to be used as contributed actions/associations to domain objects and view models.<br></p>
</div>
<div class="paragraph">
<p>The related <a href="#_rg_annotations_manpage-ActionLayout_contributedAs"><code>@ActionLayout#contributedAs()</code></a> determines whether any given (1-arg) action is contributed as an association rather than an action.</p>
</div>
</li>
<li>
<p><code>VIEW_REST_ONLY</code><br></p>
<div class="paragraph">
<p>The service&#8217;s actions are intended only to be listed in the REST API exposed by the <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a>.</p>
</div>
</li>
<li>
<p><code>DOMAIN</code><br></p>
<div class="paragraph">
<p>The service and its actions are only intended to be invoked programmatically; they are a domain layer responsibility.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The actual class name of the domain service is only rendered for the <code>VIEW</code>, <code>VIEW_MENU_ONLY</code> and <code>VIEW_REST_ONLY</code> natures.  Thus, you might also want to adopt naming conventions for your domain classes so you can infer the nature from the class.  For example, the naming convention adopted (by and large) by the (non-ASF) <a href="http://isisaddons.org">Isis Addons</a> is <code>ProgrammaticServices</code> or <code>Repository</code> as a suffix for <code>DOMAIN</code> services, and <code>Contributions</code> as a suffix for <code>VIEW_CONTRIBUTIONS_ONLY</code> services.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(
    nature=NatureOfService.VIEW_CONTRIBUTIONS_ONLY
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">LoanContributions</span> {                                  <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Action</span>(semantics=SemanticsOf.SAFE)                           <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="annotation">@ActionLayout</span>(contributed=Contributed.AS_ASSOCIATION )
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Loan&gt; currentLoans(Borrower borrower) { ... }
    <span class="directive">public</span> Borrower newLoan(Borrower borrower, <span class="predefined-type">Book</span> book) { ... }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Contributions</code> as a suffix for a domain service that contributes a number of actions to <code>Borrower</code>s.  Note that <code>Borrower</code> could be a (marker) interface, so this functionality is "mixed in" merely by the class (eg <code>LibraryMember</code>) implementing this interface</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>actions contibuted as associations (a collection in this case) must have safe semantics</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Another example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(
    nature=NatureOfService.DOMAIN
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">LoanRepository</span> {                                  <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Programmatic</span>                                              <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Loan&gt; findLoansFor(Borrower borrower) { ... }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Repository</code> as a suffix for a domain-layer service</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>methods on <code>DOMAIN</code> services are often <a href="#_rg_annotations_manpage-Programmatic"><code>@Programmatic</code></a>; they will never be exposed in the UI, so there&#8217;s little point in including them in Apache Isis' metamodel</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A final example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(
    nature=NatureOfService.VIEW_MENU_ONLY
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Loans</span> {                               <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Action</span>(semantics=SemanticsOf.SAFE)
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Loan&gt; findOverdueLoans() { ... }
    <span class="annotation">@Inject</span>
    LoanRepository loanRepository;                 <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>name is intended to be rendered in the UI</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>it&#8217;s common for domain-layer domain services to be injected into presentation layer services (such as <code>VIEW_MENU_ONLY</code> and <code>VIEW_CONTRIBUTIONS_ONLY</code>).</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-DomainService_repositoryFor">3.10.2. <code>repositoryFor()</code></h4>
<div class="paragraph">
<p>The <code>repositoryFor()</code> attribute is intended for domain services (probably with a <a href="#_rg_annotations_manpage-DomainService_nature"><code>nature=DOMAIN</code></a>) that are intended to act as repositories for domain entities.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(
    nature=NatureOfService.DOMAIN,
    repositoryFor=Loan.class
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">LoanRepository</span> {
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Loan&gt; findLoansFor(Borrower borrower) { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Currently the metadata is unused; one planned use is to infer the icon for the domain service from the icon of the nominated entity.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-DomainServiceLayout">3.11. <code>@DomainServiceLayout</code></h3>
<div class="paragraph">
<p>The <code>@DomainServiceLayout</code> annotation applies to domain services, collecting together all view layout semantics within a single annotation.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You will also find some additional material in the <a href="#_rg_object-layout_application-menu">object layout</a> chapter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The table below summarizes the annotation&#8217;s attributes.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 14. <code>@DomainServiceLayout</code> attributes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Values (default)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainServiceLayout_menuBar"><code>menuBar()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PRIMARY</code>, <code>SECONDARY</code>, <code>TERTIARY</code> (<code>PRIMARY</code>).</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>the menubar in which the menu that holds this service&#8217;s actions should reside.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainServiceLayout_menuOrder"><code>menuOrder()</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>the order of the service&#8217;s menu with respect to other service&#8217;s.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-DomainServiceLayout_named"><code>named()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string, eg "Customers"</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>name of this class (overriding the name derived from its name in code)</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>
<span class="annotation">@DomainServiceLayout</span>(
    menuBar=<span class="predefined-type">MenuBar</span>.PRIMARY,
    menuOrder=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span>,
    named=<span class="string"><span class="delimiter">&quot;</span><span class="content">ToDos</span><span class="delimiter">&quot;</span></span>
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItems</span> {
    ...
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that there is (currently) no support for specifying UI hints for domain services through the dynamic <a href="#_rg_object-layout_dynamic"><code>.layout.json</code></a> file (only for properties, collections and actions are supported).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-DomainServiceLayout_menuBar">3.11.1. <code>menuBar()</code></h4>
<div class="paragraph">
<p>The <code>menuBar()</code> attribute is a hint to specify where on the application menu a domain service&#8217;s actions should be rendered.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>
<span class="annotation">@DomainServiceLayout</span>(menuBar=<span class="predefined-type">MenuBar</span>.PRIMARY)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItems</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a>, domain services placed on the <code>PRIMARY</code> menu bar appears to the left:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-annotations/DomainServiceLayout/menuBar-primary.png"><img src="images/reference-annotations/DomainServiceLayout/menuBar-primary.png" alt="menuBar primary" width="720px"></a>
</div>
</div>
<div class="paragraph">
<p>Domain services placed on the <code>SECONDARY</code> menu bar appear to the right:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-annotations/DomainServiceLayout/menuBar-secondary.png"><img src="images/reference-annotations/DomainServiceLayout/menuBar-secondary.png" alt="menuBar secondary" width="720px"></a>
</div>
</div>
<div class="paragraph">
<p>Domain services placed on the <code>TERTIARY</code> appear in the menu bar associated with the user&#8217;s name (far top-right)</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-annotations/DomainServiceLayout/menuBar-tertiary.png"><img src="images/reference-annotations/DomainServiceLayout/menuBar-tertiary.png" alt="menuBar tertiary" width="720px"></a>
</div>
</div>
<div class="paragraph">
<p>The grouping of multiple domain services actions within a single drop-down is managed by the <a href="#_rg_annotations_manpage-DomainServiceLayout_menuOrder"><code>@DomainServiceLayout#menuOrder()</code></a> attribute.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a> does not support this attribute.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-DomainServiceLayout_menuOrder">3.11.2. <code>menuOrder()</code></h4>
<div class="paragraph">
<p>The <code>menuOrder()</code> attribute determines the ordering of a domain service&#8217;s actions as menu items within a specified menu bar and top-level menu.</p>
</div>
<div class="paragraph">
<p>The algorithm works as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>first, the <a href="#_rg_annotations_manpage-DomainServiceLayout_menuBar"><code>menuBar()</code></a> determines which of the three menu bars the service&#8217;s actions should be rendered</p>
</li>
<li>
<p>then, the domain service&#8217;s top-level name (typically explicitly specified using <a href="#_rg_annotations_manpage-DomainServiceLayout_named"><code>named()</code></a>) is used to determine the top-level menu item to be rendered on the menu bar</p>
</li>
<li>
<p>finally, if there is more than domain service that has the same name, then the <code>menuOrder</code> attribute is used to order those actions on the menu item drop-down.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the screenshot below shows the "prototyping" menu from the (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a>:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-annotations/DomainServiceLayout/menuOrder.png"><img src="images/reference-annotations/DomainServiceLayout/menuOrder.png" alt="menuOrder" width="500px"></a>
</div>
</div>
<div class="paragraph">
<p>The <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> automatically places separators between actions from different domain services.  From this we can infer that there are actually five different domain services that are all rendered on the "prototyping" top-level menu.</p>
</div>
<div class="paragraph">
<p>One of these is the todoapp&#8217;s <code>DemoDomainEventSubscriptions</code> service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(
        nature = NatureOfService.VIEW_MENU_ONLY
)
<span class="annotation">@DomainServiceLayout</span>(
        menuBar = <span class="predefined-type">MenuBar</span>.SECONDARY,
        named = <span class="string"><span class="delimiter">&quot;</span><span class="content">Prototyping</span><span class="delimiter">&quot;</span></span>,                   <i class="conum" data-value="1"></i><b>(1)</b>
        menuOrder = <span class="string"><span class="delimiter">&quot;</span><span class="content">500.20</span><span class="delimiter">&quot;</span></span>)                    <i class="conum" data-value="2"></i><b>(2)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">DemoDomainEventSubscriptions</span> {
    <span class="annotation">@ActionLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Set subscriber behaviour</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@MemberOrder</span>(sequence = <span class="string"><span class="delimiter">&quot;</span><span class="content">500.20.1</span><span class="delimiter">&quot;</span></span>)          <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="directive">public</span> <span class="type">void</span> subscriberBehaviour(...) { ... }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>render on the "Prototyping" menu</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>positioning relative to other service&#8217;s on the "Prototyping" menu</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>by convention (nothing more) the <code>@MemberOrder#sequence()</code> attribute continues the same Dewey decimal sequence format (a simple string "1" could in fact have been used instead)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>while another comes from the (non-ASF) <a href="http://github.com/isisaddons/isis-module-devutils">Isis addons' devutils</a> module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainServiceLayout</span>(
    menuBar = <span class="predefined-type">MenuBar</span>.SECONDARY,
    named = <span class="string"><span class="delimiter">&quot;</span><span class="content">Prototyping</span><span class="delimiter">&quot;</span></span>,                    <i class="conum" data-value="1"></i><b>(1)</b>
    menuOrder = <span class="string"><span class="delimiter">&quot;</span><span class="content">500.600</span><span class="delimiter">&quot;</span></span>                     <i class="conum" data-value="2"></i><b>(2)</b>
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">DeveloperUtilitiesServiceMenu</span> {
    <span class="annotation">@MemberOrder</span>( sequence = <span class="string"><span class="delimiter">&quot;</span><span class="content">500.600.1</span><span class="delimiter">&quot;</span></span> )    <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="directive">public</span> <span class="predefined-type">Clob</span> downloadMetaModel() { ... }
    <span class="annotation">@MemberOrder</span>( sequence = <span class="string"><span class="delimiter">&quot;</span><span class="content">500.600.2</span><span class="delimiter">&quot;</span></span> )
    <span class="directive">public</span> <span class="predefined-type">Blob</span> downloadLayouts() { ... }
    <span class="annotation">@ActionLayout</span>(named = <span class="string"><span class="delimiter">&quot;</span><span class="content">Rebuild Services Meta Model</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@MemberOrder</span>( sequence = <span class="string"><span class="delimiter">&quot;</span><span class="content">500.600.3</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> refreshServices() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>render on the "Prototyping" menu</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>positioning relative to other service&#8217;s on the "Prototyping" menu; this appears after the <code>DemoDomainEventSubscriptions</code> service shown above</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>by convention (nothing more) the <code>@MemberOrder#sequence()</code> attribute continues the same Dewey decimal sequence format (a simple string "1", "2", "3", &#8230;&#8203; could in fact have been used instead)</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-DomainServiceLayout_named">3.11.3. <code>named()</code></h4>
<div class="paragraph">
<p>The <code>named()</code> attribute explicitly specifies the domain service&#8217;s name, overriding the name that would normally be inferred from the Java source code.  This attribute can also be specified for <a href="#_rg_annotations_manpage-ActionLayout_named">actions</a>, <a href="#_rg_annotations_manpage-CollectionLayout_named">collections</a>, <a href="#_rg_annotations_manpage-PropertyLayout_named">properties</a>, <a href="#_rg_annotations_manpage-ParameterLayout_named">parameters</a>, <a href="#_rg_annotations_manpage-DomainObjectLayout_named">domain objects</a> and <a href="#_rg_annotations_manpage-ViewModelLayout_named">view models</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The value of this attribute also has an important role to play in the positioning of the domain service&#8217;s actions relative to the actions of other domain services.  See <a href="#_rg_annotations_manpage-DomainServiceLayout_menuOrder"><code>menuOrder()</code></a> for a full discussion with examples.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>
<span class="annotation">@DomainServiceLayout</span>(
    named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Customers</span><span class="delimiter">&quot;</span></span>
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerRepository</span> {
   ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-Facets">3.12. <code>@Facets</code></h3>
<div class="paragraph">
<p>The <code>@Facets</code> annotation allows <code>FacetFactory</code> implementations and so can be used to run install arbitrary <code>Facet`s for a type. Generally this is not needed, but can be useful for overriding a custom programming model where a `FacetFactory</code> is not typically included.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>FacetFactory</code> is an important internal API that is used by Apache Isis to</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-HomePage">3.13. <code>@HomePage</code></h3>
<div class="paragraph">
<p>The <code>@HomePage</code> annotation allows a <em>single</em> (no-arg, query-only) action on a <em>single</em> domain service to be nominated as the action to invoke for the default home page.  This often returns a view model that acts as some sort of dashboard, presenting key information and makeing the most commonly used actions easy to invoke.</p>
</div>
<div class="paragraph">
<p>For example, the (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a> uses <code>@HomePage</code> to return a dashboard of todo items to complete:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-annotations/HomePage/HomePage.png"><img src="images/reference-annotations/HomePage/HomePage.png" alt="HomePage" width="800px"></a>
</div>
</div>
<div class="paragraph">
<p>The corresponding code is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature = NatureOfService.DOMAIN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoAppDashboardService</span>  {
    <span class="annotation">@Action</span>(
            semantics = SemanticsOf.SAFE
    )
    <span class="annotation">@HomePage</span>
    <span class="directive">public</span> ToDoAppDashboard lookup() {
        <span class="keyword">return</span> container.injectServicesInto(<span class="keyword">new</span> ToDoAppDashboard());
    }
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> DomainObjectContainer container;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>ToDoAppDashboard</code> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObject</span>(nature = Nature.VIEW_MODEL)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoAppDashboard</span> {
    <span class="directive">public</span> <span class="predefined-type">String</span> title() { <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Dashboard</span><span class="delimiter">&quot;</span></span>; }

    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;ToDoItem&gt; getNotYetComplete() { ... }
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;ToDoItem&gt; getComplete() { ... }

    <span class="directive">public</span> <span class="predefined-type">Blob</span> exportToWordDoc() { ... }  <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>associated using <a href="#_rg_object-layout_dynamic">dynamic layouts</a> with the <code>notYetComplete</code> collection.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The other two actions shown in the above screenshot&#8201;&#8212;&#8201;<code>exportAsXml</code> and <code>downloadLayout</code>&#8201;&#8212;&#8201;are actually contributed to the <code>ToDoAppDashboard</code> through various domain services, as is the <code>downloadLayout</code> action.</p>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-Inject">3.14. <code>@Inject</code> (<code>javax</code>)</h3>
<div class="paragraph">
<p>Apache Isis automatically injects domain services into other domain services and also into domain objects and view models.  In fact, it also injects domain services into <a href="ug.html#_ug_testing_integ-test-support">integration tests</a> and <a href="ug.html#_ug_testing_fixture-scripts">fixture scripts</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>One omission: Apache Isis (currently) does not inject services into <code>o.a.i.applib.spec.Specification</code> instances (as used by <a href="#_rg_annotations_manpage-Property_mustSatisfy"><code>@Property#mustSatisfy()</code></a> and <a href="#_rg_annotations_manpage-Parameter_mustSatisfy"><code>@Parameter#mustSatisfy()</code></a> annotations.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Isis supports several syntaxes for injecting domain services.  The simplest uses the <code>@javax.inject.Inject</code> annotation on the field, as defined in <a href="https://jcp.org/en/jsr/detail?id=330">JSR-330</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Order&gt; findRecentOrders() {    <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="keyword">return</span> orders.recentOrdersFor(<span class="local-variable">this</span>);
    }
    <span class="annotation">@javax</span>.inject.Inject
    OrderRepository orders;                    <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>an alternative implementation would be to implement <code>findRecentOrders()</code> as a <a href="ug.html#_ug_how-tos_contributed-members">contributed action</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we recommend default (rather than <code>private</code>) visibility so that unit tests can easily mock out the service</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_alternative_syntaxes">3.14.1. Alternative syntaxes</h4>
<div class="paragraph">
<p>Isis also supports setter-based injection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    ...
    public <span class="type">void</span> setOrderRepository(OrderRepository orderRepository) { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and also supports an additional syntax of using <code>inject&#8230;&#8203;</code> as the prefix:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    ...
    public <span class="type">void</span> injectOrderRepository(OrderRepository orderRepository) { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Generally we recommend using <code>@javax.inject.Inject</code>; it involves less code, and is more immediately familiar to most Java developers.</p>
</div>
</div>
<div class="sect3">
<h4 id="_manually_injecting_services">3.14.2. Manually injecting services</h4>
<div class="paragraph">
<p>Isis performs dependency injection when domain entities are recreated.  It will also perform dependency injection if an object is created through the <code>DomainObjectContainer</code>.</p>
</div>
<div class="paragraph">
<p>For example, to create a new (transient) domain object, the idiom is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Customer cust = container.newTransientInstance(Customer.class);  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="comment">// initialize state of &quot;cust&quot;</span>
container.persist(cust);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>where <code>container</code> is an instance of <a href="#_rg_services-api_manpage-DomainObjectContainer"><code>DomainObjectContainer</code></a>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>View models are created similarly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ToDoAppDashboard dashboard = container.newViewModelInstance(ToDoAppDashboard.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you prefer, though, you can simply instantiate domain objects using "new" and then inject domain services manually:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Customer cust = <span class="keyword">new</span> Customer();
container.injectServicesInto(cust);
<span class="comment">// initialize state of &quot;cust&quot;</span>
container.persist(cust);</code></pre>
</div>
</div>
<div class="paragraph">
<p>or if you prefer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Customer cust = container.injectServicesInto(<span class="keyword">new</span> Customer());
<span class="comment">// initialize state of &quot;cust&quot;</span>
container.persist(cust);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There is one subtle difference between using <code>DomainObjectContainer#newTransientInstance(&#8230;&#8203;)</code> and <code>DomainObjectContainer#injectServicesInto(&#8230;&#8203;)</code>, in that with the former Apache Isis will automatically initialize all fields to their default values.</p>
</div>
<div class="paragraph">
<p>This isn&#8217;t a particular useful feature (and indeed can sometimes be rather confusing) so you may well wish to standardize on using <code>injectServicesInto(&#8230;&#8203;)</code> throughout.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-MemberGroupLayout">3.15. <code>@MemberGroupLayout</code></h3>
<div class="paragraph">
<p>The <code>@MemberGroupLayout</code> annotation specifies how an object&#8217;s properties and collections are grouped together into columns, also specifying the relative positioning of those columns.  It works in conjunction with the <a href="#_rg_annotations_manpage-MemberOrder"><code>@MemberOrder</code></a> annotation.</p>
</div>
<div class="paragraph">
<p>The <code>@MemberOrder</code> annotation is used to specify the relative order of domain object members, that is: properties, collections and actions.  It works in conjunction with the <a href="#_rg_annotations_manpage-MemberGroupLayout"><code>@MemberGroupLayout</code></a> annotation.</p>
</div>
<div class="paragraph">
<p>The annotation defines two attributes, <code>name()</code> and <code>sequence()</code>.  Broadly speaking the <code>name()</code> attribute is used to group or associate members together, while the <code>sequence()</code> attribute orders members once they have been grouped.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As this is an important topic, there is a <a href="#_rg_object-layout">separate chapter</a> that discussed object layout in full.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-MemberOrder">3.16. <code>@MemberOrder</code></h3>
<div class="paragraph">
<p>The <code>@MemberOrder</code> annotation is used to specify the relative order of domain object members, that is: properties, collections and actions.  It works in conjunction with the <a href="#_rg_annotations_manpage-MemberGroupLayout"><code>@MemberGroupLayout</code></a> annotation.</p>
</div>
<div class="paragraph">
<p>The annotation defines four attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>columnSpans()</code>&#8201;&#8212;&#8201;of type <code>int[]</code>&#8201;&#8212;&#8201;which specifies the relative column sizes of the three columns that render properties as well as a fourth column that renders only collections</p>
</li>
<li>
<p><code>left()</code>&#8201;&#8212;&#8201;of type <code>String[]</code> - that specifies the order of the property groups (inferred from <code>@MemberOrder#name()</code>) as applied to properties) in the left-most column</p>
</li>
<li>
<p><code>middle()</code>&#8201;&#8212;&#8201;of type <code>String[]</code> - that specifies the order of the property groups (if any) as applied to properties) in the middle column</p>
</li>
<li>
<p><code>right()</code>&#8201;&#8212;&#8201;of type <code>String[]</code> - that specifies the order of the property groups (if any) as applied to properties) in the right-most column</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Collections are always rendered in the "last" column.  This can appear either below the columns holding properties (if their column spans = 12), or can be rendered to the right of the property columns (if the spans of the property columns come to &lt;12 leaving enough room for the span of the collection column).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As this is an important topic, there is a <a href="#_rg_object-layout">separate chapter</a> that discussed object layout in full.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-NotPersistent">3.17. <code>@NotPersistent</code> (<code>javax.jdo</code>)</h3>
<div class="paragraph">
<p>The <code>@javax.jdo.annotation.NotPersistent</code> annotation is used by JDO/DataNucleus to indicate that a property should not be persisted to the database.</p>
</div>
<div class="paragraph">
<p>Apache Isis also uses this annotation, though (currently) only in the very minimal way to suppress checking of inconsistent metadata between JDO and Isis annotations (eg <code>@Column#allowsNull()</code> vs <code>@Property#optionality()</code>, or <code>@Column#length()</code> and <code>@Property#maxLength()</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Isis parses the <code>@NotPersistent</code> annotation from the Java source code; it does not query the JDO metamodel.  This means that it the <code>@NotPersistent</code> annotation must be used rather than the equivalent <code>&lt;field&gt;</code> <a href="http://www.datanucleus.org/products/accessplatform_4_0/jdo/fields_properties.html">XML metadata</a>.</p>
</div>
<div class="paragraph">
<p>Moreover, while JDO/DataNucleus will recognize annotations on either the field or the getter method, Apache Isis (currently) only inspects the getter method.  Therefore ensure that the annotation is placed there.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-MinLength">3.18. <code>@MinLength</code></h3>
<div class="paragraph">
<p>The <code>@MinLength</code> annotation is used to specify the minimum number of characters in a search of an <a href="#_rg_methods_prefixes_manpage-autoComplete"><code>autoComplete&#8230;&#8203;()</code></a> supporting method.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> ToDoItem add(
        <span class="annotation">@TypicalLength</span>(<span class="integer">20</span>)
        <span class="directive">final</span> ToDoItem toDoItem) {
    getDependencies().add(toDoItem);
    <span class="keyword">return</span> <span class="local-variable">this</span>;
}
<span class="directive">public</span> <span class="predefined-type">List</span>&lt;ToDoItem&gt; autoComplete0Add(
        <span class="directive">final</span> <span class="annotation">@MinLength</span>(<span class="integer">2</span>)
        <span class="predefined-type">String</span> search) {
    <span class="directive">final</span> <span class="predefined-type">List</span>&lt;ToDoItem&gt; list = toDoItems.autoComplete(search);
    list.removeAll(getDependencies());
    list.remove(<span class="local-variable">this</span>);
    <span class="keyword">return</span> list;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The `@Parameter(minLength=&#8230;&#8203;)`e can also be used (even though strictly speaking the search argument is not a parameter of the action).</p>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-Parameter">3.19. <code>@Parameter</code></h3>
<div class="paragraph">
<p>The <code>@Parameter</code> annotation applies to action parameters collecting together all domain semantics within a single annotation.</p>
</div>
<div class="paragraph">
<p>The table below summarizes the annotation&#8217;s attributes.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 15. <code>@Paramter</code> attributes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Values (default)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Parameter_maxLength"><code>maxLength()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Positive integer</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>maximum number of characters for string parameters; ignored otherwise</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>minLength()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Positive integer</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Deprecated; use <a href="#_rg_annotations_manpage-MinLength"><code>@MinLength</code></a> instead.<br></p>
</div>
<div class="paragraph">
<p>Can be used to specify the minimum length for <a href="#<em>rg_methods_prefixes_manpage-autoComplete"><code>autoComplete&#8230;&#8203;()</code></a> supporting method; but because this _is a</em> supporting method rather than the action method itself, we now feel it is misleading to use the <code>@Parameter</code> annotation in this situation.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Parameter_mustSatisfy"><code>mustSatisfy()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implementation of <code>o.a.i.applib.spec.Specification</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>allows arbitrary validation to be applied</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Parameter_optionality"><code>optionality()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MANDATORY</code>, <code>OPTIONAL</code> (<code>MANDATORY</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>specifies a parameter is optional rather than mandatory</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Parameter_regexPattern">regexPattern()</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">regular expression</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>validates the contents of a string parameter against the regular expression pattern</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>regexPatternFlags()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value of flags as normally passed to <code>java.util.regex.</code><br>
<code>Pattern#compile(&#8230;&#8203;)</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>modifies the compilation of the regular expression</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>regexPatternReplacement()</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Unused.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">EmailSpecification</span> <span class="directive">extends</span> AbstractSpecification&lt;<span class="predefined-type">String</span>&gt; {
        <span class="directive">public</span> <span class="predefined-type">String</span> satisfiesSafely(<span class="predefined-type">String</span> proposed) {
            <span class="keyword">return</span> EmailUtil.ensureValidEmail(proposed);    <i class="conum" data-value="1"></i><b>(1)</b>
        }
    }
    <span class="annotation">@Action</span>(semantics=SemanticsOf.IDEMPOTENT)
    <span class="directive">public</span> Customer updateEmail(
        <span class="annotation">@Parameter</span>(
            maxLength=<span class="integer">30</span>,
            mustSatisfy=EmailSpecification.class,
            optionality=Optionality.OPTIONAL,
            regexPattern = <span class="string"><span class="delimiter">&quot;</span><span class="content">(</span><span class="char">\\</span><span class="content">w+</span><span class="char">\\</span><span class="content">.)*</span><span class="char">\\</span><span class="content">w+@(</span><span class="char">\\</span><span class="content">w+</span><span class="char">\\</span><span class="content">.)+[A-Za-z]+</span><span class="delimiter">&quot;</span></span>,
            regexPatternFlags=<span class="predefined-type">Pattern</span>.CASE_INSENSITIVE
        )
        <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">New Email Address</span><span class="delimiter">&quot;</span></span>)
        <span class="directive">final</span> <span class="predefined-type">String</span> newEmailAddress
        ...
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the (fictitious) <code>EmailUtil.ensureValid(&#8230;&#8203;)</code> (omitted for brevity) returns a string explaining if an email is invalid</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Parameter_maxLength">3.19.1. <code>maxLength()</code></h4>
<div class="paragraph">
<p>The <code>maxLength()</code> attribute applies only to <code>String</code> parameters, indicating the maximum number of characters that the user may enter (for example in a text field in the UI).  It is ignored if applied to parameters of any other type.  This attribute can also be applied to <a href="#_rg_annotations_manpage-Property_maxLength">properties</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerRepository</span> {
    <span class="directive">public</span> Customer newCustomer(
        <span class="annotation">@Parameter</span>(maxLength=<span class="integer">30</span>)
        <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">First Name</span><span class="delimiter">&quot;</span></span>)  <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="directive">final</span> <span class="predefined-type">String</span> firstName,
        <span class="annotation">@Parameter</span>(maxLength=<span class="integer">50</span>)
        <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Last Name</span><span class="delimiter">&quot;</span></span>)
        <span class="directive">final</span> <span class="predefined-type">String</span> lastName) {
        ...
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>@ParameterLayout(named=&#8230;&#8203;)</code> attribute is required for Java 7; for Java 8 it can be omitted if the (non-ASF) <a href="http://github.com/isisaddons/isis-metamodel-paraname8">Isis addons' paraname8</a> metamodel extension is used.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Parameter_mustSatisfy">3.19.2. <code>mustSatisfy()</code></h4>
<div class="paragraph">
<p>The <code>mustSatisfy()</code> attribute allows arbitrary validation to be applied to parameters using an (implementation of a) <code>org.apache.isis.applib.spec.Specification</code> object.  The attribute is also supported on <a href="#_rg_annotations_manpage-Property_mustSatisfy">properties</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The specification implementations can (of course) be reused between parameters and <a href="#_rg_annotations_manpage-Property_mustSatisfy">properties</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>Specification</code> is consulted during validation, being passed the proposed value.  If the proposed value fails, then the value returned is the used as the invalidity reason.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">StartWithCapitalLetterSpecification</span>
        <span class="directive">extends</span> AbstractSpecification&lt;<span class="predefined-type">String</span>&gt; {            <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="predefined-type">String</span> satisfiesSafely(<span class="predefined-type">String</span> proposed) {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>.equals(proposed)
            ? <span class="string"><span class="delimiter">&quot;</span><span class="content">Empty string</span><span class="delimiter">&quot;</span></span>
            : !<span class="predefined-type">Character</span>.isUpperCase(proposed.charAt(<span class="integer">0</span>))
                ? <span class="string"><span class="delimiter">&quot;</span><span class="content">Does not start with a capital letter</span><span class="delimiter">&quot;</span></span>
                : <span class="predefined-constant">null</span>;
    }
}
<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerRepository</span> {
    <span class="directive">public</span> Customer newCustomer(
            <span class="annotation">@Parameter</span>(
                mustSatisfy=StartWithCapitalLetterSpecification.class
            )
            <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">First Name</span><span class="delimiter">&quot;</span></span>)
            <span class="directive">final</span> <span class="predefined-type">String</span> firstName,
            <span class="annotation">@Parameter</span>(
                mustSatisfy=StartWithCapitalLetterSpecification.class
            )
            <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Last Name</span><span class="delimiter">&quot;</span></span>)
            <span class="directive">final</span> <span class="predefined-type">String</span> lastName) {
        ...
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>AbstractSpecification</code> class conveniently handles type-safety and dealing with null values.  The applib also provides <code>SpecificationAnd</code> and <code>SpecificationOr</code> to allow specifications to be combined "algebraically".</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is also possible to provide translatable reasons.  Rather than implement <code>Specification</code>, instead implement <code>Specification2</code> which defines the API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Specification2</span> <span class="directive">extends</span> Specification {
    <span class="directive">public</span> TranslatableString satisfiesTranslatable(<span class="predefined-type">Object</span> obj); <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Return <code>null</code> if specification satisfied, otherwise the reason as a translatable string</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With <code>Specification2</code> there is no need to implement the inherited <code>satifies(Object)</code>; that method will never be called.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Parameter_optionality">3.19.3. <code>optionality()</code></h4>
<div class="paragraph">
<p>By default, Apache Isis assumes that all parameters of an action are required (mandatory).  The <code>optionality()</code> attribute allows this to be relaxed.  The attribute is also supported for <a href="#_rg_annotations_manpage-Property_optionality">properties</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The attribute has no meaning for a primitive type such as <code>int</code>: primitives will always have a default value (e.g. zero).  If optionality is required, then use the corresponding wrapper class (e.g. <code>java.lang.Integer</code>) and annotate with <code>Parameter#optionality()</code> as required.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The values for the attribute are simply <code>OPTIONAL</code> or <code>MANDATORY</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">public</span> Order placeOrder(
            <span class="directive">final</span> Product product,
            <span class="annotation">@ParameterLayout</span>(named = <span class="string"><span class="delimiter">&quot;</span><span class="content">Quantity</span><span class="delimiter">&quot;</span></span>)
            <span class="directive">final</span> <span class="type">int</span> quantity,
            <span class="annotation">@Parameter</span>(optionality = Optionality.OPTIONAL)
            <span class="annotation">@ParameterLayout</span>(named = <span class="string"><span class="delimiter">&quot;</span><span class="content">Special Instructions</span><span class="delimiter">&quot;</span></span>)
            <span class="directive">final</span> <span class="predefined-type">String</span> instr) {
        ...
    }
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Parameter_regexPattern">3.19.4. <code>regexPattern()</code></h4>
<div class="paragraph">
<p>The <code>regexPattern()</code> attribute validates the contents of any string parameter with respect to a regular expression pattern. It is ignored if applied to parameters of any other type. This attribute can also be specified for <a href="#_rg_annotations_manpage-Property_regexPattern">properties</a>.</p>
</div>
<div class="paragraph">
<p>The related <code>regexPatternFlags()</code> attribute specifies flags that modify the handling of the pattern.  The values are those that would normally be passed to <code>java.util.regex.Pattern#compile(String,int)</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">public</span> <span class="type">void</span> updateEmail(
            <span class="annotation">@Parameter</span>(
                regexPattern = <span class="string"><span class="delimiter">&quot;</span><span class="content">(</span><span class="char">\\</span><span class="content">w+</span><span class="char">\\</span><span class="content">.)*</span><span class="char">\\</span><span class="content">w+@(</span><span class="char">\\</span><span class="content">w+</span><span class="char">\\</span><span class="content">.)+[A-Za-z]+</span><span class="delimiter">&quot;</span></span>,
                regexPatternFlags=<span class="predefined-type">Pattern</span>.CASE_INSENSITIVE
            )
            <span class="annotation">@ParameterLayout</span>(named = <span class="string"><span class="delimiter">&quot;</span><span class="content">Email</span><span class="delimiter">&quot;</span></span>)
            <span class="directive">final</span> <span class="predefined-type">String</span> email) {
        ...
    }
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The related <code>regexPatternReplacement()</code> attribute is currently unused.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-ParameterLayout">3.20. <code>@ParameterLayout</code></h3>
<div class="paragraph">
<p>The <code>@ParameterLayout</code> annotation applies to action parameters, collecting together all UI hints within a single annotation.</p>
</div>
<div class="paragraph">
<p>The table below summarizes the annotation&#8217;s attributes.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 16. <code>@ParameterLayout</code> attributes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Values (default)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-ParameterLayout_cssClass"><code>cssClass()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any string valid as a CSS class</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>the css class that a parameter should have, to allow more targetted styling in <a href="#_rg_runtime_application-specific_application-css"><code>application.css</code></a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-ParameterLayout_describedAs"><code>describedAs()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>description of this parameter, eg to be rendered in a tooltip.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-ParameterLayout_labelPosition"><code>labelPosition()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LEFT</code>, <code>TOP</code>, <code>RIGHT</code>, <code>NONE</code><br>
(<code>LEFT</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>in forms, the positioning of the label relative to the property value.<br></p>
</div>
<div class="paragraph">
<p>Default is <code>LEFT</code>, unless <a href="#_rg_annotations_manpage-ParameterLayout_multiLine"><code>multiLine</code></a> in which case <code>TOP</code>.  The value <code>RIGHT</code> is only supported for boolean parameters.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-ParameterLayout_multiLine"><code>multiLine()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Positive integer</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>for string parameters, render as a text area over multiple lines.<br></p>
</div>
<div class="paragraph">
<p>If set &gt; 1, then then <a href="#_rg_annotations_manpage-ParameterLayout_labelPosition"><code>labelPosition</code></a> defaults to <code>TOP</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-ParameterLayout_named"><code>named()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>the name of this parameter.<br></p>
</div>
<div class="paragraph">
<p>For Java 7 this is generally required. For Java 8, the name can often be inferred from the code so this attribute allows the name to be overridden.  A typical use case is if the desired name is a reserved Java keyword, such as <code>default</code> or <code>package</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>namedEscaped()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code> (<code>true</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>whether to HTML escape the name of this parameter.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-ParameterLayout_renderedAsDayBefore"><code>renderedAsDayBefore()</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>for date parameters only, render the date as one day prior to the actually stored date (eg the end date of an open interval into a closed interval)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-ParameterLayout_typicalLength"><code>typicalLength()</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>the typical entry length of a field, use to determine the optimum width for display</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    <span class="directive">public</span> ToDoItem updateDescription(
                        <span class="annotation">@ParameterLayout</span>(
                            cssClass=<span class="string"><span class="delimiter">&quot;</span><span class="content">x-key</span><span class="delimiter">&quot;</span></span>,
                            describedAs=<span class="string"><span class="delimiter">&quot;</span><span class="content">What needs to be done</span><span class="delimiter">&quot;</span></span>,
                            labelPosition=LabelPosition.LEFT,
                            named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Description of this &lt;i&gt;item&lt;/i&gt;</span><span class="delimiter">&quot;</span></span>,
                            namedEscaped=<span class="predefined-constant">false</span>,
                            typicalLength=<span class="integer">80</span>)
                        <span class="directive">final</span> <span class="predefined-type">String</span> description) {
        setDescription(description);
        <span class="keyword">return</span> <span class="local-variable">this</span>;
    }
    ...
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that there is (currently) no support for specifying UI hints for domain services through the dynamic <a href="#_rg_object-layout_dynamic"><code>.layout.json</code></a> file (only for properties, collections and actions are supported).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-ParameterLayout_cssClass">3.20.1. <code>cssClass()</code></h4>
<div class="paragraph">
<p>The <code>cssClass()</code> attribute can be used to render additional CSS classes in the HTML (a wrapping <code>&lt;div&gt;</code>) that represents the action parameter.   <a href="#_rg_runtime_application-specific_application-css">Application-specific CSS</a> can then be used to target and adjust the UI representation of that particular element.</p>
</div>
<div class="paragraph">
<p>This attribute can also be applied to <a href="#_rg_annotations_manpage-DomainObjectLayout_cssClass">domain objects</a>, <a href="#_rg_annotations_manpage-ViewModelLayout_cssClass">view models</a>, <a href="#_rg_annotations_manpage-ActionLayout_cssClass">actions</a> <a href="#_rg_annotations_manpage-PropertyLayout_cssClass">properties</a>,  <a href="#_rg_annotations_manpage-CollectionLayout_cssClass">collections</a> and <a href="#_rg_annotations_manpage-ParameterLayout_cssClass">parameters</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    <span class="directive">public</span> ToDoItem postpone(
            <span class="annotation">@ParameterLayout</span>(
                named=<span class="string"><span class="delimiter">&quot;</span><span class="content">until</span><span class="delimiter">&quot;</span></span>,
                cssClass=<span class="string"><span class="delimiter">&quot;</span><span class="content">x-key</span><span class="delimiter">&quot;</span></span>
            )
            LocalDate until
        ) { ... }
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-ParameterLayout_describedAs">3.20.2. <code>describedAs()</code></h4>
<div class="paragraph">
<p>The <code>describedAs()</code> attribute is used to provide a short description of the action parameter to the user.  In the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> it is displayed as a 'tool tip'.  The <code>describedAs()</code> attribute can also be specified for <a href="#_rg_annotations_manpage-CollectionLayout_describedAs">collections</a>,  <a href="#_rg_annotations_manpage-PropertyLayout_describedAs">properties</a>, <a href="#_rg_annotations_manpage-ActionLayout_describedAs">actions</a>, <a href="#_rg_annotations_manpage-DomainObjectLayout_describedAs">domain objects</a> and <a href="#_rg_annotations_manpage-ViewModelLayout_describedAs">view models</a>.</p>
</div>
<div class="paragraph">
<p>Descriptions may be provided for objects, members (properties,
collections and actions), and for individual parameters within an action
method. <code>@DescribedAs</code> therefore works in a very similar manner to
<code>@Named</code> &lt;!--(see ?)-&#8594;.</p>
</div>
<div class="paragraph">
<p>To provide a description for an individual action parameter, use the
<code>@DescribedAs</code> annotation in-line i.e. immediately before the parameter
declaration.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">public</span> Order placeOrder(
                      Product product,
                      <span class="annotation">@ParameterLayout</span>(
                          named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Quantity</span><span class="delimiter">&quot;</span></span>,
                          describedAs=<span class="string"><span class="delimiter">&quot;</span><span class="content">The quantity of the product being ordered</span><span class="delimiter">&quot;</span></span>
                      )
                      <span class="type">int</span> quantity) {
        ...
    }
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-ParameterLayout_labelPosition">3.20.3. <code>labelPosition()</code></h4>
<div class="paragraph">
<p>The <code>labelPosition()</code> attribute determines the positioning of labels for parameters.  This attribute can also be specified for <a href="#_rg_annotations_manpage-PropertyLayout_labelPosition">properties</a>.</p>
</div>
<div class="paragraph">
<p>The positioning of labels is typically <code>LEFT</code>, but can be positioned to the <code>TOP</code>.  The one exception is <a href="#_rg_annotations_manpage-ParameterLayout_multiLine"><code>multiLine()</code></a> string parameters, where the label defaults to <code>TOP</code> automatically (to provide as much real-estate for the multiline text field as possible).</p>
</div>
<div class="paragraph">
<p>For boolean parameters a positioning of <code>RIGHT</code> is also allowed; this is ignored for all other types.</p>
</div>
<div class="paragraph">
<p>It is also possible to suppress the label altogether, using <code>NONE</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Order</span> {
    <span class="directive">public</span> Order changeStatus(
                    OrderStatus newStatus
                    <span class="annotation">@Parameter</span>(
                        optionality=Optionality.OPTIONAL
                    )
                    <span class="annotation">@ParameterLayout</span>(
                        named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Reason</span><span class="delimiter">&quot;</span></span>,
                        labelPosition=LabelPosition.TOP
                    )
                    <span class="predefined-type">String</span> reason) {
        ...
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To get an idea of how these are rendered (in the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a>), see <a href="#_rg_annotations_manpage-PropertyLayout_labelPosition">PropertyLayout#labelPosition()</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-ParameterLayout_multiLine">3.20.4. <code>multiLine()</code></h4>
<div class="paragraph">
<p>The <code>multiLine()</code> attribute specifies that the text field for a string parameter should span multiple lines.  It is ignored for other parameter types.  The attribute is also supported for <a href="#_rg_annotations_manpage-PropertyLayout_multiLine">properties</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">BugReport</span> {
    <span class="directive">public</span> BugReport updateStepsToReproduce(
                        <span class="annotation">@Parameter</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Steps</span><span class="delimiter">&quot;</span></span>)
                        <span class="annotation">@ParameterLayout</span>(
                            numberOfLines=<span class="integer">10</span>
                        )
                        <span class="directive">final</span> <span class="predefined-type">String</span> steps) {
        ...
    }
    ...
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If set &gt; 1 (as would normally be the case), then the default <a href="#_rg_annotations_manpage-ParameterLayout_labelPosition"><code>labelPosition</code></a> defaults to <code>TOP</code> (rather than <code>LEFT</code>, as would normally be the case).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-ParameterLayout_named">3.20.5. <code>named()</code></h4>
<div class="paragraph">
<p>The <code>named()</code> attribute explicitly specifies the action parameter&#8217;s name. This attribute can also be specified for <a href="#_rg_annotations_manpage-ActionLayout_named">actions</a>, <a href="#_rg_annotations_manpage-CollectionLayout_named">collections</a>, <a href="#_rg_annotations_manpage-PropertyLayout_named">properties</a>, <a href="#_rg_annotations_manpage-DomainObjectLayout_named">domain objects</a>, <a href="#_rg_annotations_manpage-ViewModelLayout_named">view models</a> and <a href="#_rg_annotations_manpage-DomainServiceLayout_named">domain services</a>.</p>
</div>
<div class="paragraph">
<p>Unlike most other aspects of the Apache Isis metamodel, the name of method parameters cannot (prior to Java 8, at least) be inferred from the Java source code.  Without other information, Apache Isis uses the object&#8217;s type (<code>int</code>, <code>String</code> etc) as the name instead.  This can be sufficient for application-specific reference types (eg <code>ToDoItem</code>) but is generally not sufficient for primitives and other value types.</p>
</div>
<div class="paragraph">
<p>The <code>named()</code> attribute (or the <a href="#_rg_annotations_aaa_deprecated">deprecated <code>@Named</code></a> annotation) is therefore often required to specify the parameter name.</p>
</div>
<div class="paragraph">
<p>As of Java 8, the Java reflection API has been extended.  The (non-ASF) <a href="http://github.com/isisaddons/isis-metamodel-paraname8">Isis addons' paraname8</a> metamodel extension provides support for this.  Note that your application must (obviously) be running on Java 8, and be compiled with the <code>-parameters</code> compile flag for javac.</p>
</div>
<div class="paragraph">
<p>By default the name is HTML escaped.  To allow HTML markup, set the related <code>namedEscaped()</code> attribute to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">public</span> Order placeOrder(
            <span class="directive">final</span> Product product
           ,<span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Quantity</span><span class="delimiter">&quot;</span></span>)
            <span class="directive">final</span> <span class="type">int</span> quantity) {
        Order order = newTransientInstance(Order.class);
        order.modifyCustomer(<span class="local-variable">this</span>);
        order.modifyProduct(product);
        order.setQuantity(quantity);
        <span class="keyword">return</span> order;
    }
    ...
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The framework also provides a separate, powerful mechanism for <a href="ug.html#_ug_more-advanced_i18n">internationalization</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-ParameterLayout_renderedAsDayBefore">3.20.6. <code>renderedAsDayBefore()</code></h4>
<div class="paragraph">
<p>The <code>renderedAsDayBefore()</code> attribute applies only to date parameters whereby the date will be rendered as the day before the value actually held in the domain object.  It is ignored for parameters of other types.  This attribute is also supported for <a href="#_rg_annotations_manpage-PropertyLayout_renderedAsDayBefore">properties</a>.</p>
</div>
<div class="paragraph">
<p>This behaviour might at first glance appear odd, but the rationale is to support the use case of a sequence of instances that represent adjacent intervals of time.  In such cases there would typically be <code>startDate</code> and <code>endDate</code> properties, eg for all of Q2.  Storing this as a half-closed interval&#8201;&#8212;&#8201;eg <code>[1-Apr-2015, 1-July-2015)</code>&#8201;&#8212;&#8201;can substantially simplify internal algorithms; the <code>endDate</code> of one interval will correspond to the <code>startDate</code> of the next.</p>
</div>
<div class="paragraph">
<p>However, from an end-user perspective the requirement may be to render the interval as a fully closed interval; eg the end date should be shown as <code>30-Jun-2015</code>.</p>
</div>
<div class="paragraph">
<p>This attribute therefore bridges the gap; it presents the information in a way that makes sense to an end-user, but also stores the domain object in a way that is easy work with internally.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Tenancy</span> {
    <span class="directive">public</span> <span class="type">void</span> changeDates(
        <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Start Date</span><span class="delimiter">&quot;</span></span>)
        LocalDate startDate,
        <span class="annotation">@ParameterLayout</span>(
            named=<span class="string"><span class="delimiter">&quot;</span><span class="content">End Date</span><span class="delimiter">&quot;</span></span>,
            renderedAsDayBefore=<span class="predefined-constant">true</span>
        )
        LocalDate endDate) {
        ...
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-ParameterLayout_typicalLength">3.20.7. <code>typicalLength()</code></h4>
<div class="paragraph">
<p>The <code>typicalLength()</code> attribute indicates the typical length of a string parameter.  It is ignored for parameters of other types.  The attribute is also supported for <a href="#_rg_annotations_manpage-PropertyLayout_typicalLength">properties</a>.</p>
</div>
<div class="paragraph">
<p>The information is intended as a hint to the UI to determine the space that should be given to render a particular string parameter.  That said, note that the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> uses the maximum space available for all fields, so in effect ignores this attribute.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">public</span> Customer updateName(
                <span class="annotation">@Parameter</span>(maxLength=<span class="integer">30</span>)
                <span class="annotation">@ParameterLayout</span>(
                    named=<span class="string"><span class="delimiter">&quot;</span><span class="content">First name</span><span class="delimiter">&quot;</span></span>,
                    typicalLength=<span class="integer">20</span>
                )
                <span class="directive">final</span> <span class="predefined-type">String</span> firstName,
                <span class="annotation">@Parameter</span>(maxLength=<span class="integer">30</span>)
                <span class="annotation">@ParameterLayout</span>(
                    named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Last name</span><span class="delimiter">&quot;</span></span>,
                    typicalLength=<span class="integer">20</span>
                )
                <span class="directive">final</span> <span class="predefined-type">String</span> lastName) {
        ...
    }
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-PersistenceCapable">3.21. <code>@PersistenceCapable</code> (<code>javax.jdo</code>)</h3>
<div class="paragraph">
<p>The <code>@javax.jdo.annotation.PersistenceCapable</code> is used by JDO/DataNucleus to indicate that a class is a domain entity to be persisted to the database.</p>
</div>
<div class="paragraph">
<p>Apache Isis also checks for this annotation, and if the <code>@PersistenceCapable#schema()</code> attribute is present will use it to form the object type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Isis parses the <code>@PersistenceCapable</code> annotation from the Java source code; it does not query the JDO metamodel.  This means that it the <code>@PersistenceCapable</code> annotation must be used rather than the equivalent <code>&lt;class&gt;</code> <a href="http://www.datanucleus.org/products/accessplatform_4_0/jdo/class_mapping.html">XML metadata</a>.</p>
</div>
<div class="paragraph">
<p>Moreover, while JDO/DataNucleus will recognize annotations on either the field or the getter method, Apache Isis (currently) only inspects the getter method.  Therefore ensure that the annotation is placed there.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The object type is used internally by Apache Isis to generate a string representation of an objects identity (the <code>Oid</code>).  This can appear in several contexts, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>as the value of <code>o.a.i.applib.services.bookmark.Bookmark#getObjectType()</code></p>
</li>
<li>
<p>in the <code>toString()</code> value of <code>Bookmark</code></p>
</li>
<li>
<p>in the URLs of the <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a></p>
</li>
<li>
<p>in the URLs of the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> (in general and in particular if <a href="ug.html#_ug_wicket-viewer_features_hints-and-copy-url">copying URLs</a>)</p>
</li>
<li>
<p>in XML snapshots generated by the <a href="#_rg_services-api_manpage-XmlSnapshotService"><code>XmlSnapshotService</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The actual format of the object type used by Apache Isis for the concatenation of <code>schema()</code> and <code>@PersistenceCapable#table()</code>.  If the <code>table()</code> is not present, then the class' simple name is used instead.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.PersistenceCapable(schema=<span class="string"><span class="delimiter">&quot;</span><span class="content">custmgmt</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>has an object type of <code>custmgmt.Customer</code>, while:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.PersistenceCapable(schema=<span class="string"><span class="delimiter">&quot;</span><span class="content">custmgmt</span><span class="delimiter">&quot;</span></span>, table=<span class="string"><span class="delimiter">&quot;</span><span class="content">Address</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AddressImpl</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>has an object type of <code>custmgmt.Address</code>.</p>
</div>
<div class="paragraph">
<p>On the other hand:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.PersistenceCapable(table=<span class="string"><span class="delimiter">&quot;</span><span class="content">Address</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AddressImpl</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>does <em>not</em> correspond to an object type, because the <code>schema()</code> attribute is missing.</p>
</div>
<div class="paragraph">
<p>If the object type has not been specified, then Apache Isis will use the fully qualified class name of the entity.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This might be obvious, but to make explicit: we recommend that you use namespaces of some form or other.</p>
</div>
<div class="paragraph">
<p>If the object type has not been specified (by either this annotation, or by <a href="#_rg_annotations_manpage-Discriminator"><code>@Discriminator</code></a>, or by Apache Isis' own <a href="#_rg_annotations_manpage-ObjectType"><code>@DomainObject#objectType()</code></a> annotation/attribute), then (as noted above) Apache Isis will use the fully qualified class name of the entity.</p>
</div>
<div class="paragraph">
<p>However, chances are that the fully qualified class name is liable to change over time, for example if the code is refactored or (more fundamentally) if your company/organization reorganizes/renames itself/is acquired.</p>
</div>
<div class="paragraph">
<p>Isis' recognition of <code>@PersistenceCapable#schema()</code> makes namespacing of object types comparatively trivial, and moreover aligns the namespacing with the way in which the tables in the database are namespaced by the database schema.</p>
</div>
<div class="paragraph">
<p>We therefore strongly recommend that you specify an object type for all entities, one way or another.  Using <code>@PersistenceCapable#schema()</code> is probably the best choice in most cases.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the object type is not unique across all domain classes then the framework will fail-fast and fail to boot.  An error message will be printed in the log to help you determine which classes have duplicate object tyoes.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-PostConstruct">3.22. <code>@PostConstruct</code> (<code>javax</code>)</h3>
<div class="paragraph">
<p>The <code>@javax.annotation.PostConstruct</code> annotation, as defined in <a href="https://jcp.org/en/jsr/detail?id=250">JSR-250</a>,  is recognized by Apache Isis as a callback method on domain services to be called just after they have been constructed, in order that they initialize themselves.</p>
</div>
<div class="paragraph">
<p>For the default application-scoped (singleton) domain services, this means that the method, if present, is called during the bootstrapping of the application.  For <a href="#_rg_annotations_manpage-RequestScoped"><code>@RequestScoped</code></a> domain services, the method is called at the beginning of the request.</p>
</div>
<div class="paragraph">
<p>The signature of the method is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PostConstruct</span>                          <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">void</span> postConstruct() { ... }     <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>(As of 1.9.0) it is not necessary to annotate the method with <a href="#_rg_annotations_manpage-Programmatic"><code>@Programmatic</code></a>; it will be automatically excluded from the Apache Isis metamodel.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the method can have any name, but must have <code>public</code> visibility.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the form shown above the method can either accept no arguments.  Alternatively, the method can accept a parameter of type <code>Map&lt;String,String&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PostConstruct</span>
<span class="annotation">@Programmatic</span>
<span class="directive">public</span> <span class="type">void</span> postConstruct(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>,<span class="predefined-type">String</span>&gt; properties) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Isis uses argument to pass in the configuration properties read from all <a href="#_rg_runtime_configuration-files">configuration files</a>:</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Alternatively, you could inject <a href="#_rg_services-api_manpage-DomainObjectContainer"><code>DomainObjectContainer</code></a> into the service and read configuration properties using <code>DomainObjectContainer#getProperty(&#8230;&#8203;)</code> and related methods.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A common use case is for domain services that interact with the <a href="#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a>.  For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature=NatureOfService.DOMAIN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MySubscribingService</span> {
    <span class="annotation">@Programmatic</span>
    <span class="annotation">@PostConstruct</span>
    <span class="directive">public</span> <span class="type">void</span> postConstruct() {
        eventBusService.register(<span class="local-variable">this</span>);
    }
    <span class="annotation">@Programmatic</span>
    <span class="annotation">@PreDestroy</span>
    <span class="directive">public</span> <span class="type">void</span> preDestroy() {
        eventBusService.unregister(<span class="local-variable">this</span>);
    }
    ...
    <span class="annotation">@javax</span>.inject.Inject
    EventBusService eventBusService;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other use cases include obtaining connections to external datasources, eg subscribing to an ActiveMQ router, say, or initializing/cleaning up a background scheduler such as Quartz.</p>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_annotations_manpage-PreDestroy"><code>@PreDestroy</code></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-PreDestroy">3.23. <code>@PreDestroy</code> (<code>javax</code>)</h3>
<div class="paragraph">
<p>The <code>@javax.annotation.PreDestroy</code> annotation, as defined in <a href="https://jcp.org/en/jsr/detail?id=250">JSR-250</a>, recognized by Apache Isis as a callback method on domain services to be called just as they go out of scope.</p>
</div>
<div class="paragraph">
<p>For the default application-scoped (singleton) domain services, this means that the method, if present, is called just prior to the termination of the application.  For <a href="#_rg_annotations_manpage-RequestScoped"><code>@RequestScoped</code></a> domain services, the method is called at the end of the request.</p>
</div>
<div class="paragraph">
<p>The signature of the method is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PreDestroy</span>                         <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">void</span> preDestroy() { ... }    <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>(As of 1.9.0) it is not necessary to annotate the method with <a href="#_rg_annotations_manpage-Programmatic"><code>@Programmatic</code></a>; it will be automatically excluded from the Apache Isis metamodel.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the method can have any name, but must have <code>public</code> visibility, and accept no arguments.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A common use case is for domain services that interact with the <a href="#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a>.  For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature=NatureOfService.DOMAIN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MySubscribingService</span> {
    <span class="annotation">@Programmatic</span>
    <span class="annotation">@PostConstruct</span>
    <span class="directive">public</span> <span class="type">void</span> postConstruct() {
        eventBusService.register(<span class="local-variable">this</span>);
    }
    <span class="annotation">@Programmatic</span>
    <span class="annotation">@PreDestroy</span>
    <span class="directive">public</span> <span class="type">void</span> preDestroy() {
        eventBusService.unregister(<span class="local-variable">this</span>);
    }
    ...
    <span class="annotation">@javax</span>.inject.Inject
    EventBusService eventBusService;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other use cases include obtaining connections to external datasources, eg subscribing to an ActiveMQ router, say, or initializing/cleaning up a background scheduler such as Quartz.</p>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_annotations_manpage-PostConstruct"><code>@PostConstruct</code></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-PrimaryKey">3.24. <code>@PrimaryKey</code> (<code>javax.jdo</code>)</h3>
<div class="paragraph">
<p>The <code>@javax.jdo.annotation.PrimaryKey</code> annotation is used by JDO/DataNucleus to indicate that a property is used as the primary key for an entity with application-managed identity.</p>
</div>
<div class="paragraph">
<p>Apache Isis also uses this annotation in a very minimal way: to ensure that the framework&#8217;s own logic to initialize newly instantiated objects (eg using <a href="#_rg_services-api_manpage-DomainObjectContainer"><code>DomainObjectContainer#newTransientInstance(&#8230;&#8203;)</code></a> does not touch the primary key, and also to ensure that the primary key property is always disabled (read-only).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Isis parses the <code>@NotPersistent</code> annotation from the Java source code; it does not query the JDO metamodel.  This means that it the <code>@NotPersistent</code> annotation must be used rather than the equivalent <code>&lt;field&gt;</code> <a href="http://www.datanucleus.org/products/accessplatform_4_0/jdo/application_identity.html">XML metadata</a>.</p>
</div>
<div class="paragraph">
<p>Moreover, while JDO/DataNucleus will recognize annotations on either the field or the getter method, Apache Isis (currently) only inspects the getter method.  Therefore ensure that the annotation is placed there.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-Programmatic">3.25. <code>@Programmatic</code></h3>
<div class="paragraph">
<p>The <code>@Programmatic</code> annotation causes the method to be excluded completely from the Apache Isis metamodel. This means it won&#8217;t appear in any UI, and it won&#8217;t appear in any <a href="#_rg_services-api_manpage-MementoService">memento</a>s or <a href="#_rg_services-api_manpage-XmlSnapshotService">snapshot</a>s.</p>
</div>
<div class="paragraph">
<p>A common use-case is to ignore implementation-level artifacts. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> <span class="directive">implements</span> <span class="predefined-type">Comparable</span>&lt;Customer&gt; {
    ...
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="type">int</span> compareTo(Customer c) {
        <span class="keyword">return</span> getSalary() - c.getSalary();
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>@Programmatic</code> does not simply imply <code>@Hidden</code>; it actually means that the class member will not be part of the Apache Isis metamodel.</p>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-Property">3.26. <code>@Property</code></h3>
<div class="paragraph">
<p>The <code>@Property</code> annotation applies to properties collecting together all domain semantics within a single annotation.</p>
</div>
<div class="paragraph">
<p>It is also possible to apply the annotation to actions of domain services that are acting as <a href="../../more-advanced-topics/how-to-01-062-How-to-decouple-dependencies-using-contributions.html">contributed properties</a>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 17. <code>@Property</code> attributes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Values (default)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Property_domainEvent"><code>domainEvent()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">subtype of <code>PropertyDomainEvent</code><br>
(<code>PropertyDomainEvent.Default</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>the event type to be posted to the <a href="#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a> to broadcast the property&#8217;s business rule checking (hide, disable, validate) and its modification (before and after).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Property_editing"><code>editing()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ENABLED</code>, <code>DISABLED</code>, <code>AS_CONFIGURED</code><br>
(<code>AS_CONFIGURED</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>whether a property can be modified or cleared from within the UI</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Property_hidden"><code>hidden()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EVERYWHERE</code>, <code>OBJECT_FORMS</code>, <code>PARENTED_TABLES</code>, <code>STANDALONE_TABLES</code>, <code>ALL_TABLES</code>, <code>NOWHERE</code><br>
(<code>NOWHERE</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>indicates where (in the UI) the property should be hidden from the user.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Property_maxLength"><code>maxLength()</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>maximum number of characters for string parameters; ignored otherwise<br></p>
</div>
<div class="paragraph">
<p>In many/most cases you should however use <a href="#_rg_annotations_manpage-Column"><code>@Column#length()</code></a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Property_mustSatisfy"><code>mustSatisfy()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implementation of <code>o.a.i.applib.spec.Specification</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>allows arbitrary validation to be applied</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Property_notPersisted"><code>notPersisted()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code><br>
(<code>false</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>whether to exclude from snapshots.<br></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Property must also be annotated with <code>@javax.jdo.annotations.NotPersistent</code> in order to not be persisted.</p>
</div>
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Property_optionality"><code>optionality()</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>specifies a property is optional rather than mandatory<br></p>
</div>
<div class="paragraph">
<p>In many/most cases you should however use <a href="#_rg_annotations_manpage-Column"><code>@Column#allowNulls()</code></a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-Property_regexPattern"><code>regexPattern()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">regular expression</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>validates the contents of a string parameter against the regular expression pattern</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>regexPatternFlags()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value of flags as normally passed to <code>java.util.regex.</code><br>
<code>Pattern#compile(&#8230;&#8203;)</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>modifies the compilation of the regular expression</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObject</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">EmailSpecification</span> <span class="directive">extends</span> AbstractSpecification&lt;<span class="predefined-type">String</span>&gt; {
        <span class="directive">public</span> <span class="predefined-type">String</span> satisfiesSafely(<span class="predefined-type">String</span> proposed) {
            <span class="keyword">return</span> EmailUtil.ensureValidEmail(proposed);    <i class="conum" data-value="1"></i><b>(1)</b>
        }
    }
    <span class="annotation">@javax</span>.jdo.annotations.Column(allowNulls=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>)                <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="annotation">@Property</span>(
        maxLength=<span class="integer">30</span>,
        minLength=<span class="integer">5</span>,
        mustSatisfy=EmailSpecification.class,
        regexPattern = <span class="string"><span class="delimiter">&quot;</span><span class="content">(</span><span class="char">\\</span><span class="content">w+</span><span class="char">\\</span><span class="content">.)*</span><span class="char">\\</span><span class="content">w+@(</span><span class="char">\\</span><span class="content">w+</span><span class="char">\\</span><span class="content">.)+[A-Za-z]+</span><span class="delimiter">&quot;</span></span>,
        regexPatternFlags=<span class="predefined-type">Pattern</span>.CASE_INSENSITIVE
    )
    <span class="directive">public</span> <span class="predefined-type">String</span> getEmailAddress() { ... }
    <span class="directive">public</span> <span class="type">void</span> setEmailAddress(<span class="predefined-type">String</span> emailAddress) { ... }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the (fictitious) <code>EmailUtil.ensureValid(&#8230;&#8203;)</code> (omitted for brevity) returns a string explaining if an email is invalid</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>generally use instead of the <code>@Property#optionality()</code> attribute</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Property_domainEvent">3.26.1. <code>domainEvent()</code></h4>
<div class="paragraph">
<p>Whenever a domain object (or list of domain objects) is to be rendered, the framework fires off multiple domain events for every property, collection and action of the domain object.  In the cases of the domain object&#8217;s properties, the events that are fired are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>hide phase: to check that the property is visible (has not been hidden)</p>
</li>
<li>
<p>disable phase: to check that the property is usable (has not been disabled)</p>
</li>
<li>
<p>validate phase: to check that the property&#8217;s arguments are valid (to modify/clear its value)</p>
</li>
<li>
<p>pre-execute phase: before the modification of the property</p>
</li>
<li>
<p>post-execute: after the modification of the property</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Subscribers subscribe through the <a href="#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a> using either <a href="https://github.com/google/guava">Guava</a> or <a href="http://www.axonframework.org/">Axon Framework</a> annotations and can influence each of these phases.</p>
</div>
<div class="paragraph">
<p>By default the event raised is <code>PropertyDomainEvent.Default</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    <span class="annotation">@Property</span>()
    <span class="directive">public</span> LocalDate getDueBy() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The purpose of the <code>domainEvent()</code> attribute is to allows a custom subclass to be emitted instead. This attribute is also supported for <a href="#_rg_annotations_manpage-Action_domainEvent">actions</a> and <a href="#_rg_annotations_manpage-Property_domainEvent">properties</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">DueByChangedEvent</span> <span class="directive">extends</span> PropertyDomainEvent&lt;ToDoItem, LocalDate&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1L</span>;
        <span class="directive">public</span> DueByChangedEvent(                                                            <i class="conum" data-value="2"></i><b>(2)</b>
                ToDoItem source,                                                             <i class="conum" data-value="3"></i><b>(3)</b>
                Identifier identifier,                                                       <i class="conum" data-value="4"></i><b>(4)</b>
                LocalDate oldValue,                                                          <i class="conum" data-value="5"></i><b>(5)</b>
                LocalDate newValue) {                                                        <i class="conum" data-value="6"></i><b>(6)</b>
            <span class="local-variable">super</span>(source, identifier, oldValue, newValue);
        }
    }
    <span class="annotation">@Property</span>(domainEvent=ToDoItem.DueByChangedEvent)
    <span class="directive">public</span> LocalDate getDueBy() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>inherit from <code>PropertyDomainEvent&lt;T,P&gt;</code> where <code>T</code> is the type of the domain object being interacted with, and <code>P</code> is the type of the property (<code>LocalDate</code> in this example)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>constructor called reflectively by the framework</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>populated with the object being interacted with (the source of the event)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>identifier of the property</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>current value of the property</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>proposed new value for the property; if being cleared then will be <code>null</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The benefit is that subscribers can be more targetted as to the events that they subscribe to.</p>
</div>
<div class="sect4">
<h5 id="_subscribers_3">Subscribers</h5>
<div class="paragraph">
<p>Subscribers (which must be domain services) subscribe using either the <a href="https://github.com/google/guava">Guava</a> API or (if the <a href="#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a> has been appropriately configured) using the <a href="http://www.axonframework.org/">Axon Framework</a> API.  The examples below use the Guava API.</p>
</div>
<div class="paragraph">
<p>Subscribers can be either coarse-grained (if they subscribe to the top-level event type):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeSubscriber</span> {

    <span class="annotation">@Programmatic</span>
    <span class="annotation">@com</span>.google.common.eventbus.Subscribe
    <span class="directive">public</span> <span class="type">void</span> on(PropertyInteractionEvent ev) {

        ...
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or can be fine-grained (by subscribing to specific event subtypes):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeSubscriber</span> {

    <span class="annotation">@Programmatic</span>
    <span class="annotation">@com</span>.google.common.eventbus.Subscribe
    <span class="directive">public</span> <span class="type">void</span> on(ToDoItem.DueByChangedEvent ev) {

        ...
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the AxonFramework is being used, replace <code>@com.google.common.eventbus.Subscribe</code> with <code>@org.axonframework.eventhandling.annotation.EventHandler</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The subscriber&#8217;s method is called (up to) 5 times:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>whether to veto visibility (hide)</p>
</li>
<li>
<p>whether to veto usability (disable)</p>
</li>
<li>
<p>whether to veto execution (validate)</p>
</li>
<li>
<p>steps to perform prior to the property being modified</p>
</li>
<li>
<p>steps to perform after the property has been modified.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The subscriber can distinguish these by calling <code>ev.getPhase()</code>. Thus the general form is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Programmatic</span>
<span class="annotation">@com</span>.google.common.eventbus.Subscribe
<span class="directive">public</span> <span class="type">void</span> on(PropertyDomainEvent ev) {
    <span class="keyword">switch</span>(ev.getPhase()) {
        <span class="keyword">case</span> HIDE:
            <span class="comment">// call ev.hide() or ev.veto(&quot;&quot;) to hide the property</span>
            <span class="keyword">break</span>;
        <span class="keyword">case</span> DISABLE:
            <span class="comment">// call ev.disable(&quot;...&quot;) or ev.veto(&quot;...&quot;) to disable the property</span>
            <span class="keyword">break</span>;
        <span class="keyword">case</span> VALIDATE:
            <span class="comment">// call ev.invalidate(&quot;...&quot;) or ev.veto(&quot;...&quot;)</span>
            <span class="comment">// if proposed property value is invalid</span>
            <span class="keyword">break</span>;
        <span class="keyword">case</span> EXECUTING:
            <span class="keyword">break</span>;
        <span class="keyword">case</span> EXECUTED:
            <span class="keyword">break</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to abort the transaction during the executing or executed phases by throwing an exception. If the exception is a subtype of <code>RecoverableException</code> then the exception will be rendered as a user-friendly warning (eg Growl/toast) rather than an error.</p>
</div>
</div>
<div class="sect4">
<h5 id="_raising_events_programmatically_3">Raising events programmatically</h5>
<div class="paragraph">
<p>Normally events are only raised for interactions through the UI. However, events can be raised programmatically by
wrapping the target object using the <a href="#_rg_services-api_manpage-WrapperFactory"><code>WrapperFactory</code></a> service.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Property_editing">3.26.2. <code>editing()</code></h4>
<div class="paragraph">
<p>The <code>editing()</code> attribute can be used to prevent a property from being modified or cleared, ie to make it read-only. This attribute can also be specified for <a href="#_rg_annotations_manpage-Collection_editing">collections</a>, and can also be specified for the <a href="#_rg_annotations_manpage-DomainObject_editing">domain object</a>.</p>
</div>
<div class="paragraph">
<p>The related <code>editingDisabledReason()</code> attribute specifies the a hard-coded reason why the property cannot be modified directly.</p>
</div>
<div class="paragraph">
<p>Whether a property is enabled or disabled depends upon these factors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>whether the domain object has been configured as immutable through the <a href="#_rg_annotations_manpage-DomainObject_editing"><code>@DomainObject#editing()</code></a> attribute</p>
</li>
<li>
<p>else (that is, if the domain object&#8217;s editability is specified as being <code>AS_CONFIGURED</code>), then the value of the <a href="#<em>rg_runtime_configuring-core">configuration property</a> <code>isis.objects.editing</code>.  If set to <code>false</code>, then the object&#8217;s properties (and collections) are _not</em> editable</p>
</li>
<li>
<p>else, then the value of the <code>@Property(editing=&#8230;&#8203;)</code> attribute itself</p>
</li>
<li>
<p>else, the result of invoking any supporting <a href="#_rg_methods_prefixes_manpage-disable"><code>disable&#8230;&#8203;()</code></a> supporting methods</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Thus, to make a property read-only even if the object would otherwise be editable, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@Property</span>(
        editing=Editing.DISABLED,
        editingDisabledReason=<span class="string"><span class="delimiter">&quot;</span><span class="content">The credit rating is derived from multiple factors</span><span class="delimiter">&quot;</span></span>
    )
    <span class="directive">public</span> <span class="type">int</span> getInitialCreditRating(){ ... }
    <span class="directive">public</span> <span class="type">void</span> setInitialCreditRating(<span class="type">int</span> initialCreditRating) { ... }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To reiterate, it is <em>not</em> possible to enable editing for a property if editing has been disabled at the object-level.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Property_hidden">3.26.3. <code>hidden()</code></h4>
<div class="paragraph">
<p>Properties can be hidden at the domain-level, indicating that they are not visible to the end-user.  This attribute can also be applied to <a href="#_rg_annotations_manpage-ActionLayout_hidden">actions</a> and <a href="#_rg_annotations_manpage-CollectionLayout_hidden">collections</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is also possible to use <a href="#_rg_annotations_manpage-Property_hidden"><code>@Property#hidden()</code></a> to hide an action at the domain layer.  Both options are provided with a view that in the future the view-layer semantics may be under the control of (expert) users, whereas domain-layer semantics should never be overridden or modified by the user.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@Property</span>(hidden=Where.EVERYWHERE)
    <span class="directive">public</span> <span class="type">int</span> getInternalId() { ... }
    <span class="annotation">@Property</span>(hidden=Where.ALL_TABLES)
    <span class="directive">public</span> <span class="type">void</span> updateStatus() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The acceptable values for the <code>where</code> parameter are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Where.EVERYWHERE</code> or <code>Where.ANYWHERE</code><br></p>
<div class="paragraph">
<p>The property should be hidden everywhere.</p>
</div>
</li>
<li>
<p><code>Where.ANYWHERE</code><br></p>
<div class="paragraph">
<p>Synonym for everywhere.</p>
</div>
</li>
<li>
<p><code>Where.OBJECT_FORMS</code><br></p>
<div class="paragraph">
<p>The property should be hidden when displayed within an object form.</p>
</div>
</li>
<li>
<p><code>Where.PARENTED_TABLES</code><br></p>
<div class="paragraph">
<p>The property should be hidden when displayed as a column of a table within a parent object&#8217;s collection.</p>
</div>
</li>
<li>
<p><code>Where.STANDALONE_TABLES</code><br></p>
<div class="paragraph">
<p>The property should be hidden when displayed as a column of a table showing a standalone list of objects, for example as returned by a repository query.</p>
</div>
</li>
<li>
<p><code>Where.ALL_TABLES</code><br></p>
<div class="paragraph">
<p>The property should be hidden when displayed as a column of a table, either an object&#8217;s * collection or a standalone list. This combines <code>PARENTED_TABLES</code> and <code>STANDALONE_TABLES</code>.</p>
</div>
</li>
<li>
<p><code>Where.NOWHERE</code><br></p>
<div class="paragraph">
<p>The property should not be hidden, overriding any other metadata/conventions that would normally cause the property to be hidden.<br></p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, if a property is annotated with <a href="#_rg_annotations_manpage-Title"><code>@Title</code></a>, then normally this should be hidden from all
tables. Annotating with <code>@Property(where=Where.NOWHERE)</code> overrides this.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a> has only partial support for these <code>Where</code> enums.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Property_maxLength">3.26.4. <code>maxLength()</code></h4>
<div class="paragraph">
<p>The <code>maxLength()</code> attribute applies only to <code>String</code> properties, indicating the maximum number of characters that the user may enter (for example in a text field in the UI).  The attribute It is ignored if applied to properties of any other type.  This attribute can also be applied to <a href="#_rg_annotations_manpage-Parameter_maxLength">parameters</a>.</p>
</div>
<div class="paragraph">
<p>That said, properties are most commonly defined on persistent domain objects (entities), in which case the JDO <a href="#_rg_annotations_manpage-Column"><code>@Column</code></a> will in any case need to be specified.  Apache Isis can infer the <code>maxLength</code> semantic directly from the equivalent <code>@Column#length()</code> annotation/attribute.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@javax</span>.jdo.annotations.Column(length=<span class="integer">30</span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getFirstName() { ... }
    <span class="directive">public</span> <span class="type">void</span> setFirstName(<span class="predefined-type">String</span> firstName) { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case there is therefore no need for the <code>@Property#maxLength()</code> attribute.</p>
</div>
<div class="sect4">
<h5 id="_non_persistent_properties">Non-persistent properties</h5>
<div class="paragraph">
<p>Of course, not every property is persistent (it could instead be derived), and neither is every domain object an entity (it could be a view model).  For these non persistable properties the <code>maxLength()</code> attribute is still required.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@javax</span>.jdo.annotation.NotPersistent                    <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Property</span>(maxLength=<span class="integer">100</span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getFullName() { ... }                    <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> <span class="type">void</span> setFullName(<span class="predefined-type">String</span> fullName) { ... }       <i class="conum" data-value="3"></i><b>(3)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a non persisted (derived) property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>implementation would most likely derive full name from constituent parts (eg first name, middle initial, last name)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>implementation would most likely parse the input and update the constituent parts</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Property_mustSatisfy">3.26.5. <code>mustSatisfy()</code></h4>
<div class="paragraph">
<p>The <code>mustSatisfy()</code> attribute allows arbitrary validation to be applied to properties using an (implementation of a) <code>org.apache.isis.applib.spec.Specification</code> object.
 The attribute is also supported on <a href="#_rg_annotations_manpage-Parameter_mustSatisfy">parameters</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The specification implementations can (of course) be reused between properties and <a href="#_rg_annotations_manpage-Parameter_mustSatisfy">parameters</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>Specification</code> is consulted during validation, being passed the proposed value.  If the proposed value fails, then the value returned is the used as the invalidity reason.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">StartWithCapitalLetterSpecification</span>
        <span class="directive">extends</span> AbstractSpecification&lt;<span class="predefined-type">String</span>&gt; {            <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="predefined-type">String</span> satisfiesSafely(<span class="predefined-type">String</span> proposed) {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>.equals(proposed)
            ? <span class="string"><span class="delimiter">&quot;</span><span class="content">Empty string</span><span class="delimiter">&quot;</span></span>
            : !<span class="predefined-type">Character</span>.isUpperCase(proposed.charAt(<span class="integer">0</span>))
                ? <span class="string"><span class="delimiter">&quot;</span><span class="content">Does not start with a capital letter</span><span class="delimiter">&quot;</span></span>
                : <span class="predefined-constant">null</span>;
    }
}
<span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@Property</span>(mustSatisfy=StartWithCapitalLetterSpecification.class)
    <span class="directive">public</span> <span class="predefined-type">String</span> getFirstName() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>AbstractSpecification</code> class conveniently handles type-safety and dealing with null values.  The applib also provides <code>SpecificationAnd</code> and <code>SpecificationOr</code> to allow specifications to be combined "algebraically".</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is also possible to provide translatable reasons.  Rather than implement <code>Specification</code>, instead implement <code>Specification2</code> which defines the API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Specification2</span> <span class="directive">extends</span> Specification {
    <span class="directive">public</span> TranslatableString satisfiesTranslatable(<span class="predefined-type">Object</span> obj); <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Return <code>null</code> if specification satisfied, otherwise the reason as a translatable string</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With <code>Specification2</code> there is no need to implement the inherited <code>satifies(Object)</code>; that method will never be called.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Property_notPersisted">3.26.6. <code>notPersisted()</code></h4>
<div class="paragraph">
<p>The (somewhat misnamed) <code>notPersisted()</code> attribute indicates that the collection should be excluded from any snapshots generated by the <a href="#_rg_services-api_manpage-XmlSnapshotService"><code>XmlSnapshotService</code></a>.  This attribute is also supported for <a href="#_rg_annotations_manpage-Collection_notPersisted">collections</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This annotation does <em>not</em> specify that a property is not persisted in the JDO/DataNucleus objectstore.  See below for details as to how to additionally annotate the property for this.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Order</span> {
    <span class="annotation">@Property</span>(notPersisted=<span class="predefined-constant">true</span>)
    <span class="directive">public</span> Order getPreviousOrder() {...}
    <span class="directive">public</span> <span class="type">void</span> setPreviousOrder(Order previousOrder) {...}
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Historically this annotation also hinted as to whether the property&#8217;s value contents should be persisted in the object store.  However, the JDO/DataNucleus objectstore does not recognize this annotation.  Thus, to ensure that a property is actually not persisted, it should <strong>also</strong> be annotated with <code>@javax.jdo.annotations.NotPersistent</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Order</span> {
    <span class="annotation">@Property</span>(notPersisted=<span class="predefined-constant">true</span>)               <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@javax</span>.jdo.annotations.NotPersistent       <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> Order getPreviousOrder() {...}
    <span class="directive">public</span> <span class="type">void</span> setPreviousOrder(Order previousOrder) {...}
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>ignored by Apache Isis</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>ignored by JDO/DataNucleus</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, if the property is derived, then providing only a "getter" will also work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Order</span> {
    <span class="directive">public</span> Order getPreviousOrder() {...}
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Property_optionality">3.26.7. <code>optionality()</code></h4>
<div class="paragraph">
<p>By default, Apache Isis assumes that all properties of an domain object or view model are required (mandatory).  The <code>optionality()</code> attribute allows this to be relaxed.  The attribute is also supported for <a href="#_rg_annotations_manpage-Parameter_optionality">parameters</a>.</p>
</div>
<div class="paragraph">
<p>That said, properties are most commonly defined on persistent domain objects (entities), in which case the JDO <a href="#_rg_annotations_manpage-Column"><code>@Column</code></a> should be specified. Apache Isis can infer the maxLength directly from the equivalent @Column#length() annotation.</p>
</div>
<div class="paragraph">
<p>That said, properties are most commonly defined on persistent domain objects (entities), in which case the JDO <a href="#_rg_annotations_manpage-Column"><code>@Column</code></a> will in any case need to be specified.  Apache Isis can infer the <code>optionality</code> semantic directly from the equivalent <code>@Column#allowNulls()</code> annotation/attribute.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@javax</span>.jdo.annotations.Column(allowNulls=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getMiddleInitial() { ... }
    <span class="directive">public</span> <span class="type">void</span> setMiddleInitial(<span class="predefined-type">String</span> middleInitial) { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case there is no need for the <code>@Property#optionality()</code> attribute.</p>
</div>
<div class="sect4">
<h5 id="_mismatched_defaults">Mismatched defaults</h5>
<div class="paragraph">
<p>If the <code>@Column#allowNulls()</code> attribute is omitted and the `@Property#optionality() attribute is also omitted, then note that Isis' defaults and JDO&#8217;s defaults differ.  Specifically, Isis always assumes properties are mandatory, whereas JDO specifies that primitives are mandatory, but all reference types are optional.</p>
</div>
<div class="paragraph">
<p>When Apache Isis initializes it checks for these mismatches during its metamodel validation phase, and will fail to boot ("fail-fast") if there is a mismatch.  The fix is usually to add the <code>@Column#allowsNulls()</code> annotation/attribute.</p>
</div>
</div>
<div class="sect4">
<h5 id="_superclass_inheritance_type">Superclass inheritance type</h5>
<div class="paragraph">
<p>There is one case (at least) it may be necessary to annotate the property with both <code>@Column#allowsNull</code> and also <code>@Property#optionality()</code>.  If the property is logically mandatory and is in a subclass, but the mapping of the class hierarchy is to store both the superclass and subclass(es) into a single table (ie a "roll-up" mapping using <code>javax.jdo.annotations.InheritanceStrategy#SUPERCLASS_TABLE</code>), then JDO requires that the property is annotated as <code>@Column#allowsNull="true"</code>: its value will be not defined for other subclasses.</p>
</div>
<div class="paragraph">
<p>In this case we therefore require both annotations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.PersistenceCapable
<span class="annotation">@javax</span>.jdo.annotations.Inheritance(strategy = InheritanceStrategy.NEW_TABLE)
<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">PaymentMethod</span> {
    ...
}
<span class="annotation">@javax</span>.jdo.annotations.PersistenceCapable
<span class="annotation">@javax</span>.jdo.annotations.Inheritance(strategy = InheritanceStrategy.SUPERCLASS_TABLE)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CreditCardPaymentMethod</span> <span class="directive">extends</span> PaymentMethod {
    <span class="directive">private</span> <span class="predefined-type">String</span> cardNumber;
    <span class="annotation">@javax</span>.jdo.annotations.Column(allowNulls=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Property</span>(optionality=Optionality.MANDATORY)
    <span class="directive">public</span> <span class="predefined-type">String</span> getCardNumber() { <span class="keyword">return</span> <span class="local-variable">this</span>.cardNumber; }
    <span class="directive">public</span> <span class="type">void</span> setCardNumber(<span class="predefined-type">String</span> cardNumber) { <span class="local-variable">this</span>.cardNumber = cardNumber; }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you could rely on the fact that Apache Isis never looks at fields (whereas JDO does) and move the JDO annotation to the field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.PersistenceCapable
<span class="annotation">@javax</span>.jdo.annotations.Inheritance(strategy = InheritanceStrategy.SUPERCLASS_TABLE)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CreditCardPaymentMethod</span> <span class="directive">extends</span> PaymentMethod {
    <span class="annotation">@javax</span>.jdo.annotations.Column(allowNulls=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> cardNumber;
    <span class="directive">public</span> <span class="predefined-type">String</span> getCardNumber() { <span class="keyword">return</span> <span class="local-variable">this</span>.cardNumber; }
    <span class="directive">public</span> <span class="type">void</span> setCardNumber(<span class="predefined-type">String</span> cardNumber) { <span class="local-variable">this</span>.cardNumber = cardNumber; }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However this at first glance this might be read as eing that the property is optional whereas Isis' default (required) applies.  Also, in the future Apache Isis may be extended to support reading annotations from fields.</p>
</div>
</div>
<div class="sect4">
<h5 id="_non_persistent_properties_2">Non-persistent properties</h5>
<div class="paragraph">
<p>Of course, not every property is persistent (it could instead be derived), and neither is every domain object an entity (it could be a view model).  For these non persistable properties the <code>optionality()</code> attribute is still required.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@javax</span>.jdo.annotation.NotPersistent                    <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Property</span>(optionality=Optionality.OPTIONAL)
    <span class="directive">public</span> <span class="predefined-type">String</span> getFullName() { ... }                    <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> <span class="type">void</span> setFullName(<span class="predefined-type">String</span> fullName) { ... }       <i class="conum" data-value="3"></i><b>(3)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a non persisted (derived) property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>implementation would most likely derive full name from constituent parts (eg first name, middle initial, last name)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>implementation would most likely parse the input and update the constituent parts</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The attribute has no meaning for a primitive type such as <code>int</code>: primitives will always have a default value (e.g. zero).  If optionality is required, then use the corresponding wrapper class (e.g. <code>java.lang.Integer</code>) and annotate with <code>Parameter#optionality()</code> as required.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The values for the attribute are simply <code>OPTIONAL</code> or <code>MANDATORY</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">public</span> Order placeOrder(
            <span class="directive">final</span> Product product,
            <span class="annotation">@ParameterLayout</span>(named = <span class="string"><span class="delimiter">&quot;</span><span class="content">Quantity</span><span class="delimiter">&quot;</span></span>)
            <span class="directive">final</span> <span class="type">int</span> quantity,
            <span class="annotation">@Parameter</span>(optionality = Optionality.OPTIONAL)
            <span class="annotation">@ParameterLayout</span>(named = <span class="string"><span class="delimiter">&quot;</span><span class="content">Special Instructions</span><span class="delimiter">&quot;</span></span>)
            <span class="directive">final</span> <span class="predefined-type">String</span> instr) {
        ...
    }
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-Property_regexPattern">3.26.8. <code>regexPattern()</code></h4>
<div class="paragraph">
<p>The <code>regexPattern()</code> attribute validates the contents of any string property with respect to a regular expression pattern. It is ignored if applied to properties of any other type. This attribute can also be specified for <a href="#_rg_annotations_manpage-Parameter_regexPattern">parameters</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@Property</span>(
        regexPattern = <span class="string"><span class="delimiter">&quot;</span><span class="content">(</span><span class="char">\\</span><span class="content">w+</span><span class="char">\\</span><span class="content">.)*</span><span class="char">\\</span><span class="content">w+@(</span><span class="char">\\</span><span class="content">w+</span><span class="char">\\</span><span class="content">.)+[A-Za-z]+</span><span class="delimiter">&quot;</span></span>,
        regexPatternFlags=<span class="predefined-type">Pattern</span>.CASE_INSENSITIVE
    )
    <span class="directive">public</span> <span class="predefined-type">String</span> getEmail() { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The related <code>regexPatternFlags()</code> attribute specifies flags that modify the handling of the pattern.  The values are those that would normally be passed to <code>java.util.regex.Pattern#compile(String,int)</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-PropertyLayout">3.27. <code>@PropertyLayout</code></h3>
<div class="paragraph">
<p>The <code>@PropertyLayout</code> annotation applies to properties collecting together all UI hints within a single annotation.</p>
</div>
<div class="paragraph">
<p>The table below summarizes the annotation&#8217;s attributes.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 18. <code>@PropertyLayout</code> attributes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Values (default)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-PropertyLayout_cssClass"><code>cssClass()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any string valid as a CSS class</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>the css class that a property should have, to allow more targetted styling in <a href="#_rg_runtime_application-specific_application-css"><code>application.css</code></a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-PropertyLayout_describedAs"><code>describedAs()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>description of this property, eg to be rendered in a tooltip.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-PropertyLayout_hidden"><code>hidden()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EVERYWHERE</code>, <code>OBJECT_FORMS</code>, <code>PARENTED_TABLES</code>, <code>STANDALONE_TABLES</code>, <code>ALL_TABLES</code>, <code>NOWHERE</code><br>
(<code>NOWHERE</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>indicates where (in the UI) the property should be hidden from the user.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-PropertyLayout_labelPosition"><code>labelPosition()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LEFT</code>, <code>TOP</code>, <code>RIGHT</code>, <code>NONE</code><br>
(<code>LEFT</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>in forms, the positioning of the label relative to the property value.<br></p>
</div>
<div class="paragraph">
<p>Defaults is <code>LEFT</code>, unless <a href="#_rg_annotations_manpage-PropertyLayout_multiLine"><code>multiLine</code></a> in which case <code>TOP</code>.  The value <code>RIGHT</code> is only supported for boolean properties.<br></p>
</div>
<div class="paragraph">
<p>It is also possible to change the default through a <a href="#_rg_runtime_configuring-core_isis-viewers-propertyLayout-labelPosition">configuration property</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-PropertyLayout_multiLine"><code>multiLine()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Positive integer</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>for string properties, render as a text area over multiple lines. <br></p>
</div>
<div class="paragraph">
<p>If set &gt; 1, then <a href="#_rg_annotations_manpage-PropertyLayout_labelPosition"><code>labelPosition</code></a> defaults to TOP.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-PropertyLayout_named"><code>named()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>to override the name inferred from the collection&#8217;s name in code.<br></p>
</div>
<div class="paragraph">
<p>A typical use case is if the desired name is a reserved Java keyword, such as <code>default</code> or <code>package</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>namedEscaped()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code><br>
(<code>true</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>whether to HTML escape the name of this property.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-PropertyLayout_renderedAsDayBefore"><code>renderedAsDayBefore()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code><br>
(<code>false</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>for date properties only, render the date as one day prior to the actually stored date.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_annotations_manpage-PropertyLayout_typicalLength"><code>typicalLength()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Positive integer.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>the typical entry length of a field, use to determine the optimum width for display</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    <span class="annotation">@PropertyLayout</span>(
        cssClass=<span class="string"><span class="delimiter">&quot;</span><span class="content">x-key</span><span class="delimiter">&quot;</span></span>,
        named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Description of this &lt;i&gt;item&lt;/i&gt;</span><span class="delimiter">&quot;</span></span>,
        namedEscaped=<span class="predefined-constant">false</span>,
        describedAs=<span class="string"><span class="delimiter">&quot;</span><span class="content">What needs to be done</span><span class="delimiter">&quot;</span></span>,
        labelPosition=LabelPosition.LEFT,
        typicalLength=<span class="integer">80</span>
    )
    <span class="directive">public</span> <span class="predefined-type">String</span> getDescription() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to apply the annotation to actions of domain services that are acting as <a href="../../more-advanced-topics/how-to-01-062-How-to-decouple-dependencies-using-contributions.html">contributed properties</a>.</p>
</div>
<div class="paragraph">
<p>As an alternative to using the <code>@PropertyLayout</code> annotation, a dynamic layout using  <a href="#_rg_object-layout_dynamic"><code>.layout.json</code></a> file can be specified; for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">propertyLayout</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">cssClass</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">x-key</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">describedAs</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">What needs to be done</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">labelPosition</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">LEFT</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">typicalLength</span><span class="delimiter">&quot;</span></span>: <span class="integer">80</span>
    }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-PropertyLayout_cssClass">3.27.1. <code>cssClass()</code></h4>
<div class="paragraph">
<p>The <code>cssClass()</code> attribute can be used to render additional CSS classes in the HTML (a wrapping <code>&lt;div&gt;</code>) that represents the property.   <a href="#_rg_runtime_application-specific_application-css">Application-specific CSS</a> can then be used to target and adjust the UI representation of that particular element.</p>
</div>
<div class="paragraph">
<p>This attribute can also be applied to <a href="#_rg_annotations_manpage-DomainObjectLayout_cssClass">domain objects</a>, <a href="#_rg_annotations_manpage-ViewModelLayout_cssClass">view models</a>, <a href="#_rg_annotations_manpage-ActionLayout_cssClass">actions</a> <a href="#_rg_annotations_manpage-CollectionLayout_cssClass">collections</a> and <a href="#_rg_annotations_manpage-ParameterLayout_cssClass">parameters</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    <span class="annotation">@PropertyLayout</span>(cssClass=<span class="string"><span class="delimiter">&quot;</span><span class="content">x-key</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> LocalDate getDueBy() { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an alternative to using the annotation, the dynamic <a href="#_rg_object-layout_dynamic"><code>.layout.json</code></a>
can be used instead, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="string"><span class="delimiter">&quot;</span><span class="content">dueBy</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">propertyLayout</span><span class="delimiter">&quot;</span></span>: { <span class="key"><span class="delimiter">&quot;</span><span class="content">cssClass</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">x-key</span><span class="delimiter">&quot;</span></span> }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-PropertyLayout_describedAs">3.27.2. <code>describedAs()</code></h4>
<div class="paragraph">
<p>The <code>describedAs()</code> attribute is used to provide a short description of the property to the user.  In the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> it is displayed as a 'tool tip'. The attribute can also be specified for <a href="#_rg_annotations_manpage-CollectionLayout_describedAs">collections</a>,  <a href="#_rg_annotations_manpage-ActionLayout_describedAs">actions</a>, <a href="#_rg_annotations_manpage-ParameterLayout_describedAs">parameters</a>, <a href="#_rg_annotations_manpage-DomainObjectLayout_describedAs">domain objects</a> and <a href="#_rg_annotations_manpage-ViewModelLayout_describedAs">view models</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@DescribedAs</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">The name that the customer has indicated that they wish to be </span><span class="delimiter">&quot;</span></span> +
                 <span class="string"><span class="delimiter">&quot;</span><span class="content">addressed as (e.g. Johnny rather than Jonathan)</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getFirstName() { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an alternative to using the annotation, the dynamic <a href="#_rg_object-layout_dynamic"><code>.layout.json</code></a>
can be used instead, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="string"><span class="delimiter">&quot;</span><span class="content">firstName:</span><span class="delimiter">&quot;</span></span> {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">propertyLayout</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">describedAs</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">The name that the customer has indicated that they wish to be addressed as (e.g. Johnny rather than Jonathan)</span><span class="delimiter">&quot;</span></span>
     }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-PropertyLayout_labelPosition">3.27.3. <code>labelPosition()</code></h4>
<div class="paragraph">
<p>The <code>labelPosition()</code> attribute determines the positioning of labels for properties.  This attribute can also be specified for <a href="#_rg_annotations_manpage-ParameterLayout_labelPosition">parameters</a>.</p>
</div>
<div class="paragraph">
<p>The positioning of labels is typically <code>LEFT</code>, but can be positioned to the <code>TOP</code>.  The one exception is <a href="#_rg_annotations_manpage-ParameterLayout_multiLine"><code>multiLine()</code></a> string properties, where the label defaults to <code>TOP</code> automatically (to provide as much real-estate for the multiline text field as possible).</p>
</div>
<div class="paragraph">
<p>For boolean properties a positioning of <code>RIGHT</code> is also allowed; this is ignored for all other types.</p>
</div>
<div class="paragraph">
<p>It is also possible to suppress the label altogether, using <code>NONE</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    <span class="annotation">@PropertyLayout</span>(
        labelPosition=LabelPosition.TOP
    )
    <span class="directive">public</span> <span class="predefined-type">String</span> getDescription() { ... }
    <span class="directive">public</span> <span class="type">void</span> setDescription(<span class="predefined-type">String</span> description) { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To get an idea of how these are rendered (in the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a>), we can look at the (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a> that happens to have examples of most of these various label positions.</p>
</div>
<div class="paragraph">
<p>The default <code>LEFT</code> label positioning is used by the <code>cost</code> property:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-annotations/PropertyLayout/labelPosition-LEFT.png"><img src="images/reference-annotations/PropertyLayout/labelPosition-LEFT.png" alt="labelPosition LEFT" width="720px"></a>
</div>
</div>
<div class="paragraph">
<p>The <code>TOP</code> label positioning is used by the <code>category</code> property:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-annotations/PropertyLayout/labelPosition-TOP.png"><img src="images/reference-annotations/PropertyLayout/labelPosition-TOP.png" alt="labelPosition TOP" width="720px"></a>
</div>
</div>
<div class="paragraph">
<p>Labels are suppressed, using <code>NONE</code>, for the <code>subcategory</code> property:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-annotations/PropertyLayout/labelPosition-NONE.png"><img src="images/reference-annotations/PropertyLayout/labelPosition-NONE.png" alt="labelPosition NONE" width="720px"></a>
</div>
</div>
<div class="paragraph">
<p>The todoapp&#8217;s <code>complete</code> (boolean) property renders the label to the LEFT (the default):</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-annotations/PropertyLayout/labelPosition-boolean-LEFT.png"><img src="images/reference-annotations/PropertyLayout/labelPosition-boolean-LEFT.png" alt="labelPosition boolean LEFT" width="720px"></a>
</div>
</div>
<div class="paragraph">
<p>Moving the label to the <code>RIGHT</code> looks like:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-annotations/PropertyLayout/labelPosition-boolean-RIGHT.png"><img src="images/reference-annotations/PropertyLayout/labelPosition-boolean-RIGHT.png" alt="labelPosition boolean RIGHT" width="720px"></a>
</div>
</div>
<div class="paragraph">
<p>As an alternative to using the annotation, the dynamic <a href="#_rg_object-layout_dynamic"><code>.layout.json</code></a>
can be used instead, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">propertyLayout</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">labelPosition</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">TOP</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Specifying a default setting for label positions</div>
<div class="paragraph">
<p>If you want a consistent look-n-feel throughout the app, eg all property labels to the top, then it&#8217;d be rather frustrating to have to annotate every property.</p>
</div>
<div class="paragraph">
<p>Instead, a default can be specified using a <a href="#_rg_runtime_configuring-core">configuration property</a> in <code>isis.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.viewers.propertyLayout.labelPosition=TOP</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.viewers.propertyLayout.labelPosition=LEFT</code></pre>
</div>
</div>
<div class="paragraph">
<p>If these are not present then Apache Isis will render according to internal defaults. At the time of writing, this means labels are to the left for all datatypes except multiline strings.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-PropertyLayout_multiLine">3.27.4. <code>multiLine()</code></h4>
<div class="paragraph">
<p>The <code>multiLine()</code> attribute specifies that the text field for a string property should span multiple lines.  It is ignored for other property types.  The attribute is also supported for <a href="#_rg_annotations_manpage-ParameterLayout_multiLine">parameters</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">BugReport</span> {
    <span class="annotation">@PropertyLayout</span>(
        numberOfLines=<span class="integer">10</span>
    )
    <span class="directive">public</span> <span class="predefined-type">String</span> getStepsToReproduce() { ... }
    <span class="directive">public</span> <span class="type">void</span> setStepsToReproduce(<span class="predefined-type">String</span> stepsToReproduce) { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the <code>stepsToReproduce</code> will be displayed in a text area of 10 rows.</p>
</div>
<div class="paragraph">
<p>As an alternative to using the annotation, the dynamic <a href="#_rg_object-layout_dynamic"><code>.layout.json</code></a>
can be used instead, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="string"><span class="delimiter">&quot;</span><span class="content">stepsToReproduce</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">propertyLayout</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">numberOfLines</span><span class="delimiter">&quot;</span></span>: <span class="integer">10</span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If set &gt; 1 (as would normally be the case), then the default <a href="#_rg_annotations_manpage-PropertyLayout_labelPosition"><code>labelPosition</code></a> defaults to <code>TOP</code> (rather than <code>LEFT</code>, as would normally be the case).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-PropertyLayout_named">3.27.5. named()</h4>
<div class="paragraph">
<p>The <code>named()</code> attribute explicitly specifies the property&#8217;s name, overriding the name that would normally be inferred from the Java source code.  This attribute can also be specified for <a href="#_rg_annotations_manpage-ActionLayout_named">actions</a>, <a href="#_rg_annotations_manpage-CollectionLayout_named">collections</a>, <a href="#_rg_annotations_manpage-ParameterLayout_named">parameters</a>, <a href="#_rg_annotations_manpage-DomainObjectLayout_named">domain objects</a>, <a href="#_rg_annotations_manpage-ViewModelLayout_named">view models</a> and <a href="#_rg_annotations_manpage-DomainServiceLayout_named">domain services</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Following the <a href="http://en.wikipedia.org/wiki/Don%27t_repeat_yourself">don&#8217;t repeat yourself</a> principle, we recommend that you only use this attribute when the desired name cannot be used in Java source code.  Examples of that include a name that would be a reserved Java keyword (eg "package"), or a name that has punctuation, eg apostrophes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default the name is HTML escaped.  To allow HTML markup, set the related <code>namedEscaped()</code> attribute to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    <span class="annotation">@PropertyLayout</span>(
        named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Description of this &lt;i&gt;item&lt;/i&gt;</span><span class="delimiter">&quot;</span></span>,
        namedEscaped=<span class="predefined-constant">false</span>
    )
    <span class="directive">public</span> <span class="predefined-type">String</span> getDescription() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an alternative to using the annotation, the dynamic <a href="#_rg_object-layout_dynamic"><code>.layout.json</code></a>
can be used instead, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">propertyLayout</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">named</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Description of this &lt;i&gt;item&lt;/i&gt;</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">namedEscaped</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">false</span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The framework also provides a separate, powerful mechanism for <a href="ug.html#_ug_more-advanced_i18n">internationalization</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-PropertyLayout_renderedAsDayBefore">3.27.6. <code>renderedAsDayBefore()</code></h4>
<div class="paragraph">
<p>The <code>renderedAsDayBefore()</code> attribute applies only to date properties whereby the date will be rendered as the day before the value actually held in the domain object.  It is ignored for properties of other types. This attribute is also supported for <a href="#_rg_annotations_manpage-ParameterLayout_renderedAsDayBefore">parameters</a>.</p>
</div>
<div class="paragraph">
<p>This behaviour might at first glance appear odd, but the rationale is to support the use case of a sequence of instances that represent adjacent intervals of time.  In such cases there would typically be <code>startDate</code> and <code>endDate</code> properties, eg for all of Q2.  Storing this as a half-closed interval&#8201;&#8212;&#8201;eg <code>[1-Apr-2015, 1-July-2015)</code>&#8201;&#8212;&#8201;can substantially simplify internal algorithms; the <code>endDate</code> of one interval will correspond to the <code>startDate</code> of the next.</p>
</div>
<div class="paragraph">
<p>However, from an end-user perspective the requirement may be to render the interval as a fully closed interval; eg the end date should be shown as <code>30-Jun-2015</code>.</p>
</div>
<div class="paragraph">
<p>This attribute therefore bridges the gap; it presents the information in a way that makes sense to an end-user, but also stores the domain object in a way that is easy work with internally.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Tenancy</span> {
    <span class="directive">public</span> LocalDate getStartDate() { ... }
    <span class="directive">public</span> <span class="type">void</span> setStartDate(LocalDate startDate) { ... }
    <span class="annotation">@PropertyLayout</span>(
        renderedAsDayBefore=<span class="predefined-constant">true</span>
    )
    <span class="directive">public</span> LocalDate getEndDate() { ... }
    <span class="directive">public</span> <span class="type">void</span> setEndDate(LocalDate EndDate) { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an alternative to using the annotation, the dynamic <a href="#_rg_object-layout_dynamic"><code>.layout.json</code></a>
can be used instead, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="string"><span class="delimiter">&quot;</span><span class="content">endDate</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">propertyLayout</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">renderedAsDayBefore</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_annotations_manpage-PropertyLayout_typicalLength">3.27.7. <code>typicalLength()</code></h4>
<div class="paragraph">
<p>The <code>typicalLength()</code> attribute indicates the typical length of a string property.  It is ignored for properties of other types.  The attribute is also supported for <a href="#_rg_annotations_manpage-ParameterLayout_typicalLength">parameters</a>.</p>
</div>
<div class="paragraph">
<p>The information is intended as a hint to the UI to determine the space that should be given to render a particular string property.  That said, note that the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> uses the maximum space available for all fields, so in effect ignores this attribute.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@javax</span>.jdo.annotations.Column(length=<span class="integer">30</span>)
    <span class="annotation">@ParameterLayout</span>(typicalLength=<span class="integer">20</span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getFirstName() { ... }
    <span class="directive">public</span> <span class="type">void</span> setFirstName(<span class="predefined-type">String</span> firstName) { ... }
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-RequestScoped">3.28. <code>@RequestScoped</code> (<code>javax</code>)</h3>
<div class="paragraph">
<p>The <code>@javax.enterprise.context.RequestScoped</code> <a href="https://jcp.org/en/jsr/detail?id=299">JSR-299</a> CDI annotation is used to specify that a <a href="#_rg_annotations_manpage-DomainService">domain service</a> should be request-scoped rather than a singleton.</p>
</div>
<div class="paragraph">
<p>Although Apache Isis does not (currently) leverage CDI, the semantics are the same as request-scoped service; a new instance is created for each HTTP request, reserved for the exclusive use of all objects interacted with during that request.</p>
</div>
<div class="paragraph">
<p>One of the built-in domain services that uses this annotation is <a href="#_rg_services-api_manpage-Scratchpad"><code>Scratchpad</code></a>, intended to allow the arbitrary sharing of data between objects.  Here is the full source code of this service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(
        nature = NatureOfService.DOMAIN
)
<span class="annotation">@RequestScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Scratchpad</span> {
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">Object</span>, <span class="predefined-type">Object</span>&gt; userData = Maps.newHashMap();   <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> get(<span class="predefined-type">Object</span> key) {
        <span class="keyword">return</span> userData.get(key);                                     <i class="conum" data-value="2"></i><b>(2)</b>
    }
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="type">void</span> put(<span class="predefined-type">Object</span> key, <span class="predefined-type">Object</span> value) {
        userData.put(key, value);                                     <i class="conum" data-value="3"></i><b>(3)</b>
    }
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="type">void</span> clear() {
        userData.clear();                                             <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Provides a mechanism for each object being acted upon to pass data to the next object.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Obtain user-data, as set by a previous object being acted upon.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Set user-data, for the use of a subsequent object being acted upon.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Clear any user data.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The vast majority of domain services in Apache Isis tend to be singletons (which requires no special annotation); but as you can see setting up request-scoped services is very straightforward.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Behind the covers Apache Isis creates a (singleton) wrapper for the domain service; the individual request-scoped instances are held in a thread-local of this wrapper.  One consequence of this implementation is that request-scoped methods should not be marked as <code>final</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_rg_annotations_manpage-Title">3.29. <code>@Title</code></h3>
<div class="paragraph">
<p>The <code>@Title</code> annotation is used to indicate which property or properties make up the object title. If more than one property is used, the order can be specified (using the same Dewey-decimal notation as used by <code>@MemberOrder</code>) and the string to use between the components can also be specified.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> Customer {
    <span class="annotation">@Title</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> lastName() { ... }
    ...
    <span class="annotation">@Title</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.5</span><span class="delimiter">&quot;</span></span>, prepend=<span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> firstName() { ... }
    ...
    <span class="annotation">@Title</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.7</span><span class="delimiter">&quot;</span></span>, append=<span class="string"><span class="delimiter">&quot;</span><span class="content">.</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> midInitial() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>could be used to create names of the style "Bloggs, Joe K."</p>
</div>
<div class="paragraph">
<p>It is also possible to annotate reference properties; in this case the
title will return the title of the referenced object (rather than, say,
its string representation).</p>
</div>
<div class="paragraph">
<p>An additional convention for <code>@Title</code> properties is that they are hidden
in tables (in other words, it implies <code>@Hidden(where=Where.ALL_TABLES)</code>.
For viewers that support this annotation (for example, the Wicket
viewer), this convention excludes any properties whose value is already
present in the title column. This convention can be overridden using
<code>@Hidden(where=Where.NOWHERE)</code>.</p>
</div>
<div class="paragraph">
<p>Unresolved directive in _rg_annotations.adoc - include::_rg_annotations_manpage-Viewmodel.adoc[leveloffset=+1]
Unresolved directive in _rg_annotations.adoc - include::_rg_annotations_manpage-ViewmodelLayout.adoc[leveloffset=+1]</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rg_methods">4. Methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Apache Isis metamodel is built up from declaratively (ie, <a href="#_rg_annotations">annotations</a>) and imperatively, from "supporting" methods and other reserved methods.</p>
</div>
<div class="paragraph">
<p>This chapter documents the supporting methods and the reserved methods.  It also documents (separately) the reserved methods that act as callback hooks into the persistence lifecycle of domain entities.</p>
</div>
<div class="sect2">
<h3 id="_rg_methods_prefixes">4.1. Supporting Method Prefixes</h3>
<div class="paragraph">
<p>Supporting methods are those that are associated with properties, collections and actions, providing additional imperative business rule checking and behaviour to be performed when the user interacts with those object members.</p>
</div>
<div class="paragraph">
<p>This association is performed by name matching.  Thus, a property called "firstName", derived from a method <code>getFirstName()</code> may have supporting methods <code>hideFirstName()</code>, <code>disableFirstName()</code> and <code>validateFirstName()</code>.  Supporting methods are, therefore, each characterized by their own particular prefix.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using name matching to associate supporting methods generally works very well, but of course if an object member&#8217;s method is renamed, there&#8217;s always the risk that the developer forgets to rename the supporting method; the supporting methods become "orphaned".</p>
</div>
<div class="paragraph">
<p>Apache Isis checks for this automatically, and will fail-fast (fail to boot) if any orphaned methods are located.  A suitable error message is logged so that the issue can be easily diagnosed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The table below lists the method prefixes that are recognized as part of Apache Isis' default programming model.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 19. Recognized Method Prefixes</caption>
<colgroup>
<col style="width: 18%;">
<col style="width: 9%;">
<col style="width: 9%;">
<col style="width: 9%;">
<col style="width: 9%;">
<col style="width: 9%;">
<col style="width: 36%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Prefix</th>
<th class="tableblock halign-left valign-top">Object</th>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Collection</th>
<th class="tableblock halign-left valign-top">Action</th>
<th class="tableblock halign-left valign-top">Action<br>
Param</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_prefixes_manpage-addTo"><code>addTo&#8230;&#8203;()</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>add object to a collection <br></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Directly mutable collections are not currently supported by the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_prefixes_manpage-removeFrom"><code>removeFrom&#8230;&#8203;()</code></a>`</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_prefixes_manpage-autoComplete"><code>autoComplete&#8230;&#8203;()</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Return a list of matching elements for a property or an action parameter.<br></p>
</div>
<div class="paragraph">
<p>Alternatively, can specify for a class using <a href="#_rg_annotations_manpage-DomainObject_autoCompleteRepository"><code>@DomainObject</code><br>
<code>#autoCompleteRepository</code></a><br></p>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_prefixes_manpage-choices"><code>choices&#8230;&#8203;()</code></a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_prefixes_manpage-choices"><code>choices&#8230;&#8203;()</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Provide list of choices for a property or action parameter.<br></p>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_prefixes_manpage-autoComplete"><code>autoComplete&#8230;&#8203;()</code></a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_prefixes_manpage-clear"><code>clear&#8230;&#8203;()</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Clear a property (set it to null).<br></p>
</div>
<div class="paragraph">
<p>Allows business logic to be placed apart from the setter.<br></p>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_prefixes_manpage-modify"><code>modify&#8230;&#8203;()</code></a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_prefixes_manpage-default"><code>default&#8230;&#8203;()</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Default value for a property or an action parameter.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_prefixes_manpage-disable"><code>disable&#8230;&#8203;()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Disables (makes read-only) a property, a collection or an action.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_prefixes_manpage-get"><code>get&#8230;&#8203;()</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Access the value of a property or collection.<br></p>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_prefixes_manpage-set"><code>set&#8230;&#8203;()</code></a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_prefixes_manpage-hide"><code>hide&#8230;&#8203;()</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Hides a property, a collection or an action.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_prefixes_manpage-modify"><code>modify&#8230;&#8203;()</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Modify a property (set it to a non-null) value.<br></p>
</div>
<div class="paragraph">
<p>Allows business logic to be placed apart from the setter.<br></p>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_prefixes_manpage-clear"><code>clear&#8230;&#8203;()</code></a>`.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_prefixes_manpage-removeFrom"><code>removeFrom&#8230;&#8203;()</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>remove object from a collection.<br></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Directly mutable collections are not currently supported by the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_prefixes_manpage-addTo"><code>addTo&#8230;&#8203;()</code></a>`</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_prefixes_manpage-set"><code>set&#8230;&#8203;()</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Sets the value of a property or a collection.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_prefixes_manpage-validate"><code>validate&#8230;&#8203;()</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Check that a proposed value of a property or a set of action parameters or a single action parameter is valid.<br></p>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_prefixes_manpage-validateAddTo"><code>validateAddTo&#8230;&#8203;()</code></a> and <a href="#_rg_methods_prefixes_manpage-validateRemoveFrom"><code>validateRemoveFrom&#8230;&#8203;()</code></a> to validate modifications to collections.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_prefixes_manpage-validateAddTo"><code>validate<br>
AddTo&#8230;&#8203;()</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Check that a proposed object to add to a collection is valid.<br></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Directly mutable collections are not currently supported by the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_prefixes_manpage-validateRemoveFrom"><code>validateRemoveFrom&#8230;&#8203;()</code></a>, and <a href="#_rg_methods_prefixes_manpage-validate"><code>validate&#8230;&#8203;()</code></a> for properties and actions.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_prefixes_manpage-validateRemoveFrom"><code>validate<br>
RemoveFrom&#8230;&#8203;()</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Check that a proposed object to remove from a collection is valid.<br></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Directly mutable collections are not currently supported by the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_prefixes_manpage-validateAddTo"><code>validateAddTo&#8230;&#8203;()</code></a>, and <a href="#_rg_methods_prefixes_manpage-validate"><code>validate&#8230;&#8203;()</code></a> for properties and actions.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_rg_methods_prefixes_manpage-addTo">4.1.1. <code>addTo&#8230;&#8203;()</code></h4>
<div class="paragraph">
<p>The <code>addTo&#8230;&#8203;()</code> supporting method is called whenever an object is added to a collection. Its purpose is to allow additional business logic to be performed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Directly mutable collections are not currently supported by the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a>.  The suggested workaround is to simply define an action.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LibraryMember</span> {
    <span class="directive">public</span> <span class="predefined-type">SortedSet</span>&lt;<span class="predefined-type">Book</span>&gt; getBorrowed() { ... }
    <span class="directive">public</span> <span class="type">void</span> setBorrowed(<span class="predefined-type">SortedSet</span>&lt;<span class="predefined-type">Book</span>&gt; borrowed) { ... }
    <span class="directive">public</span> <span class="type">void</span> addToBorrowed(<span class="predefined-type">Book</span> book) {
        getBorrowed().add(book);                                              <i class="conum" data-value="1"></i><b>(1)</b>
        reminderService.addReminder(<span class="local-variable">this</span>, book, clock.today().plusDays(<span class="integer">21</span>));  <i class="conum" data-value="2"></i><b>(2)</b>
    }
    <span class="directive">public</span> <span class="type">void</span> removeFromBorrowed(<span class="predefined-type">Book</span> book) { ... }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>update the collection</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>perform some additional business logic</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_prefixes_manpage-removeFrom"><code>removeFrom&#8230;&#8203;()</code></a>`</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_prefixes_manpage-autoComplete">4.1.2. <code>autoComplete&#8230;&#8203;()</code></h4>
<div class="paragraph">
<p>The <code>autoComplete&#8230;&#8203;()</code> supporting method is called for action parameters and for properties to find objects from a drop-down list box.  The use case is when the number of candidate objects is expected to be large, so the user is required to enter some characters to narrow the search down.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the number of candidate objects is comparatively small, then use <a href="#_rg_methods_prefixes_manpage-choices"><code>choices&#8230;&#8203;()</code></a> supporting method instead.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The signature of the supporting method depends on whether it is for a parameter or a property.</p>
</div>
<div class="sect4">
<h5 id="_parameters">Parameters</h5>
<div class="paragraph">
<p>For an action parameter in (0-based) position <em>N</em>, and of type <code>T</code>, the signature is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;T&gt; autoCompleteNXxx(<span class="predefined-type">String</span> search) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ShoppingCartItem</span> {
    <span class="annotation">@Property</span>(editing=Editing.DISABLED)
    <span class="directive">public</span> Product getProduct() { ... }
    <span class="directive">public</span> <span class="type">void</span> setProduct(Product product) { ... }

    <span class="annotation">@Property</span>(editing=Editing.DISABLED)
    <span class="directive">public</span> <span class="type">int</span> getQuantity() { ... }
    <span class="directive">public</span> <span class="type">void</span> setQuantity(<span class="type">int</span> quantity) { ... }

    <span class="annotation">@Action</span>(semantics=SemanticsOf.IDEMPOTENT)
    <span class="directive">public</span> ShoppingCartItem updateProduct(
        Product product,
        <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Quantity</span><span class="delimiter">&quot;</span></span>)
        <span class="directive">final</span> <span class="type">int</span> quantity) {
        setProduct(product);
        setQuantity(quantity);
    }
    <span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;Product&gt; autoComplete0UpdateProduct(  <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="annotation">@MinLength</span>(<span class="integer">3</span>) <span class="predefined-type">String</span> search                         <i class="conum" data-value="2"></i><b>(2)</b>
    ) {
        ...
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>product</code> is the 0th argument of the action.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <a href="#_rg_annotations_manpage-MinLength"><code>@MinLength</code></a> annotation specifies the minimum number of characters that must be entered before a search is performed for matching objects</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_properties">Properties</h5>
<div class="paragraph">
<p>For a property of type <code>T</code>, the signature is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;T&gt; autoCompleteXxx(<span class="predefined-type">String</span> search) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ShoppingCartItem</span> {
    <span class="directive">public</span> Product getProduct() { ... }
    <span class="directive">public</span> <span class="type">void</span> setProduct(Product product) { ... }

    <span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;Product&gt; autoCompleteProduct(
        <span class="annotation">@MinLength</span>(<span class="integer">3</span>) <span class="predefined-type">String</span> search                     <i class="conum" data-value="1"></i><b>(1)</b>
    ) {
        ...
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <a href="#_rg_annotations_manpage-MinLength"><code>@MinLength</code></a> annotation specifies the minimum number of characters that must be entered before a search is performed for matching objects</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_prefixes_manpage-choices">4.1.3. <code>choices&#8230;&#8203;()</code></h4>
<div class="paragraph">
<p>The <code>choices&#8230;&#8203;()</code> supporting method is called for both action parameters and for properties, to find objects from a drop-down list box.  Unlike <a href="#_rg_methods_prefixes_manpage-autoComplete"><code>autoComplete&#8230;&#8203;()</code></a>, the use case is when the number of objects is comparatively small and can be selected from a drop-down without any additional filtering.</p>
</div>
<div class="paragraph">
<p>The signature of the supporting method depends on whether it is for an action parameter or a property.</p>
</div>
<div class="sect4">
<h5 id="_parameters_2">Parameters</h5>
<div class="paragraph">
<p>For an action parameter in (0-based) position <em>N</em>, and of type <code>T</code>, the signature is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;T&gt; choicesNXxx() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ShoppingCartItem</span> {
    <span class="annotation">@Property</span>(editing=Editing.DISABLED)
    <span class="directive">public</span> Product getProduct() { ... }
    <span class="directive">public</span> <span class="type">void</span> setProduct(Product product) { ... }

    <span class="annotation">@Property</span>(editing=Editing.DISABLED)
    <span class="directive">public</span> <span class="type">int</span> getQuantity() { ... }
    <span class="directive">public</span> <span class="type">void</span> setQuantity(<span class="type">int</span> quantity) { ... }

    <span class="annotation">@Action</span>(semantics=SemanticsOf.IDEMPOTENT)
    <span class="directive">public</span> ShoppingCartItem updateProduct(
        Product product,
        <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Quantity</span><span class="delimiter">&quot;</span></span>)
        <span class="directive">final</span> <span class="predefined-type">Integer</span> quantity) {
        setProduct(product);
        setQuantity(quantity);
    }
    <span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;<span class="predefined-type">Integer</span>&gt; choices1UpdateProduct() {
        <span class="keyword">return</span> <span class="predefined-type">Arrays</span>.asList(<span class="integer">1</span>,<span class="integer">2</span>,<span class="integer">3</span>,<span class="integer">5</span>,<span class="integer">10</span>,<span class="integer">25</span>,<span class="integer">50</span>,<span class="integer">100</span>);
    }
    ...
}</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_dependent_choices">Dependent Choices</h6>
<div class="paragraph">
<p>Action parameters also support the notion of dependent choices, whereby the list of choices is dependent upon the value of some other argument.</p>
</div>
<div class="paragraph">
<p>An example can be found in the (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a>, whereby `ToDoItem`s are categorized and then can also be subcategorized:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-methods/prefixes/choices/dependent.png"><img src="images/reference-methods/prefixes/choices/dependent.png" alt="dependent" width="800px"></a>
</div>
</div>
<div class="paragraph">
<p>This functionality is actually implemented as a <a href="ug.html#_ug_how-tos_contributed-members">contributed action</a>, so the code for this is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature = NatureOfService.VIEW_CONTRIBUTIONS_ONLY)
<span class="directive">public</span> <span class="type">class</span> <span class="class">UpdateCategoryContributions</span> ... {
    <span class="annotation">@ActionLayout</span>(
            describedAs = <span class="string"><span class="delimiter">&quot;</span><span class="content">Update category and subcategory</span><span class="delimiter">&quot;</span></span>
    )
    <span class="annotation">@Action</span>(semantics = SemanticsOf.IDEMPOTENT)
    <span class="directive">public</span> Categorized updateCategory(
            <span class="directive">final</span> Categorized item,                              <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="directive">final</span> Category category,
            <span class="annotation">@Parameter</span>(optionality = Optionality.OPTIONAL)
            <span class="directive">final</span> Subcategory subcategory) {
        item.setCategory(category);
        item.setSubcategory(subcategory);
        <span class="keyword">return</span> item;
    }
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Subcategory&gt; choices2UpdateCategory(             <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="directive">final</span> Categorized item,                              <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="directive">final</span> Category category) {                           <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="keyword">return</span> Subcategory.listFor(category);
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>ToDoItem</code> implements <code>Categorized</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>subcategory is the 2-th argument (0-based)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the item contributed to</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the category selected</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Dependent choices are not restricted to enums, however.  Going back to the shopping cart example shown above, the choices for the <code>quantity</code> parameter could be dependent upon the selected <code>Product</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ShoppingCartItem</span> {
    ...
    <span class="annotation">@Action</span>(semantics=SemanticsOf.IDEMPOTENT)
    <span class="directive">public</span> ShoppingCartItem updateProduct(
        Product product,
        <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Quantity</span><span class="delimiter">&quot;</span></span>)
        <span class="directive">final</span> <span class="predefined-type">Integer</span> quantity) {
        setProduct(product);
        setQuantity(quantity);
    }
    <span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;<span class="predefined-type">Integer</span>&gt; choices1UpdateProduct(Product product) {
        <span class="keyword">return</span> productService.quantityChoicesFor(product);                 <i class="conum" data-value="1"></i><b>(1)</b>
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>productService</code> is a (fictitous) injected service that knows what the quantity choices should be for any given product</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_properties_2">Properties</h5>
<div class="paragraph">
<p>For a property of type <code>T</code>, the signature is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;T&gt; choicesXxx() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ShoppingCartItem</span> {
    <span class="directive">public</span> Product getProduct() { ... }
    <span class="directive">public</span> <span class="type">void</span> setProduct(Product product) { ... }

    <span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;Product&gt; choicesProduct() {
        ...
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_prefixes_manpage-clear">4.1.4. <code>clear&#8230;&#8203;()</code></h4>
<div class="paragraph">
<p>The <code>clear&#8230;&#8203;()</code> supporting method is called&#8201;&#8212;&#8201;instead of the setter&#8201;&#8212;&#8201;whenever an (optional) property is to be set to <code>null</code>.  Its purpose is to allow additional business logic to be performed.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LibraryMember</span> {
    <span class="directive">public</span> Title getFavoriteTitle() { ... }
    <span class="directive">public</span> <span class="type">void</span> setFavoriteTitle(Title title) { ... }
    <span class="directive">public</span> <span class="type">void</span> modifyFavoriteTitle(Title title) { ... }
    <span class="directive">public</span> <span class="type">void</span> clearFavoriteTitle() {
        <span class="keyword">if</span>(getTitle() == <span class="predefined-constant">null</span>) { <span class="keyword">return</span>; }
        setFavoriteTitle(<span class="predefined-constant">null</span>);                         <i class="conum" data-value="1"></i><b>(1)</b>
        titleFavoritesService.decrement(title);         <i class="conum" data-value="2"></i><b>(2)</b>
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>update the property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>perform some additional business logic</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_prefixes_manpage-modify"><code>modify&#8230;&#8203;()</code></a>`</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_prefixes_manpage-default">4.1.5. <code>default&#8230;&#8203;()</code></h4>
<div class="paragraph">
<p>The <code>default&#8230;&#8203;()</code> supporting method is called for action parameters to return the initial argument value.  This may be some sensible default (eg today&#8217;s date, or 0 or 1), or&#8201;&#8212;&#8201;for an action that is modifying the state of an object&#8201;&#8212;&#8201;might default to the current value of a corresponding property.</p>
</div>
<div class="paragraph">
<p>The method is <em>also</em> called for properties in the case when an object is newly instantiated using <a href="#_rg_services-api_manpage-DomainObjectContainer"><code>DomainObjectContainer#newTransientInstance(&#8230;&#8203;)</code></a>.  This is a much less common use case.  If a default is not specified then properties are initialized to a default based on their type (eg 0 or <code>false</code>).</p>
</div>
<div class="paragraph">
<p>The signature of the supporting method depends on whether it is for an action parameter or a property.</p>
</div>
<div class="sect4">
<h5 id="_parameters_3">Parameters</h5>
<div class="paragraph">
<p>For an action parameter in (0-based position n), and of type <code>T</code>, the signature is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> T defaultNXxx() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ShoppingCartItem</span> {
    <span class="annotation">@Property</span>(editing=Editing.DISABLED)
    <span class="directive">public</span> Product getProduct() { ... }
    <span class="directive">public</span> <span class="type">void</span> setProduct(Product product) { ... }

    <span class="annotation">@Property</span>(editing=Editing.DISABLED)
    <span class="directive">public</span> <span class="type">int</span> getQuantity() { ... }
    <span class="directive">public</span> <span class="type">void</span> setQuantity(<span class="type">int</span> quantity) { ... }

    <span class="annotation">@Action</span>(semantics=SemanticsOf.IDEMPOTENT)
    <span class="directive">public</span> ShoppingCartItem updateProduct(
        Product product,
        <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Quantity</span><span class="delimiter">&quot;</span></span>)
        <span class="directive">final</span> <span class="predefined-type">Integer</span> quantity) {
        setProduct(product);
        setQuantity(quantity);
    }
    <span class="directive">public</span> Product default0UpdateProduct() {    <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="keyword">return</span> getProduct();
    }
    <span class="directive">public</span> <span class="type">int</span> default1UpdateProduct() {        <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="keyword">return</span> getQuantity();
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>default the 0-th parameter using the current value of the <code>product</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>default the 1-th parameter using the current value of the <code>quantity</code> property</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Defaults are also supported (of course) for <a href="ug.html#_ug_how-tos_contributed-members">contributed actions</a>.  For example, here is a contributed action for updating category/subcategory of the (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature = NatureOfService.VIEW_CONTRIBUTIONS_ONLY)
<span class="directive">public</span> <span class="type">class</span> <span class="class">UpdateCategoryContributions</span> ... {
    <span class="annotation">@ActionLayout</span>(
            describedAs = <span class="string"><span class="delimiter">&quot;</span><span class="content">Update category and subcategory</span><span class="delimiter">&quot;</span></span>
    )
    <span class="annotation">@Action</span>(semantics = SemanticsOf.IDEMPOTENT)
    <span class="directive">public</span> Categorized updateCategory(
            <span class="directive">final</span> Categorized item,                              <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="directive">final</span> Category category,
            <span class="annotation">@Parameter</span>(optionality = Optionality.OPTIONAL)
            <span class="directive">final</span> Subcategory subcategory) {
        item.setCategory(category);
        item.setSubcategory(subcategory);
        <span class="keyword">return</span> item;
    }
    <span class="directive">public</span> Category default1UpdateCategory(                     <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="directive">final</span> Categorized item) {
        <span class="keyword">return</span> item != <span class="predefined-constant">null</span>? item.getCategory(): <span class="predefined-constant">null</span>;
    }
    <span class="directive">public</span> Subcategory default2UpdateCategory(                  <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="directive">final</span> Categorized item) {
        <span class="keyword">return</span> item != <span class="predefined-constant">null</span>? item.getSubcategory(): <span class="predefined-constant">null</span>;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>ToDoItem</code> implements <code>Categorized</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>defaults the 1-th parameter using the item&#8217;s <code>category</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>defaults the 2-th parameter using the item&#8217;s <code>subcategory</code> property</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_properties_3">Properties</h5>
<div class="paragraph">
<p>For a property of type <code>T</code>, the signature is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> T defaultXxx() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ShoppingCartItem</span> {
    <span class="directive">public</span> <span class="type">int</span> getQuantity() { ... }
    <span class="directive">public</span> <span class="type">void</span> setQuantity(<span class="type">int</span> quantity) { ... }

    <span class="directive">public</span> <span class="type">int</span> defaultProduct() {
        <span class="keyword">return</span> <span class="integer">1</span>;
    }</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_alternatives">Alternatives</h6>
<div class="paragraph">
<p>There are, in fact, two other ways to set properties of a newly instantiated object to default values.</p>
</div>
<div class="paragraph">
<p>The first is to use the <a href="#_rg_methods_lifecycle_manpage-created"><code>created()</code></a> callback, called by the framework when <a href="#_rg_services-api_manpage-DomainObjectContainer"><code>DomainObjectContainer#newTransientInstance(&#8230;&#8203;)</code></a> is called.  This method is called after any dependencies have been injected into the service.</p>
</div>
<div class="paragraph">
<p>The second is more straightforward: simply initialize properties in the constructor.  However, this cannot use any injected services as they will not have been initialized.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_prefixes_manpage-disable">4.1.6. <code>disable&#8230;&#8203;()</code></h4>
<div class="paragraph">
<p>The <code>disable&#8230;&#8203;()</code> supporting method is called for properties, collections and actions.  It allows the modification of the property/collection to be vetoed (ie made read-only) and to prevent the invocation of the action ("grey it out").</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Directly mutable collections are not currently supported by the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a>; they are always implicitly disabled.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Typically modification/invocation is vetoed based on the state of the domain object being interacted with, though it could be any reason at all (eg the current date/time of the interaction, or the state of some other related data such as stock levels, or the identity of the calling user).</p>
</div>
<div class="paragraph">
<p>The reason for vetoing a modification/invocation is normally returned as a string.  However, Apache Isis' <a href="ug.html#_ug_more-advanced_i18n">i18n support</a> extends this so that reasons can be internationalized.</p>
</div>
<div class="sect4">
<h5 id="_actions">Actions</h5>
<div class="paragraph">
<p>For an action the signature of the supporting method is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> disableXxx(...) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the returned string is the reason the action invocation is vetoed (or <code>null</code> if not vetoed), and the supporting method takes the same parameter types as the action itself.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">public</span> <span class="type">boolean</span> isBlacklisted() { ... }

    <span class="directive">public</span> Order placeOrder(
            <span class="directive">final</span> Product product,
            <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Quantity</span><span class="delimiter">&quot;</span></span>)
            <span class="directive">final</span> <span class="type">int</span> quantity) {
        ...
    }
    <span class="directive">public</span> <span class="predefined-type">String</span> disablePlaceOrder(
            <span class="directive">final</span> Product product,
            <span class="directive">final</span> <span class="type">int</span> quantity
            ) {
        <span class="keyword">return</span> isBlacklisted()
                    ? <span class="string"><span class="delimiter">&quot;</span><span class="content">Blacklisted customers cannot place orders</span><span class="delimiter">&quot;</span></span>
                    : <span class="predefined-constant">null</span>;
    }
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_properties_and_collections">Properties and Collections</h5>
<div class="paragraph">
<p>For both properties and collections the signature of the supporting method is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> disableXxx() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the returned string is the reason the modification is vetoed (or <code>null</code> if not vetoed).</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">public</span> <span class="type">boolean</span> isBlacklisted() { ... }

    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> getCreditLimit() { ... }
    <span class="directive">public</span> <span class="type">void</span> setCreditLimit(<span class="predefined-type">BigDecimal</span> creditLimit) { ... }
    <span class="directive">public</span> <span class="predefined-type">String</span> disableCreditLimit() {
        <span class="keyword">return</span> isBlacklisted()
                    ? <span class="string"><span class="delimiter">&quot;</span><span class="content">Cannot change credit limit for blacklisted customers</span><span class="delimiter">&quot;</span></span>
                    : <span class="predefined-constant">null</span>;
    }
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_prefixes_manpage-get">4.1.7. <code>get&#8230;&#8203;()</code></h4>
<div class="paragraph">
<p>The <code>get&#8230;&#8203;()</code> prefix is simply the normal JavaBean getter prefix that denotes properties or collections.</p>
</div>
<div class="paragraph">
<p>When Apache Isis builds its metamodel, it first searches for the getter methods, characterizing them as either properties or collections based on the return type.  It then refines the metamodel based on the presence of annotations and supporting methods.</p>
</div>
<div class="paragraph">
<p>All remaining <code>public</code> methods (that do not use one of the Apache Isis prefixes) are interpreted as actions.</p>
</div>
<div class="paragraph">
<p>Any methods "left over" that <em>do</em> use one of the Apache Isis prefixes, are interpreted to be orphaned.  Apache Isis "fails-fast" and will not boot, instead printing an error message to the log so that the issue can be easily diagnosed.</p>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_prefixes_manpage-set"><code>set&#8230;&#8203;()</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_prefixes_manpage-hide">4.1.8. <code>hide&#8230;&#8203;()</code></h4>
<div class="paragraph">
<p>The <code>hide&#8230;&#8203;()</code> supporting method is called for properties, collections and actions.  It allows the property/collection to be completely hidden from view.</p>
</div>
<div class="paragraph">
<p>It&#8217;s comparatively rare for properties or collections to be imperatively hidden from view, but actions are sometimes hidden or shown visible (as opposed to being just <a href="#_rg_methods_prefixes_manpage-disable">disabled</a>, ie greyed out).</p>
</div>
<div class="sect4">
<h5 id="_actions_2">Actions</h5>
<div class="paragraph">
<p>For an action the signature of the supporting method is either:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> bool hideXxx(...) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the supporting method takes the same parameter types as the action itself, or more simply:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> bool hideXxx() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>with no parameters at all.  Returning <code>true</code> will hide the action, returning <code>false</code> leaves it visible.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">public</span> <span class="type">boolean</span> isBlacklisted() { ... }

    <span class="directive">public</span> Order placeOrder(
            <span class="directive">final</span> Product product,
            <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Quantity</span><span class="delimiter">&quot;</span></span>)
            <span class="directive">final</span> <span class="type">int</span> quantity) {
        ...
    }
    <span class="directive">public</span> <span class="type">boolean</span> hidePlaceOrder() {
        <span class="keyword">return</span> isBlacklisted();
    }
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_properties_and_collections_2">Properties and Collections</h5>
<div class="paragraph">
<p>For both properties and collections the signature of the supporting method is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">boolean</span> hideXxx() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>where returning <code>true</code> will hide the property/collection, returning <code>false</code> leaves it visible.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">public</span> <span class="type">boolean</span> isBlacklisted() { ... }

    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> getCreditLimit() { ... }
    <span class="directive">public</span> <span class="type">void</span> setCreditLimit(<span class="predefined-type">BigDecimal</span> creditLimit) { ... }
    <span class="directive">public</span> <span class="type">boolean</span> hideCreditLimit() {
        <span class="keyword">return</span> isBlacklisted();
    }
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_prefixes_manpage-modify">4.1.9. <code>modify&#8230;&#8203;()</code></h4>
<div class="paragraph">
<p>The <code>modify&#8230;&#8203;()</code> supporting method is called&#8201;&#8212;&#8201;instead of the setter&#8201;&#8212;&#8201;whenever a property has been set to be set to a new value.  Its purpose is to allow additional business logic to be performed.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LibraryMember</span> {
    <span class="directive">public</span> Title getFavoriteTitle() { ... }
    <span class="directive">public</span> <span class="type">void</span> setFavoriteTitle(Title title) { ... }
    <span class="directive">public</span> <span class="type">void</span> modifyFavoriteTitle(Title title) {
        <span class="keyword">if</span>(getTitle() != <span class="predefined-constant">null</span>) {
            titleFavoritesService.decrement(getTitle());    <i class="conum" data-value="1"></i><b>(1)</b>
        }
        setFavoriteTitle(title);                            <i class="conum" data-value="2"></i><b>(2)</b>
        titleFavoritesService.decrement(title);             <i class="conum" data-value="3"></i><b>(3)</b>
    }
    <span class="directive">public</span> <span class="type">void</span> clearFavoriteTitle() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>perform some additional business logic</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>update the property</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>perform some additional business logic</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_prefixes_manpage-clear"><code>clear&#8230;&#8203;()</code></a>`</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_prefixes_manpage-removeFrom">4.1.10. <code>removeFrom&#8230;&#8203;()</code></h4>
<div class="paragraph">
<p>The <code>removeFrom&#8230;&#8203;()</code> supporting method is called whenever an object is removed from a collection. Its purpose is to allow additional business logic to be performed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Directly mutable collections are not currently supported by the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a>.  The suggested workaround is to simply define an action.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LibraryMember</span> {
    <span class="directive">public</span> <span class="predefined-type">SortedSet</span>&lt;<span class="predefined-type">Book</span>&gt; getBorrowed() { ... }
    <span class="directive">public</span> <span class="type">void</span> setBorrowed(<span class="predefined-type">SortedSet</span>&lt;<span class="predefined-type">Book</span>&gt; borrowed) { ... }
    <span class="directive">public</span> <span class="type">void</span> addToBorrowed(<span class="predefined-type">Book</span> book) { ... }
    <span class="directive">public</span> <span class="type">void</span> removeFromBorrowed(<span class="predefined-type">Book</span> book) {
        getBorrowed().remove(book);                         <i class="conum" data-value="1"></i><b>(1)</b>
        reminderService.removeReminder(<span class="local-variable">this</span>, book);         <i class="conum" data-value="2"></i><b>(2)</b>
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>update the collection</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>perform some additional business logic</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_prefixes_manpage-addTo"><code>addTo&#8230;&#8203;()</code></a>`</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_prefixes_manpage-set">4.1.11. <code>set&#8230;&#8203;()</code></h4>
<div class="paragraph">
<p>The <code>set&#8230;&#8203;()</code> prefix is simply the normal JavaBean setter prefix that denotes writeable properties or collections.</p>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_prefixes_manpage-get"><code>get&#8230;&#8203;()</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_prefixes_manpage-validate">4.1.12. <code>validate&#8230;&#8203;()</code></h4>
<div class="paragraph">
<p>The <code>validate&#8230;&#8203;()</code> supporting method is called for properties, actions and action parameters.  It allows the proposed new value for a property to be rejected, or the proposed argument of an action parameter to be rejected, or to reject a whole set of action arguments for an actio invocation.</p>
</div>
<div class="paragraph">
<p>The reason for vetoing a modification/invocation is normally returned as a string.  However, Apache Isis' <a href="ug.html#_ug_more-advanced_i18n">i18n support</a> extends this so that reasons can be internationalized if required.</p>
</div>
<div class="sect4">
<h5 id="_action_parameter">Action Parameter</h5>
<div class="paragraph">
<p>For an action parameter in (0-based) position <em>N</em>, and of type <code>T</code>, the signature is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> validateNXxx(T proposed) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the returned string is the reason why the argument is rejected (or <code>null</code> if not vetoed).</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">public</span> Order placeOrder(
            <span class="directive">final</span> Product product,
            <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Quantity</span><span class="delimiter">&quot;</span></span>)
            <span class="directive">final</span> <span class="type">int</span> quantity) {
        ...
    }
    <span class="directive">public</span> <span class="predefined-type">String</span> validate0PlaceOrder(
            <span class="directive">final</span> Product product) {
        <span class="keyword">return</span> product.isDiscontinued()
                    ? <span class="string"><span class="delimiter">&quot;</span><span class="content">Product has been discontinued</span><span class="delimiter">&quot;</span></span>
                    : <span class="predefined-constant">null</span>;
    }
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_action_parameter_set">Action Parameter Set</h5>
<div class="paragraph">
<p>In addition to validating a single single action argument, it is also possible to validate a complete set of action arguments.  The signature is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> validateXxx(...) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the returned string is the reason why the argument is rejected (or <code>null</code> if not vetoed), and the supporting method takes the same parameter types as the action itself.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">public</span> Order placeOrder(
            <span class="directive">final</span> Product product,
            <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Quantity</span><span class="delimiter">&quot;</span></span>)
            <span class="directive">final</span> <span class="type">int</span> quantity) {
        ...
    }
    <span class="directive">public</span> <span class="predefined-type">String</span> validatePlaceOrder(
            <span class="directive">final</span> Product product,
            <span class="directive">final</span> <span class="type">int</span> quantity) {
        <span class="keyword">return</span> quantity &gt; product.getOrderLimit()
                    ? <span class="string"><span class="delimiter">&quot;</span><span class="content">May not order more than </span><span class="delimiter">&quot;</span></span> + product.getOrderLimit() + <span class="string"><span class="delimiter">&quot;</span><span class="content"> items for this product</span><span class="delimiter">&quot;</span></span>
                    : <span class="predefined-constant">null</span>;
    }
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_properties_4">Properties</h5>
<div class="paragraph">
<p>For properties of type <code>T</code> the signature of the supporting method is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> validateXxx(T proposed) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the returned string is the reason the modification is vetoed (or <code>null</code> if not vetoed).</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> getCreditLimit() { ... }
    <span class="directive">public</span> <span class="type">void</span> setCreditLimit(<span class="predefined-type">BigDecimal</span> creditLimit) { ... }
    <span class="directive">public</span> validateCreditLimit(<span class="predefined-type">BigDecimal</span> creditLimit) {
        <span class="keyword">return</span> creditLimit.compareTo(<span class="predefined-type">BigDecimal</span>.ZERO) &lt; <span class="integer">0</span>
                    ? <span class="string"><span class="delimiter">&quot;</span><span class="content">Credit limit cannot be negative</span><span class="delimiter">&quot;</span></span>
                    : <span class="predefined-constant">null</span>;
    }
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_prefixes_manpage-validateAddTo">4.1.13. <code>validateAddTo&#8230;&#8203;()</code></h4>
<div class="paragraph">
<p>The <code>validateAddTo&#8230;&#8203;()</code> supporting method is called whenever an object is to be added to a collection. Its purpose is to validate the proposed object and possibly veto the change.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Directly mutable collections are not currently supported by the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a>.  The suggested workaround is to simply define an action.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The signature of the supporting method for a collection with element type <code>E</code> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> validateAddToXxx(E element) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the returned string is the reason the collection modification invocation is vetoed (or <code>null</code> if not vetoed).  Apache Isis' <a href="ug.html#_ug_more-advanced_i18n">i18n support</a> extends this so that reasons can be internationalized if required.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LibraryMember</span> {
    <span class="directive">public</span> <span class="predefined-type">SortedSet</span>&lt;<span class="predefined-type">Book</span>&gt; getBorrowed() { ... }
    <span class="directive">public</span> <span class="type">void</span> setBorrowed(<span class="predefined-type">SortedSet</span>&lt;<span class="predefined-type">Book</span>&gt; borrowed) { ... }
    <span class="directive">public</span> <span class="predefined-type">String</span> validateAddToBorrowed(<span class="predefined-type">Book</span> book) {
        <span class="keyword">return</span> book.isReference()? <span class="string"><span class="delimiter">&quot;</span><span class="content">Reference books cannot be borrowed</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">null</span>;
    }
    <span class="directive">public</span> <span class="type">void</span> validateRemoveFromBorrowed(<span class="predefined-type">Book</span> book) { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_prefixes_manpage-addTo"><code>addTo&#8230;&#8203;()</code></a> and  <a href="#_rg_methods_prefixes_manpage-validateRemoveFrom"><code>validateRemoveFrom&#8230;&#8203;()</code></a>`</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_prefixes_manpage-validateRemoveFrom">4.1.14. <code>validateRemoveFrom&#8230;&#8203;()</code></h4>
<div class="paragraph">
<p>The <code>validateRemoveFrom&#8230;&#8203;()</code> supporting method is called whenever an object is to be removed from a collection. Its purpose is to validate the proposed object removal and possibly veto the change.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Directly mutable collections are not currently supported by the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a>.  The suggested workaround is to simply define an action.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The signature of the supporting method for a collection with element type <code>E</code> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> validateRemoveFromXxx(E element) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the returned string is the reason the collection modification invocation is vetoed (or <code>null</code> if not vetoed).  Apache Isis' <a href="ug.html#_ug_more-advanced_i18n">i18n support</a> extends this so that reasons can be internationalized if required.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LibraryMember</span> {
    <span class="directive">public</span> <span class="predefined-type">SortedSet</span>&lt;<span class="predefined-type">Book</span>&gt; getBorrowed() { ... }
    <span class="directive">public</span> <span class="type">void</span> setBorrowed(<span class="predefined-type">SortedSet</span>&lt;<span class="predefined-type">Book</span>&gt; borrowed) { ... }
    <span class="directive">public</span> <span class="predefined-type">String</span> validateAddToBorrowed(<span class="predefined-type">Book</span> book) { ... }
    <span class="directive">public</span> <span class="type">void</span> validateRemoveFromBorrowed(<span class="predefined-type">Book</span> book) {
        <span class="keyword">return</span> !book.hasBeenReadBy(<span class="local-variable">this</span>)? <span class="string"><span class="delimiter">&quot;</span><span class="content">You didn't read this book yet</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">null</span>;
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_prefixes_manpage-removeFrom"><code>removeFrom&#8230;&#8203;()</code></a> and  <a href="#_rg_methods_prefixes_manpage-validateAddTo"><code>validateAddTo&#8230;&#8203;()</code></a>`</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_methods_reserved">4.2. Reserved Methods</h3>
<div class="paragraph">
<p>The table below lists the reserved methods that are recognized as part of Apache Isis' default programming model.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 20. Reserved Methods</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_reserved_manpage-cssClass"><code>cssClass()</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Provides a CSS class for this object instance.  In conjunction with <a href="#_rg_runtime_application-specific_application-css"><code>application.css</code></a>, can therefore provide custom styling of an object instance wherever it is rendered.<br></p>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_reserved_manpage-title"><code>title()</code></a> and <a href="#_rg_methods_reserved_manpage-iconName"><code>iconName()</code></a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_reserved_manpage-disable"><code>disable(&#8230;&#8203;)</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Disable all or some of an object&#8217;s properties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_reserved_manpage-getId"><code>getId()</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Provides an optional unique identifier of a service.<br></p>
</div>
<div class="paragraph">
<p>If not provided, the service&#8217;s fully-qualified class name is used.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_reserved_manpage-hide"><code>hide(&#8230;&#8203;)</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Hide all or some of an object&#8217;s properties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_reserved_manpage-iconName"><code>iconName()</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Provides the name of the image to render, usually alongside the title, to represent the object. If not provided, then the class name is used to locate an image.<br></p>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_reserved_manpage-title"><code>title()</code></a> and <a href="#_rg_methods_reserved_manpage-cssClass"><code>cssClass()</code></a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_reserved_manpage-title"><code>title()</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Provides a title for the object.<br></p>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_reserved_manpage-iconName"><code>iconName()</code></a> and <a href="#_rg_methods_reserved_manpage-cssClass"><code>cssClass()</code></a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_reserved_manpage-validate"><code>validate()</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Validate the object&#8217;s state prior to persisting.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_rg_methods_reserved_manpage-cssClass">4.2.1. <code>cssClass()</code></h4>
<div class="paragraph">
<p>The <code>cssClass()</code> returns a CSS class for a particular object instance.</p>
</div>
<div class="paragraph">
<p>The <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> wraps the object&#8217;s representation in a containing <code>&lt;div&gt;</code> with the class added.  This is done both for rendering the object either in a table or when rendering the object on its own page.</p>
</div>
<div class="paragraph">
<p>In conjunction with <a href="#_rg_runtime_application-specific_application-css"><code>application.css</code></a>, can therefore provide custom styling of an object instance wherever it is rendered.<br></p>
</div>
<div class="paragraph">
<p>For example, the (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a> uses this technique to add a strikethrough for completed todo items.  This is shown on the home page:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-methods/reserved/cssClass/strikethrough.png"><img src="images/reference-methods/reserved/cssClass/strikethrough.png" alt="strikethrough" width="800px"></a>
</div>
</div>
<div class="paragraph">
<p>The code to accomplish this is straightforward:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> ... {
    <span class="directive">public</span> <span class="predefined-type">String</span> cssClass() {
        <span class="keyword">return</span> !isComplete() ? <span class="string"><span class="delimiter">&quot;</span><span class="content">todo</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">done</span><span class="delimiter">&quot;</span></span>;
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <a href="#_rg_runtime_application-specific_application-css">application.css</a>, the following styles were then added:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="css"><span class="tag">tr</span><span class="class">.todo</span> {
}
<span class="tag">tr</span><span class="class">.done</span> {
    <span class="key">text-decoration</span>: <span class="value">line-through</span>;
    <span class="key">color</span>: <span class="color">#d3d3d3</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_reserved_manpage-title"><code>title()</code></a> and <a href="#_rg_methods_reserved_manpage-iconName"><code>iconName()</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_reserved_manpage-disable">4.2.2. <code>disable()</code></h4>
<div class="paragraph">
<p>One use case that Apache Isis supports is that of a domain object with a lifecycle whereby at some stage it should become immutable: all its properties/collections should be disabled, and/or its actions become not invokable.</p>
</div>
<div class="paragraph">
<p>It would be painful to have to write a separate <a href="#_rg_methods_prefixes_manpage-disable"><code>disable&#8230;&#8203;()</code></a> method for each and every member, so instead Isis allows a single <code>disable&#8230;&#8203;(&#8230;&#8203;)</code> method to be implemented that is applied to all members.</p>
</div>
<div class="paragraph">
<p>The signature of the method is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> disable(Identifier.Type identifierType) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>Identifier.Type</code> is part of the Isis applib (nested static class of <code>o.a.i.applib.Identifier</code>) to distinguish between an interaction with an action, a property or an action.</p>
</div>
<div class="paragraph">
<p>Note that Apache Isis' <a href="ug.html#_ug_more-advanced_i18n">i18n support</a> extends this so that the returned reason can also be internationalized.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> disable(Identifier.Type identifierType) {
    <span class="keyword">return</span> !calendarService.isOfficeHours(clock.today()
            ? <span class="string"><span class="delimiter">&quot;</span><span class="content">Cannot modify objects outside of office hours</span><span class="delimiter">&quot;</span></span>
            : <span class="predefined-constant">null</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See also the similar methods to <a href="#_rg_methods_reserved_manpage-hide"><code>hide()</code></a> object members en-masse.</p>
</div>
<div class="sect4">
<h5 id="_alternatives_2">Alternatives</h5>
<div class="paragraph">
<p>An alternative design&#8201;&#8212;&#8201;and one that could be easily argued is actually more flexible&#8201;&#8212;&#8201;is to leverage domain events with vetoing subscribers.</p>
</div>
<div class="paragraph">
<p>With this approach we define, for a given domain class, a base <code>PropertyDomainEvent</code>, <code>CollectionDomainEvent</code> and <code>ActionDomainEvent</code>.  A good pattern is to make these nested static classes.  For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> ... {
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">PropertyDomainEvent</span>&lt;T&gt;
            <span class="directive">extends</span> ToDoAppDomainModule.PropertyDomainEvent&lt;ToDoItem, T&gt; {
        ...
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where in turn:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">ToDoAppDomainModule</span> {
    <span class="directive">private</span> ToDoAppDomainModule(){}
    <span class="directive">public</span> <span class="directive">abstract</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">PropertyDomainEvent</span>&lt;S,T&gt;
            <span class="directive">extends</span> org.apache.isis.applib.services.eventbus.PropertyDomainEvent&lt;S,T&gt; {
        ...
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, each property/collection/action emits either these base domain events or their own subclass:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> ... {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">DescriptionDomainEvent</span>
            <span class="directive">extends</span> PropertyDomainEvent&lt;<span class="predefined-type">String</span>&gt; {
        ...
    }
    <span class="annotation">@Property</span>(
        domainEvent = DescriptionDomainEvent.class
    )
    <span class="directive">public</span> <span class="predefined-type">String</span> getDescription() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A vetoing subscriber can then subscribe to the domain events and veto access, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObject</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">VetoOutOfOfficeHours</span> {
    <span class="annotation">@Subscribe</span>
    <span class="directive">public</span> <span class="type">void</span> on(ToDoItem.PropertyDomainEvent ev) {
        <span class="keyword">if</span>(!calendarService.isOfficeHours(clock.today()) {
            ev.veto(<span class="string"><span class="delimiter">&quot;</span><span class="content">Cannot modify objects outside of office hours</span><span class="delimiter">&quot;</span></span>);
        }
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Obviously there&#8217;s an awful lot more boilerplate here, but there&#8217;s also a lot more flexibility.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_reserved_manpage-getId">4.2.3. <code>getId()</code></h4>
<div class="paragraph">
<p>The <code>getId()</code> method applies only to domain services, and allows a unique identifer to be provided for that service.</p>
</div>
<div class="paragraph">
<p>This identifier corresponds in many ways to the <a href="#_rg_annotations_manpage-DomainObject_objectType"><code>objectType()</code></a> attribute for domain objects; it is used as an internal identifier but also appears in URLs within the <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a>'s REST API.</p>
</div>
<div class="paragraph">
<p>If the identifier is omitted, the services fully qualified class name is used.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Unlike domain objects, where the use of an object type is strongly encouraged (eg using <a href="#_rg_annotations_manpage-PersistenceCapable"><code>@PersistenceCapable</code></a>), it matters much less if an id is specified for domain services.  The principle benefit is shorter URLs in the REST API.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_reserved_manpage-hide">4.2.4. <code>hide()</code></h4>
<div class="paragraph">
<p>One use case that Apache Isis supports is that of a domain object with a lifecycle whereby at some stage some number of the object&#8217;s members should be hidden.  For example, for an object that at some stage is logically immutable, we might want to make all its properties/collections unmodifiable and hide all its actions.</p>
</div>
<div class="paragraph">
<p>While we could write a separate <a href="#_rg_methods_prefixes_manpage-hide"><code>hide&#8230;&#8203;()</code></a> method for each and every action, this could become painful.  So instead Isis allows a single <code>hide&#8230;&#8203;(&#8230;&#8203;)</code> method to be implemented that is applied to all members.</p>
</div>
<div class="paragraph">
<p>The signature of the method is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">boolean</span> hide(Identifier.Type identifierType) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>Identifier.Type</code> is part of the Isis applib (nested static class of <code>o.a.i.applib.Identifier</code>) to distinguish between an interaction with an action, a property or an action.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">boolean</span> hide(Identifier.Type identifierType) {
    <span class="keyword">return</span> identifierType == Identifier.Type.ACTION &amp;&amp; isFrozen();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See also the similar method to <a href="#_rg_methods_reserved_manpage-disable"><code>disable()</code></a> object members en-masse.</p>
</div>
<div class="sect4">
<h5 id="_alternatives_3">Alternatives</h5>
<div class="paragraph">
<p>An alternative design&#8201;&#8212;&#8201;and one that could be easily argued is actually more flexible&#8201;&#8212;&#8201;is to leverage domain events with vetoing subscribers.</p>
</div>
<div class="paragraph">
<p>There is further discussion on this approach in <a href="#_rg_methods_reserved_manpage-disable">here</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_reserved_manpage-iconName">4.2.5. <code>iconName()</code></h4>
<div class="paragraph">
<p>Every object is represented by an icon; this is based on the domain object&#8217;s simple name.  The <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> searches for the image in the same package as the <code>.class</code> file for the domain object.</p>
</div>
<div class="paragraph">
<p>The <code>iconName()</code> allows the icon that to be used to change for individual object instances.  These are usually quite subtle, for example to reflect the particular status of an object.  The value returned by the <code>iconName()</code> method is added as a suffix to the base icon name.</p>
</div>
<div class="paragraph">
<p>For example, the (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a> uses this technique to add an overlay for todo items that have been completed:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-methods/reserved/iconName/differing.png"><img src="images/reference-methods/reserved/iconName/differing.png" alt="differing" width="200px"></a>
</div>
</div>
<div class="paragraph">
<p>The screenshot below shows the location of these png icon files:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-methods/reserved/iconName/png-files.png"><img src="images/reference-methods/reserved/iconName/png-files.png" alt="png files" width="200px"></a>
</div>
</div>
<div class="paragraph">
<p>The code to accomplish this is straightforward:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> ... {
    <span class="directive">public</span> <span class="predefined-type">String</span> iconName() {
        <span class="keyword">return</span> !isComplete() ? <span class="string"><span class="delimiter">&quot;</span><span class="content">todo</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">done</span><span class="delimiter">&quot;</span></span>;
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_reserved_manpage-title"><code>title()</code></a> and <a href="#_rg_methods_reserved_manpage-cssClass"><code>cssClass()</code></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_reserved_manpage-title">4.2.6. <code>title()</code></h4>
<div class="paragraph">
<p>Every object is represented by a title.  This appears both as a main header for the object when viewed as well as being used as a hyperlink within properties and collections.   It therefore must contain enough information for the end-user to distinguish the object from any others.</p>
</div>
<div class="paragraph">
<p>This is most commonly done by including some unique key within the title, for example a customer&#8217;s SSN, or an order number, and so forth.  However note that Apache Isis itself does <em>not</em> require the title to be unique; it is merely recommended in most cases.</p>
</div>
<div class="paragraph">
<p>An object&#8217;s title can be constructed in various ways, but the most flexible is to use the <code>title()</code> method.  The signature of this method is usually:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> title() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that Apache Isis' <a href="ug.html#_ug_more-advanced_i18n">i18n support</a> extends this so that titles can also be internationalized.</p>
</div>
<div class="paragraph">
<p>For example, the (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a> uses this technique to add an overlay for todo items that have been completed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> title() {
    <span class="directive">final</span> TitleBuffer buf = <span class="keyword">new</span> TitleBuffer();                              <i class="conum" data-value="1"></i><b>(1)</b>
    buf.append(getDescription());
    <span class="keyword">if</span> (isComplete()) {                                                     <i class="conum" data-value="2"></i><b>(2)</b>
        buf.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">- Completed!</span><span class="delimiter">&quot;</span></span>);
    } <span class="keyword">else</span> {
        <span class="keyword">try</span> {
            <span class="directive">final</span> LocalDate dueBy = wrapperFactory.wrap(<span class="local-variable">this</span>).getDueBy();   <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="keyword">if</span> (dueBy != <span class="predefined-constant">null</span>) {
                buf.append(<span class="string"><span class="delimiter">&quot;</span><span class="content"> due by</span><span class="delimiter">&quot;</span></span>, dueBy);
            }
        } <span class="keyword">catch</span>(<span class="directive">final</span> HiddenException ignored) {                            <i class="conum" data-value="4"></i><b>(4)</b>
        }
    }
    <span class="keyword">return</span> buf.toString();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>simple <a href="#_rg_classes_utility_manpage-TitleBuffer">tility class</a> to help construct the title string</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>imperative conditional logic</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>using the <a href="#_rg_services-api_manpage-WrapperFactory"><code>WrapperFactory</code></a> to determine if the <code>dueBy</code> field is visible for this user &#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>&#8230;&#8203; but ignore if not</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As the example above shows, the implementation can be as complex as you like.</p>
</div>
<div class="paragraph">
<p>In many cases, though, you may be able to use the <a href="#_rg_annotations_manpage-Title"><code>@Title</code></a> annotation.</p>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_reserved_manpage-iconName"><code>iconName()</code></a> and <a href="#_rg_methods_reserved_manpage-cssClass"><code>cssClass()</code></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_reserved_manpage-validate">4.2.7. <code>validate()</code></h4>
<div class="paragraph">
<p>The <code>validate()</code> method is used to specify that invariants pertaining to an object&#8217;s state are enforced.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>(As of 1.8.0) there are known limitations with this functionality.  Invariants are enforced when an object is initially created and when it is edited, however invariants are currently <em>not</em> enforced if an action is invoked.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The signature of the method is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> validate() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the returned string is the reason that the invocation is vetoed.</p>
</div>
<div class="paragraph">
<p>Note that Apache Isis' <a href="ug.html#_ug_more-advanced_i18n">i18n support</a> extends this so that the returned reason can also be internationalized.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_methods_lifecycle">4.3. Lifecycle Methods</h3>
<div class="paragraph">
<p>The lifecycle callback methods notify a domain entity about its interaction within the persistence lifecycle.  For example, the entity is notified immediately prior to being persisted, or when it is about to be updated.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that these callbacks are fired by Apache Isis rather than JDO.  In the future we may deprecate them because they duplicate functionality already available in JDO.</p>
</div>
<div class="paragraph">
<p>You may therefore want to consider using the JDO API directly; see <a href="#_rg_methods_lifecycle_jdo-api">here</a> for further discussion.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The lifecycle callback methods supported by Isis are:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 21. Lifecycle methods (partial support)</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_lifecycle_manpage-created"><code>created()</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>called when an object has just been created using <a href="#_rg_services-api_manpage-DomainObjectContainer"><code>newTransientInstance()</code></a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_lifecycle_manpage-loaded"><code>loaded()</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>called when a (persistent) object has just been loaded from the object store.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_lifecycle_manpage-persisted"><code>persisted()</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>called when object has just been persisted from the object store.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_lifecycle_manpage-persisting"><code>persisting()</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>called when a (not-yet-persistent) object is just about to be persisted from the object store</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_lifecycle_manpage-removed"><code>removed()</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>called when a (persistent) object has just been deleted from the object store</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_lifecycle_manpage-removing"><code>removing()</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>called when a (persistent) object is just about to be deleted from the object store</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_lifecycle_manpage-updated"><code>updated()</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>called when a (persistent) object has just been updated in the object store</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_methods_lifecycle_manpage-updating"><code>updating()</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>called when a (persistent) object is just about to be updated in the object store</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Some lifecycle methods have been deprecated:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 22. Deprecated lifecycle methods</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleted()</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Replaced by <a href="#_rg_methods_lifecycle_manpage-removed"><code>removed()</code></a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleting()</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Replaced by <a href="#_rg_methods_lifecycle_manpage-removing"><code>removing()</code></a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>loading()</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>callback for when the (persistent) object is just about to be loaded from the object store.<br></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This method is never called.</p>
</div>
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>saved()</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Replaced by <a href="#_rg_methods_lifecycle_manpage-persisted"><code>persisted()</code></a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>saving()</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Replaced by <a href="#_rg_methods_lifecycle_manpage-persisting"><code>persisting()</code></a></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_rg_methods_reserved_manpage-created">4.3.1. <code>created()</code></h4>
<div class="paragraph">
<p>The <code>created()</code> lifecycle callback method is called when an object has just been created using <a href="#_rg_services-api_manpage-DomainObjectContainer"><code>newTransientInstance()</code></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_reserved_manpage-loaded">4.3.2. <code>loaded()</code></h4>
<div class="paragraph">
<p>The <code>loaded()</code> lifecycle callback method is called when a (persistent) object has just been loaded from the object store.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_reserved_manpage-persisted">4.3.3. <code>persisted()</code></h4>
<div class="paragraph">
<p>The <code>persisted()</code> lifecycle callback method is called when object has just been persisted from the object store.</p>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_lifecycle_manpage-persisting"><code>persisting()</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_reserved_manpage-persisting">4.3.4. <code>persisting()</code></h4>
<div class="paragraph">
<p>The <code>persisting()</code> lifecycle callback method is called when a (not-yet-persistent) object is just about to be persisted from the object store</p>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_lifecycle_manpage-persisted"><code>persisted()</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_reserved_manpage-removed">4.3.5. <code>removed()</code></h4>
<div class="paragraph">
<p>The <code>removed()</code> lifecycle callback method is called when a (persistent) object has just been deleted from the object store</p>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_lifecycle_manpage-removing"><code>removing()</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_reserved_manpage-removing">4.3.6. <code>removing()</code></h4>
<div class="paragraph">
<p>The <code>removing()</code> lifecycle callback method is called when a (persistent) object is just about to be deleted from the object store</p>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_lifecycle_manpage-removed"><code>removed()</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_reserved_manpage-updated">4.3.7. <code>updated()</code></h4>
<div class="paragraph">
<p>The <code>updated()</code> lifecycle callback method is called when a (persistent) object has just been updated in the object store</p>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_lifecycle_manpage-updating"><code>updating()</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_reserved_manpage-updating">4.3.8. <code>updating()</code></h4>
<div class="paragraph">
<p>The <code>updating()</code> lifecycle callback method is called when a (persistent) object is just about to be updated in the object store</p>
</div>
<div class="paragraph">
<p>See also <a href="#_rg_methods_lifecycle_manpage-updated"><code>updated()</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_methods_lifecycle_jdo-api">4.3.9. Using the JDO API</h4>
<div class="paragraph">
<p>As an alternative to relying on Apache Isis to call lifecycle callback methods, you could instead use the JDO <a href="http://www.datanucleus.org/products/datanucleus/jdo/lifecycle_callbacks.html">lifecycle listener</a> API directly.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We may decide to deprecate the Apache Isis callbacks in the future because they merely duplicate this functionality already available in JDO.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can gain access to the relevant JDO API using the <a href="#_rg_services-api_manpage-IsisJdoSupport"><code>IsisJdoSupport</code></a> domain service.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequestScoped</span>                                                   <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@DomainService</span>(nature=NatureOfService.DOMAIN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ObjectChangedListenerService</span>
        <span class="directive">implements</span> javax.jdo.listener.StoreLifecycleListener {   <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="annotation">@Programmatic</span>
    <span class="annotation">@PostConstruct</span>
    <span class="directive">public</span> <span class="type">void</span> init() {
        getPmFactory().addInstanceLifecycleListener(<span class="local-variable">this</span>);
    }
    <span class="annotation">@Programmatic</span>
    <span class="annotation">@PreDestroy</span>
    <span class="directive">public</span> <span class="type">void</span> tidyUp() {
        getPmFactory().removeInstanceLifecycleListener(<span class="local-variable">this</span>);
    }
    <span class="directive">private</span> PersistenceManager getPersistenceManager() {
        <span class="keyword">return</span> jdoSupport.getPersistenceManager();               <i class="conum" data-value="3"></i><b>(3)</b>
    }
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="type">void</span> preStore (InstanceLifecycleEvent event) { ... }
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="type">void</span> postStore (InstanceLifecycleEvent event) { ... }
    <span class="annotation">@Inject</span>
    IsisJdoSupport jdoSupport;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>must be <code>@RequestScoped</code> because we register on the <code>PersistenceManager</code>, which is different for each request.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>implement whichever callback lifecycle listeners are of interest</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>use the injected <a href="#_rg_services-api_manpage-IsisJdoSupport"><code>IsisJdoSupport</code></a> service to obtain the <code>PersistenceManager</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that it isn&#8217;t possible to register on the <code>PersistenceManagerFactory</code> because listeners cannot be attached once a persistence session has been created (which it will have been when the service&#8217;s <code>@PostConstruct</code> method is called).</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rg_services-api">5. Domain Services API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apache Isis includes an extensive number of domain services for your domain objects to use; simply define the service as an annotated field and Apache Isis will inject the service into your object.  These services' API are all defined in Apache Isis' applib (<code>o.a.i.core:isis-core-applib</code> module); this minimizes the coupling between your code and Apache Isis.  It also allows you to easily mock out these services in your unit tests.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In addition there are a number of domain services that constitute an SPI; if present they are used by Apache Isis itself rather than by your domain objects.  A good example of this is the <a href="#_rg_services-spi_manpage-AuditingService"><code>AuditingService3</code></a> service.  The SPI services are covered in the <a href="#_rg_services-spi">Domain Services (SPI) chapter</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The table below summarizes all the APIs defined by Apache Isis.  It also lists their corresponding implementation, either a default implementation provided by Apache Isis itself, or provided by one of the in (non-ASF) <a href="http://www.isisaddons.org">Isis Addons</a> modules.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 23. Domain Services</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">API</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Implementation</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-api_manpage-ActionInvocationContext"><code>o.a.i.applib.</code><br>
<code>services.actinv</code><br>
<code>ActionInvocation-</code><br>
<code>Context</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Request-scoped access to whether action is invoked on object and/or on collection of objects</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>ActionInvocationContext</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-applib</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>API is also concrete class</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-api_manpage-BackgroundService"><code>o.a.i.applib.</code><br>
<code>services.background</code><br>
<code>BackgroundService</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Programmatic persistence of commands to be persisted (so can be executed by a background mechanism, eg scheduler)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>BackgroundServiceDefault</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-runtime</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>depends on:<br>
<a href="#_rg_services-spi_manpage-BackgroundCommandService"><code>BackgroundCommand-Service</code></a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-api_manpage-BookmarkService"><code>o.a.i.applib.</code><br>
<code>services.bookmark</code><br>
<code>BookmarkService</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Convert object reference to a serializable "bookmark", and vice versa</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>BookmarkServiceDefault</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-metamodel</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>related services:
<code>BookmarkHolder-</code><br>
<code>ActionContributions</code>,
<code>BookmarkHolder-</code><br>
<code>Association-</code><br>
<code>Contributions</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-api_manpage-ClockService"><code>o.a.i.applib.</code><br>
<code>services.clock</code><br>
<code>ClockService</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Access the current time (and for testing, allow the time to be changed)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>ClockService</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-applib</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>API is also a concrete class.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-api_manpage-CommandContext"><code>o.a.i.applib.</code><br>
<code>services.command</code><br>
<code>CommandContext</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Request-scoped access the current action that is being invoked, represented as a command object</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>CommandContext</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-applib</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>API is also a concrete class.<br>
depends on:<br>
<a href="#_rg_services-spi_manpage-CommandService"><code>CommandService</code></a> for persistent <code>Command</code>, else in-memory impl. used</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-api_manpage-DeepLinkService"><code>o.a.i.applib</code><br>
<code>services.deeplink</code><br>
<code>DeepLinkService</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Obtain a URL to a domain object (eg for use within an email or report)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>DeepLinkServiceWicket</code><br>
<code>o.a.i.viewer</code><br>
<code>isis-viewer-wicket-impl</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Implementation only usable within Wicket viewer</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-api_manpage-DomainObjectContainer"><code>o.a.i.applib</code><br>
<code>DomainObjectContainer</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Generic repository to search, create and delete objects.  Also miscellaneous other functions, eg obtain title of object.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>DomainObjectContainer-</code><br>
<code>Default</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-metamodel</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-api_manpage-EmailService"><code>o.a.i.applib.</code><br>
<code>services.email</code><br>
<code>EmailService</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Send a HTML email, optionally with attachments.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>EmailServiceDefault</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-runtime</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-api_manpage-EventBusService"><code>o.a.i.applib.</code><br>
<code>services.eventbus</code><br>
<code>EventBusService</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Programmatically post events to the internal event bus.  Also used by Apache Isis itself to broadcast domain events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_rg_annotations_manpage-Action_domainEvent"><code>Action#domainEvent()</code></a></p>
</li>
<li>
<p><a href="#_rg_annotations_manpage-Property_domainEvent"><code>Property#domainEvent()</code></a></p>
</li>
<li>
<p><a href="#_rg_annotations_manpage-Collection_domainEvent"><code>Collection#domainEvent()</code></a></p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>EventBusServiceJdo</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-objectstore-jdo-datanucleus</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-api_manpage-FixtureScriptsDefault"><code>o.a.i.applib.</code><br>
<code>services.</code><br>
<code>fixturespec</code><br>
<code>FixtureScriptsDefault</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Fallback implementation of <a href="#_rg_classes_utility_manpage-FixtureScripts"><code>FixtureScripts</code></a>, providing the ability to execute fixture scripts.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>FixtureScriptsDefault</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-applib</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Interacts with <a href="#_rg_services-spi_manpage-FixtureScriptsSpecificationProvider"><code>FixtureScripts-
SpecificationProvider</code></a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-api_manpage-GuiceBeanProvider"><code>o.a.i.applib.</code><br>
<code>services.guice</code><br>
<code>GuiceBeanProvider</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Access to internal framework services initialized using Guice DI.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>GuiceBeanProviderWicket</code><br>
<code>o.a.i.core</code><br>
<code>isis-viewer-wicket-impl</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-api_manpage-IsisJdoSupport"><code>o.a.i.applib.</code><br>
<code>services.jdosupport</code><br>
<code>IsisJdoSupport</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Lower level access to the JDO Persistence API.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>IsisJdoSupportImpl</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-objectstore-jdo-datanucleus</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-api_manpage-MementoService"><code>o.a.i.applib.</code><br>
<code>services.memento</code><br>
<code>MementoService</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Capture a serializable memento of a set of primitives or <a href="#_rg_services-api_manpage-BookmarkService">bookmarks</a>.  Primarily used internally, eg in support of commands/auditing.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>MementoServiceDefault</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-runtime</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-api_manpage-MetaModelService"><code>o.a.i.applib.</code><br>
<code>services.metamodel</code><br>
<code>MetaModelService</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Access to certain information from the Apache Isis metamodel.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>MetaModelServiceDefault</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-metamodel</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-api_manpage-QueryResultsCache"><code>o.a.i.applib.</code><br>
<code>services.</code><br>
<code>queryresultscache</code><br>
<code>QueryResultsCache</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Request-scoped caching of the results of queries (or any data set generated by a given set of input arguments).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>QueryResultsCache</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-applib</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>API is also a concrete class</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-api_manpage-Scratchpad"><code>o.a.i.applib.</code><br>
<code>services.scratchpad</code><br>
<code>Scratchpad</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Request-scoped service for interchanging information between and aggregating over multiple method calls; in particular for use by "bulk" actions (invoking of an action for all elements of a collection)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>Scratchpad</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-applib</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>API is also a concrete class</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-api_manpage-SudoService"><code>o.a.i.applib.</code><br>
<code>services.sudo</code><br>
<code>SudoService</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>For use in testing while running <a href="#_rg_classes_super_manpage-FixtureScripts">fixture scripts</a>, allows a block of code to run as a specified user account.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>SudoServiceDefault</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-runtime</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>API is also a concrete class</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-api_manpage-WrapperFactory"><code>o.a.i.applib.</code><br>
<code>services.wrapper</code><br>
<code>WrapperFactory</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Interact with another domain object "as if" through the UI (enforcing business rules, firing domain events)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>WrapperFactoryDefault</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-wrapper</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-api_manpage-XmlSnapshotService"><code>o.a.i.applib.</code><br>
<code>services.xmlsnapshot</code><br>
<code>XmlSnapshotService</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Generate an XML representation of an object and optionally a graph of related objects.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>XmlSnapshotServiceDefault</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-runtime</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Key:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>o.a.i</code> is an abbreviation for <code>org.apache.isis</code></p>
</li>
<li>
<p><code>o.ia.m</code> is an abbreviation for <code>org.isisaddons.module</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is also a number of deprecated domain services.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 24. Deprecated Domain Services</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">API</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Implementation</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>o.a.i.applib.</code><br>
<code>annotation</code>
<code>Bulk.InteractionContext</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Request-scoped access to whether action is invoked on object and/or on collection of objects</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>Bulk.InteractionContext</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-applib</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Replaced by <a href="#_rg_services-api_manpage-ActionInvocationContext"><code>ActionInvocationContext</code></a></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Key:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>o.a.i</code> is an abbreviation for <code>org.apache.isis</code></p>
</li>
<li>
<p><code>o.ia.m</code> is an abbreviation for <code>org.isisaddons.module</code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_rg_services-api_manpage-ActionInvocationContext">5.1. <code>ActionInvocationContext</code></h3>
<div class="paragraph">
<p>The <code>ActionInvocationContext</code> domain service is a <a href="#_rg_annotations_manpage-RequestScoped"><code>@RequestScoped</code></a> service intended to support the implementation of "bulk" actions annotated with <a href="#_rg_annotations_manpage-Action_invokeOn"><code>@Action#invokeOn()</code></a>.  This allows the user to select multiple objects in a table and then invoke the same action against all of them.</p>
</div>
<div class="paragraph">
<p>When an action is invoked in this way, this service allows each object instance to "know where it is" in the collection; it acts a little like an iterator.  In particular, an object can determine if it is the last object to be called, and so can perform special processing, eg to return a summary calculated result.</p>
</div>
<div class="sect3">
<h4 id="_api">5.1.1. API</h4>
<div class="paragraph">
<p>The API defined by the service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature = NatureOfService.DOMAIN)
<span class="annotation">@RequestScoped</span>                                        <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">ActionInvocationContext</span> {
    <span class="directive">public</span> InvokedOn getInvokedOn() { ... }           <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span>&gt; getDomainObjects() { ... }    <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="directive">public</span> <span class="type">int</span> getSize() { ... }
    <span class="directive">public</span> <span class="type">int</span> getIndex() { ... }                     <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="directive">public</span> <span class="type">boolean</span> isFirst() { ... }
    <span class="directive">public</span> <span class="type">boolean</span> isLast() { ... }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>is <a href="#_rg_annotations_manpage-RequestScoped"><code>@RequestScoped</code></a>, so this domain service instance is scoped to a particular request and is then destroyed</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>an enum set to either <code>OBJECT</code> (if action has been invoked on a single object) or <code>COLLECTION</code> (if has been invoked on a collection).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>returns the list of domain objects which are being acted upon</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>is the 0-based index to the object being acted upon.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_usage">5.1.2. Usage</h4>
<div class="paragraph">
<p>For actions that are void or that return null, Apache Isis will return to the list once executed. But for bulk actions that are non-void, Apache Isis will render the returned object/value from the last object invoked (and simply discards the object/value of all actions except the last).</p>
</div>
<div class="paragraph">
<p>One idiom is for the domain objects to also use the <a href="#_rg_services-api_manpage-Scratchpad"><code>Scratchpad</code></a> service to share information, for example to aggregate values. The <code>ActionInvocationContext#isLast()</code> method can then be used to determine if all the information has been gathered, and then do something with it (eg derive variance across a range of values, render a graph etc).</p>
</div>
<div class="paragraph">
<p>More prosaically, the <code>ActoinInvocationContext</code> can be used to ensure that the action behaves appropriately depending on how it has been invoked (on a single object and/or a collection) whether it is called in bulk mode or regular mode. Here&#8217;s a snippet of code from the bulk action in the Isis addon example <a href="https://github.com/isisaddons/isis-app-todoapp/">todoapp</a> (not ASF):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> ... {
    <span class="annotation">@Action</span>(invokeOn=InvokeOn.OBJECTS_AND_COLLECTIONS)
    <span class="directive">public</span> ToDoItem completed() {
        setComplete(<span class="predefined-constant">true</span>);
        ...
        return actionInteractionContext.getInvokedOn() == InvokedOn.OBJECT
                ? <span class="local-variable">this</span>  <i class="conum" data-value="1"></i><b>(1)</b>
                : <span class="predefined-constant">null</span>; <i class="conum" data-value="2"></i><b>(2)</b>
    }
    <span class="annotation">@Inject</span>
    ActionInteractionContext actionInteractionContext;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>if invoked as a regular action, return this object;</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>otherwise (if invoked on collection of objects), return null, so that the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> will re-render the list of objects</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_service">5.1.3. Registering the Service</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then Isis' default implementation of <code>ActionInvocationContext</code> class is automatically registered (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="_unit_testing_support">5.1.4. Unit testing support</h4>
<div class="paragraph">
<p>The <code>ActionInvocationContext</code> class also has a couple of static factory methods intended to support unit testing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature = NatureOfService.DOMAIN)
<span class="annotation">@RequestScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ActionInvocationContext</span> {
    <span class="directive">public</span> <span class="directive">static</span> ActionInvocationContext onObject(<span class="directive">final</span> <span class="predefined-type">Object</span> domainObject) {
        <span class="keyword">return</span> <span class="keyword">new</span> ActionInvocationContext(InvokedOn.OBJECT, <span class="predefined-type">Collections</span>.singletonList(domainObject));
    }
    <span class="directive">public</span> <span class="directive">static</span> ActionInvocationContext onCollection(<span class="directive">final</span> <span class="predefined-type">Object</span>... domainObjects) {
        <span class="keyword">return</span> onCollection(<span class="predefined-type">Arrays</span>.asList(domainObjects));
    }
    <span class="directive">public</span> <span class="directive">static</span> ActionInvocationContext onCollection(<span class="directive">final</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span>&gt; domainObjects) {
        <span class="keyword">return</span> <span class="keyword">new</span> ActionInvocationContext(InvokedOn.COLLECTION, domainObjects);
    }
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-api_manpage-BackgroundService">5.2. <code>BackgroundService</code></h3>
<div class="paragraph">
<p>The <code>BackgroundService</code>, and the companion <a href="#_rg_services-spi_manpage-BackgroundCommandService"><code>BackgroundCommandService</code></a> SPI service (used by Apache Isis itself), enable action invocations to be persisted such that they may be invoked in the background.</p>
</div>
<div class="paragraph">
<p>The <code>BackgroundService</code> is responsible for capturing a memento representing the action invocation in a typesafe way, and persisting it rather than executing it directly.</p>
</div>
<div class="paragraph">
<p>The default <code>BackgroundServiceDefault</code> implementation (provided by isis-core) works by using a proxy wrapper around the target so that it can capture the action to invoke and its arguments using (a private copy of) <a href="#_rg_services-api_manpage-MementoService"><code>MementoService</code></a>.  The persistence delegates the persistence of the memento to an appropriate implementation of the companion <code>BackgroundCommandService</code>.  One such implementation of <code>BackgroundCommandService</code> is provided by (non-ASF) <a href="http://github.com/isisaddons/isis-module-command">Isis addons' command</a> module.</p>
</div>
<div class="paragraph">
<p>The persisting of commands is only half the story; there needs to be a separate process to read the commands and execute them. The <code>BackgroundCommandExecution</code> abstract class (discussed <a href="#_rg_services-api_manpage-BackgroundService_BackgroundCommandExecution">below</a>) provides infrastructure to do this; the concrete
implementation of this class depends on the configured <code>BackgroundCommandService</code> (in order to query for the persisted (background) <code>Command</code>s.</p>
</div>
<div class="sect3">
<h4 id="_api_implementation">5.2.1. API &amp; Implementation</h4>
<div class="paragraph">
<p>Returns a proxy around the object which is then used to obtain the signature of the action to be invoked in the background.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">BackgroundService</span> {
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; T execute(<span class="directive">final</span> T object);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default implementation is provided by core (<code>o.a.i.core.runtime.services.background.BackgroundServiceDefault</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_usage_2">5.2.2. Usage</h4>
<div class="paragraph">
<p>Using the service is very straight-forward; wrap the target domain object using <code>BackgroundService#execute(&#8230;&#8203;)</code> and invoke the method on the object returned by that method.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> submitCustomerInvoices() {
    <span class="keyword">for</span>(Customer customer: customerRepository.findCustomersToInvoice()) {
        backgroundService.execute(customer).submitInvoice();
    }
    container.informUser(<span class="string"><span class="delimiter">&quot;</span><span class="content">Calculating...</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create a bunch of background commands executing the <code>submitInvoice()</code> action for each of the customers returned from the customer repository.</p>
</div>
<div class="paragraph">
<p>The action method invoked must be part of the Apache Isis metamodel, which is to say it must be public, accept only scalar arguments, and must not be annotated with <a href="#_rg_annotations_manpage-Programmatic"><code>@Programmatic</code></a> or <code>@Ignore</code>. However, it may be annotated with <a href="#_rg_annotations_manpage-Action_hidden"><code>@Action#hidden()</code></a> or <a href="#_rg_annotations_manpage-ActionLayout_hidden"><code>@ActionLayout#hidden()</code></a> and it will still be invoked.</p>
</div>
<div class="paragraph">
<p>In fact, when invoked by the background service, no business rules (hidden, disabled, validation) are enforced; the action method must take responsibility for performing appropriate validation and error checking.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to check business rules, you can use <a href="#_rg_annotations_manpage-WrapperFactory"><code>@WrapperFactory#wrapNoExecute(&#8230;&#8203;)</code></a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_end_user_experience">5.2.3. End-user experience</h4>
<div class="paragraph">
<p>For the end-user, executing an action that delegates work off to the <code>BackgroundService</code> raises the problem of how does the user know the work is complete?</p>
</div>
<div class="paragraph">
<p>One option is for the background jobs to take responsibility to notify the user themselves. In the above example, this would be the <code>submitInvoice()</code> method called upon each customer. One could imagine more complex designs where only the final command executed notifies the user.</p>
</div>
<div class="paragraph">
<p>However, an alternative is to rely on the fact that the <code>BackgroundService</code> will automatically hint that the <code>Command</code> representing the original interaction (to <code>submitCustomerInvoices()</code> in the example above) should be persisted. This will be available if the related <a href="#_rg_services-api_manpage-CommandContext"><code>CommandContext</code></a> and <a href="#_rg_services-spi_manpage-CommandService"><code>CommandService</code></a> domain services are configured, and the <code>CommandService</code> supports persistent commands.  Note that (non-ASF) <a href="http://github.com/isisaddons/isis-module-command">Isis addons' command</a> module does indeed provide such an implementation of <code>CommandService</code> (as well as of the required <code>BackgroundCommandService</code>).</p>
</div>
<div class="paragraph">
<p>Thus, the original action can run a query to obtain it corresponding <code>Command</code>, and return this to the user. The upshot is that the child <code>Command</code>s created by the <code>BackgroundService</code> will then be associated with <code>Command</code> for the original action.</p>
</div>
<div class="paragraph">
<p>We could if we wanted write the above example as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> Command submitCustomerInvoices() {
    <span class="keyword">for</span>(Customer customer: customerRepository.findCustomersToInvoice()) {
        backgroundService.execute(customer).submitInvoice();
    }
    <span class="keyword">return</span> commandContext.getCommand();
}
<span class="annotation">@Inject</span>
CommandContext commandContext;  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the injected <a href="#_rg_services-api_manpage-CommandContext"><code>CommandContext</code></a> domain service.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The user would be returned a domain object representing their action invocation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_services">5.2.4. Registering the Services</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then Apache Isis' core implementation of <code>BackgroundService</code> is automatically registered (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services">5.2.5. Related Services</h4>
<div class="paragraph">
<p>This service is closely related to the <a href="#_rg_services-api_manpage-CommandContext"><code>CommandContext</code></a> and also that service&#8217;s supporting <a href="#_rg_services-spi_manpage-CommandService"><code>CommandService</code></a> service.</p>
</div>
<div class="paragraph">
<p>The <code>CommandContext</code> service is responsible for providing a parent <code>Command</code> with which the background <code>Command</code>s can then be associated as children, while the <code>CommandService</code> is responsible for persisting those parent <code>Command`s. The latter is analogous to the way in which the `BackgroundCommandService</code> persists the child background `Command`s.</p>
</div>
<div class="paragraph">
<p>The implementations of <code>CommandService</code> and <code>BackgroundCommandService</code> go together; typically both parent <code>Command`s and child background `Command`s will be persisted in the same way. The (non-ASF) <a href="http://github.com/isisaddons/isis-module-command">Isis addons' command</a> module provides implementations of both (see <a href="#_rg_services-spi_manpage-CommandService">`CommandService</code></a> and <a href="#_rg_services-spi_manpage-BackgroundCommandService"><code>BackgroundCommandService</code></a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_services-api_manpage-BackgroundService_BackgroundCommandExecution">5.2.6. <code>BackgroundCommandExecution</code> abstract class</h4>
<div class="paragraph">
<p>The <code>BackgroundCommandExecution</code> (in isis-core) is an abstract template class provided by isis-core that defines an abstract hook method to obtain background `Command`s to be executed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">BackgroundCommandExecution</span>
                         <span class="directive">extends</span> AbstractIsisSessionTemplate {
    ...
    protected <span class="directive">abstract</span> <span class="predefined-type">List</span>&lt;? <span class="directive">extends</span> Command&gt; findBackgroundCommandsToExecute();
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The developer is required to implement this hook method in a subclass.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_services-api_manpage-BackgroundService_Quartz">5.2.7. Quartz Scheduler Configuration</h4>
<div class="paragraph">
<p>The last part of the puzzle is to actually run the (appropriate implementation of) `BackgroundCommandExecution).  This could be run in a batch job overnight, or run continually by, say, the <a href="http://quartz-scheduler.org">Quartz</a> scheduler or by <a href="http://camel.apache.org" class="bare">http://camel.apache.org</a>]Apache Camel].  This section looks at configuring Quartz.</p>
</div>
<div class="paragraph">
<p>If using (non-ASF) <a href="http://github.com/isisaddons/isis-module-command">Isis addons' command</a> module, then note that this already provides a suitable concrete implementation, namely <code>org.isisaddons.module.command.dom.BackgroundCommandExecutionFromBackgroundCommandServiceJdo</code>.  We therefore just need to schedule this to run as a Quartz job.</p>
</div>
<div class="paragraph">
<p>First, we need to define a Quartz job, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.isisaddons.module.command.dom.BackgroundCommandExecutionFromBackgroundCommandServiceJdo</span>;
<span class="directive">public</span> <span class="type">class</span> <span class="class">BackgroundCommandExecutionQuartzJob</span> <span class="directive">extends</span> AbstractIsisQuartzJob {
    <span class="directive">public</span> BackgroundCommandExecutionQuartzJob() {
        <span class="local-variable">super</span>(<span class="keyword">new</span> BackgroundCommandExecutionFromBackgroundCommandServiceJdo());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>AbstractIsisQuartzJob</code> is in turn the following boilerplate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">domainapp.webapp.quartz</span>;
<span class="keyword">import</span> <span class="include">org.quartz.Job</span>;
<span class="keyword">import</span> <span class="include">org.quartz.JobExecutionContext</span>;
<span class="keyword">import</span> <span class="include">org.quartz.JobExecutionException</span>;
...
public <span class="type">class</span> <span class="class">AbstractIsisQuartzJob</span> <span class="directive">implements</span> Job {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">enum</span> ConcurrentInstancesPolicy {
        SINGLE_INSTANCE_ONLY,
        MULTIPLE_INSTANCES
    }

    <span class="directive">private</span> <span class="directive">final</span> AbstractIsisSessionTemplate isisRunnable;
    <span class="directive">private</span> <span class="directive">final</span> ConcurrentInstancesPolicy concurrentInstancesPolicy;
    <span class="directive">private</span> <span class="type">boolean</span> executing;

    <span class="directive">public</span> AbstractIsisQuartzJob(AbstractIsisSessionTemplate isisRunnable) {
        <span class="local-variable">this</span>(isisRunnable, ConcurrentInstancesPolicy.SINGLE_INSTANCE_ONLY);
    }
    <span class="directive">public</span> AbstractIsisQuartzJob(
            AbstractIsisSessionTemplate isisRunnable,
            ConcurrentInstancesPolicy concurrentInstancesPolicy) {
        <span class="local-variable">this</span>.isisRunnable = isisRunnable;
        <span class="local-variable">this</span>.concurrentInstancesPolicy = concurrentInstancesPolicy;
    }

    <span class="directive">public</span> <span class="type">void</span> execute(<span class="directive">final</span> JobExecutionContext context)
            <span class="directive">throws</span> JobExecutionException {
        <span class="directive">final</span> AuthenticationSession authSession = newAuthSession(context);
        <span class="keyword">try</span> {
            <span class="keyword">if</span>(concurrentInstancesPolicy == ConcurrentInstancesPolicy.SINGLE_INSTANCE_ONLY &amp;&amp;
               executing) {
                <span class="keyword">return</span>;
            }
            executing = <span class="predefined-constant">true</span>;

            isisRunnable.execute(authSession, context);
        } <span class="keyword">finally</span> {
            executing = <span class="predefined-constant">false</span>;
        }
    }

    AuthenticationSession newAuthSession(JobExecutionContext context) {
        <span class="predefined-type">String</span> user = getKey(context, SchedulerConstants.USER_KEY);
        <span class="predefined-type">String</span> rolesStr = getKey(context, SchedulerConstants.ROLES_KEY);
        <span class="predefined-type">String</span><span class="type">[]</span> roles = Iterables.toArray(
                Splitter.on(<span class="string"><span class="delimiter">&quot;</span><span class="content">,</span><span class="delimiter">&quot;</span></span>).split(rolesStr), <span class="predefined-type">String</span>.class);
        <span class="keyword">return</span> <span class="keyword">new</span> SimpleSession(user, roles);
    }

    <span class="predefined-type">String</span> getKey(JobExecutionContext context, <span class="predefined-type">String</span> key) {
        <span class="keyword">return</span> context.getMergedJobDataMap().getString(key);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This job can then be configured to run using Quartz' <code>quartz-config.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;job-scheduling-data</span>
    <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.quartz-scheduler.org/xml/JobSchedulingData</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.quartz-scheduler.org/xml/JobSchedulingData</span>
<span class="content">http://www.quartz-scheduler.org/xml/job_scheduling_data_1_8.xsd</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.8</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;schedule&gt;</span>
       <span class="tag">&lt;job&gt;</span>
         <span class="tag">&lt;name&gt;</span>BackgroundCommandExecutionJob<span class="tag">&lt;/name&gt;</span>
         <span class="tag">&lt;group&gt;</span>Isis<span class="tag">&lt;/group&gt;</span>
         <span class="tag">&lt;description&gt;</span>
                Poll and execute any background actions persisted by the BackgroundActionServiceJdo domain service
            <span class="tag">&lt;/description&gt;</span>
         <span class="tag">&lt;job-class&gt;</span>domainapp.webapp.quartz.BackgroundCommandExecutionQuartzJob<span class="tag">&lt;/job-class&gt;</span>
         <span class="tag">&lt;job-data-map&gt;</span>
          <span class="tag">&lt;entry&gt;</span>
              <span class="tag">&lt;key&gt;</span>webapp.scheduler.user<span class="tag">&lt;/key&gt;</span>
              <span class="tag">&lt;value&gt;</span>scheduler_user<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;/entry&gt;</span>
          <span class="tag">&lt;entry&gt;</span>
              <span class="tag">&lt;key&gt;</span>webapp.scheduler.roles<span class="tag">&lt;/key&gt;</span>
              <span class="tag">&lt;value&gt;</span>admin_role<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;/entry&gt;</span>
         <span class="tag">&lt;/job-data-map&gt;</span>
       <span class="tag">&lt;/job&gt;</span>
       <span class="tag">&lt;trigger&gt;</span>
         <span class="tag">&lt;cron&gt;</span>
          <span class="tag">&lt;name&gt;</span>BackgroundCommandExecutionJobEveryTenSeconds<span class="tag">&lt;/name&gt;</span>
          <span class="tag">&lt;job-name&gt;</span>BackgroundCommandExecutionJob<span class="tag">&lt;/job-name&gt;</span>
          <span class="tag">&lt;job-group&gt;</span>Isis<span class="tag">&lt;/job-group&gt;</span>
          <span class="tag">&lt;cron-expression&gt;</span>0/10 * * * * ?<span class="tag">&lt;/cron-expression&gt;</span>
         <span class="tag">&lt;/cron&gt;</span>
       <span class="tag">&lt;/trigger&gt;</span>
    <span class="tag">&lt;/schedule&gt;</span>
<span class="tag">&lt;/job-scheduling-data&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The remaining two pieces of configuration are the <code>quartz.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">org.quartz.scheduler.instanceName = SchedulerQuartzConfigXml
org.quartz.threadPool.threadCount = 1
org.quartz.jobStore.class = org.quartz.simpl.RAMJobStore
org.quartz.plugin.jobInitializer.class =org.quartz.plugins.xml.XMLSchedulingDataProcessorPlugin
org.quartz.plugin.jobInitializer.fileNames = webapp/scheduler/quartz-config.xml
org.quartz.plugin.jobInitializer.failOnFileNotFound = true</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the entry in <code>web.xml</code> for the Quartz servlet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet&gt;</span>
     <span class="tag">&lt;servlet-name&gt;</span>QuartzInitializer<span class="tag">&lt;/servlet-name&gt;</span>
     <span class="tag">&lt;servlet-class&gt;</span>org.quartz.ee.servlet.QuartzInitializerServlet<span class="tag">&lt;/servlet-class&gt;</span>
     <span class="tag">&lt;init-param&gt;</span>
         <span class="tag">&lt;param-name&gt;</span>config-file<span class="tag">&lt;/param-name&gt;</span>
         <span class="tag">&lt;param-value&gt;</span>webapp/scheduler/quartz.properties<span class="tag">&lt;/param-value&gt;</span>
     <span class="tag">&lt;/init-param&gt;</span>
     <span class="tag">&lt;init-param&gt;</span>
         <span class="tag">&lt;param-name&gt;</span>shutdown-on-unload<span class="tag">&lt;/param-name&gt;</span>
         <span class="tag">&lt;param-value&gt;</span>true<span class="tag">&lt;/param-value&gt;</span>
     <span class="tag">&lt;/init-param&gt;</span>
     <span class="tag">&lt;init-param&gt;</span>
         <span class="tag">&lt;param-name&gt;</span>start-scheduler-on-load<span class="tag">&lt;/param-name&gt;</span>
         <span class="tag">&lt;param-value&gt;</span>true<span class="tag">&lt;/param-value&gt;</span>
     <span class="tag">&lt;/init-param&gt;</span>
     <span class="tag">&lt;load-on-startup&gt;</span>1<span class="tag">&lt;/load-on-startup&gt;</span>
 <span class="tag">&lt;/servlet&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-api_manpage-BookmarkService">5.3. <code>BookmarkService</code></h3>
<div class="paragraph">
<p>The <code>BookmarkService</code> provides the ability to obtain a serializable <code>o.a.i.applib.bookmarks.Bookmark</code> for any (persisted) domain object, and to lookup domain objects given a <code>Bookmark</code>.  This can then in turn be converted to and from a string.</p>
</div>
<div class="paragraph">
<p>For example, a <code>Customer</code> object with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an object type of "custmgmt.Customer" (as per <a href="#_rg_annotations_manpage-DomainObject_objectType"><code>DomainObject#objectType()</code></a> or equivalent) , and</p>
</li>
<li>
<p>an id=123</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>could correspond to a <code>Bookmark</code> with a string representation of <code>custmgmt.Customer|123</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A <code>Bookmark</code> is little more than an API equivalent of Apache Isis' internal <code>Oid</code> (object identifier).  Nevertheless, the ability to uniquely address <em>any</em> domain object within an Apache Isis system&#8201;&#8212;&#8201;to in effect provide a URN&#8201;&#8212;&#8201;is immensely useful.</p>
</div>
<div class="paragraph">
<p>For example, a <code>Bookmark</code> could be converted into a barcode, and then this used for automated scanning of correspondence from a customer.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>Bookmark</code>s are used by several other domain services as a means of storing areference to an arbitrary object (a polymorphic relationship).  For example, the (non-ASF) <a href="http://github.com/isisaddons/isis-module-auditing">Isis addons' auditing</a> module&#8217;s implementation of <a href="#_rg_services-spi_manpage-AuditingService"><code>AuditingService</code></a> uses bookmarks to capture the object that is being audited.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>One downside of using <code>Bookmark</code>s is that there is no way for the JDO/DataNucleus objectstore to enforce any kind of referental integrity.  However, the (non-ASF) <a href="http://github.com/isisaddons/isis-module-poly">Isis addons' poly</a> module describes and supports a design pattern to address this requirement.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_api_implementation_2">5.3.1. API &amp; Implementation</h4>
<div class="paragraph">
<p>The API defined by <code>BookmarkService</code> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">BookmarkService</span> {
    <span class="annotation">@Programmatic</span>
    <span class="predefined-type">Object</span> lookup(BookmarkHolder bookmarkHolder);
    <span class="annotation">@Programmatic</span>
    <span class="predefined-type">Object</span> lookup(Bookmark bookmark);
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; T lookup(Bookmark bookmark, <span class="predefined-type">Class</span>&lt;T&gt; cls);   <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Programmatic</span>
    Bookmark bookmarkFor(<span class="predefined-type">Object</span> domainObject);
    <span class="annotation">@Programmatic</span>
    Bookmark bookmarkFor(<span class="predefined-type">Class</span>&lt;?&gt; cls, <span class="predefined-type">String</span> identifier);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>same as <code>lookup(Bookmark bookmark)</code>, but downcasts to the specified type.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The core framework provides a default implementation of this API, namely <code>o.a.i.core.metamodel.services.bookmarks.BookmarkServiceDefault</code></p>
</div>
</div>
<div class="sect3">
<h4 id="__code_bookmarkholder_code">5.3.2. <code>BookmarkHolder</code></h4>
<div class="paragraph">
<p>The <code>BookmarkHolder</code> interface is intended to be implemented by domain objects that use a <code>Bookmark</code> to reference a (single) domain object; an example might be a class such as the audit entry, mentioned above.  The interface is simply:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">BookmarkHolder</span> {
    <span class="annotation">@Programmatic</span>
    Bookmark bookmark();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are two services that will contribute to this interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BookmarkHolderActionContributions</code> will provide a <code>lookup(&#8230;&#8203;)</code> action</p>
</li>
<li>
<p><code>BookmarkHolderAssociationContributions</code> provides an <code>object</code> property.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Either of these can be suppressed, if required, using a vetoing subscriber.  For example, to suppress the <code>object</code> property (so that only the <code>lookup(&#8230;&#8203;)</code> action is ever shown for implementations of <code>BookmarkHolder</code>, define:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObject</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AlwaysHideBookmarkHolderAssociationsObjectProperty</span> {
    <span class="annotation">@Subscribe</span>
    <span class="directive">public</span> <span class="type">void</span> on(BookmarkHolderAssociationContributions.ObjectDomainEvent ev) {
        ev.hide();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A more sophisticated implementation could look inside the passed <code>ev</code> argument and selectively hide or not based on the contributee.</p>
</div>
</div>
<div class="sect3">
<h4 id="_usage_by_other_services">5.3.3. Usage by other services</h4>
<div class="paragraph">
<p>Bookmarks are used by the (non-ASF) <a href="http://github.com/isisaddons/isis-module-command">Isis addons' command</a> module&#8217;s implementation of  <a href="#_rg_services-api_manpage-BackgroundCommandService"><code>BackgroundCommandService</code></a>, which uses a bookmark to capture the target object on which an action will be invoked subsequently.</p>
</div>
<div class="paragraph">
<p>Bookmarks are also used by the (non-ASF) <a href="http://github.com/isisaddons/isis-module-publishing">Isis addons' publishing</a> module&#8217;s implementation of <a href="#_rg_services-spi_manpage-PublishingService"><code>PublishingService</code></a>, and by the (non-ASF) <a href="http://github.com/isisaddons/isis-module-auditing">Isis addons' auditing</a> module&#8217;s implementation of <a href="#_rg_services-spi_manpage-AuditingService"><code>AuditingService</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_service_2">5.3.4. Registering the Service</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then Apache Isis' core implementation of <code>BookmarkService</code> is automatically registered (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-api_manpage-ClockService">5.4. <code>ClockService</code></h3>
<div class="paragraph">
<p>Most applications deal with dates and times in one way or another. For example, if an <code>Order</code> is placed, then the <code>Customer</code> may have 30 days to pay the <code>Invoice</code>, otherwise a penalty may be levied.</p>
</div>
<div class="paragraph">
<p>However, such date/time related functionality can quickly complicate automated testing: "today+30" will be a different value every time the test is run.</p>
</div>
<div class="paragraph">
<p>Even disregarding testing, there may be a requirement to ensure that date/times are obtained from an NNTP server (rather than the system PC). While instantiating a <code>java.util.Date</code> to current the current time is painless enough, we would not want complex technical logic for querying an NNTP server spread around domain logic code.</p>
</div>
<div class="paragraph">
<p>Therefore it&#8217;s common to provide a domain service whose responsibility is to provide the current time.  This service can be injected into any domain object (and can be mocked out for unit testing). Apache Isis provides such a facade through the <code>ClockService</code>.</p>
</div>
<div class="sect3">
<h4 id="_api_implementation_3">5.4.1. API &amp; Implementation</h4>
<div class="paragraph">
<p>The API defined by <code>ClockService</code> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature = NatureOfService.DOMAIN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ClockService</span> {
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> LocalDate now() { ... }
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> LocalDateTime nowAsLocalDateTime() { ... }
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> DateTime nowAsDateTime() { ... }
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="predefined-type">Timestamp</span> nowAsJavaSqlTimestamp() { ... }
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="type">long</span> nowAsMillis() { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This class (<code>o.a.i.applib.services.clock.ClockService</code>) is also the default implementation.  The time provided by this default implementation is based on the system clock.</p>
</div>
</div>
<div class="sect3">
<h4 id="_testing_support">5.4.2. Testing Support</h4>
<div class="paragraph">
<p>The default <code>ClockService</code> implementation in fact simply delegates to another class defined in the API, namely the <code>o.a.i.applib.clock.Clock</code>, an abstract singleton class.  It is not recommended that your code use the <code>Clock</code> directly, but you should understand how this all works:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>there are two subclasses implementations <code>Clock</code>, namely <code>SystemClock</code> and <code>FixtureClock</code>.</p>
</li>
<li>
<p>the first implementation that is instantiated registers itself as the singleton.</p>
</li>
<li>
<p>if running in <a href="#_rg_runtime_deployment-types">production</a> (server) mode, then (unless another implementation has beaten it to the punch) the framework will instantiate the <code>`SystemClock</code>.  Once instantiated this cannot be replaced.</p>
</li>
<li>
<p>if running in <a href="#<em>rg_runtime_deployment-types">prototype</a> mode, then the framework will instead instantiate <code>FixtureClock</code>.  This _can</em> be replaced if required.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>FixtureClock</code> will behave as the system clock, unless its is explicitly set using <code>FixtureClock#setDate(&#8230;&#8203;)</code> or <code>FixtureClock#setTime(&#8230;&#8203;)</code> and so forth.</p>
</div>
<div class="sect4">
<h5 id="_alternative_implementations">Alternative Implementations</h5>
<div class="paragraph">
<p>Suppose you want (as discussed in the introduction to this service) to use a clock that delegates to NNTP.  For most domain services this would amount to implementing the appropriate service and registering in <code>isis.properties</code> so that it is used in preference to any implementations provided by default by the framework.</p>
</div>
<div class="paragraph">
<p>In the case of the <code>ClockService</code>, though, this approach (unfortunately) will not work, because parts of Apache Isis (still) delegate to the <code>Clock</code> singleton rather than using the <code>ClockService</code> domain service.</p>
</div>
<div class="paragraph">
<p>The workaround, therefore, is to implement your functionality as a subclass of <code>Clock</code>.  You can write a domain service that will ensure that your implementation is used ahead of any implementations provided by the framework.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature=NatureOfService.DOMAIN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">NntpClockServiceInitializer</span>  {
    <span class="annotation">@Programmatic</span>
    <span class="annotation">@PostConstruct</span>
    <span class="directive">public</span> <span class="type">void</span> postConstruct(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>,<span class="predefined-type">String</span>&gt; properties) {
        <span class="keyword">new</span> NntpClock(properties);                       <i class="conum" data-value="1"></i><b>(1)</b>
    }
    <span class="directive">private</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">NntpClock</span> <span class="directive">extends</span> Clock {
        NntpClock(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>,<span class="predefined-type">String</span>&gt; properties) { ... } <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="directive">protected</span> <span class="type">long</span> time() { ... }                    <i class="conum" data-value="3"></i><b>(3)</b>
            ... NNTP stuff here ...
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>enough to simply instantiate the <code>Clock</code>; it will register itself as singleton</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>connect to NNTP service using configuration properties from <code>isis.properties</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>call to NNTP service here</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_service_3">5.4.3. Registering the Service</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then Apache Isis' core implementation of <code>ClockService</code> is automatically registered (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
<div class="paragraph">
<p>If you want to use a different implementation of <code>Clock</code>, eg delegating to NNTP, then do <em>not</em> register directly, but instead subclass from <code>o.a.i.applib.clock.Clock</code> singleton (as described in the section above).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-api_manpage-CommandContext">5.5. <code>CommandContext</code></h3>
<div class="paragraph">
<p>The <code>CommandContext</code> service is a <a href="#_rg_annotations_manpage-RequestScoped">request-scoped</a> service that reifies the invocation of an action on a domain object into an object itself. This reified information is encapsulated within the <code>Command</code> object.</p>
</div>
<div class="paragraph">
<p>By default, the <code>Command</code> is held in-memory only; once the action invocation has completed, the <code>Command</code> object is gone. The optional
 supporting <a href="#_rg_services-spi_manpage-CommandService"><code>CommandService</code></a> enables the implementation of <code>Command</code> to be pluggable. With an appropriate implementation (eg as provided by the (non-ASF) <a href="http://github.com/isisaddons/isis-module-command">Isis addons' command</a> module&#8217;s <a href="#_rg_services-spi_manpage-CommandService"><code>CommandService</code></a>) the <code>Command</code> may then be persisted.</p>
</div>
<div class="paragraph">
<p>Persistent <code>Command</code>s support several use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>they enable profiling of the running application (which actions are invoked then most often, what is their response time)</p>
</li>
<li>
<p>they act as a parent to any background commands that might be invoked through the <a href="#_rg_services-api_manpage-BackgroundService"><code>BackgroundService</code></a></p>
</li>
<li>
<p>if <a href="#_rg_services-spi_manpage-AuditingService"><code>AuditingService</code></a> is configured, they provide better audit information, since the <code>Command</code> (the 'cause' of an action) can be correlated to the audit records (the "effect" of the action) through the unique <code>transactionId</code> GUID</p>
</li>
<li>
<p>if <a href="#_rg_services-spi_manpage-PublishingService"><code>PublishingService</code></a> is configured, they provide better traceability as the <code>Command</code> is also correlated with any published events, again through the unique <code>transactionId</code> GUID</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Assuming that the <code>CommandService</code> supports persistent <code>Command`s, the associated <a href="#_rg_annotations_manpage-Action_command"></code>@Action#command()<code></a> annotation also allows action invocations to be performed in the background. In this case the act of invoking the action on an object instead returns the `Command</code> to the user.</p>
</div>
<div class="sect3">
<h4 id="_rg_services-api_manpage-CommandContext_screencast">5.5.1. Screencast</h4>
<div class="paragraph">
<p>The screencast provides a run-through of the command (profiling) service, auditing service, publishing service. It also shows how commands can be run in the background either explicitly by scheduling through the background service or implicitly by way of a framework annotation.</p>
</div>
<div class="videoblock">
<div class="content">
<iframe width="640px" height="360px" src="//www.youtube.com/embed/tqXUZkPB3EI?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that this screencast shows an earlier version of the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> UI (specifically, pre 1.8.0).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_api_implementation_4">5.5.2. API &amp; Implementation</h4>
<div class="paragraph">
<p>The <code>CommandContext</code> request-scoped service defines the following very simple API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequestScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CommandContext</span> {
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> Command getCommand() { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This class (<code>o.a.i.applib.services.CommandContext</code>) is also the default implementation.  Under normal circumstances there shouldn&#8217;t be any need to replace this implementation with another.</p>
</div>
<div class="paragraph">
<p>The <code>Command</code> type referenced above is in fact an interface, defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Command</span> <span class="directive">extends</span> HasTransactionId {

    <span class="directive">public</span> <span class="directive">abstract</span> <span class="predefined-type">String</span> getUser();               <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="directive">abstract</span> <span class="predefined-type">Timestamp</span> getTimestamp();       <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="directive">public</span> <span class="directive">abstract</span> Bookmark getTarget();           <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="directive">public</span> <span class="directive">abstract</span> <span class="predefined-type">String</span> getMemberIdentifier();   <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="directive">public</span> <span class="directive">abstract</span> <span class="predefined-type">String</span> getTargetClass();        <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="directive">public</span> <span class="directive">abstract</span> <span class="predefined-type">String</span> getTargetAction();       <i class="conum" data-value="6"></i><b>(6)</b>
    <span class="directive">public</span> <span class="predefined-type">String</span> getArguments();                   <i class="conum" data-value="7"></i><b>(7)</b>
    <span class="directive">public</span> <span class="predefined-type">String</span> getMemento();                     <i class="conum" data-value="8"></i><b>(8)</b>

    <span class="directive">public</span> ExecuteIn getExecuteIn();                <i class="conum" data-value="9"></i><b>(9)</b>
    <span class="directive">public</span> <span class="predefined-type">Executor</span> getExecutor();                  <i class="conum" data-value="10"></i><b>(10)</b>
    <span class="directive">public</span> Persistence getPersistence();            <i class="conum" data-value="11"></i><b>(11)</b>
    <span class="directive">public</span> <span class="type">boolean</span> isPersistHint();                 <i class="conum" data-value="12"></i><b>(12)</b>

    <span class="directive">public</span> <span class="directive">abstract</span> <span class="predefined-type">Timestamp</span> getStartedAt();       <i class="conum" data-value="13"></i><b>(13)</b>
    <span class="directive">public</span> <span class="directive">abstract</span> <span class="predefined-type">Timestamp</span> getCompletedAt();     <i class="conum" data-value="14"></i><b>(14)</b>
    <span class="directive">public</span> Command getParent();                     <i class="conum" data-value="15"></i><b>(15)</b>

    <span class="directive">public</span> Bookmark getResult();                    <i class="conum" data-value="16"></i><b>(16)</b>
    <span class="directive">public</span> <span class="predefined-type">String</span> getException();                   <i class="conum" data-value="17"></i><b>(17)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>getUser()</code> - is the user that initiated the action.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>getTimestamp()</code> - the date/time at which this action was created.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>getTarget()</code> - bookmark of the target object (entity or service) on which this action was performed</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>getMemberIdentifier()</code> - holds a string representation of the invoked action</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>getTargetClass()</code> - a human-friendly description of the class of the target object</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>getTargetAction()</code> - a human-friendly name of the action invoked on the target object</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td><code>getArguments()</code> - a human-friendly description of the arguments with which the action was invoked</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td><code>getMemento()</code> - a formal (XML or similar) specification of the action to invoke/being invoked</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td><code>getExecuteIn()</code> - whether this command is executed in the foreground or background</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td><code>getExecutor()</code> - the (current) executor of this command, either user, or background service, or other (eg redirect after post).</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td><code>getPersistence()</code>- the policy controlling whether this command should ultimately be persisted (either "persisted", "if hinted", or "not persisted")</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td><code>isPersistHint()</code> - whether that the command should be persisted, if persistence policy is "if hinted".</td>
</tr>
<tr>
<td><i class="conum" data-value="13"></i><b>13</b></td>
<td><code>getStartedAt()</code> - the date/time at which this action started (same as <code>timestamp</code> property for foreground commands)</td>
</tr>
<tr>
<td><i class="conum" data-value="14"></i><b>14</b></td>
<td><code>getCompletedAt()</code> - the date/time at which this action completed.</td>
</tr>
<tr>
<td><i class="conum" data-value="15"></i><b>15</b></td>
<td><code>getParent()</code> - for actions created through the <code>BackgroundService</code>, captures the parent action</td>
</tr>
<tr>
<td><i class="conum" data-value="16"></i><b>16</b></td>
<td><code>getResult()</code> - bookmark to object returned by action, if any</td>
</tr>
<tr>
<td><i class="conum" data-value="17"></i><b>17</b></td>
<td><code>getException()</code> - exception stack trace if action threw exception</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_usage_3">5.5.3. Usage</h4>
<div class="paragraph">
<p>The typical way to indicate that an action should be treated as a command is to annotate it with the <a href="#_rg_annotations_manpage-Action_command"><code>@Action#command()</code></a> annotation.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> ... {
    <span class="annotation">@Action</span>(command=CommandReification.ENABLED)
    <span class="directive">public</span> ToDoItem completed() { ... }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As an alternative to annotating every action with <code>@Action#command()</code>, alternatively this can be configured as the default using <code>isis.services.command.actions</code> configuration property.</p>
</div>
<div class="paragraph">
<p>See <a href="#_rg_annotations_manpage-Action_command"><code>@Action#command()</code></a> and <a href="#_rg_runtime_configuring-core">runtime configuration</a> for further details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="#_rg_annotations_manpage-Action_command"><code>@Action#command()</code></a> annotation can also be used to specify whether the command should be performed in the background, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> ... {
    <span class="annotation">@Command</span>(executeIn=ExecuteIn.BACKGROUND)
    <span class="directive">public</span> ToDoItem scheduleImplicitly() {
        completeSlowly(<span class="integer">3000</span>);
        <span class="keyword">return</span> <span class="local-variable">this</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a background command is invoked, the user is returned the command object itself (to provide a handle to the command being invoked).</p>
</div>
<div class="paragraph">
<p>This requires that an implementation of <a href="#_rg_services-spi_manpage-CommandService"><code>CommandService</code></a> that persists the commands (such as the (non-ASF) <a href="http://github.com/isisaddons/isis-module-command">Isis addons' command</a> module&#8217;s <code>CommandService</code>) is configured. It also requires that a scheduler is configured to execute the background commands, see <a href="#_rg_services-spi_manpage-BackgroundCommandService"><code>BackgroundCommandService</code></a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_interacting_with_the_services">5.5.4. Interacting with the services</h4>
<div class="paragraph">
<p>Typically the domain objects have little need to interact with the <code>CommandContext</code> and <code>Command</code> directly; what is more useful is that these are persisted in support of the various use cases identified above.</p>
</div>
<div class="paragraph">
<p>One case however where a domain object might want to obtain the <code>Command</code> is to determine whether it has been invoked in the foreground, or in the background. It can do this using the <code>getExecutedIn()</code> method:</p>
</div>
<div class="paragraph">
<p>Although not often needed, this then allows the domain object to access the <code>Command</code> object through the <code>CommandContext</code> service.  To expand th above example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> ... {
    <span class="annotation">@Action</span>(
        command=CommandReification.ENABLED,
        commandExecuteIn=CommandExecuteIn.BACKGROUND
    )
    <span class="directive">public</span> ToDoItem completed() {
        ...
        Command currentCommand = commandContext.getCommand();
        ...
    }
    <span class="annotation">@Inject</span>
    CommandContext commandContext;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If run in the background, it might then notify the user (eg by email) if all work is done.</p>
</div>
<div class="paragraph">
<p>This leads us onto a related point, distinguishing the current effective user vs the originating "real" user. When running in the foreground, the current user can be obtained from the <code>DomainObjectContainer</code>, using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> user = container.getUser().getName();</code></pre>
</div>
</div>
<div class="paragraph">
<p>If running in the background, however, then the current user will be the credentials of the background process, for example as run by a Quartz scheduler job.</p>
</div>
<div class="paragraph">
<p>The domain object can still obtain the original ("effective") user that caused the job to be created, using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> user = commandContext.getCommand().getUser();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_services_2">5.5.5. Registering the Services</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then Apache Isis' core implementation of <code>CommandContext</code> service is automatically registered and injected (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_2">5.5.6. Related Services</h4>
<div class="paragraph">
<p>As discussed above, the supporting <a href="#_rg_services-spi_manpage-CommandService"><code>CommandService</code></a> enables <code>Command</code> objects to be persisted. Other related services are the <a href="#_rg_services-api_manpage-BackgroundService"><code>BackgroundService</code></a> and <a href="#_rg_services-spi_manpage-BackgroundCommandService"><code>BackgroundCommandService</code></a>). For <code>BackgroundService</code> captures commands for execution in the background, while the [BackgroundCommandService] persists such commands for execution.</p>
</div>
<div class="paragraph">
<p>The implementations of <code>CommandService</code> and <code>BackgroundCommandService</code> are intended to go together, so that persistent parent `Command`s can be associated with their child background `Command`s.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-api_manpage-DeepLinkService">5.6. <code>DeepLinkService</code></h3>
<div class="paragraph">
<p>The <code>DeepLinkService</code> provides the ability to obtain a <code>java.net.URI</code> that links to a representation of any (persisted) domain entity or
view model.</p>
</div>
<div class="paragraph">
<p>A typical use case is to generate a clickable link for rendering in an email, PDF, tweet or other communication.</p>
</div>
<div class="sect3">
<h4 id="_api_implementation_5">5.6.1. API &amp; Implementation</h4>
<div class="paragraph">
<p>The API defined by <code>DeepLinkService</code> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">DeepLinkService</span> {
    <span class="predefined-type">URI</span> deepLinkFor(<span class="predefined-type">Object</span> domainObject); <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creates a URI that can be used to obtain a representation of the provided domain object in one of the Apache Isis viewers.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> this provides an implementation for accessing the representation through this viewer.  (For the <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a>, a URL can be constructed according to the <a href="http://www.restfulobjects.org">Restful Objects spec</a> in conjunction with a <code>Bookmark</code> obtained via the <a href="#_rg_services-api_manpage-BookmarkService"><code>BookmarkService</code></a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_usage_within_the_framework">5.6.2. Usage within the framework</h4>
<div class="paragraph">
<p>The <a href="#_rg_services-spi_manpage-EmailNotificationService"><code>EmailNotificationService</code></a> uses this service in order to generate emails as part of <a href="ug.html#_ug_wicket-viewer_features_user-registration">user registration</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementations">5.6.3. Implementations</h4>
<div class="paragraph">
<p>The Wicket viewer core framework provides a default implementation of this API:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.apache.isis.viewer.wicket.viewer.services.DeepLinkServiceWicket</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_services_3">5.6.4. Registering the Services</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>and that the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> is being used then an implementation of <code>DeepLinkService</code> is automatically registered and injected (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-api_manpage-DomainObjectContainer">5.7. <code>DomainObjectContainer</code></h3>
<div class="paragraph">
<p>The <code>DomainObjectContainer</code> service provides a set of general purpose functionality for domain objects to call.  Principal amongst these are a generic APIs for querying objects and creating and persisting objects.  In addition, the service provides access to security context (the "current user"), allows information and warning messages to be raised, and various other miscellaneous functions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Compared to other services provided by Apache Isis, the <code>DomainObjectContainer</code> provides by far the most number of methods, addressing several quite distinct responsibilities.  This is a historical accident: in early versions of Apache Isis the <code>DomainObjectContainer</code> was the one and only domain service provided by the framework.</p>
</div>
<div class="paragraph">
<p>In the future we may deprecate this service and break out its responsibilities into a number of small services.  However, given how important this service was in days past, we are unlikely to delete it as a service even once it has been deprecated.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The sections below discuss the functions provided by the service, broken out into categories.</p>
</div>
<div class="sect3">
<h4 id="_rg_services-api_manpage-DomainObjectContainer_object-creation-api">5.7.1. Object Creation API</h4>
<div class="paragraph">
<p>The object creation APIs are used to instantiate new domain objects or view models.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">DomainObjectContainer</span> {
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; T newTransientInstance(<span class="directive">final</span> <span class="predefined-type">Class</span>&lt;T&gt; ofType);                              <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; T newViewModelInstance(<span class="directive">final</span> <span class="predefined-type">Class</span>&lt;T&gt; ofType, <span class="directive">final</span> <span class="predefined-type">String</span> memento);        <i class="conum" data-value="2"></i><b>(2)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a new non-persisted domain entity.  Any services will be automatically injected into the service</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>create a new view model, with the specified memento (as per <a href="#_rg_classes_super_manpage-AbstractViewModel">ViewModel#viewModelMemento()</a>.  In general it is easier to just annotate with <a href="#_rg_annotations_manpage-ViewModel"><code>@ViewModel</code></a> and let Apache Isis manage the memento automatically.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Customer cust = container.newTransientInstance(Customer.class);
cust.setFirstName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Freddie</span><span class="delimiter">&quot;</span></span>);
cust.setLastName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Mercury</span><span class="delimiter">&quot;</span></span>);
container.persist(cust);</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an alternative to using <code>newTransientInstance(&#8230;&#8203;)</code>, you could also simply <code>new()</code> up the object.  Doing this will not inject any domain services, but they can be injected manually using <a href="#_rg_services-api_manpage-DomainObjectContainer_services-api">#injectServicesInto(&#8230;&#8203;)`</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Calling <code>new(&#8230;&#8203;)</code> also this circumvents Apache Isis' <a href="#_rg_methods_reserved_manpage-created"><code>created()</code></a> callback, and in addition any default values for properties (either explicitly set by <a href="#_rg_methods_prefixes_manpage-default"><code>default&#8230;&#8203;()</code></a> or defaulted implicitly according to Apache Isis' own conventions) will not be called either.  If you don&#8217;t intend to use these features, though, the net effect is code that has less coupling to Isis and is arguably easier to understand (has "less magic" happening).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_services-api_manpage-DomainObjectContainer_generic-repository-api">5.7.2. Generic Repository API</h4>
<div class="paragraph">
<p>The repository API acts as an abstraction over the JDO/DataNucleus objectstore.  You can use it during prototyping to write naive queries (find all rows, then filter using the Guava <code>Predicate</code> API, or you can use it to call JDO <a href="http://www.datanucleus.org/products/accessplatform_4_0/jdo/query.html#named">named queries</a> using JDOQL.</p>
</div>
<div class="paragraph">
<p>As an alternative, you could also use <a href="http://www.datanucleus.org/products/accessplatform_4_0/jdo/jdoql_typesafe.html">JDO typesafe queries</a> through the <a href="#_rg_services-api_manpage-IsisJdoSupport"><code>IsisJdoSupport</code></a> service.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">DomainObjectContainer</span> {
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> &lt;T&gt; <span class="predefined-type">List</span>&lt;T&gt; allInstances(<span class="predefined-type">Class</span>&lt;T&gt; ofType, <span class="type">long</span>... range);                        <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; <span class="predefined-type">List</span>&lt;T&gt; allMatches(<span class="predefined-type">Query</span>&lt;T&gt; query);                                                 <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; <span class="predefined-type">List</span>&lt;T&gt; allMatches(<span class="predefined-type">Class</span>&lt;T&gt; ofType, <span class="predefined-type">Predicate</span>&lt;? <span class="local-variable">super</span> T&gt; predicate, <span class="type">long</span>... range); <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; <span class="predefined-type">List</span>&lt;T&gt; allMatches(<span class="predefined-type">Class</span>&lt;T&gt; ofType, <span class="predefined-type">String</span> title, <span class="type">long</span>... range);                   <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; <span class="predefined-type">List</span>&lt;T&gt; allMatches(<span class="predefined-type">Class</span>&lt;T&gt; ofType, T pattern, <span class="type">long</span>... range);                      <i class="conum" data-value="5"></i><b>(5)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>all persisted instances of specified type.  Mostly for prototyping, though can be useful to obtain all instances of domain entities if the number is known to be small.  The optional varargs parameters are for paging control; more on this below.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>all persistence instances matching the specified <code>Query</code>.  Query itself is an Isis abstraction on top of JDO/DataNucleus' Query API.  <strong>This is the primary API used for querying</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>all persistenced instances of specified type matching <code>Predicate</code>.  Only really intended for prototyping because in effect constitutes a client-side WHERE clause</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>all persisted instances with the specified string as their title.  Only very occasionally used</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>all persisted instances matching object (query-by-example).  Only very occasionally used</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are various implementations of the <code>Query</code> API, but these either duplicate functionality of the other overloads of <code>allMatches(&#8230;&#8203;)</code> or they are not supported by the JDO/DataNucleus object store.   The only significant implementation of <code>Query</code> to be aware of is <code>QueryDefault</code>, which identifies a named query and a set of parameter/argument tuples.</p>
</div>
<div class="paragraph">
<p>For example, in the (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a> the <code>ToDoItem</code> is annotated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Queries( {
    <span class="annotation">@javax</span>.jdo.annotations.Query(
            name = <span class="string"><span class="delimiter">&quot;</span><span class="content">findByAtPathAndComplete</span><span class="delimiter">&quot;</span></span>, language = <span class="string"><span class="delimiter">&quot;</span><span class="content">JDOQL</span><span class="delimiter">&quot;</span></span>,               <i class="conum" data-value="1"></i><b>(1)</b>
            value = <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT </span><span class="delimiter">&quot;</span></span>
                    + <span class="string"><span class="delimiter">&quot;</span><span class="content">FROM todoapp.dom.module.todoitem.ToDoItem </span><span class="delimiter">&quot;</span></span>
                    + <span class="string"><span class="delimiter">&quot;</span><span class="content">WHERE atPath.indexOf(:atPath) == 0 </span><span class="delimiter">&quot;</span></span>                     <i class="conum" data-value="2"></i><b>(2)</b>
                    + <span class="string"><span class="delimiter">&quot;</span><span class="content">   &amp;&amp; complete == :complete</span><span class="delimiter">&quot;</span></span>),                           <i class="conum" data-value="3"></i><b>(3)</b>
    ...
})
<span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> ... {
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>name of the query</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>defines the <code>atPath</code> parameter</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>defines the <code>complete</code> parameter</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This JDO query definitions are used in the <code>ToDoItemRepositoryImplUsingJdoql</code> service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature = NatureOfService.DOMAIN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItemRepositoryImplUsingJdoql</span> <span class="directive">implements</span> ToDoItemRepositoryImpl {
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;ToDoItem&gt; findByAtPathAndCategory(<span class="directive">final</span> <span class="predefined-type">String</span> atPath, <span class="directive">final</span> Category category) {
        <span class="keyword">return</span> container.allMatches(
                <span class="keyword">new</span> QueryDefault&lt;&gt;(ToDoItem.class,
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">findByAtPathAndCategory</span><span class="delimiter">&quot;</span></span>,                              <i class="conum" data-value="1"></i><b>(1)</b>
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">atPath</span><span class="delimiter">&quot;</span></span>, atPath,                                       <i class="conum" data-value="2"></i><b>(2)</b>
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">category</span><span class="delimiter">&quot;</span></span>, category));                                 <i class="conum" data-value="3"></i><b>(3)</b>
    }
    ...
    <span class="annotation">@javax</span>.inject.Inject
    DomainObjectContainer container;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>corresponds to the "findByAtPathAndCategory" JDO named query</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>provide argument for the <code>atPath</code> parameter.  The pattern is parameter, argument, parameter, argument, &#8230;&#8203; and so on.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>provide argument for the <code>category</code> parameter.  The pattern is parameter, argument, parameter, argument, &#8230;&#8203; and so on.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Other JDOQL named queries (not shown) follow the exact same pattern.</p>
</div>
<div class="paragraph">
<p>With respect to the other query APIs, the varargs parameters are optional, but allow for (client-side and managed) paging.  The first parameter is the <code>start</code> (0-based, the second is the <code>count</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is also possible to query using DataNucleus' type-safe query API.  For more details, see <a href="#_rg_services-api_manpage-IsisJdoSupport"><code>IsisJdoSupport</code></a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_services-api_manpage-DomainObjectContainer_object-persistence-api">5.7.3. Object Persistence API</h4>
<div class="paragraph">
<p>The persistence API is used to persist newly created objects (as per <a href="#_rg_services-api_manpage-DomainObjectContainer_object-creation-api"><code>#newTransientInstance(&#8230;&#8203;)</code></a>, above and to delete (remove) objects that are persistent.</p>
</div>
<div class="paragraph">
<p>Note that there is no API for updating existing objects; the framework (or rather, JDO/DataNucleus) performs object dirty tracking and so any objects that are modified in the course of a request will be automatically updated).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">DomainObjectContainer</span> {
    <span class="annotation">@Programmatic</span>
    <span class="type">boolean</span> isPersistent(<span class="predefined-type">Object</span> domainObject);          <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Programmatic</span>
    <span class="type">boolean</span> isViewModel(<span class="predefined-type">Object</span> domainObject);           <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="annotation">@Programmatic</span>
    <span class="type">void</span> persist(<span class="predefined-type">Object</span> domainObject);                  <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="annotation">@Programmatic</span>
    <span class="type">void</span> persistIfNotAlready(<span class="predefined-type">Object</span> domainObject);      <i class="conum" data-value="4"></i><b>(4)</b>

    <span class="annotation">@Programmatic</span>
    <span class="type">void</span> remove(<span class="predefined-type">Object</span> persistentDomainObject);         <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="annotation">@Programmatic</span>
    <span class="type">void</span> removeIfNotAlready(<span class="predefined-type">Object</span> domainObject);       <i class="conum" data-value="6"></i><b>(6)</b>

    <span class="annotation">@Programmatic</span>
    <span class="type">boolean</span> flush();                                    <i class="conum" data-value="7"></i><b>(7)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>test whether a particular domain object is persistent or not</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>test whether a particular domain object is a view model or not.  Note that this includes any domain objects annotated with <a href="#_rg_annotations_manpage-DomainObject_nature"><code>@DomainObject#nature=Nature.EXTERNAL_ENTITY)</code></a> or <a href="#_rg_annotations_manpage-DomainObject_nature"><code>@DomainObject#nature=Nature.INMEMORY_ENTITY</code></a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>persist a transient object.  Note though that this will throw an exception if the object is already persistent; this can happen if JDO/DataNucleus&#8217;s <a href="http://www.datanucleus.org/products/accessplatform_4_0/jdo/orm/cascading.html">persistence-by-reachability</a> is in effect.  For this reason it is generally better to use:</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>persist an object but only if know to not have been persistent.  But if the object is persistent, is a no-op</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>remove (ie DELETE) a persistent object.  For similar reasons to the persistence, it is generally better to use:</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>remove (ie DELETE) an object only if known to be persistent.  But if the object has already been deleted, then is a no-op.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>flushes all pending changes to the objectstore.  Explained further below.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Customer cust = container.newTransientInstance(Customer.class);
cust.setFirstName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Freddie</span><span class="delimiter">&quot;</span></span>);
cust.setLastName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Mercury</span><span class="delimiter">&quot;</span></span>);
container.persistIfNotAlready(cust);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should be aware that by default Apache Isis queues up calls to <code>#persist()</code> and <code>#remove()</code>.  These are then executed either when the request completes (and the transaction commits), or if the queue is flushed.  This can be done either implicitly by the framework, or as the result of a direct call to <code>#flush()</code>.</p>
</div>
<div class="paragraph">
<p>By default the framework itself will cause <code>#flush()</code> to be called whenever a query is executed by way of <code>#allMatches(Query)</code>, as documented <a href="#_rg_services-api_manpage-DomainObjectContainer_generic-repository-api">above</a>.  However, this behaviour can be disabled using the  <a href="#_rg_runtime_configuring-core">configuration property</a> <code>isis.services.container.disableAutoFlush</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_services-api_manpage-DomainObjectContainer_messages-api">5.7.4. Messages API</h4>
<div class="paragraph">
<p>The <code>DomainObjectContainer</code> allows domain objects to raise information, warning or error messages.  These messages can either be simple strings, or can be translated.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">DomainObjectContainer</span> {
    <span class="annotation">@Programmatic</span>
    <span class="type">void</span> informUser(<span class="predefined-type">String</span> message);                                                            <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Programmatic</span>
    <span class="predefined-type">String</span> informUser(TranslatableString message, <span class="predefined-type">Class</span>&lt;?&gt; contextClass, <span class="predefined-type">String</span> contextMethod); <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="annotation">@Programmatic</span>
    <span class="type">void</span> warnUser(<span class="predefined-type">String</span> message);                                                              <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="annotation">@Programmatic</span>
    <span class="predefined-type">String</span> warnUser(TranslatableString message, <span class="predefined-type">Class</span>&lt;?&gt; contextClass, <span class="predefined-type">String</span> contextMethod);   <i class="conum" data-value="4"></i><b>(4)</b>

    <span class="annotation">@Programmatic</span>
    <span class="type">void</span> raiseError(<span class="predefined-type">String</span> message);                                                            <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="annotation">@Programmatic</span>
    <span class="predefined-type">String</span> raiseError(TranslatableString message, <span class="predefined-type">Class</span>&lt;?&gt; contextClass, <span class="predefined-type">String</span> contextMethod); <i class="conum" data-value="6"></i><b>(6)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>display as a transient message to the user (not requiring acknowledgement).  In the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> this is implemented as a toast that automatically disappears after a period of time.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>ditto, but with translatable string, for <a href="ug.html#_ug_more-advanced_i18n">i18n support</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>warn the user about a situation with the specified message.  In the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> this is implemented as a toast that must be closed by the end-user.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>ditto, but with translatable string, for i18n support.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>show the user an unexpected application error.  In the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> this is implemented as a toast (with a different colour) that must be closed by the end-user.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>ditto, but with translatable string, for i18n support.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> Order addItem(Product product, <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Quantity) int quantity) {
    if(productRepository.stockLevel(product) == 0) {
        container.warnUser(
            product.getDescription() + </span><span class="delimiter">&quot;</span></span> out of stock; order fulfillment may be delayed<span class="string"><span class="delimiter">&quot;</span><span class="content">);
    }
    ...
}</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_services-api_manpage-DomainObjectContainer_security-api">5.7.5. Security API</h4>
<div class="paragraph">
<p>The security API allows the domain object to obtain the identity of the user interacting with said object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">DomainObjectContainer</span> {
    <span class="annotation">@Programmatic</span>
    UserMemento getUser();
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where in turn (the essence of) <code>UserMemento</code> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">UserMemento</span> {
    <span class="directive">public</span> <span class="predefined-type">String</span> getName() { ... }
    <span class="directive">public</span> <span class="type">boolean</span> isCurrentUser(<span class="directive">final</span> <span class="predefined-type">String</span> userName) { ... }

    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;RoleMemento&gt; getRoles() { ... }
    <span class="directive">public</span> <span class="type">boolean</span> hasRole(<span class="directive">final</span> RoleMemento role) { ... }
    <span class="directive">public</span> <span class="type">boolean</span> hasRole(<span class="directive">final</span> <span class="predefined-type">String</span> roleName) { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and <code>RoleMemento</code> is simpler still:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">RoleMemento</span> {
    <span class="directive">public</span> <span class="predefined-type">String</span> getName() { ... }
    <span class="directive">public</span> <span class="predefined-type">String</span> getDescription() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The roles associated with the <code>UserMemento</code> will be based on the configured <a href="ug.html#_ug_security">security</a> (typically Shiro).</p>
</div>
<div class="paragraph">
<p>In addition, when using the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> there will be an additional "org.apache.isis.viewer.wicket.roles.USER" role; this is used internally to restrict access to web pages without authenticating.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_services-api_manpage-DomainObjectContainer_presentation-api">5.7.6. Presentation API</h4>
<div class="paragraph">
<p>A responsibility of every domain object is to return a title.  This can be done declaratively using the <a href="#_rg_annotations_manpage-Title"><code>@Title</code></a> annotation on property/ies, or it can be done imperatively by writing a <a href="#_rg_methods_reserved_manpage-title"><code>title()</code></a> method.</p>
</div>
<div class="paragraph">
<p>It&#8217;s quite common for titles to be built up of the titles of other objects.  If using building up the title using <code>@Title</code> then Apache Isis will automatically use the title of the objects referenced by the annotated properties.  We also need programmatic access to these titles if going the imperative route.</p>
</div>
<div class="paragraph">
<p>Similarly, it often makes sense if <a href="#_rg_services-api_manpage-DomainObjectContainer_messages-api">raising messages</a> to use the title of an object in a message rather (than a some other property of the object), because this is how end-users will be used to identifying the object.</p>
</div>
<div class="paragraph">
<p>The API defined by <code>DomainObjectContainer</code> is simply:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">DomainObjectContainer</span> {
    <span class="annotation">@Programmatic</span>
    <span class="predefined-type">String</span> titleOf(<span class="predefined-type">Object</span> domainObject);                <i class="conum" data-value="1"></i><b>(1)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>return the title of the object, as rendered in the UI by the Apache Isis viewers.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By way of example, here&#8217;s some code from the (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a> showing the use of the API in an message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;ToDoItem&gt; delete() {
        <span class="directive">final</span> <span class="predefined-type">String</span> title = container.titleOf(<span class="local-variable">this</span>);   <i class="conum" data-value="1"></i><b>(1)</b>
        ...
        container.removeIfNotAlready(<span class="local-variable">this</span>);
        container.informUser(
                TranslatableString.tr(
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Deleted {title}</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>, title), <i class="conum" data-value="2"></i><b>(2)</b>
                    <span class="local-variable">this</span>.getClass(), <span class="string"><span class="delimiter">&quot;</span><span class="content">delete</span><span class="delimiter">&quot;</span></span>);
        ...
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the title is obtained first, because we&#8217;re not allowed to reference object after it&#8217;s been deleted</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>use the title in an i18n <code>TranslatableString</code></td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_services-api_manpage-DomainObjectContainer_validation-api">5.7.7. Validation API</h4>
<div class="paragraph">
<p>The validation API allows a domain object to programmatically validate itself or any other domain object.  Specifically, this means the validating the current state of all properties, as well as any object-level validation defined by <a href="#_rg_methods_reserved_manpage-validate"><code>validate()</code></a>.</p>
</div>
<div class="paragraph">
<p>The API provided is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">DomainObjectContainer</span> {
    <span class="annotation">@Programmatic</span>
    <span class="type">boolean</span> isValid(<span class="predefined-type">Object</span> domainObject);
    <span class="annotation">@Programmatic</span>
    <span class="predefined-type">String</span> validate(<span class="predefined-type">Object</span> domainObject);
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If an object is changed by editing its properties, then (using the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> at least) Apache Isis will check that the state of the object is valid.  There is currently however no equivalent guarantee for actions.</p>
</div>
<div class="paragraph">
<p>The intent of this API was (originally at least) to provide a fallback whereby actions could at least be able to perform this validation programmatically (eg in their own <a href="#_rg_methods_prefixes_manpage-validate"><code>validate&#8230;&#8203;()</code></a> or <a href="#_rg_methods_prefixes_manpage-disable"><code>disable&#8230;&#8203;()</code></a> methods.  However, this feature should be considered experimental; your mileage may vary.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_services-api_manpage-DomainObjectContainer_properties-api">5.7.8. Properties API</h4>
<div class="paragraph">
<p>The properties API allows domain objects to read the configuration properties aggregated from the various <a href="#_rg_runtime_configuration-files">configuration files</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">DomainObjectContainer</span> {
    <span class="annotation">@Programmatic</span>
    <span class="predefined-type">String</span> getProperty(<span class="predefined-type">String</span> name);                        <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Programmatic</span>
    <span class="predefined-type">String</span> getProperty(<span class="predefined-type">String</span> name, <span class="predefined-type">String</span> defaultValue);   <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="annotation">@Programmatic</span>
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getPropertyNames();                        <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Return the configuration property with the specified name; else return null.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Return the configuration property with the specified name; if it doesn&#8217;t exist then return the specified default value.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Return the names of all the available properties.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, here&#8217;s a fictitious service that might wrap <a href="http://twitter4j.org/en/configuration.html">Twitter4J</a>. say:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature=NatureOfService.DOMAIN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TweetService</span> {
    <span class="annotation">@Programmatic</span>
    <span class="annotation">@PostConstruct</span>
    <span class="directive">public</span> <span class="type">void</span> init() {
        <span class="local-variable">this</span>.oauthConsumerKey = container.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">tweetservice.oauth.consumerKey</span><span class="delimiter">&quot;</span></span>);
        <span class="local-variable">this</span>.oauthConsumerSecret = container.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">tweetservice.oauth.consumerSecret</span><span class="delimiter">&quot;</span></span>);
        <span class="local-variable">this</span>.oauthAccessToken = container.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">tweetservice.oauth.accessToken</span><span class="delimiter">&quot;</span></span>);
        <span class="local-variable">this</span>.oauthAccessTokenSecret = container.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">tweetservice.oauth.accessTokenSecret</span><span class="delimiter">&quot;</span></span>);
    }
    ...
    <span class="annotation">@Inject</span>
    DomainObjectContainer container;
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you <em>do</em> have a domain service that needs to access properties, then note that an alternative is to define a <a href="#_rg_annotations_manpage-PostConstruct"><code>@PostConstruct</code></a> method and pass in a <code>Map&lt;String,String&gt;</code> of properties.  The two techniques are almost identical; it&#8217;s mostly a matter of taste.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_services-api_manpage-DomainObjectContainer_services-api">5.7.9. Services API</h4>
<div class="paragraph">
<p>The services API allows your domain objects to programmatically inject services into arbitrary objects, as well as to look up services by type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">DomainObjectContainer</span> {
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; T injectServicesInto(<span class="directive">final</span> T domainObject);     <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; T lookupService(<span class="predefined-type">Class</span>&lt;T&gt; service);              <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; <span class="predefined-type">Iterable</span>&lt;T&gt; lookupServices(<span class="predefined-type">Class</span>&lt;T&gt; service);   <i class="conum" data-value="3"></i><b>(3)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>injects services into domain object; used extensively internally by the framework (eg to inject to other services, or to entities, or integration test instances, or fixture scripts).  Service injection is done automatically if objects are created using <code>#newTransientInstance()</code>, described <a href="#_rg_services-api_manpage-DomainObjectContainer_object-creation-api">above</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>returns the first registered service that implements the specified class</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>returns an <code>Iterable</code> in order to iterate over all registered services that implement the specified class</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The primary use case is to instantiate domain objects using a regular constructor ("new is the new new") rather than using the <a href="#_rg_services-api_manpage-DomainObjectContainer_object-creation-api"><code>#newTransientInstance()</code></a> API, and then using the <code>#injectServicesInto(&#8230;&#8203;)</code> API to set up any dependencies.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Customer cust = container.injectServicesInto( <span class="keyword">new</span> Customer());
cust.setFirstName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Freddie</span><span class="delimiter">&quot;</span></span>);
cust.setLastName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Mercury</span><span class="delimiter">&quot;</span></span>);
container.persist(cust);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_service_4">5.7.10. Registering the Service</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then Apache Isis' core implementation of <code>DomainObjectContainer</code> service is automatically registered and injected (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-api_manpage-EmailService">5.8. <code>EmailService</code></h3>
<div class="paragraph">
<p>The <code>EmailService</code> provides the ability to send HTML emails, with attachments, to one or more recipients.</p>
</div>
<div class="paragraph">
<p>Apache Isis provides a default implementation to send emails using an external SMTP provider.  Note that this must be configured (using a number of configuration properties) before it can be used.  The that sends email as an HTML message, using an external SMTP provider.</p>
</div>
<div class="sect3">
<h4 id="_api_implementation_6">5.8.1. API &amp; Implementation</h4>
<div class="paragraph">
<p>The API for the service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">EmailService</span> {
    <span class="annotation">@Programmatic</span>
    <span class="type">boolean</span> send(                                                   <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; to, <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; cc, <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; bcc,         <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="predefined-type">String</span> subject,
        <span class="predefined-type">String</span> body,                                                <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="predefined-type">DataSource</span>... attachments);
    <span class="annotation">@Programmatic</span>
    <span class="type">boolean</span> isConfigured();                                         <i class="conum" data-value="4"></i><b>(4)</b>
  }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>is the main API to send the email (and optional attachments). Will return <code>false</code> if failed to send</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>pass either <code>null</code> or <code>Collections.emptyList()</code> if not required</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>should be HTML text</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>indicates whether the implementation was configured and initialized correctly.  If this returns <code>false</code> then any attempt to call <code>send(&#8230;&#8203;)</code> will fail.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As noted in the introduction, the core framework provides a default implementation (<code>EmailServiceDefault</code>) that sends email as an HTML message, using an external SMTP provider.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration">5.8.2. Configuration</h4>
<div class="paragraph">
<p>To use this service the following properties must be configured:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>isis.service.email.sender.address</code></p>
</li>
<li>
<p><code>isis.service.email.sender.password</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and these properties may optionally be configured (each has a default to use gmail, documented <a href="#_rg_runtime_configuring-core">here</a>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>isis.service.email.sender.hostname</code></p>
</li>
<li>
<p><code>isis.service.email.port</code></p>
</li>
<li>
<p><code>isis.service.email.tls.enabled</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These configuration properties can be specified either in <code>isis.properties</code> or in an <a href="ug.html#_ug_deployment_externalized-configuration">external configuration file</a>.</p>
</div>
<div class="paragraph">
<p>If prototyping (that is, running the app using <code>org.apache.isis.WebServer</code>), the configuration properties can also be specified as system properties. For example, if you create a test email account on gmail, you can configure the service using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">-Disis.service.email.sender.address=xxx@gmail.com -Disis.service.email.sender.password=yyy</code></pre>
</div>
</div>
<div class="paragraph">
<p>where "xxx" is the gmail user account and "yyy" is its password</p>
</div>
</div>
<div class="sect3">
<h4 id="_alternative_implementations_2">5.8.3. Alternative Implementations</h4>
<div class="paragraph">
<p>If you wish to write an alternative implementation, be aware that it should process the message body as HTML (as opposed to plain text or any other format).</p>
</div>
<div class="paragraph">
<p>Also, note that (unlike most Apache Isis domain services) the implementation is also instantiated and injected by Google Guice. This is because <code>EmailService</code> is used as part of the <a href="ug.html#_ug_wicket-viewer_features_user-registration">user registration</a> functionality and is used by Wicket pages that are accessed outside of the usual Apache Isis runtime. This implies a couple of additional constraints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>first, implementation class should also be annotated with <code>@com.google.inject.Singleton</code></p>
</li>
<li>
<p>second, there may not be any Apache Isis session running. (If necessary, one can be created on the fly using <code>IsisContext.doInSession(&#8230;&#8203;)</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To ensure that your alternative implementation takes the place of the default implementation, register it explicitly in <code>isis.properties</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_services_4">5.8.4. Registering the Services</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then Apache Isis' core implementation of <code>EmailService</code> service is automatically registered and injected (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
<div class="paragraph">
<p>If you have written an alternative implementation, then register your implementation in <code>isis.properties</code> under the "isis.services" key and it will be used instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_3">5.8.5. Related Services</h4>
<div class="paragraph">
<p>The email service is used by the <a href="#_rg_services-spi_manpage-EmailNotificationService"><code>EmailNotificationService</code></a> which is, in turn, used by <a href="#_rg_services-spi_manpage-UserRegistrationService"><code>UserRegistrationService</code></a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-api_manpage-EventBusService">5.9. <code>EventBusService</code></h3>
<div class="paragraph">
<p>The <code>EventBusService</code> allows domain objects to emit events to subscribing domain services using an in-memory event bus.</p>
</div>
<div class="paragraph">
<p>The primary user of the service is the framework itself, which automatically emit events for <a href="#_rg_annotations_manpage-Action_domainEvent">actions</a>, <a href="#_rg_annotations_manpage-Property_domainEvent">properties</a> and <a href="#_rg_annotations_manpage-Collection_domainEvent">collections</a>.  Multiple events are generated:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>when an object member is to be viewed, an event is fired; subscribers can veto (meaning that the member is hidden)</p>
</li>
<li>
<p>when an object member is to be enabled, the same event instance is fired; subscribers can veto (meaning that the member is disabled, ie cannot be edited/invoked)</p>
</li>
<li>
<p>when an object member is being validated, then a new event instance is fired; subscribers can veto (meaning that the candidate values/action arguments are rejected)</p>
</li>
<li>
<p>when an object member is about to be changed, then the same event instance is fired; subscribers can perform pre-execution operations</p>
</li>
<li>
<p>when an object member has been changed, then the same event instance is fired; subscribers can perform post-execution operations</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a subscriber throws an exception in the first three steps, then the interaction is vetoed. If a subscriber throws an exception in the last two steps, then the transaction is aborted.  For more on this topic, see <a href="#_rg_annotations_manpage-Action_domainEvent"><code>@Action#domainEvent()</code></a>, <a href="#_rg_annotations_manpage-Property_domainEvent"><code>@Property#domainEvent()</code></a> and <a href="#_rg_annotations_manpage-Collection_domainEvent"><code>@Collection#domainEvent()</code></a>.</p>
</div>
<div class="paragraph">
<p>It is also possible for domain objects to programmatically generate domain events.  However the events are published, the primary use case is to decoupling interactions from one module/package/namespace and another.</p>
</div>
<div class="paragraph">
<p>Two implementations are available, using either <a href="https://code.google.com/p/guava-libraries/">Guava</a>'s <a href="https://code.google.com/p/guava-libraries/wiki/EventBusExplained"><code>EventBus</code></a>, or alternatively using the <a href="http://www.axonframework.org/">AxonFramework</a>'s <a href="http://www.axonframework.org/docs/2.4/single.html#d5e1489">SimpleEventBus</a>.  It is also possible to plug in a custom implementation.</p>
</div>
<div class="sect3">
<h4 id="_rg_services-api_manpage-EventBusService_api-and-implementation">5.9.1. API &amp; Implementation</h4>
<div class="paragraph">
<p>The API defined by <code>EventBusService</code> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">EventBusService</span> {
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="type">void</span> post(<span class="predefined-type">Object</span> event) { ... }                          <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="type">void</span> register(<span class="directive">final</span> <span class="predefined-type">Object</span> domainService) { ... }        <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="type">void</span> unregister(<span class="directive">final</span> <span class="predefined-type">Object</span> domainService) { ... }      <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>posts the event onto event bus</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>allows domain services to register themselves.  This should be done in their <a href="#_rg_annotations_manpage-PostConstruct"><code>@PostConstruct</code></a> initialization method (for both singleton and <a href="#_rg_annotations_manpage-RequestScoped"><code>@RequestScoped</code></a> domain services.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>exists for symmetry, but need never be called (it is in fact deliberately a no-op).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Isis provides a default implementation of the service, <code>o.a.i.objectstore.jdo.datanucleus.service.eventbus.EventBusServiceJdo</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_subscribers">5.9.2. Registering Subscribers</h4>
<div class="paragraph">
<p>The <code>register()</code> method should be called in the <a href="#_rg_annotations_manpage-PostConstruct"><code>@PostConstruct</code></a> lifecycle method.  It is valid and probably the least confusing to readers to also "unregister" in the <a href="#_rg_annotations_manpage-PreDestroy"><code>@PreDestroy</code></a> lifecycle method (though as noted <a href="#_rg_services-api_manpage-EventBusService_api-and-implementation">above</a>, unregistering is actually a no-op).</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature=NatureOfService.DOMAIN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MySubscribingDomainService</span> {
    <span class="annotation">@PostConstruct</span>
    <span class="directive">public</span> <span class="type">void</span> postConstruct() {
        eventBusService.register(<span class="local-variable">this</span>);
    }
    <span class="annotation">@PreDestroy</span>
    <span class="directive">public</span> <span class="type">void</span> preDestroy() {
        eventBusService.unregister(<span class="local-variable">this</span>);
    }
    ...
    <span class="annotation">@javax</span>.inject.Inject
    EventBusService eventBusService;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This works for both singleton (application-scoped) and also <a href="#_rg_annotations_manpage-RequestScoped"><code>@RequestScoped</code></a> domain services.</p>
</div>
</div>
<div class="sect3">
<h4 id="_annotating_members">5.9.3. Annotating Members</h4>
<div class="paragraph">
<p>As discussed in the introduction, the framework will automatically emit domain events for all of the object members (actions, properties or collections) of an object whenever that object is rendered or (more generally) interacted with.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@Action</span>
    <span class="directive">public</span> Customer placeOrder(Product product, <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Quantity</span><span class="delimiter">&quot;</span></span>) <span class="type">int</span> qty) { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will propagate an instance of the default <code>o.a.i.applib.services.eventbus.ActionDomainEvent.Default</code> class.   If using the Guava event bus this can be subscribed to using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature=NatureOfService.DOMAIN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MySubscribingDomainService</span>
    <span class="annotation">@Programmatic</span>
    <span class="annotation">@com</span>.google.common.eventbus.Subscribe
    <span class="directive">public</span> <span class="type">void</span> on(ActionDomainEvent ev) { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or if using Axonframework, the subscriber uses a different annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature=NatureOfService.DOMAIN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MySubscribingDomainService</span>
    <span class="annotation">@Programmatic</span>
    <span class="annotation">@org</span>.axonframework.eventhandling.annotation.EventHandle
    <span class="directive">public</span> <span class="type">void</span> on(ActionDomainEvent ev) { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>More commonly though you will probably want to emit domain events of a specific subtype.  As a slightly more interesting example, suppose in a library domain that a <code>LibraryMember</code> wants to leave the library. A letter should be sent out detailing any books that they still have out on loan:</p>
</div>
<div class="paragraph">
<p>In the <code>LibraryMember</code> class, we publish the event by way of an annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LibraryMember</span> {
    <span class="annotation">@Action</span>(domainEvent=LibraryMemberLeaveEvent.class)  <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="type">void</span> leave() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>LibraryMemberLeaveEvent</code> is a subclass of <code>o.a.i.applib.eventbus.ActionDomainEvent</code>.  The topic of subclassing is discussed in more detail <a href="#_rg_services-api_manpage-EventBusService_event-hierarchy">below</a>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Meanwhile, in the <code>BookRepository</code> domain service, we subscribe to the event and act upon it.  For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">BookRepository</span> {
    <span class="annotation">@Programmatic</span>
    <span class="annotation">@com</span>.google.common.eventbus.Subscribe
    <span class="directive">public</span> <span class="type">void</span> onLibraryMemberLeaving(LibraryMemberLeaveEvent e) {
        LibraryMember lm = e.getLibraryMember();
        <span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; lentBooks = findBooksOnLoanFor(lm);
        <span class="keyword">if</span>(!lentBooks.isEmpty()) {
            sendLetter(lm, lentBooks);
        }
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This design allows the <code>libraryMember</code> module to be decoupled from the <code>book</code> module.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_services-api_manpage-EventBusService_event-hierarchy">5.9.4. Event hierarchy</h4>
<div class="paragraph">
<p>By creating domain event subtypes we can be more semantically precise and in turn providesmore flexibility for subscribers: they can choose whether to be broadly applicable (by subscribing to a superclass) or to be tightly focussed (by subscribing to a subclass).</p>
</div>
<div class="paragraph">
<p>We recommend that you define event classes at (up to) four scopes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>at the top "global" scope is the Apache Isis-defined <code>o.a.i.applib.event.ActionDomainEvent</code></p>
</li>
<li>
<p>for the "module" scope, create a static class to represent the module itself, and creating nested classes within</p>
</li>
<li>
<p>for each "class" scope, create a nested static event class in the domain object&#8217;s class for all of the domain object&#8217;s actions</p>
</li>
<li>
<p>for each "action" scope, create a nested static event class for that action, inheriting from the "domain object" class.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To put all that into code; at the module level we can define:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.mycompany.modules.libmem</span>;
...
public <span class="directive">static</span> <span class="type">class</span> <span class="class">LibMemModule</span> {
    <span class="directive">private</span> LibMemModule() {}
    <span class="directive">public</span> <span class="directive">abstract</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">ActionDomainEvent</span>&lt;S&gt;
                <span class="directive">extends</span> org.apache.isis.applib.event.ActionDomainEvent&lt;S&gt; {
        <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1L</span>;
        <span class="directive">public</span> ActionDomainEvent(
            <span class="directive">final</span> S source,
            <span class="directive">final</span> Identifier identifier,
            <span class="directive">final</span> <span class="predefined-type">Object</span>... arguments) {
            <span class="local-variable">super</span>(source, identifier, arguments);
        }
    }
    ...         <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>similar events for properties and collections should also be defined</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For the class-level we can define:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">LibraryMember</span> {
    <span class="directive">public</span> <span class="directive">abstract</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">ActionDomainEvent</span> <span class="directive">extends</span> LibMemModule.ActionDomainEvent&lt;LibraryMember&gt; {
        <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1L</span>;
        <span class="directive">public</span> ActionDomainEvent(
            <span class="directive">final</span> LibraryMember source,
            <span class="directive">final</span> Identifier identifier,
            <span class="directive">final</span> <span class="predefined-type">Object</span>... arguments) {
            <span class="local-variable">super</span>(source, identifier, arguments);
        }
    }
    ...         <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>similar events for properties and collections should also be defined</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>and finally at the action level we can define:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LibraryMember</span> {
    ...
    public <span class="directive">static</span> <span class="type">class</span> <span class="class">LeaveEvent</span> <span class="directive">extends</span> LibraryMember.ActionDomainEvent {
        <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1L</span>;
        <span class="directive">public</span> PlaceOrderEvent(
            <span class="directive">final</span> Customer source,
            <span class="directive">final</span> Identifier identifier,
            <span class="directive">final</span> <span class="predefined-type">Object</span>... arguments) {
        <span class="local-variable">super</span>(source, identifier, arguments);
        }
    }
    <span class="annotation">@Action</span>(domainEvent=LeaveEvent.class)
    <span class="directive">public</span> <span class="type">void</span> leave() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The subscriber can subscribe either to the general superclass (as before), or to any of the classes in the hierarchy.</p>
</div>
</div>
<div class="sect3">
<h4 id="_programmatic_posting">5.9.5. Programmatic posting</h4>
<div class="paragraph">
<p>To programmatically post an event, simply call <code>#post()</code>.</p>
</div>
<div class="paragraph">
<p>The <code>LibraryMember</code> example described above could for example be rewritten into:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LibraryMember</span> {
    ...
    public <span class="type">void</span> leave() {
        ...
        eventBusService.post(<span class="keyword">new</span> LibraryMember.LeaveEvent(...));    <i class="conum" data-value="1"></i><b>(1)</b>
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>LibraryMember.LeaveEvent</code> could be <em>any</em> class, not just a subclass of <code>o.a.i.applib.event.ActionDomainEvent</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In practice we suspect there will be few cases where the programmatic approach is required rather than the declarative approach afforded by <a href="#_rg_annotations_manpage-Action_domainEvent"><code>@Action#domainEvent()</code></a> et al.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_code_wrapperfactory_code">5.9.6. Using <code>WrapperFactory</code></h4>
<div class="paragraph">
<p>An alternative way to cause events to be posted is through the <a href="#_rg_services-api_manpage-WrapperFactory"><code>WrapperFactory</code></a>.  This is useful when you wish to enforce a (lack-of-) trust boundary between the caller and the callee.</p>
</div>
<div class="paragraph">
<p>For example, suppose that <code>Customer#placeOrder(&#8230;&#8203;)</code> emits a <code>PlaceOrderEvent</code>, which is subscribed to by a <code>ReserveStockSubscriber</code>.  This subscriber in turn calls <code>StockManagementService#reserveStock(&#8230;&#8203;)</code>.  Any business rules on <code>#reserveStock(&#8230;&#8203;)</code> should be enforced.</p>
</div>
<div class="paragraph">
<p>In the <code>ReserveStockSubscriber</code>, we therefore use the <code>WrapperFactory</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature=NatureOfService.DOMAIN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ReserveStockSubscriber</span> {
    <span class="annotation">@Programmatic</span>
    <span class="annotation">@Subscribe</span>
    <span class="directive">public</span> <span class="type">void</span> on(Customer.PlaceOrderEvent ev) {
        wrapperFactory.wrap(stockManagementService)
                      .reserveStock(ev.getProduct(), ev.getQuantity());
    }
    ...
    <span class="annotation">@Inject</span>
    StockManagementService stockManagementService;
    <span class="annotation">@Inject</span>
    WrapperFactory wrapperFactory;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_spi">5.9.7. Implementation SPI</h4>
<div class="paragraph">
<p>The implementation of <code>EventBusService</code> provided by Apache Isis will by default use <a href="https://code.google.com/p/guava-libraries/">Guava</a>'s <a href="https://code.google.com/p/guava-libraries/wiki/EventBusExplained"><code>EventBus</code></a> as the underlying in-memory event bus.  Alternatively the <a href="http://www.axonframework.org/">AxonFramework</a>'s <a href="http://www.axonframework.org/docs/2.4/single.html#d5e1489">SimpleEventBus</a> can be used.  Which is used is specified through configuration property (described <a href="#_rg_services-api_manpage-EventBusService_Configuration">below</a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Guava vs Axon, which to use?</div>
<div class="paragraph">
<p>Guava actually queues up events; they are not guaranteed to be dispatched immediately.  This generally is not problem, but can be for cases where the subscriber may in turn want to post its own events (using <a href="#_rg_services-api_manpage-WrapperFactory"><code>WrapperFactory</code></a>).</p>
</div>
<div class="paragraph">
<p>The Axon <code>SimpleEventBus</code>-based implementation on the other hand is fully synchronous; events are dispatched as soon as they are posted.  This works well in all scenarios (that we have tested).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is also possible to use some other implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">EventBusImplementation</span> {
    <span class="type">void</span> register(<span class="predefined-type">Object</span> domainService);
    <span class="type">void</span> unregister(<span class="predefined-type">Object</span> domainService);
    <span class="type">void</span> post(<span class="predefined-type">Object</span> event);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As is probably obvious, the <code>EventBusService</code> just delegates down to these method calls when its own similarly named methods are called.</p>
</div>
<div class="paragraph">
<p>If you do provide your own implementation of this SPI, be aware that your subscribers will need to use whatever convention is required (eg different annotations) such that the events are correctly routed through to your subscribers.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_services-api_manpage-EventBusService_Configuration">5.9.8. Configuration</h4>
<div class="paragraph">
<p>The implementation of <code>EventBusService</code> provided by Apache Isis will by default use <a href="https://code.google.com/p/guava-libraries/">Guava</a>'s <a href="https://code.google.com/p/guava-libraries/wiki/EventBusExplained"><code>EventBus</code></a> as the underlying in-memory event bus.  Alternatively the <a href="http://www.axonframework.org/">AxonFramework</a>'s <a href="http://www.axonframework.org/docs/2.4/single.html#d5e1489">SimpleEventBus</a> can be used.</p>
</div>
<div class="paragraph">
<p>To specify which, add the <a href="#_rg_runtime_configuring-core">configuration property</a> <code>isis.services.eventbus.implementation</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services.eventbus.implementation=guava</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services.eventbus.implementation=axon</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have written your own implementation of the <code>EventBusServiceImplementation</code> SPI, then specify instead its fully-qualified class name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services.eventbus.implementation=com.mycompany.isis.MyEventBusServiceImplementation</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, there is one further configuration property, whether to allow "late registration":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services.eventbus.allowLateRegistration=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>Late registration refers to the idea that a domain service can register itself with the <code>EventBusService</code> after events have been posted.  Since domain services are set up at boot time, this almost certainly constitutes a bug in the code and so by default late registration is <em>not</em> allowed.  Setting the above property to <code>true</code> disables this check.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_services_5">5.9.9. Registering the Services</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then Apache Isis' core implementation of <code>EventBusService</code> service is automatically registered and injected (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_4">5.9.10. Related Services</h4>
<div class="paragraph">
<p>The <code>EventBusService</code> is intended for fine-grained publish/subscribe for object-to-object interactions within an Apache Isis domain object model. The event propagation is strictly in-memory, and there are no restrictions on the object acting as the event (it need not be serializable, for example).</p>
</div>
<div class="paragraph">
<p>The <a href="#_rg_services-spi_manpage-PublishingService"><code>PublishingService</code></a> meanwhile is intended for coarse-grained publish/subscribe for system-to-system interactions, from Apache Isis to some other system. Here the only events published are those that action invocations (for actions annotated with <a href="#_rg_annotations_manpage-Action_publishing"><code>@Action#publishing()</code></a>) and of changed objects (for objects annotated with <a href="#_rg_annotations_manpage-DomainObject_publishing"><code>@DomainObject#publishing()</code></a>).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-api_manpage-FixtureScriptsDefault">5.10. <code>FixtureScriptsDefault</code></h3>
<div class="paragraph">
<p>The <code>FixtureScriptsDefault</code> service provides the ability to execute <a href="ug.html#_ug_testing_fixture-scripts_api-and-usage">fixture scripts</a> .</p>
</div>
<div class="paragraph">
<p>The service extends from the <a href="#_rg_classes_utility_manpage-FixtureScripts"><code>FixtureScripts</code></a>, and is only instantiated by the framework if there no custom implementation of <code>FixtureScripts</code> has been otherwise provided; in other words it is a fallback.</p>
</div>
<div class="paragraph">
<p>If this service is instantiated (as a fallback) then it uses the <a href="#_rg_services-spi_manpage-FixtureScriptsSpecificationProvider"><code>FixtureScriptsSpecificationProvider</code></a> to obtain a <code>FixtureScriptsSpecification</code>.  This configures this service, telling it which package to search for <code>FixtureScript</code> classes, how to execute those classes, and hints that influence the UI.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We recommend using <a href="#_rg_services-spi_manpage-FixtureScriptsSpecificationProvider"><code>FixtureScriptsSpecificationProvider</code></a> rather than subclassing <a href="#_rg_classes_utility_manpage-FixtureScripts"><code>FixtureScripts</code></a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_api_implementation_7">5.10.1. API &amp; Implementation</h4>
<div class="paragraph">
<p>The API for the service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">FixtureScriptsDefault</span> ... {
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;FixtureResult&gt; runFixtureScript(
        FixtureScript fixtureScript,
        <span class="predefined-type">String</span> parameters) { ... }
}</code></pre>
</div>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>in other words the same as <a href="#_rg_classes_utility_manpage-FixtureScripts"><code>FixtureScripts</code></a> superclass that it inherits from.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_2">5.10.2. Configuration</h4>
<div class="paragraph">
<p>As noted in the introduction, this service is only instantiated if there is no other implementation of <code>FixtureScripts</code> available on the classpath.</p>
</div>
<div class="paragraph">
<p>If an instance of <code>FixtureScriptsSpecificationProvider</code> is available on the classpath, then the service will be visible in the UI (assuming <a href="#_rg_runtime_deployment-types">prototype mode</a>).  Otherwise the service will be available only to be injected and invoked programmatically.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_5">5.10.3. Related Services</h4>
<div class="paragraph">
<p>The service interacts with <a href="#_rg_services-spi_manpage-FixtureScriptsSpecificationProvider"><code>FixtureScriptsSpecificationProvider</code></a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-api_manpage-GuiceBeanProvider">5.11. <code>GuiceBeanProvider</code></h3>
<div class="paragraph">
<p>The <code>GuiceBeanProvider</code> domain service acts as a bridge between Apache Isis' <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> internal bootstrapping using <a href="https://github.com/google/guice">Google Guice</a>.</p>
</div>
<div class="paragraph">
<p>This service operates at a very low-level, and you are unlikely to have a need for it.  It is used internally by the framework, in the default implementation of the <a href="#_rg_services-api_manpage-DeepLinkService"><code>DeepLinkService</code></a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Currently Apache Isis uses a combination of Guice (within the Wicket viewer only) and a home-grown dependency injection framework.  In future versions we intended to refactor the framework to use CDI throughout.  At that time this service is likely to become redundant because we will allow any of the internal components of Apache Isis to be injected into your domain object code.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_api_implementation_8">5.11.1. API &amp; Implementation</h4>
<div class="paragraph">
<p>The API defined by this service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">GuiceBeanProvider</span> {
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; T lookup(<span class="predefined-type">Class</span>&lt;T&gt; beanType);
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; T lookup(<span class="predefined-type">Class</span>&lt;T&gt; beanType, <span class="directive">final</span> <span class="predefined-type">Annotation</span> qualifier);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> this provides an implementation of this service.</p>
</div>
</div>
<div class="sect3">
<h4 id="_usage_4">5.11.2. Usage</h4>
<div class="paragraph">
<p>Using the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> requires subclassing of <code>IsisWicketApplication</code>.  In the subclass it is commonplace to override <code>newIsisWicketModule()</code>, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">protected</span> Module newIsisWicketModule() {
    <span class="directive">final</span> Module isisDefaults = <span class="local-variable">super</span>.newIsisWicketModule();
    <span class="directive">final</span> Module overrides = <span class="keyword">new</span> AbstractModule() {
        <span class="annotation">@Override</span>
        <span class="directive">protected</span> <span class="type">void</span> configure() {
            bind(<span class="predefined-type">String</span>.class).annotatedWith(Names.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">applicationName</span><span class="delimiter">&quot;</span></span>))
                              .toInstance(<span class="string"><span class="delimiter">&quot;</span><span class="content">ToDo App</span><span class="delimiter">&quot;</span></span>);
            bind(<span class="predefined-type">String</span>.class).annotatedWith(Names.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">applicationCss</span><span class="delimiter">&quot;</span></span>))
                              .toInstance(<span class="string"><span class="delimiter">&quot;</span><span class="content">css/application.css</span><span class="delimiter">&quot;</span></span>);
            bind(<span class="predefined-type">String</span>.class).annotatedWith(Names.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">applicationJs</span><span class="delimiter">&quot;</span></span>))
                              .toInstance(<span class="string"><span class="delimiter">&quot;</span><span class="content">scripts/application.js</span><span class="delimiter">&quot;</span></span>);
            ...
        }
    };
    <span class="keyword">return</span> Modules.override(isisDefaults).with(overrides);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This "module" is in fact a Guice module, and so the <code>GuiceBeanProvider</code> service can be used to lookup any of the components bound into it.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SomeDomainObject</span> {
    <span class="directive">private</span> <span class="predefined-type">String</span> lookupApplicationName() {
        <span class="keyword">return</span> guiceBeanProvider.lookup(<span class="predefined-type">String</span>.class, Names.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">applicationName</span><span class="delimiter">&quot;</span></span>));
    }
    <span class="annotation">@Inject</span>
    GuiceBeanProvider guiceBeanProvider;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>should return "ToDo App".</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_services_6">5.11.3. Registering the Services</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>and that the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> is being used then an implementation of <code>GuiceBeanProvider</code> is automatically registered and injected (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-api_manpage-IsisJdoSupport">5.12. <code>IsisJdoSupport</code></h3>
<div class="paragraph">
<p>The <code>IsisJdoSupport</code> service provides a number of general purpose methods for working with the JDO/DataNucleus objectstore.  In general these act at a lower-level of abstraction than the APIs normally used (specifically, those of <a href="#_rg_services-api_manpage-DomainObjectContainer"><code>DomainObjectContainer</code></a>), but nevertheless deal with some of the most common use cases.  For service also provides access to the underlying JDO <code>PersistenceManager</code> for full control.</p>
</div>
<div class="paragraph">
<p>The following sections discuss the functionality provided by the service, broken out into categories.</p>
</div>
<div class="sect3">
<h4 id="_rg_services-api_manpage-IsisJdoSupport_executing-sql">5.12.1. Executing SQL</h4>
<div class="paragraph">
<p>You can use the <code>IsisJdoSupportService</code> to perform arbitrary SQL SELECTs or UPDATEs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">IsisJdoSupport</span> {
    <span class="annotation">@Programmatic</span>
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt;&gt; executeSql(<span class="predefined-type">String</span> sql);
    <span class="annotation">@Programmatic</span>
    <span class="predefined-type">Integer</span> executeUpdate(<span class="predefined-type">String</span> sql);
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>executeSql(&#8230;&#8203;)</code> method allows arbitrary SQL <code>SELECT</code> queries to be submitted:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt;&gt; results = isisJdoSupport.executeSql(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from custMgmt.customers</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result set is automatically converted into a list of maps, where the map key is the column name.</p>
</div>
<div class="paragraph">
<p>In a similar manner, the <code>executeUpdate(&#8230;&#8203;)</code> allows arbitrary SQL <code>UPDATE</code>s to be performed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">int</span> count = isisJdoSupport.executeUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">select count(*) from custMgmt.customers);</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The returned value is the number of rows updated.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As an alternative, consider using DataNucleus' <a href="http://www.datanucleus.org/products/accessplatform_4_0/jdo/jdoql_typesafe.html">type-safe JDO query API</a>, discussed <a href="#_rg_services-api_manpage-IsisJdoSupport_type-safe-query-api">below</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_services-api_manpage-IsisJdoSupport_type-safe-jdoql-queries">5.12.2. Type-safe JDOQL Queries</h4>
<div class="paragraph">
<p>DataNucleus provides an <a href="http://www.datanucleus.org/products/accessplatform_4_0/jdo/jdoql_typesafe.html">extension to JDO</a>,  so that JDOQL queries can be built up and executed using a set of type-safe classes.</p>
</div>
<div class="paragraph">
<p>The types in question for type safe queries are not the domain entities, but rather are companion "Q&#8230;&#8203;" query classes.  These classes are generated dynamically by an <a href="https://www.jcp.org/en/jsr/detail?id=269">annotation processor</a> as a side-effect of compilation, one "Q&#8230;&#8203;" class for each of the <a href="#_rg_annotations_manpage-PersistenceCapable"><code>@PersistenceCapable</code></a> domain entity in your application.  For example, a <code>ToDoItem</code> domain entity will give rise to a <code>QToDoItem</code> query class.  These "Q&#8230;&#8203;" classes mirror the structure of domain entity, but expose properties that allow predicates to be built up for querying instances, as well as other functions in support of order by. group by and other clauses.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Most IDEs (including IntelliJ and Eclipse) enable annotation processing by default, as does Maven.  The DataNucleus' <a href="http://www.datanucleus.org/products/accessplatform_4_0/jdo/jdoql_typesafe.html">documentation</a> offers some guidance on confirming that APT is enabled.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>IsisJdoSupport</code> service offers two methods at different levels of abstraction:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">IsisJdoSupport</span> {
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; <span class="predefined-type">List</span>&lt;T&gt; executeQuery(<span class="directive">final</span> <span class="predefined-type">Class</span>&lt;T&gt; cls, <span class="directive">final</span> BooleanExpression be);
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; TypesafeQuery&lt;T&gt; newTypesafeQuery(<span class="predefined-type">Class</span>&lt;T&gt; cls);
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>executeQuery(&#8230;&#8203;)</code> method supports the common case of obtaining a set of objects that meet some criteria, filtered using the provided <code>BooleanExpression</code>.  To avoid memory leaks, the returned list is cloned and the underlying query closed.</p>
</div>
<div class="paragraph">
<p>For example, in the (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a> there is an implementation of <code>ToDoItemRepository</code> using type-safe queries.  The following JDOQL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span>
<span class="keyword">FROM</span> todoapp.dom.module.todoitem.ToDoItem
<span class="keyword">WHERE</span> atPath.indexOf(:atPath) == <span class="integer">0</span>
   &amp;&amp; complete == :complete<span class="string"><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>can be expressed using type-safe queries as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">List</span>&lt;ToDoItem&gt; findByAtPathAndCategory(<span class="directive">final</span> <span class="predefined-type">String</span> atPath, <span class="directive">final</span> Category category) {
    <span class="directive">final</span> QToDoItem q = QToDoItem.candidate();
    <span class="keyword">return</span> isisJdoSupport.executeQuery(ToDoItem.class,
            q.atPath.eq(atPath).and(
            q.category.eq(category)));
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can find the full example of the JDOQL equivalent in the <a href="#_rg_services-api_manpage-DomainObjectContainer_generic-repository-api"><code>DomainObjectContainer</code></a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>newTypesafeQuery(&#8230;&#8203;)</code> method is a lower-level API that allows a type safe query to be instantiated for most sophisticated querying, eg using group by or order by clauses.  See the
DataNucleus <a href="http://www.datanucleus.org/products/accessplatform_4_0/jdo/jdoql_typesafe.html">documentation</a> for full details of using this.</p>
</div>
<div class="paragraph">
<p>One thing to be aware of is that after the query has been executed, it should be closed, using <code>query.closeAll()</code>.  If calling <code>query.executeList()</code> we also recommend cloning the resultant list first.  The following utility method does both of these tasks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="directive">static</span> &lt;T&gt; <span class="predefined-type">List</span>&lt;T&gt; executeListAndClose(<span class="directive">final</span> TypesafeQuery&lt;T&gt; query) {
    <span class="directive">final</span> <span class="predefined-type">List</span>&lt;T&gt; elements = query.executeList();
    <span class="directive">final</span> <span class="predefined-type">List</span>&lt;T&gt; list = Lists.newArrayList(elements);
    query.closeAll();
    <span class="keyword">return</span> list;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_services-api_manpage-IsisJdoSupport_fixture-support">5.12.3. Fixture support</h4>
<div class="paragraph">
<p>When writing <a href="ug.html#_ug_testing_integ-test-support">integration tests</a> you&#8217;ll usually need to tear down some/all mutable transactional data before each test.  One way to do that is to use the <code>executeUpdate(&#8230;&#8203;)</code> method described <a href="#_rg_services-api_manpage-IsisJdoSupport_executing-sql">above</a>.</p>
</div>
<div class="paragraph">
<p>Alternatively, the <code>deleteAll(&#8230;&#8203;)</code> method will let your test delete all instances of a class without resorting to SQL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">IsisJdoSupport</span> {
    <span class="annotation">@Programmatic</span>
    <span class="type">void</span> deleteAll(<span class="predefined-type">Class</span>&lt;?&gt;... pcClasses);
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">TearDownAll</span> <span class="directive">extends</span> FixtureScriptAbstract {
    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> execute(<span class="directive">final</span> ExecutionContext ec) {
        isisJdoSupport.deleteAll(Order.class);
        isisJdoSupport.deleteAll(CustomerAddress.class);
        isisJdoSupport.deleteAll(Customer.class);
    }
    <span class="annotation">@Inject</span>
    IsisJdoSupport isisJdoSupport;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It can occasionally be the case that Apache Isis' internal adapter for the domain object is
still in memory.  JDO/DataNucleus seems to bump up the version of the object prior to its deletion,
which under normal circumstances would cause Apache Isis to throw a concurrency exception.  Therefore
to prevent this from happening (ie to <em>force</em> the deletion of all instances), concurrency checking
is temporarily disabled while this method is performed.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_services-api_manpage-IsisJdoSupport_reloading-entities">5.12.4. Reloading entities</h4>
<div class="paragraph">
<p>An <a href="http://www.datanucleus.org/products/datanucleus/jdo/orm/relationships.html">(intentional) limitation</a> of JDO/DataNucleus is that persisting a child entity (in a 1:n bidirectional relationship) does not cause the parent&#8217;s collection to be updated.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">IsisJdoSupport</span> {
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; T refresh(T domainObject);
    <span class="annotation">@Programmatic</span>
    <span class="type">void</span> ensureLoaded(<span class="predefined-type">Collection</span>&lt;?&gt; collectionOfDomainObjects);
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>refresh(T domainObject)</code> method can be used to reload the parent object (or indeed any object).  Under the covers it uses the JDO <code>PersistenceManager#refresh(&#8230;&#8203;)</code> API.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature=NatureOfService.VIEW_CONTRIBUTIONS_ONLY)
<span class="directive">public</span> <span class="type">class</span> <span class="class">OrderContributions</span> {
    <span class="directive">public</span> Order newOrder(<span class="directive">final</span> Customer customer) {
        Order order = newTransientInstance(Order.class);
        order.setCustomer(customer);
        container.persist(customer);
        container.flush();                  <i class="conum" data-value="1"></i><b>(1)</b>
        isisJdoSupport.refresh(customer);   <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="keyword">return</span> order;
    }
    <span class="annotation">@Inject</span>
    DomainObjectContainer container;
    <span class="annotation">@Inject</span>
    IsisJdoSupport isisJdoSupport;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>flush to database, ensuring that the database row corresponding to the <code>Order</code> exists in its <code>order</code> table.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>reload the parent (customer) from the database, so that its collection of <code>Order</code>s is accurate.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The particular example that led to this method being added was a 1:m bidirectional relationship,
analogous to <code>Customer 1&#8592;&#8594;* Order</code>.  Persisting the child <code>Order</code> object did not cause
the parent <code>Customer</code>'s collection of orders to be updated.  In fact, JDO does not make any
such guarantee to do so.  Options are therefore either to maintain the collection in code, or to
refresh the parent.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>ensureLoaded(&#8230;&#8203;)</code> method allows a collection of domain objects to be loaded from the database in a single hit.  This can be valuable as a performance optimization to avoid multiple roundtrips to the database.  Under the covers it uses the <code>PersistenceManager#retrieveAll(&#8230;&#8203;)</code> API.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_services-api_manpage-IsisJdoSupport_jdo-persistencemanager">5.12.5. JDO <code>PersistenceManager</code></h4>
<div class="paragraph">
<p>The functionality provided by <code>IsisJdoSupport</code> focus only on the most common use cases.  If you require more flexibility than this, eg for dynamically constructed queries, then you can use the service to access the underlying JDO <code>PersistenceManager</code> API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">IsisJdoSupport</span> {
    <span class="annotation">@Programmatic</span>
    PersistenceManager getJdoPersistenceManager();
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">List</span>&lt;Order&gt; findOrders(...) {
    javax.jdo.PersistenceManager pm = isisJdoSupport.getPersistenceManager();

    <span class="comment">// knock yourself out...</span>

    <span class="keyword">return</span> someListOfOrders;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_services_7">5.12.6. Registering the Services</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then Apache Isis' core implementation of <code>IsisJdoSupport</code> service is automatically registered and injected (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-api_manpage-MementoService">5.13. <code>MementoService</code></h3>
<div class="paragraph">
<p>The <code>MementoService</code> was originally introduced to simplify the implementation of <a href="ug.html#_ug_more-advanced_view-models">ViewModel</a>s which are required by the framework to return string representation of all of their backing state, moreover which is safe for use within a URL.</p>
</div>
<div class="paragraph">
<p>However, it can also be used to create a memento of arbitrary objects. Indeed, it is used internally by the core implementation of <a href="#_rg_services-api_manpage-BackgroundService"><code>BackgroundService</code></a> to capture the state of action invocations so that they can be executed by a background process.</p>
</div>
<div class="sect3">
<h4 id="_api_implementation_9">5.13.1. API &amp; Implementation</h4>
<div class="paragraph">
<p>The API defined by <code>MementoService</code> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">MementoService</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">interface</span> <span class="class">Memento</span> {
        <span class="annotation">@Programmatic</span>
        <span class="directive">public</span> Memento set(<span class="predefined-type">String</span> name, <span class="predefined-type">Object</span> value);
        <span class="annotation">@Programmatic</span>
        <span class="directive">public</span> &lt;T&gt; T get(<span class="predefined-type">String</span> name, <span class="predefined-type">Class</span>&lt;T&gt; cls);
        <span class="annotation">@Programmatic</span>
        <span class="directive">public</span> <span class="predefined-type">String</span> asString();
        <span class="directive">public</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; keySet();
    }
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> Memento create();
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> Memento parse(<span class="directive">final</span> <span class="predefined-type">String</span> str);
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="type">boolean</span> canSet(<span class="predefined-type">Object</span> input);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The core framework provides a default implementation of this API, namely <code>o.a.i.core.runtime.services.memento.MementoServiceDefault</code>.  The string returned (from <code>Memento#asString()</code>) is a base-64 URL encoded representation of the underlying format (an XML string).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In fact, the <code>MementoServiceDefault</code> implementation does provide a mechanism to disable the URL encoding, but this is not part of the <code>MementoService</code> public API. Note also that the encoding method is not pluggable.</p>
</div>
<div class="paragraph">
<p>However, you are of course free to write some other implementation of <code>MementoService</code>, perhaps based on <code>MementoServiceDefault</code> code if you wish.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The types of objects that are supported by the <code>MementoService</code> are implementation-specific, but would typically include all the usual value types as well as Apache Isis' <code>Bookmark</code> class (to represent references to arbitrary entities). Nulls can also be set.</p>
</div>
<div class="paragraph">
<p>In the case of the default implementation provided by the core framework, the types supported are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java.lang.String</code></p>
</li>
<li>
<p><code>java.lang.Boolean</code>, <code>boolean</code></p>
</li>
<li>
<p><code>java.lang.Byte</code>, <code>byte</code></p>
</li>
<li>
<p><code>java.lang.Short</code>, <code>short</code></p>
</li>
<li>
<p><code>java.lang.Integer</code>, <code>int</code></p>
</li>
<li>
<p><code>java.lang.Long</code>, <code>long</code></p>
</li>
<li>
<p><code>java.lang.Float</code>, <code>float</code></p>
</li>
<li>
<p><code>java.lang.Double</code>, <code>double</code></p>
</li>
<li>
<p><code>java.lang.Character</code>, <code>char</code></p>
</li>
<li>
<p><code>java.math.BigDecimal</code></p>
</li>
<li>
<p><code>java.math.BigInteger</code></p>
</li>
<li>
<p><code>org.joda.time.LocalDate</code></p>
</li>
<li>
<p><code>org.apache.isis.applib.services.bookmark.Bookmark</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If using another implementation, the <code>canSet(&#8230;&#8203;)</code> method can be used to check if the candidate object&#8217;s type is supported.</p>
</div>
</div>
<div class="sect3">
<h4 id="_usage_5">5.13.2. Usage</h4>
<div class="paragraph">
<p>As noted in the introduction, a common use case for this service is in the implementation of the <a href="#_rg_classes_super_manpage-AbstractViewModel"><code>ViewModel</code></a> interface.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Rather than implementing <code>ViewModel</code>, it&#8217;s usually easier to annotate your view models with <a href="#_rg_annotations_manpage-ViewModel"><code>@ViewModel</code></a> (or equivalently <a href="#_rg_annotations_manpage-DomainObject_nature"><code>@DomainObject#nature=EXTERNAL_ENTITY</code></a> or <a href="#_rg_annotations_manpage-DomainObject_nature"><code>@DomainObject#nature=INMEMORY_ENTITY</code></a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, suppose you were implementing a view model that represents an external entity in a SOAP web service.  To access this service the view model needs to store (say) the hostname, port number and an id to the object.</p>
</div>
<div class="paragraph">
<p>Using an injected <code>MementoService</code> the view model can roundtrip to and from this string, thus implementing the <code>ViewModel</code> API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ExternalEntity</span> <span class="directive">implements</span> ViewModel {
    <span class="directive">private</span> <span class="predefined-type">String</span> hostname;
    <span class="directive">private</span> <span class="type">int</span> port;
    <span class="directive">private</span> <span class="predefined-type">String</span> id;
    <span class="directive">public</span> <span class="predefined-type">String</span> viewModelMemento() {              <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="keyword">return</span> mementoService.create()
                .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">hostname</span><span class="delimiter">&quot;</span></span>, hostname)
                .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>, port)
                .set(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, id)
                .asString();
    }
    <span class="directive">public</span> <span class="type">void</span> viewModelInit(<span class="predefined-type">String</span> mementoStr) {  <i class="conum" data-value="2"></i><b>(2)</b>
        Memento memento = mementoService.parse(mementoStr);
        hostname = memento.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">hostname</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class);
        port = memento.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>, <span class="type">int</span>.class);
        id = memento.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class);
    ...
    <span class="annotation">@Inject</span>
    MementoService mementoService;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>part of the <code>ViewModel</code> API</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>part of the <code>ViewModel</code> API</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_6">5.13.3. Related Services</h4>
<div class="paragraph">
<p>The memento service is used by the <a href="#_rg_services-api_manpage-CommandContext"><code>CommandContext</code></a> service and also <a href="#_rg_services-spi_manpage-BackgroundCommandService"><code>BackgroundCommandService</code></a>. These both use a memento to capture a representation of an action invocation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_service_5">5.13.4. Registering the Service</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then Apache Isis' core implementation of <code>MementoService</code> service is automatically registered and injected (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-api_manpage-MetamodelService">5.14. <code>MetamodelService</code></h3>
<div class="paragraph">
<p>The <code>MetaModelService</code> provides access (albeit currently extremely limited) to aspects of Apache Isis' internal metamodel.</p>
</div>
<div class="paragraph">
<p>Currently this is limited to looking up the object type (as specified in <a href="#_rg_annotations_manpage-DomainObject_objectType"><code>@DomainObject#objectType()</code></a> and equivalent mechanisms, and as used in  <a href="#_rg_services-api_manpage-BookmarkService"><code>Bookmark</code></a>s and elsewhere) from an object&#8217;s class, and vice versa.  In the future we expect other aspects of the metamodel to also be formally surfaced through this API.</p>
</div>
<div class="sect3">
<h4 id="_api_implementation_10">5.14.1. API &amp; Implementation</h4>
<div class="paragraph">
<p>The API defined by the service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">MetaModelService</span> {
    <span class="annotation">@Programmatic</span>
    <span class="predefined-type">Class</span>&lt;?&gt; fromObjectType(<span class="directive">final</span> <span class="predefined-type">String</span> objectType);   <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Programmatic</span>
    <span class="predefined-type">String</span> toObjectType(<span class="directive">final</span> <span class="predefined-type">Class</span>&lt;?&gt; domainType);     <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>reverse lookup of a domain class' object type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>lookup of a domain class' object type</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_service_6">5.14.2. Registering the Service</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then Apache Isis' core implementation of <code>MetamodelService</code> service is automatically registered and injected (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-api_manpage-QueryResultsCache">5.15. <code>QueryResultsCache</code></h3>
<div class="paragraph">
<p>The purpose of the <code>QueryResultsCache</code> is to improve response times to the user, by providing a short-term (<a href="../../more-advanced-topics/how-to-09-020-How-to-write-a-typical-domain-service.html">request-scoped</a>) cache of the value of some (safe or idempotent) method call. This will typically be as the result of running a query, but could be any expensive operation.</p>
</div>
<div class="paragraph">
<p>Caching such values is useful for code that loops "naively" through a bunch of stuff, performing an expensive operation each time. If the data is such that the same expensive operation is made many times, then the query cache is a perfect fit.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This service was inspired by similar functionality that exists in relational databases, for example Sybase&#8217;s <a href="http://infocenter.sybase.com/help/index.jsp?topic=/com.sybase.dc20023_1251/html/optimizer/X43480.htm">subquery results cache</a> and Oracle&#8217;s <a href="http://www.dba-oracle.com/oracle11g/oracle_11g_result_cache_sql_hint.htm">result_cache</a> hint.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_api_implementation_11">5.15.1. API &amp; Implementation</h4>
<div class="paragraph">
<p>The API defined by <code>QueryResultsCache</code> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequestScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">QueryResultsCache</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">Key</span> {
        <span class="directive">public</span> <span class="predefined-type">Key</span>(<span class="predefined-type">Class</span>&lt;?&gt; callingClass, <span class="predefined-type">String</span> methodName, <span class="predefined-type">Object</span>... keys) {...}
        <span class="directive">public</span> <span class="predefined-type">Class</span>&lt;?&gt; getCallingClass() { ... }
        <span class="directive">public</span> <span class="predefined-type">String</span> getMethodName() { ... }
        <span class="directive">public</span> <span class="predefined-type">Object</span><span class="type">[]</span> getKeys() { ... }
    }
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">Value</span>&lt;T&gt; {
        <span class="directive">public</span> Value(T result) { ... }
        <span class="directive">private</span> T result;
        <span class="directive">public</span> T getResult() {
            <span class="keyword">return</span> result;
        }
    }
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> &lt;T&gt; T execute(
        <span class="directive">final</span> <span class="predefined-type">Callable</span>&lt;T&gt; callable,
        <span class="directive">final</span> <span class="predefined-type">Class</span>&lt;?&gt; callingClass, <span class="directive">final</span> <span class="predefined-type">String</span> methodName, <span class="directive">final</span> <span class="predefined-type">Object</span>... keys) { ... }
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> &lt;T&gt; T execute(<span class="directive">final</span> <span class="predefined-type">Callable</span>&lt;T&gt; callable, <span class="directive">final</span> <span class="predefined-type">Key</span> cacheKey) { ... }
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> &lt;T&gt; Value&lt;T&gt; get(
        <span class="directive">final</span> <span class="predefined-type">Class</span>&lt;?&gt; callingClass, <span class="directive">final</span> <span class="predefined-type">String</span> methodName, <span class="directive">final</span> <span class="predefined-type">Object</span>... keys) { ... }
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> &lt;T&gt; Value&lt;T&gt; get(<span class="directive">final</span> <span class="predefined-type">Key</span> cacheKey) { ... }
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> &lt;T&gt; <span class="type">void</span> put(<span class="directive">final</span> <span class="predefined-type">Key</span> cacheKey, <span class="directive">final</span> T result) { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This class (<code>o.a.i.applib.services.queryresultscache.QueryResultsCache</code>) is also the implementation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_usage_6">5.15.2. Usage</h4>
<div class="paragraph">
<p>Suppose that there&#8217;s a <code>TaxService</code> that calculates tax on <code>Taxable</code> items, with respect to some <code>TaxType</code>, and for a given <code>LocalDate</code>. To calculate tax it must run a database query and then perform some additional calculations.</p>
</div>
<div class="paragraph">
<p>Our original implementation is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TaxService</span> {
    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> calculateTax(
            <span class="directive">final</span> Taxable t, <span class="directive">final</span> TaxType tt, <span class="directive">final</span> LocalDate d) {
        <span class="comment">// query against DB using t, tt, d</span>
        <span class="comment">// further expensive calculations</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Suppose now that this service is called in a loop, for example iterating over a bunch of orders, where several of those orders are for the same taxable products, say. In this case the result of the calculation would always be the same for any given product.</p>
</div>
<div class="paragraph">
<p>We can therefore refactor the method to use the query cache as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">TaxService</span> {
    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> calculateTax(
            <span class="directive">final</span> Taxable t, <span class="directive">final</span> TaxType tt, <span class="directive">final</span> LocalDate d) {
        <span class="keyword">return</span> queryResultsCache.execute(
            <span class="keyword">new</span> <span class="predefined-type">Callable</span>&lt;<span class="predefined-type">BigDecimal</span>&gt;(){                         <i class="conum" data-value="1"></i><b>(1)</b>
                <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> call() <span class="directive">throws</span> <span class="exception">Exception</span> {
                     <span class="comment">// query against DB using t, tt, d</span>
                     <span class="comment">// further expensive calculations</span>
                }
            },
            TaxService.class,                                   <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="string"><span class="delimiter">&quot;</span><span class="content">calculateTax</span><span class="delimiter">&quot;</span></span>,
            t, tt, d);
        }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>Callable</code> is the original code</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the remaining parameters in essence uniquely identify the method call.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This refactoring will be worthwhile provided that enough of the orders being processed reference the same taxable products. If however every order is for a different product, then no benefit will be gained from the refactoring.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_service_7">5.15.3. Registering the Service</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then Apache Isis' core implementation of <code>QueryResultsCache</code> service is automatically registered and injected (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_7">5.15.4. Related Services</h4>
<div class="paragraph">
<p>The <a href="#_rg_services-api_manpage-Scratchpad"><code>Scratchpad</code></a> service is also intended for actions that are called many times, allowing arbitrary information to be shared between them. Those methods could be called from some outer loop in domain code, or by the framework itself if the action invoked has the <a href="#_rg_annotations_manpage-Action_invokeOn"><code>@Action#invokeOn()</code></a> annotation attribute set to <code>OBJECT_AND_COLLECTION</code> or <code>COLLECTION_ONLY</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-api_manpage-Scratchpad">5.16. <code>Scratchpad</code></h3>
<div class="paragraph">
<p>The <code>Scratchpad</code> service is a <a href="../../more-advanced-topics/how-to-09-020-How-to-write-a-typical-domain-service.html">request-scoped</a> service to allow objects to exchange information even if they do not directly call each other.</p>
</div>
<div class="sect3">
<h4 id="_api_implementation_12">5.16.1. API &amp; Implementation</h4>
<div class="paragraph">
<p>The API of <code>Scratchpad</code> service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequestScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Scratchpad</span> {
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> get(<span class="predefined-type">Object</span> key) { ... }
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="type">void</span> put(<span class="predefined-type">Object</span> key, <span class="predefined-type">Object</span> value) { ... }
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="type">void</span> clear() { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This class (<code>o.a.i.applib.services.scratchpad.Scratchpad</code>) is also the implementation.  And, as you can see, the service is just a request-scoped wrapper around a <code>java.util.Map</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_usage_7">5.16.2. Usage</h4>
<div class="paragraph">
<p>The most common use-case is for <a href="#_rg_annotations_manpage-Action_invokeOn">bulk</a> actions that act upon multiple objects in a list.  The (same) <code>Scratchpad</code> service is injected into each of these objects, and so they can use pass information.</p>
</div>
<div class="paragraph">
<p>For example, the Isis addons example <a href="https://github.com/isisaddons/isis-app-todoapp/">todoapp</a> (not ASF) demonstrates how the <code>Scratchpad</code> service can be used to calculate the total cost of the selected `ToDoItem`s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ActionSemantics</span>(Of.SAFE)
<span class="annotation">@Bulk</span>(AppliesTo.BULK_ONLY)
<span class="directive">public</span> <span class="predefined-type">BigDecimal</span> totalCost() {
    <span class="predefined-type">BigDecimal</span> total = (<span class="predefined-type">BigDecimal</span>) scratchpad.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">runningTotal</span><span class="delimiter">&quot;</span></span>);
    <span class="keyword">if</span>(getCost() != <span class="predefined-constant">null</span>) {
        total = total != <span class="predefined-constant">null</span> ? total.add(getCost()) : getCost();
        scratchpad.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">runningTotal</span><span class="delimiter">&quot;</span></span>, total);
    }
    <span class="keyword">return</span> total.setScale(<span class="integer">2</span>);
}
<span class="annotation">@Inject</span>
Scratchpad scratchpad;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A more complex example could use a <a href="ug.html#_ug_more-advanced_view-models">view model</a> to enable bulk updates to a set of objects. The view model&#8217;s job is to gather track of the items to be updated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItemUpdateBulkUpdate</span> <span class="directive">extends</span> AbstractViewModel {
    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;ToDoItem&gt; _items = ...;
    <span class="directive">public</span> ToDoItemBulkUpdate add(ToDoItem item) {
        _items.add(item);
        <span class="keyword">return</span> <span class="local-variable">this</span>;
    }
    ...                 <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>not shown - the implementation of <code>ViewModel</code> for converting the list of <code>_items</code> into a string.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The bulk action in the objects simply adds the selected item to the view model:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Action</span>(
    invokeOn=InvokeOn.COLLECTIONS_ONLY
    semantics=SemanticsOf.SAFE
)
<span class="directive">public</span> ToDoItemBulkUpdate bulkUpdate() {
    <span class="keyword">return</span> lookupBulkUpdateViewModel().add(<span class="local-variable">this</span>);
}
<span class="directive">private</span> ToDoItemBulkUpdate lookupBulkUpdateViewModel() {
    ToDoItemBulkUpdate bulkUpdate =
        (ToDoItemBulkUpdate) scratchpad.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">bulkUpdateViewModel</span><span class="delimiter">&quot;</span></span>);     <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="keyword">if</span>(bulkUpdate == <span class="predefined-constant">null</span>) {
        bulkUpdate = container.injectServicesInto(<span class="keyword">new</span> ToDoItemBulkUpdate());
        scratchpad.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">bulkUpdateViewModel</span><span class="delimiter">&quot;</span></span>, bulkUpdate);              <i class="conum" data-value="2"></i><b>(2)</b>
    }
    <span class="keyword">return</span> bulkUpdate;
}
<span class="annotation">@Inject</span>
Scratchpad scratchpad;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>look for the <code>ToDoItemBulkUpdate</code> in the scratchpad&#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>&#8230;&#8203; and add one if there isn&#8217;t one (ie for the first object returned).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If using the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a>, the <code>ToDoItemBulkUpdate</code> view model returned from the last action invoked will be displayed. Thereafter this view model can be used to perform a bulk update of the "enlisted" items.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_service_8">5.16.3. Registering the Service</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then Apache Isis' core implementation of <code>Scratchpad</code> service is automatically registered and injected (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_8">5.16.4. Related Services</h4>
<div class="paragraph">
<p>The <a href="#_rg_services-api_manpage-ActionInteractionContext"><code>ActionInteractionContext</code></a> service allows <a href="#_rg_annotations_manpage-Action_invokeOn">bulk actions</a> to co-ordinate with each other.</p>
</div>
<div class="paragraph">
<p>The <a href="#_rg_services-api_manpage-QueryResultsCache"><code>QueryResultsCache</code></a> is useful for caching the results of expensive method calls.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-api_manpage-SudoService">5.17. <code>SudoService</code></h3>
<div class="paragraph">
<p>The <code>SudoService</code> allows the current user reported by the <code>DomainObjectContainer</code> to be temporarily changed to some
other user. This is useful both for <a href="ug.html#_ug_testing_integ-test-support">integration testing</a> (eg if testing a workflow system whereby objects are moved from one user to another) and while running <a href="ug.html#_ug_testing_fixture-scripts">fixture scripts</a> (eg setting up objects that would normally require several users to have acted upon the objects).</p>
</div>
<div class="sect3">
<h4 id="_api_implementation_13">5.17.1. API &amp; Implementation</h4>
<div class="paragraph">
<p>The API provided by the service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">SudoService</span> {
    <span class="annotation">@Programmatic</span>
    <span class="type">void</span> sudo(<span class="predefined-type">String</span> username, <span class="directive">final</span> <span class="predefined-type">Runnable</span> runnable);
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; T sudo(<span class="predefined-type">String</span> username, <span class="directive">final</span> <span class="predefined-type">Callable</span>&lt;T&gt; callable);
    <span class="annotation">@Programmatic</span>
    <span class="type">void</span> sudo(<span class="predefined-type">String</span> username, <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; roles, <span class="directive">final</span> <span class="predefined-type">Runnable</span> runnable);
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; T sudo(<span class="predefined-type">String</span> username, <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; roles, <span class="directive">final</span> <span class="predefined-type">Callable</span>&lt;T&gt; callable);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>which will run the provided block of code (a <code>Runnable</code> or a <code>Callable</code>) in a way such that calls to <code>DomainObjectContainer#getUser()</code> will return the specified user (and roles, if specified)</p>
</div>
<div class="paragraph">
<p>The core framework provides a default implementation of this service (<code>o.a.i.core.runtime.services.sudo.SudoServiceDefault</code>)</p>
</div>
</div>
<div class="sect3">
<h4 id="_usage_8">5.17.2. Usage</h4>
<div class="paragraph">
<p>A good example can be found in the (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a> which uses the <code>SudoService</code> in a fixture script to set up <code>ToDoItem</code> objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">protected</span> <span class="type">void</span> execute(<span class="directive">final</span> ExecutionContext ec) {
    ...
    sudoService.sudo(getUsername(),
            <span class="keyword">new</span> <span class="predefined-type">Runnable</span>() {
                <span class="annotation">@Override</span>
                <span class="directive">public</span> <span class="type">void</span> run() {
                    wrap(toDoItem).completed();
                }
            });
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_service_9">5.17.3. Registering the Service</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then Apache Isis' core implementation of <code>SudoService</code> service is automatically registered and injected (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-api_manpage-WrapperFactory">5.18. <code>WrapperFactory</code></h3>
<div class="paragraph">
<p>The <code>WrapperFactory</code> provides the ability to enforce business rules for programmatic interactions between domain objects.  If there is a (lack-of-) trust boundary between the caller and callee&#8201;&#8212;&#8201;eg if they reside in different modules&#8201;&#8212;&#8201;then the wrapper factory is a useful mechanism to ensure that any business constraints defined by te callee are honoured.</p>
</div>
<div class="paragraph">
<p>For example, if the calling object attempts to modify an unmodifiable property on the target object, then an exception will be thrown.  Said another way: interactions are performed "as if" they are through the viewer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For a discussion of the use of the <code>WrapperFactory</code> within integration tests (the primary or at least original use case for this service) can be found <a href="ug.html#_ug_testing_integ-test-support_wrapper-factory">here</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This capability goes beyond enforcing the (imperative) constraints within the <code>hideXxx()</code>, <code>disableXxx()</code> and <code>validateXxx()</code> supporting methods; it also enforces (declarative) constraints such as those represented by annotations, eg <code>@MaxLength</code> or <code>@Regex</code>.</p>
</div>
<div class="paragraph">
<p>This capability is frequently used within <a href="ug.html#_ug_testing_integ-test-support">integration tests</a>, but can also be used in production code. (There are analogies that can be drawn here with the way that JEE beans can interact through an EJB local interface).</p>
</div>
<div class="sect3">
<h4 id="_api_2">5.18.1. API</h4>
<div class="paragraph">
<p>The API provided by the service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">WrapperFactory</span> {
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; T wrap(T domainObject);                             <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; T unwrap(T possibleWrappedDomainObject);            <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; <span class="type">boolean</span> isWrapper(T possibleWrappedDomainObject);   <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">enum</span> ExecutionMode {                      <i class="conum" data-value="4"></i><b>(4)</b>
        EXECUTE(<span class="predefined-constant">true</span>,<span class="predefined-constant">true</span>),
        SKIP_RULES(<span class="predefined-constant">false</span>, <span class="predefined-constant">true</span>),                            <i class="conum" data-value="5"></i><b>(5)</b>
        NO_EXECUTE(<span class="predefined-constant">true</span>, <span class="predefined-constant">false</span>);                            <i class="conum" data-value="6"></i><b>(6)</b>
    }
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; T wrap(T domainObject, ExecutionMode mode);         <i class="conum" data-value="7"></i><b>(7)</b>
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; T wrapNoExecute(T domainObject);                    <i class="conum" data-value="8"></i><b>(8)</b>
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; T wrapSkipRules(T domainObject);                    <i class="conum" data-value="9"></i><b>(9)</b>
    ...
 }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>wraps the underlying domain object.  If it is already wrapped, returns the object back unchanged.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Obtains the underlying domain object, if wrapped.  If the object is not wrapped, returns back unchanged.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>whether the supplied object has been wrapped.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>enumerates how the wrapper interacts with the underlying domain object.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>validate all business rules and then execute.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>skip all business rules and then execute (including creating <a href="#_rg_annotations_manpage-Action_command">command</a>s and firing pre- and post-execute <a href="#_rg_annotations_manpage-Action_domainEvent">domain event</a>s).</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>validate all business rules (including those from <a href="#_rg_annotations_manpage-Action_domainEvent">domain event</a>s) but do not execute.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>convenience method to invoke <code>wrap(&#8230;&#8203;)</code> with <code>ExecuteMode#NO_EXECUTE</code> (make this feature more discoverable)</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>convenience method to invoke <code>wrap(&#8230;&#8203;)</code> with <code>ExecuteMode#SKIP_RULES</code> (make this feature more discoverable)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The service works by returning a "wrapper" around a supplied domain object (a <a href="http://www.javassist.org">javassist</a> proxy), and it is this wrapper that ensures that the hide/disable/validate rules implies by the Apache Isis programming model are enforced. The wrapper can be interacted with as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <code>get&#8230;&#8203;()</code> method for properties or collections</p>
</li>
<li>
<p>a <code>set&#8230;&#8203;()</code> method for properties</p>
</li>
<li>
<p>an <code>addTo&#8230;&#8203;()</code> or <code>removeFrom&#8230;&#8203;()</code> method for collections</p>
</li>
<li>
<p>any action</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Calling any of the above methods may result in a (subclass of) <code>InteractionException</code> if the object disallows it. For example, if a property is annotated with <code>@Hidden</code> then a <code>HiddenException</code> will be thrown. Similarly if an action has a <code>validateXxx()</code> method and the supplied arguments are invalid then an <code>InvalidException</code> will be thrown.</p>
</div>
<div class="paragraph">
<p>In addition, the following methods may also be called:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <a href="#_rg_methods_reserved_manpage-title"><code>title()</code></a> and <code>toString()</code> methods</p>
</li>
<li>
<p>any <a href="#_rg_methods_prefixes_manpage-default"><code>default&#8230;&#8203;()</code></a>, <a href="#_rg_methods_prefixes_manpage-choices"><code>choices&#8230;&#8203;()</code></a> or <a href="#_rg_methods_prefixes_manpage-autoComplete"><code>autoComplete&#8230;&#8203;()</code></a> methods</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An exception will be thrown if any other methods are thrown.</p>
</div>
</div>
<div class="sect3">
<h4 id="_usage_9">5.18.2. Usage</h4>
<div class="paragraph">
<p>The caller will typically obtain the target object (eg from some repository) and then use the injected <code>WrapperFactory</code> to wrap it before interacting with it.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerAgent</span> {
    <span class="annotation">@Action</span>
    <span class="directive">public</span> <span class="type">void</span> refundOrder(<span class="directive">final</span> Order order) {
        <span class="directive">final</span> Order wrappedOrder = wrapperFactory.wrap(order);
        <span class="keyword">try</span> {
            wrappedOrder.refund();
        } <span class="keyword">catch</span>(InteractionException ex) {          <i class="conum" data-value="1"></i><b>(1)</b>
            container.raiseError(ex.getMessage());  <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="keyword">return</span>;
        }
    }
    ...
    <span class="annotation">@Inject</span>
    WrapperFactory wrapperFactory;
    <span class="annotation">@Inject</span>
    DomainObjectContainer container;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>if any constraints on the <code>Order&#8217;s `refund()</code> action would be violated, then &#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>&#8230;&#8203; these will be trapped and raised to the user as a warning.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It ought to be possible to implement an <a href="#_rg_services-spi_manpage-ExceptionRecognizer"><code>ExceptionRecognizer</code></a>s that would allow the above boilerplate to be removed.  This recognizer service would recognize the <code>InteractionException</code> and convert to a suitable message.</p>
</div>
<div class="paragraph">
<p>At the time of writing Apache Isis does not provide an out-of-the-box implementation of such an <code>ExceptionRecognizer</code>; but it should be simple enough to write one</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_listener_api">5.18.3. Listener API</h4>
<div class="paragraph">
<p>The <code>WrapperFactory</code> also provides a listener API to allow other services to listen in on interactions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">WrapperFactory</span> {
    ...
    <span class="annotation">@Programmatic</span>
    <span class="predefined-type">List</span>&lt;InteractionListener&gt; getListeners();                               <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="type">boolean</span> addInteractionListener(InteractionListener listener);    <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="type">boolean</span> removeInteractionListener(InteractionListener listener); <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="type">void</span> notifyListeners(InteractionEvent ev);                       <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>all <code>InteractionListener</code>s that have been registered.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>registers an <code>InteractionListener</code>, to be notified of interactions on all wrappers.  The listener will be notified of interactions even on wrappers created before the listener was installed. (From an implementation perspective this is because the wrappers delegate back to the container to fire the events).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>remove an <code>InteractionListener</code>, to no longer be notified of interactions on wrappers.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>used by the framework itself</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The original intent of this API was to enable test transcripts to be captured (in a BDD-like fashion) from integration tests.  No such feature has yet been implemented however.  Also, the capabilities have by and large been superceded by Apache Isis' support for domain events.  We may therefore deprecate this API in the future.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_service_10">5.18.4. Registering the Service</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then Apache Isis' core implementation of <code>WrapperFactory</code> service is automatically registered and injected (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-api_manpage-XmlSnapshotService">5.19. <code>XmlSnapshotService</code></h3>
<div class="paragraph">
<p>The <code>XmlSnapshotService</code> provides the capability to generate XML snapshots (and if required corresponding XSD schemas) based on graphs of domain objects.</p>
</div>
<div class="paragraph">
<p>Typical use cases include creating mementos for business-focused auditing, such that a report could be generated as to which end-user performed a business action (perhaps for legal reasons).  For one system that we know of, a digest of this snapshot of data is signed with the public encryption key so as to enforce non-repudiation.</p>
</div>
<div class="paragraph">
<p>Another use case is to grab raw data such that it could be merged into a report template or communication.</p>
</div>
<div class="paragraph">
<p>The service offers a basic API to create a snapshot of a single object, and an more flexible API that allows the size of the graph to be customized.</p>
</div>
<div class="paragraph">
<p>The core framework provides an implementation of this service (<code>o.a.i.core.runtime.services.xmlsnapshot.XmlSnapshotServiceDefault</code>).</p>
</div>
<div class="sect3">
<h4 id="_standard_api">5.19.1. Standard API</h4>
<div class="paragraph">
<p>The (basic) API of <code>XmlSnapshotService</code> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>public interface XmlSnapshotService {
    public interface Snapshot {
        Document getXmlDocument();
        Document getXsdDocument();
        String getXmlDocumentAsString();
        String getXsdDocumentAsString();
    }
    @Programmatic
    public XmlSnapshotService.Snapshot snapshotFor(Object domainObject);
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The most straight-forward usage of this service is simply:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">XmlSnapshot snapshot = xmlsnapshotService.snapshotFor(customer);
<span class="predefined-type">Element</span> customerAsXml = snapshot.getXmlElement();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will return an XML (document) element that contains the names and values of each of the customer&#8217;s value properties, along with the titles of reference properties, and also the number of items in collections.</p>
</div>
<div class="paragraph">
<p>As well as obtaining the XML snapshot, it is also possible to obtain an XSD schema that the XML snapshot conforms to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>XmlSnapshot snapshot = ...;
Element customerAsXml = snapshot.getXmlElement();
Element customerXsd = snapshot.getXsdElement();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be useful for some tools.  For example, <a href="http://www.altova.com/stylevision.html">Altova Stylevision</a> can use the XML and XSD to transform into reports.  Please note that this link does not imply endorsement (nor even a recommendation that this is a good design).</p>
</div>
</div>
<div class="sect3">
<h4 id="_builder_api">5.19.2. Builder API</h4>
<div class="paragraph">
<p>The contents of the snapshot can be adjusted by including "paths" to other references or collections. To do this, the
builder is used.  The API for this is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">XmlSnapshotService</span> {
    ...
    public <span class="type">interface</span> <span class="class">Builder</span> {
        <span class="type">void</span> includePath(<span class="directive">final</span> <span class="predefined-type">String</span> path);
        <span class="type">void</span> includePathAndAnnotation(<span class="predefined-type">String</span> path, <span class="predefined-type">String</span> annotation);
        XmlSnapshotService.Snapshot build();
    }
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> XmlSnapshotService.Builder builderFor(<span class="predefined-type">Object</span> domainObject);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We start by obtaining a builder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">XmlSnapshot.Builder builder = xmlsnapshotService.builderFor(customer);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Suppose now that we want the snapshot to also include details of the customer&#8217;s address, where <code>address</code> in this case is a reference property to an instance of the <code>Address</code> class. We can "walk-the-graph" by including these references within the builder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">builder.includePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>We could then go further and include details of every order in the customer&#8217;s <code>orders</code> collection, and details of every
product of every order:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">builder.includePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">orders/product</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>When all paths are included, then the builder can build the snapshot:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">XmlSnapshot snapshot = builder.build();
<span class="predefined-type">Element</span> customerAsXml = snapshot.getXmlElement();</code></pre>
</div>
</div>
<div class="paragraph">
<p>All of this can be strung together in a fluent API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Element</span> customerAsXml = xmlsnapshotService.builderFor(customer)
                        .includePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>)
                        .includePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">orders/product</span><span class="delimiter">&quot;</span></span>)
                        .build()
                        .getXmlElement();</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you might imagine, the resultant XML document can get quite large very quickly with only a few "include"s.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If an XSD schema is beng generated (using <code>snapshot.getXsdElement()</code> then note that for the XSD to be correct, the object being snapshotted must have non-null values for the paths that are `include()&#8217;d. If this isn&#8217;t done then the XSD will not be correct reflect for another snapshotted object that does have non-null values.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_automatic_inclusions">5.19.3. Automatic inclusions</h4>
<div class="paragraph">
<p>If the domain object being snapshotted implements the <code>SnapshottableWithInclusions</code> interace, then this moves the
responsibility for determining what is included within the snapshot from the caller to the snapshottable object itself:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>public interface SnapshottableWithInclusions extends Snapshottable {
    List&lt;String&gt; snapshotInclusions();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If necessary, both approaches can be combined.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As an alternative to using <code>include()</code>, you might consider building a view model domain object which can reference only the relevant information required for the snapshot. For example, if only the 5 most recent Orders for a Customer were required, a <code>CustomerAndRecentOrders</code> view model could hold a collection of just those 5 <code>Order</code>s. Typically such view models would implement <code>SnapshottableWithInclusions</code>.</p>
</div>
<div class="paragraph">
<p>One reason for doing this is to provide a stable API between the domain model and whatever it is that might be consuming the XML. With a view model you can refactor the domain entities but still preserve a view model such that the XML is the same.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_convenience_api">5.19.4. Convenience API</h4>
<div class="paragraph">
<p>The <code>XmlSnapshotService</code> also provides some API for simply manipulating XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>public interface XmlSnapshotService {
    ...
    @Programmatic
    public Document asDocument(String xmlStr);                          <i class="conum" data-value="1"></i><b>(1)</b>
    @Programmatic
    public &lt;T&gt; T getChildElementValue(                                  <i class="conum" data-value="2"></i><b>(2)</b>
                    Element el, String tagname, Class&lt;T&gt; expectedCls);
    @Programmatic
    public Element getChildElement(                                     <i class="conum" data-value="3"></i><b>(3)</b>
                    Element el, String tagname);
    @Programmatic
    public String getChildTextValue(Element el);                        <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>is a convenience method to convert xml string back into a W3C Document</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>is a convenience method to extract the value of an XML element, based on its type.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>is a convenience method to walk XML document.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>is a convenience method to obtain value of child text node.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_service_11">5.19.5. Registering the Service</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then Apache Isis' core implementation of <code>XmlSnapshotService</code> service is automatically registered and injected (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_9">5.19.6. Related Services</h4>
<div class="paragraph">
<p>The <a href="#_rg_services-api_manpage-BookmarkService"><code>BookmarkService</code></a> provides a mechanism for obtaining a string representations of a single domain object.</p>
</div>
<div class="paragraph">
<p>The <a href="#_rg_services-api_manpage-MementoService"><code>MementoService</code></a> also provides a mechanism for generating string representations of domain objects.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rg_services-spi">6. Domain Services SPI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apache Isis includes an extensive number of domain services for your domain objects to use; these are listed in <a href="#_rg_services-api">Reference: Domain Services (API)</a> chapter.</p>
</div>
<div class="paragraph">
<p>There are other domain services that constitute not an API but an SPI; if present they are used by Apache Isis itself rather than by your domain objects.  A good example of this is the <a href="#_rg_services-spi_manpage-AuditingService"><code>AuditingService</code></a> service; if an implementation is present then Apache Isis will call that service in order to record audit log entries.  If no implementation is available then Apache Isis will carry on regardless.</p>
</div>
<div class="paragraph">
<p>Some domain services can be considered both API and SPI; a good example is the <a href="#_rg_services-api_manpage-EmailService"><code>EmailService</code></a> that is of direct use for domain objects wishing to send out emails, but is also used by the framework to support the <a href="ug.html#_ug_wicket-viewer_features_user-registration">user registration</a> functionality supported by the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a>.   The same is true of the <a href="#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a>; this can be used by domain objects to broadcast arbitrary events, but is also used by the framework to automatically emit events for <a href="#_rg_annotations_manpage-Action_domainEvent"><code>@Action#domainEvent()</code></a> etc.</p>
</div>
<div class="paragraph">
<p>For these hybrid services we have categorized the service as an "API" service.  This chapter therefore contains only the strictly SPI services.</p>
</div>
<div class="paragraph">
<p>The table below lists the SPIs that are defined in the Isis applib (<code>o.a.i.core:isis-core-applib</code> module).</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 25. Applib SPI Services</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 12%;">
<col style="width: 12%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">SPI</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Implementation</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-spi_manpage-AuditingService"><code>o.a.i.applib.</code><br>
<code>services.audit</code><br>
<code>AuditingService3</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Create an audit record for every changed property of every changed object within a transaction.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuditingService</code><br>
<code>o.ia.m.audit</code><br>
<code>isis-module-audit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">related services:
<code>AuditingService-</code><br>
<code>Contributions</code>,
<code>AuditingService-</code><br>
<code>Repository</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-spi_manpage-BackgroundCommandService"><code>o.a.i.applib.</code><br>
<code>services.background</code><br>
<code>BackgroundCommandService</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Persisted a memento of an action invocation such that it can be executed asynchronously ("in the background") eg by a scheduler.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BackgroundCommandServiceJdo</code><br>
<code>o.ia.m.command</code><br>
<code>isis-module-command</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">related services:
<code>BackgroundCommandService-</code><br>
<code>JdoContributions</code>,
<code>BackgroundCommandService-</code><br>
<code>JdoRepository</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-spi_manpage-ClassDiscoveryService"><code>o.a.i.applib.</code><br>
<code>services.classdiscovery</code><br>
<code>ClassDiscoveryService</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Mechanism to locate (from the classpath) classes with a specific annotation (eg <a href="#_rg_annotations_manpage-DomainService"><code>@DomainService</code></a>)</p>
</div>
<div class="paragraph">
<p>Subtypes of a given type (eg <a href="#_rg_classes_super_manpage-FixtureScript"><code>FixtureScript</code></a>).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ClassDiscoveryService-</code><br>
<code>UsingReflections</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-applib</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">requires <code>org.reflections:reflections</code> as Maven dependency</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-spi_manpage-CommandService"><code>o.a.i.applib.</code><br>
<code>services.command.spi</code><br>
<code>CommandService</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Service to act as a factory and repository (create and save) of command instances, ie representations of an action invocation.  Used for command/auditing and background services.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CommandServiceJdo</code><br>
<code>o.ia.m.command</code><br>
<code>isis-module-command</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">related services:<br>
<code>CommandService-</code> 
`JdoContributions`,
`CommandService-` 
<code>JdoRepository</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-spi_manpage-EmailNotificationService"><code>o.a.i.applib.</code><br>
<code>services.userreg</code><br>
<code>EmailNotificationService</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Notify a user during <a href="#_rg_services-spi_manpage-UserRegistrationService">self-registration</a> of users.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EmailNotificationService-</code><br>
<code>Default</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-runtime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">depends on:<br>
a configured <code>EmailService</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-spi_manpage-EventSerializer"><code>o.a.i.applib.</code><br>
<code>services.publish</code><br>
<code>EventSerializer</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Creates a representation of either an action invocation or a changed object being published through the <a href="#_rg_services-spi_manpage-PublishingService"><code>PublishingService</code></a>.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RestfulObjects-</code><br>
<code>SpecEventSerializer</code><br>
<code>o.ia.m.publishing</code><br>
<code>isis-module-publishing</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-spi_manpage-ExceptionRecognizer"><code>o.a.i.applib.</code><br>
<code>services.exceprecog</code><br>
<code>ExceptionRecognizer2</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Convert certain exceptions (eg foreign or unique key violation in the database) into a format that can be rendered to the end-user.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ExceptionRecognizer-</code><br>
<code>CompositeFor-</code><br>
<code>JdoObjectStore</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-applib</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extensible using composite pattern if required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-spi_manpage-LocaleProvider"><code>o.a.i.applib.</code><br>
<code>services.i18n</code><br>
<code>LocaleProvider</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Request-scoped service to return the locale of the current user, in support of i18n (ie so that the app&#8217;s UI, messages and exceptions can be translated to the required locale by the <a href="#_rg_services-spi_manpage-TranslationService"><code>TranslationService</code></a>.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LocaleProviderWicket</code><br>
<code>o.a.i.viewer</code><br>
<code>isis-viewer-wicket-impl</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-spi_manpage-FixtureScriptsSpecificationProvider"><code>o.a.i.applib.</code><br>
<code>services.fixturespec</code><br>
<code>FixtureScripts-</code><br>
<code>SpecificationProvider</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Provides settings for <a href="#_rg_services-api_manpage-FixtureScriptsDefault"><code>FixtureScriptsDefault</code></a> fallback domain service for executing fixture scripts.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-spi_manpage-PublishingService"><code>o.a.i.applib.</code><br>
<code>services.publish</code><br>
<code>PublishingService</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Publish any action invocations and changed objects, typically for interchange with an external system in a different bounded context.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PublishingService</code><br>
<code>o.ia.m.publishing</code><br>
<code>isis-module-publishing</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">related services:
<code>PublishingService-</code> 
`Contributions`,
`PublishingService-` 
<code>Repository</code>. <br>
depends on:<br>
<code>EventSerializer</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-spi_manpage-TranslationService"><code>o.a.i.applib.</code><br>
<code>services.i18n</code><br>
<code>TranslationService</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Translate an app&#8217;s UI, messages and exceptions for the current user (as per the locale provided by <a href="#_rg_services-spi_manpage-LocaleProvider"><code>LocalProvider</code></a>.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TranslationServicePo</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-runtime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">related services: <code>TranslationServicePoMenu</code><br>
depends on:<br>
<code>TranslationsResolver</code>, <code>LocaleProvider</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-spi_manpage-TranslationsResolver"><code>o.a.i.applib.</code><br>
<code>services.i18n</code><br>
<code>TranslationsResolver</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Obtain translations for a particuar phrase and locale, in support of i18n (ie so that the app&#8217;s UI, messages and exceptions can be translated to the required locale by the <a href="#_rg_services-spi_manpage-TranslationService"><code>TranslationService</code></a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TranslationsResolverWicket</code><br>
<code>o.a.i.viewer</code><br>
<code>isis-viewer-wicket-impl</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-spi_manpage-UserProfileService"><code>o.a.i.applib.</code><br>
<code>services.userprof</code><br>
<code>UserProfileService</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Obtain an alternative (usually enriched/customized) name for the current user, to render in the UI.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-spi_manpage-UserRegistrationService"><code>o.a.i.applib.</code><br>
<code>services.userreg</code><br>
<code>UserRegistrationService</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Create a new user account with the configured security mechanism.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SecurityModule-</code><br>
<code>AppUserRegistrationService</code><br>
<code>o.ia.m.security</code><br>
<code>isis-module-security</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">depends (implicitly) on:<br>
a configured <code>EmailService</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Key:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>o.a.i</code> is an abbreviation for <code>org.apache.isis</code></p>
</li>
<li>
<p><code>o.ia.m</code> is an abbreviation for <code>org.isisaddons.module</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Where an implementation is available (on the classpath) then it is always registered automatically (that is, they are all (with one exception) annotated with <a href="#_rg_annotations_manpage-DomainService"><code>@DomainService</code></a>.  The one exception is <a href="#_rg_services-spi_manpage-ExceptionRecognizer"><code>ExceptionRecognizer</code></a>, which must be registered explicitly in <code>isis.properties</code>; this makes the service extensible (for new exceptions to be recognized).</p>
</div>
<div class="paragraph">
<p>There are also some "internal" SPI services whose definitions depend on the internals of the framework (rather than the applib).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We do not guarantee that <a href="http://semver.org">semantic versioning</a> will be honoured for these APIs.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 26. "Internal" SPI Services</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">SPI</th>
<th class="tableblock halign-left valign-top">Maven Module<br>
Impl&#8217;n (g: a:)</th>
<th class="tableblock halign-left valign-top">Implementation</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-spi_manpage-ContentMappingService"><code>o.a.i.v.ro.</code><br>
<code>rendering.service.conneg.</code><br>
<code>ContentMappingService</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Attempt to) map the returned data into the representation required by the client&#8217;s HTTP <code>Accept</code> header.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>No default implementation.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-spi_manpage-ContentNegotiationService"><code>o.a.i.v.ro.</code><br>
<code>rendering.service.conneg.</code><br>
<code>ContentNegotiationService</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encodes the algorithm that delegates to any registered <a href="#_rg_services-spi_manpage-ContentMappingService"><code>ContentMappingService</code></a>s.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ContentNegotiationService-</code><br>
<code>XRoDomainType</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-viewer-restfulobjects-rendering</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_services-spi_manpage-RepresentationService"><code>o.a.i.v.ro.</code><br>
<code>rendering.service.</code><br>
<code>RepresentationService</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates the representations, delegating to any registered <a href="#_rg_services-spi_manpage-ContentNegotiationService"><code>ContentNegotiationService</code></a>s.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RepresentationService-</code><br>
<code>ForRestfulObjects</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-viewer-restfulobjects-rendering</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Key:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>o.a.i.v.ro</code> is an abbreviation for <code>org.apache.isis.viewer.restfulobjects</code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_rg_services-spi_manpage-AuditingService">6.1. <code>AuditingService3</code></h3>
<div class="paragraph">
<p>The <code>AuditingService3</code> auditing service provides a simple mechanism to capture changes to data. It is called for each property that has changed on any domain object, as a set of pre- and post-values.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In case you are wondering what happened to <code>AuditingService</code> and <code>AuditingService2</code>, these were earlier versions of the SPI that have since been deprecated and removed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_spi">6.1.1. SPI</h4>
<div class="paragraph">
<p>The SPI for the service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">AuditingService3</span> {

    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="type">void</span> audit(
            <span class="directive">final</span> <span class="predefined-type">UUID</span> transactionId, <span class="predefined-type">String</span> targetClassName, <span class="directive">final</span> Bookmark target,
            <span class="predefined-type">String</span> memberIdentifier, <span class="directive">final</span> <span class="predefined-type">String</span> propertyName,
            <span class="directive">final</span> <span class="predefined-type">String</span> preValue, <span class="directive">final</span> <span class="predefined-type">String</span> postValue,
            <span class="directive">final</span> <span class="predefined-type">String</span> user, <span class="directive">final</span> java.sql.Timestamp timestamp);
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The framework will call this for each and every domain object property that is modified within a transaction.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementation">6.1.2. Implementation</h4>
<div class="paragraph">
<p>The most full-featured available implementation is the (non-ASF) <a href="http://github.com/isisaddons/isis-module-audit">Isis addons' Audit module</a>.  This creates an audit records for each changed property (ie every time that <code>AuditingService3#audit(&#8230;&#8203;)</code> is called.  The implementation is <code>org.isisaddons.module.audit.dom.AuditingService</code>.</p>
</div>
<div class="paragraph">
<p>The module also provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AuditingServiceMenu</code> service which provides actions to search for <code>AuditEntry</code>s, underneath an 'Activity' menu on the secondary menu bar.</p>
</li>
<li>
<p><code>AuditingServiceRepository</code> service to to search for persisted <code>AuditEntry``s.  None of its actions are visible in the user interface (they are all `@Programmatic</code>).</p>
</li>
<li>
<p><code>AuditingServiceContributions</code> which contrbutes collections to the <a href="#_rg_classes_mixins_manpage-HasTransactionId"> <code>HasTransactionId</code></a> interface. This will therefore display all audit entries that occurred in a given transaction, in other words whenever a command, a published event or another audit entry is displayed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you just want to debug (writing to stderr), you can instead configure <code>o.a.i.applib.services.audit.AuditingService3$Stderr</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_usage_10">6.1.3. Usage</h4>
<div class="paragraph">
<p>The typical way to indicate that an object should be audited is to annotate it with the <a href="#_rg_annotations_manpage-DomainObject_auditing"><code>@DomainObject#auditing()</code></a> annotation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_services_8">6.1.4. Registering the Services</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then adding the (non-ASF) <a href="http://github.com/isisaddons/isis-module-audit">Isis addons' audit</a> module to the classpath will automatically register the <code>AuditingService</code>, <code>AuditingServiceMenu</code>, <code>AuditingServiceRepository</code> and <code>AuditingServiceContributions</code> services.  If menu items or contributions are not required in the UI, these can be suppressed either using security or by implementing a <a href="ug.html#_ug_more-advanced_decoupling_vetoing-visibility">vetoing subscriber</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_10">6.1.5. Related Services</h4>
<div class="paragraph">
<p>The auditing service works very well with the <a href="#<em>rg_services-spi_manpage-CommandService"><code>CommandService</code></a>.  The <code>CommandService</code> captures the _cause</em> of an interaction (an action was invoked, a property was edited), while the <code>AuditingService3</code> captures the <em>effect</em> of that interaction in terms of changed state.</p>
</div>
<div class="paragraph">
<p>You may also want to configure the <a href="#_rg_services-spi_manpage-PublishingService"><code>PublishingService</code></a>.</p>
</div>
<div class="paragraph">
<p>All three of these services collaborate implicitly by way of the <a href="#_rg_classes_mixins_manpage-HasTransactionId"><code>HasTransactionId</code></a> interface.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-spi_manpage-BackgroundCommandService">6.2. <code>BackgroundCommandService</code></h3>
<div class="paragraph">
<p>The <code>BackgroundCommandService</code> (SPI) service supports the <a href="#_rg_services-api_manpage-BackgroundService"><code>BackgroundService</code></a> (API) service, persisting action invocations as commands such that they can subsequently be invoked in the background.</p>
</div>
<div class="paragraph">
<p>The <code>BackgroundService</code> is responsible for capturing a memento representing the action invocation, and then hands off to the <a href="#_rg_services-spi_manpage-BackgroundCommandService"><code>BackgroundCommandService</code></a> <code>BackgroundCommandService</code> to actually persist it.</p>
</div>
<div class="paragraph">
<p>The persisting of commands is only half the story; there needs to be a separate process to read the commands and execute them.  The abstract <a href="#_rg_services-api_manpage-BackgroundService_BackgroundCommandExecution"><code>BackgroundCommandExecution</code></a> provides a mechanism to execute such commands.  This can be considered an API, albeit "internal" because the implementation relies on internals of the framework.</p>
</div>
<div class="sect3">
<h4 id="_spi_2">6.2.1. SPI</h4>
<div class="paragraph">
<p>The SPI of the <code>BackgroundCommandService</code> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">BackgroundCommandService</span> {
    <span class="type">void</span> schedule(
            ActionInvocationMemento aim,        <i class="conum" data-value="1"></i><b>(1)</b>
            Command parentCommand,              <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="predefined-type">String</span> targetClassName,
            <span class="predefined-type">String</span> targetActionName,
            <span class="predefined-type">String</span> targetArgs);

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>is a wrapper around a <a href="#_rg_services-api_manpage-MementoService"><code>MementoService</code></a>'s <code>Memento</code>, capturing the details of the action invocation to be retained (eg persisted to a database) so that it can be executed at a later time</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>reference to the parent <code>Command</code> requesting the action be performed as a background command.  This allows information such as the initiating user to be obtained.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The API of <code>ActionInvocationMemento</code> in turn is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ActionInvocationMemento</span> {
    <span class="directive">public</span> <span class="predefined-type">String</span> getActionId() { ... }
    <span class="directive">public</span> <span class="predefined-type">String</span> getTargetClassName() { ... }
    <span class="directive">public</span> <span class="predefined-type">String</span> getTargetActionName() { ... }
    <span class="directive">public</span> Bookmark getTarget() { ... }
    <span class="directive">public</span> <span class="type">int</span> getNumArgs() { ... }
    <span class="directive">public</span> <span class="predefined-type">Class</span>&lt;?&gt; getArgType(<span class="type">int</span> num) <span class="directive">throws</span> <span class="exception">ClassNotFoundException</span> { ... }
    <span class="directive">public</span> &lt;T&gt; T getArg(<span class="type">int</span> num, <span class="predefined-type">Class</span>&lt;T&gt; type) { ... }

    <span class="directive">public</span> <span class="predefined-type">String</span> asMementoString() { ... }     <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>lets the <code>BackgroundCommandService</code> implementation convert the action invocation into a simple string.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="__internal_spi">6.2.2. "Internal" SPI</h4>
<div class="paragraph">
<p>The <code>BackgroundCommandExecution</code> (in isis-core) is an abstract template class for  <a href="ug.html#_ug_headless-access_AbstractIsisSessionTemplate">headless access</a>, that defines an abstract hook method to obtain background `Command`s to be executed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">BackgroundCommandExecution</span>
                         <span class="directive">extends</span> AbstractIsisSessionTemplate {
    ...
    protected <span class="directive">abstract</span> <span class="predefined-type">List</span>&lt;? <span class="directive">extends</span> Command&gt; findBackgroundCommandsToExecute();
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The developer is required to implement this hook method in a subclass.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_2">6.2.3. Implementation</h4>
<div class="paragraph">
<p>The (non-ASF) <a href="http://github.com/isisaddons/isis-module-command">Isis addons' command</a> module provides an implementation (<code>org.isisaddons.module.command.dom.BackgroundCommandServiceJdo</code>) that persists <code>Command</code>s using the JDO/DataNucleus object store.  It further provides a number of supporting services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.isisaddons.module.command.dom.BackgroundCommandServiceJdoRepository</code> is a repository to search for persisted background <code>Command</code>s</p>
</li>
<li>
<p><code>org.isisaddons.module.command.dom.BackgroundCommandServiceJdoContributions</code> contributes actions for searching for persisted child and sibling <code>Command</code>s.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The module also provides a concrete subclass of <code>BackgroundCommandExecution</code> that knows how to query for persisted (background) `Command`s such that they can be executed by a scheduler.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Details of setting up the Quartz scheduler to actually execute these persisted commands can be found on the <a href="#_rg_services-api_manpage-BackgroundService"><code>BackgroundService</code></a> page.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_usage_11">6.2.4. Usage</h4>
<div class="paragraph">
<p>Background commands can be created either declaratively or imperatively.</p>
</div>
<div class="paragraph">
<p>The declarative approach involves annotating an action using <a href="#_rg_annotations_manpage-Action_command"><code>@Action#command()</code></a> with <code>@Action#commandExecuteIn=CommandExecuteIn.BACKGROUND</code>.</p>
</div>
<div class="paragraph">
<p>The imperative approach involves explicitly calling the <a href="#_rg_services-api_manpage-BackgroundService"><code>BackgroundService</code></a> from within domain object&#8217;s action.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_services_9">6.2.5. Registering the Services</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then adding the (non-ASF) <a href="http://github.com/isisaddons/isis-module-command">Isis addons' command</a> module to the classpath will automatically register the <code>BackgroundCommandServiceJdo</code>, <code>BackgroundCommandJdoRepository</code> and <code>BackgroundCommandServiceJdoContributions</code> services.  If contributions are not required in the UI, these can be suppressed either using security or by implementing a <a href="ug.html#_ug_more-advanced_decoupling_vetoing-visibility">vetoing subscriber</a>.</p>
</div>
<div class="paragraph">
<p>Note that this module also provides service implementations of the <a href="#_rg_services-spi_manpage-CommandService"><code>CommandService</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_11">6.2.6. Related Services</h4>
<div class="paragraph">
<p>As discussed above, this service supports the <a href="#_rg_services-api_manpage-BackgroundService"><code>BackgroundService</code></a> , persisting `Command`s such that they can be executed in the background.</p>
</div>
<div class="paragraph">
<p>There is also a tie-up with the <a href="#_rg_services-api_manpage-CommandContext"><code>CommandContext</code></a> and its supporting <a href="#_rg_services-spi_manpage-CommandService"><code>CommandService</code></a> domain service. The <code>CommandContext</code> service is responsible for providing a parent <code>Command</code> with which the background <code>Command`s can then be associated as children, while the `CommandService</code> is responsible for persisting those parent <code>Command`s (analogous to the way in which the `BackgroundCommandService</code> persists the child background <code>Command`s). The `BackgroundCommandService</code> ensures that these background <code>Command`s are associated with the parent "foreground" `Command</code>.</p>
</div>
<div class="paragraph">
<p>What that means is that the implementations of <code>CommandService</code> and <code>BackgroundCommandService</code> go together, hence both implemented in the (non-ASF) <a href="http://github.com/isisaddons/isis-module-command">Isis addons' command</a> module.).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-spi_manpage-ClassDiscoveryService">6.3. <code>ClassDiscoveryService</code></h3>
<div class="paragraph">
<p>The <code>ClassDiscovery</code> service is used to automatically discover subclasses of any given type on the classpath.  The primary use case is to support "convention-over-configuration" designs that work with a minimum of configuration.</p>
</div>
<div class="paragraph">
<p>This service is used by the <a href="#_rg_classes_super_manpage-FixtureScripts"><code>FixtureScripts</code></a> service to automatically locate any <a href="#_rg_classes_super_manpage-FixtureScript"><code>FixtureScript</code></a> implementations.</p>
</div>
<div class="sect3">
<h4 id="_spi_3">6.3.1. SPI</h4>
<div class="paragraph">
<p>The SPI defined by the service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ClassDiscoveryService2</span>  {
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> T&gt;&gt; findSubTypesOfClasses(<span class="predefined-type">Class</span>&lt;T&gt; type, <span class="predefined-type">String</span> packagePrefix);
    <span class="annotation">@Deprecated</span>
    <span class="annotation">@Programmatic</span>
    &lt;T&gt; <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> T&gt;&gt; findSubTypesOfClasses(<span class="predefined-type">Class</span>&lt;T&gt; type);       <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>no longer used</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_3">6.3.2. Implementation</h4>
<div class="paragraph">
<p>Isis provides an implementation of this service, namely <code>o.a.i.applib.services.classdiscovery.ClassDiscoveryServiceUsingReflections</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This implementation is also used to discover domain services annotated with <a href="#_rg_annotations_manpage-DomainService"><code>@DomainService</code></a>.  Currently this logic uses the implementation directly, so is not pluggable.  However, the entire <code>ServicesInstaller</code></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_usage_12">6.3.3. Usage</h4>
<div class="paragraph">
<p>The usage will vary depending upon the conventions of the design.  In the case of fixture scripts, the convention is to implement scripts by subclassing <a href="#_rg_classes_super_manpage-FixtureScript"><code>FixtureScript</code></a>, and to specify the package prefix in the constructor for <a href="#_rg_classes_super_manpage-FixtureScripts"><code>FixtureScripts</code></a>.</p>
</div>
<div class="paragraph">
<p>For example, the (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a> has its fixture scripts in the <code>todoapp.fixture</code> package.  the <code>ToDoAppFixturesService</code> (its subclass of <a href="#_rg_classes_super_manpage-FixtureScripts"><code>FixtureScripts</code></a> is in the same package, so its constructor is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">todoapp.fixture</span>;
...
<span class="annotation">@DomainService</span>(nature = NatureOfService.VIEW_MENU_ONLY)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoAppFixturesService</span> <span class="directive">extends</span> FixtureScripts {
    <span class="directive">public</span> ToDoAppFixturesService() {
        <span class="local-variable">super</span>(
                ToDoAppFixturesService.class.getPackage().getName(),    <i class="conum" data-value="1"></i><b>(1)</b>
                MultipleExecutionStrategy.EXECUTE);
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>specify the package prefix to search under for fixture scripts</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Other designs using this service are likely to work in a similar way, requiring some sort of scope to be specified.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_services_10">6.3.4. Registering the Services</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then Apache Isis' core implementation of <code>ClassDiscoveryService2</code> service is automatically registered and injected (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-spi_manpage-CommandService">6.4. <code>CommandService</code></h3>
<div class="paragraph">
<p>The <code>CommandService</code> service supports the <a href="#_rg_services-api_manpage-CommandContext"><code>CommandContext</code></a> service such that <code>Command</code> objects (that reify the invocation of an action on a domain object into an object) can be persisted.</p>
</div>
<div class="paragraph">
<p>Persistent `Command`s support several use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>they enable profiling of the running application (which actions are invoked then most often, what is their response time)</p>
</li>
<li>
<p>they act as a parent to any background commands that might be invoked through the <a href="#_rg_services-api_manpage-BackgroundService"><code>BackgroundService</code></a></p>
</li>
<li>
<p>if <a href="#_rg_services-spi_manpage-AuditingService">auditing</a> is configured, they provide better audit information, since the <code>Command</code> (the 'cause' of an action) can be correlated to the audit records (the "effect" of the action) by way of the <a href="#_rg_classes_mixins_manpage-HasTransactionId"><code>transactionId</code></a></p>
</li>
<li>
<p>if <a href="#_rg_services-spi_manpage-PublishingService">publishing</a> is configured, they provide better traceability as the <code>Command</code> is also correlated with any published events, again through the unique  <a href="#_rg_classes_mixins_manpage-HasTransactionId"><code>transactionId</code></a></p>
</li>
<li>
<p>the associated <a href="#_rg_annotations_manpage-Action_command"><code>@Action#command()</code></a> annotation attribute also allows action invocations to be performed in the background. In this case the act of invoking the action on an object instead returns the <code>Command</code> to the user.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The screencast below provides a run-through of the command (profiling) service, auditing service, publishing service. It also shows how commands can be run in the background either explicitly by scheduling through the background service or implicitly by way of a framework annotation.</p>
</div>
<div class="videoblock">
<div class="content">
<iframe width="560px" height="315px" src="//www.youtube.com/embed/tqXUZkPB3EI?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that this screencast shows an earlier version of the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> UI (specifically, pre 1.8.0).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_spi_4">6.4.1. SPI</h4>
<div class="paragraph">
<p>The <code>CommandService</code> service defines the following very simple API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">CommandService</span> {
    <span class="annotation">@Programmatic</span>
    Command create();
    <span class="annotation">@Programmatic</span>
    <span class="type">void</span> startTransaction(Command command, <span class="directive">final</span> <span class="predefined-type">UUID</span> transactionId);
    <span class="annotation">@Programmatic</span>
    <span class="type">void</span> complete(Command command);
    <span class="annotation">@Programmatic</span>
    <span class="type">boolean</span> persistIfPossible(Command command);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>Command</code> is defined as defined by the <a href="#_rg_services-api_manpage-CommandContext"><code>CommandContext</code></a> service.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_4">6.4.2. Implementation</h4>
<div class="paragraph">
<p>The (non-ASF) <a href="http://github.com/isisaddons/isis-module-command">Isis addons' command</a> module provides an implementation (<code>org.isisaddons.module.command.dom.CommandServiceJdo</code>) that persists <code>Command</code>s using the JDO/DataNucleus object store.  It further provides a number of supporting services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.isisaddons.module.command.dom.CommandServiceJdoRepository</code> is a repository to search for persisted <code>Command</code>s</p>
</li>
<li>
<p><code>org.isisaddons.module.command.dom.CommandServiceJdoContributions</code> contributes actions for searching for persisted child and sibling <code>Command</code>s.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_usage_13">6.4.3. Usage</h4>
<div class="paragraph">
<p>The typical way to indicate that an action should be reified into a <code>Command</code> is by annotating the action using <a href="#_rg_annotations_manpage-Action_command"><code>@Action#command()</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_services_11">6.4.4. Registering the Services</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then adding the (non-ASF) <a href="http://github.com/isisaddons/isis-module-command">Isis addons' command</a> module to the classpath will automatically register the <code>CommandServiceJdo</code>, <code>CommandJdoRepository</code> and <code>CommandServiceJdoContributions</code> services.  If contributions are not required in the UI, these can be suppressed either using security or by implementing a <a href="ug.html#_ug_more-advanced_decoupling_vetoing-visibility">vetoing subscriber</a>.</p>
</div>
<div class="paragraph">
<p>Note that this module also provides service implementations of the <a href="#_rg_services-spi_manpage-BackgroundCommandService"><code>BackgroundCommandService</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_12">6.4.5. Related Services</h4>
<div class="paragraph">
<p>As discussed above, this service supports the <a href="#_rg_services-api_manpage-CommandContext"><code>CommandContext</code></a>, providing the ability for <code>Command</code> objects to be
persisted. This is closely related to the <a href="#_rg_services-spi_manpage-BackgroundCommandService"><code>BackgroundCommandService</code></a>that allows the <a href="#_rg_services-api_manpage-BackgroundService"><code>BackgroundService</code></a> to schedule commands for background/asynchronous execution.</p>
</div>
<div class="paragraph">
<p>The implementations of <code>CommandService</code> and <code>BackgroundCommandService</code> are intended to go together, so that persistent parent `Command`s can be associated with their child background `Command`s.</p>
</div>
<div class="paragraph">
<p>The services provided by this module combines very well with the <a href="#<em>rg_services-spi_manpage-AuditingService"><code>AuditingService</code></a>.  The <code>CommandService</code> captures the _cause</em> of an interaction (an action was invoked, a property was edited), while the <code>AuditingService3</code> captures the <em>effect</em> of that interaction in terms of changed state.</p>
</div>
<div class="paragraph">
<p>You may also want to configure the <a href="#_rg_services-spi_manpage-PublishingService"><code>PublishingService</code></a>.</p>
</div>
<div class="paragraph">
<p>All three of these services collaborate implicitly by way of the <a href="#_rg_classes_mixins_manpage-HasTransactionId"><code>HasTransactionId</code></a> interface.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-spi_manpage-ContentMappingService">6.5. <code>ContentMappingService</code></h3>
<div class="paragraph">
<p>The <code>ContentMappingService</code> supports the (default implementation of the) <a href="#_rg_services-spi_manpage-ContentNegotiationService"><code>ContentNegotiationService</code></a> allowing the <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a> to allow domain objects to be transformed into some other format as specified by the HTTP <code>Accept</code> header.</p>
</div>
<div class="paragraph">
<p>See <a href="#_rg_services-spi_manpage-ContentNegotiationService"><code>ContentNegotiationService</code></a> for further discussion.</p>
</div>
<div class="sect3">
<h4 id="_spi_5">6.5.1. SPI</h4>
<div class="paragraph">
<p>The SPI defined by this service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ContentMappingService</span> {
    <span class="annotation">@Programmatic</span>
    <span class="predefined-type">Object</span> map(<span class="predefined-type">Object</span> object,                           <i class="conum" data-value="1"></i><b>(1)</b>
               <span class="predefined-type">List</span>&lt;MediaType&gt; acceptableMediaTypes,    <i class="conum" data-value="2"></i><b>(2)</b>
               RepresentationType representationType);  <i class="conum" data-value="3"></i><b>(3)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>typically the input is a domain object (whose structure might change over time), and the output is a DTO (whose structure is guaranteed to be preserved over time)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>as per the caller&#8217;s HTTP <code>Accept</code> header</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the representation type required (as per the <a href="http://restfulobjects.org">Restful Objects spec</a>).</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is an "internal" SPI, meaning that it uses types that are not part of the Isis applib.  We do not guarantee that <a href="http://semver.org">semantic versioning</a> will be honoured for these APIs.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_implementations_2">6.5.2. Implementations</h4>
<div class="paragraph">
<p>No default implementations are provided by Apache Isis framework itself.  However, the (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a> includes a sample implementation to convert its <code>ToDoItem</code> entity into a <code>ToDoItemDto</code> (JAXB annotated and derived from an XSD).  This uses the <a href="http://orika-mapper.github.io/orika-docs/intro.html">Orika</a> mapping library.</p>
</div>
<div class="paragraph">
<p>The source code is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature = NatureOfService.DOMAIN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomContentMappingService</span> <span class="directive">implements</span> ContentMappingService {
    <span class="directive">private</span> MapperFactory mapperFactory;                                <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Programmatic</span>
    <span class="annotation">@PostConstruct</span>
    <span class="directive">public</span> <span class="type">void</span> init() {
        mapperFactory = <span class="keyword">new</span> DefaultMapperFactory.Builder().build();
        mapperFactory.registerClassMap(
                mapperFactory.classMap(ToDoItem.class, ToDoItemDto.class)   <i class="conum" data-value="2"></i><b>(2)</b>
                        .byDefault()                                        <i class="conum" data-value="3"></i><b>(3)</b>
                        .toClassMap());
        mapperFactory.registerClassMap(
                mapperFactory.classMap(Bookmark.class, OidDto.class)        <i class="conum" data-value="4"></i><b>(4)</b>
                        .field(<span class="string"><span class="delimiter">&quot;</span><span class="content">identifier</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">objectIdentifier</span><span class="delimiter">&quot;</span></span>)            <i class="conum" data-value="5"></i><b>(5)</b>
                        .byDefault() <span class="comment">// all other fields are compatible     </span><i class="conum" data-value="6"></i><b>(6)</b>
                        .toClassMap());
    }
    <span class="annotation">@Programmatic</span>
    <span class="annotation">@Override</span>                                                               <i class="conum" data-value="7"></i><b>(7)</b>
    <span class="directive">public</span> <span class="predefined-type">Object</span> map(
            <span class="directive">final</span> <span class="predefined-type">Object</span> object,
            <span class="directive">final</span> <span class="predefined-type">List</span>&lt;MediaType&gt; acceptableMediaTypes,
            <span class="directive">final</span> RepresentationType representationType) {
        <span class="keyword">if</span>(object <span class="keyword">instanceof</span> ToDoItem) {
            <span class="directive">final</span> Bookmark bookmark = bookmarkService.bookmarkFor(object);
            <span class="directive">final</span> ToDoItemDto dto =
                mapperFactory.getMapperFacade().map(object, ToDoItemDto.class); <i class="conum" data-value="8"></i><b>(8)</b>
            <span class="directive">final</span> OidDto oidDto =
                mapperFactory.getMapperFacade().map(bookmark, OidDto.class);    <i class="conum" data-value="9"></i><b>(9)</b>
            dto.setOid(oidDto);                                                 <i class="conum" data-value="10"></i><b>(10)</b>
            <span class="keyword">return</span> dto;
        }
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }

    <span class="annotation">@javax</span>.inject.Inject
    <span class="directive">private</span> BookmarkService bookmarkService;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>registry of known mappings</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>how to map <code>ToDoItem</code> to <code>ToDoItemDto</code> &#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>&#8230;&#8203; all properties have same name in both source and destination types</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>how to map <code>Bookmark</code> to <code>OidDto</code> &#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>&#8230;&#8203; this property has a different name</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>&#8230;&#8203; all other properties have same name</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>the main API to implement.  This implementation ignores the <code>acceptableMediaTypes</code> and <code>representationType</code></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>map the domain object to the DTO</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>and map its oid (by way of the <a href="#_rg_services-api_manpage-BookmarkService"><code>BookmarkService</code></a></td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>and perform some additional manual wiring (because domain objects don&#8217;t <em>know</em> their Oids).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You&#8217;ll notice that the implementation doesn&#8217;t actually use the <code>acceptableMediaTypes</code> and <code>representationType</code> parameters.  That&#8217;s because the calling <code>ContentNegotiationServiceXRoDomainType</code> will double check that the returned object is of the correct type (as defined by the <code>x-ro-domain-type</code> parameter of the HTTP <code>Accept</code> header).  Since this (example) todoapp only offers a single mapping, there&#8217;s therefore no need to for the mapping service to check further.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_13">6.5.3. Related Services</h4>
<div class="paragraph">
<p>This service is a companion to the default implementation of the <a href="#_rg_services-spi_manpage-ContentNegotiationService"><code>ContentNegotiationService</code></a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-spi_manpage-ContentNegotiationService">6.6. <code>ContentNegotiationService</code></h3>
<div class="paragraph">
<p>The <code>ContentNegotiationService</code> is a plug-in point for the <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a> so that it can generate representations according to HTTP <code>Accept</code> header of the request.  This idea is discussed in section 34.1 of the <a href="http://restfulobjects.org">Restful Objects spec</a> v1.0.</p>
</div>
<div class="paragraph">
<p>The principal motivation is to allow more flexible representations to be generated for REST clients that (perhaps through their use of a certain Javascript library, say) expect, or at least works best with, a certain style of representation.</p>
</div>
<div class="paragraph">
<p>Another use case is to support "third party" REST clients over which you have no control.  In this scenario you <em>must not</em> naively expose entities through the RO viewer, because over time those entities will inevitably evolve and change their structure.  If the entities were exposed directly then those REST clients will break.</p>
</div>
<div class="paragraph">
<p>Instead you need to create some sort of stable facade over your domain entities, one which you will preserve even if the domain entities change.  There are three ways in which you can do this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>first is to solve the problem at the domain layer by defining a regular Apache Isis <a href="ug.html#_ug_more-advanced_view-models">view model</a>.  This is then surfaced over the RO viewer. <br></p>
<div class="paragraph">
<p>If the underlying entities change, then care must be taken to ensure that structure of the view model nevertheless is unchanged.</p>
</div>
</li>
<li>
<p>a second option is to solve the problem at the persistence layer, but defining a (SQL) view in the database and then <a href="ug.html#_ug_more-advanced_mapping-rdbms-views">mapping this</a> to a (read-only) entity.  Again this is surfaced by the RO viewer. <br></p>
<div class="paragraph">
<p>If the underlying tables change (as the result of a change in their corresponding domain entities) then once more the view must be refactored so that it still presents the same structure.</p>
</div>
</li>
<li>
<p>our third option is to solve the problem at the presentation layer, using the <code>ContentNegotiationService</code> described in this section.<br></p>
<div class="paragraph">
<p>The <code>ContentNegotiationService</code> is responsible for inspecting the HTTP <code>Accept</code> header, and use this to select the correct representation to render. <br></p>
</div>
<div class="paragraph">
<p>The Apache Isis framework provides a default implementation of <code>ContentNegotiationService</code> which inspects the "x-ro-domaintype" component of the HTTP <code>Accept</code> header.  If present, this implementation will delegate to the companion <a href="#_rg_services-spi_manpage-ContentMappingService"><code>ContentMappingService</code></a> service, if configured. <br></p>
</div>
<div class="paragraph">
<p>A typical implementation of <code>ContentMappingService</code> will convert the domain object into some sort of DTO (data transfer object) as specified by the "x-ro-domaintype".  If this DTO is annotated with JAXB or Jackson mappings, then the RO viewer (courtesy of the underlying <a href="http://resteasy.jboss.org/">RestEasy</a> framework) can serialize these directly <br></p>
</div>
<div class="paragraph">
<p>What all that means is that, if the underlying entities change, we are required to update the mappings in the <code>ContentMappingService</code> to map to the same DTOs.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This diagram illustrates the three options available:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-services-spi/ContentNegotiationService/facade-choices.png"><img src="images/reference-services-spi/ContentNegotiationService/facade-choices.png" alt="facade choices" width="700px"></a>
</div>
</div>
<div class="sect3">
<h4 id="_spi_6">6.6.1. SPI</h4>
<div class="paragraph">
<p>The SPI defined by this service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ContentNegotiationService</span> {
    <span class="annotation">@Programmatic</span>
    Response.ResponseBuilder buildResponse(                     <i class="conum" data-value="1"></i><b>(1)</b>
            RepresentationService.Context2 renderContext2,
            ObjectAdapter objectAdapter);
    <span class="annotation">@Programmatic</span>
    Response.ResponseBuilder buildResponse(                     <i class="conum" data-value="2"></i><b>(2)</b>
            RepresentationService.Context2 renderContext2,
            ObjectAndProperty objectAndProperty);
    <span class="annotation">@Programmatic</span>
    Response.ResponseBuilder buildResponse(                     <i class="conum" data-value="3"></i><b>(3)</b>
            RepresentationService.Context2 renderContext2,
            ObjectAndCollection objectAndCollection);
    <span class="annotation">@Programmatic</span>
    Response.ResponseBuilder buildResponse(                     <i class="conum" data-value="4"></i><b>(4)</b>
            RepresentationService.Context2 renderContext2,
            ObjectAndAction objectAndAction);
    <span class="annotation">@Programmatic</span>
    Response.ResponseBuilder buildResponse(                     <i class="conum" data-value="5"></i><b>(5)</b>
            RepresentationService.Context2 renderContext2,
            ObjectAndActionInvocation objectAndActionInvocation);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>representation of a single object, as per section 14.4 of the RO spec, v1.0</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>representation of a single property of an object, as per section 16.4 of the RO spec v1.0</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>representation of a single collection of an object, as per section 17.5 of the RO spec v1.0</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>representation of a single action (prompt) of an object, as per section 18.2 of the RO spec v1.0</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>representation of the results of a single action invocation, as per section 19.5 of the RO spec v1.0</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>These methods provide:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <code>RepresentationService.Context2</code> which provides access to request-specific context (eg HTTP headers), session-specific context (eg authentication) and global context (eg configuration settings)</p>
</li>
<li>
<p>an object representing the information to be rendered<br></p>
<div class="paragraph">
<p>eg <code>ObjectAdapter</code>, <code>ObjectAndProperty</code>, <code>ObjectAndCollection</code> etc</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In all cases, returning <code>null</code> will result in the regular RO spec representation being returned.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is an "internal" SPI, meaning that it uses types that are not part of the Isis applib.  We do not guarantee that <a href="http://semver.org">semantic versioning</a> will be honoured for these APIs.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_5">6.6.2. Implementation</h4>
<div class="paragraph">
<p><code>ContentNegotiationServiceAbstract</code> (in <code>o.a.i.v.ro.rendering.service.conneg</code>) provides a no-op implementation of the SPI, along with supporting methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">ContentNegotiationServiceAbstract</span> <span class="directive">implements</span> ContentNegotiationService {
    ...
    protected <span class="predefined-type">Object</span> objectOf(<span class="directive">final</span> ObjectAdapter objectAdapter) { ... }
    <span class="directive">protected</span> <span class="predefined-type">Object</span> returnedObjectOf(ObjectAndActionInvocation objectAndActionInvocation) { ... }

    <span class="directive">protected</span> <span class="predefined-type">Class</span>&lt;?&gt; loadClass(<span class="predefined-type">String</span> cls) { ... }

    <span class="directive">protected</span> <span class="type">void</span> ensureJaxbAnnotated(<span class="predefined-type">Class</span>&lt;?&gt; domainType) { ... }
    <span class="directive">protected</span> <span class="type">void</span> ensureDomainObjectAssignable(
        <span class="predefined-type">String</span> xRoDomainType, <span class="predefined-type">Class</span>&lt;?&gt; domainType, <span class="predefined-type">Object</span> domainObject) { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As discussed in the introduction, the framework also provides a default implementation, <code>o.a.i.v.ro.rendering.service.conneg.ContentNegotiationServiceXRoDomainType</code>.   This handles content negotiation for two of the possible representations, object representations and for action result representations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For object representations it will handle requests with HTTP <code>Accept</code> headers of the form:</p>
<div class="ulist">
<ul>
<li>
<p><code>application/json;profile=urn:org.restfulobjects:repr-types/object;x-ro-domain-type=&#8230;&#8203;</code></p>
</li>
<li>
<p><code>application/xml;profile=urn:org.restfulobjects:repr-types/object;x-ro-domain-type=&#8230;&#8203;</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>for action result representations it will similarly handle requests with HTTP <code>Accept</code> headers of the form:</p>
<div class="ulist">
<ul>
<li>
<p><code>application/json;profile=urn:org.restfulobjects:repr-types/action-result;x-ro-domain-type=&#8230;&#8203;</code><br></p>
</li>
<li>
<p><code>application/xml;profile=urn:org.restfulobjects:repr-types/action-result;x-ro-domain-type=&#8230;&#8203;</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The value of the <code>x-ro-domain-type</code> parameter corresponds to the DTO to be mapped into by the <a href="#_rg_services-spi_manpage-ContentMappingService"><code>ContentMappingService</code></a>.</p>
</div>
<div class="paragraph">
<p>If the DTO is annotated with JAXB, then also note that the runtime type must be annotated with the JAXB <code>javax.xml.bind.annotation.XmlRootElement</code> so that RestEasy is able to unambiguously serialize it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_usage_14">6.6.3. Usage</h4>
<div class="paragraph">
<p>You can find an example of all these services in the (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a>.  This defines a <code>ToDoItemDto</code> class that is JAXB annotated (it is in fact generated from an XSD).</p>
</div>
<div class="paragraph">
<p>The example app also includes an implementation of <code>ContentMappingService</code> that maps <code>todoapp.dom.module.todoitem.ToDoItem</code> entities to <code>todoapp.dto.module.todoitem.ToDoItemDto</code> classes.</p>
</div>
<div class="paragraph">
<p>A REST client can therefore request a DTO representation of an entity by invoking</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://localhost:8080/restful/objects/TODO/0</code></pre>
</div>
</div>
<div class="paragraph">
<p>with an <code>Accept</code> header of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>application/xml;profile=urn:org.restfulobjects:repr-types/object;x-ro-domain-type=todoapp.dto.module.todoitem.ToDoItemDto</code></pre>
</div>
</div>
<div class="paragraph">
<p>will result in an XML serialization of that class:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-services-spi/ContentNegotiationService/accept-xml.png"><img src="images/reference-services-spi/ContentNegotiationService/accept-xml.png" alt="accept xml" width="700px"></a>
</div>
</div>
<div class="paragraph">
<p>while similarly hitting the same URL with an <code>Accept</code> header of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>application/json;profile=urn:org.restfulobjects:repr-types/object;x-ro-domain-type=todoapp.dto.module.todoitem.ToDoItemDto</code></pre>
</div>
</div>
<div class="paragraph">
<p>will result in the JSON serialization of that class:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-services-spi/ContentNegotiationService/accept-json.png"><img src="images/reference-services-spi/ContentNegotiationService/accept-json.png" alt="accept json" width="700px"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_3">6.6.4. Configuration</h4>
<div class="paragraph">
<p>The default <code>ContentNegotiationServiceXRoDomainType</code> implementation provides a <a href="#_rg_runtime_configuring-core">configuration property</a> which controls whether a mapped domain object is pretty-printed (formatted, indented) or not:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services.ContentNegotiationServiceXRoDomainType.prettyPrint=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the property is not set, then the default depends on the <a href="#_rg_runtime_deployment-types">deployment type</a>; production mode will disable pretty printing, while prototyping mode will enable it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_services_12">6.6.5. Registering the Services</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then Isis' default implementation of <code>ContentNegotiationService</code> service is automatically registered and injected (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_14">6.6.6. Related Services</h4>
<div class="paragraph">
<p>The default implementation of <code>ContentNegotiationService</code> delegates to <a href="#_rg_services-spi_manpage-ContentMappingService"><code>ContentMappingService</code></a> (if present) to convert domain entities into a stable form (eg DTO).</p>
</div>
<div class="paragraph">
<p>The <code>ContentNegotiationService</code> is itself called by the (default implementation of) <a href="#_rg_services-spi_manpage-RepresentationService"><code>RepresentationService</code></a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-spi_manpage-EmailNotificationService">6.7. <code>EmailNotificationService</code></h3>
<div class="paragraph">
<p>The <code>EmailNotificationService</code> supports the <a href="ug.html#_ug_wicket-viewer_features_user-registration">user registration</a> (self sign-up) features of the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> whereby a user can sign-up to access an application by providing a valid email address.</p>
</div>
<div class="paragraph">
<p>The Wicket viewer will check whether an implementation of this service (and also the <a href="#_rg_services-spi_manpage-UserRegistrationService"><code>UserRegistrationService</code></a>) is available, and if so will (unless configured not to) expose a sign-up page where the user enters their email address. A verification email is sent using this service; the email includes a link back to the running application. The user then completes the registration process (choosing a user name, password and so on) and the Wicket viewer creates an account for them (using the aforementioned <code>UserRegistrationService</code>).</p>
</div>
<div class="paragraph">
<p>The role of this service in all of this is to format and send out emails for the initial registration, or for password resets.</p>
</div>
<div class="paragraph">
<p>The default implementation of this service uses the <a href="#_rg_services-api_manpage-EmailService"><code>EmailService</code></a>, which must be configured in order for user registration to be enabled.</p>
</div>
<div class="sect3">
<h4 id="_spi_7">6.7.1. SPI</h4>
<div class="paragraph">
<p>The SPI defined by this service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">EmailNotificationService</span> <span class="directive">extends</span> <span class="predefined-type">Serializable</span> {
    <span class="annotation">@Programmatic</span>
    <span class="type">boolean</span> send(EmailRegistrationEvent ev);    <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Programmatic</span>
    <span class="type">boolean</span> send(PasswordResetEvent ev);        <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="annotation">@Programmatic</span>
    <span class="type">boolean</span> isConfigured();                     <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>sends an email to verify an email address as part of the initial user registration</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>sends an email to reset a password for an already-registered user</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>determines whether the implementation was configured and initialized correctly</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If <code>isConfigured()</code> returns false then it is <em>not</em> valid to call <code>send(&#8230;&#8203;)</code> (and doing so will result in an <code>IllegalStateException</code> being thrown.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_6">6.7.2. Implementation</h4>
<div class="paragraph">
<p>The framework provides a default implementation, <code>o.a.i.core.runtime.services.userreg.EmailNotificationServiceDefault</code> that constructs the emails to send.</p>
</div>
<div class="sect4">
<h5 id="_alternative_implementations_3">Alternative Implementations</h5>
<div class="paragraph">
<p>The text of these email templates is hard-coded as resources, in other words baked into the core jar files.  If you need to use different text then you can of course always write and register your own implementation to be used instead of Isis' default.</p>
</div>
<div class="paragraph">
<p>If you have configured an alternative email service implementation, it should process the message body as HTML.</p>
</div>
<div class="paragraph">
<p>If you wish to write an alternative implementation of this service, note that (unlike most Apache Isis domain services) the implementation is also instantiated and injected by Google Guice. This is because <code>EmailNotificationService</code> is used as part of the <a href="ug.html#_ug_wicket-viewer_features_user-registration">user registration</a> functionality and is used by Wicket pages that are accessed outside of the usual Apache Isis runtime.</p>
</div>
<div class="paragraph">
<p>This implies a couple of additional constraints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>first, implementation class should also be annotated with <code>@com.google.inject.Singleton</code></p>
</li>
<li>
<p>second, there may not be any Apache Isis session running. (If necessary, one can be created on the fly using <code>IsisContext.doInSession(&#8230;&#8203;)</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To ensure that your alternative implementation takes the place of the default implementation, register it explicitly in <code>isis.properties</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_service_12">6.7.3. Registering the Service</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then Isis' default implementation of <code>EmailNotificationService</code> service is automatically registered and injected (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_15">6.7.4. Related Services</h4>
<div class="paragraph">
<p>As noted elsewhere, the default implementation of this service uses <a href="#_rg_services-api_manpage-EmailService"><code>EmailService</code></a>.  This service has no specific configuration properties but does require that the <code>EmailService</code> has been configured.</p>
</div>
<div class="paragraph">
<p>Conversely, this service is used by (Isis' default implementation of) <a href="#_rg_services-spi_manpage-UserRegistrationService"><code>UserRegistrationService</code></a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-spi_manpage-EventSerializer">6.8. <code>EventSerializer</code></h3>
<div class="paragraph">
<p>The <code>EmailSerializer</code> service is a supporting service intended for use by (any implementation of) <a href="#_rg_services-spi_manpage-PublishingService"><code>PublishingService</code></a>.  Its responsibility is to combine the <code>EventMetadata</code> and the <code>EventPayload</code> into some serialized form (such as JSON, XML or a string) that can then be published.</p>
</div>
<div class="paragraph">
<p>See <a href="#_rg_services-spi_manpage-PublishingService"><code>PublishingService</code></a> for further discussion.</p>
</div>
<div class="sect3">
<h4 id="_spi_8">6.8.1. SPI</h4>
<div class="paragraph">
<p>The SPI defined by this service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">EventSerializer</span> {
    <span class="predefined-type">Object</span> serialize(                   <i class="conum" data-value="1"></i><b>(1)</b>
            EventMetadata metadata,     <i class="conum" data-value="2"></i><b>(2)</b>
            EventPayload payload);      <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>returns an object for maximum flexibility, which is then handed off to the <code>PublishingService</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>standard metadata about the event, such as the user, the <a href="#_rg_classes_mixins_manpage-HasTransactionId"><code>transactionId</code></a>, date/time etc</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>for published actions, will generally be an <code>EventPayloadForActionInvocation</code> (or subclass thereof); for published objects, will generally be an <code>EventPayloadForObjectChanged</code> (or subclass thereof)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It&#8217;s important to make sure that the publishing service implementation is able to handle the serialized form.  Strings are a good lowest common denominator, but in some cases a type-safe equivalent, such as a w3c DOM <code>Document</code> or JSON node might be passed instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_7">6.8.2. Implementation</h4>
<div class="paragraph">
<p>The (non-ASF) <a href="http://github.com/isisaddons/isis-module-publishing">Isis addons' publishing</a> module provides an implementation (<code>org.isisaddons.module.publishing.dom.eventserializer.RestfulObjectsSpecEventSerializer</code>) that represents the event payload using the representation defined by the <a href="http://restfulobjects.org">Restful Objects spec</a> of (transient) objects, grafting on the metadata as additional JSON nodes.</p>
</div>
<div class="paragraph">
<p>For example, this is the JSON generated on an action invocation:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-services-spi/EventSerializer/action-invocation-published-to-stderr.png"><img src="images/reference-services-spi/EventSerializer/action-invocation-published-to-stderr.png" alt="action invocation published to stderr" width="750px"></a>
</div>
<div class="title">Figure 1. JSON representation of a published action invocation</div>
</div>
<div class="paragraph">
<p>while this is the object change JSON:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-services-spi/EventSerializer/changed-object-published-to-stderr.png"><img src="images/reference-services-spi/EventSerializer/changed-object-published-to-stderr.png" alt="changed object published to stderr" width="750px"></a>
</div>
<div class="title">Figure 2. JSON representation of a published changed object</div>
</div>
<div class="paragraph">
<p>You could if you wish change the representation by registering your own implementation of this API in <code>isis.properties</code>:</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_services_13">6.8.3. Registering the Services</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then adding the (non-ASF) <a href="http://github.com/isisaddons/isis-module-publishing">Isis addons' publishing</a> module to the classpath will automatically register the <code>RestfulObjectsSpecEventSerializer</code> implementation (and also the module&#8217;s <code>PublishingService</code> implementation).</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_16">6.8.4. Related Services</h4>
<div class="paragraph">
<p>This service is intended (though not mandated) to be used by implementations of <a href="#_rg_services-spi_manpage-PublishingService"><code>PublishingService</code></a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-spi_manpage-ExceptionRecognizer">6.9. <code>ExceptionRecognizer</code></h3>
<div class="paragraph">
<p>The <code>ExceptionRecognizer</code> service provides the mechanism for both the domain programmer and also for components to be able to recognize and handle certain exceptions that may be thrown by the system.  Rather than display an obscure error to the end-user, the application can instead display a user-friendly message.</p>
</div>
<div class="paragraph">
<p>For example, the JDO/DataNucleus Objectstore provides a set of recognizers to recognize and handle SQL constraint exceptions such as uniqueness violations. These can then be rendered back to the user as expected errors, rather than fatal stacktraces.</p>
</div>
<div class="paragraph">
<p>It is also possible to provide additional implementations, registered in <code>isis.properties</code>.  Unlike other services, where any service registered in <code>isis.properties</code> replaces any default implementations, in the case of this service all implementations registered are "consulted" to see if they recognize an exception (the chain-of-responsibility pattern).</p>
</div>
<div class="sect3">
<h4 id="_spi_9">6.9.1. SPI</h4>
<div class="paragraph">
<p>The SPI defined by this service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ExceptionRecognizer2</span> ... {
    <span class="directive">public</span> <span class="type">enum</span> Category {                          <i class="conum" data-value="1"></i><b>(1)</b>
        ...
    }
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">Recognition</span> {               <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="directive">private</span> Category category;
        <span class="directive">private</span> <span class="predefined-type">String</span> reason;
        ...
    }
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> Recognition recognize2(<span class="predefined-type">Throwable</span> ex);    <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="annotation">@Deprecated</span>
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> recognize(<span class="predefined-type">Throwable</span> ex);          <i class="conum" data-value="4"></i><b>(4)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>an enumeration of varies categories of exceptions that are recognised</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>represents the fact that an exception has been recognized as has been converted into a user-friendy message, and has been categorized</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the main API, to attempt to recognize an exception</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>deprecated API which converted exceptions into strings (reasons), ie without any categorization.  This is no longer called.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The categories are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ExceptionRecognizer2</span> ... {
    <span class="directive">public</span> <span class="type">enum</span> Category {
        CONSTRAINT_VIOLATION,           <i class="conum" data-value="1"></i><b>(1)</b>
        NOT_FOUND,                      <i class="conum" data-value="2"></i><b>(2)</b>
        CONCURRENCY,                    <i class="conum" data-value="3"></i><b>(3)</b>
        CLIENT_ERROR,                   <i class="conum" data-value="4"></i><b>(4)</b>
        SERVER_ERROR,                   <i class="conum" data-value="5"></i><b>(5)</b>
        OTHER                           <i class="conum" data-value="6"></i><b>(6)</b>
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a violation of some declarative constraint (eg uniqueness or referential integrity) was detected.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the object to be acted upon cannot be found (404)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>a concurrency exception, in other words some other user has changed this object.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>recognized, but for some other reason&#8230;&#8203; 40x error</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>50x error</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>recognized, but uncategorized (typically: a recognizer of the original <code>ExceptionRecognizer</code> API).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In essence, if an exception is recognized then it is also categorized.  This lets the viewer act accordingly.  For example, if an exception is raised from the loading of an individual object, then this is passed by the registered <code>ExceptionRecognizer</code>s. If any of these recognize the exception as representing a not-found exception, then an Apache Isis <code>ObjectNotFoundException</code> is raised. Both the viewers interprets this correctly (the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> as a suitable error page, the <a href="ug.html#_ug_restfulobjects-viewer">Restful Objects viewer</a> as a 404 status return code).</p>
</div>
<div class="paragraph">
<p>If the implementation recognizes the exception then it returns a user-friendly message to be rendered (by the viewer) back to the user; otherwise it returns <code>null</code>. There is no need for the implementation to check for exception causes; the casual chain is unwrapped by Apache Isis core and each exception in the chain will also be passed through to the recognizer (from most specific to least). The recognizer implementation can therefore be as fine-grained or as coarse-grained as it wishes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_8">6.9.2. Implementation</h4>
<div class="paragraph">
<p>The framework provides two default implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>o.a.i.core.metamodel.services.container.DomainObjectContainerDefault</code> provided by Apache Isis core is itself an <code>ExceptionRecognizer</code>, and will handle <code>ConcurrencyException</code>s.  It will also handle any application exceptions raised by the system (subclasses of <code>o.a.i.applib.RecoverableException</code>).</p>
</li>
<li>
<p><code>o.a.i.objectstore.jdo.applib.service.exceprecog.ExceptionRecognizerCompositeForJdoObjectStore</code> bundles up a number of more fine-grained implementations:</p>
<div class="ulist">
<ul>
<li>
<p><code>ExceptionRecognizerForSQLIntegrityConstraintViolationUniqueOrIndexException</code></p>
</li>
<li>
<p><code>ExceptionRecognizerForJDOObjectNotFoundException</code></p>
</li>
<li>
<p><code>ExceptionRecognizerForJDODataStoreException</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you want to recognize and handle additional exceptions (for example to capture error messages specific to the JDBC driver you might be using), then create a fine-grained implementation of <code>ExceptionRecognizer2</code> for the particular error message (there are some convenience implementations of the interface that you can subclass from if required) and register in <code>isis.properties</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_services_14">6.9.3. Registering the Services</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then the default implementations provided by the framework (<code>DomainObjectContainerDefault</code> and <code>ExceptionRecognizerCompositeForJdoObjectStore</code>) will be registered.</p>
</div>
<div class="paragraph">
<p>In addition, you can register any further exception recognizers in <code>isis.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services=...,\
              com.mycompany.myapp.MyExceptionRecognizer,\
              ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Prior to 1.9.0, the <code>ExceptionRecognizerCompositeForJdoObjectStore</code> also required manual registration.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the JDO exception recognizers are not required (rather unlikely), then they can be disabled en-masse using the <a href="#_rg_runtime_configuring-core">configuration property</a> <code>isis.services.ExceptionRecognizerCompositeForJdoObjectStore.disable</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-spi_manpage-FixtureScriptsSpecificationProvider">6.10. <code>FixtureScriptsSpecificationProvider</code></h3>
<div class="paragraph">
<p>The <code>FixtureScriptsSpecificationProvider</code> configures the <a href="#_rg_services-api_manpage-FixtureScriptsDefault"><code>FixtureScriptsDefault</code></a> domain service, providing the location to search for fixture scripts and other settings.</p>
</div>
<div class="paragraph">
<p>The service is only used if the <code>FixtureScriptsDefault</code> service is instantiated as a fallback by the framework.  If the application provides its own subclass of <a href="#_rg_classes_utility_manpage-FixtureScripts"><code>FixtureScripts</code></a> superclass, then this provider service is not used.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Of the two designs, we encourage you to implement this "provider" SPI rather than subclass <code>FixtureScripts</code>.  The primary benefit (apart from decoupling responsibilities) is that it ensures that there is always an instance of <code>FixtureScripts</code> available for use.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_spi_10">6.10.1. SPI</h4>
<div class="paragraph">
<p>The SPI defined by the service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">FixtureScriptsSpecificationProvider</span> {
    <span class="annotation">@Programmatic</span>
    FixtureScriptsSpecification getSpecification();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>FixtureScriptsSpecification</code> exposes these values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">FixtureScriptsSpecification</span> {
    <span class="directive">public</span> <span class="predefined-type">String</span> getPackagePrefix() { ... }
    <span class="directive">public</span> FixtureScripts.NonPersistedObjectsStrategy getNonPersistedObjectsStrategy() { ... }
    <span class="directive">public</span> FixtureScripts.MultipleExecutionStrategy getMultipleExecutionStrategy() { ... }
    <span class="directive">public</span> <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> FixtureScript&gt; getRunScriptDefaultScriptClass() { ... }
    <span class="directive">public</span> DropDownPolicy getRunScriptDropDownPolicy() { ... }
    <span class="directive">public</span> <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> FixtureScript&gt; getRecreateScriptClass() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class is immutable but it has a builder (obtained using <code>FixturescriptsSpecification.builder(&#8230;&#8203;)</code>) for a fluent API.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_9">6.10.2. Implementation</h4>
<div class="paragraph">
<p>The <a href="ug.html#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a> has a simple implementation of this service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(nature = NatureOfService.DOMAIN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">DomainAppFixturesProvider</span> <span class="directive">implements</span> FixtureScriptsSpecificationProvider {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> FixtureScriptsSpecification getSpecification() {
        <span class="keyword">return</span> FixtureScriptsSpecification
                .builder(DomainAppFixturesProvider.class)
                .with(FixtureScripts.MultipleExecutionStrategy.EXECUTE)
                .withRunScriptDefault(RecreateSimpleObjects.class)
                .withRunScriptDropDown(FixtureScriptsSpecification.DropDownPolicy.CHOICES)
                .withRecreate(RecreateSimpleObjects.class)
                .build();
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-spi_manpage-LocaleProvider">6.11. <code>LocaleProvider</code></h3>
<div class="paragraph">
<p>The <code>LocaleProvider</code> service is one of the services that work together to implement Apache Isis' support for i18n, being used by Isis' default implementation of <a href="#_rg_services-spi_manpage-TranslationService"><code>TranslationService</code></a>.</p>
</div>
<div class="paragraph">
<p>The role of the service itself is simply to return the <code>Locale</code> of the current user.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For the "big picture" and further details on Apache Isis' i18n support, see <a href="ug.html#_ug_more-advanced_i18n">here</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_spi_11">6.11.1. SPI</h4>
<div class="paragraph">
<p>The SPI defined by this service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">LocaleProvider</span> {
    <span class="annotation">@Programmatic</span>
    <span class="predefined-type">Locale</span> getLocale();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is notionally request-scoped, returning the <code>Locale</code> of the current user; <em>not</em> that of the server.  (Note that the implementation is not required to actually be <a href="#_rg_annotations_manpage-RequestScoped"><code>@RequestScoped</code></a>, however).</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_10">6.11.2. Implementation</h4>
<div class="paragraph">
<p>Isis' <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> provides an implementation of this service (<code>LocaleProviderWicket</code>) which leverages Apache Wicket APIs.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Currently there is no equivalent implementation for the <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_services_15">6.11.3. Registering the Services</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>and that the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> is being used then an implementation of <code>LocaleProvider</code> is automatically registered and injected (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_17">6.11.4. Related Services</h4>
<div class="paragraph">
<p>This service works in conjunction with <a href="#_rg_services-spi_manpage-TranslationService"><code>TranslationService</code></a> and <a href="#_rg_services-spi_manpage-TranslationsResolver"><code>TranslationsResolver</code></a> in order to provide i18n support.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-spi_manpage-PublishingService">6.12. <code>PublishingService</code></h3>
<div class="paragraph">
<p>The <code>PublishingService</code> is intended for coarse-grained publish/subscribe for system-to-system interactions, from Apache Isis to some other system.  Here the only events published are those that action invocations and of changed objects.  A typical use case is to publish onto a pub/sub bus such as <a href="http://activemq.apache.org/">ActiveMQ</a> with <a href="http://camel.apache.org">Camel</a> to keep other systems up to date.</p>
</div>
<div class="sect3">
<h4 id="_spi_12">6.12.1. SPI</h4>
<div class="paragraph">
<p>The SPI defined by the service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">PublishingService</span> {
    <span class="directive">public</span> <span class="type">void</span> publish(
        EventMetadata metadata,                                 <i class="conum" data-value="1"></i><b>(1)</b>
        EventPayload payload);                                  <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="annotation">@Deprecated</span>
    <span class="annotation">@Programmatic</span>
    <span class="type">void</span> setEventSerializer(EventSerializer eventSerializer);   <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>standard metadata about the event, such as the user, the <a href="#_rg_classes_mixins_manpage-HasTransactionId"><code>transactionId</code></a>, date/time etc</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>for published actions, an <code>EventPayloadForActionInvocation</code> (or subclass thereof); for published objects, an <code>EventPayloadForObjectChanged</code> (or subclass thereof)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>injects in the <a href="#_rg_services-spi_manpage-EventSerializer"><code>EventSerializer</code></a> service.  This is deprecated because not every implementation is required to use an <code>EventSerializer</code> so its inclusion within the SPI of <code>PublishingService</code> was in retrospect a mistake.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Typically implementations will use the injected <code>EventSerializer</code> to convert the metadata and payload into a form to be published:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">EventSerializer</span> {
    <span class="directive">public</span> <span class="predefined-type">Object</span> serialize(EventMetadata metadata, EventPayload payload);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The serialized form returned by <code>EventSerializer</code> must be in a form that the <code>PublishingService</code> implementation is able to handle. Strings are a good lowest common denominator, but (if custom implementations of both <code>EventSerializer</code> and <code>PublishingService</code> were in use) then it might also be some other type, for example an <code>org.w3c.dom.Document</code> or an <code>org.json.JSONObject</code> might be returned instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_11">6.12.2. Implementation</h4>
<div class="paragraph">
<p>The (non-ASF) <a href="http://github.com/isisaddons/isis-module-publishing">Isis addons' publishing</a> module provides an implementation (<code>org.isisaddons.module.publishing.dom.org.apache.isis.applib.services.publish</code>) that persists each event as a <code>PublishedEvent</code> entity.  This holds the serialized form of the event metadata and payload as translated into a string by the injected <code>EventSerializer</code>.  The module also provides its own implementation of <code>EventSerializer</code>, namely <code>RestfulObjectsSpecEventSerializer</code>, which represents the event payload using the representation defined by the <a href="http://restfulobjects.org">Restful Objects spec</a> of (transient) objects, grafting on the metadata as additional JSON nodes.</p>
</div>
<div class="paragraph">
<p>The <code>PublishedEvent</code> entity also has a <code>state</code> field taking the values either "QUEUED" or "PROCESSED".  The intention here is that an event bus can poll this table to grab pending events and dispatch them to downstream systems.  When <code>PublishedEvent</code>s are persisted initially they always take the value "QUEUED".</p>
</div>
</div>
<div class="sect3">
<h4 id="_usage_15">6.12.3. Usage</h4>
<div class="paragraph">
<p>To indicate that an action invocation should be published, annotate it with the <a href="#_rg_annotations_manpage-Action_publishing"><code>@Action#publishing()</code></a> annotation.</p>
</div>
<div class="paragraph">
<p>To indicate that a changed object should be published is to annotate it with the <a href="#_rg_annotations_manpage-DomainObject_publishing"><code>@DomainObject#publishing()</code></a> annotation.</p>
</div>
<div class="paragraph">
<p>It is also possible to "fine-tune" the <code>EventPayload</code> using the <code>#publishingFactory()</code> attribute (for both annotations).  By default the <code>EventPayload</code> that is serialized identifies the object(s) being interacted with or changed, and in the case of the action invocation provides details of the action arguments and result (if any) of that action.  However, the payload does not (by default) include any information about the new state of these objects. It is therefore the responsibility of the subscriber to call back to Apache Isis to determine any information that has not been published.</p>
</div>
<div class="paragraph">
<p>Although the representations (if using the Restful Object serializer and Restful Objects viewer) does include hrefs for the objects, this nevertheless requires an additional network call to obtain this information).</p>
</div>
<div class="paragraph">
<p>In some circumstances, then, it may make more sense to eagerly "push" information about the change to the subscriber by including that state within the payload.</p>
</div>
<div class="paragraph">
<p>To accomplish this, an implementation of a &#8220;PayloadFactory&#8221; must be specified in the annotation.</p>
</div>
<div class="paragraph">
<p>For actions, we implement the <code>PublishingPayloadFactoryForAction</code> (in <code>o.a.i.applib.annotation</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">PublishingPayloadFactoryForAction</span> {
    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> EventPayload payloadFor(
            Identifier actionIdentifier,
            <span class="predefined-type">Object</span> target,
            <span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span>&gt; arguments,
            <span class="predefined-type">Object</span> result);
}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>EventPayloadForActionInvocation</code> abstract class (in the Isis applib) should be used as the base class for the object instance returned from <code>payLoadFor(&#8230;&#8203;)</code>.</p>
</div>
<div class="paragraph">
<p>For objects, the interface to implement is <code>PublishingPayloadFactoryForObject</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">PublishingPayloadFactoryForObject</span> {

    <span class="annotation">@Programmatic</span>
    <span class="directive">public</span> EventPayload payloadFor(
        <span class="predefined-type">Object</span> changedObject,
        PublishingChangeKind publishingChangeKind);     <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>an enum taking the values <code>CREATE</code>, <code>UPDATE</code>, <code>DELETE</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Similarly, the <code>EventPayloadForObjectChanged</code> abstract class should be used as the base class for the object returned from <code>payLoadFor(&#8230;&#8203;)</code>.</p>
</div>
<div class="paragraph">
<p>For example, the following will eagerly include a <code>ToDoItem&#8217;s `description</code> property whenever it is changed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObject</span>(publishingPayloadFactory=ToDoItemPayloadFactory.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>ToDoItemPayloadFactory</code> is defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItemChangedPayloadFactory</span> <span class="directive">implements</span> PublishingPayloadFactoryForObject {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">ToDoItemPayload</span>
        <span class="directive">extends</span> EventPayloadForObjectChanged&lt;ToDoItem&gt; {
      <span class="directive">public</span> ToDoItemPayload(ToDoItem changed) { <span class="local-variable">super</span>(changed); }
      <span class="directive">public</span> <span class="predefined-type">String</span> getDescription() { <span class="keyword">return</span> getChanged().getDescription(); }
    }
    <span class="annotation">@Override</span>
    <span class="directive">public</span> EventPayload payloadFor(<span class="predefined-type">Object</span> changedObject, PublishingChangeKind kind) {
        <span class="keyword">return</span> <span class="keyword">new</span> ToDoItemPayload((ToDoItem) changedObject);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_services_16">6.12.4. Registering the Services</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then adding the (non-ASF) <a href="http://github.com/isisaddons/isis-module-publishing">Isis addons' publishing</a> module to the classpath will automatically register the <code>PublishingService</code> implementation (and also the module&#8217;s <code>RestfulObjectsSpecEventSerializer</code> implementation).</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_18">6.12.5. Related Services</h4>
<div class="paragraph">
<p>The <code>PublishingService</code> is intended for coarse-grained publish/subscribe for system-to-system interactions, from Apache Isis to some other system. Here the only events published are those that action invocations (for actions annotated with <a href="#_rg_annotations_manpage-Action_publishing"><code>@Action#publishing()</code></a>) and of changed objects (for objects annotated with <a href="#_rg_annotations_manpage-DomainObject_publishing"><code>@DomainObject#publishing()</code></a>.</p>
</div>
<div class="paragraph">
<p>The <a href="#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a> meanwhile is intended for fine-grained publish/subscribe for object-to-object interactions within an Apache Isis domain object model. The event propagation is strictly in-memory, and there are no restrictions on the object acting as the event (it need not be serializable, for example).</p>
</div>
<div class="paragraph">
<p>All three of these services collaborate implicitly by way of the <a href="#_rg_classes_mixins_manpage-HasTransactionId"><code>HasTransactionId</code></a> interface.</p>
</div>
</div>
<div class="sect3">
<h4 id="_design_notes">6.12.6. Design Notes</h4>
<div class="paragraph">
<p>The following class diagram shows how the above components fit together:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-services-spi/PublishingService/yuml.me-23db58a4.png"><img src="images/reference-services-spi/PublishingService/yuml.me-23db58a4.png" alt="yuml.me 23db58a4" width="800px"></a>
</div>
</div>
<div class="paragraph">
<p>This yuml.me diagram was generated at <a href="http://yuml.me/edit/23db58a4">yuml.me</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-spi_manpage-RepresentationService">6.13. <code>RepresentationService</code></h3>
<div class="paragraph">
<p>The <code>RepresentationService</code> is the main plug-in point for the <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a> to generate representations.</p>
</div>
<div class="paragraph">
<p>The default implementation generates representations according to the <a href="http://restfulobjects.org">Restful Objects spec</a> v1.0.  However, it also delegates to the <a href="#_rg_services-spi_manpage-ContentNegotiationService"><code>ContentNegotiationService</code></a> which provides a mechanism for altering representations according to the HTTP <code>Accept</code> header.</p>
</div>
<div class="paragraph">
<p>The principal motivation is to allow more flexible representations to be generated for REST clients that (perhaps through their use of a certain Javascript library, say) expect, or at least works best with, a certain style of representation.</p>
</div>
<div class="paragraph">
<p>In all there are three domain services that can influence the representations generated: this service, <a href="#_rg_services-spi_manpage-ContentNegotiationService"><code>ContentNegotiationService</code></a>and the <a href="#_rg_services-spi_manpage-ContentMappingService"><code>ContentMappingService</code></a>.  The diagram below shows how these collaborate:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-services-spi/RepresentationService/service-collaborations.png"><img src="images/reference-services-spi/RepresentationService/service-collaborations.png" alt="service collaborations" width="700px"></a>
</div>
</div>
<div class="paragraph">
<p>The <code>RepresentationServiceForRestfulObjects</code> is the default implementation of this service; likewise <code>ContentNegotiationServiceXRoDomainType</code> is the default implementation of the <code>ContentNegotiationService</code>.  If you inspect the source code you&#8217;ll see that the default implementation of this service&#8217;s primary responsibility is to generate the default Restful Objects representations.  Therefore, if you what you want to do is to generate a <em>different _representation then in many cases replacing either this service _or</em> the <code>ContentNegotiationService</code> will be equivalent (you&#8217;ll notice that their SPIs are very similar).</p>
</div>
<div class="sect3">
<h4 id="_spi_13">6.13.1. SPI</h4>
<div class="paragraph">
<p>The SPI defined by this service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">RepresentationService</span> {
    <span class="annotation">@Programmatic</span>
    Response objectRepresentation(                  <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="predefined-type">Context</span> rendererContext,
            ObjectAdapter objectAdapter);
    <span class="annotation">@Programmatic</span>
    Response propertyDetails(                       <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="predefined-type">Context</span> rendererContext,
            ObjectAndProperty objectAndProperty,
            MemberReprMode memberReprMode);
    <span class="annotation">@Programmatic</span>
    Response collectionDetails(                     <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="predefined-type">Context</span> rendererContext,
            ObjectAndCollection objectAndCollection,
            MemberReprMode memberReprMode);
    <span class="annotation">@Programmatic</span>
    Response actionPrompt(                          <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="predefined-type">Context</span> rendererContext,
            ObjectAndAction objectAndAction);
    <span class="annotation">@Programmatic</span>
    Response actionResult(                          <i class="conum" data-value="5"></i><b>(5)</b>
            <span class="predefined-type">Context</span> rendererContext,
            ObjectAndActionInvocation objectAndActionInvocation,
            ActionResultReprRenderer.SelfLink selfLink);
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">interface</span> <span class="class">Context</span> <span class="directive">extends</span> RendererContext {
        ObjectAdapterLinkTo getAdapterLinkTo();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>representation of a single object, as per section 14.4 of the RO spec, v1.0</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>representation of a single property of an object, as per section 16.4 of the RO spec v1.0</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>representation of a single collection of an object, as per section 17.5 of the RO spec v1.0</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>representation of a single action (prompt) of an object, as per section 18.2 of the RO spec v1.0</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>representation of the results of a single action invocation, as per section 19.5 of the RO spec v1.0</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>These methods provide:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <code>RendererContext</code> which provides access to request-specific context (eg HTTP headers), session-specific context (eg authentication) and global context (eg configuration settings)</p>
</li>
<li>
<p>an object representing the information to be rendered<br></p>
<div class="paragraph">
<p>eg <code>ObjectAdapter</code>, <code>ObjectAndProperty</code>, <code>ObjectAndCollection</code> etc</p>
</div>
</li>
<li>
<p>for members, whether the representation is in read/write mode<br></p>
<div class="paragraph">
<p>ie <code>MemberReprMode</code></p>
</div>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is an "internal" SPI, meaning that it uses types that are not part of the Isis applib.  We do not guarantee that <a href="http://semver.org">semantic versioning</a> will be honoured for these APIs.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_12">6.13.2. Implementation</h4>
<div class="paragraph">
<p>As discussed in the introduction, the framework provides a default implementation, <code>o.a.i.v.ro.rendering.service.RepresentationServiceForRestfulObjects</code>.   This delegates to <a href="#_rg_services-spi_manpage-ContentNegotiationService"><code>ContentNegotiationService</code></a> to generate an alternative representation; but if none is provided then it falls back on generating the representations as defined in the <a href="http://restfulobjects.org">Restful Objects spec</a> v1.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_services_17">6.13.3. Registering the Services</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then Isis' default implementation of <code>RepresentationService</code> service is automatically registered and injected (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_19">6.13.4. Related Services</h4>
<div class="paragraph">
<p>The default implementation delegates to <a href="#_rg_services-spi_manpage-ContentNegotiationService"><code>ContentNegotiationService</code></a>, whose default implementation may delegate in turn to <a href="#_rg_services-spi_manpage-ContentMappingService"><code>ContentMappingService</code></a> (if present).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-spi_manpage-TranslationService">6.14. <code>TranslationService</code></h3>
<div class="paragraph">
<p>The <code>TranslationService</code> is the cornerstone of Apache Isis' i18n support.  Its role is to be able to provide translated versions of the various elements within the Apache Isis metamodel (service and object classes, properties, collections, actions, action parameters) and also to translate business rule (disable/valid) messages, and exceptions.  These translations provide for both singular and plural forms.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For the "big picture" and further details on Apache Isis' i18n support, see <a href="ug.html#_ug_more-advanced_i18n">here</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_spi_14">6.14.1. SPI</h4>
<div class="paragraph">
<p>The SPI defined by this service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">TranslationService</span> {
    <span class="annotation">@Programmatic</span>
    <span class="predefined-type">String</span> translate(<span class="predefined-type">String</span> context, <span class="predefined-type">String</span> text);      <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Programmatic</span>
    <span class="predefined-type">String</span> translate(<span class="predefined-type">String</span> context,                    <i class="conum" data-value="2"></i><b>(2)</b>
                     <span class="predefined-type">String</span> singularText,
                     <span class="predefined-type">String</span> pluralText, <span class="type">int</span> num);

    <span class="type">enum</span> Mode { READ, WRITE;}
    <span class="annotation">@Programmatic</span>
    Mode getMode();                                     <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>translate the text, in the locale of the "current user".</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>return a translation of either the singular or the plural text, dependent on the <code>num</code> parameter, in the locale of the "current user"</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>whether this implementation is operating in read or in write mode.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If in read mode, then the translations are expected to be present.</p>
</div>
<div class="paragraph">
<p>If in write mode, then the implementation is saving translation keys, and will always return the untranslated translation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_13">6.14.2. Implementation</h4>
<div class="paragraph">
<p>The Apache Isis framework provides a default implementation (<code>TranslationServicePo</code>) that uses the GNU <code>.pot</code> and <code>.po</code> files for translations.  It relies on the <code>LocaleProvider</code> service (to return the <code>Locale</code> of the current user) and also the <code>TranslationsResolver</code> service (to read existing translations).</p>
</div>
<div class="paragraph">
<p>The framework also provides a supporting <code>TranslationServicePoMenu</code> provides menu items under the "Prototyping" secondary menu for controlling this service and downloading <code>.pot</code> files for translation.</p>
</div>
<div class="paragraph">
<p>For more details on the implementation, see <a href="ug.html#_ug_more-advanced_i18n">i18n support</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_services_18">6.14.3. Registering the Services</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then Apache Isis' core implementation of <code>TranslationService</code> service (along with the supporting menu service) are automatically registered and injected (it is annotated with <code>@DomainService</code>) so no further configuration is required.  If the menu items are not required then these can be suppressed either using security or by implementing a <a href="ug.html#_ug_more-advanced_decoupling_vetoing-visibility">vetoing subscriber</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_20">6.14.4. Related Services</h4>
<div class="paragraph">
<p>This service works in conjunction with <a href="#_rg_services-spi_manpage-LocaleProvider"><code>LocaleProvider</code></a> and <a href="#_rg_services-spi_manpage-TranslationsResolver"><code>TranslationsResolver</code></a> in order to provide i18n support.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-spi_manpage-TranslationsResolver">6.15. <code>TranslationsResolver</code></h3>
<div class="paragraph">
<p>The <code>TranslationsResolver</code> service is one of the services that work together to implement Apache Isis' support for i18n, being used by Isis' default implementation of <a href="#_rg_services-spi_manpage-TranslationService"><code>TranslationService</code></a>.</p>
</div>
<div class="paragraph">
<p>The role of the service itself is locate and return translations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For the "big picture" and further details on Apache Isis' i18n support, see <a href="ug.html#_ug_more-advanced_i18n">here</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_spi_15">6.15.1. SPI</h4>
<div class="paragraph">
<p>The SPI defined by this service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">TranslationsResolver</span> {
    <span class="annotation">@Programmatic</span>
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; readLines(<span class="directive">final</span> <span class="predefined-type">String</span> file);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_14">6.15.2. Implementation</h4>
<div class="paragraph">
<p>Isis' <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> provides an implementation of this service (<code>TranslationsResolverWicket</code>) which leverages Apache Wicket APIs.  This searches for translation files in the standard <code>WEB-INF/</code> directory.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Currently there is no equivalent implementation for the <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_service_13">6.15.3. Registering the Service</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>and that the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> is being used then an implementation of <code>TranslationsResolver</code> is automatically registered and injected (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_21">6.15.4. Related Services</h4>
<div class="paragraph">
<p>This service works in conjunction with <a href="#_rg_services-spi_manpage-LocaleProvider"><code>LocaleProvider</code></a> and <a href="#_rg_services-spi_manpage-TranslationService"><code>TranslationService</code></a> in order to provide i18n support.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-spi_manpage-UserProfileService">6.16. <code>UserProfileService</code></h3>
<div class="paragraph">
<p>The <code>UserProfileService</code> provides the ability for the domain application to return supplementary metadata about the current user. This information is used (by the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a>) to customize the appearance of the tertiary "Me" menu bar (top right). For example, rather than display the username, instead the user&#8217;s first and last name could be displayed.</p>
</div>
<div class="paragraph">
<p>Another use case is to allow the user to switch context in some fashion or other. This might be to emulate a sort of "sudo"-like function, or perhaps to focus on some particular set of data.</p>
</div>
<div class="sect3">
<h4 id="_spi_16">6.16.1. SPI</h4>
<div class="paragraph">
<p>The SPI defined by the service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserProfileService</span> {
    <span class="annotation">@Programmatic</span>
    <span class="predefined-type">String</span> userProfileName();       <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>is used (in the Wicket viewer) as the menu name of the tertiary "Me" menu bar.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the method returns <code>null</code> or throws an exception then the framework will default to using the current user name.</p>
</div>
<div class="paragraph">
<p>In the future this API may be expanded; one obvious possibility is to return a profile photo or avatar URL.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_15">6.16.2. Implementation</h4>
<div class="paragraph">
<p>The (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a> has a simple implementation of this service:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-services-spi/UserProfileService/todoapp.png"><img src="images/reference-services-spi/UserProfileService/todoapp.png" alt="todoapp" width="800px"></a>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Currently this feature is not integrated with Apache Isis' authentication mechanisms; the information provided is purely metadata provided for presentation purposes only.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_services-spi_manpage-UserRegistrationService">6.17. <code>UserRegistrationService</code></h3>
<div class="paragraph">
<p>The <code>UserRegistrationService</code> provides the ability for users to sign-up to access an application by providing a valid email address, and also provides the capability for users to reset their password if forgotten.</p>
</div>
<div class="paragraph">
<p>For user sign-up, the <a href="ug.html#<em>ug_wicket-viewer">Wicket viewer</a> will check whether an implementation of this service (and also the <a href="#_rg_services-spi_manpage-EmailNotificationService"><code>EmailNotificationService</code></a>) is available, and if so will render a sign-up page where the user enters their email address. A verification email is sent (using the aforementioned <code>EmailNotificationService</code>) which includes a link back to the running application; this allows the user then to complete their registration process (choose user name, password and so on). When the user has provided the additional details, the Wicket viewer calls _this</em> service in order to create an account for them, and then logs the user on.</p>
</div>
<div class="paragraph">
<p>For the password reset feature, the Wicket viewer will render a password reset page, and use the <code>EmailNotificationService</code> to send a "password forgotten" email.  This service provides the ability to reset a password based on the user&#8217;s email address.</p>
</div>
<div class="paragraph">
<p>It is of course possible for domain objects to use this service; it will be injected into domain object or other domain services in the usual way. That said, we expect that such use cases will be comparatively rare; the primary use case is for the Wicket viewer&#8217;s sign-up page.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For further details on the user registration feature (as supported by the Wicket viewer), see <a href="ug.html#_ug_wicket-viewer_features_user-registration">here</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_spi_17">6.17.1. SPI</h4>
<div class="paragraph">
<p>The SPI defined by the service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserRegistrationService</span> {
    <span class="annotation">@Programmatic</span>
    <span class="type">boolean</span> usernameExists(<span class="predefined-type">String</span> username);                                    <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Programmatic</span>
    <span class="type">boolean</span> emailExists(<span class="predefined-type">String</span> emailAddress);                                   <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="annotation">@Programmatic</span>
    <span class="type">void</span> registerUser(<span class="predefined-type">String</span> username, <span class="predefined-type">String</span> password, <span class="predefined-type">String</span> emailAddress);   <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="annotation">@Programmatic</span>
    <span class="type">boolean</span> updatePasswordByEmail(<span class="predefined-type">String</span> emailAddress, <span class="predefined-type">String</span> password);        <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>checks if there is already a user with the specified username</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>checks if there is already a user with the specified email address</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>creates the user, with specified password and email address. The username and email address must both be unique (not being used by an existing user)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>allows the user to reset their password</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_16">6.17.2. Implementation</h4>
<div class="paragraph">
<p>The core Apache Isis framework itself defines only an API; there is no default implementation. Rather, the implementation will depend on the security mechanism being used.</p>
</div>
<div class="paragraph">
<p>That said, if you have configured your app to use the <a href="http://github.com/isisaddons/isis-module-security">Isis addons security module</a>, then note that the security module does provide an abstract implementation (<code>SecurityModuleAppUserRegistrationServiceAbstract</code>) of the <code>UserRegistrationService</code>. You will need to extend that service and provide implementation for the two abstract methods: <code>getInitialRole()</code> and <code>getAdditionalInitialRoles()</code>.</p>
</div>
<div class="paragraph">
<p>This is needed so that the self-registered users are assigned automatically to your application role(s) and be able to use the application. Without any role such user will be able only to see/use the logout link of the application.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_services_19">6.17.3. Registering the Services</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services-installer=configuration-and-annotation</code></pre>
</div>
</div>
<div class="paragraph">
<p>then (if using the (non-ASF) <a href="http://github.com/isisaddons/isis-module-security">Isis addons' security</a> module) you will need to register your concrete implementation of <code>SecurityModuleAppUserRegistrationServiceAbstract</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_22">6.17.4. Related Services</h4>
<div class="paragraph">
<p>The most common use case is to allow users to sign-up through Apache Isis' Wicket viewer. Because the process requires email to be sent, the following services must be configured:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_rg_services-api_manpage-EmailService"><code>EmailService</code></a></p>
</li>
<li>
<p><a href="#_rg_services-spi_manpage-EmailNotificationService"><code>EmailNotificationService</code></a></p>
</li>
<li>
<p><code>UserRegistrationService</code> (this service)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>EmailService</code> in particular requires additional <a href="#_rg_runtime_configuring-core">configuration properties</a> to specify the external SMTP service.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rg_classes">7. Classes and Interfaces</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the usage of various classes and interfaces that are not otherwise associated with <a href="#_rg_services-api">domain</a> <a href="#_rg_services-spi">services</a>, <a href="#_rg_object-layout">object layout</a> or <a href="#_rg_runtime">configuration</a>.</p>
</div>
<div class="sect2">
<h3 id="_rg_classes_AppManifest-bootstrapping">7.1. <code>AppManifest</code> (bootstrapping)</h3>
<div class="paragraph">
<p>This section describes how to implement the <code>AppManifest</code> interface to bootstrap both an Apache Isis web application, and also its integration tests.</p>
</div>
<div class="sect3">
<h4 id="_api_3">7.1.1. API</h4>
<div class="paragraph">
<p>The <code>AppManifest</code> interface allows the constituent parts of an application to be defined programmatically, most specifically the packages that contain domain services and/or persistent entities.  Its API is defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">AppManifest</span> {
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Class</span>&lt;?&gt;&gt; getModules();                         <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Class</span>&lt;?&gt;&gt; getAdditionalServices();              <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> <span class="predefined-type">String</span> getAuthenticationMechanism();                 <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="directive">public</span> <span class="predefined-type">String</span> getAuthorizationMechanism();                  <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> FixtureScript&gt;&gt; getFixtures();  <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="directive">public</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>,<span class="predefined-type">String</span>&gt; getConfigurationProperties();     <i class="conum" data-value="6"></i><b>(6)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Must return a non-null list of classes, each of which representing the root of one of the modules containing services and possibly entities, which together makes up the running application.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If non-<code>null</code>, overrides the value of <code>isis.services</code> configuration property to specify a list of additional classes to be instantiated as domain services (over and above the domain services defined via <code>getModules()</code> method.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>If non-<code>null</code>, overrides the value of <code>isis.authentication</code> configuration property to specify the authentication mechanism.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If non-<code>null</code>, overrides the value of <code>isis.authorization</code> configuration property to specify the authorization mechanism.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>If non-<code>null</code>, overrides the value of <code>isis.fixtures</code> configuration property to specify a fixture script to be installed.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Overrides for any other configuration properties.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following sections describe each of these methods in a little more detail.</p>
</div>
<div class="sect4">
<h5 id="__code_getmodules_code"><code>getModules()</code></h5>
<div class="paragraph">
<p>The most significant method (the only one which must return a non-<code>null</code> value) is the <code>getModules()</code> method.  Each module is identified by a class; the framework simply uses that class' package as the root to search for domain services (annotated with <a href="#_rg_annotations_manpage-DomainService"><code>@DomainService</code></a>) and entities (annotated with <a href="#_rg_annotations_manpage-PersistenceCapable"><code>@PersistenceCapable</code></a>).  Generally there is one such module class per Maven module.</p>
</div>
<div class="paragraph">
<p>A module class for a domain module might for example be defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.mycompany.myapp.dom</span>;
<span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">MyAppDomainModule</span> {
    <span class="directive">private</span> MyAppDomainModule() {}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This tells the framework that the package and subpackages under <code>com.mycompany.myapp.dom</code> should be searched for domain services and entities.</p>
</div>
<div class="paragraph">
<p>As is perhaps apparent, the <code>getModules()</code> method replaces and overrides both the <code>isis.services.ServicesInstallerFromAnnotation.packagePrefix</code> key (usually found in the <code>isis.properties</code>  file) and also the`isis.persistor.datanucleus.RegisterEntities.packagePrefix` key (usually found in the <code>persistor_datanucleus.properties</code> file).  The value of the <code>isis.services-installer</code> configuration property is also ignored.</p>
</div>
<div class="paragraph">
<p>For example, the (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a> defines the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Class</span>&lt;?&gt;&gt; getModules() {
    <span class="keyword">return</span> <span class="predefined-type">Arrays</span>.asList(
            ToDoAppDomainModule.class,
            ToDoAppFixtureModule.class,
            ToDoAppAppModule.class,
            org.isisaddons.module.audit.AuditModule.class,
            org.isisaddons.module.command.CommandModule.class,
            org.isisaddons.module.devutils.DevUtilsModule.class,
            org.isisaddons.module.docx.DocxModule.class,
            org.isisaddons.module.publishing.PublishingModule.class,
            org.isisaddons.module.sessionlogger.SessionLoggerModule.class,
            org.isisaddons.module.settings.SettingsModule.class
    );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As can be seen, the various (non-ASF) <a href="http://isisaddons.org">Isis Addons</a> modules also each provide a module class that can be easily referenced.</p>
</div>
</div>
<div class="sect4">
<h5 id="__code_getadditionalservices_code"><code>getAdditionalServices()</code></h5>
<div class="paragraph">
<p>We normally we recommend that services are defined exclusively through <code>getModules()</code>, and that this method should therefore return an empty list.  However, there are certain use cases where the a service must be explicitly specified either because the service required does not (for whatever reason) have a <a href="#_rg_annotations_manpage-DomainService"><code>@DomainService</code></a> annotation.</p>
</div>
<div class="paragraph">
<p>For example, the (non-ASF) <a href="http://github.com/isisaddons/isis-module-security">Isis addons' security</a> module (v1.9.0) allows the policy to evaluate conflicting permissions to be specified by explicitly registering either the <code>PermissionsEvaluationServiceAllowBeatsVeto</code> domain service or the <code>PermissionsEvaluationServiceVetoBeatsAllow</code> domain service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Class</span>&lt;?&gt;&gt; getAdditionalServices() {
    <span class="keyword">return</span> <span class="predefined-type">Arrays</span>.asList(
            org.isisaddons.module.security.dom.permission.PermissionsEvaluationServiceVetoBeatsAllow.class
    );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If this method returns a non-<code>null</code> value, then it overrides the value of <code>isis.services</code> configuration property.</p>
</div>
</div>
<div class="sect4">
<h5 id="__code_getauthenticationmechanism_code"><code>getAuthenticationMechanism()</code></h5>
<div class="paragraph">
<p>If non-<code>null</code>, this method specifies the authentication mechanism to use.  The valid values are currently <code>"shiro"</code>  or <code>"bypass"</code>.  If null is returned then the value of the <code>isis.authentication</code> configuration property (in <code>isis.properties</code> file) is used instead.</p>
</div>
<div class="paragraph">
<p>See the <a href="ug.html#_ug_security">user guide</a> for further details on configuring shiro or bypass security.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This property is ignored for integration tests (which always uses the <code>"bypass"</code> mechanism).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="__code_getauthorizationmechanism_code"><code>getAuthorizationMechanism()</code></h5>
<div class="paragraph">
<p>If non-<code>null</code>, this method specifies the authorization mechanism to use.  The valid values are currently <code>"shiro"</code>  or <code>"bypass"</code>.  If null is returned then the value of the <code>isis.authorization</code> configuration property (in <code>isis.properties</code> file) is used instead.</p>
</div>
<div class="paragraph">
<p>See the <a href="ug.html#_ug_security">user guide</a> for further details on configuring shiro or bypass security.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This property is ignored for integration tests (which always uses the <code>"bypass"</code> mechanism).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="__code_getfixtures_code"><code>getFixtures()</code></h5>
<div class="paragraph">
<p>If non-<code>null</code>, this method specifies the fixture script(s) to be run on startup.  This is particularly useful when developing or demoing while using an in-memory database.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> FixtureScript&gt;&gt; getFixtures() {
    <span class="keyword">return</span> Lists.newArrayList(todoapp.fixture.demo.DemoFixture.class);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in order for fixtures to be installed it is also necessary to set the <code>isis.persistor.datanucleus.install-fixtures</code> key to <code>true</code>.  This can most easily be done using the <code>getConfigurationProperties()</code> method, discussed below.</p>
</div>
</div>
<div class="sect4">
<h5 id="__code_getconfigurationproperties_code"><code>getConfigurationProperties()</code></h5>
<div class="paragraph">
<p>This method allow arbitrary other configuration properties to be overridden.  One common use case is in conjunction with the <code>getFixtures()</code> method, discussed above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; getConfigurationProperties() {
    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; props = Maps.newHashMap();
    props.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">isis.persistor.datanucleus.install-fixtures</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>);
    <span class="keyword">return</span> props;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bootstrapping">7.1.2. Bootstrapping</h4>
<div class="paragraph">
<p>One of the primary goals of the <code>AppManifest</code> is to unify the bootstrapping of both integration tests and the webapp.  This requires that the integration tests and webapp can both reference the implementation.</p>
</div>
<div class="paragraph">
<p>We strongly recommend using a <code>myapp-app</code> Maven module to hold the implementation of the <code>AppManifest</code>.  This Maven module can then also hold dependencies which are common to both integration tests and the webapp, specifically the <code>org.apache.isis.core:isis-core-runtime</code> and the <code>org.apache.isis.core:isis-core-wrapper</code> modules.</p>
</div>
<div class="paragraph">
<p>We also strongly recommend that any application-layer domain services and view models (code that references persistent domain entities but that is not referenced back) is moved to this <code>myapp-app</code> module.  This will allow the architectural layering of the overall application to be enforced by Maven.</p>
</div>
<div class="paragraph">
<p>What then remains is to update the bootstrapping code itself.</p>
</div>
<div class="sect4">
<h5 id="_integration_tests">Integration Tests</h5>
<div class="paragraph">
<p>Bootstrapping integration tests is still performed using the <code>IsisSystemForTest.Builder</code>, but very often the bootstrapping code can be substantially simplified (compared to not using an <code>AppManifest</code>, that is).</p>
</div>
<div class="paragraph">
<p>For example, this is the bootstrapping code for the <a href="ug.html#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a> looks something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">DomainAppSystemInitializer</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> initIsft() {
        IsisSystemForTest isft = IsisSystemForTest.getElseNull();
        <span class="keyword">if</span>(isft == <span class="predefined-constant">null</span>) {
            isft = <span class="keyword">new</span> IsisSystemForTest.Builder()
                    .withLoggingAt(org.apache.log4j.Level.INFO)
                    .with(<span class="keyword">new</span> MyAppAppManifest())
                    .with(<span class="keyword">new</span> IsisConfigurationForJdoIntegTests())
                    .build()
                    .setUpSystem();
            IsisSystemForTest.set(isft);
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_webapps">Webapps</h5>
<div class="paragraph">
<p>To bootstrap an Apache Isis webapp (using the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a>), there are two choices:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>either specify the <code>AppManifest</code> by overriding the <code>IsisWicketApplication#newWicketModule()</code>, eg:<br></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">protected</span> Module newIsisWicketModule() {
    <span class="directive">final</span> Module isisDefaults = <span class="local-variable">super</span>.newIsisWicketModule();
    ...
    final Module overrides = <span class="keyword">new</span> AbstractModule() {
        <span class="annotation">@Override</span>
        <span class="directive">protected</span> <span class="type">void</span> configure() {
            ...
            bind(AppManifest.class).toInstance(<span class="keyword">new</span> MyAppAppManifest());
        }
    };
    <span class="keyword">return</span> Modules.override(isisDefaults).with(overrides);
}</code></pre>
</div>
</div>
</li>
<li>
<p>alternatively update <code>isis.properties</code>, using the <code>isis.appManifest</code> key to specify the <code>AppManifest</code> implementation, eg:<br></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.appManifest=domainapp.app.MyAppAppManifest</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first (programmatic) approach takes precedence over the second approach (configuration properties).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use the <code>org.apache.isis.WebServer</code> class to launch your application from the <a href="ug.html#_ug_deployment_cmd-line">command line</a>, then note that you can specify the <code>AppManifest</code> using the <code>-m</code> (or <code>--manifest</code>) flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">java org.apache.isis.WebServer -m com.mycompany.myapp.MyAppAppManifestWithFixtures</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_subsidiary_goals">7.1.3. Subsidiary Goals</h4>
<div class="paragraph">
<p>There are a number of subsidiary goals of the <code>AppManifest</code> class (though as of v1.9.0 these have not yet implemented):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Allow different integration tests to run with different manifests.</p>
<div class="ulist">
<ul>
<li>
<p>Normally the running application is shared (on a thread-local) between integration tests. What the framework could do is to be intelligent enough to keep track of the manifest in use for each integration test and tear down the shared state if the "next" test uses a different manifest</p>
</li>
</ul>
</div>
</li>
<li>
<p>Speed up bootstrapping by only scanning for classes annotated by <code>@DomainService</code> and <code>@PersistenceCapable</code> once.</p>
</li>
<li>
<p>Provide a programmatic way to contribute elements of <code>web.xml</code>.</p>
</li>
<li>
<p>Provide a programmatic way to configure Shiro security.</p>
</li>
<li>
<p>Anticipate the module changes forthcoming in Java 9.</p>
<div class="ulist">
<ul>
<li>
<p>Eventually we see that the <code>AppManifest</code> class acting as an "aggregator", with the list of modules will become Java 9 modules each advertising the types that they export.</p>
</li>
<li>
<p>It might even be possible for <code>AppManifest</code>s to be switched on and off dynamically (eg if Java9 is compatible with OSGi, being one of the design goals).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_classes_super">7.2. Superclasses</h3>
<div class="paragraph">
<p>This section catalogues the various convenience superclasses defined by Apache Isis.  These are listed in the table below.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 27. Convenience Superclasses</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 12%;">
<col style="width: 12%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">API</th>
<th class="tableblock halign-left valign-top">Maven Module<br>
Impl&#8217;n (g: a:)</th>
<th class="tableblock halign-left valign-top">Implementation</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_classes_super_manpage-AbstractContainedObject"><code>o.a.i.applib.</code><br>
<code>AbstractContainedObject</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o.a.i.core</code><br>
<code>isis-core-applib</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(abstract class)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_classes_super_manpage-AbstractDomainEvent"><code>o.a.i.applib.</code><br>
<code>AbstractDomainEvent</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o.a.i.core</code><br>
<code>services.eventbus</code><br>
<code>isis-core-applib</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(abstract class)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_classes_super_manpage-AbstractDomainObject"><code>o.a.i.applib.</code><br>
<code>AbstractDomainObject</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o.a.i.core</code><br>
<code>isis-core-applib</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(abstract class)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_classes_super_manpage-AbstractFactoryAndRepository"><code>o.a.i.applib.</code><br>
<code>AbstractFactoryAndRepository</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o.a.i.core</code><br>
<code>isis-core-applib</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(abstract class)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_classes_super_manpage-AbstractService"><code>o.a.i.applib.</code><br>
<code>AbstractService</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o.a.i.core</code><br>
<code>isis-core-applib</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(abstract class)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_classes_super_manpage-AbstractViewModel"><code>o.a.i.applib.</code><br>
<code>AbstractViewModel</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o.a.i.core</code><br>
<code>isis-core-applib</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(abstract class)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_classes_super_manpage-ActionDomainEvent"><code>o.a.i.applib.</code><br>
<code>ActionDomainEvent</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o.a.i.core</code><br>
<code>services.eventbus</code><br>
<code>isis-core-applib</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(abstract class)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_classes_super_manpage-CollectionDomainEvent"><code>o.a.i.applib.</code><br>
<code>CollectionDomainEvent</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o.a.i.core</code><br>
<code>services.eventbus</code><br>
<code>isis-core-applib</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(abstract class)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_classes_super_manpage-FixtureScript"><code>o.a.i.applib.</code><br>
<code>fixturescript</code><br>
<code>FixtureScript</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o.a.i.core</code><br>
<code>isis-core-applib</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(abstract class)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_classes_super_manpage-FixtureScripts"><code>o.a.i.applib.</code><br>
<code>fixturescripts</code><br>
<code>FixtureScripts</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o.a.i.core</code><br>
<code>isis-core-applib</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(abstract class)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">depends on:<br>
<code>ClassDiscoveryService</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rg_classes_super_manpage-PropertyDomainEvent"><code>o.a.i.applib.</code><br>
<code>PropertyDomainEvent</code></a></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o.a.i.core</code><br>
<code>services.eventbus</code><br>
<code>isis-core-applib</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(abstract class)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_rg_classes_super_manpage-AbstractContainedObject">7.2.1. <code>AbstractContainedObject</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_classes_super_manpage-AbstractDomainEvent">7.2.2. <code>AbstractDomainEvent</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_classes_super_manpage-AbstractDomainObject">7.2.3. <code>AbstractDomainObject</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_classes_super_manpage-AbstractFactoryAndRepository">7.2.4. <code>AbstractFactoryAndRepository</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_classes_super_manpage-AbstractService">7.2.5. <code>AbstractService</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_classes_super_manpage-AbstractViewModel">7.2.6. <code>AbstractViewModel</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_classes_super_manpage-ActionDomainEvent">7.2.7. <code>ActionDomainEvent</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_classes_super_manpage-CollectionDomainEvent">7.2.8. <code>CollectionDomainEvent</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_classes_super_manpage-FixtureScript">7.2.9. <code>FixtureScript</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_classes_super_manpage-FixtureScripts">7.2.10. <code>FixtureScripts</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - see also user guide&#8217;s <a href="ug.html#_ug_testing_fixture-scripts_api-and-usage">fixture scripts' API and usage</a>, <a href="#_rg_services-api_manpage-FixtureScriptsDefault"><code>FixtureScriptsDefault</code></a> (fallback implementation) and <a href="#_rg_services-spi_manpage-FixtureScriptsSpecificationProvider"><code>FixtureScriptsSpecificationProvider</code></a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_classes_super_manpage-PropertyDomainEvent">7.2.11. <code>PropertyDomainEvent</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_classes_value-types">7.3. Value Types</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 28. JDK Classes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Boolean</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Character</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Double</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Float</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Integer</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Long</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Short</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.String</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.math.BigDecimal</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.math.BigInteger</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.sql.Date</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.sql.Time</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.sql.Timestamp</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Date</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 29. JodaTime classes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.joda.time.DateTime</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.joda.time.LocalDateTime</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.joda.time.LocalDate</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 30. Isis Applib classes</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top"><code>o.a.i.applib.value.</code><br>
<code>Blob</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>o.a.i.applib.value.</code><br>
<code>Clob</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>o.a.i.applib.value.</code><br>
<code>Color</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>o.a.i.applib.value.</code><br>
<code>Money</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>o.a.i.applib.value.</code><br>
<code>Password</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_rg_classes_value-types_manpage-Blob">7.3.1. <code>Blob</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_classes_value-types_manpage-Clob">7.3.2. <code>Clob</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_classes_value-types_manpage-Color">7.3.3. <code>Color</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_classes_value-types_manpage-Money">7.3.4. <code>Money</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_classes_value-types_manpage-Password">7.3.5. <code>Password</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_classes_utility">7.4. Applib Utility Classes</h3>
<div class="paragraph">
<p>The <code>org.apache.isis.applib.util</code> package has a number of simple utility
classes designed to simplify the coding of some common tasks.</p>
</div>
<div class="sect3">
<h4 id="_rg_classes_utility_manpage-Enums">7.4.1. <code>Enums</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_classes_utility_manpage-ObjectContracts">7.4.2. <code>ObjectContracts</code></h4>
<div class="paragraph">
<p>The <code>ObjectContracts</code> test provides a series of methods to make it easy for your domain objects to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>implement <code>Comparable</code> (eg so can be stored in <code>java.util.SortedSet</code>s)</p>
</li>
<li>
<p>implement <code>toString()</code></p>
</li>
<li>
<p>implement <code>equals()</code></p>
</li>
<li>
<p>implement <code>hashCode()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> <span class="directive">implements</span> <span class="predefined-type">Comparable</span>&lt;ToDoItem&gt; {

    <span class="directive">public</span> <span class="type">boolean</span> isComplete() { ... }
    <span class="directive">public</span> LocalDate getDueBy() { ... }
    <span class="directive">public</span> <span class="predefined-type">String</span> getDescription() { ... }
    <span class="directive">public</span> <span class="predefined-type">String</span> getOwnedBy() { ... }

    <span class="directive">public</span> <span class="type">int</span> compareTo(<span class="directive">final</span> ToDoItem other) {
        <span class="keyword">return</span> ObjectContracts.compare(<span class="local-variable">this</span>, other, <span class="string"><span class="delimiter">&quot;</span><span class="content">complete</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">dueBy</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> toString() {
        <span class="keyword">return</span> ObjectContracts.toString(<span class="local-variable">this</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">complete</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">dueBy</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">ownedBy</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that <code>ObjectContracts</code> makes heavy use of Java Reflection.  While it&#8217;s great to get going quickly in prototyping, we recommend you use your IDE to code generate implementations of these methods for production code.</p>
</div>
<div class="paragraph">
<p>Moreover (and perhaps even more importantly) <code>ObjectContracts</code> implementation can cause DataNucleus to recursively rehydrate a larger number of associated entities (More detail below).</p>
</div>
<div class="paragraph">
<p>We therefore recommend that you disable persistence-by-reachability by adding:</p>
</div>
<div class="listingblock">
<div class="title">persistor_datanucleus.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.persistor.datanucleus.impl.datanucleus.persistenceByReachabilityAtCommit=false</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_the_issue_in_more_detail">The issue in more detail</h5>
<div class="paragraph">
<p>Consider the <a href="http://yuml.me/edit/742ad446">entities</a>:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-classes/issue-in-more-detail.png"><img src="images/reference-classes/issue-in-more-detail.png" alt="issue in more detail"></a>
</div>
</div>
<div class="paragraph">
<p>In the course of a transaction, the <code>Agreement</code> entity is loaded into memory (not necessarily modified), and then new <code>AgreementRole</code>s are associated to it.</p>
</div>
<div class="paragraph">
<p>All these entities implement <code>Comparable</code> using <code>ObjectContracts</code>, so that the implementation of <code>AgreementRole</code>'s (simplified) is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AgreementRole</span> {
    ...
    public <span class="type">int</span> compareTo(AgreementRole other) {
        <span class="keyword">return</span> ObjectContracts.compareTo(<span class="local-variable">this</span>, other, <span class="string"><span class="delimiter">&quot;</span><span class="content">agreement</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">party</span><span class="delimiter">&quot;</span></span>);
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>while <code>Agreement</code>'s is implemented as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="directive">public</span> <span class="type">class</span> <span class="class">Agreement</span> {
        ...
        public <span class="type">int</span> compareTo(Agreement other) {
            <span class="keyword">return</span> ObjectContracts.compareTo(<span class="local-variable">this</span>, other, <span class="string"><span class="delimiter">&quot;</span><span class="content">reference</span><span class="delimiter">&quot;</span></span>);
        }
        ...
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>and <code>Party</code>'s is similarly implemented as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Party</span> {
    ...
    public <span class="type">int</span> compareTo(Party other) {
        <span class="keyword">return</span> ObjectContracts.compareTo(<span class="local-variable">this</span>, other, <span class="string"><span class="delimiter">&quot;</span><span class="content">reference</span><span class="delimiter">&quot;</span></span>);
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>DataNucleus&#8217;s persistence-by-reachability algorithm adds the <code>AgreementRole</code>s into a <code>SortedSet</code>, which causes <code>AgreementRole#compareTo()</code> to fire:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the evaluation of the "agreement" property delegates back to the <code>Agreement</code>, whose own <code>Agreement#compareTo()</code> uses the scalar <code>reference</code> property.  As the <code>Agreement</code> is already in-memory, this does not trigger any further database queries</p>
</li>
<li>
<p>the evaluation of the "startDate" property is just a scalar property of the <code>AgreementRole</code>, so will already in-memory</p>
</li>
<li>
<p>the evaluation of the "party" property delegates back to the <code>Party</code>, whose own <code>Party#compareTo()</code> requires the uses the scalar <code>reference</code> property.  However, since the <code>Party</code> is not yet in-memory, using the <code>reference</code> property triggers a database query to "rehydrate" the <code>Party</code> instance.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In other words, figuring out whether <code>AgreementRole</code> is comparable requires the persistence-by-reachability algorithm to run, causing the adjacent associated entity <code>Party</code> to also be retrieved.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_classes_utility_manpage-Reasons">7.4.3. <code>Reasons</code></h4>
<div class="paragraph">
<p>There are two different classes provided to help build reasons returned
by <code>disableXxX()</code> and <code>validateXxx()</code> methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>org.apache.isis.applib.util.ReasonBuffer</code> helper class</p>
</li>
<li>
<p>the <code>org.apache.isis.applib.util.Reasons</code> helper class</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    ...
    public <span class="predefined-type">String</span> validatePlaceOrder(Product p, <span class="type">int</span> quantity) {
        <span class="keyword">return</span> Reasons.coalesce(
            whetherCustomerBlacklisted(<span class="local-variable">this</span>),
            whetherProductOutOfStock(p)
        );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which you use (if any) is up to you.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_classes_utility_manpage-TitleBuffer">7.4.4. <code>TitleBuffer</code></h4>
<div class="paragraph">
<p>The <code>TitleBuffer</code> utility class is intended to make it easy to construct title strings (returned from the <a href="#_rg_methods_reserved_manpage-title"><code>title()</code></a> method).</p>
</div>
<div class="paragraph">
<p>For example, it has overloaded versions of methods called <code>append()</code> and <code>concat()</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_classes_spec">7.5. Specification pattern</h3>
<div class="paragraph">
<p>The interfaces and classes listed in this chapter provide support for the  <code>Specification</code> pattern, as described in Eric Evans' book <em>Domain Driven Design</em>, p224.</p>
</div>
<div class="paragraph">
<p>Apache Isis will automatically apply such specifications as validation rules on properties (as per <a href="#_rg_annotations_manpage-Property_mustSatisfy"><code>@Property#mustSatisfy()</code></a>) and on action parameters (as per <a href="#_rg_annotations_manpage-Parameter_mustSatisfy"><code>@Parameter#mustSatisfy()</code></a>).</p>
</div>
<div class="sect3">
<h4 id="__code_specification_code">7.5.1. <code>Specification</code></h4>
<div class="paragraph">
<p>The heart of the support for this pattern is the <code>Specification</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Specification</span> {
    <span class="directive">public</span> <span class="predefined-type">String</span> satisfies(<span class="predefined-type">Object</span> obj);  <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>if returns <code>null</code>, then the constraint is satisfies; otherwise returns the reason why the constraint has not been satisfied.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">StartWithCapitalLetterSpecification</span> <span class="directive">implements</span> Specification {
    <span class="directive">public</span> <span class="predefined-type">String</span> satisfies(<span class="predefined-type">Object</span> proposedObj) {
        <span class="predefined-type">String</span> proposed = (<span class="predefined-type">String</span>)proposedObj;               <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>.equals(proposed)
            ? <span class="string"><span class="delimiter">&quot;</span><span class="content">Empty string</span><span class="delimiter">&quot;</span></span>
            : !<span class="predefined-type">Character</span>.isUpperCase(proposed.charAt(<span class="integer">0</span>))
                ? <span class="string"><span class="delimiter">&quot;</span><span class="content">Does not start with a capital letter</span><span class="delimiter">&quot;</span></span>
                : <span class="predefined-constant">null</span>;
    }
}
<span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@Property</span>(mustSatisfy=StartWithCapitalLetterSpecification.class)
    <span class="directive">public</span> <span class="predefined-type">String</span> getFirstName() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>this ugly cast can be avoided using some of the other classes available; see below.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="__code_specification2_code">7.5.2. <code>Specification2</code></h4>
<div class="paragraph">
<p>The <code>Specification2</code> interface extends the <code>Specification</code> API to add support for i18n.  This is done by defining an additional method that returns a <a href="#_rg_classes_i18n_manpage-TranslatableString">translatable string</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Specification2</span> <span class="directive">extends</span> Specification {
    <span class="directive">public</span> TranslatableString satisfiesTranslatable(<span class="predefined-type">Object</span> obj);  <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>if returns <code>null</code>, then the constraint is satisfies; otherwise returns the reason why the constraint has not been satisfied.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that if implementing <code>Specification2</code> then there is no need to also provide an implementation of the inherited <code>satisfies(Object)</code> method; this will never be called by the framework for <code>Specification2</code> instances.</p>
</div>
</div>
<div class="sect3">
<h4 id="_adapter_classes">7.5.3. Adapter classes</h4>
<div class="paragraph">
<p>The <code>AbstractSpecification</code> and <code>AbstractSpecification2</code> adapter classes provide a partial implementation of the respective interfaces, providing type-safety.  (Their design is modelled on the <code>TypesafeMatcher</code> class within <a href="http://hamcrest.org/JavaHamcrest/">Hamcrest</a>).</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">StartWithCapitalLetterSpecification</span> <span class="directive">extends</span> AbstractSpecification&lt;<span class="predefined-type">String</span>&gt; {
    <span class="directive">public</span> <span class="predefined-type">String</span> satisfiesSafely(<span class="predefined-type">String</span> proposed) {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>.equals(proposed)
            ? <span class="string"><span class="delimiter">&quot;</span><span class="content">Empty string</span><span class="delimiter">&quot;</span></span>
            : !<span class="predefined-type">Character</span>.isUpperCase(proposed.charAt(<span class="integer">0</span>))
                ? <span class="string"><span class="delimiter">&quot;</span><span class="content">Does not start with a capital letter</span><span class="delimiter">&quot;</span></span>
                : <span class="predefined-constant">null</span>;
    }
}
<span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@Property</span>(mustSatisfy=StartWithCapitalLetterSpecification.class)
    <span class="directive">public</span> <span class="predefined-type">String</span> getFirstName() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>AbstractSpecification2</code> class is almost identical; its type-safe method is <code>satisfiesTranslatableSafely(T)</code> instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="_combining_specifications">7.5.4. Combining specifications</h4>
<div class="paragraph">
<p>There are also adapter classes that can be inherited from to combine specifications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SpecificationAnd</code> - all provided specifications' constraints must be met</p>
</li>
<li>
<p><code>SpecificationOr</code> - at least one provided specifications' constraints must be met</p>
</li>
<li>
<p><code>SpecificationNot</code> - its constraints are met if-and-only-if the provided specification&#8217;s constraint was <em>not</em> met.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that these adapter classes inherit <code>Specification</code> but do not inherit <code>Specification2</code>; in other words they do not support i18n.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_classes_i18n">7.6. i18n support</h3>
<div class="paragraph">
<p>The <code>org.apache.isis.applib.services.i18n</code> package contains a single class to support i18n.</p>
</div>
<div class="sect3">
<h4 id="_rg_classes_i18n_manpage-TranslatableString">7.6.1. <code>TranslatableString</code></h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
TODO - see <a href="ug.html#_ug_more-advanced_i18n">user guide, i18n</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>TranslatableString</code> utility class &#8230;&#8203;</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_classes_mixins">7.7. Mixins</h3>
<div class="paragraph">
<p>The interfaces listed in this chapter act like "mix-ins"; they allow domain services to contribute actions/properties/collections to any domain objects that implement these interfaces.</p>
</div>
<div class="sect3">
<h4 id="__code_hastransactionid_code">7.7.1. <code>HasTransactionId</code></h4>
<div class="paragraph">
<p>The <code>HasTransactionId</code> interface is a mix-in for any domain objects that pertain</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">HasTransactionId</span> {

    <span class="directive">public</span> <span class="predefined-type">UUID</span> getTransactionId();                             <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="type">void</span> setTransactionId(<span class="directive">final</span> <span class="predefined-type">UUID</span> transactionId);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>unique identifier (a GUID) of the transaction in which this interaction occurred.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Modules that either have domain entity that implement and/or services that contribute this interface are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(non-ASF) <a href="http://github.com/isisaddons/isis-module-audit">Isis addons' audit</a> module (<code>AuditEntry</code> entity, <code>AuditingServiceContributions</code> service)</p>
</li>
<li>
<p>(non-ASF) <a href="http://github.com/isisaddons/isis-module-command">Isis addons' command</a> module (<code>CommandJdo</code> entity, <code>CommandServiceJdoContributions</code> service)</p>
</li>
<li>
<p>(non-ASF) <a href="http://github.com/isisaddons/isis-module-publishing">Isis addons' publishing</a> module (<code>PublishedEvent</code> entity, <code>PublishingServiceContributions</code>)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="__code_hasusername_code">7.7.2. <code>HasUsername</code></h4>
<div class="paragraph">
<p>The <code>HasUsername</code> interface is a mix-in for domain objects to be associated with a username.  Other services and modules can then contribute actions/collections to render such additional information relating to the activities of the user.</p>
</div>
<div class="paragraph">
<p>The interface is defined is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">HasUsername</span> {
    <span class="directive">public</span> <span class="predefined-type">String</span> getUsername();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Modules that either have domain entity that implement and/or services that contribute this interface are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(non-ASF) <a href="http://github.com/isisaddons/isis-module-security">Isis addons' security</a> module ( <code>ApplicationUser</code> entity, <code>HasUsernameContributions</code> service)</p>
</li>
<li>
<p>(non-ASF) <a href="http://github.com/isisaddons/isis-module-audit">Isis addons' audit</a> module (<code>AuditEntry</code> entity,</p>
</li>
<li>
<p>(non-ASF) <a href="http://github.com/isisaddons/isis-module-command">Isis addons' command</a> module&#8217;s <code>CommandJdo</code> entity, <code>HasUsernameContributions</code> service)</p>
</li>
<li>
<p>(non-ASF) <a href="http://github.com/isisaddons/isis-module-publishing">Isis addons' publishing</a> module (<code>PublishedEvent</code> entity)</p>
</li>
<li>
<p>(non-ASF) <a href="http://github.com/isisaddons/isis-module-sessionlogger">Isis addons' sessionlogger</a> module (<code>SessionLogEntry</code> entity, <code>HasUsernameContributions</code> service)</p>
</li>
<li>
<p>(non-ASF) <a href="http://github.com/isisaddons/isis-module-settings">Isis addons' settings</a> module (<code>UserSettingJdo</code> entity)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rg_object-layout">8. Object Layout</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In implementing the <a href="http://en.wikipedia.org/wiki/Naked_objects">naked objects pattern</a>, Apache Isis aims to infer as much information from the domain classes as possible.  Nevertheless, some metadata relating solely to the UI is inevitably required.</p>
</div>
<div class="paragraph">
<p>This chapter describes how this is done both for domain objects&#8201;&#8212;&#8201;statically or dynamically&#8201;&#8212;&#8201;and for the application menu bar (containing domain service' actions).</p>
</div>
<div class="sect2">
<h3 id="_rg_object-layout_static">8.1. Static Object Layout</h3>
<div class="paragraph">
<p>Metadata providing UI hints can be specified either statically, using annotations, or dynamically, using a <code>.layout.json</code> file.  This section describes the static approach, using annotations.</p>
</div>
<div class="sect3">
<h4 id="__code_memberorder_code">8.1.1. <code>@MemberOrder</code></h4>
<div class="paragraph">
<p>The <code>@MemberOrder</code> annotation is used to specify the relative order of domain class properties, collections and actions.</p>
</div>
<div class="paragraph">
<p>The annotation defines two attributes, <code>name()</code> and <code>sequence()</code>.  Their usage depends on the member type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for properties, the <code>name()</code> is used to group properties together.  The <code>sequence()</code> then orders properties within these groups. If no <code>name()</code> is specified then the property is placed in a fallback "General" group, called "General".<br></p>
<div class="paragraph">
<p>The name of these "member groups" are then referenced by <a href="#_rg_annotations_manpage-MemberGroupLayout"><code>@MemberGroupLayout</code></a>.</p>
</div>
</li>
<li>
<p>for collections, the <code>name()</code> attribute is (currently) unused.  The <code>sequence()</code> orders collections relative to one another</p>
</li>
<li>
<p>for actions, the <code>name()</code> attribute associates an action with either a property or with a collection.<br></p>
<div class="paragraph">
<p>If the <code>name()</code> attribute matches a property name, then the action&#8217;s button is rendered close to the property, according to <a href="#_rg_annotations_manpage-ActionLayout_position"><code>@ActionLayout#position()</code></a> attribute.<br></p>
</div>
<div class="paragraph">
<p>On the other hand if the `name() attribute matches a collection name, then the action&#8217;s button is rendered on the collection&#8217;s header.<br></p>
</div>
<div class="paragraph">
<p>If there is no <code>name()</code> value, then the action is considered to pertain to the object as a whole, and its button is rendered close to the object&#8217;s icon and title.</p>
</div>
<div class="paragraph">
<p>Within any of these, the <code>sequence()</code> then determines the relative ordering of the action with respect to other actions that have been similarly associated with properties/collections or left as "free-standing".</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    <span class="annotation">@MemberOrder</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getDescription() { ... }
    <span class="annotation">@MemberOrder</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getCategory() { ... }
    <span class="annotation">@MemberOrder</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">boolean</span> isComplete() { ... }
    <span class="annotation">@MemberOrder</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">Detail</span><span class="delimiter">&quot;</span></span>, sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> LocalDate getDueBy() { ... }
    <span class="annotation">@MemberOrder</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">Detail</span><span class="delimiter">&quot;</span></span>, sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> getCost() { ... }
    <span class="annotation">@MemberOrder</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">Detail</span><span class="delimiter">&quot;</span></span>, sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">4</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getNotes() { ... }
    <span class="annotation">@MemberOrder</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">Misc</span><span class="delimiter">&quot;</span></span>, sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">99</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">Long</span> getVersionSequence() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This defines three property (or member) groups, "General", "Detail" and "Misc"; "General" is the default if no <code>name</code> attribute is specified. Properties in the same member group are rendered together, as a fieldset.</p>
</div>
<div class="paragraph">
<p>In addition, actions can optionally be associated (rendered close to) either properties or actions. This is done by overloading the <code>@MemberOrder&#8217;s `name</code> attribute, holding the value of the property or collection.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    <span class="annotation">@MemberOrder</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">boolean</span> isComplete() { ... }
    <span class="annotation">@MemberOrder</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">complete</span><span class="delimiter">&quot;</span></span>, sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> ToDoItem completed() { ...}
    <span class="annotation">@MemberOrder</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">complete</span><span class="delimiter">&quot;</span></span>, sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> ToDoItem notYetCompleted() { ...}

    <span class="annotation">@MemberOrder</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">SortedSet</span>&lt;ToDoItem&gt; getDependencies() { ... }
    <span class="annotation">@MemberOrder</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">dependencies</span><span class="delimiter">&quot;</span></span>, sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> ToDoItem add(ToDoItem t) { ...}
    <span class="annotation">@MemberOrder</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">dependencies</span><span class="delimiter">&quot;</span></span>, sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> ToDoItem remove(ToDoItem t) { ...}
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will associate the <code>completed()</code> and <code>notYetCompleted()</code> actions with the <code>complete</code> property, and will associate the <code>add()</code> and <code>remove()</code> actions with the <code>dependencies</code> collection.</p>
</div>
<div class="paragraph">
<p>The value of <code>sequence()</code> is a string.  The simplest convention (as shown in the example above) is to use numbers&#8201;&#8212;&#8201;1, 2, 3&#8201;&#8212;&#8201;though it is a better idea to leave gaps in the numbers&#8201;&#8212;&#8201;10, 20, 30 perhaps&#8201;&#8212;&#8201;such that a new member may be added without having to edit existing numbers.  A useful alternative is to adopt the 'dewey-decimal' notation&#8201;&#8212;&#8201;1, 1.1, 1.2, 2, 3, 5.1.1, 5.2.2, 5.2, 5.3&#8201;&#8212;&#8201;which allows for an indefinite amount of future insertion.  It also allows subclasses to insert their class members as required.</p>
</div>
</div>
<div class="sect3">
<h4 id="__code_membergrouplayout_code">8.1.2. <code>@MemberGroupLayout</code></h4>
<div class="paragraph">
<p>The <code>@MemberGroupLayout</code> annotation specifies the relative positioning of property groups as being either in a left column, a middle column or in a right column.  The annotation also specifies the relative width of the columns.</p>
</div>
<div class="paragraph">
<p>The property groups in this case are those that are inferred from the <code>@MemberOrder#name()</code> attribute.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@MemberGroupLayout</span>(
     columnSpans={<span class="integer">3</span>,<span class="integer">3</span>,<span class="integer">0</span>,<span class="integer">6</span>},
     left={<span class="string"><span class="delimiter">&quot;</span><span class="content">General</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Misc</span><span class="delimiter">&quot;</span></span>},
     middle=<span class="string"><span class="delimiter">&quot;</span><span class="content">Detail</span><span class="delimiter">&quot;</span></span>
 )
<span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Four values are given in the <code>columnSpans</code> attribute. The first three are the relative widths of the three columns of property groups. The fourth, meanwhile, indicates the width of a final column that holds all the collections of the object.</p>
</div>
<div class="paragraph">
<p>The values of these spans are taken as proportions of 12 virtual columns across the page (this taken from the <a href="http://getbootstrap.com/2.3.2/">Bootstrap</a> library).</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>{3,3,0,6}</code> indicates:</p>
<div class="ulist">
<ul>
<li>
<p>a left column of properties taking up 25% of the width</p>
</li>
<li>
<p>a middle column of properties taking up 25% of the width</p>
</li>
<li>
<p>a right column of collections taking up 50% of the width</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>{2,6,0,4}</code> indicates:</p>
<div class="ulist">
<ul>
<li>
<p>a left column of properties taking up ~16% of the width</p>
</li>
<li>
<p>a middle column of properties taking up 50% of the width</p>
</li>
<li>
<p>a right column of collections taking up ~33% of the width</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>{2,3,3,4}</code> indicates:</p>
<div class="ulist">
<ul>
<li>
<p>a left column of properties taking up ~16% of the width</p>
</li>
<li>
<p>a middle column of properties taking up 25% of the width</p>
</li>
<li>
<p>a right column of properties taking up 25% of the width</p>
</li>
<li>
<p>a far right column of collections taking up ~33% of the width</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the sum of all the columns exceeds 12, then the collections are placed underneath the properties, taking up the full span. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>{4,4,4,12} indicates:</p>
<div class="ulist">
<ul>
<li>
<p>a left column of properties taking up ~33% of the width</p>
</li>
<li>
<p>a middle column of properties taking up ~33% of the width</p>
</li>
<li>
<p>a right column of properties taking up ~33% of the width</p>
</li>
<li>
<p>the collections underneath the property columns, taking up the full width</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_example_layouts">8.1.3. Example Layouts</h4>
<div class="paragraph">
<p>Below are sketches for the layout of the <a href="https://github.com/apache/isis/blob/f38fdb92941172eabb12e0943509f239e6d5925f/example/application/quickstart_wicket_restful_jdo/dom/src/main/java/dom/todo/ToDoItem.java">ToDoItem</a> class of the Isis addons example <a href="https://github.com/isisaddons/isis-app-todoapp/">todoapp</a> (not ASF):</p>
</div>
<div class="paragraph">
<p>The first divides the properties into two equal sized columns (6-6-0) and puts the collections underneath (12):</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-layout/6-6-0-12.png"><img src="images/reference-layout/6-6-0-12.png" alt="6 6 0 12" width="720px"></a>
</div>
</div>
<div class="paragraph">
<p>The next divides the collections into three equal sized columns (4-4-4) and again puts the collections underneath (12):</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-layout/4-4-4-12.png"><img src="images/reference-layout/4-4-4-12.png" alt="4 4 4 12" width="720px"></a>
</div>
</div>
<div class="paragraph">
<p>The last puts the properties into a single column (4-0) and places the collections into the other larger column (8-0):</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-layout/4-0-8-0.png"><img src="images/reference-layout/4-0-8-0.png" alt="4 0 8 0" width="720px"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_other_annotations">8.1.4. Other Annotations</h4>
<div class="paragraph">
<p>As of 1.8.0, all the layout annotations have been consolidated into the various <code>XxxLayout</code> annotations: <a href="#_rg_annotations_manpage-ActionLayout, "><code>@ActionLayout</code></a> <a href="#_rg_annotations_manpage-CollectionLayout"><code>@CollectionLayout</code></a>,  <a href="#_rg_annotations_manpage-DomainObjectLayout"><code>@DomainObjectLayout</code></a>,  <a href="#_rg_annotations_manpage-DomainServiceLayout"><code>@DomainServiceLayout</code></a>,  <a href="#_rg_annotations_manpage-ParameterLayout"><code>@ParameterLayout</code></a>, <a href="#_rg_annotations_manpage-PropertyLayout"><code>@PropertyLayout</code></a>, and <a href="#_rg_annotations_manpage-ViewModelLayout"><code>@ViewModelLayout</code></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_object-layout_dynamic">8.2. Dynamic Object Layout</h3>
<div class="paragraph">
<p>Metadata providing UI hints can be specified either statically, using annotations, or dynamically, using a <code>.layout.json</code> file.  This section describes the dynamic approach, using the file.</p>
</div>
<div class="sect3">
<h4 id="_json_layout_file">8.2.1. JSON layout file</h4>
<div class="paragraph">
<p>The JSON layout file for class <code>Xxx</code> takes the name <code>Xxx.layout.json</code>, and resides in the same package as the class.
The format of the file is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">columns</span><span class="delimiter">&quot;</span></span>: [                                <span class="comment">// list of columns</span>
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">span</span><span class="delimiter">&quot;</span></span>: <span class="integer">6</span>,                              <span class="comment">// span of the left-hand property column</span>
      <span class="key"><span class="delimiter">&quot;</span><span class="content">memberGroups</span><span class="delimiter">&quot;</span></span>: {                       <span class="comment">// ordered map of member (property) groups</span>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">General</span><span class="delimiter">&quot;</span></span>: {                          <span class="comment">// member group name</span>
          <span class="key"><span class="delimiter">&quot;</span><span class="content">members</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>: {                  <span class="comment">// property, no associated actions, but with UI hint</span>
              <span class="key"><span class="delimiter">&quot;</span><span class="content">propertyLayout</span><span class="delimiter">&quot;</span></span>: {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">typicalLength</span><span class="delimiter">&quot;</span></span>: <span class="integer">50</span>           <span class="comment">// UI hint for size of field (no longer used in ISIS 1.8.0)</span>
              }
            },
            <span class="key"><span class="delimiter">&quot;</span><span class="content">category</span><span class="delimiter">&quot;</span></span>: {},
            <span class="key"><span class="delimiter">&quot;</span><span class="content">complete</span><span class="delimiter">&quot;</span></span>: {                     <span class="comment">// property, with associated actions</span>
              <span class="key"><span class="delimiter">&quot;</span><span class="content">propertyLayout</span><span class="delimiter">&quot;</span></span>: {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">describedAs</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Whether this todo item has been completed</span><span class="delimiter">&quot;</span></span>
              },
              <span class="key"><span class="delimiter">&quot;</span><span class="content">actions</span><span class="delimiter">&quot;</span></span>: {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">completed</span><span class="delimiter">&quot;</span></span>: {
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">actionLayout</span><span class="delimiter">&quot;</span></span>: {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">named</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Done</span><span class="delimiter">&quot;</span></span>,          <span class="comment">// naming UI hint</span>
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">cssClass</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">x-highlight</span><span class="delimiter">&quot;</span></span> <span class="comment">// CSS UI hint</span>
                  }
                },
                <span class="key"><span class="delimiter">&quot;</span><span class="content">notYetCompleted</span><span class="delimiter">&quot;</span></span>: {
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">actionLayout</span><span class="delimiter">&quot;</span></span>: {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">named</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Not done</span><span class="delimiter">&quot;</span></span>
                  }
                }
              }
            }
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">Misc</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">members</span><span class="delimiter">&quot;</span></span>: {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">notes</span><span class="delimiter">&quot;</span></span>: {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">propertyLayout</span><span class="delimiter">&quot;</span></span>: {
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">multiLine</span><span class="delimiter">&quot;</span></span>: <span class="integer">5</span>              <span class="comment">// UI hint for text area</span>
                }
              },
              <span class="key"><span class="delimiter">&quot;</span><span class="content">versionSequence</span><span class="delimiter">&quot;</span></span>: {}
            }
          }
        }
      }
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">span</span><span class="delimiter">&quot;</span></span>: <span class="integer">6</span>,                              <span class="comment">// span of the middle property column</span>
      <span class="key"><span class="delimiter">&quot;</span><span class="content">memberGroups</span><span class="delimiter">&quot;</span></span>: { ... }
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">span</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>                               <span class="comment">// span of the right property column (if any)</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">span</span><span class="delimiter">&quot;</span></span>: <span class="integer">6</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">collections</span><span class="delimiter">&quot;</span></span>: {                        <span class="comment">// ordered map of collections</span>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">dependencies</span><span class="delimiter">&quot;</span></span>: {                     <span class="comment">// collection, with associated actions</span>
          <span class="key"><span class="delimiter">&quot;</span><span class="content">collectionLayout</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">paged</span><span class="delimiter">&quot;</span></span>: <span class="integer">10</span>,                      <span class="comment">// pagination UI hint</span>
            <span class="key"><span class="delimiter">&quot;</span><span class="content">render</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">EAGERLY</span><span class="delimiter">&quot;</span></span>               <span class="comment">// lazy-loading UI hint</span>
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">actions</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">add</span><span class="delimiter">&quot;</span></span>:{},
            <span class="key"><span class="delimiter">&quot;</span><span class="content">delete</span><span class="delimiter">&quot;</span></span>: {}
          },
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">similarItems</span><span class="delimiter">&quot;</span></span>: {}                    <span class="comment">// collection, no associated actions</span>
      }
    }
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">actions</span><span class="delimiter">&quot;</span></span>: {                                <span class="comment">// actions not associated with any member</span>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">delete</span><span class="delimiter">&quot;</span></span>: {},
    <span class="key"><span class="delimiter">&quot;</span><span class="content">duplicate</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">actionLayout</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">named</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Clone</span><span class="delimiter">&quot;</span></span>
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Although advisable, it is not necessary to list all class members in this file. Any members not listed with be
ordered according either to annotations (if present) or fallback/default values.</p>
</div>
<div class="paragraph">
<p>Note also that the layout file may contain entries for <a href="ug.html#_ug_how-tos_contributed-members">contributed associations and actions</a>; this allows each contributee classes to define their own layout for their contributions, possibly overriding any static metadata on the original domain service contributor.</p>
</div>
</div>
<div class="sect3">
<h4 id="_downloading_an_initial_layout">8.2.2. Downloading an initial layout</h4>
<div class="paragraph">
<p>The fastest way to get started is to use the (non-ASF) <a href="http://github.com/isisaddons/isis-module-devutils">Isis addons' devutils</a> module to download the layout file (derived from any existing static metadata defined by annotations).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_object-layout_application-menu">8.3. Application Menu Layout</h3>
<div class="paragraph">
<p>The actions of domain services are made available as an application menu bar. By default each domain service
corresponds to a single menu on this menu bar, with its actions as the drop-down menu items. This is rarely exactly
what is required, however. The <code>@MemberOrder</code> and <code>@DomainServiceLayout</code> annotations can be used to rearrange the
placement of menu items.</p>
</div>
<div class="paragraph">
<p>The screenshots below are taken from <a href="http://github.com/estatio/estatio">Estatio</a>, an open source estate management
application built using Apache Isis.</p>
</div>
<div class="sect3">
<h4 id="__domainservicelayout">8.3.1. @DomainServiceLayout</h4>
<div class="paragraph">
<p>Menus for domain services can be placed either on a primary, secondary or tertiary menu bar.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/application-menu/layout-menus.png"><img src="images/wicket-viewer/application-menu/layout-menus.png" alt="layout menus" width="800px"></a>
</div>
</div>
<div class="paragraph">
<p>Within a single top-level menu (eg "Fixed Assets") there can be actions from multiple services. The Wicket viewer
automatically adds a divider between each:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/application-menu/dividers.png"><img src="images/wicket-viewer/application-menu/dividers.png" alt="dividers" width="400px"></a>
</div>
</div>
<div class="paragraph">
<p>In the example above the top-level menu combines the actions from the <code>Properties</code>, <code>Units</code> and <code>FixedAssetRegistrations</code>
services. The <code>Properties</code> service is annotated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainServiceLayout</span>(
        named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Fixed Assets</span><span class="delimiter">&quot;</span></span>,
        menuBar = DomainServiceLayout.MenuBar.PRIMARY,
        menuOrder = <span class="string"><span class="delimiter">&quot;</span><span class="content">10.1</span><span class="delimiter">&quot;</span></span>
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Properties</span> ... { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>while the <code>Units</code> service is annotated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainServiceLayout</span>(
        named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Fixed Assets</span><span class="delimiter">&quot;</span></span>,
        menuBar = DomainServiceLayout.MenuBar.PRIMARY,
        menuOrder = <span class="string"><span class="delimiter">&quot;</span><span class="content">10.2</span><span class="delimiter">&quot;</span></span>
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Units</span> ... { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>and similarly <code>FixedAssetRegistrations</code> is annotated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainServiceLayout</span>(
        named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Fixed Assets</span><span class="delimiter">&quot;</span></span>,
        menuBar = DomainServiceLayout.MenuBar.PRIMARY,
        menuOrder = <span class="string"><span class="delimiter">&quot;</span><span class="content">10.3</span><span class="delimiter">&quot;</span></span>
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">FixedAssetRegistrations</span> ... { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in all three cases the value of the <code>named</code> attribute and the <code>menuBar</code> attribute is the same: "Fixed Assets"
and PRIMARY. This means that all will appear on a "Fixed Assets" menu in the primary menu bar.</p>
</div>
<div class="paragraph">
<p>Meanwhile the value of <code>menuOrder</code> attribute is significant for two reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for these three services on the same ("Fixed Assets") top-level menu, it determines the relative order of their sections (<code>Properties</code> first, then <code>Units</code>, then <code>FixedAssetRegistrations</code>)</p>
</li>
<li>
<p>it determines the placement of the top-level menu itself ("Fixed Assets") with respect to other top-level menus on the menu bar.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To illustrate this latter point, the next top-level menu on the menu bar, "Parties", is placed after "Fixed Assets"
 because the <code>menuOrder</code> of the first of its domain services, namely the <code>Parties</code> service, is higher than that for
 "Fixed Assets":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainServiceLayout</span>(
        named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Parties</span><span class="delimiter">&quot;</span></span>,
        menuBar = DomainServiceLayout.MenuBar.PRIMARY,
        menuOrder = <span class="string"><span class="delimiter">&quot;</span><span class="content">20.1</span><span class="delimiter">&quot;</span></span>
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Parties</span> ... { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that only the <code>menuOrder</code> of the <em>first</em> domain service is significant in placing the menus along the menu bar;
thereafter the purpose of the <code>menuOrder</code> is to order the menu services sections on the menu itself.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ordering_menu_actions">8.3.2. Ordering menu actions</h4>
<div class="paragraph">
<p>For a given service, the actions within a section on a menu is determined by the <code>@MemberOrder</code> annotation. Thus, for
the <code>Units</code> domain service, its actions are annotated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Units</span> <span class="directive">extends</span> EstatioDomainService&lt;Unit&gt; {

    <span class="annotation">@MemberOrder</span>(sequence = <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Unit newUnit( ... ) { ... }

    <span class="annotation">@MemberOrder</span>(sequence = <span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Unit&gt; findUnits( ... ) { ... }

    <span class="annotation">@ActionLayout</span>( prototype = <span class="predefined-constant">true</span> )
    <span class="annotation">@MemberOrder</span>(sequence = <span class="string"><span class="delimiter">&quot;</span><span class="content">99</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Unit&gt; allUnits() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the last is also a prototype action (meaning it is only displayed in SERVER_PROTOTYPE (=Wicket Development) mode).
In the UI it is rendered in italics.</p>
</div>
<div class="paragraph">
<p>(It is possible to override this place of a given action by specifying <code>@MemberOrder(name=&quot;&#8230;&#8203;&quot;)</code> where the name is
that of a top-level menu. Prior to 1.8.0 this was the only way of doing things, as of 1.8.0 its use
is not recommended).</p>
</div>
</div>
<div class="sect3">
<h4 id="_tertiary_menubar">8.3.3. Tertiary menubar</h4>
<div class="paragraph">
<p>The tertiary menu bar consists of a single unnamed menu, rendered underneath the user&#8217;s login, top right. This is
intended primarily for actions pertaining to the user themselves, eg their account, profile or settings:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/application-menu/tertiary.png"><img src="images/wicket-viewer/application-menu/tertiary.png" alt="tertiary" width="300px"></a>
</div>
</div>
<div class="paragraph">
<p>Domain services' actions can be associated with the tertiary menu using the same <code>@DomainServiceLayout</code> annotation. For
example, the <code>updateEpochDate(&#8230;&#8203;)</code> and <code>listAllSettings(&#8230;&#8203;)</code> actions come from the following service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainServiceLayout</span>(
        menuBar = DomainServiceLayout.MenuBar.TERTIARY,
        menuOrder = <span class="string"><span class="delimiter">&quot;</span><span class="content">10.1</span><span class="delimiter">&quot;</span></span>
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">EstatioAdministrationService</span> ... {

    <span class="annotation">@MemberOrder</span>(sequence = <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> updateEpochDate( ... ) { ... }

    <span class="annotation">@MemberOrder</span>(sequence = <span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;ApplicationSetting&gt; listAllSettings() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the number of items on the tertiary menu is expected to be small and most will pertain to the current user, the
viewer does <em>not</em> place dividers between actions from different services on the tertiary menu.</p>
</div>
</div>
<div class="sect3">
<h4 id="_isis_add_on_modules">8.3.4. Isis Add-on modules</h4>
<div class="paragraph">
<p>Some of the (non-ASF) <a href="http://isisaddons.org">Isis Addons</a> modules also provide services whose actions appear in top-level menus.</p>
</div>
<div class="paragraph">
<p>The <a href="http://github.com/isisaddons/isis-module-security">security</a>'s module places its domain service menus in three
top-level menus:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>its <code>ApplicationUsers</code>, <code>ApplicationRoles</code>, <code>ApplicationPermission</code>, <code>ApplicationFeatureViewModels</code> and
<code>ApplicationTenancies</code> domain services are all grouped together in a single "Security" top-level menu, on the
SECONDARY menu bar</p>
</li>
<li>
<p>its <code>SecurityModuleAppFixturesService</code> domain service, which allows the security modules' fixture scripts to be run,
is placed on a "Prototyping" top-level menu, also on the SECONDARY menu bar</p>
</li>
<li>
<p>its <code>MeService</code> domain service, which provides the <code>me()</code> action, is placed on the TERTIARY menu bar.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Meanwhile the <a href="http://github.com/isisaddons/isis-module-devutils">devutils</a> module places its actions - to download layouts and
so forth - on a "Prototyping" top-level menu, on the SECONDARY menu bar.</p>
</div>
<div class="paragraph">
<p>Currently there is no facility to alter the placement of these services. However, their UI can be suppressed
using security or using a <a href="ug.html#_ug_more-advanced_decoupling_vetoing-visibility">vetoing subscriber</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_object-layout_static-vs-dynamic">8.4. Static vs Dynamic Layouts</h3>
<div class="paragraph">
<p>Using <a href="#_rg_object-layout_dynamic">dynamic object layout</a>s using JSON has the huge benefit that the layout can be updated without requiring a recompile of the code and redeploy of the app.  Many developers also find it easier to rationalize about layout when all the hints are collated together in a single place (rather than scattered across the class members as annotations).</p>
</div>
<div class="paragraph">
<p>Another benefit of dynamic layout is that UI hints can be provided for <a href="ug.html#_ug_how-tos_contributed-members">contributed associations and actions</a> that are synthesised at runtime.</p>
</div>
<div class="paragraph">
<p>The main downsides of using dynamic layouts are a lack of typesafety (a typo will result in the metadata not being picked up for the element) and syntactic fragility (an invalid JSON document will result in no metadata for the entire class).</p>
</div>
<div class="paragraph">
<p>Also, dynamic layouts have no notion of inheritance, whereas the dewey-decimal format <code>@MemberOrder</code> annotation allows the metadata of the subclass its superclasses to fit together relatively seamlessly.</p>
</div>
<div class="sect3">
<h4 id="_best_of_both_worlds">8.4.1. Best of both worlds?</h4>
<div class="paragraph">
<p>Using the (non-ASF) <a href="http://github.com/isisaddons/isis-jrebel-plugin">Isis addons' jrebel</a> plugin comes close to getting the best of both words: metadata is specified in a type-safe way using annotations, but can be reloaded automatically.</p>
</div>
<div class="paragraph">
<p>The downsides are licensing cost, and also the fact that metadata for contributed actions in the contributee class cannot be specified.</p>
</div>
<div class="paragraph">
<p>Another open source alternative that you might also like to explore is DCEVM; there&#8217;s a good write-up on the <a href="http://blog.jetbrains.com/idea/2013/07/get-true-hot-swap-in-java-with-dcevm-and-intellij-idea/">IntelliJ blog</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rg_runtime">9. Configuration Properties</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Isis' own configuration properties are simple key-value pairs, typically held in the <code>WEBINF/isis.properties</code> file and other related files.  This chapter describes how to configure an Apache Isis application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Configuration properties for the viewers can be found in the <a href="ug.html#_ug_wicket-viewer">Wicket Viewer</a> chapter and the <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a> chapter.  Likewise[details of configuring security (Apache Shiro) can be found in the <a href="ug.html#_ug_security">Security</a> chapter.</p>
</div>
<div class="paragraph">
<p>Also, note that by default the configuration values are part of the built WAR file.  Details on how to override these configuration properties externally for different environments can be found in the <a href="ug.html#_ug_deployment">Deployment</a> chapter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_rg_runtime_deployment-types">9.1. Deployment Types</h3>
<div class="paragraph">
<p>Apache Isis distinguishes between the application being run in development mode vs running in production mode.  The framework calls this the "deployment type" (corresponding internally to the <code>DeploymentType</code> class).</p>
</div>
<div class="paragraph">
<p>(For mostly historical reasons) development mode is actually called <code>SERVER_PROTOTYPE</code>, while production mode is called just <code>SERVER</code>.  (There is also a deprecated mode called <code>SERVER_EXPLORATION</code>; for all intents and purposes this can considered as an alias of <code>SERVER_PROTOTYPE</code>).</p>
</div>
<div class="paragraph">
<p>When running in development/prototyping mode, certain capabilities are enabled; most notably any actions restricted to prototyping mode (using <a href="#_rg_annotations_manpage-Action_restrictTo"><code>@Action#restrictTo()</code></a>) will be available.</p>
</div>
<div class="sect3">
<h4 id="_using_the_wicket_viewer">9.1.1. Using the Wicket Viewer</h4>
<div class="paragraph">
<p>Most of the you&#8217;re likely to run Apache Isis using the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a>.  In this case Apache Isis' "deployment type" concept maps to Wicket&#8217;s "configuration" concept:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 31. Apache Isis' deployment type corresponds to Apache Wicket&#8217;s configuration</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Apache Isis<br>
(Deployment Type)</th>
<th class="tableblock halign-left valign-top">Apache Wicket<br>
(Configuration)</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SERVER_PROTOTYPE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>development</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">running in development/prototyping mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SERVER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deployment</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">running in production mode</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Wicket&#8217;s mechanism for specifying the "configuration" is to use a context parameter in <code>web.xml</code>; Apache Isis automatically infers its own deployment type from this.  In other words:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to specify SERVER (production) mode, use:<br></p>
<div class="listingblock">
<div class="title"><code>web.xml</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>configuration<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>deployment<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>to specify <code>SERVER_PROTOTYPING</code> (development) mode, use:<br></p>
<div class="listingblock">
<div class="title"><code>web.xml</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>configuration<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>deployment<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_restful_objects_viewer_only">9.1.2. Restful Objects viewer only</h4>
<div class="paragraph">
<p>Most Apache Isis applications will consist of at least the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> and optionally the <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a>.  When both viewers are deployed in the same app, then the bootstrapping is performed by Wicket, and so the deployment type is configured as described in the previous section.</p>
</div>
<div class="paragraph">
<p>In some cases though you may be using Apache Isis to provide a REST API only, that is, you won&#8217;t have deployed the Wicket viewer.  In these cases your app will be bootstrapped using  Apache Isis' <a href="#_rg_web-xml_servlet-context-listeners"> <code>IsisWebAppBootstrapper</code></a>.</p>
</div>
<div class="paragraph">
<p>In this case the deployment type is specified through an Apache Isis-specific context parameter, called <code>isis.deploymentType</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to specify <code>SERVER</code> (production) mode, use:<br></p>
<div class="listingblock">
<div class="title"><code>web.xml</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>isis.deploymentType<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>server<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>to specify <code>SERVER_PROTOTYPE</code> (development) mode, use:<br></p>
<div class="listingblock">
<div class="title"><code>web.xml</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>isis.deploymentType<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>server-prototype<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_overriding_the_deployment_type">9.1.3. Overriding the deployment type</h4>
<div class="paragraph">
<p>If bootstrapping the application using Apache Isis' <a href="ug.html#_ug_deployment_cmd-line"><code>org.apache.isis.WebServer</code></a> then it is possible to override the deployment type using the <code>-t</code> (or <code>--type</code>) flag.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">java -jar ... org.apache.isis.WebServer -t SERVER</code></pre>
</div>
</div>
<div class="paragraph">
<p>where "&#8230;&#8203;" is the (usually rather long) list of JAR files and class directories that will make up your application.</p>
</div>
<div class="paragraph">
<p>This works for both the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> and the <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_runtime_configuration-files">9.2. Configuration Files</h3>
<div class="paragraph">
<p>When running an Apache Isis webapp, configuration properties are read from configuration files held in the <code>WEB-INF</code> directory.</p>
</div>
<div class="paragraph">
<p>The <code>WEBINF/isis.properties</code> file is always read and must exist.</p>
</div>
<div class="paragraph">
<p>In addition, the following other properties are searched for and if present also read:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>viewer_wicket.properties</code> - if the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> is in use</p>
</li>
<li>
<p><code>viewer_restfulobjects.properties</code> - if the <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a> is in use</p>
</li>
<li>
<p><code>viewer.properties</code> - for any other viewer configuration (but there are none currently)</p>
</li>
<li>
<p><code>persistor_datanucleus.properties</code> - assuming the JDO/DataNucleus objectstore is in use</p>
</li>
<li>
<p><code>persistor.properties</code> - for any other objectstore configuration. <br></p>
<div class="paragraph">
<p>This typically is used to hold <code>JDBC</code> <code>URL</code>s, which is arguably a slight violation of the file (because there&#8217;s nothing in Apache Isis to say that persistors have to use <code>JDBC</code>.  However, it is generally convenient to put these <code>JDBC</code> settings into a single location.  If you want, they could reside inin any of <code>persistor_datanucleus.properties</code>, <code>persistor.properties</code> or (even) <code>isis.properties</code></p>
</div>
</li>
<li>
<p><code>authentication_shiro.properties</code>, <code>authorization_shiro.properties</code></p>
<div class="paragraph">
<p>assuming the Shiro Security is in use (but there are no security-related config properties currently; use shiro.ini for Shiro config)</p>
</div>
</li>
<li>
<p><code>authentication.properties</code>, <code>authorization.properties</code><br></p>
<div class="paragraph">
<p>for any other security-related config properties (but there are none currently).</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can if you wish simply store all properties in the <code>isis.properties</code> file; but we think that breaking properties out into sections is preferable.</p>
</div>
</div>
<div class="sect2">
<h3 id="_rg_runtime_configuring-components">9.3. Specifying components</h3>
<div class="paragraph">
<p>Bootstrapping an Apache Isis application involves identifying both:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the major components (authentication, persistence mechanisms, viewers) of Apache Isis, and also</p>
</li>
<li>
<p>specifying the domain services and persistent entities that make up the application itself.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As of 1.9.0 there are two different ways to perform this bootstrapping.  The recommended (newer) approach is to use an <a href="#_rg_classes_super_manpage-AppManifest"><code>AppManifest</code></a>, specified either programmatically or through the configuration properties.  This allows the components, services and entities to be specified from a single class.  The alternative (and older, pre 1.9.0) approach is to specify this information individually, through configuration properties.</p>
</div>
<div class="paragraph">
<p>To specify the <code>AppManifest</code> as a configuration property, use:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 32. Core Configuration Properties (ignored if <code>isis.appManifest</code> is present)</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 16%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Value<br>
(<em>default value</em>)</th>
<th class="tableblock halign-left valign-top">Implements</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.appManifest</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FQCN</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o.a.i.applib.AppManifest</code><br></p>
</div>
<div class="paragraph">
<p>By convention this implementation resides in an <code>myapp-app</code> Maven module (as opposed to <code>myapp-dom</code> or <code>myapp-fixture</code>).  See the <a href="ug.html#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a> for details.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>From this the framework can determine the domain services, persistent entities and security (authentication and authorization) mechanisms to use.  Other configuration (including fixtures) can also be specified this way.</p>
</div>
<div class="paragraph">
<p>If the <code>AppManifest</code> approach is <em>not</em> being used, then the following configuration properties are used to specify the major components of Apache Isis to use:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 33. Core Configuration Properties (ignored if <code>isis.appManifest</code> is present)</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 16%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Value<br>
(<em>default value</em>)</th>
<th class="tableblock halign-left valign-top">Implements</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.authentication</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shiro</code>, <code>bypass</code>, <code>FQCN</code><br>
(<code><em>shiro</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o.a.i.core.runtime.authentication.</code> <code>AuthenticationManagerInstaller</code><br></p>
</div>
<div class="paragraph">
<p>This property is IGNORED if the <code>isis.appManifest</code> configuration property is specified, or if an <a href="#_rg_classes_super_manpage-AppManifest"><code>AppManifest</code></a> is provided programmatically.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.authorization</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shiro</code>, <code>bypass</code>, <code>FQCN</code><br>
(<code><em>shiro</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o.a.i.core.runtime.authorization.</code> <code>AuthorizationManagerInstaller</code><br></p>
</div>
<div class="paragraph">
<p>This property is IGNORED if the <code>isis.appManifest</code> configuration property is specified, or if an <a href="#_rg_classes_super_manpage-AppManifest"><code>AppManifest</code></a> is provided programmatically.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.persistor</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>datanucleus</code>, <code>inmemory</code>, <code>FQCN</code><br>
(<code><em>datanucleus</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o.a.i.core.runtime.installerregistry.installerapi.</code> <code>PersistenceMechanismInstaller</code></p>
</div>
<div class="paragraph">
<p>This property is IGNORED completely in 1.9.0.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.services-installer</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>configuration</code>, <code>configuration-and-annotation</code>, <code>FQCN</code><br>
(<code><em>configuration</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>org.apache.isis.core.runtime.services.</code> <code>ServicesInstaller</code><br></p>
</div>
<div class="paragraph">
<p>The mechanism to discover and load domain services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>configuration-and-annotation</code> will search for <code>@DomainService</code>-annotated classes and also read from <code>isis.services</code> configuration property</p>
</li>
<li>
<p><code>configuration</code> will only read from the <code>isis.services</code> configuration property.<br></p>
</li>
<li>
<p>Otherwise an alternative implementation of the <code>o.a.i.core.runtime.services.ServicesInstaller</code> internal API can be provided.<br></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This property is IGNORED if the <code>isis.appManifest</code> configuration property is specified, or if an <a href="#_rg_classes_super_manpage-AppManifest"><code>AppManifest</code></a> is provided programmatically.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The values <code>"shiro"</code>, <code>"bypass"</code> etc are actually aliases for concrete implementations listed in Apache Isis' <code>installer-registry.properties</code> file (in <code>isis-core-runtime.jar</code>).  It is&#8201;&#8212;&#8201;at least in theory&#8201;&#8212;&#8201;possible to specify a fully qualified class name to replace either of the two security components.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the <code>AppManifest</code> is <em>not</em> being used then there are number of other configuration properties that also must be specified: <code>isis.services</code>, <code>isis.services.ServicesInstallerFromAnnotation.packagePrefix</code> and <code>isis.persistor.datanucleus.RegisterEntities.packagePrefix</code> and <code>isis.fixtures</code>; these are listed in the sections below.</p>
</div>
<div class="sect3">
<h4 id="_viewer_configuration">9.3.1. Viewer Configuration</h4>
<div class="paragraph">
<p>Viewers are specified by way of the filters and servlets in the <a href="#_rg_web-xml"><code>web.xml</code></a> file; these are not bootstrapped by the framework, rather it is the other way around.  However, we can also hint to the framework as to which viewers are in use by way of a context parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>isis.viewers<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>wicket,restfulobjects<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The net effect of this configuration is simply to ensure that the <code>viewer_wicket.properties</code> and/or the <code>viewer_restfulobjects.properties</code> files are read.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_runtime_configuring-core">9.4. Configuring Core</h3>
<div class="paragraph">
<p>This section lists the core/runtime configuration properties recognized by Apache Isis.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Configuration properties for the JDO/DataNucleus objectstore can be found in the <a href="#_rg_runtime_configuring-datanucleus">Configuring DataNucleus</a> section later in this chapter, while configuration properties for the viewers can be found in the their respective chapters, <a href="ug.html#_ug_wicket-viewer_configuration-properties">here for Wicket viewer</a>, and <a href="ug.html#_ug_restfulobjects-viewer_configuration-properties">here for the Restful Objects viewer</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 34. Core Configuration Properties</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 16%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Value<br>
(default value)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.object.</code><br>
<code>editing</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (<code>true</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Whether objects' properties and collections can be edited directly (for objects annotated with <a href="#_rg_annotations_manpage-DomainObject_editing"><code>@DomainObject#editing()</code></a>); see <a href="#_rg_runtime_configuring-core_isis-objects-editing">below</a> for further discussion.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.persistor.</code><br>
<code>disableConcurrencyChecking</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (<code>false</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Disables concurrency checking globally. <br></p>
</div>
<div class="paragraph">
<p>Only intended for "emergency use" as a workaround while pending fix/patch to Apache Isis itself.  (Note that there is no "datanucleus" in the property).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.reflector.facet.</code><br>
<code>cssClass.patterns</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">regex:css1,regex2:css2,&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Comma separated list of key:value pairs, where the key is a regex matching action names (eg <code>delete.*</code>) and the value is a <a href="http://getbootstrap.com/css/">Bootstrap</a> CSS button class (eg <code>btn-warning) to be applied (as per `@CssClass()</code>) to all action members matching the regex.<br></p>
</div>
<div class="paragraph">
<p>See <a href="ug.html#_ug_how-tos_ui-hints_action-icons-and-css">UI hints</a> for more details.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.reflector.facet.</code><br>
<code>cssClassFa.patterns</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">regex:fa-icon,regex2:fa-icon2,&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Comma separated list of key:value pairs, where the key is a regex matching action names (eg <code>create.*</code>) and the value is a <a href="http://fortawesome.github.io/Font-Awesome/icons/">font-awesome</a> icon name (eg <code>fa-plus</code>) to be applied (as per <code>@CssClassFa()</code>) to all action members matching the regex.<br></p>
</div>
<div class="paragraph">
<p>See <a href="ug.html#_ug_how-tos_ui-hints_action-icons-and-css">UI hints</a> for more details.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.reflector.facets</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FQCN</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Fully qualified class names of a custom implementation of <code>ProgrammingModel</code> interface.<br></p>
</div>
<div class="paragraph">
<p>See <a href="ug.html#_ug_extending_programming-model_finetuning">finetuning the programming model</a> for more details.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.reflector.facets.</code><br>
<code>exclude</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FQCN</code>,<code>FQCN2</code>,&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Fully qualified class names of (existing, built-in) facet factory classes to be included to the programming model.<br></p>
</div>
<div class="paragraph">
<p>See <a href="ug.html#_ug_extending_programming-model_finetuning">finetuning the programming model</a> for more details.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.reflector.facets.</code><br>
<code>include</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FQCN</code>,<code>FQCN2</code>,&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Fully qualified class names of (new, custom) facet factory classes to be included to the programming model.<br>
See <a href="ug.html#_ug_extending_programming-model_finetuning">finetuning the programming model</a> for more details.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.reflector.</code><br>
<code>layoutMetadataReaders</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FQCN</code>,<code>FQCN2</code>,&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Fully qualified class names of classes to be instantiated to read layout metadata, as used in for <a href="#_rg_object-layout_dynamic">dynamic layout</a>s.<br></p>
</div>
<div class="paragraph">
<p>See <a href="ug.html#_ug_extending_programming-model_layout-metadata-reader">Layout Metadata Reader</a> for more information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.reflector.validator</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FQCN</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Custom implementation of <code>MetaModelValidator</code> (in the <code>org.apache.isis.core.metamodel.specloader.validator</code> package)<br></p>
</div>
<div class="paragraph">
<p>See <a href="ug.html#_ug_extending_programming-model_custom-validator">Custom Validator</a> to learn more.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.reflector.validator.</code><br>
<code>allowDeprecated</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (<code>true</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Whether deprecated annotations or naming conventions are tolerated or not.  If not, then a metamodel validation error will be triggered, meaning the app won&#8217;t boot (fail-fast).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.services.</code><br>
<code>ServicesInstallerFromAnnotation.</code><br>
<code>packagePrefix</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fully qualified package names (CSV)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>to search for domain services (including all subpackages).</p>
</div>
<div class="paragraph">
<p>This property is IGNORED if the <a href="#_rg_runtime_configuring-components"><code>isis.appManifest</code></a> configuration property is specified, or if an <a href="#_rg_classes_super_manpage-AppManifest"><code>AppManifest</code></a> is provided programmatically.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.services</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FQCN</code>,<code>FQCN2</code>,&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Fully qualified class names of classes to be instantiated as domain services. <br></p>
</div>
<div class="paragraph">
<p>Each entry can be optionally prefixed by "n:" specifying the relative order on the menu (corresponds to <a href="#_rg_annotations_manpage-DomainServiceLayout_menuOrder"><code>@DomainServiceLayout#menuOrder()</code></a>).</p>
</div>
<div class="paragraph">
<p>This property is IGNORED if the <a href="#_rg_runtime_configuring-components"><code>isis.appManifest</code></a> configuration property is specified, or if an <a href="#_rg_classes_super_manpage-AppManifest"><code>AppManifest</code></a> is provided programmatically.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.services.</code><br>
<code>audit.objects</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>all</code>, <code>none</code> (<code>all</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Whether the changed properties of objects should be automatically audited (for objects annotated with <a href="#_rg_annotations_manpage-DomainObject_auditing"><code>@DomainObject(auditing=Auditing.AS_CONFIGURED)</code></a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.services.</code><br>
<code>command.actions</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>all</code>, <code>ignoreSafe</code>, <code>none</code> (<code>all</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Whether actions should be automatically reified into commands (for actions annotated with <a href="#_rg_annotations_manpage-Action_command"><code>@Action(command=CommandReification.AS_CONFIGURED)</code></a>. <br></p>
</div>
<div class="paragraph">
<p><code>ignoreQueryOnly</code> is an alias for <code>ignoreSafe</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.services.</code><br>
<code>container.disableAutoFlush</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (<code><em>false</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Whether the <code>DomainObjectContainer</code> should automatically flush pending changes prior to querying (via <code>allMatches()</code>, <code>firstMatch()</code> and so on).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.services.</code><br>
<code>container.disableAutoFlush</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (<code><em>false</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Whether the <code>DomainObjectContainer</code> should automatically flush pending changes prior to querying (via <code>allMatches()</code>, <code>firstMatch()</code> and so on).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.services.</code><br>
<code>ContentNegotiation-</code><br>
<code>ServiceXRoDomainType</code><br>
.prettyPrint</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (depends)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>If a domain object has been mapped to the specified JAXB <code>x-ro-domain-type</code>, then determines whether the result is pretty-printed or not.<br></p>
</div>
<div class="paragraph">
<p>+
If no configuration property is available, then the defaults is determined by the <a href="#_rg_runtime_deployment-types">deployment type</a>: production mode disables pretty printing, while prototype mode enables it.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.service.</code><br>
<code>email.tls.enabled</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (<code><em>true</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Whether to enable TLS for the email SMTP connection (used by <a href="#_rg_services-api_manpage-EmailService"><code>EmailService</code></a>). <br></p>
</div>
<div class="paragraph">
<p>NB: note that the key is mis-spelt, (<code>isis.service.email</code> rather than <code>isis.services.email</code>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.service.</code><br>
<code>email.sender.hostname</code><br></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">host (<code><em>smtp.gmail.com</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The hostname of the external SMTP provider (used by <a href="#_rg_services-api_manpage-EmailService"><code>EmailService</code></a>). <br></p>
</div>
<div class="paragraph">
<p>NB: note that the key is mis-spelt, (<code>isis.service.email</code> rather than <code>isis.services.email</code>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.service.</code><br>
<code>email.port</code><br></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">port number (<code><em>587</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The port number for the SMTP service on the the external SMTP host (used by <a href="#_rg_services-api_manpage-EmailService"><code>EmailService</code></a>). <br></p>
</div>
<div class="paragraph">
<p>NB: note that the key is mis-spelt, (<code>isis.service.email</code> rather than <code>isis.services.email</code>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.service.</code><br>
<code>email.sender.address</code><br></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">email address</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The email address to use for sending out email (used by <a href="#_rg_services-api_manpage-EmailService"><code>EmailService</code></a>).  <strong>Mandatory</strong>. <br></p>
</div>
<div class="paragraph">
<p>NB: note that the key is mis-spelt, (<code>isis.service.email</code> rather than <code>isis.services.email</code>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.service.</code><br>
<code>email.sender.password</code><br></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">email password</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The corresponding password for the email address to use for sending out email (used by <a href="#_rg_services-api_manpage-EmailService"><code>EmailService</code></a>).  <strong>Mandatory</strong>. <br></p>
</div>
<div class="paragraph">
<p>NB: note that the key is mis-spelt, (<code>isis.service.email</code> rather than <code>isis.services.email</code>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.services.</code><br>
<code>eventbus.implementation</code><br></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>guava</code>, <code>axon</code>, FQCN (<code><em>guava</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>which implementation to use by the <a href="#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a> as the underlying event bus.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.services.</code><br>
<code>eventbus.allowLateRegistration</code><br></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code>, (<code><em>false</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>whether a domain service can register with the <a href="#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a> after any events have posted.<br></p>
</div>
<div class="paragraph">
<p>Since this almost certainly constitutes a bug in application code, by default this is disallowed.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.services.</code><br>
<code>exceprecog.logRecognizedExceptions</code><br></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code>, (<code><em>false</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>whether recognized exceptions should also be logged.<br></p>
</div>
<div class="paragraph">
<p>Generally a recognized exception is one that is expected (for example a uniqueness constraint violated in the database) and which does not represent an error condition.  This property logs the exception anyway, useful for debugging.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.services.</code><br>
<code>ExceptionRecognizerComposite-</code><br>
<code>ForJdoObjectStore.disable</code><br></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code>, (<code><em>false</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>whether to disable the default recognizers registered by <code>ExceptionRecognizerCompositeForJdoObjectStore</code>.<br></p>
</div>
<div class="paragraph">
<p>This implementation provides a default set of recognizers to convert RDBMS constraints into user-friendly messages.  In the (probably remote) chance that this functionality isn&#8217;t required, they can be disabled through this flag.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.services.</code><br>
<code>publish.objects</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>all</code>, <code>none</code> (<code>all</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Whether changed objects should be automatically published (for objects annotated with <a href="#_rg_annotations_manpage-DomainObject_publishing"><code>@DomainObject(publishing=Publishing.AS_CONFIGURED)</code></a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.services.</code><br>
<code>publish.actions</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>all</code>, <code>ignoreSafe</code>, <code>none</code> (<code>all</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Whether actions should be automatically published (for actions annotated with <a href="#_rg_annotations_manpage-Action_publishing"><code>@Action(publishing=Publishing.AS_CONFIGURED)</code></a>.<br></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.services.</code><br>
<code>translation.po.mode</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>read</code>,<code>write</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Whether to force the <code>TranslationService</code> into either read or write mode.<br></p>
</div>
<div class="paragraph">
<p>See <a href="ug.html#_ug_more-advanced_i18n">i18n support</a> to learn more about the translation service.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewers.</code><br>
<code>paged.parented</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">positive integer (12)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Default page size for parented collections (as owned by an object, eg <code>Customer#getOrders()</code>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewers.</code><br>
<code>paged.standalone</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">positive integer (25)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Default page size for standalone collections (as returned from an action invocation)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewers.</code><br>
<code>propertyLayout.labelPosition</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TOP</code>, <code>LEFT</code><br>
(<code>LEFT</code>)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Default for label position for all properties if not explicitly specified using <a href="#_rg_annotations_manpage-PropertyLayout_labelPosition"><code>@PropertyLayout#labelPosition()</code></a></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_rg_runtime_configuring-core_isis-objects-editing">9.4.1. <code>objects.editing</code></h4>
<div class="paragraph">
<p>This configuration property in effect allows editing to be disabled globally for an application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.objects.editing=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>We recommend enabling this feature; it will help drive out the underlying business operations (processes and procedures) that require objects to change; these can then be captured as business actions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_runtime_configuring-core_isis-viewers-propertyLayout-labelPosition">9.4.2. <code>propertyLayout.labelPosition</code></h4>
<div class="paragraph">
<p>If you want a consistent look-n-feel throughout the app, eg all property labels to the top, then it&#8217;d be rather
frustrating to have to annotate every property.</p>
</div>
<div class="paragraph">
<p>Instead, a default can be specified in <code>isis.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.viewers.propertyLayout.labelPosition=TOP</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.viewers.propertyLayout.labelPosition=LEFT</code></pre>
</div>
</div>
<div class="paragraph">
<p>If these are not present then Apache Isis will render according to internal defaults. At the time of writing, this means labels are to the left for all datatypes except multiline strings.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_runtime_configuring-datanucleus">9.5. Configuring DataNucleus</h3>
<div class="paragraph">
<p>Apache Isis programmatically configures DataNucleus; any Apache Isis properties with the prefix <code>isis.persistor.datanucleus.impl</code> are passed through directly to the JDO/DataNucleus objectstore (with the prefix stripped off, of course).</p>
</div>
<div class="paragraph">
<p>DataNucleus will for itself also and read the <code>META-INF/persistence.xml</code>; at a minimum this defines the name of the "persistence unit".  n theory it could also hold mappings, though in Apache Isis we tend to use annotations instead.</p>
</div>
<div class="paragraph">
<p>Furthermore, DataNucleus will search for various other XML mapping files, eg <code>mappings.jdo</code>.  A full list can be found <a href="http://www.datanucleus.org/products/datanucleus/jdo/metadata.html">here</a>.  The metadata in these XML can be used to override the annotations of annotated entities; see <a href="ug.html#_ug_more-advanced_overriding-jdo-annotations">Overriding JDO Annotatons</a> for further discussion.</p>
</div>
<div class="sect3">
<h4 id="_rg_runtime_configuring-datanucleus_properties">9.5.1. Configuration Properties</h4>
<div class="paragraph">
<p>These configuration properties are typically stored in <code>WEB-INF/persistor_datanucleus.properties</code>.  However, you can place all configuration properties into <code>WEB-INF/isis.properties</code> if you wish (the configuration properties from all config files are merged together).</p>
</div>
<div class="sect4">
<h5 id="_configuration_properties_for_apache_isis_itself">Configuration Properties for Apache Isis itself</h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 35. JDO/DataNucleus Objectstore Configuration Properties</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 16%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Value<br>
(<em>default value</em>)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.persistor.</code><br>
<code>datanucleus.</code><br>
<code>classMetadataLoadedListener</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FQCN</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The default (<code>o.a.i.os.jdo.dn.CreateSchemaObjectFromClassMetadata</code>) creates a DB schema object</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.persistor.datanucleus.</code><br>
<code>RegisterEntities.packagePrefix</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fully qualified package names (CSV)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>that specifies the entities early rather than allow DataNucleus to find the entities lazily.  Further <a href="#_rg_runtime_configuring-datanucleus_eagerly-registering-entities">discussion below</a>.</p>
</div>
<div class="paragraph">
<p>This property is IGNORED if the <a href="#_rg_runtime_configuring-components"><code>isis.appManifest</code></a> configuration property is specified, or if an <a href="#_rg_classes_super_manpage-AppManifest"><code>AppManifest</code></a> is provided programmatically.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.persistor.datanucleus.</code><br>
<code>PublishingService.serializedForm</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zipped</p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_configuration_properties_passed_through_directly_to_datanucleus">Configuration Properties passed through directly to DataNucleus.</h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 36. JDO/DataNucleus Objectstore Configuration Properties</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 16%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Value<br>
(<em>default value</em>)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.persistor.datanucleus.impl.*</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Passed through directly to Datanucleus (with <code>isis.persistor.datanucleus.impl</code> prefix stripped)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.persistor.datanucleus.impl.</code><br>
<code>datanucleus.persistenceByReachabilityAtCommit</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>We recommend this setting is disabled. <br>
Further <a href="#_rg_runtime_configuring-datanucleus_disabling-persistence-by-reachability">discussion below</a>.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_runtime_configuring-datanucleus_persistence-xml">9.5.2. <code>persistence.xml</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_runtime_configuring-datanucleus_eagerly-registering-entities">9.5.3. Eagerly Registering Entities</h4>
<div class="paragraph">
<p>Both Apache Isis and DataNucleus have their own metamodels of the domain entities. Apache Isis builds its metamodel by walking the graph of types of the domain services.  The JDO/DataNucleus objectstore then takes these types and registers them with DataNucleus.</p>
</div>
<div class="paragraph">
<p>In some cases, though, not every entity type is discoverable from the API of the service actions. This is especially the case if you have lots of subtypes (where the action method specifies only the supertype). In such cases the Isis and JDO metamodels is built lazily, when an instance of that (sub)type is first encountered.</p>
</div>
<div class="paragraph">
<p>Apache Isis is quite happy for the metamodel to be lazily created, and - to be fair - DataNucleus also works well in most cases. In some cases, though, we have found that the JDBC driver (eg HSQLDB) will deadlock if DataNucleus tries to submit some DDL (for a lazily discovered type) intermingled with DML (for updating).  In any case, it&#8217;s probably not good practice to have DataNucleus work this way.</p>
</div>
<div class="paragraph">
<p>The framework thus provide mechanisms to search for all <code>@PersistenceCapable</code> entities under specified package(s), and registers them all eagerly.  In fact there are two:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>as of 1.9.0 the recommended (and simpler) approach is to specify an <a href="#_rg_classes_super_manpage-AppManifest"><code>AppManifest</code></a>, either as a <a href="#_rg_runtime_configuring-components"><code>isis.appManifest</code></a> configuration property or programmatically.</p>
</li>
<li>
<p>for earlier versions the <code>isis.persistor.datanucleus.RegisterEntities.packagePrefix</code> configuration property can be specified.  To bootstrap as a webapp this is usually specified in <code>persistor_datanucleus.properties</code>.  (This is also supported in 1.9.0 if no <code>AppManifest</code> is specified.  For integration testing this can be specified programatically.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Further discussion on specifying the package(s) in integration testing (for either approach) can be found in the <a href="ug.html#_ug_testing_integ-test-support_bootstrapping">user guide</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rg_runtime_configuring-datanucleus_disabling-persistence-by-reachability">9.5.4. Persistence by Reachability</h4>
<div class="paragraph">
<p>By default, JDO/DataNucleus supports the concept of <a href="http://www.datanucleus.org/products/datanucleus/jdo/orm/cascading.html">persistence-by-reachability</a>. That is, if
a non-persistent entity is associated with an already-persistent entity, then DataNucleus will detect this and will automatically persist the associated object. Put another way: there is no need to call Apache Isis' <code>DomainObjectContainer#persist(.)</code> or <code>DomainObjectContainer#persistIfNotAlready(.)</code> methods.</p>
</div>
<div class="paragraph">
<p>However, convenient though this feature is, you may find that it causes performance issues.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>DataNucleus' persistence-by-reachability may cause performance issues.  We strongly recommend that you disable it.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One scenario in particular where this performance issues can arise is if your entities implement the <code>java.lang.Comparable</code> interface, and you have used Apache Isis' <a href="#_rg_classes_utility_manpage-ObjectContracts"><code>ObjectContracts</code></a> utility class. The issue here is that <code>ObjectContracts</code> implementation can cause DataNucleus to recursively rehydrate a larger number of associated entities. (More detail below).</p>
</div>
<div class="paragraph">
<p>We therefore recommend that you disable persistence-by-reachability by adding the following to <code>persistor_datanucleus.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.persistor.datanucleus.impl.datanucleus.persistenceByReachabilityAtCommit=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>This change has been made to the <a href="ug.html#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a></p>
</div>
<div class="paragraph">
<p>If you do disable this feature, then you will (of course) need to ensure that you explicitly persist all entities using the <code>DomainObjectContainer#persist(.)</code> or <code>DomainObjectContainer#persistIfNotAlready(.)</code> methods.</p>
</div>
<div class="sect4">
<h5 id="_the_issue_in_more_detail_2">The issue in more detail</h5>
<div class="paragraph">
<p>Consider these entities (<a href="http://yuml.me/edit/b8681268">yuml.me/b8681268</a>):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/runtime/configuring-datanucleus/disabling-persistence-by-reachability/party-agreementrole-agreement.png" alt="party agreementrole agreement" width="750px">
</div>
</div>
<div class="paragraph">
<p>In the course of a transaction, the <code>Agreement</code> entity is loaded into memory (not necessarily modified), and then new <code>AgreementRole</code>s are associated to it.</p>
</div>
<div class="paragraph">
<p>All these entities implement <code>Comparable</code> using <code>ObjectContracts</code>, and the implementation of <code>AgreementRole</code>'s (simplified) is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AgreementRole</span> {
    ...
    public <span class="type">int</span> compareTo(AgreementRole other) {
        <span class="keyword">return</span> ObjectContracts.compareTo(<span class="local-variable">this</span>, other, <span class="string"><span class="delimiter">&quot;</span><span class="content">agreement</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">party</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>while <code>Agreement</code>'s is implemented as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Agreement</span> {
    ...
    public <span class="type">int</span> compareTo(Agreement other) {
        <span class="keyword">return</span> ObjectContracts.compareTo(<span class="local-variable">this</span>, other, <span class="string"><span class="delimiter">&quot;</span><span class="content">reference</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and <code>Party</code>'s is similarly implemented as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Party</span> {
    ...
    public <span class="type">int</span> compareTo(Party other) {
        <span class="keyword">return</span> ObjectContracts.compareTo(<span class="local-variable">this</span>, other, <span class="string"><span class="delimiter">&quot;</span><span class="content">reference</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>DataNucleus&#8217;s persistence-by-reachability algorithm adds the <code>AgreementRole</code> instances into a <code>SortedSet</code>, which causes <code>AgreementRole#compareTo()</code> to fire:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the evaluation of the "agreement" property delegates back to the <code>Agreement</code>, whose own <code>Agreement#compareTo()</code> uses the scalar <code>reference</code> property. As the <code>Agreement</code> is already in-memory, this does not trigger any further database queries</p>
</li>
<li>
<p>the evaluation of the "startDate" property is just a scalar property of the <code>AgreementRole</code>, so will already in-memory</p>
</li>
<li>
<p>the evaluation of the "party" property delegates back to the <code>Party</code>, whose own <code>Party#compareTo()</code> requires the uses the scalar <code>reference</code> property. However, since the <code>Party</code> is not yet in-memory, using the <code>reference</code> property triggers a database query to "rehydrate" the <code>Party</code> instance.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In other words, in figuring out whether <code>AgreementRole</code> requires the persistence-by-reachability algorithm to run, it causes the adjacent associated entity <code>Party</code> to also be retrieved.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rg_runtime_configuring-datanucleus_using-jndi-data-source">9.5.5. Using JNDI DataSource</h4>
<div class="paragraph">
<p>Isis' JDO objectstore can be configured either to connect to the database using its own connection pool, or by using a container-managed datasource.</p>
</div>
<div class="sect4">
<h5 id="_application_managed">Application managed</h5>
<div class="paragraph">
<p>Using a connection pool managed directly by the application (that is, by Apache Isis' JDO objectstore and ultimately by DataNucleus) requires a single set of configuration properties to be specified.</p>
</div>
<div class="paragraph">
<p>In the <code>WEB-INF\persistor_datanucleus.properties</code> file, specify the connection driver, url, username and password.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.persistor.datanucleus.impl.javax.jdo.option.ConnectionDriverName=net.sf.log4jdbc.DriverSpy
isis.persistor.datanucleus.impl.javax.jdo.option.ConnectionURL=jdbc:log4jdbc:hsqldb:mem:test
isis.persistor.datanucleus.impl.javax.jdo.option.ConnectionUserName=sa
isis.persistor.datanucleus.impl.javax.jdo.option.ConnectionPassword=</code></pre>
</div>
</div>
<div class="paragraph">
<p>Those configuration properties that start with the prefix <code>isis.persistor.datanucleus.impl.</code> are passed through directly to DataNucleus (with the prefix removed).</p>
</div>
</div>
<div class="sect4">
<h5 id="_container_managed_jndi">Container managed (JNDI)</h5>
<div class="paragraph">
<p>Using a datasource managed by the servlet container requires three separate bits of configuration.</p>
</div>
<div class="paragraph">
<p>Firstly, specify the name of the datasource in the <code>WEB-INF\persistor_datanucleus.properties</code> file. For example:</p>
</div>
<div class="paragraph">
<p>If connection pool settings are also present in this file, they will simply be ignored. Any other configuration properties that start with the prefix <code>isis.persistor.datanucleus.impl.</code> are passed through directly to DataNucleus (with the prefix removed).</p>
</div>
<div class="paragraph">
<p>Secondly, in the <code>WEB-INF/web.xml</code>, declare the resource reference:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource-ref&gt;</span>
    <span class="tag">&lt;description&gt;</span>db<span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;res-ref-name&gt;</span>jdbc/simpleapp<span class="tag">&lt;/res-ref-name&gt;</span>
    <span class="tag">&lt;res-type&gt;</span>javax.sql.DataSource<span class="tag">&lt;/res-type&gt;</span>
    <span class="tag">&lt;res-auth&gt;</span>Container<span class="tag">&lt;/res-auth&gt;</span>
<span class="tag">&lt;/resource-ref&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, declare the datasource as required by the servlet container. For example, if using Tomcat 7, the datasource can be specified by adding the following to <code>$TOMCAT_HOME/conf/context.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;Resource</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/simpleapp</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">auth</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Container</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.sql.DataSource</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">maxActive</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">maxIdle</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">maxWait</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">username</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">p4ssword</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">driverClassName</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.microsoft.sqlserver.jdbc.SQLServerDriver</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:sqlserver://127.0.0.1:1433;instance=.;databaseName=simpleapp</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You will also need to make sure that the JDBC driver is on the servlet container&#8217;s classpath. For Tomcat, this means copying the driver to <code>$TOMCAT_HOME/lib</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>According to Tomcat&#8217;s documentation, it is supposedly possible to copy the <code>conf/context.xml</code> to the name of the webapp, eg <code>conf/mywebapp.xml</code>, and scope the connection to that webapp only.  I was unable to get this working, however.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_runtime_application-specific">9.6. Application-specific CSS and JS</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_rg_runtime_application-specific_application-css">9.6.1. <code>application.css</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <code>WEB-INF/css/application.css</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rg_runtime_application-specific_application-js">9.6.2. <code>application.js</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <code>WEB-INF/scripts/application.js</code>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rg_web-xml">10. <code>web.xml</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apache Isis provides two different viewers, the <a href="ug.html#_ug_wicket-viewer">Wicket viewer</a> and the <a href="ug.html#_ug_restfulobjects-viewer">RestfulObjects viewer</a>.  You can deploy both of these concurrently, or deploy just the Wicket viewer, or deploy just the Restful Objects viewer.  The configuration in <code>web.xml</code> varies accordingly, both in terms of the servlet context listeners, filters and servlets.</p>
</div>
<div class="paragraph">
<p>If you are using Apache Isis' integration with Apache Shiro (for security) then this also needs configuring in <code>web.xml</code>.  See the <a href="ug.html#_ug_security_configuring-isis-to-use-shiro">security chapter</a> for full details on this topic.</p>
</div>
<div class="paragraph">
<p>The servlets and filters are mapped to three main pipelines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/wicket</code> - the Wicket viewer UI</p>
</li>
<li>
<p><code>/restful</code> - the Restful Objects resources (REST API)</p>
</li>
<li>
<p>other paths, also static resources (such as <code>.png</code>, <code>.css</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With the following key:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/runtime/web-xml/key.png"><img src="images/runtime/web-xml/key.png" alt="key" width="800px"></a>
</div>
</div>
<div class="paragraph">
<p>the diagram below shows the components to be configured if deploying both the Wicket viewer and Restful Objects viewer:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/runtime/web-xml/wicket-and-ro.png"><img src="images/runtime/web-xml/wicket-and-ro.png" alt="wicket and ro" width="800px"></a>
</div>
</div>
<div class="paragraph">
<p>Here the Wicket viewer is responsible for the main bootstrapping of Apache Isis itself, in other words the shared (global) metadata; this is done by the <code>IsisWicketApplication</code> class (extending the <code>WicketApplication</code> Wicket API).  This class is also responsible for Apache Isis' own session and transaction management.</p>
</div>
<div class="paragraph">
<p>The Restful Objects viewer - being a JAX-RS application implemented using the RestEasy framework - requires the <code>RestEasyBootstrapper</code> servlet context listener.  It is this context listener that also sets up the <code>RestfulObjectsApplication</code>, which is then delegated to by the RestEasy <code>HttpServletDispatcher</code>.  This pipeline uses the <code>IsisSessionFilter</code> and <code>IsisTransactionFilterForRestfulObjects</code> to perform the session and transaction management before it hits the RestEasy servlet.</p>
</div>
<div class="paragraph">
<p>If only the Wicket viewer is deployed, then the diagram is more or less the same: the RestEasy servlet, context listener and supporting filters are simply removed:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/runtime/web-xml/wicket-only.png"><img src="images/runtime/web-xml/wicket-only.png" alt="wicket only" width="800px"></a>
</div>
</div>
<div class="paragraph">
<p>Finally, if only the Restful Objects viewer is deployed, then things change a little more subtly.  Here, the Wicket filter is no longer needed.  In its place, though the <code>IsisWebAppBootstrapper</code> context listener is required: this is responsible for seting up the shared (global) metadata.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/runtime/web-xml/ro-only.png"><img src="images/runtime/web-xml/ro-only.png" alt="ro only" width="800px"></a>
</div>
</div>
<div class="paragraph">
<p>The following sections detail these various listeners, filters and servlets in more detail.</p>
</div>
<div class="sect2">
<h3 id="_rg_web-xml_servlet-context-listeners">10.1. Servlet Context Listeners</h3>
<div class="paragraph">
<p>Servlet context listeners are used to perform initialization on application startup.  Both Shiro (if configured as the security mechanism) and RestEasy (for the Restful Objects viewer) require their own context listener.  In addition, if the Wicket viewer is <em>not</em> being used, then additional Apache Isis-specific listener is required for bootstrapping of the Apache Isis framework itself.</p>
</div>
<div class="sect3">
<h4 id="__code_environmentloaderlistener_code_shiro">10.1.1. <code>EnvironmentLoaderListener</code> (Shiro)</h4>
<div class="paragraph">
<p>Bootstrap listener to startup and shutdown the web application&#8217;s Shiro <code>WebEnvironment</code> at startup and shutdown respectively.</p>
</div>
<div class="paragraph">
<p>Its definition is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;listener&gt;</span>
    <span class="tag">&lt;listener-class&gt;</span>org.apache.shiro.web.env.EnvironmentLoaderListener<span class="tag">&lt;/listener-class&gt;</span>
<span class="tag">&lt;/listener&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__code_isiswebappbootstrapper_code">10.1.2. <code>IsisWebAppBootstrapper</code></h4>
<div class="paragraph">
<p>The <code>IsisWebAppBootstrapper</code> servlet context listener bootstraps the shared (global) metadata for the Apache Isis framework.  This listener is not required (indeed must not be configured) if the Wicket viewer is in use.</p>
</div>
<div class="paragraph">
<p>Its definition is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;listener&gt;</span>
    <span class="tag">&lt;listener-class&gt;</span>org.apache.isis.core.webapp.IsisWebAppBootstrapper<span class="tag">&lt;/listener-class&gt;</span>
<span class="tag">&lt;/listener&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Its context parameters are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>deploymentType<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>SERVER_PROTOTYPE<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span>
<span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>isis.viewers<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>restfulobjects<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__code_resteasybootstrap_code_resteasy">10.1.3. <code>ResteasyBootstrap</code> (RestEasy)</h4>
<div class="paragraph">
<p>The <code>ResteasyBootstrap</code> servlet context listener initializes the RestEasy runtime, specifying that classes (namely, those specified in Isis' <code>RestfulObjectsApplication</code>) to be exposed as REST resources.  It is required if the Restful Objects viewer is to be deployed.</p>
</div>
<div class="paragraph">
<p>Its definition is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;listener&gt;</span>
    <span class="tag">&lt;listener-class&gt;</span>org.jboss.resteasy.plugins.server.servlet.ResteasyBootstrap<span class="tag">&lt;/listener-class&gt;</span>
<span class="tag">&lt;/listener&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are two relevant context parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>javax.ws.rs.Application<span class="tag">&lt;/param-name&gt;</span>        <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tag">&lt;param-value&gt;</span>org.apache.isis.viewer.restfulobjects.server.RestfulObjectsApplication<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span>
<span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>resteasy.servlet.mapping.prefix<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>/restful/<span class="tag">&lt;/param-value&gt;</span>                    <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>used by RestEasy to determine the JAX-RS resources and other related configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>should correspond to the filter mapping of the <code>HttpServletDispatcher</code> servlet</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_web-xml_servlets">10.2. Servlets</h3>
<div class="paragraph">
<p>Servlets process HTTP requests and return corresponding responses.</p>
</div>
<div class="sect3">
<h4 id="__code_httpservletdispatcher_code_resteasy">10.2.1. <code>HttpServletDispatcher</code> (RestEasy)</h4>
<div class="paragraph">
<p>This servlet is provided by the RestEasy framework, and does the dispatching to the resources defined by Apache Isis' <code>RestfulObjectsApplication</code> (see above).</p>
</div>
<div class="paragraph">
<p>Its definition is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>RestfulObjectsRestEasyDispatcher<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;servlet-class&gt;</span>org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher<span class="tag">&lt;/servlet-class&gt;</span>
<span class="tag">&lt;/servlet&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Its mapping is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet-mapping&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>RestfulObjectsRestEasyDispatcher<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>/restful/*<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__code_resourceservlet_code">10.2.2. <code>ResourceServlet</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
WIP
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Its definition is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>Resource<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;servlet-class&gt;</span>org.apache.isis.core.webapp.content.ResourceServlet<span class="tag">&lt;/servlet-class&gt;</span>
<span class="tag">&lt;/servlet&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Its mapping is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet-mapping&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>Resource<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>*.css<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span>
<span class="tag">&lt;servlet-mapping&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>Resource<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>*.png<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span>
<span class="tag">&lt;servlet-mapping&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>Resource<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>*.jpg<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span>
<span class="tag">&lt;servlet-mapping&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>Resource<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>*.gif<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span>
<span class="tag">&lt;servlet-mapping&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>Resource<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>*.js<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span>
<span class="tag">&lt;servlet-mapping&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>Resource<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>*.html<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span>
<span class="tag">&lt;servlet-mapping&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>Resource<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>*.swf<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_web-xml_filters">10.3. Filters</h3>
<div class="paragraph">
<p>The order in which filters appear in <code>web.xml</code> matters: first to last they define a pipeline.  This is shown in the above diagrams, and the subsections also list the in the same order that they should appear in your <code>web.xml</code>.</p>
</div>
<div class="sect3">
<h4 id="__code_shirofilter_code_shiro">10.3.1. <code>ShiroFilter</code> (Shiro)</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
WIP
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Its definition is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>ShiroFilter<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;filter-class&gt;</span>org.apache.shiro.web.servlet.ShiroFilter<span class="tag">&lt;/filter-class&gt;</span>
<span class="tag">&lt;/filter&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Its mapping is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter-mapping&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>ShiroFilter<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>/*<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/filter-mapping&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__code_isislogonexceptionfilter_code">10.3.2. <code>IsisLogOnExceptionFilter</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
WIP
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Its definition is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>IsisLogOnExceptionFilter<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;filter-class&gt;</span>org.apache.isis.core.webapp.diagnostics.IsisLogOnExceptionFilter<span class="tag">&lt;/filter-class&gt;</span>
<span class="tag">&lt;/filter&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Its mapping is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter-mapping&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>IsisLogOnExceptionFilter<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>/wicket/*<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/filter-mapping&gt;</span>
<span class="tag">&lt;filter-mapping&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>IsisLogOnExceptionFilter<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>/restful/*<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/filter-mapping&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__code_resourcecachingfilter_code">10.3.3. <code>ResourceCachingFilter</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
WIP
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Its definition is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>ResourceCachingFilter<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;filter-class&gt;</span>org.apache.isis.core.webapp.content.ResourceCachingFilter<span class="tag">&lt;/filter-class&gt;</span>
    <span class="tag">&lt;init-param&gt;</span>
        <span class="tag">&lt;param-name&gt;</span>CacheTime<span class="tag">&lt;/param-name&gt;</span>      <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tag">&lt;param-value&gt;</span>86400<span class="tag">&lt;/param-value&gt;</span>
    <span class="tag">&lt;/init-param&gt;</span>
<span class="tag">&lt;/filter&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>cache time, in seconds</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Its mapping is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter-mapping&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>ResourceCachingFilter<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>*.js<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/filter-mapping&gt;</span>
<span class="tag">&lt;filter-mapping&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>ResourceCachingFilter<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>*.css<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/filter-mapping&gt;</span>
<span class="tag">&lt;filter-mapping&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>ResourceCachingFilter<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>*.png<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/filter-mapping&gt;</span>
<span class="tag">&lt;filter-mapping&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>ResourceCachingFilter<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>*.jpg<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/filter-mapping&gt;</span>
<span class="tag">&lt;filter-mapping&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>ResourceCachingFilter<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>*.gif<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/filter-mapping&gt;</span>
<span class="tag">&lt;filter-mapping&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>ResourceCachingFilter<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>*.html<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/filter-mapping&gt;</span>
<span class="tag">&lt;filter-mapping&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>ResourceCachingFilter<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>*.swf<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/filter-mapping&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__code_wicketfilter_code">10.3.4. <code>WicketFilter</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
WIP
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Its definition is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>WicketFilter<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;filter-class&gt;</span>org.apache.wicket.protocol.http.WicketFilter<span class="tag">&lt;/filter-class&gt;</span>
    <span class="tag">&lt;init-param&gt;</span>
        <span class="tag">&lt;param-name&gt;</span>applicationClassName<span class="tag">&lt;/param-name&gt;</span>   <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tag">&lt;param-value&gt;</span>domainapp.webapp.SimpleApplication<span class="tag">&lt;/param-value&gt;</span>
    <span class="tag">&lt;/init-param&gt;</span>
<span class="tag">&lt;/filter&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>specify the application (subclass of <code>IsisWicketApplication</code>) to use</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Its mapping is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter-mapping&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>WicketFilter<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>/wicket/*<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/filter-mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This filter reads one context parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>configuration<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>deployment<span class="tag">&lt;/param-value&gt;</span>   <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>alternatively set to "development"; see <a href="#_rg_runtime_deployment-types">deployment types</a> for further discussion.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="__code_isissessionfilter_code">10.3.5. <code>IsisSessionFilter</code></h4>
<div class="paragraph">
<p>The <code>IsisSessionFilter</code> is responsible for the (persistence) session management; in effect a wrapper around DataNucleus' <code>PersistenceManager</code> object.  It is only required for the Restful Objects viewer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>IsisSessionFilterForRestfulObjects<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;filter-class&gt;</span>org.apache.isis.core.webapp.IsisSessionFilter<span class="tag">&lt;/filter-class&gt;</span>
    <span class="tag">&lt;init-param&gt;</span>
        <span class="tag">&lt;param-name&gt;</span>authenticationSessionStrategy<span class="tag">&lt;/param-name&gt;</span>  <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tag">&lt;param-value&gt;</span>
            org.apache.isis.viewer.restfulobjects.server.authentication.AuthenticationSessionStrategyBasicAuth
        <span class="tag">&lt;/param-value&gt;</span>
    <span class="tag">&lt;/init-param&gt;</span>
    <span class="tag">&lt;init-param&gt;</span>
        <span class="tag">&lt;param-name&gt;</span>whenNoSession<span class="tag">&lt;/param-name&gt;</span>                  <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="tag">&lt;param-value&gt;</span>basicAuthChallenge<span class="tag">&lt;/param-value&gt;</span>
    <span class="tag">&lt;/init-param&gt;</span>
    <span class="comment">&lt;!--
    &lt;init-param&gt;
        &lt;param-name&gt;restricted&lt;/param-name&gt;                     <i class="conum" data-value="3"></i><b>(3)</b>
        &lt;param-value&gt;...&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
        &lt;param-name&gt;redirectToOnException&lt;/param-name&gt;          <i class="conum" data-value="4"></i><b>(4)</b>
        &lt;param-value&gt;...&lt;/param-value&gt;
    &lt;/init-param&gt;
    --&gt;</span>
<span class="tag">&lt;/filter&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>pluggable strategy for determining what the authentication session (credentials) are of the request</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>what the servlet should do if no existing session was found; typically a 401, or can issue a Basic Auth challenge</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>List of paths that are allowed through even if not authenticated.  The servlets mapped to these paths are expected to be able to deal with there being no session. Typically they will be logon pages.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>where to redirect to if an exception occurs.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This filter should be mapped to the <code>servlet-name</code> for the RestEasy <code>HttpServletDispatcher</code>; for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter-mapping&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>IsisSessionFilterForRestfulObjects<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>RestfulObjectsRestEasyDispatcher<span class="tag">&lt;/servlet-name&gt;</span>
<span class="tag">&lt;/filter-mapping&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__code_isistransactionfilterforrestfulobjects_code">10.3.6. <code>IsisTransactionFilterForRestfulObjects</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
WIP
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Its definition is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>IsisTransactionFilterForRestfulObjects<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;filter-class&gt;</span>org.apache.isis.viewer.restfulobjects.server.webapp.IsisTransactionFilterForRestfulObjects<span class="tag">&lt;/filter-class&gt;</span>
<span class="tag">&lt;/filter&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This filter should be mapped to the <code>servlet-name</code> for the RestEasy <code>HttpServletDispatcher</code>; for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter-mapping&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>IsisTransactionFilterForRestfulObjects<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>RestfulObjectsRestEasyDispatcher<span class="tag">&lt;/servlet-name&gt;</span>
<span class="tag">&lt;/filter-mapping&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rg_web-xml_context-parameters">10.4. Configuration Files</h3>
<div class="paragraph">
<p>However Apache Isis is bootstrapped (using the <code>IsisWicketApplication</code> or using <code>IsisWebAppBootstrapper</code>), it will read a number of configuration files, such as <code>isis.properties</code>.</p>
</div>
<div class="paragraph">
<p>By default these are read from <code>WEB-INF</code> directory.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;context-param&gt;
  &lt;param-name&gt;isis.config.dir&lt;/param-name&gt;
  &lt;param-value&gt;location of your config directory if fixed&lt;/param-value&gt;
&lt;/context-param&gt;
--&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!--
determines which additional configuration files to search for
 --&gt;
&lt;context-param&gt;
    &lt;param-name&gt;isis.viewers&lt;/param-name&gt;
    &lt;param-value&gt;wicket,restfulobjects&lt;/param-value&gt;
&lt;/context-param&gt;</pre>
</div>
</div>
</div>
</div>
</div>
        </div>

        <footer>
          <hr>
          <p class="small">
          Copyright &copy; 2010~2015 The Apache&nbsp;Software&nbsp;Foundation, licensed under the Apache&nbsp;License,&nbsp;v2.0.
          <br/>
          Apache, the Apache feather logo, Apache&nbsp;Isis, and the Apache&nbsp;Isis project logo are all trademarks of The&nbsp;Apache&nbsp;Software&nbsp;Foundation.
          </p>
        </footer>

    </div>

    <div id="doc-content-right" class="large-3 medium-3 xcolumns">
        <div id="toc" class="toc2">
            <div class="fallback-toc">
                <ul class="sectlevel1">
<li><a href="#_rg">1. Reference Guide</a></li>
<li><a href="#_rg_annotations">2. Annotations</a>
<ul class="sectlevel2">
<li><a href="#_rg_annotations_aaa">2.1. Summary</a>
<ul class="sectlevel3">
<li><a href="#_rg_annotations_aaa_main">2.1.1. Core annotations</a></li>
<li><a href="#_rg_annotations_aaa_other">2.1.2. Other Isis Annotations</a></li>
<li><a href="#_rg_annotations_aaa_jee">2.1.3. JDO Annotations</a></li>
<li><a href="#_rg_annotations_aaa_jee">2.1.4. Java EE Annotations</a></li>
<li><a href="#_rg_annotations_aaa_deprecated">2.1.5. Deprecated Annotations</a></li>
<li><a href="#_rg_annotations_aaa_partial">2.1.6. Incomplete/partial support</a></li>
</ul>
</li>
<li><a href="#_rg_annotations_manpage-Action">2.2. <code>@Action</code></a>
<ul class="sectlevel3">
<li><a href="#_rg_annotations_manpage-Action_command">2.2.1. <code>command()</code></a>
<ul class="sectlevel4">
<li><a href="#__code_commandpersistence_code"><code>commandPersistence()</code></a></li>
<li><a href="#__code_commandexecutein_code"><code>commandExecuteIn()</code></a></li>
</ul>
</li>
<li><a href="#_rg_annotations_manpage-Action_domainEvent">2.2.2. domainEvent()</a>
<ul class="sectlevel4">
<li><a href="#_subscribers">Subscribers</a></li>
<li><a href="#_raising_events_programmatically">Raising events programmatically</a></li>
</ul>
</li>
<li><a href="#_rg_annotations_manpage-Action_hidden">2.2.3. <code>hidden()</code></a></li>
<li><a href="#_rg_annotations_manpage-Action_invokeOn">2.2.4. <code>invokeOn()</code></a></li>
<li><a href="#_rg_annotations_manpage-Action_publishing">2.2.5. <code>publishing()</code></a>
<ul class="sectlevel4">
<li><a href="#__code_publishingpayloadfactory_code"><code>publishingPayloadFactory()</code></a></li>
</ul>
</li>
<li><a href="#_rg_annotations_manpage-Action_restrictTo">2.2.6. <code>restrictTo()</code></a></li>
<li><a href="#_rg_annotations_manpage-Action_semantics">2.2.7. <code>semantics()</code></a></li>
<li><a href="#_rg_annotations_manpage-Action_typeOf">2.2.8. <code>typeOf()</code></a></li>
</ul>
</li>
<li><a href="#_rg_annotations_manpage-ActionLayout">2.3. <code>@ActionLayout</code></a>
<ul class="sectlevel3">
<li><a href="#_rg_annotations_manpage-ActionLayout_bookmarking">2.3.1. <code>bookmarking()</code></a></li>
<li><a href="#_rg_annotations_manpage-ActionLayout_contributedAs">2.3.2. <code>contributedAs()</code></a></li>
<li><a href="#_rg_annotations_manpage-ActionLayout_cssClass">2.3.3. <code>cssClass()</code></a></li>
<li><a href="#_rg_annotations_manpage-ActionLayout_cssClassFa">2.3.4. <code>cssClassFa()</code></a></li>
<li><a href="#_rg_annotations_manpage-ActionLayout_describedAs">2.3.5. <code>describedAs()</code></a></li>
<li><a href="#_rg_annotations_manpage-ActionLayout_hidden">2.3.6. <code>hidden()</code></a></li>
<li><a href="#_rg_annotations_manpage-ActionLayout_named">2.3.7. <code>named()</code></a></li>
<li><a href="#_rg_annotations_manpage-ActionLayout_position">2.3.8. <code>position()</code></a></li>
</ul>
</li>
<li><a href="#_rg_annotations_manpage-Collection">2.4. <code>@Collection</code></a>
<ul class="sectlevel3">
<li><a href="#_rg_annotations_manpage-Collection_domainEvent">2.4.1. <code>domainEvent()</code></a>
<ul class="sectlevel4">
<li><a href="#_subscribers_2">Subscribers</a></li>
<li><a href="#_raising_events_programmatically_2">Raising events programmatically</a></li>
</ul>
</li>
<li><a href="#_rg_annotations_manpage-Collection_editing">2.4.2. <code>editing()</code></a></li>
<li><a href="#_rg_annotations_manpage-Collection_hidden">2.4.3. <code>hidden()</code></a></li>
<li><a href="#_rg_annotations_manpage-Collection_notPersisted">2.4.4. <code>notPersisted()</code></a></li>
<li><a href="#_rg_annotations_manpage-Collection_typeOf">2.4.5. <code>typeOf()</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_rg_annotations_manpage-Column">3. <code>@Column</code> (<code>javax.jdo</code>)</a>
<ul class="sectlevel2">
<li><a href="#_nullability">3.1. Nullability</a></li>
<li><a href="#_length_for_code_string_code_s">3.2. Length for <code>String</code>s</a></li>
<li><a href="#_length_scale_for_code_bigdecimal_code_s">3.3. Length/scale for <code>BigDecimal</code>s</a></li>
<li><a href="#_hints_and_tips">3.4. Hints and Tips</a>
<ul class="sectlevel3">
<li><a href="#_mapping_foreign_keys">3.4.1. Mapping foreign keys</a></li>
</ul>
</li>
<li><a href="#_mapping_code_blob_code_s_and_code_clob_code_s">3.5. Mapping <code>Blob</code>s and <code>Clob</code>s</a></li>
<li><a href="#_rg_annotations_manpage-Digits">3.6. <code>@Digits</code> (<code>javax</code>)</a></li>
<li><a href="#_rg_annotations_manpage-Discriminator">3.7. <code>@Discriminator</code> (<code>javax.jdo</code>)</a></li>
<li><a href="#_rg_annotations_manpage-DomainObject">3.8. <code>@DomainObject</code></a>
<ul class="sectlevel3">
<li><a href="#_rg_annotations_manpage-DomainObject_auditing">3.8.1. <code>auditing()</code></a></li>
<li><a href="#_rg_annotations_manpage-DomainObject_autoCompleteRepository">3.8.2. <code>autoCompleteRepository()</code></a>
<ul class="sectlevel4">
<li><a href="#__code_autocompleteaction_code"><code>autoCompleteAction()</code></a></li>
</ul>
</li>
<li><a href="#_rg_annotations_manpage-DomainObject_bounded">3.8.3. <code>bounded()</code></a></li>
<li><a href="#_rg_annotations_manpage-DomainObject_editing">3.8.4. <code>editing()</code></a></li>
<li><a href="#_rg_annotations_manpage-DomainObject_nature">3.8.5. <code>nature()</code></a></li>
<li><a href="#_rg_annotations_manpage-DomainObject_objectType">3.8.6. <code>objectType()</code></a></li>
<li><a href="#_rg_annotations_manpage-DomainObject_publishing">3.8.7. <code>publishing()</code></a>
<ul class="sectlevel4">
<li><a href="#__code_publishingpayloadfactory_code_2"><code>publishingPayloadFactory()</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_rg_annotations_manpage-DomainObjectLayout">3.9. <code>@DomainObjectLayout</code></a>
<ul class="sectlevel3">
<li><a href="#_rg_annotations_manpage-DomainObjectLayout_bookmarking">3.9.1. <code>bookmarking()</code></a></li>
<li><a href="#_rg_annotations_manpage-DomainObjectLayout_cssClass">3.9.2. <code>cssClass()</code></a></li>
<li><a href="#_rg_annotations_manpage-DomainObjectLayout_cssClassFa">3.9.3. <code>cssClassFa()</code></a></li>
<li><a href="#_rg_annotations_manpage-DomainObjectLayout_describedAs">3.9.4. <code>describedAs()</code></a></li>
<li><a href="#_rg_annotations_manpage-DomainObjectLayout_named">3.9.5. <code>named()</code></a></li>
<li><a href="#_rg_annotations_manpage-DomainObjectLayout_paged">3.9.6. <code>paged()</code></a></li>
<li><a href="#_rg_annotations_manpage-DomainObjectLayout_plural">3.9.7. <code>plural()</code></a></li>
</ul>
</li>
<li><a href="#_rg_annotations_manpage-DomainService">3.10. <code>@DomainService</code></a>
<ul class="sectlevel3">
<li><a href="#_rg_annotations_manpage-DomainService_nature">3.10.1. <code>nature()</code></a></li>
<li><a href="#_rg_annotations_manpage-DomainService_repositoryFor">3.10.2. <code>repositoryFor()</code></a></li>
</ul>
</li>
<li><a href="#_rg_annotations_manpage-DomainServiceLayout">3.11. <code>@DomainServiceLayout</code></a>
<ul class="sectlevel3">
<li><a href="#_rg_annotations_manpage-DomainServiceLayout_menuBar">3.11.1. <code>menuBar()</code></a></li>
<li><a href="#_rg_annotations_manpage-DomainServiceLayout_menuOrder">3.11.2. <code>menuOrder()</code></a></li>
<li><a href="#_rg_annotations_manpage-DomainServiceLayout_named">3.11.3. <code>named()</code></a></li>
</ul>
</li>
<li><a href="#_rg_annotations_manpage-Facets">3.12. <code>@Facets</code></a></li>
<li><a href="#_rg_annotations_manpage-HomePage">3.13. <code>@HomePage</code></a></li>
<li><a href="#_rg_annotations_manpage-Inject">3.14. <code>@Inject</code> (<code>javax</code>)</a>
<ul class="sectlevel3">
<li><a href="#_alternative_syntaxes">3.14.1. Alternative syntaxes</a></li>
<li><a href="#_manually_injecting_services">3.14.2. Manually injecting services</a></li>
</ul>
</li>
<li><a href="#_rg_annotations_manpage-MemberGroupLayout">3.15. <code>@MemberGroupLayout</code></a></li>
<li><a href="#_rg_annotations_manpage-MemberOrder">3.16. <code>@MemberOrder</code></a></li>
<li><a href="#_rg_annotations_manpage-NotPersistent">3.17. <code>@NotPersistent</code> (<code>javax.jdo</code>)</a></li>
<li><a href="#_rg_annotations_manpage-MinLength">3.18. <code>@MinLength</code></a></li>
<li><a href="#_rg_annotations_manpage-Parameter">3.19. <code>@Parameter</code></a>
<ul class="sectlevel3">
<li><a href="#_rg_annotations_manpage-Parameter_maxLength">3.19.1. <code>maxLength()</code></a></li>
<li><a href="#_rg_annotations_manpage-Parameter_mustSatisfy">3.19.2. <code>mustSatisfy()</code></a></li>
<li><a href="#_rg_annotations_manpage-Parameter_optionality">3.19.3. <code>optionality()</code></a></li>
<li><a href="#_rg_annotations_manpage-Parameter_regexPattern">3.19.4. <code>regexPattern()</code></a></li>
</ul>
</li>
<li><a href="#_rg_annotations_manpage-ParameterLayout">3.20. <code>@ParameterLayout</code></a>
<ul class="sectlevel3">
<li><a href="#_rg_annotations_manpage-ParameterLayout_cssClass">3.20.1. <code>cssClass()</code></a></li>
<li><a href="#_rg_annotations_manpage-ParameterLayout_describedAs">3.20.2. <code>describedAs()</code></a></li>
<li><a href="#_rg_annotations_manpage-ParameterLayout_labelPosition">3.20.3. <code>labelPosition()</code></a></li>
<li><a href="#_rg_annotations_manpage-ParameterLayout_multiLine">3.20.4. <code>multiLine()</code></a></li>
<li><a href="#_rg_annotations_manpage-ParameterLayout_named">3.20.5. <code>named()</code></a></li>
<li><a href="#_rg_annotations_manpage-ParameterLayout_renderedAsDayBefore">3.20.6. <code>renderedAsDayBefore()</code></a></li>
<li><a href="#_rg_annotations_manpage-ParameterLayout_typicalLength">3.20.7. <code>typicalLength()</code></a></li>
</ul>
</li>
<li><a href="#_rg_annotations_manpage-PersistenceCapable">3.21. <code>@PersistenceCapable</code> (<code>javax.jdo</code>)</a></li>
<li><a href="#_rg_annotations_manpage-PostConstruct">3.22. <code>@PostConstruct</code> (<code>javax</code>)</a></li>
<li><a href="#_rg_annotations_manpage-PreDestroy">3.23. <code>@PreDestroy</code> (<code>javax</code>)</a></li>
<li><a href="#_rg_annotations_manpage-PrimaryKey">3.24. <code>@PrimaryKey</code> (<code>javax.jdo</code>)</a></li>
<li><a href="#_rg_annotations_manpage-Programmatic">3.25. <code>@Programmatic</code></a></li>
<li><a href="#_rg_annotations_manpage-Property">3.26. <code>@Property</code></a>
<ul class="sectlevel3">
<li><a href="#_rg_annotations_manpage-Property_domainEvent">3.26.1. <code>domainEvent()</code></a>
<ul class="sectlevel4">
<li><a href="#_subscribers_3">Subscribers</a></li>
<li><a href="#_raising_events_programmatically_3">Raising events programmatically</a></li>
</ul>
</li>
<li><a href="#_rg_annotations_manpage-Property_editing">3.26.2. <code>editing()</code></a></li>
<li><a href="#_rg_annotations_manpage-Property_hidden">3.26.3. <code>hidden()</code></a></li>
<li><a href="#_rg_annotations_manpage-Property_maxLength">3.26.4. <code>maxLength()</code></a>
<ul class="sectlevel4">
<li><a href="#_non_persistent_properties">Non-persistent properties</a></li>
</ul>
</li>
<li><a href="#_rg_annotations_manpage-Property_mustSatisfy">3.26.5. <code>mustSatisfy()</code></a></li>
<li><a href="#_rg_annotations_manpage-Property_notPersisted">3.26.6. <code>notPersisted()</code></a></li>
<li><a href="#_rg_annotations_manpage-Property_optionality">3.26.7. <code>optionality()</code></a>
<ul class="sectlevel4">
<li><a href="#_mismatched_defaults">Mismatched defaults</a></li>
<li><a href="#_superclass_inheritance_type">Superclass inheritance type</a></li>
<li><a href="#_non_persistent_properties_2">Non-persistent properties</a></li>
</ul>
</li>
<li><a href="#_rg_annotations_manpage-Property_regexPattern">3.26.8. <code>regexPattern()</code></a></li>
</ul>
</li>
<li><a href="#_rg_annotations_manpage-PropertyLayout">3.27. <code>@PropertyLayout</code></a>
<ul class="sectlevel3">
<li><a href="#_rg_annotations_manpage-PropertyLayout_cssClass">3.27.1. <code>cssClass()</code></a></li>
<li><a href="#_rg_annotations_manpage-PropertyLayout_describedAs">3.27.2. <code>describedAs()</code></a></li>
<li><a href="#_rg_annotations_manpage-PropertyLayout_labelPosition">3.27.3. <code>labelPosition()</code></a></li>
<li><a href="#_rg_annotations_manpage-PropertyLayout_multiLine">3.27.4. <code>multiLine()</code></a></li>
<li><a href="#_rg_annotations_manpage-PropertyLayout_named">3.27.5. named()</a></li>
<li><a href="#_rg_annotations_manpage-PropertyLayout_renderedAsDayBefore">3.27.6. <code>renderedAsDayBefore()</code></a></li>
<li><a href="#_rg_annotations_manpage-PropertyLayout_typicalLength">3.27.7. <code>typicalLength()</code></a></li>
</ul>
</li>
<li><a href="#_rg_annotations_manpage-RequestScoped">3.28. <code>@RequestScoped</code> (<code>javax</code>)</a></li>
<li><a href="#_rg_annotations_manpage-Title">3.29. <code>@Title</code></a></li>
</ul>
</li>
<li><a href="#_rg_methods">4. Methods</a>
<ul class="sectlevel2">
<li><a href="#_rg_methods_prefixes">4.1. Supporting Method Prefixes</a>
<ul class="sectlevel3">
<li><a href="#_rg_methods_prefixes_manpage-addTo">4.1.1. <code>addTo&#8230;&#8203;()</code></a></li>
<li><a href="#_rg_methods_prefixes_manpage-autoComplete">4.1.2. <code>autoComplete&#8230;&#8203;()</code></a>
<ul class="sectlevel4">
<li><a href="#_parameters">Parameters</a></li>
<li><a href="#_properties">Properties</a></li>
</ul>
</li>
<li><a href="#_rg_methods_prefixes_manpage-choices">4.1.3. <code>choices&#8230;&#8203;()</code></a>
<ul class="sectlevel4">
<li><a href="#_parameters_2">Parameters</a></li>
<li><a href="#_properties_2">Properties</a></li>
</ul>
</li>
<li><a href="#_rg_methods_prefixes_manpage-clear">4.1.4. <code>clear&#8230;&#8203;()</code></a></li>
<li><a href="#_rg_methods_prefixes_manpage-default">4.1.5. <code>default&#8230;&#8203;()</code></a>
<ul class="sectlevel4">
<li><a href="#_parameters_3">Parameters</a></li>
<li><a href="#_properties_3">Properties</a></li>
</ul>
</li>
<li><a href="#_rg_methods_prefixes_manpage-disable">4.1.6. <code>disable&#8230;&#8203;()</code></a>
<ul class="sectlevel4">
<li><a href="#_actions">Actions</a></li>
<li><a href="#_properties_and_collections">Properties and Collections</a></li>
</ul>
</li>
<li><a href="#_rg_methods_prefixes_manpage-get">4.1.7. <code>get&#8230;&#8203;()</code></a></li>
<li><a href="#_rg_methods_prefixes_manpage-hide">4.1.8. <code>hide&#8230;&#8203;()</code></a>
<ul class="sectlevel4">
<li><a href="#_actions_2">Actions</a></li>
<li><a href="#_properties_and_collections_2">Properties and Collections</a></li>
</ul>
</li>
<li><a href="#_rg_methods_prefixes_manpage-modify">4.1.9. <code>modify&#8230;&#8203;()</code></a></li>
<li><a href="#_rg_methods_prefixes_manpage-removeFrom">4.1.10. <code>removeFrom&#8230;&#8203;()</code></a></li>
<li><a href="#_rg_methods_prefixes_manpage-set">4.1.11. <code>set&#8230;&#8203;()</code></a></li>
<li><a href="#_rg_methods_prefixes_manpage-validate">4.1.12. <code>validate&#8230;&#8203;()</code></a>
<ul class="sectlevel4">
<li><a href="#_action_parameter">Action Parameter</a></li>
<li><a href="#_action_parameter_set">Action Parameter Set</a></li>
<li><a href="#_properties_4">Properties</a></li>
</ul>
</li>
<li><a href="#_rg_methods_prefixes_manpage-validateAddTo">4.1.13. <code>validateAddTo&#8230;&#8203;()</code></a></li>
<li><a href="#_rg_methods_prefixes_manpage-validateRemoveFrom">4.1.14. <code>validateRemoveFrom&#8230;&#8203;()</code></a></li>
</ul>
</li>
<li><a href="#_rg_methods_reserved">4.2. Reserved Methods</a>
<ul class="sectlevel3">
<li><a href="#_rg_methods_reserved_manpage-cssClass">4.2.1. <code>cssClass()</code></a></li>
<li><a href="#_rg_methods_reserved_manpage-disable">4.2.2. <code>disable()</code></a>
<ul class="sectlevel4">
<li><a href="#_alternatives_2">Alternatives</a></li>
</ul>
</li>
<li><a href="#_rg_methods_reserved_manpage-getId">4.2.3. <code>getId()</code></a></li>
<li><a href="#_rg_methods_reserved_manpage-hide">4.2.4. <code>hide()</code></a>
<ul class="sectlevel4">
<li><a href="#_alternatives_3">Alternatives</a></li>
</ul>
</li>
<li><a href="#_rg_methods_reserved_manpage-iconName">4.2.5. <code>iconName()</code></a></li>
<li><a href="#_rg_methods_reserved_manpage-title">4.2.6. <code>title()</code></a></li>
<li><a href="#_rg_methods_reserved_manpage-validate">4.2.7. <code>validate()</code></a></li>
</ul>
</li>
<li><a href="#_rg_methods_lifecycle">4.3. Lifecycle Methods</a>
<ul class="sectlevel3">
<li><a href="#_rg_methods_reserved_manpage-created">4.3.1. <code>created()</code></a></li>
<li><a href="#_rg_methods_reserved_manpage-loaded">4.3.2. <code>loaded()</code></a></li>
<li><a href="#_rg_methods_reserved_manpage-persisted">4.3.3. <code>persisted()</code></a></li>
<li><a href="#_rg_methods_reserved_manpage-persisting">4.3.4. <code>persisting()</code></a></li>
<li><a href="#_rg_methods_reserved_manpage-removed">4.3.5. <code>removed()</code></a></li>
<li><a href="#_rg_methods_reserved_manpage-removing">4.3.6. <code>removing()</code></a></li>
<li><a href="#_rg_methods_reserved_manpage-updated">4.3.7. <code>updated()</code></a></li>
<li><a href="#_rg_methods_reserved_manpage-updating">4.3.8. <code>updating()</code></a></li>
<li><a href="#_rg_methods_lifecycle_jdo-api">4.3.9. Using the JDO API</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_rg_services-api">5. Domain Services API</a>
<ul class="sectlevel2">
<li><a href="#_rg_services-api_manpage-ActionInvocationContext">5.1. <code>ActionInvocationContext</code></a>
<ul class="sectlevel3">
<li><a href="#_api">5.1.1. API</a></li>
<li><a href="#_usage">5.1.2. Usage</a></li>
<li><a href="#_registering_the_service">5.1.3. Registering the Service</a></li>
<li><a href="#_unit_testing_support">5.1.4. Unit testing support</a></li>
</ul>
</li>
<li><a href="#_rg_services-api_manpage-BackgroundService">5.2. <code>BackgroundService</code></a>
<ul class="sectlevel3">
<li><a href="#_api_implementation">5.2.1. API &amp; Implementation</a></li>
<li><a href="#_usage_2">5.2.2. Usage</a></li>
<li><a href="#_end_user_experience">5.2.3. End-user experience</a></li>
<li><a href="#_registering_the_services">5.2.4. Registering the Services</a></li>
<li><a href="#_related_services">5.2.5. Related Services</a></li>
<li><a href="#_rg_services-api_manpage-BackgroundService_BackgroundCommandExecution">5.2.6. <code>BackgroundCommandExecution</code> abstract class</a></li>
<li><a href="#_rg_services-api_manpage-BackgroundService_Quartz">5.2.7. Quartz Scheduler Configuration</a></li>
</ul>
</li>
<li><a href="#_rg_services-api_manpage-BookmarkService">5.3. <code>BookmarkService</code></a>
<ul class="sectlevel3">
<li><a href="#_api_implementation_2">5.3.1. API &amp; Implementation</a></li>
<li><a href="#__code_bookmarkholder_code">5.3.2. <code>BookmarkHolder</code></a></li>
<li><a href="#_usage_by_other_services">5.3.3. Usage by other services</a></li>
<li><a href="#_registering_the_service_2">5.3.4. Registering the Service</a></li>
</ul>
</li>
<li><a href="#_rg_services-api_manpage-ClockService">5.4. <code>ClockService</code></a>
<ul class="sectlevel3">
<li><a href="#_api_implementation_3">5.4.1. API &amp; Implementation</a></li>
<li><a href="#_testing_support">5.4.2. Testing Support</a>
<ul class="sectlevel4">
<li><a href="#_alternative_implementations">Alternative Implementations</a></li>
</ul>
</li>
<li><a href="#_registering_the_service_3">5.4.3. Registering the Service</a></li>
</ul>
</li>
<li><a href="#_rg_services-api_manpage-CommandContext">5.5. <code>CommandContext</code></a>
<ul class="sectlevel3">
<li><a href="#_rg_services-api_manpage-CommandContext_screencast">5.5.1. Screencast</a></li>
<li><a href="#_api_implementation_4">5.5.2. API &amp; Implementation</a></li>
<li><a href="#_usage_3">5.5.3. Usage</a></li>
<li><a href="#_interacting_with_the_services">5.5.4. Interacting with the services</a></li>
<li><a href="#_registering_the_services_2">5.5.5. Registering the Services</a></li>
<li><a href="#_related_services_2">5.5.6. Related Services</a></li>
</ul>
</li>
<li><a href="#_rg_services-api_manpage-DeepLinkService">5.6. <code>DeepLinkService</code></a>
<ul class="sectlevel3">
<li><a href="#_api_implementation_5">5.6.1. API &amp; Implementation</a></li>
<li><a href="#_usage_within_the_framework">5.6.2. Usage within the framework</a></li>
<li><a href="#_implementations">5.6.3. Implementations</a></li>
<li><a href="#_registering_the_services_3">5.6.4. Registering the Services</a></li>
</ul>
</li>
<li><a href="#_rg_services-api_manpage-DomainObjectContainer">5.7. <code>DomainObjectContainer</code></a>
<ul class="sectlevel3">
<li><a href="#_rg_services-api_manpage-DomainObjectContainer_object-creation-api">5.7.1. Object Creation API</a></li>
<li><a href="#_rg_services-api_manpage-DomainObjectContainer_generic-repository-api">5.7.2. Generic Repository API</a></li>
<li><a href="#_rg_services-api_manpage-DomainObjectContainer_object-persistence-api">5.7.3. Object Persistence API</a></li>
<li><a href="#_rg_services-api_manpage-DomainObjectContainer_messages-api">5.7.4. Messages API</a></li>
<li><a href="#_rg_services-api_manpage-DomainObjectContainer_security-api">5.7.5. Security API</a></li>
<li><a href="#_rg_services-api_manpage-DomainObjectContainer_presentation-api">5.7.6. Presentation API</a></li>
<li><a href="#_rg_services-api_manpage-DomainObjectContainer_validation-api">5.7.7. Validation API</a></li>
<li><a href="#_rg_services-api_manpage-DomainObjectContainer_properties-api">5.7.8. Properties API</a></li>
<li><a href="#_rg_services-api_manpage-DomainObjectContainer_services-api">5.7.9. Services API</a></li>
<li><a href="#_registering_the_service_4">5.7.10. Registering the Service</a></li>
</ul>
</li>
<li><a href="#_rg_services-api_manpage-EmailService">5.8. <code>EmailService</code></a>
<ul class="sectlevel3">
<li><a href="#_api_implementation_6">5.8.1. API &amp; Implementation</a></li>
<li><a href="#_configuration">5.8.2. Configuration</a></li>
<li><a href="#_alternative_implementations_2">5.8.3. Alternative Implementations</a></li>
<li><a href="#_registering_the_services_4">5.8.4. Registering the Services</a></li>
<li><a href="#_related_services_3">5.8.5. Related Services</a></li>
</ul>
</li>
<li><a href="#_rg_services-api_manpage-EventBusService">5.9. <code>EventBusService</code></a>
<ul class="sectlevel3">
<li><a href="#_rg_services-api_manpage-EventBusService_api-and-implementation">5.9.1. API &amp; Implementation</a></li>
<li><a href="#_registering_subscribers">5.9.2. Registering Subscribers</a></li>
<li><a href="#_annotating_members">5.9.3. Annotating Members</a></li>
<li><a href="#_rg_services-api_manpage-EventBusService_event-hierarchy">5.9.4. Event hierarchy</a></li>
<li><a href="#_programmatic_posting">5.9.5. Programmatic posting</a></li>
<li><a href="#_using_code_wrapperfactory_code">5.9.6. Using <code>WrapperFactory</code></a></li>
<li><a href="#_implementation_spi">5.9.7. Implementation SPI</a></li>
<li><a href="#_rg_services-api_manpage-EventBusService_Configuration">5.9.8. Configuration</a></li>
<li><a href="#_registering_the_services_5">5.9.9. Registering the Services</a></li>
<li><a href="#_related_services_4">5.9.10. Related Services</a></li>
</ul>
</li>
<li><a href="#_rg_services-api_manpage-FixtureScriptsDefault">5.10. <code>FixtureScriptsDefault</code></a>
<ul class="sectlevel3">
<li><a href="#_api_implementation_7">5.10.1. API &amp; Implementation</a></li>
<li><a href="#_configuration_2">5.10.2. Configuration</a></li>
<li><a href="#_related_services_5">5.10.3. Related Services</a></li>
</ul>
</li>
<li><a href="#_rg_services-api_manpage-GuiceBeanProvider">5.11. <code>GuiceBeanProvider</code></a>
<ul class="sectlevel3">
<li><a href="#_api_implementation_8">5.11.1. API &amp; Implementation</a></li>
<li><a href="#_usage_4">5.11.2. Usage</a></li>
<li><a href="#_registering_the_services_6">5.11.3. Registering the Services</a></li>
</ul>
</li>
<li><a href="#_rg_services-api_manpage-IsisJdoSupport">5.12. <code>IsisJdoSupport</code></a>
<ul class="sectlevel3">
<li><a href="#_rg_services-api_manpage-IsisJdoSupport_executing-sql">5.12.1. Executing SQL</a></li>
<li><a href="#_rg_services-api_manpage-IsisJdoSupport_type-safe-jdoql-queries">5.12.2. Type-safe JDOQL Queries</a></li>
<li><a href="#_rg_services-api_manpage-IsisJdoSupport_fixture-support">5.12.3. Fixture support</a></li>
<li><a href="#_rg_services-api_manpage-IsisJdoSupport_reloading-entities">5.12.4. Reloading entities</a></li>
<li><a href="#_rg_services-api_manpage-IsisJdoSupport_jdo-persistencemanager">5.12.5. JDO <code>PersistenceManager</code></a></li>
<li><a href="#_registering_the_services_7">5.12.6. Registering the Services</a></li>
</ul>
</li>
<li><a href="#_rg_services-api_manpage-MementoService">5.13. <code>MementoService</code></a>
<ul class="sectlevel3">
<li><a href="#_api_implementation_9">5.13.1. API &amp; Implementation</a></li>
<li><a href="#_usage_5">5.13.2. Usage</a></li>
<li><a href="#_related_services_6">5.13.3. Related Services</a></li>
<li><a href="#_registering_the_service_5">5.13.4. Registering the Service</a></li>
</ul>
</li>
<li><a href="#_rg_services-api_manpage-MetamodelService">5.14. <code>MetamodelService</code></a>
<ul class="sectlevel3">
<li><a href="#_api_implementation_10">5.14.1. API &amp; Implementation</a></li>
<li><a href="#_registering_the_service_6">5.14.2. Registering the Service</a></li>
</ul>
</li>
<li><a href="#_rg_services-api_manpage-QueryResultsCache">5.15. <code>QueryResultsCache</code></a>
<ul class="sectlevel3">
<li><a href="#_api_implementation_11">5.15.1. API &amp; Implementation</a></li>
<li><a href="#_usage_6">5.15.2. Usage</a></li>
<li><a href="#_registering_the_service_7">5.15.3. Registering the Service</a></li>
<li><a href="#_related_services_7">5.15.4. Related Services</a></li>
</ul>
</li>
<li><a href="#_rg_services-api_manpage-Scratchpad">5.16. <code>Scratchpad</code></a>
<ul class="sectlevel3">
<li><a href="#_api_implementation_12">5.16.1. API &amp; Implementation</a></li>
<li><a href="#_usage_7">5.16.2. Usage</a></li>
<li><a href="#_registering_the_service_8">5.16.3. Registering the Service</a></li>
<li><a href="#_related_services_8">5.16.4. Related Services</a></li>
</ul>
</li>
<li><a href="#_rg_services-api_manpage-SudoService">5.17. <code>SudoService</code></a>
<ul class="sectlevel3">
<li><a href="#_api_implementation_13">5.17.1. API &amp; Implementation</a></li>
<li><a href="#_usage_8">5.17.2. Usage</a></li>
<li><a href="#_registering_the_service_9">5.17.3. Registering the Service</a></li>
</ul>
</li>
<li><a href="#_rg_services-api_manpage-WrapperFactory">5.18. <code>WrapperFactory</code></a>
<ul class="sectlevel3">
<li><a href="#_api_2">5.18.1. API</a></li>
<li><a href="#_usage_9">5.18.2. Usage</a></li>
<li><a href="#_listener_api">5.18.3. Listener API</a></li>
<li><a href="#_registering_the_service_10">5.18.4. Registering the Service</a></li>
</ul>
</li>
<li><a href="#_rg_services-api_manpage-XmlSnapshotService">5.19. <code>XmlSnapshotService</code></a>
<ul class="sectlevel3">
<li><a href="#_standard_api">5.19.1. Standard API</a></li>
<li><a href="#_builder_api">5.19.2. Builder API</a></li>
<li><a href="#_automatic_inclusions">5.19.3. Automatic inclusions</a></li>
<li><a href="#_convenience_api">5.19.4. Convenience API</a></li>
<li><a href="#_registering_the_service_11">5.19.5. Registering the Service</a></li>
<li><a href="#_related_services_9">5.19.6. Related Services</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_rg_services-spi">6. Domain Services SPI</a>
<ul class="sectlevel2">
<li><a href="#_rg_services-spi_manpage-AuditingService">6.1. <code>AuditingService3</code></a>
<ul class="sectlevel3">
<li><a href="#_spi">6.1.1. SPI</a></li>
<li><a href="#_implementation">6.1.2. Implementation</a></li>
<li><a href="#_usage_10">6.1.3. Usage</a></li>
<li><a href="#_registering_the_services_8">6.1.4. Registering the Services</a></li>
<li><a href="#_related_services_10">6.1.5. Related Services</a></li>
</ul>
</li>
<li><a href="#_rg_services-spi_manpage-BackgroundCommandService">6.2. <code>BackgroundCommandService</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_2">6.2.1. SPI</a></li>
<li><a href="#__internal_spi">6.2.2. "Internal" SPI</a></li>
<li><a href="#_implementation_2">6.2.3. Implementation</a></li>
<li><a href="#_usage_11">6.2.4. Usage</a></li>
<li><a href="#_registering_the_services_9">6.2.5. Registering the Services</a></li>
<li><a href="#_related_services_11">6.2.6. Related Services</a></li>
</ul>
</li>
<li><a href="#_rg_services-spi_manpage-ClassDiscoveryService">6.3. <code>ClassDiscoveryService</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_3">6.3.1. SPI</a></li>
<li><a href="#_implementation_3">6.3.2. Implementation</a></li>
<li><a href="#_usage_12">6.3.3. Usage</a></li>
<li><a href="#_registering_the_services_10">6.3.4. Registering the Services</a></li>
</ul>
</li>
<li><a href="#_rg_services-spi_manpage-CommandService">6.4. <code>CommandService</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_4">6.4.1. SPI</a></li>
<li><a href="#_implementation_4">6.4.2. Implementation</a></li>
<li><a href="#_usage_13">6.4.3. Usage</a></li>
<li><a href="#_registering_the_services_11">6.4.4. Registering the Services</a></li>
<li><a href="#_related_services_12">6.4.5. Related Services</a></li>
</ul>
</li>
<li><a href="#_rg_services-spi_manpage-ContentMappingService">6.5. <code>ContentMappingService</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_5">6.5.1. SPI</a></li>
<li><a href="#_implementations_2">6.5.2. Implementations</a></li>
<li><a href="#_related_services_13">6.5.3. Related Services</a></li>
</ul>
</li>
<li><a href="#_rg_services-spi_manpage-ContentNegotiationService">6.6. <code>ContentNegotiationService</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_6">6.6.1. SPI</a></li>
<li><a href="#_implementation_5">6.6.2. Implementation</a></li>
<li><a href="#_usage_14">6.6.3. Usage</a></li>
<li><a href="#_configuration_3">6.6.4. Configuration</a></li>
<li><a href="#_registering_the_services_12">6.6.5. Registering the Services</a></li>
<li><a href="#_related_services_14">6.6.6. Related Services</a></li>
</ul>
</li>
<li><a href="#_rg_services-spi_manpage-EmailNotificationService">6.7. <code>EmailNotificationService</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_7">6.7.1. SPI</a></li>
<li><a href="#_implementation_6">6.7.2. Implementation</a>
<ul class="sectlevel4">
<li><a href="#_alternative_implementations_3">Alternative Implementations</a></li>
</ul>
</li>
<li><a href="#_registering_the_service_12">6.7.3. Registering the Service</a></li>
<li><a href="#_related_services_15">6.7.4. Related Services</a></li>
</ul>
</li>
<li><a href="#_rg_services-spi_manpage-EventSerializer">6.8. <code>EventSerializer</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_8">6.8.1. SPI</a></li>
<li><a href="#_implementation_7">6.8.2. Implementation</a></li>
<li><a href="#_registering_the_services_13">6.8.3. Registering the Services</a></li>
<li><a href="#_related_services_16">6.8.4. Related Services</a></li>
</ul>
</li>
<li><a href="#_rg_services-spi_manpage-ExceptionRecognizer">6.9. <code>ExceptionRecognizer</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_9">6.9.1. SPI</a></li>
<li><a href="#_implementation_8">6.9.2. Implementation</a></li>
<li><a href="#_registering_the_services_14">6.9.3. Registering the Services</a></li>
</ul>
</li>
<li><a href="#_rg_services-spi_manpage-FixtureScriptsSpecificationProvider">6.10. <code>FixtureScriptsSpecificationProvider</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_10">6.10.1. SPI</a></li>
<li><a href="#_implementation_9">6.10.2. Implementation</a></li>
</ul>
</li>
<li><a href="#_rg_services-spi_manpage-LocaleProvider">6.11. <code>LocaleProvider</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_11">6.11.1. SPI</a></li>
<li><a href="#_implementation_10">6.11.2. Implementation</a></li>
<li><a href="#_registering_the_services_15">6.11.3. Registering the Services</a></li>
<li><a href="#_related_services_17">6.11.4. Related Services</a></li>
</ul>
</li>
<li><a href="#_rg_services-spi_manpage-PublishingService">6.12. <code>PublishingService</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_12">6.12.1. SPI</a></li>
<li><a href="#_implementation_11">6.12.2. Implementation</a></li>
<li><a href="#_usage_15">6.12.3. Usage</a></li>
<li><a href="#_registering_the_services_16">6.12.4. Registering the Services</a></li>
<li><a href="#_related_services_18">6.12.5. Related Services</a></li>
<li><a href="#_design_notes">6.12.6. Design Notes</a></li>
</ul>
</li>
<li><a href="#_rg_services-spi_manpage-RepresentationService">6.13. <code>RepresentationService</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_13">6.13.1. SPI</a></li>
<li><a href="#_implementation_12">6.13.2. Implementation</a></li>
<li><a href="#_registering_the_services_17">6.13.3. Registering the Services</a></li>
<li><a href="#_related_services_19">6.13.4. Related Services</a></li>
</ul>
</li>
<li><a href="#_rg_services-spi_manpage-TranslationService">6.14. <code>TranslationService</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_14">6.14.1. SPI</a></li>
<li><a href="#_implementation_13">6.14.2. Implementation</a></li>
<li><a href="#_registering_the_services_18">6.14.3. Registering the Services</a></li>
<li><a href="#_related_services_20">6.14.4. Related Services</a></li>
</ul>
</li>
<li><a href="#_rg_services-spi_manpage-TranslationsResolver">6.15. <code>TranslationsResolver</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_15">6.15.1. SPI</a></li>
<li><a href="#_implementation_14">6.15.2. Implementation</a></li>
<li><a href="#_registering_the_service_13">6.15.3. Registering the Service</a></li>
<li><a href="#_related_services_21">6.15.4. Related Services</a></li>
</ul>
</li>
<li><a href="#_rg_services-spi_manpage-UserProfileService">6.16. <code>UserProfileService</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_16">6.16.1. SPI</a></li>
<li><a href="#_implementation_15">6.16.2. Implementation</a></li>
</ul>
</li>
<li><a href="#_rg_services-spi_manpage-UserRegistrationService">6.17. <code>UserRegistrationService</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_17">6.17.1. SPI</a></li>
<li><a href="#_implementation_16">6.17.2. Implementation</a></li>
<li><a href="#_registering_the_services_19">6.17.3. Registering the Services</a></li>
<li><a href="#_related_services_22">6.17.4. Related Services</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_rg_classes">7. Classes and Interfaces</a>
<ul class="sectlevel2">
<li><a href="#_rg_classes_AppManifest-bootstrapping">7.1. <code>AppManifest</code> (bootstrapping)</a>
<ul class="sectlevel3">
<li><a href="#_api_3">7.1.1. API</a>
<ul class="sectlevel4">
<li><a href="#__code_getmodules_code"><code>getModules()</code></a></li>
<li><a href="#__code_getadditionalservices_code"><code>getAdditionalServices()</code></a></li>
<li><a href="#__code_getauthenticationmechanism_code"><code>getAuthenticationMechanism()</code></a></li>
<li><a href="#__code_getauthorizationmechanism_code"><code>getAuthorizationMechanism()</code></a></li>
<li><a href="#__code_getfixtures_code"><code>getFixtures()</code></a></li>
<li><a href="#__code_getconfigurationproperties_code"><code>getConfigurationProperties()</code></a></li>
</ul>
</li>
<li><a href="#_bootstrapping">7.1.2. Bootstrapping</a>
<ul class="sectlevel4">
<li><a href="#_integration_tests">Integration Tests</a></li>
<li><a href="#_webapps">Webapps</a></li>
</ul>
</li>
<li><a href="#_subsidiary_goals">7.1.3. Subsidiary Goals</a></li>
</ul>
</li>
<li><a href="#_rg_classes_super">7.2. Superclasses</a>
<ul class="sectlevel3">
<li><a href="#_rg_classes_super_manpage-AbstractContainedObject">7.2.1. <code>AbstractContainedObject</code></a></li>
<li><a href="#_rg_classes_super_manpage-AbstractDomainEvent">7.2.2. <code>AbstractDomainEvent</code></a></li>
<li><a href="#_rg_classes_super_manpage-AbstractDomainObject">7.2.3. <code>AbstractDomainObject</code></a></li>
<li><a href="#_rg_classes_super_manpage-AbstractFactoryAndRepository">7.2.4. <code>AbstractFactoryAndRepository</code></a></li>
<li><a href="#_rg_classes_super_manpage-AbstractService">7.2.5. <code>AbstractService</code></a></li>
<li><a href="#_rg_classes_super_manpage-AbstractViewModel">7.2.6. <code>AbstractViewModel</code></a></li>
<li><a href="#_rg_classes_super_manpage-ActionDomainEvent">7.2.7. <code>ActionDomainEvent</code></a></li>
<li><a href="#_rg_classes_super_manpage-CollectionDomainEvent">7.2.8. <code>CollectionDomainEvent</code></a></li>
<li><a href="#_rg_classes_super_manpage-FixtureScript">7.2.9. <code>FixtureScript</code></a></li>
<li><a href="#_rg_classes_super_manpage-FixtureScripts">7.2.10. <code>FixtureScripts</code></a></li>
<li><a href="#_rg_classes_super_manpage-PropertyDomainEvent">7.2.11. <code>PropertyDomainEvent</code></a></li>
</ul>
</li>
<li><a href="#_rg_classes_value-types">7.3. Value Types</a>
<ul class="sectlevel3">
<li><a href="#_rg_classes_value-types_manpage-Blob">7.3.1. <code>Blob</code></a></li>
<li><a href="#_rg_classes_value-types_manpage-Clob">7.3.2. <code>Clob</code></a></li>
<li><a href="#_rg_classes_value-types_manpage-Color">7.3.3. <code>Color</code></a></li>
<li><a href="#_rg_classes_value-types_manpage-Money">7.3.4. <code>Money</code></a></li>
<li><a href="#_rg_classes_value-types_manpage-Password">7.3.5. <code>Password</code></a></li>
</ul>
</li>
<li><a href="#_rg_classes_utility">7.4. Applib Utility Classes</a>
<ul class="sectlevel3">
<li><a href="#_rg_classes_utility_manpage-Enums">7.4.1. <code>Enums</code></a></li>
<li><a href="#_rg_classes_utility_manpage-ObjectContracts">7.4.2. <code>ObjectContracts</code></a>
<ul class="sectlevel4">
<li><a href="#_the_issue_in_more_detail">The issue in more detail</a></li>
</ul>
</li>
<li><a href="#_rg_classes_utility_manpage-Reasons">7.4.3. <code>Reasons</code></a></li>
<li><a href="#_rg_classes_utility_manpage-TitleBuffer">7.4.4. <code>TitleBuffer</code></a></li>
</ul>
</li>
<li><a href="#_rg_classes_spec">7.5. Specification pattern</a>
<ul class="sectlevel3">
<li><a href="#__code_specification_code">7.5.1. <code>Specification</code></a></li>
<li><a href="#__code_specification2_code">7.5.2. <code>Specification2</code></a></li>
<li><a href="#_adapter_classes">7.5.3. Adapter classes</a></li>
<li><a href="#_combining_specifications">7.5.4. Combining specifications</a></li>
</ul>
</li>
<li><a href="#_rg_classes_i18n">7.6. i18n support</a>
<ul class="sectlevel3">
<li><a href="#_rg_classes_i18n_manpage-TranslatableString">7.6.1. <code>TranslatableString</code></a></li>
</ul>
</li>
<li><a href="#_rg_classes_mixins">7.7. Mixins</a>
<ul class="sectlevel3">
<li><a href="#__code_hastransactionid_code">7.7.1. <code>HasTransactionId</code></a></li>
<li><a href="#__code_hasusername_code">7.7.2. <code>HasUsername</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_rg_object-layout">8. Object Layout</a>
<ul class="sectlevel2">
<li><a href="#_rg_object-layout_static">8.1. Static Object Layout</a>
<ul class="sectlevel3">
<li><a href="#__code_memberorder_code">8.1.1. <code>@MemberOrder</code></a></li>
<li><a href="#__code_membergrouplayout_code">8.1.2. <code>@MemberGroupLayout</code></a></li>
<li><a href="#_example_layouts">8.1.3. Example Layouts</a></li>
<li><a href="#_other_annotations">8.1.4. Other Annotations</a></li>
</ul>
</li>
<li><a href="#_rg_object-layout_dynamic">8.2. Dynamic Object Layout</a>
<ul class="sectlevel3">
<li><a href="#_json_layout_file">8.2.1. JSON layout file</a></li>
<li><a href="#_downloading_an_initial_layout">8.2.2. Downloading an initial layout</a></li>
</ul>
</li>
<li><a href="#_rg_object-layout_application-menu">8.3. Application Menu Layout</a>
<ul class="sectlevel3">
<li><a href="#__domainservicelayout">8.3.1. @DomainServiceLayout</a></li>
<li><a href="#_ordering_menu_actions">8.3.2. Ordering menu actions</a></li>
<li><a href="#_tertiary_menubar">8.3.3. Tertiary menubar</a></li>
<li><a href="#_isis_add_on_modules">8.3.4. Isis Add-on modules</a></li>
</ul>
</li>
<li><a href="#_rg_object-layout_static-vs-dynamic">8.4. Static vs Dynamic Layouts</a>
<ul class="sectlevel3">
<li><a href="#_best_of_both_worlds">8.4.1. Best of both worlds?</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_rg_runtime">9. Configuration Properties</a>
<ul class="sectlevel2">
<li><a href="#_rg_runtime_deployment-types">9.1. Deployment Types</a>
<ul class="sectlevel3">
<li><a href="#_using_the_wicket_viewer">9.1.1. Using the Wicket Viewer</a></li>
<li><a href="#_restful_objects_viewer_only">9.1.2. Restful Objects viewer only</a></li>
<li><a href="#_overriding_the_deployment_type">9.1.3. Overriding the deployment type</a></li>
</ul>
</li>
<li><a href="#_rg_runtime_configuration-files">9.2. Configuration Files</a></li>
<li><a href="#_rg_runtime_configuring-components">9.3. Specifying components</a>
<ul class="sectlevel3">
<li><a href="#_viewer_configuration">9.3.1. Viewer Configuration</a></li>
</ul>
</li>
<li><a href="#_rg_runtime_configuring-core">9.4. Configuring Core</a>
<ul class="sectlevel3">
<li><a href="#_rg_runtime_configuring-core_isis-objects-editing">9.4.1. <code>objects.editing</code></a></li>
<li><a href="#_rg_runtime_configuring-core_isis-viewers-propertyLayout-labelPosition">9.4.2. <code>propertyLayout.labelPosition</code></a></li>
</ul>
</li>
<li><a href="#_rg_runtime_configuring-datanucleus">9.5. Configuring DataNucleus</a>
<ul class="sectlevel3">
<li><a href="#_rg_runtime_configuring-datanucleus_properties">9.5.1. Configuration Properties</a>
<ul class="sectlevel4">
<li><a href="#_configuration_properties_for_apache_isis_itself">Configuration Properties for Apache Isis itself</a></li>
<li><a href="#_configuration_properties_passed_through_directly_to_datanucleus">Configuration Properties passed through directly to DataNucleus.</a></li>
</ul>
</li>
<li><a href="#_rg_runtime_configuring-datanucleus_persistence-xml">9.5.2. <code>persistence.xml</code></a></li>
<li><a href="#_rg_runtime_configuring-datanucleus_eagerly-registering-entities">9.5.3. Eagerly Registering Entities</a></li>
<li><a href="#_rg_runtime_configuring-datanucleus_disabling-persistence-by-reachability">9.5.4. Persistence by Reachability</a>
<ul class="sectlevel4">
<li><a href="#_the_issue_in_more_detail_2">The issue in more detail</a></li>
</ul>
</li>
<li><a href="#_rg_runtime_configuring-datanucleus_using-jndi-data-source">9.5.5. Using JNDI DataSource</a>
<ul class="sectlevel4">
<li><a href="#_application_managed">Application managed</a></li>
<li><a href="#_container_managed_jndi">Container managed (JNDI)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_rg_runtime_application-specific">9.6. Application-specific CSS and JS</a>
<ul class="sectlevel3">
<li><a href="#_rg_runtime_application-specific_application-css">9.6.1. <code>application.css</code></a></li>
<li><a href="#_rg_runtime_application-specific_application-js">9.6.2. <code>application.js</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_rg_web-xml">10. <code>web.xml</code></a>
<ul class="sectlevel2">
<li><a href="#_rg_web-xml_servlet-context-listeners">10.1. Servlet Context Listeners</a>
<ul class="sectlevel3">
<li><a href="#__code_environmentloaderlistener_code_shiro">10.1.1. <code>EnvironmentLoaderListener</code> (Shiro)</a></li>
<li><a href="#__code_isiswebappbootstrapper_code">10.1.2. <code>IsisWebAppBootstrapper</code></a></li>
<li><a href="#__code_resteasybootstrap_code_resteasy">10.1.3. <code>ResteasyBootstrap</code> (RestEasy)</a></li>
</ul>
</li>
<li><a href="#_rg_web-xml_servlets">10.2. Servlets</a>
<ul class="sectlevel3">
<li><a href="#__code_httpservletdispatcher_code_resteasy">10.2.1. <code>HttpServletDispatcher</code> (RestEasy)</a></li>
<li><a href="#__code_resourceservlet_code">10.2.2. <code>ResourceServlet</code></a></li>
</ul>
</li>
<li><a href="#_rg_web-xml_filters">10.3. Filters</a>
<ul class="sectlevel3">
<li><a href="#__code_shirofilter_code_shiro">10.3.1. <code>ShiroFilter</code> (Shiro)</a></li>
<li><a href="#__code_isislogonexceptionfilter_code">10.3.2. <code>IsisLogOnExceptionFilter</code></a></li>
<li><a href="#__code_resourcecachingfilter_code">10.3.3. <code>ResourceCachingFilter</code></a></li>
<li><a href="#__code_wicketfilter_code">10.3.4. <code>WicketFilter</code></a></li>
<li><a href="#__code_isissessionfilter_code">10.3.5. <code>IsisSessionFilter</code></a></li>
<li><a href="#__code_isistransactionfilterforrestfulobjects_code">10.3.6. <code>IsisTransactionFilterForRestfulObjects</code></a></li>
</ul>
</li>
<li><a href="#_rg_web-xml_context-parameters">10.4. Configuration Files</a></li>
</ul>
</li>
</ul>
            </div>
        </div>
    </div>

</div>


<script src="../js/foundation/5.5.1/vendor/jquery.js"></script>
<script src="../js/foundation/5.5.1/foundation.min.js"></script>


<link href="../css/jquery.tocify/1.9.0/jquery.tocify.css" rel="stylesheet">
<script src="../js/jqueryui/1.11.4/jquery-ui.min.js"></script>
<script src="../js/jquery.tocify/1.9.0/jquery.tocify.js"></script>



<script type="text/javascript">
    $(function () {
        $("#toc").tocify({
            scrollTo: 50,
            extendPage: true,
            context: "#doc-content",
            highlightOnScroll: true,
            hashGenerator: "pretty",
            hideEffect: "slideUp",
            selectors: "h2,h3,h4,h5"
        });
        $(".fallback-toc").hide();
    });
</script>

<script type="text/javascript">

  /****

      $(document).foundation();

      $(document).ready(function(){
        // Cache selectors
        var lastId,
            topMenu = $("div#toc ul"),
            topMenuHeight = 100,

            menuItems = topMenu.find("a"),
            menuItemsHrefs = menuItems.map(function(){
              var item = $($(this).attr("href"));
              if (item.length) { return item; }
            });

        // Bind click handler to menu items to scroll animation
        menuItems.click(function(e){
          var href = $(this).attr("href"),
              offsetTop = href === "#" ? 0 : $(href).offset().top-topMenuHeight+1;
          $('html, body').stop().animate({
              scrollTop: offsetTop
          }, 300);

          e.preventDefault();
        });

        // Bind to scroll of window
        $(  window ).scroll(function(){

           // Get container scroll position
           var fromTop = $(this).scrollTop()+topMenuHeight;

           var cur = menuItemsHrefs.map(function(){
             if ($(this).offset().top < fromTop)
               return this;
           });

           // Get the id of the current element
           cur = cur[cur.length-1];

           var id = cur && cur.length ? cur[0].id : "";

           if (lastId !== id && id) {
               scrollTo(id);
           }

           window.history.pushState({}, "", window.location.origin + window.location.pathname + "#" + id);
        });

        scrollTo = function(id) {
              lastId = id;

              menuItems
                .removeClass("active");

              menuItems
                .parents()
                .removeClass("active-region");

              menuItems
                .parents("ul").hide();

              menuItems
                .filter("[href=#"+id+"]")
                .addClass("active");

              menuItems
                .filter("[href=#"+id+"]")
                .parents("ul").show();

              menuItems
                .filter("[href=#"+id+"]")
                .parent().children("ul").show();

              menuItems
                .filter("[href=#"+id+"]")
                .parents("li").addClass("active-region");

        }
      menuItems
        .removeClass("active");

      menuItems
        .parents()
        .removeClass("active-region");

        var syncMenuItem;
        if(window.location.hash!=="") {
            var menuItemFor = $.grep(menuItems, function(e) {
                return e.hash === window.location.hash;
            });
            console.log(menuItemFor);
            if(menuItemFor.length === 1) {
                syncMenuItem = menuItemFor[0];
            }
        }

        if(!syncMenuItem){
            syncMenuItem = menuItems[0];
        }

        $(syncMenuItem).click();

      });

    ***/

</script>

<script type="text/javascript">

$(document).ready(function(){
    if("Documentation" === "Reference Guide") {
        console.log( "processing 'Documentation'" );

        $("#doc-content-left").removeClass("large-9").removeClass("medium-9").addClass("large-12").addClass("medium-12");
        $("#doc-content-right").removeClass("large-3").removeClass("medium-3").hide();
    }

});

</script>


<script>

$( document ).ready(function() {

    (function() {
      $(function() {
        return $("#doc-content h2, #doc-content h3, #doc-content h4, #doc-content h5, #doc-content h6").each(function(i, el) {
          var $el, icon, id;
          $el = $(el);
          id = $el.attr('id');
          icon = '<i class="fa fa-link"></i>';
          if (id) {
            return $el.prepend($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
          }
        });
      });
    }).call(this);



	/*
        http://osvaldas.info/auto-hide-sticky-header
        MIT license
	*/
	;( function( $, window, document, undefined )
	{
		'use strict';

		var elSelector		= '.header',
			elClassHidden	= 'header--hidden',
			throttleTimeout	= 500,
			$element		= $( elSelector );

		if( !$element.length ) return true;

		var $window			= $( window ),
			wHeight			= 0,
			wScrollCurrent	= 0,
			wScrollBefore	= 0,
			wScrollDiff		= 0,
			$document		= $( document ),
			dHeight			= 0,

			throttle = function( delay, fn )
			{
				var last, deferTimer;
				return function()
				{
					var context = this, args = arguments, now = +new Date;
					if( last && now < last + delay )
					{
						clearTimeout( deferTimer );
						deferTimer = setTimeout( function(){ last = now; fn.apply( context, args ); }, delay );
					}
					else
					{
						last = now;
						fn.apply( context, args );
					}
				};
			};

		$window.on( 'scroll', throttle( throttleTimeout, function()
		{
			dHeight			= $document.height();
			wHeight			= $window.height();
			wScrollCurrent	= $window.scrollTop();
			wScrollDiff		= wScrollBefore - wScrollCurrent;

			if( wScrollCurrent <= 0 ) // scrolled to the very top; element sticks to the top
				$element.removeClass( elClassHidden );

			else if( wScrollDiff > 0 && $element.hasClass( elClassHidden ) ) // scrolled up; element slides in
				$element.removeClass( elClassHidden );

			else if( wScrollDiff < 0 ) // scrolled down
			{
				if( wScrollCurrent + wHeight >= dHeight && $element.hasClass( elClassHidden ) ) // scrolled to the very bottom; element slides in
					$element.removeClass( elClassHidden );

				else // scrolled down; element slides out
					$element.addClass( elClassHidden );
			}

			wScrollBefore = wScrollCurrent;
		}));

	})( jQuery, window, document );


});
</script>

</body>
</html>
