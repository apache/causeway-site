<!doctype html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <title>User Guide</title>

    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->

    <!-- No caching headers -->
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="expires" content="-1" />


    <!-- TODO: need to (re)instate CDN in the future (not using for now just so can develop off-line -->
    <link href="../css/foundation/5.5.1/foundation.css" rel="stylesheet" />
    <script src="../js/foundation/5.5.1/vendor/modernizr.js"></script>
    <link href="../css/asciidoctor/colony.css" rel="stylesheet">
    <link href="../css/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">




    <link href="../css/github-fork-ribbon-css/0.1.1/gh-fork-ribbon.css" rel="stylesheet" />
    <!--[if lt IE 9]>
      <link href="../css/github-fork-ribbon-css/0.1.1/gh-fork-ribbon.ie.css" rel="stylesheet" />
    <![endif]-->


    <style type="text/css">
        /* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{font-weight: normal}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#00}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}

        pre.CodeRay code {
            background-color: inherit;
            border-style: none;
        }

        pre.CodeRay code > span:first-child {
            margin-left: -5px;
        }

        .literalblock pre,
        .listingblock pre:not(.highlight),
        .listingblock pre[class="highlight"],
        .listingblock pre[class^="highlight "],
        .listingblock pre.CodeRay,
        .listingblock pre.prettyprint {
            background: rgb(253, 250, 246);
         }
        .sidebarblock .literalblock pre,
        .sidebarblock .listingblock pre:not(.highlight),
        .sidebarblock .listingblock pre[class="highlight"],
        .sidebarblock .listingblock pre[class^="highlight "],
        .sidebarblock .listingblock pre.CodeRay,
        .sidebarblock .listingblock pre.prettyprint {
            background: rgb(253, 250, 246);
         }

    <style>

    <style>
    .github-fork-ribbon-wrapper.right {
        position: fixed;
    }
    .github-fork-ribbon {
        background: #090;
    }
    .github-fork-ribbon a:hover {
        background:#0D0;
        color:#fff;
        font-size: 1.1em;
    }
    </style>

    <style>
        @media only screen and (min-width: 40.063em) {
          .top-bar {
            .contain-to-grid .top-bar {
                max-width: 80rem;
            }
          }
        }
        .row {
            max-width: 80rem;
        }
    </style>

    <style>
        .extended-quote,
        .extended-quote-first {
            margin-left: 40px;
            margin-right: 40px;
            font-style: italic;
        }
        .extended-quote-attribution {
            text-align: right;
            margin-right: 100px;
            color: #10B061;
        }

        .extended-quote-first:before {
            content: "\201c";
            float: left;
            font-size: 2.75em;
            font-weight: bold;
            line-height: 0.6em;
            margin-left: -0.6em;
            color: #003b6b;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
    </style>

    <style>
        body {
          position: relative;
        }

        *:not(pre) a > code {
            color: #210DDC;
        }

        *:not(pre) > code {
            background-color: inherit;
            border: none;
            font-weight: normal;
        }

        body div#toc li,
        body div#toc2 li {
            list-style-type: none;
        }

        div#doc-content {
            margin-top: 30px;
        }

        body div#toc li.active-region:before,
        body div#toc2 li.active-region:before {
            content: "\00BB \0020";
            margin-left: -12px;
        }

        body div#toc li a.active,
        body div#toc2 li a.active {
            color: red;
        }

        body div#toc.toc,
        body div#toc.toc2 {
            position: fixed;
            left: auto;
            padding-top: 60px;
            z-index: auto;
            background-color: white;
            border-left-color: #eee;
            border-left-style: solid;
            border-right: none;
            min-height: 2000px;
        }

    </style>

    <style>

        @media only screen and (min-width: 768px) {
          #toc.toc2 ul ul { margin-left: -10px; }
        }


        body div#toc .tocify-subheader ul {
            margin-bottom: 0px;
        }

        body div#toc .tocify-subheader li {
            font-size: 14px;
        }
        .tocify li.tocify-item, .tocify ul.tocify-item {
            line-height: 24px;
        }

        body div#toc li.tocify-item.active:before,
        body div#toc2 li.tocify-item.active:before {
            content: "\00BB \0020";
            margin-left: -12px;
        }

        body div#toc li.tocify-item.active a,
        body div#toc2 li.tocify-item.active a {
            color: red;
        }
    </style>

    <style>
        footer {
            margin-top: 1000px;
        }
    </style>

    <style>
        /* overriding colony.css stylesheet */
        .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] {
           /*padding: 1.25em 1.5625em 1.125em 1.5625em;*/
           padding: 0.3em 0.6em 0.25em 0.6em;
        }
        @media only screen and (min-width: 1280px)
        #toc.toc2 {
          /*width: 20em;*/
          width: 25em;
        }

        #doc-content a {
          color: #210DDC;
        }

        .top-bar h1 {
            border-bottom: inherit;
        }

        h2 {
          margin-top: 80px;
        }
        h3 {
          margin-top: 40px;
        }
        h4,h5 {
          margin-top: 30px;
        }

        .admonitionblock.tip > table td.content {
            color: #10B061;
        }
        .admonitionblock.note > table td.content {
            color: #B509AB;
        }
        .admonitionblock.important > table td.content {
            color: #D5810A;
        }

        .admonitionblock .title {
            font-size: larger;
            font-style: italic;
        }

        .imageblock img {
            margin-bottom: 10px;
        }
    </style>

    <style>
        /* from http://ben.balter.com/2014/03/13/pages-anchor-links/ */
        .header-link {
          position: absolute;
          left: -0.5em;
          opacity: 0;

          /*
          -webkit-transition: opacity 0.2s ease-in-out 0.1s;
          -moz-transition: opacity 0.2s ease-in-out 0.1s;
          -ms-transition: opacity 0.2s ease-in-out 0.1s;
          */
        }

        h2:hover .header-link,
        h3:hover .header-link,
        h4:hover .header-link,
        h5:hover .header-link,
        h6:hover .header-link {
          opacity: 1;
        }
    </style>

    <style>
        .top-bar
        {
            -webkit-transition-duration: .5s;
            transition-duration: .5s;

            -webkit-transition-timing-function: cubic-bezier( 0.215, 0.610, 0.355, 1.000 );
            transition-timing-function: cubic-bezier( 0.215, 0.610, 0.355, 1.000 );

            -webkit-transition-property: -webkit-transform;
            transition-property: transform;
        }

        /*
        http://osvaldas.info/auto-hide-sticky-header
        MIT license
        */
        .header--hidden
        {
            -webkit-transform: translateY( -100% );
            -ms-transform: translateY( -100% );
            transform: translateY( -100% );

            transition-duration: .5s;
            transition-timing-function: cubic-bezier( 0.215, 0.610, 0.355, 1.000 );
            -webkit-transition-property: -webkit-transform;
            transition-property: transform;
        }
    </style>

    <style>
        #doc-content a.guide {
            color: white;
        }
    </style>

    <style>
        .tocify {
            margin-top: 80px;
        }
    </style>


</script>

</head>
<body>

<<div class="github-fork-ribbon-wrapper right" style="position: fixed;">
    <div class="github-fork-ribbon">
        <a href="https://github.com/apache/isis/fork">Fork me on GitHub</a>
    </div>
</div>


<div class="row">

    <div class="fixed contain-to-grid header">
        <nav class="top-bar" data-topbar role="navigation" style="max-width: 80rem">
            <ul class="title-area">
                <li class="name">
                    <h1>
                        <a href="/index.html">Apache Isis&trade;</a>
                    </h1>
                </li>
                <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
                <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
            </ul>

            <section class="top-bar-section">
                <ul class="right">

                    <li class="has-form">
                       <FORM class="searchbox navbar-form navbar-right" id="searchbox_012614087480249044419:dn-q5gtwxya" action="http://www.google.com/cse">
                        <div class="row collapse">
                            <input type="hidden" name="cx" value="012614087480249044419:dn-q5gtwxya">
                            <INPUT type="hidden" name="cof" value="FORID:0">
                            <INPUT class="form-control" name="q" type="text" placeholder="Search">
                        </div>
                    </FORM>
                     </li>

                </ul>

                <!-- Left Nav Section -->
                <ul class="left">

                    <li><a href="/documentation.html">Documentation</a></li>
                    <li><a href="/downloads.html">Downloads</a></li>
                    <li><a href="/help.html">Help</a></li>
                    <li><a href="/asf.html">@ASF</a></li>

                </ul>

            </section>
        </nav>
    </div>
</div>

<div class="row">

    <div id="doc-content-left" class="large-9 medium-9 columns">


        <div id="doc-content">
          <div class="sect1">
<h2 id="_users_guide">1. Users' Guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This users' guide introduces the <a href="#_ug_core-concepts">core concepts</a> and ideas behind Apache Isis, tells you how to <a href="#_ug_getting-started">get started</a> with a Maven archetype, and provides <a href="#_ug_how-tos">how-to</a>s and <a href="#_ug_more-advanced">more advanced</a> guidance on writing maintainable larger applications.</p>
</div>
<div class="paragraph">
<p>It goes on to discuss the <a href="#_ug_wicket-viewer">Wicket viewer</a>, both from an end-user perspective and also how as a programmer you can customize the UI.  There is a similar chapter discussing the <a href="#_ug_restfulobjects-viewer">Restful Objects viewer</a> which provides Apache Isis' REST API.  The guide also explains how to configure <a href="#_ug_security">security</a>, principally involving Apache Isis' integration with Apache Shiro.</p>
</div>
<div class="paragraph">
<p>Later chapters discuss essential topics such as <a href="#_ug_testing">testing</a> and how to <a href="#_ug_deployment">deploy</a> your app, and discuss other ways in which you can <a href="#_ug_extending">extend</a> or adapt the framework itself to your particular needs.</p>
</div>
<div class="paragraph">
<p>The users' guide is <em>not</em> intended as a reference manual; for that see the <a href="rg.html#">Reference Guide</a>.  The users' guide also does <em>not</em> explain how to setup your development environment; for that see the <a href="dg.html#">Developers' Guide</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ug_core-concepts">2. Core Concepts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This introductory chapter should give you a good about what Apache Isis actually <strong>is</strong>: the fundamental ideas and principles that it builds upon, how it compares with other frameworks, what the fundamental building blocks are for actually writing an Isis application, and what services and features the framework provides for you to leverage in your own apps.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Parts of this chapter have been adapted from Dan Haywood&#8217;s 2009 book, 'Domain Driven Design using Naked Objects'.  We&#8217;ve also added some new insights and made sure the material we&#8217;ve used is relevant to Apache Isis.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_ug_core-concepts_philosophy">2.1. Philosophy and Architecture</h3>
<div class="paragraph">
<p>This section describes some of the core ideas and architectural patterns upon which Apache Isis builds.</p>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_philosophy_domain-driven-design">2.1.1. Domain-Driven Design</h4>
<div class="paragraph">
<p>There&#8217;s no doubt that we developers love the challenge of understanding and deploying complex technologies. But understanding the nuances and subtleties of the business domain itself is just as great a challenge, perhaps more so. If we devoted our efforts to understanding and addressing those subtleties, we could build better, cleaner, and more maintainable software that did a better job for our stakeholders. And there&#8217;s no doubt that our stakeholders would thank us for it.</p>
</div>
<div class="paragraph">
<p>A couple of years back Eric Evans wrote his book <a href="http://www.amazon.co.uk/Domain-driven-Design-Tackling-Complexity-Software/dp/0321125215">Domain-Driven Design</a>, which is well on its way to becoming a seminal work. In fact, most if not all of the ideas in Evans' book have been expressed before, but what he did was pull those ideas together to show how predominantly object-oriented techniques can be used to develop rich, deep, insightful, and ultimately useful business applications.</p>
</div>
<div class="paragraph">
<p>There are two central ideas at the heart of domain-driven design.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <strong><em>ubiquitous language</em></strong> is about getting the whole team (both domain experts and developers) to communicate more transparently using a domain model.</p>
</li>
<li>
<p>Meanwhile, <strong><em>model-driven design</em></strong> is about capturing that model in a very straightforward manner in code.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s look at each in turn.</p>
</div>
<div class="sect4">
<h5 id="_ubiquitous_language">Ubiquitous Language</h5>
<div class="paragraph">
<p>It&#8217;s no secret that the IT industry is plagued by project failures. Too often systems take longer than intended to implement, and when finally implemented, they don&#8217;t address the real requirements anyway.</p>
</div>
<div class="paragraph">
<p>Over the years we in IT have tried various approaches to address this failing. Using waterfall methodologies, we&#8217;ve asked for requirements to be fully and precisely written down before starting on anything else. Or, using agile methodologies, we&#8217;ve realized that requirements are likely to change anyway and have sought to deliver systems incrementally using feedback loops to refine the implementation.</p>
</div>
<div class="paragraph">
<p>But let&#8217;s not get distracted talking about methodologies. At the end of the day what really matters is communication between the domain experts (that is, the business) who need the system and the techies actually implementing it. If the two don&#8217;t have and cannot evolve a shared understanding of what is required, then the chance of delivering a useful system will be next to nothing.</p>
</div>
<div class="paragraph">
<p>Bridging this gap is traditionally what business analysts are for; they act as interpreters between the domain experts and the developers. However, this still means there are two (or more) languages in use, making it difficult to verify that the system being built is correct. If the analyst mistranslates a requirement, then neither the domain expert nor the application developer will discover this until (at best) the application is first demonstrated or (much worse) an end user sounds the alarm once the application has been deployed into production.</p>
</div>
<div class="paragraph">
<p>Rather than trying to translate between a business language and a technical language, with  <em>DDD</em> we aim to have the business and developers using the same terms for the same concepts in order to create a single <strong><em>domain model</em></strong>. This domain model identifies the relevant concepts of the domain, how they relate, and ultimately where the responsibilities are. This single domain model provides the vocabulary for the  ubiquitous language for our system.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Ubiquitous Language</div>
<div class="paragraph">
<p>Build a common language between the domain experts and developers by using the concepts of the domain model as the primary means of communication. Use the terms in speech, in diagrams, in writing, and when presenting.</p>
</div>
<div class="paragraph">
<p>If an idea cannot be expressed using this set of concepts, then go back and extend the model. Look for and remove ambiguities and inconsistencies.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Creating a  ubiquitous language calls upon everyone involved in the system&#8217;s development to express what they are doing through the vocabulary provided by the model. If this can&#8217;t be done, then our model is incomplete. Finding the missing words deepens our understanding of the domain being modeled.</p>
</div>
<div class="paragraph">
<p>This might sound like nothing more than me insisting that the developers shouldn&#8217;t use jargon when talking to the business. Well, that&#8217;s true enough, but it&#8217;s not a one-way street. A  <strong>ubiquitous language</strong> demands that the developers work hard to understand the problem domain, but it also demands that the business works hard in being  <strong>precise</strong> in its naming and descriptions of those concepts. After all, ultimately the developers will have to express those concepts in a computer programming language.</p>
</div>
<div class="paragraph">
<p>Also, although here I&#8217;m talking about the "domain experts" as being a homogeneous group of people, often they may come from different branches of the business. Even if we weren&#8217;t building a computer system, there&#8217;s a lot of value in helping the domain experts standardize their own terminology. Is the marketing department&#8217;s "prospect" the same as sales' "customer," and is that the same as an after-sales "contract"?</p>
</div>
<div class="paragraph">
<p>The need for precision within the  ubiquitous language also helps us scope the system. Most business processes evolve piecemeal and are often quite ill-defined. If the domain experts have a very good idea of what the business process should be, then that&#8217;s a good candidate for automation, that is, including it in the scope of the system. But if the domain experts find it hard to agree, then it&#8217;s probably best to leave it out. After all, human beings are rather more capable of dealing with fuzzy situations than computers.</p>
</div>
<div class="paragraph">
<p>So, if the development team (business and developers together) continually searches to build their  ubiquitous language, then the domain model naturally becomes richer as the nuances of the domain are uncovered. At the same time, the knowledge of the business domain experts also deepens as edge conditions and contradictions that have previously been overlooked are explored.</p>
</div>
<div class="paragraph">
<p>We use the  ubiquitous language to build up a domain model. But what do we do  <strong>with</strong> that model? The answer to that is the second of our central ideas.</p>
</div>
</div>
<div class="sect4">
<h5 id="_model_driven_design">Model-Driven Design</h5>
<div class="paragraph">
<p>Of the various methodologies that the IT industry has tried, many advocate the production of separate analysis models and implementation models. One example (from the mid 2000s) was that of the  <em>OMG</em>'s Model-Driven Architecture ( <em>MDA</em>) initiative, with its platform-independent model (the  <em>PIM</em>) and a platform-specific model (the  <em>PSM</em>).</p>
</div>
<div class="paragraph">
<p>Bah and humbug! If we use our  ubiquitous language just to build up a high-level analysis model, then we will re-create the communication divide. The domain experts and business analysts will look only to the analysis model, and the developers will look only to the implementation model. Unless the mapping between the two is completely mechanical, inevitably the two will diverge.</p>
</div>
<div class="paragraph">
<p>What do we mean by  <strong>model</strong> anyway? For some, the term will bring to mind  <em>UML</em> class or sequence diagrams and the like. But this isn&#8217;t a model; it&#8217;s a visual  <strong>representation</strong> of some aspect of a model. No, a domain model is a group of related concepts, identifying them, naming them, and defining how they relate. What is in the model depends on what our objective is. We&#8217;re not looking to simply model everything that&#8217;s out there in the real world. Instead, we want to take a relevant abstraction or simplification of it and then make it do something useful for us.  A model is neither right nor wrong, just more or less useful.</p>
</div>
<div class="paragraph">
<p>For our  ubiquitous language to have value, the domain model that encodes it must have a straightforward, literal representation to the design of the software, specifically to the implementation. Our software&#8217;s design should be driven by this model; we should have a model-driven design.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Model-Driven Design</div>
<div class="paragraph">
<p>There must be a straightforward and very literal way to represent the domain model in terms of software. The model should balance these two requirements: form the  ubiquitous language of the development team and be representable in code.</p>
</div>
<div class="paragraph">
<p>Changing the code means changing the model; refining the model requires a change to the code.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Here also the word  <strong>design</strong> might mislead; some might again be thinking of design documents and design diagrams. But by  <strong>design</strong> we mean a way of organizing the domain concepts, which in turn leads to the way in which we organize their representation in code.</p>
</div>
<div class="paragraph">
<p>Luckily, using <strong><em>object-oriented</em></strong> ( <em>OO</em>) languages such as Java, this is relatively easy to do;  <em>OO</em> is based on a modeling paradigm anyway. We can express domain concepts using classes and interfaces, and we can express the relationships between those concepts using associations.</p>
</div>
<div class="paragraph">
<p>So far so good. Or maybe, so far so much motherhood and apple pie. Understanding the  <em>DDD</em> concepts isn&#8217;t the same as being able to apply them, and some of the  <em>DDD</em> ideas can be difficult to put into practice. Time to discuss the naked objects pattern and how it eases that path by applying these central ideas of <em>DDD</em> in a very concrete way.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_philosophy_naked-objects-pattern">2.1.2. Naked Objects Pattern</h4>
<div class="paragraph">
<p>Apache Isis implements the naked objects pattern, originally formulated by Richard Pawson.  So who better than Richard to explain the origination of the idea?</p>
</div>
<div class="paragraph">
<p><div class="extended-quote-first"><p>The Naked Objects pattern arose, at least in part, from my own frustration at the lack of success of the domain-driven approach. Good examples were hard to find&#8212;&#8203;as they are still.
</p></div></p>
</div>
<div class="paragraph">
<p><div class="extended-quote"><p>A common complaint from <em>DDD</em> practitioners was that it was hard to gain enough commitment from business stakeholders, or even to engage them at all. My own experience suggested that it was nearly impossible to engage business managers with <em>UML</em> diagrams.  It was much easier to engage them in rapid prototyping&#8201;&#8212;&#8201;where they could see and interact with the results&#8201;&#8212;&#8201;but most forms of rapid prototyping concentrate on the presentation layer, often at the expense of the underlying model and certainly at the expense of abstract thinking.
</p></div></p>
</div>
<div class="paragraph">
<p><div class="extended-quote"><p>Even if you could engage the business sponsors sufficiently to design a domain model, by the time you&#8217;d finished developing the system on top of the domain model, most of its benefits had disappeared. It&#8217;s all very well creating an agile domain object model, but if any change to that model also dictates the modification of one or more layers underneath it (dealing with persistence) and multiple layers on top (dealing with presentation), then that agility is practically worthless.
</p></div></p>
</div>
<div class="paragraph">
<p><div class="extended-quote"><p>The other concern that gave rise to the birth of Naked Objects was how to make user interfaces of mainstream business systems more "expressive"&#8201;&#8212;&#8201;how to make them feel more like using a drawing program or <em>CAD</em> system. Most business systems are not at all expressive; they treat the user merely as a dumb <strong>process-follower</strong>, rather than as an empowered <strong>problem-solver</strong>.  Even the so-called usability experts had little to say on the subject: try finding the word "empowerment" or any synonym thereof in the index of any book on usability. Research had demonstrated that the best way to achieve expressiveness was to create an object-oriented user interface (<em>OOUI</em>). In practice, though, <em>OOUI</em>s were notoriously hard to develop.
</p></div></p>
</div>
<div class="paragraph">
<p><div class="extended-quote"><p>Sometime in the late 1990s, it dawned on me that if the domain model really did represent the "ubiquitous language" of the business and those domain objects were behaviorally rich (that is, business logic is encapsulated as methods on the domain objects rather than in procedural scripts on top of them), then the <em>UI</em> could be nothing more than a reflection of the user interface. This would solve both of my concerns. It would make it easier to do domain-driven design, because one could instantly translate evolving domain modeling ideas into a working prototype. And it would deliver an expressive, object-oriented user interface for free. Thus was born the idea of Naked Objects.
</p></div></p>
</div>
<div class="paragraph">
<p><div class="extended-quote-attribution"><p>-- Richard Pawson
</p></div></p>
</div>
<div class="paragraph">
<p>You can learn much more about the pattern in the book, <a href="http://www.amazon.com/exec/obidos/ISBN=0470844205/">Naked Objects</a>, also freely available to <a href="http://www.nakedobjects.org/book/">read online</a>.  Richard co-wrote the book with one of Apache Isis' committers, Robert Matthews, who was in turn the author of the Naked Objects Framework for Java (the original codebase of of Apache Isis).</p>
</div>
<div class="paragraph">
<p>You might also want to read Richard&#8217;s <a href="resources/core-concepts/Pawson-Naked-Objects-thesis.pdf">PhD on the subject</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>One of the external examiners for Richard&#8217;s PhD was <a href="http://en.wikipedia.org/wiki/Trygve_Reenskaug">Trygve Reenskaug</a>, who originally formulated the MVC pattern at Xeroc PARC.  In his paper, <a href="http://heim.ifi.uio.no/~trygver/2007/2007.02.13-babyUML.pdf">Baby UML</a>, Reenskaug describes that when implemented the first MVC, "the conventional wisdom in the group was that objects should be visible and tangible, thus bridging the gap between the human brain and the abstract data within the computer."  Sound familiar?  It&#8217;s interesting to speculate what might have been if this idea had been implemented back then in the late 70s.</p>
</div>
<div class="paragraph">
<p>Reenskaug then goes on to say that "this simple and powerful idea failed because &#8230;&#8203; users were used to seeing [objects] from different perspectives. The visible and tangible object would get very complex if it should be able to show itself and be manipulated in many different ways."</p>
</div>
<div class="paragraph">
<p>In Apache Isis the responsibility of rendering an object is not the object itself, it is the framework.  Rather, the object inspects the object and uses that to decide how to render the object.  This is also extensible.  In the <a href="http://www.isisaddons.org">Isis Addons</a> (non-ASF) the <a href="http://github.com/isisaddons/isis-wicket-gmap3">Isis addons' gmap3</a> wicket extension renders any object with latitude/longitude on a map, while <a href="http://github.com/isisaddons/isis-wicket-fullcalendar2">Isis addons' fullcalendar2 wicket extension</a> renders any object with date(s) on a calendar.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_ug_core-concepts_philosophy_naked-objects-pattern_object-interface-mapping">Object Interface Mapping</h5>
<div class="paragraph">
<p>Another&#8201;&#8212;&#8201;more technical&#8201;&#8212;&#8201;way to think about the naked objects pattern is as an <em>object interface mapper</em>, or <code>OIM</code>.  We sometimes use this idea to explain naked objects to a bunch of developers.</p>
</div>
<div class="paragraph">
<p>Just as an ORM (such as <a href="http://datanucleus.org">DataNucleus</a> or <a href="http://hibernate.org">Hibernate</a>) maps domain entities to a database, you can think of the naked objects pattern as representing the concept of mapping domain objects to a user interface.</p>
</div>
<div class="paragraph">
<p>This is the way that the <a href="http://metawidget.org/">MetaWidget</a> team, in particular Richard Kennard, the primary contributor, likes to describe their tool.  MetaWidget has a number of ideas in common with Apache Isis, specifically the runtime generation of a UI for domain objects.  You can hear more from Kennard and others on this <a href="http://devchat.tv/js-jabber/150-jsj-oims">Javascript Jabber podcast</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We compare Apache Isis' with MetaWidget <a href="#_ug_core-concepts_principles_apache-isis-vs_metawidget">here</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_what_this_means_in_practice">What this means in practice</h5>
<div class="paragraph">
<p>The screencast below shows what all of this means in practice, showing the relationship between a running app and the actual code underneath.</p>
</div>
<div class="videoblock">
<div class="title">How Apache Isis builds a webapp from the underlying domain object modelâ€¦</div>
<div class="content">
<iframe width="640px" height="472px" src="//www.youtube.com/embed/ludOLyi6VyY?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This screencast shows Apache Isis v1.0.0, Jan 2013.  The UI has been substantially refined since that release.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_philosophy_hexagonal-architecture">2.1.3. Hexagonal Architecture</h4>
<div class="paragraph">
<p>One of the patterns that Evans discusses in his book is that of a <strong>layered architecture</strong>.  In it he describes why the domain model lives in its own layer within the architecture. The other layers of the application (usually presentation, application, and persistence) have their own responsibilities, and are completely separate.  Each layer is cohesive and depending only on the layers below.  In particular, we have a layer dedicated to the domain model. The code in this layer is unencumbered with the (mostly technical) responsibilities of the other layers and so can evolve to tackle complex domains as well as simple ones.</p>
</div>
<div class="paragraph">
<p>This is a well-established pattern, almost a de-facto; there&#8217;s very little debate that these responsibilities should be kept separate from each other.  With Apache Isis the responsibility for presentation is a framework concern, the responsibility for the domain logic is implemented by the (your) application code.</p>
</div>
<div class="paragraph">
<p>A few years ago Alistair Cockburn reworked the traditional layered architecture diagram and came up with the <strong><em>hexagonal architecture</em></strong>:.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The hexagonal architecture is also known as the <a href="http://c2.com/cgi/wiki?PortsAndAdaptersArchitecture">Ports and Adapters</a> architecture or (less frequently) as the <a href="http://jeffreypalermo.com/blog/the-onion-architecture-part-1/">Onion</a> architecture.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/core-concepts/philosophy/hexagonal-architecture.png" alt="hexagonal architecture" width="700px">
</div>
<div class="title">Figure 1. The hexagonal architecture emphasizes multiple implementations of the different layers.</div>
</div>
<div class="paragraph">
<p>What Cockburn is emphasizing is that there&#8217;s usually more than one way <strong>into</strong> an application (what he called the <strong><em>user-side' ports</em></strong>) and more than one way  <strong>out of</strong> an application too (the <strong><em>data-side ports</em></strong>). This is very similar to the concept of primary and secondary actors in use cases: a primary actor (often a human user but not always) is active and initiates an interaction, while a secondary actor (almost always an external system) is passive and waits to be interacted with.</p>
</div>
<div class="paragraph">
<p>Associated with each port can be an <strong><em>adapter</em></strong> (in fact, Cockburn&#8217;s alternative name for this architecture is <strong><em>ports and adapters</em></strong>). An adapter is a device (piece of software) that talks in the protocol (or  <em>API</em>) of the port. Each port could have several adapters.</p>
</div>
<div class="paragraph">
<p>Apache Isis maps very nicely onto the  <strong>hexagonal architecture</strong>.  Apache Isis' viewers act as user-side adapters and use the Apache Isis metamodel API as a port into the domain objects.   For the data side, we are mostly concerned with persisting domain objects to some sort of object store.  Here Apache Isis delegates most of the heavy lifting to ORM implementing the JDO API.  Most of the time this will be DataNucleus configured to persist to an RDBMS, but DataNucleus can also support other object stores, for example Neo4J.  Alternatively Apache Isis can be configured to persist using some other JDO implementation, for example Google App Engine.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_philosophy_aop">2.1.4. Aspect Oriented</h4>
<div class="paragraph">
<p>Although not a book about object modelling, Evans' "Domain Driven Design" does use object orientation as its primary modelling tool; while <a href="#_ug_core-concepts_philosophy_naked-objects-pattern">naked objects pattern</a> very much comes from an OO background (it even has 'object' in its name); Richard Pawson lists Alan Kay as a key influence.</p>
</div>
<div class="paragraph">
<p>It&#8217;s certainly true that to develop an Apache Isis application you will need to have good object oriented modelling skills.  But given that all the mainstream languages for developing business systems are object oriented (Java, C#, Ruby), that&#8217;s not such a stretch.</p>
</div>
<div class="paragraph">
<p>However, what you&#8217;ll also find as you write your applications is that in some ways an Isis application is more aspect-oriented than it is object oriented.  Given that aspect-orientation&#8201;&#8212;&#8201;as a programming paradigm at least&#8201;&#8212;&#8201;hasn&#8217;t caught on, that statement probably needs unpacking a little.</p>
</div>
<div class="sect4">
<h5 id="_aop_concepts">AOP Concepts</h5>
<div class="paragraph">
<p>Aspect-orientation, then, is a different way of decomposing your application, by treating <em>cross-cutting concerns</em> as a first-class citizen.  The canonical (also rather boring) example of a cross-cutting concern is that of logging (or tracing) all method calls.  An aspect can be written that will weave in some code (a logging statement) at specified points in the code).</p>
</div>
<div class="paragraph">
<p>This idea sounds rather abstract, but what it really amounts to is the idea of interceptors.  When one method calls another the AOP code is called in first.  This is actually then one bit of AOP that is quite mainstream; DI containers such as Spring provide aspect orientation in supporting annotations such as <code>@Transactional</code> or <code>@Secured</code> to java beans.</p>
</div>
<div class="paragraph">
<p>Another aspect (ahem!) of aspect-oriented programming has found its way into other programming languages, that of a mix-in or trait.  In languages such as Scala these mix-ins are specified statically as part of the inheritance hierarchy, whereas with AOP the binding of a trait to some other class/type is done without the class "knowing" that additional behaviour is being mixed-in to it.</p>
</div>
</div>
<div class="sect4">
<h5 id="_realization_within_apache_isis">Realization within Apache Isis</h5>
<div class="paragraph">
<p>What has all this to do with Apache Isis, then?</p>
</div>
<div class="paragraph">
<p>Well, a different way to think of the naked objects pattern is that the visualization of a domain object within a UI is a cross-cutting concern.  By following certain very standard programming conventions that represent the <em>Apache Isis Programming Model</em> (POJOs plus annotations), the framework is able to build a metamodel and from this can render your domain objects in a standard generic fashion.  That&#8217;s a rather more interesting cross-cutting concern than boring old logging!</p>
</div>
<div class="paragraph">
<p>Isis also draws heavily on the AOP concept of interceptors.  Whenever an object is rendered in the UI, it is filtered with respect to the user&#8217;s permissions.  That is, if a user is not authorized to either view or perhaps modify an object, then this is applied transparently by the framework.  The <a href="http://github.com/isisaddons/isis-module-security">Isis addons' security</a> module, mentioned previously, provides a rich user/role/permissions subdomain to use out of the box; but you can integrate with a different security mechanism if you have one already.</p>
</div>
<div class="paragraph">
<p>Another example of interceptors are the <a href="http://github.com/isisaddons/isis-module-command">Isis addons' command</a> and <a href="http://github.com/isisaddons/isis-module-audit">Isis addons' audit</a> modules.  The command module captures every user interaction that modifies the state of the system (the "cause" of a change) while the audit module captures every change to every object (the "effect" of a change).  Again, this is all transparent to the user.</p>
</div>
<div class="paragraph">
<p>Apache Isis also has an internal event bus (you can switch between an underlying implementation of Gauva or Axon).  A domain event is fired whenever an object is interacted with, and this allows any subscribers to influence the operation (or even veto it).  This is a key mechanism in ensuring that Isis applications are maintainable, and we discuss it in depth in the section on  <a href="#_ug_more-advanced_decoupling">Decoupling</a>.  But fundamentally its relying on this AOP concept of interceptors.</p>
</div>
<div class="paragraph">
<p>Finally, Isis also a feature that is akin to AOP mix-ins.  A "contributed action" is one that is implemented on a domain service but that appears to be a behaviour of rendered domain object.  In other words, we can dissociate behaviour from data.  That&#8217;s not always the right thing to do of course.  In Richard Pawson&#8217;s description of the <a href="#_ug_core-concepts_philosophy_naked-objects-pattern">naked objects pattern</a> he talks about "behaviourally rich" objects, in other words where the business functionality encapsulated the data.   But on the other hand sometimes the behaviour and data structures change at different rates.  The <a href="http://en.wikipedia.org/wiki/Single_responsibility_principle">single responsibility principle</a> says we should only lump code together that changes at the same rate.  Apache Isis' support for contributions (not only contributed actions, but also contributed properties and contributed collections) enables this.  And again, to loop back to the topic of this section, it&#8217;s an AOP concept that being implemented by the framework.</p>
</div>
<div class="paragraph">
<p>The nice thing about aspect orientation is that for the most part you can ignore these cross-cutting concerns and - at least initially at least - just focus on implementing your domain object.  Later when your app starts to grow and you start to break it out into smaller modules, you can leverage Apache Isis' AOP support for mixins (<a href="#_ug_more-advanced_decoupling_contributions">contributions</a>) and interceptors (the <a href="#_ug_more-advanced_decoupling_event-bus">event bus</a>) to ensure that your codebase remains maintainable.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_philosophy_how-eases-ddd">2.1.5. How Apache Isis eases DDD</h4>
<div class="paragraph">
<p>The case for  <em>DDD</em> might be compelling, but that doesn&#8217;t necessarily make it easy to do. Let&#8217;s take a look at some of the
challenges that  <em>DDD</em> throws up and see how Apache Isis (and its implementation of the naked objects pattern) helps address them.</p>
</div>
<div class="sect4">
<h5 id="_ddd_takes_a_conscious_effort">DDD takes a conscious effort</h5>
<div class="paragraph">
<p>Here&#8217;s what Eric Evans says about ubiquitous language:</p>
</div>
<div class="paragraph">
<p><div class="extended-quote-first"><p>With a conscious effort by the [development] team the domain model can provide the backbone for [the] common [ubiquitous] language&#8230;&#8203;connecting team communication to the software implementation."
</p></div></p>
</div>
<div class="paragraph">
<p><div class="extended-quote-attribution"><p>-- Eric Evans
</p></div></p>
</div>
<div class="paragraph">
<p>The word to pick up on here is <strong>conscious</strong>.  It takes a conscious effort by the entire team to develop the ubiquitous language. Everyone in the team must challenge the use of new or unfamiliar terms, must clarify concepts when used in a new context, and in general must be on the lookout for sloppy thinking. This takes willingness on the part of all involved, not to mention some practice.</p>
</div>
<div class="paragraph">
<p>With Apache Isis, though, the  ubiquitous language evolves with scarcely any effort at all. For the business experts, the Apache Isis viewers show the domain concepts they identify and the relationships between those concepts in a straightforward fashion. Meanwhile, the developers can devote themselves to encoding those domain concepts directly as domain classes. There&#8217;s no technology to get distracted by; there is literally nothing else for the developers to work on.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ddd_must_be_grounded">DDD must be grounded</h5>
<div class="paragraph">
<p>Employing a  model-driven design isn&#8217;t necessarily straightforward, and the development processes used by some organizations positively hinder it. It&#8217;s not sufficient for the business analysts or architects to come up with some idealized representation of the business domain and then chuck it over the wall for the programmers to do their best with.</p>
</div>
<div class="paragraph">
<p>Instead, the concepts in the model must have a very literal representation in code. If we fail to do this, then we open up the communication divide, and our  ubiquitous language is lost. There is literally no point having a domain model that cannot be represented in code. We cannot invent our ubiquitous language in a vacuum, and the developers must ensure that the model remains grounded in the doable.</p>
</div>
<div class="paragraph">
<p>In Apache Isis, we have a very pure one-to-one correspondence between the domain concepts and its implementation. Domain concepts are represented as classes and interfaces, easily demonstrated back to the business. If the model is clumsy, then the application will be clumsy too, and so the team can work together to find a better implementable model.</p>
</div>
</div>
<div class="sect4">
<h5 id="_abstract_models_are_difficult_to_represent">Abstract models are difficult to represent</h5>
<div class="paragraph">
<p>If we are using code as the primary means of expressing the model, then we need to find a way to make this model understandable to the business.</p>
</div>
<div class="paragraph">
<p>We could generate  <em>UML</em> diagrams and the like from code. That will work for some members of the business community, but not for everyone. Or we could generate a  <em>PDF</em> document from Javadoc comments, but comments aren&#8217;t code and so the document may be inaccurate.  Anyway, even if we do create such a document, not everyone will read it.</p>
</div>
<div class="paragraph">
<p>A better way to represent the model is to show it in action as a working prototype. As we show in the <a href="#_ug_getting-started">Getting Started</a> section, Apache Isis enables this with ease. Such prototypes bring the domain model to life, engaging the audience in a way that a piece of paper never can.</p>
</div>
<div class="paragraph">
<p>Moreover, with Apache Isis prototypes, the domain model will come shining through. If there are mistakes or misunderstandings in the domain model (inevitable when building any complex system), they will be obvious to all.</p>
</div>
</div>
<div class="sect4">
<h5 id="_layered_architectures_are_easily_compromised">Layered architectures are easily compromised</h5>
<div class="paragraph">
<p><em>DDD</em> rightly requires that the domain model lives in its own layer within the architecture. The other layers of the application (usually presentation, application, and persistence) have their own responsibilities, and are completely separate.</p>
</div>
<div class="paragraph">
<p>However, there are two immediate issues. The first is rather obvious: custom coding each of those other layers is an expensive proposition. Picking up on the previous point, this in itself can put the kibosh on using prototyping to represent the model, even if we wanted to do so.</p>
</div>
<div class="paragraph">
<p>The second issue is more subtle. It takes real skill to ensure the correct separation of concerns between these layers, if indeed you can get an agreement as to what those concerns actually are. Even with the best intentions, it&#8217;s all too easy for custom-written layers to blur the boundaries and put (for example) validation in the user interface layer when it should belong to the domain layer. At the other extreme, it&#8217;s quite possible for custom layers to distort or completely subvert the underlying domain model.</p>
</div>
<div class="paragraph">
<p>Because of Apache Isis' generic  <em>OOUI</em>s, there&#8217;s no need to write the other layers of the architecture.  Of course, this reduces the development cost. But more than that, there will be no leakage of concerns outside the domain model. All the validation logic <strong>must</strong> be in the domain model because there is nowhere else to put it.</p>
</div>
<div class="paragraph">
<p>Moreover, although Apache Isis does provide a complete runtime framework, there is no direct coupling of your domain model to the framework. That means it is very possible to take your domain model prototyped in Naked Objects and then deploy it on some other  <em>J(2)EE</em> architecture, with a custom <em>UI</em> if you want.  Apache Isis guarantees that your domain model is complete.</p>
</div>
</div>
<div class="sect4">
<h5 id="_extending_the_reach_of_ddd">Extending the reach of DDD</h5>
<div class="paragraph">
<p>Domain-driven design is often positioned as  being applicable only to complex domains; indeed, the subtitle of Evans book is  "Tackling Complexity in the Heart of Software". The corollary is that DDD is overkill for simpler domains. The trouble is that we immediately have to make a choice: is the domain complex enough to warrant a domain-driven approach?</p>
</div>
<div class="paragraph">
<p>This goes back to the previous point, building and maintaining a layered architecture. It doesn&#8217;t seem cost effective to go to all the effort of a DDD approach if the underlying domain is simple.</p>
</div>
<div class="paragraph">
<p>However, with Apache Isis, we don&#8217;t write these other layers, so we don&#8217;t have to make a call on how complex our domain is. We can start working solely on our domain, even if we suspect it will be simple. If it is indeed a simple domain, then there&#8217;s no hardship, but if unexpected subtleties arise, then we&#8217;re in a good position to handle them.</p>
</div>
<div class="paragraph">
<p>If you&#8217;re just starting out writing domain-driven applications, then Apache Isis should significantly ease your journey into applying <em>DDD</em>. On the other hand, if you&#8217;ve used <em>DDD</em> for a while, then you should find Isis a very useful new tool in your arsenal.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_core-concepts_principles">2.2. Principles and Values</h3>
<div class="paragraph">
<p>This section describes some of the core principles and values that the framework aims to honour and support.</p>
</div>
<div class="paragraph">
<p>The first of these relate to how we believe your domain application should be written: it should be decoupled, testable and so on).  Others relate to the implementation of the framework itself.</p>
</div>
<div class="paragraph">
<p>The section concludes by contrasting the framework with some other open source frameworks commonly used.</p>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_principles_your-apps">2.2.1. Your Applications</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_decoupled">Decoupled</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Long-term Cost of ownership</p>
</div>
<div class="paragraph">
<p>Using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dependency injection of services</p>
</li>
<li>
<p>OO design techniques, eg dependency inversion principle</p>
</li>
<li>
<p>an in-memory event bus</p>
</li>
<li>
<p>applib</p>
</li>
<li>
<p>(no "Big Ball of Mud")</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_honouring_the_single_responsibility_principle">Honouring the Single Responsibility Principle</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - behaviourally Complete vs Contributions
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_testable">Testable</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>While Apache Isis can be used (very effectively) for simple CRUD-style applications, it is also intended to be used for complex business domains.  Ensuring that the business logic in such applications is correct means that the framework must (and does) provide robust testing support, both for developer-level unit testing and business-level (end-to-end) integration testing.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_principles_isis-itself">2.2.2. Apache Isis itself</h4>
<div class="paragraph">
<p>This section discusses some of the principles and values we apply to the development of the Apache Isis framework itself.</p>
</div>
<div class="sect4">
<h5 id="_full_stack_but_extensible">Full-stack but Extensible</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_focuses_on_its_usp">Focuses on its USP</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>add-ons</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apache Isis is at heart a metamodel with runtime, and coordinates interations using an AOP set of principles</p>
</li>
<li>
<p>Apache Isis vs Isis Addons</p>
</li>
<li>
<p>Apache Isis vs Shiro vs DataNucleus</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>all code has legacy in it&#8230;&#8203;. parts of the Isis codebase are well over a decade old; and back then a lot of the JEE technologies that we&#8217;d like to be using just didn&#8217;t exist, so we had to invent the features we required ourselves.</p>
</li>
<li>
<p>also, Apache Isis today is more pragmatic than previously</p>
</li>
</ol>
</div>
</li>
<li>
<p>a client/server solution, with AWT-based client</p>
</li>
<li>
<p>a HTML browser, Scimpi (JSF-like, but not using JSF), &#8230;&#8203;</p>
</li>
<li>
<p>security</p>
</li>
<li>
<p>objectstores</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We&#8217;re working hard to remove duplication, reuse existing open source/JEE, and simplify.</p>
</div>
<div class="paragraph">
<p>The areas of Apache Isis we consider mature are those that have been developed in support of real-world applications implemented by the committers.  Foremost among these is Estatio.</p>
</div>
<div class="paragraph">
<p>Focus on enterprise / line-of-business applications, for use by internal staff.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>problem solvers, not process followers</p>
</li>
<li>
<p>view models</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_principles_apache-isis-vs">2.2.3. Apache Isis vs &#8230;&#8203;</h4>
<div class="paragraph">
<p>Many other frameworks promise rapid application development and provide automatically generated user interfaces, so how
do they compare to Apache Isis?</p>
</div>
<div class="sect4">
<h5 id="_ug_core-concepts_principles_apache-isis-vs_mvc-server-side-frameworks">vs MVC server-side frameworks</h5>
<div class="paragraph">
<p>Some of most commonly used frameworks today are <a href="http://www.spring.io/">Spring MVC</a>, <a href="http://rubyonrails.org/">Ruby on Rails</a> and <a href="http://www.grails.org">Grails</a>, all of which implement one flavour or another of the server-side MVC pattern.  The MVC 1.0 specification (scheduled for JavaEE 8) is also similar.</p>
</div>
<div class="paragraph">
<p>These frameworks all use the classic  <strong>model-view-controller</strong> ( <em>MVC</em>) pattern for web applications, with scaffolding, code-generation, and/or metaprogramming tools for the controllers and views, as well as convention over configuration to define how these components interact.  The views provided out of the box by these frameworks tend to be simple  <em>CRUD</em>-style interfaces. More sophisticated behavior is accomplished by customizing the generated controllers.</p>
</div>
<div class="paragraph">
<p>The most obvious difference when developing an Apache Isis application is its deliberate lack of an explicit controller layer; non- <em>CRUD</em> behavior is automatically made available in its generic object-oriented  _UI_s.  More sophisticated UIs can be built either by <a href="#_ug_extending_wicket-viewer">extending Apache Isis' Wicket viewer</a> or by writing a bespoke UI leveraging the REST (hypermedia) API automatically exposed by <a href="#_ug_restfulobjects-viewer">Isis' Restful Objects viewer</a>.  Other frameworks can also be used to implement REST APIs, of course, but generally they require a significant amount of development to get anywhere near the level of sophistication provided automatically by Apache Isis' REST API.</p>
</div>
<div class="paragraph">
<p>Although these frameworks all provide their own ecosystems of extensions, Apache Isis' equivalent <a href="http://www.isisaddons.org">Isis Addons</a> (non-ASF) tend to work at a higher-level of abstraction.  For example, each of these frameworks will integrate with various security mechanism, but the <a href="http://github.com/isisaddons/isis-module-security">Isis addons' security module</a> provides a full subdomain of users, roles, features and permissions that can be plugged into any Isis application.  Similarly, the <a href="http://github.com/isisaddons/isis-module-command">Isis addons' command</a> and <a href="http://github.com/isisaddons/isis-module-audit">Isis addons' audit</a> modules in combination provide a support for auditing and traceability that can also be used for out of the box profiling.  Again, these addons can be plugged into any Isis app.</p>
</div>
<div class="paragraph">
<p>In terms of testing support, each of these other frameworks provide mechanisms to allow the webapp to be tested from within a JUnit test harness. Apache Isis' support is similar.  Where Apache Isis differs though is that it enables end-to-end testing without the need for slow and fragile Selenium tests. Instead, Apache Isis provides a "<a href="#_ug_testing_integ-test-support_wrapper-factory">WrapperFactory</a>" domain service that allows the generic UI provided to in essence be simulated. On a more pragmatic level, the <a href="http://github.com/isisaddons/isis-module-fakedata">Isis addons' fakedata</a> module does "what it says on the tin", allowing both unit- and integration-tests to focus on the salient data and fake out the rest.</p>
</div>
</div>
<div class="sect4">
<h5 id="_vs_cqrs">vs CQRS</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_vs_event_sourcing">vs Event Sourcing</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_vs_angular">vs Angular</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_ug_core-concepts_principles_apache-isis-vs_metawidget">vs MetaWidget</h5>
<div class="paragraph">
<p>MetaWidget (mentioned <a href="#_ug_core-concepts_philosophy_naked-objects-pattern_object-interface-mapping">earlier</a> has a number of ideas in common with Apache Isis, specifically the runtime generation of a UI for domain objects.  And like Apache Isis, MetaWidget builds its own metamodel of the domain objects and uses this to render the object.</p>
</div>
<div class="paragraph">
<p>However, there is a difference in philosophy in that MW is not a full-stack framework and does not (in their words) try to "own the UI".  Rather they support a huge variety of UI technologies and allow the domain object to be rendered in any of them.</p>
</div>
<div class="paragraph">
<p>In contrast, Apache Isis is full-stack and does generate a complete UI; we then allow you to customize or extend this UI (as per the various <a href="http://www.isisaddons.org">Isis Addons</a> (non-ASF), and we also provide a full REST API through the <a href="#_ug_restfulobjects-viewer">Restful Objects viewer</a></p>
</div>
<div class="paragraph">
<p>Also, it&#8217;s worth noting that MetaWidget does have an elegant pipeline architecture, with APIs to allow even its metamodel to be replaced.  It would be feasible and probably quite straightforward to use Apache Isis' own metamodel as an implementation of the MetaWidget API.  This would allow MetaWidget to be able to render an Apache Isis domain application.</p>
</div>
</div>
<div class="sect4">
<h5 id="_vs_openxava">vs OpenXava</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_core-concepts_building-blocks">2.3. Building Blocks</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_a_metamodel_with_explicit_and_inferred_semantics">2.3.1. A MetaModel with Explicit and Inferred Semantics</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>use of annotations</p>
<div class="ulist">
<ul>
<li>
<p>reuse JEE annotations where possible</p>
</li>
</ul>
</div>
</li>
<li>
<p>layout hints are overridable, to avoid restarting the app/speed up feedback</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_domain_objects_and_domain_services">2.3.2. Domain Objects and Domain Services</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>domain model</p>
<div class="ulist">
<ul>
<li>
<p>domain objects</p>
<div class="ulist">
<ul>
<li>
<p>domain entity</p>
</li>
<li>
<p>view model</p>
</li>
</ul>
</div>
</li>
<li>
<p>domain service</p>
</li>
<li>
<p>value type</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Anything else can be (should be) ignored by annotating with <code>@Programmatic</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_properties_collections_and_actions">2.3.3. Properties, Collections and Actions</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_domain_entities_vs_view_models">2.3.4. Domain Entities vs View Models</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>@DomainObject(nature=&#8230;&#8203;)</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_domain_services">2.3.5. Domain Services</h4>
<div class="paragraph">
<p>Domain services consist of a set of logically grouped actions, and as such follow the same conventions as for entities. However, a service cannot have (persisted) properties, nor can it have (persisted) collections.</p>
</div>
<div class="paragraph">
<p>Domain services are instantiated once and once only by the framework, and are used to centralize any domain logic that does not logically belong in a domain entity or value. Apache Isis will automatically inject services into every domain entity that requests them, and into each other.</p>
</div>
<div class="paragraph">
<p>For convenience you can inherit from AbstractService or one of its subclasses, but this is not mandatory.</p>
</div>
<div class="sect4">
<h5 id="_domain_services_vs_view_services">Domain Services vs View Services</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>@DomainService(nature=&#8230;&#8203;)</code></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Factories, Repositories and Services</div>
<div class="paragraph">
<p>A distinction is sometimes made between a factory (that creates object) and a repository (that is used to find existing objects).  You will find them discussed separately in Evans' <a href="http://books.google.com/books/about/Domain_Driven_Design.html?id=hHBf4YxMnWMC">Domain Driven Design</a>, for example.</p>
</div>
<div class="paragraph">
<p>In Apache Isis these are all implemented as domain services.  Indeed, it is quite common to have a domain service that acts as both a factory and a repository.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_value_objects_primitives">2.3.6. Value Objects (Primitives)</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_contributions">2.3.7. Contributions</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_event_bus">2.3.8. Event Bus</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_core-concepts_framework-provided-services">2.4. Framework-provided Services</h3>
<div class="paragraph">
<p>Most framework domain services are API: they exist to provide support functionality to the application&#8217;s domain objects and services.  In this case an implementation of the service will be available, either by Apache Isis itself or by Isis Addons (non ASF).</p>
</div>
<div class="paragraph">
<p>Some framework domain services are SPI: they exist primarily so that the application can influence the framework&#8217;s behaviour.  In these cases there is (usually) no default implementation; it is up to the application to provide an implementation.</p>
</div>
<div class="paragraph">
<p>General purpose:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="rg.html#_rg_services-api_manpage-DomainObjectContainer"><code>DomainObjectContainer</code></a></p>
</li>
<li>
<p><a href="rg.html#_rg_services-api_manpage-ClockService"><code>ClockService</code></a></p>
</li>
<li>
<p><a href="rg.html#_rg_services-api_manpage-IsisJdoSupport"><code>IsisJdoSupport</code></a></p>
</li>
<li>
<p><a href="rg.html#_rg_services-api_manpage-WrapperFactory"><code>WrapperFactory</code></a></p>
</li>
<li>
<p><a href="rg.html#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a></p>
</li>
<li>
<p><a href="rg.html#_rg_services-api_manpage-EmailService"><code>EmailService</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Commands/Background/Auditing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="rg.html#_rg_services-api_manpage-CommandContext"><code>CommandContext</code></a> (SPI)</p>
</li>
<li>
<p><a href="rg.html#_rg_services-spi_manpage-CommandService"><code>CommandService</code></a> (SPI)</p>
</li>
<li>
<p><a href="rg.html#_rg_services-spi_manpage-AuditingService"><code>AuditingService</code></a> (SPI)</p>
</li>
<li>
<p><a href="rg.html#_rg_services-api_manpage-BackgroundService"><code>BackgroundService</code></a></p>
</li>
<li>
<p><a href="rg.html#_rg_services-spi_manpage-BackgroundCommandService"><code>BackgroundCommandService</code></a> (SPI)</p>
</li>
<li>
<p><a href="rg.html#_rg_services-spi_manpage-PublishingService"><code>PublishingService</code></a> (SPI)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Information Sharing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="rg.html#_rg_services-api_manpage-Scratchpad"><code>Scratchpad</code></a></p>
</li>
<li>
<p><a href="rg.html#_rg_services-api_manpage-ActionInvocationContext"><code>ActionInvocationContext</code></a></p>
</li>
<li>
<p><a href="rg.html#_rg_services-api_manpage-QueryResultsCache"><code>QueryResultsCache</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>UserManagement:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="rg.html#_rg_services-spi_manpage-UserProfileService"><code>UserProfileService</code></a> (SPI)</p>
</li>
<li>
<p><a href="rg.html#_rg_services-spi_manpage-UserRegistrationService"><code>UserRegistrationService</code></a> (SPI)</p>
</li>
<li>
<p><a href="rg.html#_rg_services-spi_manpage-EmailNotificationService"><code>EmailNotificationService</code></a> (SPI)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Bookmarks and Mementos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="rg.html#_rg_services-api_manpage-BookmarkService"><code>BookmarkService</code></a></p>
</li>
<li>
<p><a href="rg.html#_rg_services-api_manpage-MementoService"><code>MementoService</code></a></p>
</li>
<li>
<p><a href="rg.html#_rg_services-api_manpage-DeepLinkService"><code>DeepLinkService</code></a></p>
</li>
<li>
<p><a href="rg.html#_rg_services-api_manpage-XmlSnapshotService"><code>XmlSnapshotService</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A full list of services can be found in the <a href="rg.html#_rg_services-api">Domain Services (API)</a>  and <a href="rg.html#_rg_services-spi">Domain Services (SPI)</a> chapters of the reference guide.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ug_core-concepts_add-ons">2.5. Isis Add-ons</h3>
<div class="paragraph">
<p>The <a href="http://www.isisaddons.org">Isis Addons</a> website provides a number of reusable modules and other extensions for Apache Isis.  This chapter focuses just on the modules, all of which have a name of the form <code>isis-module-xxx</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that Isis addons, while maintained by Apache Isis committers, are not part of the ASF.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The modules themselves fall into four broad groups:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>modules that provide an implementations of API defined by Apache Isis<br></p>
<div class="paragraph">
<p>where Apache Isis has hooks to use the service if defined by provides no implementations of its own.  The <a href="http://github.com/isisaddons/isis-module-command">command</a>, <a href="http://github.com/isisaddons/isis-module-audit">auditing</a>, <a href="http://github.com/isisaddons/isis-module-publishing">publishing</a>, <a href="http://github.com/isisaddons/isis-module-security">security</a>  and <a href="http://github.com/isisaddons/isis-module-sessionlogger">sessionlogger</a> modules fall into this category.  Typically the domain objects themselves wouldn&#8217;t interact with these services</p>
</div>
</li>
<li>
<p>modules that provide standalone domain services with their own API and implementation<br></p>
<div class="paragraph">
<p>These are simply intended to be used by domain objects.  The <a href="http://github.com/isisaddons/isis-module-docx">docx</a>, <a href="http://github.com/isisaddons/isis-module-excel">excel</a>, <a href="http://github.com/isisaddons/isis-module-settings">settings</a> and <a href="http://github.com/isisaddons/isis-module-stringinterpolator">stringinterpolator</a> fall into this category.</p>
</div>
</li>
<li>
<p>modules that provide standalone domain entities (and supporting services) for a particular subdomain<br></p>
<div class="paragraph">
<p>The <a href="http://github.com/isisaddons/isis-module-tags">tags</a> module falls into this category</p>
</div>
</li>
<li>
<p>modules that provide developer utilities<br></p>
<div class="paragraph">
<p>Not intended for use by either the framework or domain objects, but provide utilities that the developer themselves might use.  The <a href="http://github.com/isisaddons/isis-module-devutils">devutils</a> module (not suprisingly) falls into this category</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of the modules has a full README and example application demonstrating their usage.  The sections below briefly outline the capabilities of these modules.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ug_core-concepts_other-deployment-options">2.6. Other Deployment Options</h3>
<div class="paragraph">
<p>Apache Isis is a mature platform suitable for production deployment, with its "sweet spot" being line-of-business enterprise applications.  So if you&#8217;re looking to develop that sort of application, we certainly hope you&#8217;ll seriously evaluate it.</p>
</div>
<div class="paragraph">
<p>But there are other ways that you can make Apache Isis work for you; in this chapter we explore a few of them.</p>
</div>
<div class="sect3">
<h4 id="_deploy_to_production">2.6.1. Deploy to production</h4>
<div class="paragraph">
<p>Let&#8217;s start though with the default use case for Apache Isis: building line-of-business enterprise applications, on top of its Wicket viewer.</p>
</div>
<div class="paragraph">
<p>Apache Wicket, and therefore Apache Isis in this configuration, is a stateful architecture.  As a platform it is certainly capable of supporting user bases of several thousand (with perhaps one or two hundred concurrent); however it isn&#8217;t an architecture that you should try to scale up to tens of thousands of concurrent users.</p>
</div>
<div class="paragraph">
<p>The UI UI generated by the Wicket viewer is well suited to many line-of-business apps, but it&#8217;s also worth knowing that (with a little knowledge of the Wicket APIs) it relatively straightforward to extend.  As described in <a href="#_ug_core-concepts_add-ons">Isis addons</a> chapter, the viewer already has integrations with <a href="https://github.com/isisaddons/isis-wicket-gmap3">google maps</a>, <a href="https://github.com/isisaddons/isis-wicket-fullcalendar2">a full calendar</a> and an <a href="https://github.com/isisaddons/isis-wicket-excel">export to Excel</a> component.  We are also aware of integrations with SVG images (for floor maps of shopping center) and of custom widgets displaying a catalogue (text and images) of medical diseases.</p>
</div>
<div class="paragraph">
<p>Deploying on Apache Isis means that the framework also manages object persistence.  For many line-of-business applications this will mean using a relational database.  It is also possible (courtesy of its integratinon with <a href="http://www.datanucleus.org">DataNucleus</a>) to deploy an Isis app to a NoSQL store such as Neo4J or MongoDB; and it is also possible to deploy to cloud platforms such as <a href="https://cloud.google.com/appengine/docs">Google App Engine (GAE)</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_use_for_prototyping">2.6.2. Use for prototyping</h4>
<div class="paragraph">
<p>Even if you don&#8217;t intend to deploy your application on top of Apache Isis, there can be a lot of value in using Apache Isis for prototyping.  Because all you need do to get an app running is write domain objects, you can very quickly explore a domain object model and validate ideas with a domain expert.</p>
</div>
<div class="paragraph">
<p>By focusing just on the domain, you&#8217;ll also find that you start to develop a ubiquitous language - a set of terms and concepts that the entire team (business and technologists alike) have a shared understanding.</p>
</div>
<div class="paragraph">
<p>Once you&#8217;ve sketched out your domain model, you can then "start-over" using your preferred platform.</p>
</div>
</div>
<div class="sect3">
<h4 id="_deploy_on_your_own_platform">2.6.3. Deploy on your own platform</h4>
<div class="paragraph">
<p>The programming model defined by Apache Isis deliberately minimizes the dependencies on the rest of the framework. In fact, the only hard dependency that the domain model classes have on Apache Isis is through the <code>org.apache.isis.applib</code> classes, mostly to pick up annotations such as <code>@Disabled</code>.
So, if you have used Apache Isis for prototyping (discussed above), then note that it&#8217;s quite feasible to take your domain model a the basis of your actual development effort; Apache Isis' annotations and programming conventions will help ensure that any subtle semantics you might have captured in your prototyping are not lost.</p>
</div>
<div class="paragraph">
<p>If you go this route, your deployment platform will of course need to provide similar capabilities to Apache Isis.  In particular, you&#8217;ll need to figure out a way to inject domain services into domain entities (eg using a JPA listener), and you&#8217;ll also need to reimplement any domain services you have used that Apache Isis provides "out-of-the-box" (eg <a href="rg.html#_rg_services-api_manpage-QueryResultsCache"><code>QueryResultsCache</code></a> domain service).</p>
</div>
</div>
<div class="sect3">
<h4 id="_deploy_the_rest_api">2.6.4. Deploy the REST API</h4>
<div class="paragraph">
<p>REST (Representation State Transfer) is an architectural style for building highly scalable distributed systems, using the same principles as the World Wide Web. Many commercial web APIs (twitter, facebook, Amazon) are implemented as either pure REST APIs or some approximation therein.</p>
</div>
<div class="paragraph">
<p>The <a href="http://restfulobjects.org">Restful Objects specification</a> defines a means by a domain object model can be exposed as RESTful resources using JSON representations over HTTP. Apache Isis' <a href="#_ug_restfulobjects-viewer">RestfulObjects viewer</a> is an implementation of that spec, making any Apache Isis domain object automatically available via REST.</p>
</div>
<div class="paragraph">
<p>There are a number of use cases for deploying Isis as a REST API, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to allow a custom UI to be built against the RESTful API<br></p>
<div class="paragraph">
<p>For example, using AngularJS or some other RIA technology such as Flex, JavaFX, Silverlight</p>
</div>
</li>
<li>
<p>to enable integration between systems<br></p>
<div class="paragraph">
<p>REST is designed to be machine-readable, and so is an excellent choice for synchronous data interchange scenarios.</p>
</div>
</li>
<li>
<p>as a ready-made API for migrating data from one legacy system to its replacement.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As for the auto-generated webapps, the framework manages object persistence. It is perfectly possible to deploy the REST API alongside an auto-generated webapp; both work from the same domain object model.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implement_your_own_viewer">2.6.5. Implement your own viewer</h4>
<div class="paragraph">
<p>Isis' architecture was always designed to support multiple viewers; and indeed Apache Isis out-of-the-box supports two: the Wicket viewer, and the Restful Objects viewer (or three, if one includes the Wrapper Factory).</p>
</div>
<div class="paragraph">
<p>While we mustn&#8217;t understate the effort involved here, it is feasible to implement your own viewers too.  Indeed, one of Apache Isis' committers does indeed have a (closed source) viewer, based on <a href="http://www.wavemaker.com/">Wavemaker</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ug_getting-started">3. Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To get you up and running quickly, Apache Isis provides a <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a> to setup a simple application as the basis of your own apps.  This is deliberately very minimal so that you won&#8217;t have to spend lots of time removing generated artifacts.  On the other hand, it does set up a standard multi-module maven structure with unit- and integration tests pre-configured, as well as a webapp module so that you can easily run your app.  We strongly recommend that you preserve this structure as you develop your own Isis application.</p>
</div>
<div class="paragraph">
<p>In this chapter we also discuss the <a href="#_ug_getting-started_datanucleus-enhancer">DataNucleus enhancer</a>.  <a href="http://www.datanucleus.org/">DataNucleus</a> is the reference implementation of the JDO (Java data objects) spec, and Apache Isis integrates with DataNucleus as its persistence layer.  The enhancer performs post-processing on the bytecode of your persistent domain entities, such that they can be persisted by Apache Isis' JDO/DataNucleus objectstore.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a> automatically configures the enhancer, so there&#8217;s little you need to do at this stage.  Even so we feel it&#8217;s a good idea to be aware of this critical part of Apache Isis runtime; if the enhancer does not run, then you&#8217;ll find the app fails to start with (what will seem like) quite an obscure exception message.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_prerequisites">3.1. Prerequisites</h3>
<div class="paragraph">
<p>Apache Isis is a Java based framework, so in terms of prerequisites, you&#8217;ll need to install:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java 7 or 8 JDK</p>
</li>
<li>
<p><a href="http://maven.apache.org">Apache Maven</a> 3.0.5 or later</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You&#8217;ll probably also want to use an IDE; the Apache Isis committers use either IntelliJ or Eclipse; in the <a href="dg.adoc">Developers' Guide</a> we have detailed setup instructions for using these two IDEs.  If you&#8217;re a NetBeans user you should have no problems as it too has strong support for Maven.</p>
</div>
<div class="paragraph">
<p>When building and running within an IDE, you&#8217;ll also need to configure the Datanucleus enhancer.  This is implemented as a Maven plugin, so in the case of IntelliJ, it&#8217;s easy enough to run the enhancer as required. It should be just as straightforward for NetBeans too.</p>
</div>
<div class="paragraph">
<p>For Eclipse the maven integration story is a little less refined.  All is not lost, however; DataNucleus also has an implementation of the enhancer as an Eclipse plugin, which usually works well enough.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ug_getting-started_simpleapp-archetype">3.2. SimpleApp Archetype</h3>
<div class="paragraph">
<p>The quickest way to get started with Apache Isis is to run the simple archetype.  This will generate a very simple one-class domain model, called <code>SimpleObject</code>, with a single property <code>name</code>.</p>
</div>
<div class="paragraph">
<p>There is also a corresponding <code>SimpleObjectRepository</code> domain service.  From this you can easily rename these initial classes, and extend to build up your own Apache Isis domain application.</p>
</div>
<div class="sect3">
<h4 id="_generating_the_app">3.2.1. Generating the App</h4>
<div class="paragraph">
<p>Create a new directory, and <code>cd</code> into that directory.</p>
</div>
<div class="paragraph">
<p>To build the app from the latest stable release, then run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mvn archetype:generate  \
    -D archetypeGroupId=org.apache.isis.archetype \
    -D archetypeArtifactId=simpleapp-archetype \
    -D archetypeVersion=1.8.0 \
    -D groupId=com.mycompany \
    -D artifactId=myapp \
    -D version=1.0-SNAPSHOT \
    -B</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>groupId</code> represents your own organization, and</p>
</li>
<li>
<p><code>artifactId</code> is a unique identifier for this app within your organization.</p>
</li>
<li>
<p><code>version</code> is the initial (snapshot) version of your app</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The archetype generation process will then run; it only takes a few seconds.</p>
</div>
<div class="paragraph">
<p>We also maintain the archetype for the most current <code>-SNAPSHOT</code>; an app generated with this archetype will contain the latest features of Apache Isis, but the usual caveats apply: some features still in development may be unstable.</p>
</div>
<div class="paragraph">
<p>The process is almost identical to that for stable releases, however the <code>archetype:generate</code> goal is called with slightly different arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mvn archetype:generate  \
    -D archetypeGroupId=org.apache.isis.archetype \
    -D archetypeArtifactId=simpleapp-archetype \
    -D archetypeVersion=1.9.0-SNAPSHOT \
    -D groupId=com.mycompany \
    -D artifactId=myapp \
    -D version=1.0-SNAPSHOT \
    -D archetypeRepository=http://repository-estatio.forge.cloudbees.com/snapshot/ \
    -B</code></pre>
</div>
</div>
<div class="paragraph">
<p>where as before:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>groupId</code> represents your own organization, and</p>
</li>
<li>
<p><code>artifactId</code> is a unique identifier for this app within your organization.</p>
</li>
<li>
<p><code>version</code> is the initial (snapshot) version of your app</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>but also:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>archetypeVersion</code> is the SNAPSHOT version of Apache Isis.</p>
</li>
<li>
<p><code>archetypeRepository</code> specifies the location of our snapshot repo (hosted on <a href="http://www.cloudbees.com">CloudBees</a>), and</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The archetype generation process will then run; it only takes a few seconds.</p>
</div>
</div>
<div class="sect3">
<h4 id="_building_the_app">3.2.2. Building the App</h4>
<div class="paragraph">
<p>Switch into the root directory of your newly generated app, and build your app:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd myapp
mvn clean install</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>myapp</code> is the <code>artifactId</code> entered above.</p>
</div>
</div>
<div class="sect3">
<h4 id="_running_the_app">3.2.3. Running the App</h4>
<div class="paragraph">
<p>The <code>simpleapp</code> archetype generates a single WAR file, configured to run both the <a href="#_ug_wicket-viewer">Wicket viewer</a> and the <a href="#_ug_restfulobjects-viewer">Restful Objects viewer</a>.  The archetype also configures the [JDO Objectstore](../../components/objectstores/jdo/about.html) to use an in-memory HSQLDB connection.</p>
</div>
<div class="paragraph">
<p>Once you&#8217;ve built the app, you can run the WAR in a variety of ways.</p>
</div>
<div class="sect4">
<h5 id="_self_hosted">Self-hosted</h5>
<div class="paragraph">
<p>The easiest way to run the app, at least while getting started, is to run the self-hosting version of the WAR.  With this style the app runs up its own internal instance of Jetty web server.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">java -jar webapp/target/myapp-webapp-1.0-SNAPSHOT-jetty-console.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can also be accomplished using an embedded Ant target provided in the build script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mvn -P self-host antrun:run</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_using_mvn_jetty_plugin">Using mvn Jetty plugin</h5>
<div class="paragraph">
<p>Alternatively, you could run the WAR in a Maven-hosted Jetty instance, though you need to <code>cd</code> into the <code>webapp</code> module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd webapp
mvn jetty:run</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use <code>mvn jetty:run</code>, then the context path changes; check the console output (eg link:[<a href="http://localhost:8080/myapp-webapp" class="bare">http://localhost:8080/myapp-webapp</a>] [<a href="http://localhost:8080/myapp-webapp" class="bare">http://localhost:8080/myapp-webapp</a>]).</p>
</div>
<div class="paragraph">
<p>You can also provide a system property to change the port:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd webapp
mvn jetty:run -D jetty.port=9090</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_using_a_regular_servlet_container">Using a regular servlet container</h5>
<div class="paragraph">
<p>You can also take the built WAR file and deploy it into a standalone servlet container such as [Tomcat](<a href="http://tomcat.apache.org" class="bare">http://tomcat.apache.org</a>).  The default configuration does not require any configuration of the servlet container; just drop the WAR file into the <code>webapps</code> directory.</p>
</div>
</div>
<div class="sect4">
<h5 id="_from_within_the_ide">From within the IDE</h5>
<div class="paragraph">
<p>Most of the time, though, you&#8217;ll probably want to run the app from within your IDE.  The mechanics of doing this will vary by IDE; see the <a href="dg.adoc">Developers' Guide</a> for details of setting up Eclipse or IntelliJ IDEA.  Basically, though, it amounts to running <code>org.apache.isis.WebServer</code>, and ensuring that the <a href="#_ug_getting-started_datanucleus-enhancer">DataNucleus enhancer</a> has properly processed all domain entities.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s what the setup looks like in IntelliJ IDEA:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/getting-started/simpleapp-webapp.png"><img src="images/getting-started/simpleapp-webapp.png" alt="simpleapp webapp" width="600px"></a>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_running_with_fixtures">3.2.4. Running with Fixtures</h4>
<div class="paragraph">
<p>It is also possible to start the application with a pre-defined set of data; useful for demos or manual exploratory testing.  This is done by specifying a <a href="#_ug_testing_fixture-scripts">fixture script</a> on the command line.</p>
</div>
<div class="paragraph">
<p>If running the self-hosted console, you can specify the fixtures using the <code>--initParam</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">java -jar webapp/target/myapp-webapp-1.0-SNAPSHOT-jetty-console.jar \
     --initParam isis.persistor.datanucleus.install-fixtures=true  \
     --initParam isis.fixtures=domainapp.fixture.scenarios.RecreateSimpleObjects</code></pre>
</div>
</div>
<div class="paragraph">
<p>where (in the above example) <code>domainapp.fixture.scenarios.RecreateSimpleObjects</code> is the fully qualified class name of the fixture
script to be run.</p>
</div>
<div class="paragraph">
<p>If you are running the app from an IDE, then you can specify the fixture script using the <code>--fixture</code> flag:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/getting-started/simpleapp-webapp-with-fixtures.png"><img src="images/getting-started/simpleapp-webapp-with-fixtures.png" alt="simpleapp webapp with fixtures" width="600px"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_app">3.2.5. Using the App</h4>
<div class="paragraph">
<p>When you start the app, you&#8217;ll be presented with a welcome page from which you can access the webapp using either the <a href="#_ug_wicket-viewer">Wicket viewer</a> or the <a href="#_ug_restfulobjects-viewer">Restful Objects viewer</a>:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/getting-started/using-simple-app/010-root-page.png"><img src="images/getting-started/using-simple-app/010-root-page.png" alt="010 root page" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>The Wicket viewer provides a human usable web UI (implemented, as you might have guessed from its name, using <a href="http://wicket.apache.org">Apache Wicket</a>), so choose that and navigate to the login page:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/getting-started/using-simple-app/020-login-to-wicket-viewer.png"><img src="images/getting-started/using-simple-app/020-login-to-wicket-viewer.png" alt="020 login to wicket viewer" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>The app itself is configured to run using <a href="#_ug_security">shiro security</a>, as configured in the <code>WEB-INF/shiro.ini</code> config file.  You can login with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>username: <em>sven</em></p>
</li>
<li>
<p>password: <em>pass</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The application is configured to run with an in-memory database, and (unless you started the app with fixture scripts as described above), initially there is no data.  We can though run a fixture script from the app itself:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/getting-started/using-simple-app/030-home-page-run-fixture-scripts.png"><img src="images/getting-started/using-simple-app/030-home-page-run-fixture-scripts.png" alt="030 home page run fixture scripts" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>The fixture script creates three objects, and the action returns the first of these:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/getting-started/using-simple-app/040-first-object.png"><img src="images/getting-started/using-simple-app/040-first-object.png" alt="040 first object" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>The application generated is deliberaetly very minimal; we don&#8217;t want you to have to waste valuable time removing generated files.  The object contains a single "name" property, and a single action to update that property:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/getting-started/using-simple-app/050-update-name-prompt.png"><img src="images/getting-started/using-simple-app/050-update-name-prompt.png" alt="050 update name prompt" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>When you hit OK, the object is updated:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/getting-started/using-simple-app/060-object-updated.png"><img src="images/getting-started/using-simple-app/060-object-updated.png" alt="060 object updated" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>For your most signficant domain entities you&#8217;ll likely have a domain service to retrieve or create instances of those obejcts.  In the generated app we have a "Simple Objects" domain service that lets us list all objects:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/getting-started/using-simple-app/070-list-all-prompt.png"><img src="images/getting-started/using-simple-app/070-list-all-prompt.png" alt="070 list all prompt" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>whereby we see the three objects created by the fixture script (one having been updated):</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/getting-started/using-simple-app/080-list-all.png"><img src="images/getting-started/using-simple-app/080-list-all.png" alt="080 list all" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>and we can also use the domain service to create new instances:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/getting-started/using-simple-app/090-create.png"><img src="images/getting-started/using-simple-app/090-create.png" alt="090 create" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>prompting us for the mandatory information (the name):</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/getting-started/using-simple-app/100-create-prompt.png"><img src="images/getting-started/using-simple-app/100-create-prompt.png" alt="100 create prompt" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>which, of course, returns the newly created object:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/getting-started/using-simple-app/110-object-created.png"><img src="images/getting-started/using-simple-app/110-object-created.png" alt="110 object created" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>When we list all objects again, we can see that the object was indeed created:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/getting-started/using-simple-app/120-list-all.png"><img src="images/getting-started/using-simple-app/120-list-all.png" alt="120 list all" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>Going back to the home page (<a href="http://localhost:8080">localhost:8080</a>) we can also access the Restful Objects viewer.  The generated application is configured to use HTTP Basic Auth:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/getting-started/using-simple-app/220-login-to-restful-viewer.png"><img src="images/getting-started/using-simple-app/220-login-to-restful-viewer.png" alt="220 login to restful viewer" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>The Restful Objects viewer provides a REST API for computer-to-computer interaction, but we can still interact with it from a browser:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/getting-started/using-simple-app/230-home-page.png"><img src="images/getting-started/using-simple-app/230-home-page.png" alt="230 home page" width="600px"></a>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Depending on your browser, you may need to install plugins.  For Chrome, we recommend json-view (which renders the JSON indented and automatically detects hyperlinks) and REST Postman.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The REST API is a complete hypermedia API, in other words you can follow the links to access all the behaviour exposed in the regular Wicket app.  For example, we can navigate to the <code>listAll/invoke</code> resource:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/getting-started/using-simple-app/240-list-all-invoke.png"><img src="images/getting-started/using-simple-app/240-list-all-invoke.png" alt="240 list all invoke" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>which when invoked (with an HTTP GET) will return a representation of the domain objects.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/getting-started/using-simple-app/250-list-all-results.png"><img src="images/getting-started/using-simple-app/250-list-all-results.png" alt="250 list all results" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>To log in, use <code>sven/pass</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_modifying_the_app">3.2.6. Modifying the App</h4>
<div class="paragraph">
<p>Once you are familiar with the generated app, you&#8217;ll want to start modifying it.  There is plenty of guidance on this site; check out the 'programming model how-tos' section on the main [documentation](../../documentation.html) page first).</p>
</div>
<div class="paragraph">
<p>If you use Eclipse or IntelliJ IDEA, do also install the [Eclipse templates](../resources/editor-templates.html); these will help you follow the Apache Isis naming conventions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_app_structure">3.2.7. App Structure</h4>
<div class="paragraph">
<p>As noted above, the generated app is a very simple application consisting of a single domain object that can be easily renamed and extended. The intention is not to showcase all of Apache Isis' capabilities; rather it is to allow you to very easily modify the generated application (eg rename <code>SimpleObject</code> to <code>Customer</code>) without having to waste time deleting lots of generated code.</p>
</div>
<div class="paragraph">
<p>&lt;table class="table table-striped table-bordered table-condensed"&gt;
&lt;tr&gt;&lt;th&gt;Module&lt;/th&gt;&lt;th&gt;Description&lt;/th&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;myapp&lt;/td&gt;&lt;td&gt;The parent (aggregator) module&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;myapp-dom&lt;/td&gt;&lt;td&gt;The domain object model, consisting of &lt;tt&gt;SimpleObject&lt;/tt&gt; and &lt;tt&gt;SimpleObjects&lt;/tt&gt; (repository) domain service.&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;myapp-fixture&lt;/td&gt;&lt;td&gt;Domain object fixtures used for initializing the system when being demo&#8217;ed or for unit testing.&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;myapp-integtests&lt;/td&gt;&lt;td&gt;End-to-end &lt;a href="../../core/integtestsupport.html"&gt;integration tests&lt;/a&gt;, that exercise from the UI through to the database&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;myapp-webapp&lt;/td&gt;&lt;td&gt;Run as a webapp (from &lt;tt&gt;web.xml&lt;/tt&gt;) using either the Wicket viewer or the Restful Objects viewer&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;</p>
</div>
<div class="paragraph">
<p>If you run into issues, please don&#8217;t hesitate to ask for help on the [users mailing list](../../support.html).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_getting-started_datanucleus-enhancer">3.3. Datanucleus Enhancer</h3>
<div class="paragraph">
<p><a href="http://www.datanucleus.org/">DataNucleus</a> is the reference implementation of the JDO (Java data objects) spec, and Apache Isis integrates with DataNucleus as its persistence layer.  Datanucleus is a very powerful library, allowing domain entities to be mapped not only to relational database tables, but also to NoSQL stores such as <a href="http://neo4j.com/">Neo4J</a>, <a href="http://www.mongodb.org/">MongoDB</a> and <a href="http://cassandra.apache.org/">Apache Cassandra</a>.</p>
</div>
<div class="paragraph">
<p>With such power comes a little bit of complexity to the development environment: all domain entities must be enhanced through the DataNucleus enhancer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Bytecode enhancement is actually a requirement of the JDO spec; the process is described in outline <a href="http://db.apache.org/jdo/enhancement.html">here</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>What this means is that the enhancer&#8201;&#8212;&#8201;available as both a Maven plugin and as an Eclipse plugin&#8201;&#8212;&#8201;must, one way or another, be integrated into your development environment.</p>
</div>
<div class="paragraph">
<p>If working from the Maven command line, JDO enhancement is done using the <code>maven-datanucleus-plugin</code>.  As of 1.9.0-SNAPSHOT, we put all the configuration into an (always active) profile:</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The configuration described below is automatically set up by the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;profile&gt;</span>
    <span class="tag">&lt;id&gt;</span>enhance<span class="tag">&lt;/id&gt;</span>
    <span class="tag">&lt;activation&gt;</span>
        <span class="tag">&lt;activeByDefault&gt;</span>true<span class="tag">&lt;/activeByDefault&gt;</span>
    <span class="tag">&lt;/activation&gt;</span>
    <span class="tag">&lt;properties&gt;</span>
        <span class="tag">&lt;datanucleus-maven-plugin.version&gt;</span>4.0.0-release<span class="tag">&lt;/datanucleus-maven-plugin.version&gt;</span>
    <span class="tag">&lt;/properties&gt;</span>
    <span class="tag">&lt;build&gt;</span>
        <span class="tag">&lt;plugins&gt;</span>
            <span class="tag">&lt;plugin&gt;</span>
                <span class="tag">&lt;groupId&gt;</span>org.datanucleus<span class="tag">&lt;/groupId&gt;</span>
                <span class="tag">&lt;artifactId&gt;</span>datanucleus-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
                <span class="tag">&lt;version&gt;</span>${datanucleus-maven-plugin.version}<span class="tag">&lt;/version&gt;</span>
                <span class="tag">&lt;configuration&gt;</span>
                    <span class="tag">&lt;fork&gt;</span>false<span class="tag">&lt;/fork&gt;</span>
                    <span class="tag">&lt;log4jConfiguration&gt;</span>${basedir}/log4j.properties<span class="tag">&lt;/log4jConfiguration&gt;</span>
                    <span class="tag">&lt;verbose&gt;</span>true<span class="tag">&lt;/verbose&gt;</span>
                    <span class="tag">&lt;props&gt;</span>${basedir}/datanucleus.properties<span class="tag">&lt;/props&gt;</span>
                <span class="tag">&lt;/configuration&gt;</span>
                <span class="tag">&lt;executions&gt;</span>
                    <span class="tag">&lt;execution&gt;</span>
                        <span class="tag">&lt;phase&gt;</span>process-classes<span class="tag">&lt;/phase&gt;</span>
                        <span class="tag">&lt;goals&gt;</span>
                            <span class="tag">&lt;goal&gt;</span>enhance<span class="tag">&lt;/goal&gt;</span>
                        <span class="tag">&lt;/goals&gt;</span>
                    <span class="tag">&lt;/execution&gt;</span>
                <span class="tag">&lt;/executions&gt;</span>
            <span class="tag">&lt;/plugin&gt;</span>
        <span class="tag">&lt;/plugins&gt;</span>
    <span class="tag">&lt;/build&gt;</span>
    <span class="tag">&lt;dependencies&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.datanucleus<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>datanucleus-core<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.datanucleus<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>datanucleus-jodatime<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.datanucleus<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>datanucleus-api-jdo<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;/dependencies&gt;</span>
<span class="tag">&lt;/profile&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a>  sets up the plugin correctly in the <code>dom</code> (domain object model) module.  (It&#8217;s actually a little bit more complex to cater for users of the Eclipse IDE using Eclipse&#8217;s m2e plugin).</p>
</div>
<div class="sect3">
<h4 id="__code_meta_inf_persistence_xml_code">3.3.1. <code>META-INF/persistence.xml</code></h4>
<div class="paragraph">
<p>It&#8217;s also a good idea to ensure that the <code>dom</code> module has a JDO <code>META-INF/persistence.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="tag">&lt;persistence</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/persistence</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;persistence-unit</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tag">&lt;/persistence-unit&gt;</span>
<span class="tag">&lt;/persistence&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>change as required; typically is the name of the app.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Again, the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a> does this.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If running on Windows, then there&#8217;s a good chance you&#8217;ll hit the <a href="http://msdn.microsoft.com/en-us/library/aa365247%28VS.85%29.aspx#maxpath">maximum path length limit</a>.   In this case the <code>persistence.xml</code> file is mandatory rather than optional.</p>
</div>
<div class="paragraph">
<p>This file is also required if you are using developing in Eclipse and relying on the DataNucleus plugin for Eclipse rather than the DataNucleus plugin for Maven.  More information can be found <a href="dg.adoc#_dg_eclipse">here</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ug_tutorials">4. Tutorials</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter contains a couple of tutorials for you to follow.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the "petclinic" tutorial takes you step-by-step through building a simple application of just three classes.  There are example solutions in the github repo in case you get lost.</p>
</li>
<li>
<p>the "stop scaffolding, start coding" tutorial is taken from a conference workshop.  It has less hand-holding, but lists out the steps for you to follow.  It&#8217;s a good cookbook to follow when you&#8217;re readng to take things further.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Have fun!</p>
</div>
<div class="sect2">
<h3 id="_ug_tutorials_pet-clinic">4.1. Pet Clinic</h3>
<div class="paragraph">
<p>This is a step-by-step tutorial to build up a simple "petclinic" application, starting from the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a>.</p>
</div>
<div class="paragraph">
<p>It consists of just three domain classes (<a href="http://yuml.me/edit/3db2078c">http://yuml.me/3db2078c</a>):</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/tutorials/pet-clinic/domain-model.png"><img src="images/tutorials/pet-clinic/domain-model.png" alt="domain model"></a>
</div>
</div>
<div class="paragraph">
<p>This supports the following use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>register a Pet</p>
</li>
<li>
<p>register an Owner</p>
</li>
<li>
<p>maintain a Pet&#8217;s details</p>
</li>
<li>
<p>check in a Pet to visit the clinic</p>
</li>
<li>
<p>enter a diagnosis</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>check out a Pet to visit the clinic</p>
</div>
<div class="paragraph">
<p>Either follow along or check out the tags from the corresponding <a href="https://github.com/danhaywood/isis-app-petclinic">github repo</a>.</p>
</div>
<div class="sect3">
<h4 id="_prerequisites_2">4.1.1. Prerequisites</h4>
<div class="paragraph">
<p>You&#8217;ll need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java 7 JDK</p>
</li>
<li>
<p><a href="http://maven.apache.org/">Maven</a> 3.2.x</p>
</li>
<li>
<p>an IDE, such as <a href="http://www.eclipse.org/">Eclipse</a> or <a href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_run_the_archetype">4.1.2. Run the archetype</h4>
<div class="paragraph">
<p>Throughout this tutorial you can, if you wish, just checkout from the github repo wherever you see a "git checkout" note:</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">git checkout https://github.com/danhaywood/isis-app-petclinic/commit/249abe476797438d83faa12ff88365da2c362451</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This tutorial was developed against Apache Isis 1.8.0-SNAPSHOT.  Since then 1.8.0 has been released, so simply replace "1.8.0-SNAPSHOT" for "1.8.0" wherever it appears in the <code>pom.xml</code> files.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Run the simpleapp archetype to build an empty Isis application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mvn archetype:generate  \
    -D archetypeGroupId=org.apache.isis.archetype \
    -D archetypeArtifactId=simpleapp-archetype \
    -D archetypeVersion=1.8.0 \
    -D groupId=com.mycompany \
    -D artifactId=petclinic \
    -D version=1.0-SNAPSHOT \
    -D archetypeRepository=http://repository-estatio.forge.cloudbees.com/snapshot/ \
    -B</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will generate the app in a <code>petclinic</code> directory. Move the contents back:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mv petclinic/* .
rmdir petclinic</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_build_and_run">4.1.3. Build and run</h4>
<div class="paragraph">
<p>Start off by building the app from the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mvn clean install</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once that&#8217;s built then run using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mvn antrun:run -P self-host</code></pre>
</div>
</div>
<div class="paragraph">
<p>A splash screen should appear offering to start up the app. Go ahead and start; the web browser should be opened at <a href="http://localhost:8080">http://localhost:8080</a></p>
</div>
<div class="paragraph">
<p>Alternatively, you can run using the mvn-jetty-plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mvn jetty:run</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will accomplish the same thing, though the webapp is mounted at a slightly different URL</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_app_2">4.1.4. Using the app</h4>
<div class="paragraph">
<p>Navigate to the Wicket UI (eg <a href="http://localhost:8080/wicket">http://localhost:8080/wicket</a>), and login (sven/pass).</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/tutorials/pet-clinic/010-01-login-page.png"><img src="images/tutorials/pet-clinic/010-01-login-page.png" alt="010 01 login page" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>The home page should be shown:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/tutorials/pet-clinic/010-02-home-page.png"><img src="images/tutorials/pet-clinic/010-02-home-page.png" alt="010 02 home page" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>Install the fixtures (example test data) using the <code>Prototyping</code> menu:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/tutorials/pet-clinic/010-03-prototyping-menu.png"><img src="images/tutorials/pet-clinic/010-03-prototyping-menu.png" alt="010 03 prototyping menu" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>List all objects using the <code>Simple Objects</code> menu:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/tutorials/pet-clinic/010-04-simpleobjects.png"><img src="images/tutorials/pet-clinic/010-04-simpleobjects.png" alt="010 04 simpleobjects" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>To return the objects created:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/tutorials/pet-clinic/010-05-simpleobject-list.png"><img src="images/tutorials/pet-clinic/010-05-simpleobject-list.png" alt="010 05 simpleobject list" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>Experiment some more, to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>create a new object</p>
</li>
<li>
<p>list all objects</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Go back to the splash screen, and quit the app. Note that the database runs in-memory (using HSQLDB) so any data created will be lost between runs.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dev_environment">4.1.5. Dev environment</h4>
<div class="paragraph">
<p>Set up <a href="dg.adoc">an IDE</a> and import the project to be able to run and debug the app.</p>
</div>
<div class="paragraph">
<p>Then set up a launch configuration so that you can run the app from within the IDE. To save having to run the fixtures
every time, specify the following system properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">-Disis.persistor.datanucleus.install-fixtures=true -Disis.fixtures=fixture.simple.scenario.SimpleObjectsFixture</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, here&#8217;s what a launch configuration in IntelliJ idea looks like:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/tutorials/pet-clinic/020-01-idea-configuration.png"><img src="images/tutorials/pet-clinic/020-01-idea-configuration.png" alt="020 01 idea configuration" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>where the "before launch" maven goal (to run the DataNucleus enhancer) is defined as:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/tutorials/pet-clinic/020-02-idea-configuration.png"><img src="images/tutorials/pet-clinic/020-02-idea-configuration.png" alt="020 02 idea configuration" width="400px"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_explore_codebase">4.1.6. Explore codebase</h4>
<div class="paragraph">
<p>Apache Isis applications are organized into several Maven modules. Within your IDE navigate to the various classes and correlate back to the generated UI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>petclinic</code> : parent module</p>
</li>
<li>
<p><code>petclinic-dom</code>: domain objects module</p>
<div class="ulist">
<ul>
<li>
<p>entity: <code>dom.simple.SimpleObject</code></p>
</li>
<li>
<p>repository: <code>dom.simple.SimpleObjects</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>petclinic-fixture</code>: fixtures module</p>
<div class="ulist">
<ul>
<li>
<p>fixture script:`fixture.simple.SimpleObjectsFixture`</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>petclinic-integtests</code>: integration tests module</p>
</li>
<li>
<p><code>petclinic-webapp</code>: webapp module</p>
<div class="ulist">
<ul>
<li>
<p>(builds the WAR file)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_testing">4.1.7. Testing</h4>
<div class="paragraph">
<p>Testing is of course massively important, and Apache Isis makes both unit testing and (end-to-end) integration testing easy. Building the app from the Maven command line ("mvn clean install") will run all tests, but you should also run the tests from within the IDE.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>myapp-dom</code> unit tests</p>
</li>
<li>
<p>run</p>
</li>
<li>
<p>inspect, eg</p>
<div class="ulist">
<ul>
<li>
<p><code>SimpleObjectTest</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>myapp-integtests</code> integration tests</p>
</li>
<li>
<p>run</p>
</li>
<li>
<p>inspect, eg:</p>
<div class="ulist">
<ul>
<li>
<p><code>integration.tests.smoke.SimpleObjectsTest</code></p>
</li>
<li>
<p><code>integration.specs.simple.SimpleObjectSpec_listAllAndCreate.feature</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>generated report, eg</p>
<div class="ulist">
<ul>
<li>
<p><code>myapp/integtests/target/cucumber-html-report/index.html</code></p>
<div class="ulist">
<ul>
<li>
<p>change test in IDE, re-run (in Maven)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you have issues with the integration tests, make sure that the domain classes have been enhanced by the DataNucleus enhancer. (The exact mechanics depends on the IDE being used).</p>
</div>
</div>
<div class="sect3">
<h4 id="_update_pom_files">4.1.8. Update POM files</h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">git checkout https://github.com/danhaywood/isis-app-petclinic/commit/68904752bc2de9ebb3c853b79236df2b3ad2c944</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The POM files generated by the simpleapp archetype describe the app as "SimpleApp". Update them to say "PetClinic" instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="_delete_the_bdd_specs">4.1.9. Delete the BDD specs</h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">git checkout https://github.com/danhaywood/isis-app-petclinic/commit/9046226249429b269325dfa2baccf03635841c20</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>During this tutorial we&#8217;re going to keep the integration tests in-sync with the code, but we&#8217;re going to stop short of writing BDD/Cucumber specs.</p>
</div>
<div class="paragraph">
<p>Therefore delete the BDD feature spec and glue in the <code>integtest</code> module:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>integration/specs/*</code></p>
</li>
<li>
<p><code>integration/glue/*</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_rename_artifacts">4.1.10. Rename artifacts</h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">git checkout https://github.com/danhaywood/isis-app-petclinic/commit/bee3629c0b64058f939b6dd20f226be31810fc66</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Time to start refactoring the app. The heart of the PetClinic app is the <code>Pet</code> concept, so go through the code and refactor. While we&#8217;re at it, refactor the app itself from "SimpleApp" to "PetClinicApp".</p>
</div>
<div class="paragraph">
<p>See the git commit for more detail, but in outline, the renames required are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in the <code>dom</code> module&#8217;s production code</p>
<div class="ulist">
<ul>
<li>
<p><code>SimpleObject</code> -&gt; <code>Pet</code> (entity)</p>
</li>
<li>
<p><code>SimpleObjects</code> -&gt; <code>Pets</code> (repository domain service)</p>
</li>
<li>
<p><code>SimpleObject.layout.json</code> -&gt; <code>Pet.layout.json</code> (layout hints for the <code>Pet</code> entity)</p>
</li>
<li>
<p>delete the <code>SimpleObject.png</code>, and add a new <code>Pet.png</code> (icon shown against all <code>Pet</code> instances).</p>
</li>
</ul>
</div>
</li>
<li>
<p>in the <code>dom</code> module&#8217;s unit test code</p>
<div class="ulist">
<ul>
<li>
<p><code>SimpleObjectTest</code> -&gt; <code>PetTest</code> (unit tests for <code>Pet</code> entity)</p>
</li>
<li>
<p><code>SimpleObjectsTest</code> -&gt; <code>PetsTest</code> (unit tests for <code>Pets</code> domain service)</p>
</li>
</ul>
</div>
</li>
<li>
<p>in the <code>fixture</code> module:</p>
<div class="ulist">
<ul>
<li>
<p><code>SimpleObjectsFixturesService</code> -&gt; <code>PetClinicAppFixturesService</code> (rendered as the prototyping menu in the UI)</p>
</li>
<li>
<p><code>SimpleObjectsTearDownService</code> -&gt; <code>PetClinicAppTearDownService</code> (tear down all objects between integration tests)</p>
</li>
<li>
<p><code>SimpleObjectAbstract</code> -&gt; <code>PetAbstract</code> (abstract class for setting up a single pet object</p>
<div class="ulist">
<ul>
<li>
<p>and corresponding subclasses to set up sample data (eg <code>PetForFido</code>)</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>SimpleObjectsFixture</code> -&gt; <code>PetsFixture</code> (tear downs system and then sets up all pets)</p>
</li>
</ul>
</div>
</li>
<li>
<p>in the <code>integtest</code> module:</p>
<div class="ulist">
<ul>
<li>
<p><code>SimpleAppSystemInitializer</code> -&gt; <code>PetClinicAppSystemInitializer</code> (bootstraps integration tests with domain service/repositories)</p>
</li>
<li>
<p><code>SimpleAppIntegTest</code> -&gt; <code>PetClinicAppIntegTest</code> (base class for integration tests)</p>
</li>
<li>
<p><code>SimpleObjectTest</code> -&gt; <code>PetTest</code> (integration test for <code>Pet</code> entity)</p>
</li>
<li>
<p><code>SimpleObjectsTest</code> -&gt; <code>PetsTest</code> (integration test for <code>Pets</code> domain service)</p>
</li>
</ul>
</div>
</li>
<li>
<p>in the <code>webapp</code> module:</p>
<div class="ulist">
<ul>
<li>
<p><code>SimpleApplication</code> -&gt; <code>PetClinicApplication</code></p>
</li>
<li>
<p>update <code>isis.properties</code></p>
</li>
<li>
<p>update <code>web.xml</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that <code>Pet</code> has both both Isis and JDO annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.PersistenceCapable(identityType=IdentityType.DATASTORE) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@javax</span>.jdo.annotations.DatastoreIdentity(                                      <i class="conum" data-value="2"></i><b>(2)</b>
        strategy=javax.jdo.annotations.IdGeneratorStrategy.IDENTITY,
         column=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@javax</span>.jdo.annotations.Version(                                                <i class="conum" data-value="3"></i><b>(3)</b>
        strategy=VersionStrategy.VERSION_NUMBER,
        column=<span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@javax</span>.jdo.annotations.Unique(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">Pet_name_UNQ</span><span class="delimiter">&quot;</span></span>, members = {<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>})         <i class="conum" data-value="4"></i><b>(4)</b>
<span class="annotation">@ObjectType</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">PET</span><span class="delimiter">&quot;</span></span>)                                                             <i class="conum" data-value="5"></i><b>(5)</b>
<span class="annotation">@Bookmarkable</span>                                                                  <i class="conum" data-value="6"></i><b>(6)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Pet</span> <span class="directive">implements</span> <span class="predefined-type">Comparable</span>&lt;Pet&gt; {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@PersistenceCapable</code> and</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>@DatastoreIdentity</code> specify a surrogate <code>Id</code> column to be used as the primary key</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>@Version</code> provides support for optimistic locking</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>@Unique</code> enforces a uniqueness constraint so that no two `Pet`s can have the same name (unrealistic, but can refactor later)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>@ObjectType</code> is used by Apache Isis for its own internal "OID" identifier; this also appears in the URL in Apache Isis' Wicket viewer and REST API</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>@Bookmarkable</code> indicates that the object can be automatically bookmarked in Apache Isis' Wicket viewer</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>@ObjectType</code> and <code>@Bookmarkable</code> annotations have since been deprecated, replaced with <code>@DomainObject(objectType=&#8230;&#8203;)</code> and <code>@DomainObjectLayout(bookmarking=&#8230;&#8203;)</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>Pets</code> domain service also has Isis annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(repositoryFor = Pet.class)
<span class="annotation">@DomainServiceLayout</span>(menuOrder = <span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Pets</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DomainService</code> indicates that the service should be instantiated automatically (as a singleton)</p>
</li>
<li>
<p><code>DomainServiceLayout</code> provides UI hints, in this case the positioning of the menu for the actions provided by the service</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To run the application will require an update to the IDE configuration, for the changed name of the fixture class:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/tutorials/pet-clinic/030-01-idea-configuration-updated.png"><img src="images/tutorials/pet-clinic/030-01-idea-configuration-updated.png" alt="030 01 idea configuration updated" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>Running the app should now show `Pet`s:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/tutorials/pet-clinic/030-02-updated-app.png"><img src="images/tutorials/pet-clinic/030-02-updated-app.png" alt="030 02 updated app" width="600px"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_update_package_names">4.1.11. Update package names</h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">git checkout https://github.com/danhaywood/isis-app-petclinic/commit/55ec36e520191f5fc8fe7f5b89956814eaf13317</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The classes created by the simpleapp archetype are by default in the <code>simple</code> package. Move these classes to <code>pets</code> package instead. Also adjust package names where they appear as strings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in <code>PetClinicAppFixturesService</code>, change the package name from "fixture.simple" to "fixture.pets".</p>
</li>
<li>
<p>in <code>PetClinicAppSystemInitializer</code>, change the package name "dom.simple" to "dom.pets", and similarly "fixture.simple" to "fixture.pets"</p>
</li>
<li>
<p>in <code>WEB-INF/isis.properties</code>, similarly change the package name "dom.simple" to "dom.pets", and similarly "fixture.simple" to "fixture.pets"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To run the application will require a further update to the IDE configuration, for the changed package of the fixture class:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/tutorials/pet-clinic/040-01-idea-configuration-updated.png"><img src="images/tutorials/pet-clinic/040-01-idea-configuration-updated.png" alt="040 01 idea configuration updated" width="600px"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_add_code_petspecies_code_enum">4.1.12. Add <code>PetSpecies</code> enum</h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">git checkout https://github.com/danhaywood/isis-app-petclinic/commit/55c9cd28ff960220719b3dc7cb8abadace8d0829</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each <code>Pet</code> is of a particular species. Model these as an enum called <code>PetSpecies</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">enum</span> PetSpecies {
    Cat,
    Dog,
    Budgie,
    Hamster,
    Tortoise
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Introduce a new property on <code>Pet</code> of this type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Pet</span> {
    ...
    private PetSpecies species;
    <span class="annotation">@javax</span>.jdo.annotations.Column(allowsNull = <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> PetSpecies getSpecies() { <span class="keyword">return</span> species; }
    <span class="directive">public</span> <span class="type">void</span> setSpecies(<span class="directive">final</span> PetSpecies species) { <span class="local-variable">this</span>.species = species; }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Update fixtures, unit tests and integration tests.</p>
</div>
</div>
<div class="sect3">
<h4 id="_icon_to_reflect_pet_species">4.1.13. Icon to reflect pet species</h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">git checkout https://github.com/danhaywood/isis-app-petclinic/commit/2212765694693eb463f8fa88bab1bad154add0cb</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Rather than using a single icon for a domain class, instead a different icon can be supplied for each instance. We can therefore have different icon files for each pet, reflecting that pet&#8217;s species.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Pet</span> {
    ...
    public <span class="predefined-type">String</span> iconName() {
        <span class="keyword">return</span> getSpecies().name();
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Download corresponding icon files (<code>Dog.png</code>, <code>Cat.png</code> etc)</p>
</div>
<div class="paragraph">
<p>Running the app shows the <code>Pet</code> and its associated icon:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/tutorials/pet-clinic/050-01-list-all.png"><img src="images/tutorials/pet-clinic/050-01-list-all.png" alt="050 01 list all" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>with the corresponding view of the <code>Pet</code>:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/tutorials/pet-clinic/050-02-view-pet.png"><img src="images/tutorials/pet-clinic/050-02-view-pet.png" alt="050 02 view pet" width="600px"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_add_pet_s_code_owner_code">4.1.14. Add pet&#8217;s <code>Owner</code></h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">git checkout https://github.com/danhaywood/isis-app-petclinic/commit/6f92a8ee8e76696d005da2a8b7a746444d017546</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Add the <code>Owner</code> entity and corresponding <code>Owners</code> domain service (repository). Add a query to find `Order`s by name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
<span class="annotation">@javax</span>.jdo.annotations.Queries( {
        <span class="annotation">@javax</span>.jdo.annotations.Query(
                name = <span class="string"><span class="delimiter">&quot;</span><span class="content">findByName</span><span class="delimiter">&quot;</span></span>, language = <span class="string"><span class="delimiter">&quot;</span><span class="content">JDOQL</span><span class="delimiter">&quot;</span></span>,
                value = <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT </span><span class="delimiter">&quot;</span></span>
                        + <span class="string"><span class="delimiter">&quot;</span><span class="content">FROM dom.owners.Owner </span><span class="delimiter">&quot;</span></span>
                        + <span class="string"><span class="delimiter">&quot;</span><span class="content">WHERE name.matches(:name)</span><span class="delimiter">&quot;</span></span>)
})
<span class="directive">public</span> <span class="type">class</span> <span class="class">Owner</span> ... {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and <code>findByName(&#8230;&#8203;)</code> in <code>Owners</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Owners</span> {
    ...
    public <span class="predefined-type">List</span>&lt;<span class="predefined-type">Owner</span>&gt; findByName(
            <span class="annotation">@ParameterLayout</span>(named = <span class="string"><span class="delimiter">&quot;</span><span class="content">Name</span><span class="delimiter">&quot;</span></span>)
            <span class="directive">final</span> <span class="predefined-type">String</span> name) {
        <span class="directive">final</span> <span class="predefined-type">String</span> nameArg = <span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">.*%s.*</span><span class="delimiter">&quot;</span></span>, name);
        <span class="directive">final</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Owner</span>&gt; owners = container.allMatches(
                <span class="keyword">new</span> QueryDefault&lt;&gt;(
                        <span class="predefined-type">Owner</span>.class,
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">findByName</span><span class="delimiter">&quot;</span></span>,
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, nameArg));
        <span class="keyword">return</span> owners;
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add an <code>owner</code> property to <code>Pet</code>, with supporting <code>autoCompleteXxx()</code> method (so that available owners are shown in a drop-down list box):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Pet</span> ... {
    ...
    private <span class="predefined-type">Owner</span> owner;
    <span class="annotation">@javax</span>.jdo.annotations.Column(allowsNull = <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">Owner</span> getOwner() { <span class="keyword">return</span> owner; }
    <span class="directive">public</span> <span class="type">void</span> setOwner(<span class="directive">final</span> <span class="predefined-type">Owner</span> owner) { <span class="local-variable">this</span>.owner = owner; }
    <span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;<span class="predefined-type">Owner</span>&gt; autoCompleteOwner(<span class="directive">final</span> <span class="annotation">@MinLength</span>(<span class="integer">1</span>) <span class="predefined-type">String</span> name) {
        <span class="keyword">return</span> owners.findByName(name);
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also updated fixture data to set up a number of <code>Owner`s, and associate each `Pet</code> with an <code>Owner</code>. Also add unit tests and integration tests for <code>Owner</code>/<code>Owners</code> and updated for <code>Pet</code>/<code>Pets</code>.</p>
</div>
<div class="paragraph">
<p>When running the app, notice the new <code>Owners</code> menu:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/tutorials/pet-clinic/060-01-owners-menu.png"><img src="images/tutorials/pet-clinic/060-01-owners-menu.png" alt="060 01 owners menu" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>which when invoked returns all <code>Owner</code> objects:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/tutorials/pet-clinic/060-02-owners-list.png"><img src="images/tutorials/pet-clinic/060-02-owners-list.png" alt="060 02 owners list" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>Each <code>Pet</code> also indicates its corresponding <code>Owner</code>:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/tutorials/pet-clinic/060-03-pets-list.png"><img src="images/tutorials/pet-clinic/060-03-pets-list.png" alt="060 03 pets list" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>And, on editing a <code>Pet</code>, a new <code>Owner</code> can be specified using the autoComplete:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/tutorials/pet-clinic/060-04-pet-owner-autoComplete.png"><img src="images/tutorials/pet-clinic/060-04-pet-owner-autoComplete.png" alt="060 04 pet owner autoComplete" width="600px"></a>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_tutorials_stop-scaffolding-start-coding">4.2. Stop scaffolding, start coding</h3>
<div class="paragraph">
<p>This is a half-day tutorial on developing domain-driven apps using Apache Isis.  Actually, you could probably spend a full day working through this tutorial if you wanted to, so pick and choose the bits that look interesting.</p>
</div>
<div class="paragraph">
<p>There&#8217;s a bit of overlap with the <a href="#_ug_tutorials_pet-clinic">Pet Clinic</a> tutorial initially, but it then sets off on its own.</p>
</div>
<div class="sect3">
<h4 id="_prerequisites_3">4.2.1. Prerequisites</h4>
<div class="paragraph">
<p>You&#8217;ll need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java 7 JDK</p>
</li>
<li>
<p><a href="http://maven.apache.org/">Maven</a> 3.2.x</p>
</li>
<li>
<p>an IDE, such as <a href="http://www.eclipse.org/">Eclipse</a> or <a href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_run_the_archetype_2">4.2.2. Run the archetype</h4>
<div class="paragraph">
<p>Run the simpleapp archetype to build an empty Isis application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mvn archetype:generate  \
    -D archetypeGroupId=org.apache.isis.archetype \
    -D archetypeArtifactId=simpleapp-archetype \
    -D archetypeVersion=1.8.0 \
    -D groupId=com.mycompany \
    -D artifactId=myapp \
    -D version=1.0-SNAPSHOT \
    -D archetypeRepository=http://repository-estatio.forge.cloudbees.com/snapshot/ \
    -B</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_build_and_run_2">4.2.3. Build and run</h4>
<div class="paragraph">
<p>Start off by building the app from the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd myapp
mvn clean install</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once that&#8217;s built then run using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mvn antrun:run -P self-host</code></pre>
</div>
</div>
<div class="paragraph">
<p>A splash screen should appear offering to start up the app. Go ahead and start; the web browser should be opened at <a href="http://localhost:8080">http://localhost:8080</a></p>
</div>
<div class="paragraph">
<p>Alternatively, you can run using the mvn-jetty-plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mvn jetty:run</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will accomplish the same thing, though the webapp is mounted at a slightly different URL</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_app_3">4.2.4. Using the app</h4>
<div class="paragraph">
<p>Navigate to the Wicket UI (eg <a href="http://localhost:8080/wicket">http://localhost:8080/wicket</a>), and login (sven/pass).</p>
</div>
<div class="paragraph">
<p>Once at the home page:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>install fixtures</p>
</li>
<li>
<p>list all objects</p>
</li>
<li>
<p>create a new object</p>
</li>
<li>
<p>list all objects</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Go back to the splash screen, and quit the app. Note that the database runs in-memory (using HSQLDB) so any data created will be lost between runs.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dev_environment_2">4.2.5. Dev environment</h4>
<div class="paragraph">
<p>Set up <a href="dg.adoc">an IDE</a> and import the project to be able to run and debug the app.</p>
</div>
<div class="paragraph">
<p>Then set up a launch configuration and check that you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run the app from within the IDE</p>
</li>
<li>
<p>Run the app in debug mode</p>
</li>
<li>
<p>Run with different deploymentTypes; note whether prototype actions (those annotated <a href="rg.html#_rg_annotations_manpage-Action_restrictTo"><code>@Action(restrictTo=PROTOTYPING</code></a>) are available or not:</p>
</li>
<li>
<p><code>--type SERVER_PROTOTYPE</code></p>
</li>
<li>
<p><code>--type SERVER</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_explore_codebase_2">4.2.6. Explore codebase</h4>
<div class="paragraph">
<p>Apache Isis applications are organized into several Maven modules. Within your IDE navigate to the various classes and correlate back to the generated UI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>myapp</code> : parent module</p>
</li>
<li>
<p><code>myapp-dom</code>: domain objects module</p>
</li>
<li>
<p>entity: <code>dom.simple.SimpleObject</code></p>
</li>
<li>
<p>repository: <code>dom.simple.SimpleObjects</code></p>
</li>
<li>
<p><code>myapp-fixture</code>: fixtures module</p>
</li>
<li>
<p>fixture script:`fixture.simple.SimpleObjectsFixture`</p>
</li>
<li>
<p><code>myapp-integtests</code>: integration tests module</p>
</li>
<li>
<p><code>myapp-webapp</code>: webapp module</p>
</li>
<li>
<p>(builds the WAR file)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_testing_2">4.2.7. Testing</h4>
<div class="paragraph">
<p>Testing is of course massively important, and Apache Isis makes both unit testing and (end-to-end) integration testing easy. Building the app from the Maven command line ("mvn clean install") will run all tests, but you should also run the tests from within the IDE.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>myapp-dom</code> unit tests</p>
</li>
<li>
<p>run</p>
</li>
<li>
<p>inspect, eg</p>
<div class="ulist">
<ul>
<li>
<p><code>SimpleObjectTest</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>myapp-integtests</code> integration tests</p>
</li>
<li>
<p>run</p>
</li>
<li>
<p>inspect, eg:</p>
<div class="ulist">
<ul>
<li>
<p><code>integration.tests.smoke.SimpleObjectsTest</code></p>
</li>
<li>
<p><code>integration.specs.simple.SimpleObjectSpec_listAllAndCreate.feature</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>generated report, eg</p>
<div class="ulist">
<ul>
<li>
<p><code>myapp/integtests/target/cucumber-html-report/index.html</code></p>
<div class="ulist">
<ul>
<li>
<p>change test in IDE, re-run (in Maven)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you have issues with the integration tests, make sure that the domain classes have been enhanced by the DataNucleus enhancer. (The exact mechanics depends on the IDE being used).</p>
</div>
</div>
<div class="sect3">
<h4 id="_prototyping">4.2.8. Prototyping</h4>
<div class="paragraph">
<p>Although testing is important, in this tutorial we want to concentrate on how to write features and to iterate quickly. So for now, exclude the <code>integtests</code> module. Later on in the tutorial we&#8217;ll add the tests back in so you can learn how to write automated tests for the features of your app.</p>
</div>
<div class="paragraph">
<p>In the parent <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;modules&gt;</span>
    <span class="tag">&lt;module&gt;</span>dom<span class="tag">&lt;/module&gt;</span>
    <span class="tag">&lt;module&gt;</span>fixture<span class="tag">&lt;/module&gt;</span>
    <span class="tag">&lt;module&gt;</span>integtests<span class="tag">&lt;/module&gt;</span>
    <span class="tag">&lt;module&gt;</span>webapp<span class="tag">&lt;/module&gt;</span>
<span class="tag">&lt;/modules&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>change to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;modules&gt;</span>
    <span class="tag">&lt;module&gt;</span>dom<span class="tag">&lt;/module&gt;</span>
    <span class="tag">&lt;module&gt;</span>fixture<span class="tag">&lt;/module&gt;</span>
    <span class="comment">&lt;!--
    &lt;module&gt;integtests&lt;/module&gt;
    --&gt;</span>
    <span class="tag">&lt;module&gt;</span>webapp<span class="tag">&lt;/module&gt;</span>
<span class="tag">&lt;/modules&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_build_a_domain_app">4.2.9. Build a domain app</h4>
<div class="paragraph">
<p>The remainder of the tutorial provides guidance on building a domain application. We don&#8217;t mandate any particular design, but we suggest one with no more than 3 to 6 domain entities in the first instance. If you&#8217;re stuck for ideas, then how about:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a todo app (<code>ToDoItem</code>s)</p>
</li>
<li>
<p>a pet clinic (<code>Pet</code>, <code>Owner</code>, <code>PetSpecies</code>, <code>Visit</code>)</p>
</li>
<li>
<p>a library (<code>Book</code>, <code>Title</code>, <code>LibraryMember</code>, <code>Loan</code>, <code>Reservation</code>)</p>
</li>
<li>
<p>a holiday cottage rental system</p>
</li>
<li>
<p>a scrum/kanban system (inspired by Trello)</p>
</li>
<li>
<p>a meeting planner (inspired by Doodle)</p>
</li>
<li>
<p>(the domain model for) a CI server (inspired by Travis/Jenkins)</p>
</li>
<li>
<p>a shipping system (inspired by the example in the DDD "blue" book)</p>
</li>
<li>
<p>a system for ordering coffee (inspired by Restbucks, the example in "Rest in Practice" book)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hopefully one of those ideas appeals or sparks an idea for something of your own.</p>
</div>
</div>
<div class="sect3">
<h4 id="_domain_entity">4.2.10. Domain entity</h4>
<div class="paragraph">
<p>Most domain objects in Apache Isis applications are persistent entities. In the simpleapp archetype the <code>SimpleObject</code> is an example. We can start developing our app by refactoring that class:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>rename the <code>SimpleObject</code> class</p>
<div class="ulist">
<ul>
<li>
<p>eg rename to <code>Pet</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>if required, rename the <code>SimpleObject</code> class' <code>name</code> property</p>
<div class="ulist">
<ul>
<li>
<p>for <code>Pet</code>, can leave <code>name</code> property as is</p>
</li>
</ul>
</div>
</li>
<li>
<p>specify a <a href="#_ug_how-tos_ui-hints_object-titles-and-icons">title</a></p>
</li>
<li>
<p>specify an <a href="#_ug_how-tos_ui-hints_object-titles-and-icons">icon</a></p>
</li>
<li>
<p>make the entity bookmarkable by adding the <a href="rg.html#_rg_annotations_manpage-DomainObjectLayout_bookmarking"><code>@DomainObjectLayout#bookmarking()</code></a> attribute.</p>
</li>
<li>
<p>confirm is available from bookmark panel (top-left of Wicket UI)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_domain_service">4.2.11. Domain service</h4>
<div class="paragraph">
<p>Domain services often act as factories or repositories to entities; more generally can be used to "bridge across" to other domains/bounded contexts. Most are application-scoped, but they can also be request-scoped if required.</p>
</div>
<div class="paragraph">
<p>In the simpleapp archetype the <code>SimpleObjects</code> service is a factory/repository for the original <code>SimpleObject</code> entity. For our app it therefore makes sense to refactor that class into our own first service:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>rename the <code>SimpleObjects</code> class</p>
<div class="ulist">
<ul>
<li>
<p>eg rename to <code>Pets</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>review <code>create</code> action (acting as a factory)</p>
<div class="ulist">
<ul>
<li>
<p>as per the docs describing <a href="#_ug_how-tos_crud">how to create or delete objects</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>rename if you wish</p>
<div class="ulist">
<ul>
<li>
<p>eg <code>newPet(&#8230;&#8203;)</code> or <code>addPet(&#8230;&#8203;)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>review <code>listAll</code> action (acting as a repository)</p>
</li>
<li>
<p>as per the docs describing <a href="#_ug_how-tos_crud">how to write a custom repository</a></p>
</li>
<li>
<p>note the annotations on the corresponding domain class (originally called <code>SimpleObject</code>, though renamed by now, eg to <code>Pet</code>)</p>
</li>
<li>
<p>rename if you wish</p>
<div class="ulist">
<ul>
<li>
<p>eg <code>listPets()</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>note the <a href="rg.html#_rg_annotations_manpage-DomainService"><code>@DomainService</code></a> annotation</p>
</li>
<li>
<p>optional: add an action to a return subset of objects</p>
<div class="ulist">
<ul>
<li>
<p>use the JDO <code>@Query</code> annotation</p>
</li>
<li>
<p>see for example the Isisaddons example <a href="https://github.com/isisaddons/isis-app-todoapp">todoapp</a> (not ASF), see <a href="https://github.com/apache/isis/blob/b3e936c9aae28754fb46c2df52b1cb9b023f9ab8/example/application/todoapp/dom/src/main/java/dom/todo/ToDoItem.java#L93">here</a> and <a href="https://github.com/apache/isis/blob/b3e936c9aae28754fb46c2df52b1cb9b023f9ab8/example/application/todoapp/dom/src/main/java/dom/todo/ToDoItems.java#L63">here</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_fixture_scripts">4.2.12. Fixture scripts</h4>
<div class="paragraph">
<p>Fixture scripts are used to setup the app into a known state. They are great for demo&#8217;s and as a time-saver when implementing a feature, and they can also be reused in automated integration tests. We usually also have a fixture script to zap all the (non-reference) data (or some logical subset of the data)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>rename the <code>SimpleObjectsTearDownFixture</code> class</p>
</li>
<li>
<p>and update to delete from the appropriate underlying database table(s)</p>
</li>
<li>
<p>use the injected <a href="rg.html#_rg_services-api_manpage-IsisJdoSupport"><code>IsisJdoSupport</code></a> domain service.</p>
</li>
<li>
<p>refactor/rename the fixture script classes that create instances your entity:</p>
</li>
<li>
<p><code>RecreateSimpleObjects</code>, which sets up a set of objects for a given scenario</p>
</li>
<li>
<p><code>SimpleObjectCreate</code> which creates a single object</p>
</li>
<li>
<p>note that domain services can be injected into these fixture scripts</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_actions">4.2.13. Actions</h4>
<div class="paragraph">
<p>Most business functionality is implemented using actionsï¿½ basically a <code>public</code> method accepting domain classes and primitives as its parameter types. The action can return a domain entity, or a collection of entities, or a primitive/String/value, or void. If a domain entity is returned then that object is rendered immediately; if a collection is returned then the Wicket viewer renders a table. Such collections are sometimes called "standalone" collections.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>write an action to update the domain property (originally called <code>SimpleObject#name</code>, though renamed by now)</p>
</li>
<li>
<p>use the <a href="rg.html#_rg_annotations_manpage-ParameterLayout_named"><code>@ParameterLayout(named=&#8230;&#8203;)</code></a> annotation to specify the name of action parameters</p>
</li>
<li>
<p>use the <a href="rg.html#_rg_annotations_manpage-Action_semantics"><code>@Action(semanticsOf=&#8230;&#8203;)</code></a>  annotation to indicate the semantics of the action (safe/query-only, idempotent or non-idempotent)</p>
</li>
<li>
<p>annotate safe action as bookmarkable using <a href="rg.html#_rg_annotations_manpage-ActionLayout_bookmarking"><code>@ActionLayout(bookmarking=&#8230;&#8203;)</code></a></p>
</li>
<li>
<p>confirm is available from bookmark panel (top-left of Wicket UI)</p>
</li>
<li>
<p>optional: add an action to clone an object</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_rest_api">4.2.14. REST API</h4>
<div class="paragraph">
<p>As well as exposing the Wicket viewer, Isis also exposes a REST API (an implementation of the <a href="http://restfulobjects.org">Restful Objects spec</a>). All of the functionality of the domain object model is available through this REST API.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>add Chrome extensions</p>
</li>
<li>
<p>install <a href="https://chrome.google.com/webstore/detail/postman-rest-client/fdmmgilgnpjigdojojpjoooidkmcomcm?hl=en">Postman</a></p>
</li>
<li>
<p>install <a href="https://chrome.google.com/webstore/detail/jsonview/chklaanhfefbnpoihckbnefhakgolnmc?hl=en">JSON-View</a></p>
</li>
<li>
<p>browse to Wicket viewer, install fixtures</p>
</li>
<li>
<p>browse to the <a href="http://localhost:8080/restful">http://localhost:8080/restful</a> API</p>
</li>
<li>
<p>invoke the service to list all objects</p>
</li>
<li>
<p>services</p>
</li>
<li>
<p>actions</p>
</li>
<li>
<p>invoke (invoking 0-arg actions is easy; the Restful Objects spec defines how to invoke N-arg actions)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_specify_action_semantics">4.2.15. Specify Action semantics</h4>
<div class="paragraph">
<p>The semantics of an action (whether it is safe/query only, whether it is idempotent, whether it is neither) can be specified for each action; if not specified then Isis assumes non-idempotent. In the Wicket viewer this matters in that only query-only actions can be bookmarked or used as contributed properties/collections. In the RESTful viewer this matters in that it determines the HTTP verb (GET, PUT or POST) that is used to invoke the action.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>experiment changing <a href="rg.html#_rg_annotations_manpage-Action_semantics"><code>@Action(semantics=&#8230;&#8203;)</code></a> on actions</p>
</li>
<li>
<p>note the HTTP methods exposed in the REST API change</p>
</li>
<li>
<p>note whether the non-safe actions are bookmarkable (assuming that it has been annotated with <code>@ActionLayout(bookmarking=&#8230;&#8203;)</code>, that is).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_value_properties">4.2.16. Value properties</h4>
<div class="paragraph">
<p>Domain entities have state: either values (primitives, strings) or references to other entities. In this section we explore adding some value properties</p>
</div>
<div class="ulist">
<ul>
<li>
<p>add some <a href="#_ug_how-tos_class-structure_properties">value properties</a>; also:</p>
</li>
<li>
<p>for string properties</p>
<div class="ulist">
<ul>
<li>
<p>use the <a href="rg.html#_rg_annotations_manpage-PropertyLayout_multiLine"><code>@Property(multiLine=&#8230;&#8203;)</code></a> annotation to render a text area instead of a text box</p>
</li>
<li>
<p>use the <a href="rg.html#_rg_annotations_manpage-Property_maxLength"><code>@Property(maxLength=&#8230;&#8203;)</code></a> annotation to specify the maximum number of characters allowable</p>
</li>
<li>
<p>use joda date/time properties, bigdecimals and blob/clob properties</p>
</li>
</ul>
</div>
</li>
<li>
<p>use the <a href="rg.html#_rg_annotations_manpage-Property_optionality"><code>@Column(allowsNull=&#8230;&#8203;)</code></a> annotation specify whether a property is optional or mandatory</p>
</li>
<li>
<p>use enums for properties (eg as used in the Isis addons example <a href="https://github.com/isisaddons/isis-app-todoapp">todoapp</a>, see <a href="https://github.com/apache/isis/blob/b3e936c9aae28754fb46c2df52b1cb9b023f9ab8/example/application/todoapp/dom/src/main/java/dom/todo/ToDoItem.java#L207">here</a> and <a href="https://github.com/apache/isis/blob/b3e936c9aae28754fb46c2df52b1cb9b023f9ab8/example/application/todoapp/dom/src/main/java/dom/todo/ToDoItem.java#L266">here</a>)</p>
</li>
<li>
<p>update the corresponding domain service for creating new instances</p>
</li>
<li>
<p>for all non-optional properties will either need to prompt for a value, or calculate some suitable default</p>
</li>
<li>
<p>change the implementation of title, if need be</p>
</li>
<li>
<p>revisit the title, consider whether to use the <a href="rg.html#_rg_annotations_manpage-Title"><code>@Title</code></a> annotation</p>
<div class="ulist">
<ul>
<li>
<p>rather than the <a href="rg.html#_rg_methods_reserved_manpage-title"><code>title()</code></a> <code>title()</code> method</p>
</li>
</ul>
</div>
</li>
<li>
<p>order the properties using the <a href="rg.html#_rg_annotations_manpage-MemberOrder"><code>@MemberOrder</code></a>, also <code>@MemberGroupLayout</code></p>
<div class="ulist">
<ul>
<li>
<p>see also the docs on <a href="rg.html#_rg_object-layout_static">static layouts</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>use the <a href="rg.html#_rg_annotations_manpage-PropertyLayout"><code>@PropertyLayout</code></a> annotation to position property/action parameter labels either to the LEFT, TOP or NONE</p>
<div class="ulist">
<ul>
<li>
<p>do the same for parameters using <a href="rg.html#_rg_annotations_manpage-ParameterLayout"><code>@ParameterLayout</code></a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_reference_properties">4.2.17. Reference properties</h4>
<div class="paragraph">
<p>Domain entities can also reference other domain entities. These references may be either scalar (single-valued) or vector (multi-valued). In this section we focus on scalar reference properties.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>add some <a href="#_ug_how-tos_class-structure_properties">reference properties</a></p>
</li>
<li>
<p>update the corresponding domain service (for creation actoin)</p>
</li>
<li>
<p>use different techniques to obtain references (shown in drop-down list box)</p>
<div class="ulist">
<ul>
<li>
<p>use the <a href="rg.html#_rg_annotations_manpage-DomainObject_bounded"><code>@DomainObjectLayout(bounded=&#8230;&#8203;)</code></a> annotation on the referenced type if there are only a small number (bounded) of instances</p>
</li>
<li>
<p>use a <a href="rg.html#_rg_methods_prefixes_manpage-choices"><code>choices&#8230;&#8203;()</code></a> supporting method</p>
<div class="ulist">
<ul>
<li>
<p>on a property</p>
</li>
<li>
<p>on an action parameter</p>
</li>
</ul>
</div>
</li>
<li>
<p>use a <a href="rg.html#_rg_methods_prefixes_manpage-autoComplete"><code>autoComplete&#8230;&#8203;()</code></a> supporting method</p>
<div class="ulist">
<ul>
<li>
<p>on a property</p>
</li>
<li>
<p>on an action parameter</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_usability_defaults">4.2.18. Usability: Defaults</h4>
<div class="paragraph">
<p>Quick detour: often we want to set up defaults to go with choices. Sensible defaults for action parameters can really improve the usability of the app.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add <a href="#_ug_how-tos_drop-downs-and-defaults">defaults</a> for action parameters</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_collections">4.2.19. Collections</h4>
<div class="paragraph">
<p>Returning back to references, Isis also supports vector (multi-valued) references to another object instancesï¿½ in other words collections. We sometimes called these "parented" collections (to distinguish from a "standalone" collection as returned from an action)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure that all domain classes implement <code>java.lang.Comparable</code></p>
<div class="ulist">
<ul>
<li>
<p>use the <a href="rg.html#_rg_classes_utility_manpage-ObjectContracts"><code>ObjectContracts</code></a> utility class to help implement <code>Comparable</code></p>
<div class="ulist">
<ul>
<li>
<p>you can also <code>equals()</code>, <code>hashCode()</code>, <code>toString()</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Add a <a href="#_ug_how-tos_class-structure_collections">collection</a> to one of the entities</p>
<div class="ulist">
<ul>
<li>
<p>Use <code>SortedSet</code> as the class</p>
</li>
<li>
<p>Use the <a href="rg.html#_rg_annotations_manpage-CollectionLayout_render"><code>@CollectionLayout(render=&#8230;&#8203;)</code></a> annotation to indicate if the collection should be visible or hidden by default</p>
</li>
</ul>
</div>
</li>
<li>
<p>optional: use the <a href="rg.html#_rg_annotations_manpage-CollectionLayout_sortedBy"><code>@CollectionLayout(sortedBy=&#8230;&#8203;)</code></a> annotation to specify a different comparator than the natural ordering</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_actions_and_collections">4.2.20. Actions and Collections</h4>
<div class="paragraph">
<p>The Wicket UI doesn&#8217;t allow collections to be modified (added to/removed from). However, we can easily write actions to accomplish the same. Moreover, these actions can provide some additional business logic. For example: it probably shouldn&#8217;t be possible to add an object twice into a collection, so it should not be presented in the list of choices/autoComplete; conversely, only those objects in the collection should be offered as choices to be removed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add domain actions to add/remove from the collection</p>
</li>
<li>
<p>to create objects, <a href="#_ug_how-tos_class-structure_inject-services">inject</a> associated domain service</p>
<div class="ulist">
<ul>
<li>
<p>generally we recommend using the <a href="rg.html#_rg_annotations_manpage-Inject"><code>@Inject</code></a> annotation with either private or default visibility</p>
</li>
</ul>
</div>
</li>
<li>
<p>the service itself should use <a href="rg.html#_rg_services-api_manpage-DomainObjectContainer"><code>DomainObjectContainer</code></a></p>
</li>
<li>
<p>use the <a href="rg.html#_rg_annotations_manpage-MemberOrder"><code>@MemberOrder(name=&#8230;&#8203;)</code></a> annotation to associate an action with a property or with a collection</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_css_ui_hints">4.2.21. CSS UI Hints</h4>
<div class="paragraph">
<p>CSS classes can be associated with any class member (property, collection, action). But for actions in particular:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the bootstrap "btn" CSS classes can be used using the <a href="rg.html#_rg_annotations_manpage-ActionLayout_cssClass"><code>@ActionLayout(cssClass=&#8230;&#8203;)</code></a> annotation</p>
</li>
<li>
<p>the <a href="http://fortawesome.github.io/Font-Awesome/icons/">Font Awesome</a> icons can be used using the <a href="rg.html#_rg_annotations_manpage-ActionLayout_cssClassFa"><code>@ActionLayout(cssClassFa=&#8230;&#8203;)</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s also possible to use Font Awesome icons for the <a href="#_ug_how-tos_ui-hints_object-titles-and-icons">domain object icon</a>.</p>
</div>
<div class="paragraph">
<p>So:
- for some of the actions of your domain services or entities, annotate using <code>@ActionLayout(cssClass=&#8230;&#8203;)</code> or <code>@ActionLayout(cssClassFa=&#8230;&#8203;)</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_dynamic_layout">4.2.22. Dynamic Layout</h4>
<div class="paragraph">
<p>Up to this point we&#8217;ve been using annotations (<code>@MemberOrder</code>, <code>@MemberGroupLayout</code>, <code>@Named</code>, <code>@PropertyLayout</code>, <code>@ParameterLayout</code>, <code>@ActionLayout</code> and so on) for UI hints. However, the feedback loop is not good: it requires us stopping the app, editing the code, recompiling and running again. So instead, all these UI hints (and more) can be specified dynamically, using a corresponding <code>.layout.json</code> file. If edited while the app is running, it will be reloaded automatically (in IntelliJ, use Run&gt;Reload Changed Classes):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Delete the various hint annotations and instead specify layout hints using a <a href="rg.html#_rg_object-layout_dynamic">.layout.json</a> file.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_business_rules">4.2.23. Business rules</h4>
<div class="paragraph">
<p>Apache Isis excels for domains where there are complex business rules to enforce. The UI tries not to constrain the user from navigating around freely, however the domain objects nevertheless ensure that they cannot change into an invalid state. Such rules can be enforced either declaratively (using annotations) or imperatively (using code). The objects can do this in one of three ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>visibility: preventing the user from even seeing a property/collection/action</p>
</li>
<li>
<p>usability: allowing the user to view a property/collection/action but not allowing the user to change it</p>
</li>
<li>
<p>validity: allowing the user to modify the property/invoke the action, but validating that the new value/action arguments are correct before hand.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Or, more pithily: "see it, use it, do it"</p>
</div>
<div class="sect4">
<h5 id="_see_it">See it!</h5>
<div class="ulist">
<ul>
<li>
<p>Use the <a href="rg.html#_rg_annotations_manpage-Property_hidden"><code>Property(hidden=&#8230;&#8203;)</code></a> annotation to make properties invisible</p>
<div class="ulist">
<ul>
<li>
<p>likewise <a href="rg.html#_rg_annotations_manpage-Collection_hidden"><code>@Collection(hidden=&#8230;&#8203;)</code></a> for collections</p>
</li>
<li>
<p>the <a href="rg.html#_rg_annotations_manpage-Programmatic"><code>@Programmatic</code></a>  annotation can also be used and in many cases is to be preferred; the difference is that the latter means the member is not part of the Apache Isis metamodel.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Use the <a href="rg.html#_rg_methods_prefixes_manpage-hide"><code>hide&#8230;&#8203;()</code></a> supporting method on properties, collections and actions to make a property/collection/action invisible according to some imperative rule</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_use_it">Use it!</h5>
<div class="ulist">
<ul>
<li>
<p>Use the <a href="rg.html#_rg_annotations_manpage-Property_editing"><code>Property(editing=&#8230;&#8203;)</code></a> annotation to make property read-only</p>
<div class="ulist">
<ul>
<li>
<p>likewise <a href="rg.html#_rg_annotations_manpage-Collection_editing"><code>@Collection(editing=&#8230;&#8203;)</code></a> for collections</p>
</li>
<li>
<p>alternatively, use <a href="rg.html#_rg_annotations_manpage-DomainObject_editing"><code>@DomainObject(editing=&#8230;&#8203;)</code></a> to disable editing for all properties/collections</p>
</li>
</ul>
</div>
</li>
<li>
<p>Use the <a href="rg.html#_rg_methods_prefixes_manpage-disable"><code>disable&#8230;&#8203;()</code></a> supporting method on properties and actions to make a property/action disabled according to some imperative rule</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_do_it">Do it!</h5>
<div class="ulist">
<ul>
<li>
<p>use the <a href="rg.html#_rg_annotations_manpage-Property_regexPattern"><code>@Property(regexPattern=&#8230;&#8203;)</code></a> annotation to specify a regex pattern for properties, and use <a href="rg.html#_rg_annotations_manpage-Parameter_regexPattern"><code>@Parameter(regexPattern=&#8230;&#8203;)</code></a> for parameters</p>
</li>
<li>
<p>use the <a href="rg.html#_rg_annotations_manpage-Property_maxLength"><code>@Property(maxLength=&#8230;&#8203;)</code></a> annotation to indicate a maxmum number of characters, and <a href="rg.html#_rg_annotations_manpage-Parameter_maxLength"><code>@Parameter(maxLength=&#8230;&#8203;)</code></a> for parameters</p>
</li>
<li>
<p>Use the <a href="rg.html#_rg_methods_prefixes_manpage-validate"><code>validate&#8230;&#8203;()</code></a> supporting method on properties or action parameter</p>
</li>
<li>
<p>optional: for any data type:</p>
<div class="ulist">
<ul>
<li>
<p>use the <a href="rg.html#_rg_annotations_manpage-Property_mustSatisfy"><code>Property(mustSatisfy=&#8230;&#8203;)</code></a> and <a href="rg.html#_rg_annotations_manpage-Parameter_mustSatisfy"><code>Parameter(mustSatisfy=&#8230;&#8203;)</code></a> annotations to specify arbitrary constraints on properties and parameters</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_home_page">4.2.24. Home page</h4>
<div class="paragraph">
<p>The Wicket UI will automatically invoke the "home page" action, if available. This is a no-arg action of one of the domain services, that can return either an object (eg representing the current user) or a standalone action.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the <a href="rg.html#_rg_annotations_manpage-HomePage"><code>@HomePage</code></a> annotation to one (no more) of the domain services' no-arg actions</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_clock_service">4.2.25. Clock Service</h4>
<div class="paragraph">
<p>To ensure testability, there should be no dependencies on system time, for example usage of <code>LocalDate.now()</code>. Instead the domain objects should delegate to the provided <code>ClockService</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>remove any dependencies on system time (eg defaults for date/time action parameters)</p>
</li>
<li>
<p>inject <a href="rg.html#_rg_services-api_manpage-ClockService"><code>ClockService</code></a></p>
</li>
<li>
<p>call <code>ClockService.now()</code> etc where required.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_using_contributions">4.2.26. Using Contributions</h4>
<div class="paragraph">
<p>One of Apache Isis' most powerful features is the ability for the UI to combine functionality from domain services into the representation of an entity. The effect is similar to traits or mix-ins in other languages, however the "mixing in" is done at runtime, within the Apache Isis metamodel. In Apache Isis' terminology, we say that the domain service action is contributed to the entity.</p>
</div>
<div class="paragraph">
<p>Any action of a domain service that has a domain entity type as one of its parameter types will (by default) be contributed. If the service action takes more than one argument, or does not have safe semantics, then it will be contributed as an entity action. If the service action has precisely one parameter type (that of the entity) and has safe semantics then it will be contributed either as a collection or as a property (dependent on whether it returns a collection of a scalar).</p>
</div>
<div class="paragraph">
<p>Why are contributions so useful? Because the service action will match not on the entity type, but also on any of the entity&#8217;s supertypes (all the way up to <code>java.lang.Object</code>). That means that you can apply the <a href="http://en.wikipedia.org/wiki/Dependency_inversion_principle">dependency inversion principle</a> to ensure that the modules of your application have acyclic dependencies; but in the UI it can still appear as if there are bidirectional dependencies between those modules. The lack of bidirectional dependencies can help save your app degrading into a <a href="http://en.wikipedia.org/wiki/Big_ball_of_mud">big ball of mud</a>.</p>
</div>
<div class="paragraph">
<p>Finally, note that the layout of contributed actions/collections/properties can be specified using the <code>.layout.json</code> file (and it is highly recommended that you do so).</p>
</div>
<div class="sect4">
<h5 id="_contributed_actions">Contributed Actions</h5>
<div class="ulist">
<ul>
<li>
<p>Write a new domain service</p>
<div class="ulist">
<ul>
<li>
<p>by convention, called "XxxContributions"</p>
</li>
<li>
<p>annotate with <a href="rg.html#_rg_annotations_manpage-DomainService_nature"><code>@DomainService(nature=NatureOfService.VIEW_CONTRIBUTIONS_ONLY)</code></a></p>
<div class="ulist">
<ul>
<li>
<p>indicates that all of the service&#8217;s actions should <em>not</em> be included in the main application menu bar</p>
</li>
<li>
<p>should be rendered "as if" an action of the entity</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Write an action accepting &gt;1 args:</p>
<div class="ulist">
<ul>
<li>
<p>one being a domain entity</p>
</li>
<li>
<p>other being a primitive or String</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_contributed_collections">Contributed Collections</h5>
<div class="ulist">
<ul>
<li>
<p>Write a new domain service (or update the one previously)</p>
</li>
<li>
<p>Write a query-only action accepting exactly 1 arg (a domain entity)</p>
</li>
<li>
<p>returning a collection, list or set</p>
</li>
<li>
<p>For this action:</p>
<div class="ulist">
<ul>
<li>
<p>add the <a href="rg.html#_rg_annotations_manpage-ActionLayout_contributedAs"><code>@ActionLayout(contributedAs=ASSOCIATION)</code></a> annotation</p>
</li>
<li>
<p>should be rendered in the UI "as if" a collection of the entity</p>
</li>
</ul>
</div>
</li>
<li>
<p>use <code>.layout.json</code> to position as required</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_contributed_properties">Contributed Properties</h5>
<div class="ulist">
<ul>
<li>
<p>As for contributed collections, write a new domain service with a query-only action accepting exactly 1 arg (a domain entity); except:</p>
<div class="ulist">
<ul>
<li>
<p>returning a scalar value rather than a collection</p>
</li>
</ul>
</div>
</li>
<li>
<p>For this action:</p>
<div class="ulist">
<ul>
<li>
<p>add the <a href="rg.html#_rg_annotations_manpage-ActionLayout_contributedAs"><code>@ActionLayout(contributedAs=ASSOCIATION)</code></a> annotation</p>
</li>
</ul>
</div>
</li>
<li>
<p>should be rendered in the UI "as if" a property of the entity</p>
</li>
<li>
<p>use <code>.layout.json</code> to position as required</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_event_bus">4.2.27. Using the Event Bus</h4>
<div class="paragraph">
<p>Another way in which Apache Isis helps you keep your application nicely modularized is through its event bus. Each action invocation, or property modification, can be used to generate a succession of events that allows subscribers to veto the interaction (the see it/use it/do it rules) or, if the action is allowed, to perform work prior to the execution of the action or after the execution of the action.</p>
</div>
<div class="paragraph">
<p>Under the covers Apache Isis uses the <a href="https://code.google.com/p/guava-libraries/wiki/EventBusExplained">Guava event bus</a> and subscribers (always domain services) subscribe by writing methods annotated with <code>@com.google.common.eventbus.Subscribe</code> annotation.</p>
</div>
<div class="paragraph">
<p>By default the events generated are <code>ActionDomainEvent.Default</code> (for actions) and <code>PropertyDomainEvent.Default</code> (for properties). Subclasses of these can be specified using the <a href="rg.html#_rg_annotations_manpage-Action_domainEvent"><code>@Action(domainEvent=&#8230;&#8203;)</code></a> or <a href="rg.html#_rg_annotations_manpage-Property_domainEvent"><code>Property(domainEvent=&#8230;&#8203;)</code></a> for properties.</p>
</div>
<div class="paragraph">
<p>Using the guidance in the docs for the <a href="rg.html#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>write a domain service subscriber to subscribe to events</p>
</li>
<li>
<p>use the domain service to perform log events</p>
</li>
<li>
<p>use the domain service to veto actions (hide/disable or validate)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_bulk_actions">4.2.28. Bulk actions</h4>
<div class="paragraph">
<p>Bulk actions are actions that can be invoked on a collection of actions, that is on collections returned by invoking an action. Actions are specified as being bulk actions using the <a href="rg.html#_rg_annotations_manpage-Action_invokeOn"><code>@action(invokeOn=OBJECT_AND_COLLECTION)</code></a> annotation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that currently (1.8.0) only no-arg actions can be specified as bulk actions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Thus:
* Write a no-arg action for your domain entity, annotate with <code>@Action(invokeOn=&#8230;&#8203;)</code>
* Inject the <a href="rg.html#_rg_services-api_manpage-ActionInvocationContext"><code>ActionInteractionContext</code></a> (request-scoped) service
* Use the <code>ActionInteractionContext</code> service to determine whether the action was invoked in bulk or as a regular action.
* return null if invoked on a collection; the Wicket viewer will go back to the original collection
** (if return non-null, then Wicket viewer will navigate to the object of the last invocationï¿½ generally not what is required)</p>
</div>
<div class="paragraph">
<p>The similar <a href="rg.html#_rg_services-api_manpage-Scratchpad"><code>Scratchpad</code></a> (request-scoped) domain service is a good way to share information between bulk action invocations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Inject the <code>Scratchpad</code> domain service</p>
</li>
<li>
<p>for each action, store state (eg a running total)</p>
</li>
<li>
<p>in the last invoked bulk action, perform some aggregate processing (eg calculate the average) and return</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_performance_tuning">4.2.29. Performance tuning</h4>
<div class="paragraph">
<p>The <a href="rg.html#_rg_services-api_manpage-QueryResultsCache"><code>QueryResultsCache</code></a> (request-scoped) domain service allows arbitrary objects to be cached for the duration of a request.</p>
</div>
<div class="paragraph">
<p>This can be helpful for "naive" code which would normally make the same query within a loop.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>optional: inject the <code>QueryResultsCache</code> service, invoke queries "through" the cache API</p>
</li>
<li>
<p>remember that the service is request-scoped, so it only really makes sense to use this service for code that invokes queries within a loop</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_extending_the_wicket_ui">4.2.30. Extending the Wicket UI</h4>
<div class="paragraph">
<p>Each element in the Wicket viewer (entity form, properties, collections, action button etc) is a component, each created by a internal API (<code>ComponentFactory</code>, described <a href="#_ug_extending_wicket-viewer">here</a>). For collections there can be multiple views, and the Wicket viewer provides a view selector drop down (top right of each collection panel).</p>
</div>
<div class="paragraph">
<p>Moreover, we can add additional views. In this section we&#8217;ll explore some of these, already provided through <a href="http://www.isisaddons.org/">Isis addons</a> (not ASF).</p>
</div>
<div class="sect4">
<h5 id="_excel_download">Excel download</h5>
<div class="paragraph">
<p>The <a href="https://github.com/isisaddons/isis-wicket-excel">Excel download add-on</a> allows the collection to be downloaded as an Excel spreadsheet (<code>.xlsx</code>).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the instructions on the add-on module&#8217;s README to add in the excel download module (ie: update the POM).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_fullcalendar2">Fullcalendar2</h5>
<div class="paragraph">
<p>The <a href="https://github.com/isisaddons/isis-wicket-fullcalendar2">Fullcalendar2 download add-on</a> allows entities to be rendered in a full-page calendar.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the instructions on the add-on module&#8217;s README to add in the fullcalendar2 module (ie: update the POM).</p>
</li>
<li>
<p>on one of your entities, implement either the <code>CalendarEventable</code> interface or the (more complex) <code>Calendarable</code> interface.</p>
</li>
<li>
<p>update fixture scripts to populate any new properties</p>
</li>
<li>
<p>when the app is run, a collection of the entities should be shown within a calendar view</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_gmap3">gmap3</h5>
<div class="paragraph">
<p>The <a href="https://github.com/isisaddons/isis-wicket-gmap3">Gmap3 download add-on</a> allows entities that implement certain APIs to be rendered in a full-page gmap3.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the instructions on the add-on module&#8217;s README to add in the gmap3 module (ie: update the POM).</p>
</li>
<li>
<p>on one of your entities, implement the <code>Locatable</code> interface</p>
</li>
<li>
<p>update fixture scripts to populate any new properties</p>
</li>
<li>
<p>when the app is run, a collection of the entities should be shown within a map view</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_add_on_modules_optional">4.2.31. Add-on modules (optional)</h4>
<div class="paragraph">
<p>In addition to providing Wicket viewer extensions, <a href="http://www.isisaddons.org/">Isis addons</a> also has a large number of modules. These address such cross-cutting concerns as security, command (profiling), auditing and publishing.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(optional): follow the <a href="https://github.com/isisaddons/isis-module-security">security module</a> README or <a href="http://youtu.be/bj8735nBRR4">screencast</a></p>
</li>
<li>
<p>(optional): follow the <a href="https://github.com/isisaddons/isis-module-command">command module</a> README or <a href="http://youtu.be/g01tK58MxJ8">screencast</a></p>
</li>
<li>
<p>(optional): follow the <a href="https://github.com/isisaddons/isis-module-audit">auditing module</a> README or (the same) <a href="http://youtu.be/g01tK58MxJ8">screencast</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_view_models">4.2.32. View models</h4>
<div class="paragraph">
<p>In most cases users can accomplish the business operations they need by invoking actions directly on domain entities. For some high-volume or specialized uses cases, though, there may be a requirement to bring together data or functionality that spans several entities.</p>
</div>
<div class="paragraph">
<p>Also, if using Apache Isis' REST API then the REST client may be a native application (on a smartphone or tablet, say) that is deployed by a third party. In these cases exposing the entities directly would be inadvisable because a refactoring of the domain entity would change the REST API and probably break that REST client.</p>
</div>
<div class="paragraph">
<p>To support these use cases, Apache Isis therefore allows you to write a view model, either by annotating the class with <a href="rg.html#_rg_annotations_manpage-ViewModel"><code>@ViewModel</code></a> or (for more control) by implementing the <a href="rg.html#_rg_classes_super_manpage-AbstractViewModel"><code>ViewModel</code></a> interface.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>build a view model summarizing the state of the app (a "dashboard")</p>
</li>
<li>
<p>write a new <code>@HomePage</code> domain service action returning this dashboard viewmodel (and remove the <code>@HomePage</code> annotation from any other domain service if present)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_testing_3">4.2.33. Testing</h4>
<div class="paragraph">
<p>Up to this point we&#8217;ve been introducing the features of Isis and building out our domain application, but with little regard to testing. Time to fix that.</p>
</div>
<div class="sect4">
<h5 id="_unit_testing">Unit testing</h5>
<div class="paragraph">
<p>Unit testing domain entities and domain services is easy; just use JUnit and mocking libraries to mock out interactions with domain services.</p>
</div>
<div class="paragraph">
<p><a href="https://code.google.com/p/mockito/">Mockito</a> seems to be the current favourite among Java developers for mocking libraries, but if you use JMock then you&#8217;ll find we provide a <code>JUnitRuleMockery2</code> class and a number of other utility classes, documented <a href="#_ug_testing_unit-test-support">here</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>write some unit tests (adapt from the unit tests in the <code>myapp-dom</code> Maven module).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_integration_testing">Integration testing</h5>
<div class="paragraph">
<p>Although unit tests are easy to write and fast to execute, integration tests are more valuable: they test interactions of the system from the outside-in, simulating the way in which the end-users use the application.</p>
</div>
<div class="paragraph">
<p>Earlier on in the tutorial we commented out the <code>myapp-integtests</code> module. Let&#8217;s commented it back in. In the parent <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;modules&gt;</span>
    <span class="tag">&lt;module&gt;</span>dom<span class="tag">&lt;/module&gt;</span>
    <span class="tag">&lt;module&gt;</span>fixture<span class="tag">&lt;/module&gt;</span>
    <span class="comment">&lt;!--
    &lt;module&gt;integtests&lt;/module&gt;
    --&gt;</span>
    <span class="tag">&lt;module&gt;</span>webapp<span class="tag">&lt;/module&gt;</span>
<span class="tag">&lt;/modules&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>change back to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;modules&gt;</span>
    <span class="tag">&lt;module&gt;</span>dom<span class="tag">&lt;/module&gt;</span>
    <span class="tag">&lt;module&gt;</span>fixture<span class="tag">&lt;/module&gt;</span>
    <span class="tag">&lt;module&gt;</span>integtests<span class="tag">&lt;/module&gt;</span>
    <span class="tag">&lt;module&gt;</span>webapp<span class="tag">&lt;/module&gt;</span>
<span class="tag">&lt;/modules&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There will probably be some compile issues to fix up once you&#8217;ve done this; comment out all code that doesn&#8217;t compile.</p>
</div>
<div class="paragraph">
<p>Isis has great support for writing <a href="#_ug_testing_integ-test-support">integration tests</a>; well-written integration tests should leverage fixture scripts and use the <a href="rg.html#_rg_services-api_manpage-WrapperFactory"><code>@WrapperFactory</code></a> domain service.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>use the tests from the original archetype and the documentation on the website to develop integration tests for your app&#8217;s functionality.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customising_the_rest_api">4.2.34. Customising the REST API</h4>
<div class="paragraph">
<p>The REST API generated by Apache Isis conforms to the Restful Objects specification. Apache Isis 1.8.0 provides experimental support to allow the representations to be customized.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>as per <a href="#_ug_restfulobjects-viewer_configuration-properties_simplified-object-representation">the documentation</a>, configure the Restful Objects viewer to generate a simplified object representation:<br></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.viewer.restfulobjects.objectPropertyValuesOnly=true</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_to_use_an_external_database">4.2.35. Configuring to use an external database</h4>
<div class="paragraph">
<p>If you have an external database available, then update the <code>pom.xml</code> for the classpath and update the JDBC properties in <code>WEB-INF\persistor.properties</code> to point to your database.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ug_how-tos">5. How tos</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides instructions on how to go about actually developing Apache Isis domain applications.</p>
</div>
<div class="sect2">
<h3 id="_ug_how-tos_class-structure">5.1. Class Structure</h3>
<div class="paragraph">
<p>Apache Isis works by building a metamodel of the domain objects: entities, view models and services.  The class members of both entities and view models represent both state&#8201;&#8212;&#8201;(single-valued) properties and (multi-valued) collections&#8201;&#8212;&#8201;and behaviour&#8201;&#8212;&#8201;actions.  The class members of domain services is simpler: just behaviour, ie actions.</p>
</div>
<div class="paragraph">
<p>In the automatically generated UI a property is rendered as a field.  This can be either of a value type (a string, number, date, boolean etc) or can be a reference to another entity.  A collection is generally rendered as a table.</p>
</div>
<div class="paragraph">
<p>In order for Apache Isis to build its metamodel the domain objects must follow some conventions: what we call the <em>Apache Isis Programming Model</em>.  This is just an extension of the pojo / JavaBean standard of yesteryear: properties and collections are getters/setters, while actions are simply any remaining <code>public</code> methods.</p>
</div>
<div class="paragraph">
<p>Additional metamodel semantics are inferred both imperatively from <em>supporting methods</em> and declaratively from annotations.</p>
</div>
<div class="paragraph">
<p>In this section we discuss the mechanics of writing domain objects that comply with Apache Isis' programming model.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In fact, the Apache Isis programming model is extensible; you can teach Apache Isis new programming conventions and you can remove existing ones; ultimately they amount to syntax.   The only real fundamental that can&#8217;t be changed is the notion that objects consist of properties, collections and actions.</p>
</div>
<div class="paragraph">
<p>You can learn more about extending Apache Isis programming model <a href="#_ug_extending_programming-model">here</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_class-structure_class-definition">5.1.1. Class Definition</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Classes are defined both to Isis and (if an entity) also to JDO/DataNucleus.</p>
</div>
<div class="paragraph">
<p>We use Java packages as a way to group related domain objects together; the package name forms a namespace. We can then reason about all the classes in that package/namespace as a single unit.</p>
</div>
<div class="paragraph">
<p>In the same way that Java packages act as a namespace for domain objects, it&#8217;s good practice to map domain entities to their own (database) schemas.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more on this topic, see the topic discussing modules and <a href="#_ug_more-advanced_decoupling">decoupling</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_class-structure_properties">5.1.2. Property</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_value_vs_reference_types">Value vs Reference Types</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The annotations for mapping value types tend to be different for properties vs action parameters, because JDO annotations are only valid on properties.  The table in the <a href="#_ug_how-tos_class-structure_properties-vs-parameters">Properties vs Parameters</a> section provides a handy reference of each.</p>
</div>
</div>
<div class="sect4">
<h5 id="_optional_properties">Optional Properties</h5>
<div class="paragraph">
<p>JDO/DataNucleus' default is that a property is assumed to be mandatory if it is a primitive type (eg <code>int</code>, <code>boolean</code>), but optional if a reference type (eg <code>String</code>, <code>BigDecimal</code> etc).  To override optionality in JDO/DataNucleus the <code>@Column(allowsNull="&#8230;&#8203;")</code> annotations is used.</p>
</div>
<div class="paragraph">
<p>Apache Isis on the other hand assumes that all properties (and action parameters, for that matter) are mandatory, not optional.  These defaults can also be overridden using Apache Isis' own annotations, specifically <code>@Property(optionality=&#8230;&#8203;)</code>.</p>
</div>
<div class="paragraph">
<p>These different defaults can lead to incompatibilities between the two frameworks.  To counteract that, Apache Isis also recognizes and honours JDO&#8217;s <code>@Column(allowsNull=&#8230;&#8203;)</code>.</p>
</div>
<div class="paragraph">
<p>For example, rather than:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Column(allowNulls=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> LocalDate date;
<span class="annotation">@Property</span>(optionality=Optionality.OPTIONAL)
<span class="directive">public</span> LocalDate getDate() { ... }
<span class="directive">public</span> <span class="type">void</span> setDate(LocalDate d) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>you should instead simply write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> LocalDate date;
<span class="annotation">@javax</span>.jdo.annotations.Column(allowNulls=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> LocalDate getDate() { ... }
<span class="directive">public</span> <span class="type">void</span> setDate(LocalDate d) { ... }</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>With JDO/DataNucleus it&#8217;s valid for the <code>@Column</code> annotation to be placed on either the field or the getter.  Apache Isis (currently) only looks for annotations on the getter.  We therefore recommend that you always place <code>@Column</code> on the gettter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In all cases the framework will search for any incompatibilities in optionality (whether specified explicitly or defaulted implicitly) between Isis' defaults and DataNucleus, and refuse to boot if any are found (fail fast).</p>
</div>
<div class="sect5">
<h6 id="_handling_mandatory_properties_in_subtypes">Handling Mandatory Properties in Subtypes</h6>
<div class="paragraph">
<p>If you have a hierarchy of classes then you need to decide which inheritance strategy to use.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"table per hierarchy", or "rollup" (<code>InheritanceStrategy.SUPERCLASS_TABLE</code>)<br></p>
<div class="paragraph">
<p>whereby a single table corresponds to the superclass, and also holds the properties of the subtype (or subtypes) being rolled up</p>
</div>
</li>
<li>
<p>"table per class" (<code>InheritanceStrategy.NEW_TABLE</code>)<br></p>
<div class="paragraph">
<p>whereby is a table for both superclass and subclass, in 1:1 correspondence</p>
</div>
</li>
<li>
<p>"rolldown" (<code>InheritanceStrategy.SUBCLASS_TABLE</code>)<br></p>
<div class="paragraph">
<p>whereby a single table holds the properties of the subtype, and also holds the properties of its supertype</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the first "rollup" case, we can have a situation where - logically speaking - the property is mandatory in the subtype - but it must be mapped as nullable in the database because it is n/a for any other subtypes that are rolled up.</p>
</div>
<div class="paragraph">
<p>In this situation we must tell JDO that the column is optional, but to Apache Isis we want to enforce it being mandatory. This can be done using the <code>@Property(optionality=Optionality.MANDATORY)</code> annotation.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Inheritance(strategy = InheritanceStrategy.SUPER_TABLE)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeSubtype</span> <span class="directive">extends</span> SomeSuperType {
    <span class="directive">private</span> LocalDate date;
    <span class="annotation">@javax</span>.jdo.annotations.Column(allowNulls=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Property</span>(optionality=Optionality.MANDATORY)
    <span class="directive">public</span> LocalDate getDate() { ... }
    <span class="directive">public</span> <span class="type">void</span> setDate(LocalDate d) { ... }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>@Property(optionality=&#8230;&#8203;)</code> annotation is equivalent to the older but still supported <code>@Optional</code> annotation and <code>@Mandatory</code> annotations. Its benefit is that it lumps together all Apache Isis' property metadata in a single annotation.  Its downside is that it is rather verbose if the only semantic that needs to be specified&#8201;&#8212;&#8201;as is often the case&#8201;&#8212;&#8201;is optionality.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An alternative way to achieve this is to leave the JDO annotation on the field (where it is invisible to Apache Isis), and rely on Isis' default, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Inheritance(strategy = InheritanceStrategy.SUPER_TABLE)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeSubtype</span> <span class="directive">extends</span> SomeSuperType {
    <span class="annotation">@javax</span>.jdo.annotations.Column(allowNulls=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> LocalDate date;
    <span class="comment">// mandatory in Apache Isis by default</span>
    <span class="directive">public</span> LocalDate getDate() { }
    <span class="directive">public</span> <span class="type">void</span> setDate(LocalDate d) { }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We recommend the former mapping, though, using <code>@Property(optionality=Optionality.MANDATORY)</code>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="__code_string_code_s_length"><code>String</code>s (Length)</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_ug_how-tos_class-structure_properties_mapping-joda-dates">Mapping JODA Dates</h5>
<div class="paragraph">
<p>Isis' JDO objectstore bundles DataNucleus' <a href="http://www.datanucleus.org/documentation/products/plugins.html">built-in support</a> for Joda <code>LocalDate</code> and <code>LocalDateTime</code> datatypes, meaning that entity properties of these types will be persisted as appropriate data types in the database tables.</p>
</div>
<div class="paragraph">
<p>It is, however, necessary to annotate your properties with <code>@javax.jdo.annotations.Persistent</code>, otherwise the data won&#8217;t actually be persisted. See the <a href="http://db.apache.org/jdo/field_types.html">JDO docs</a> for more details on this.</p>
</div>
<div class="paragraph">
<p>Moreover, these datatypes are <em>not</em> in the default fetch group, meaning that JDO/DataNucleus will perform an additional <code>SELECT</code> query for each attribute. To avoid this extra query, the annotation should indicate that the property is in the default fetch group.</p>
</div>
<div class="paragraph">
<p>For example, the <code>ToDoItem</code> (in the <a href="https://github.com/isisaddons/isis-app-todoapp">todoapp example app</a> (not ASF)) defines the <code>dueBy</code> property as follows:</p>
</div>
</div>
<div class="sect4">
<h5 id="__code_bigdecimal_code_s_precision"><code>BigDecimal</code>s (Precision)</h5>
<div class="paragraph">
<p>Working with <code>java.math.BigDecimal</code> properties takes a little care due to scale/precision issues.</p>
</div>
<div class="paragraph">
<p>For example, suppose we have:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="predefined-type">BigDecimal</span> impact;
<span class="directive">public</span> <span class="predefined-type">BigDecimal</span> getImpact() {
    <span class="keyword">return</span> impact;
}
<span class="directive">public</span> <span class="type">void</span> setImpact(<span class="directive">final</span> <span class="predefined-type">BigDecimal</span> impact) {
    <span class="local-variable">this</span>.impact = impact;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>JDO/DataNucleus creates, at least with HSQL, the table with the field type as NUMERIC(19). No decimal digits are admitted. (Further details <a href="http://hsqldb.org/doc/2.0/guide/sqlgeneral-chapt.html#sgc_numeric_types">here</a>).</p>
</div>
<div class="paragraph">
<p>What this implies is that, when a record is inserted, a log entry similar to this one appears:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">INSERT INTO ENTITY(..., IMPACT, ....) VALUES (...., <span class="float">0.5</span>, ....)</code></pre>
</div>
</div>
<div class="paragraph">
<p>But when that same record is retrieved, the log will show that a value of "0" is returned, instead of 0.5.</p>
</div>
<div class="paragraph">
<p>The solution is to explicitly add the scale to the field like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Column(scale=<span class="integer">2</span>)
<span class="directive">private</span> <span class="predefined-type">BigDecimal</span> impact;
<span class="directive">public</span> <span class="predefined-type">BigDecimal</span> getImpact() {
    <span class="keyword">return</span> impact;
}
<span class="directive">public</span> <span class="type">void</span> setImpact(<span class="directive">final</span> <span class="predefined-type">BigDecimal</span> impact) {
    <span class="local-variable">this</span>.impact = impact;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, you should also set the scale of the <code>BigDecimal</code>, using <code>setScale(scale, roundingMode)</code>.</p>
</div>
<div class="paragraph">
<p>More information can be found <a href="http://www.opentaps.org/docs/index.php/How_to_Use_Java_BigDecimal:_A_Tutorial">here</a> and <a href="http://www.tutorialspoint.com/java/math/bigdecimal_setscale_rm_roundingmode.htm">here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_mapping_blobs_and_clobs">Mapping Blobs and Clobs</h5>
<div class="paragraph">
<p>Apache Isis configures JDO/DataNucleus so that the properties of type <code>org.apache.isis.applib.value.Blob</code> and <code>org.apache.isis.applib.value.Clob</code> can also be persisted.</p>
</div>
<div class="paragraph">
<p>As for <a href="#_ug_how-tos_class-structure_properties_mapping-joda-dates">Joda dates</a>, this requires the <code>@javax.jdo.annotations.Persistent</code> annotation. However, whereas for dates one would always expect this value to be retrieved eagerly, for blobs and clobs it is not so clear cut.</p>
</div>
<div class="sect5">
<h6 id="_mapping_blobs">Mapping Blobs</h6>
<div class="paragraph">
<p>For example, in the <code>ToDoItem</code> class (of the <a href="https://github.com/isisaddons/isis-app-todoapp/blob/61b8114a8e01dbb3c380b31cf09eaed456407570/dom/src/main/java/todoapp/dom/module/todoitem/ToDoItem.java#L475">todoapp example app</a> (non-ASF) the <code>attachment</code> property is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Persistent(defaultFetchGroup=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>, columns = {
    <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_name</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_mimetype</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_bytes</span><span class="delimiter">&quot;</span></span>, jdbcType=<span class="string"><span class="delimiter">&quot;</span><span class="content">BLOB</span><span class="delimiter">&quot;</span></span>, sqlType = <span class="string"><span class="delimiter">&quot;</span><span class="content">BLOB</span><span class="delimiter">&quot;</span></span>)
})
<span class="directive">private</span> <span class="predefined-type">Blob</span> attachment;
<span class="annotation">@Property</span>(
        optionality = Optionality.OPTIONAL
)
<span class="directive">public</span> <span class="predefined-type">Blob</span> getAttachment() {
    <span class="keyword">return</span> attachment;
}
<span class="directive">public</span> <span class="type">void</span> setAttachment(<span class="directive">final</span> <span class="predefined-type">Blob</span> attachment) {
    <span class="local-variable">this</span>.attachment = attachment;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The three <code>@javax.jdo.annotations.Column</code> annotations are required because the mapping classes that Apache Isis provides (<a href="https://github.com/apache/isis/blob/isis-1.4.0/component/objectstore/jdo/jdo-datanucleus/src/main/java/org/apache/isis/objectstore/jdo/datanucleus/valuetypes/IsisBlobMapping.java#L59">IsisBlobMapping</a> and <a href="https://github.com/apache/isis/blob/isis-1.4.0/component/objectstore/jdo/jdo-datanucleus/src/main/java/org/apache/isis/objectstore/jdo/datanucleus/valuetypes/IsisClobMapping.java#L59">IsisClobMapping</a>) map to 3 columns. (It is not an error to omit these <code>@Column</code> annotations, but without them the names of the table columns are simply suffixed <code>_0</code>, <code>_1</code>, <code>_2</code> etc.</p>
</div>
<div class="paragraph">
<p>If the <code>Blob</code> is mandatory, then use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Persistent(defaultFetchGroup=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>, columns = {
    <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_name</span><span class="delimiter">&quot;</span></span>, allowsNull=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_mimetype</span><span class="delimiter">&quot;</span></span>, allowsNull=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_bytes</span><span class="delimiter">&quot;</span></span>, jdbcType=<span class="string"><span class="delimiter">&quot;</span><span class="content">BLOB</span><span class="delimiter">&quot;</span></span>, sqlType = <span class="string"><span class="delimiter">&quot;</span><span class="content">BLOB</span><span class="delimiter">&quot;</span></span>,
                                  allowsNull=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>)
})
<span class="directive">private</span> <span class="predefined-type">Blob</span> attachment;
<span class="annotation">@Property</span>(
    optionality = Optionality.MANDATORY
)
<span class="directive">public</span> <span class="predefined-type">Blob</span> getAttachment() {
<span class="keyword">return</span> attachment;
}
<span class="directive">public</span> <span class="type">void</span> setAttachment(<span class="directive">final</span> <span class="predefined-type">Blob</span> attachment) {
<span class="local-variable">this</span>.attachment = attachment;
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_mapping_clobs">Mapping Clobs</h6>
<div class="paragraph">
<p>Mapping <code>Clob`s works in a very similar way, but the `@Column#sqlType</code> attribute will be <code>CLOB</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Persistent(defaultFetchGroup=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>, columns = {
    <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_name</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_mimetype</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_chars</span><span class="delimiter">&quot;</span></span>, sqlType = <span class="string"><span class="delimiter">&quot;</span><span class="content">CLOB</span><span class="delimiter">&quot;</span></span>)
})
<span class="directive">private</span> <span class="predefined-type">Clob</span> doc;
<span class="annotation">@Property</span>(
    optionality = Optionality.OPTIONAL
)
<span class="directive">public</span> <span class="predefined-type">Clob</span> getDoc() {
    <span class="keyword">return</span> doc;
}
<span class="directive">public</span> <span class="type">void</span> setDoc(<span class="directive">final</span> <span class="predefined-type">Clob</span> doc) {
    <span class="local-variable">this</span>.doc = doc;
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_mapping_to_varbinary_or_varchar">Mapping to VARBINARY or VARCHAR</h6>
<div class="paragraph">
<p>Instead of mapping to a <code>Blob</code> or <code>Clob</code> datatype, you might also specify map to a <code>VARBINARY</code> or <code>VARCHAR</code>. In this case you will need to specify a length. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_bytes</span><span class="delimiter">&quot;</span></span>, sqlType = <span class="string"><span class="delimiter">&quot;</span><span class="content">VARBINARY</span><span class="delimiter">&quot;</span></span>, length=<span class="integer">2048</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_chars</span><span class="delimiter">&quot;</span></span>, sqlType = <span class="string"><span class="delimiter">&quot;</span><span class="content">VARCHAR</span><span class="delimiter">&quot;</span></span>, length=<span class="integer">2048</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Support and maximum allowed length will vary by database vendor.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_class-structure_collections">5.1.3. Collections</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While Apache Isis support collections of references, the framework (currently) does not support collections of values. That is, it isn&#8217;t possible to define a collection of type <code>Set&lt;String&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Or, actually, you can, because that is a valid mapping supported by JDO/DataNucleus .  However, Apache Isis has no default visualization.</p>
</div>
<div class="paragraph">
<p>One workaround is to mark the collection as <a href="rg.html#_rg_annotations_manpage-Programmatic"><code>@Programmatic</code></a>.  This ensures that the collection is ignored by Apache Isis.</p>
</div>
<div class="paragraph">
<p>Another workaround is to wrap each value in a view model, as explained in this <a href="#_ug_more-advanced_tips-n-tricks_simulating-collections-of-values">tip</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_class-structure_actions">5.1.4. Actions</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While Apache Isis support actions whose parameters' types are scalar (values such as <code>String</code>, <code>int</code>, or references such as <code>Customer</code>), the framework (currently) does not support parameter types that are collections or maps.</p>
</div>
<div class="paragraph">
<p>The workaround is to mark the collection as <code>@Programmatic</code>, as described in <a href="#_ug_how-tos_class-structure_ignoring-methods">Ignoring Methods</a>.  This ensures that the collection is ignored by Apache Isis.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_class-structure_action-parameters">5.1.5. Action Parameters</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="__code_string_code_s_length_2"><code>String</code>s (Length)</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="__code_bigdecimal_code_s_precision_2"><code>BigDecimal</code>s (Precision)</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_optional">Optional</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_class-structure_inject-services">5.1.6. Injecting services</h4>
<div class="paragraph">
<p>Apache Isis autowires (automatically injects) domain services into each entity, as well as into the domain services themselves, using either method injection or field injection. The applib <code>DomainObjectContainer</code> is also a service, so can be injected in exactly the same manner.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Isis currently does <em>not</em> support qualified injection of services; the domain service of each type must be distinct from any other.</p>
</div>
<div class="paragraph">
<p>If you find a requirement to inject two instances of type <code>SomeService</code>, say, then the work-around is to create trivial subclasses <code>SomeServiceA</code> and <code>SomeServiceB</code> and inject these instead.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_field_injection">Field Injection</h5>
<div class="paragraph">
<p>Field injection is recommended, using the <code>@javax.inject.Inject</code> annotation. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@javax</span>.inject.Inject
    OrderRepository orderRepository;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We recommend using default rather than <code>private</code> visibility so that the field can be mocked out within unit tests (placed in the same package as the code under test).</p>
</div>
</div>
<div class="sect4">
<h5 id="_method_injection">Method Injection</h5>
<div class="paragraph">
<p>Isis also supports two forms of method injection.  All that is required to inject a service into a entity/service is to provide an appropriate method or field. The name
of the method does not matter, only that it is prefixed either <code>set</code> or <code>inject</code>, is
public, and has a single parameter of the correct type.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">private</span> OrderRepository orderRepository;
    <span class="directive">public</span> <span class="type">void</span> setOrderRepository(OrderRepository orderRepository) {
        <span class="local-variable">this</span>.orderRepository = orderRepository;
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or alternatively, using 'inject' as the prefix:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">private</span> OrderRepository orderRepository;
    <span class="directive">public</span> <span class="type">void</span> injectOrderRepository(OrderRepository orderRepository) {
        <span class="local-variable">this</span>.orderRepository = orderRepository;
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the method name can be anything; it doesn&#8217;t need to be related to the type being injected.</p>
</div>
</div>
<div class="sect4">
<h5 id="_constructor_injection">Constructor injection</h5>
<div class="paragraph">
<p>Simply to note that constructor injection is <em>not</em> supported by Apache Isis (and is unlikely to be, because the JDO specification for entities requires a no-arg constructor).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_class-structure_properties-vs-parameters">5.1.7. Properties vs Parameters</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In many cases the value types of properties and of action parameters align. For example, a <code>Customer</code> entity might have a <code>surname</code> property, and there might also be corresponding <code>changeSurname</code>.  Ideally we want the surname property and surname action parameter to use the same value type.</p>
</div>
<div class="paragraph">
<p>Having first-class support for this is a goal of Apache Isis, and it is already possible (by writing some plumbing and glue code using Isis and DataNucleus APIs) to get some way towards this ideal.  However, in the vast majority of cases it is much easier and more practical to simply use standard value types such as <code>java.lang.String</code>.</p>
</div>
<div class="paragraph">
<p>However, the JDO/DataNucleus annotations for specifying semantics such as optionality or maximum length are restricted to only apply to fields and to methods; they cannot be applied to action parameters.  It is therefore necessary to use Apache Isis' equivalent annotations for action parameters.</p>
</div>
<div class="paragraph">
<p>The table below summarises the equivalence of some of the most common cases.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Comparing annotations of Properties vs Action Parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 37%;">
<col style="width: 37%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">value type/semantic</th>
<th class="tableblock halign-left valign-top">property</th>
<th class="tableblock halign-left valign-top">action parameter</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (length)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">big decimal (precision)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Isis blob</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Column(allowsNull="true")</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ParameterLayout(optionality=Optionality.OPTIONAL</code>) or <code>@Optional</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_class-structure_ignoring-methods">5.1.8. Ignoring Methods</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sometimes you want to define a <code>public</code> method on a domain object that is not intended to be rendered in Apache Isis' UI.</p>
</div>
<div class="paragraph">
<p>To exclude such methods, use the <a href="rg.html#_rg_annotations_manpage-Programmatic"><code>@Programmatic</code></a> annotation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_how-tos_ui-hints">5.2. UI Hints</h3>
<div class="paragraph">
<p>The Apache Isis programming model includes several mechanisms for a domain object to provide UI hints.  These range from their title (so an end-user can distinguish one object from another) through to hints that can impact their CSS styling.</p>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_ui-hints_object-titles-and-icons">5.2.1. Object Titles and Icons</h4>
<div class="paragraph">
<p>In Apache Isis every object is identified to the user by a title (label) and an icon.  This is shown in several places: as the main heading for an object; as a link text for an object referencing another object, and also in tables representing collections of objects.</p>
</div>
<div class="paragraph">
<p>The icon is often the same for all instances of a particular class, but it&#8217;s also possible for an individual instance to return a custom icon.  This could represent the state of that object (eg a shipped order, say, or overdue library book).</p>
</div>
<div class="paragraph">
<p>It is also possible for an object to provide a CSS class hint.  In conjunction with <a href="#_ug_wicket-viewer_customisation_tweaking-css-classes">customized CSS</a> this can be used to apply arbitrary styling; for example each object could be rendered in a page with a different background colour.</p>
</div>
<div class="sect4">
<h5 id="_object_title">Object Title</h5>
<div class="paragraph">
<p>The object title is a label to identify an object to the end-user.  Generally the object title is a label to identify an object to the end-user.  There is no requirement for it to be absolutely unique, but it should be "unique enough" to distinguish the object from other object&#8217;s likely to be rendered on the same page.</p>
</div>
<div class="paragraph">
<p>The title is always shown with an icon, so there is generally no need for the title to include information about the object&#8217;s type.  For example the title of a customer object shouldn&#8217;t include the literal string "Customer"; it can just have the customer&#8217;s name, reference or some other meaningful business identifier.</p>
</div>
<div class="sect5">
<h6 id="_declarative_style">Declarative style</h6>
<div class="paragraph">
<p>The <a href="rg.html#_rg_annotations_manpage-Title"><code>@Title</code></a> annotation can be used build up the title of an object from its constituent parts.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@Title</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>, append=<span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getFirstName() { ... }
    <span class="annotation">@Title</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Product getLastName() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>might return "Arthur Clarke", while:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerAlt</span> {
    <span class="annotation">@Title</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>, prepend=<span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getFirstName() { ... }

    <span class="annotation">@Title</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Product getLastName() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>could return "Clarke, Arthur".</p>
</div>
<div class="paragraph">
<p>Note that the sequence is in Dewey Decimal Format.  This allows a subclass to intersperse information within the title.  For example (please forgive this horrible domain modelling (!)):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Author</span> <span class="directive">extends</span> Customer {
    <span class="annotation">@Title</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.5</span><span class="delimiter">&quot;</span></span>, append=<span class="string"><span class="delimiter">&quot;</span><span class="content">. </span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getMiddleInitial() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>could return "Arthur C. Clarke".</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Titles can sometimes get be long and therefore rather cumbersome in "parented" tables.  If <code>@Title</code> has been used then the Wicket viewer will automatically exclude portions of the title belonging to the owning object.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_imperative_style">Imperative style</h6>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - see <a href="rg.html#_rg_methods_reserved_manpage-title"><code>title()</code></a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_object_icon">Object Icon</h5>
<div class="paragraph">
<p>The icon is often the same for all instances of a particular class, but it&#8217;s also possible for an individual instance to return a custom icon.  This could represent the state of that object (eg a shipped order, say, or overdue library book).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_reserved_manpage-iconName"><code>iconName()</code></a>, <a href="rg.html#_rg_annotations_manpage-DomainObjectLayout_cssClassFa"><code>@DomainObjectLayout#cssClassFa()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_object_css_styling">Object CSS Styling</h5>
<div class="paragraph">
<p>It is also possible for an object to return a <a href="rg.html#_rg_methods_reserved_manpage-cssClass">CSS class</a>.  In conjunction with <a href="#_ug_wicket-viewer_customisation_tweaking-css-classes">customized CSS</a> this can be used to apply arbitrary styling; for example each object could be rendered in a page with a different background colour.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_reserved_manpage-cssClass"><code>cssClass()</code></a>, <a href="rg.html#_rg_annotations_manpage-DomainObjectLayout_cssClass"><code>@DomainObjectLayout#cssClass()</code></a> <a href="rg.html#_rg_annotations_manpage-ActionLayout_cssClass"><code>@ActionLayout#cssClass()</code></a>, <a href="rg.html#_rg_annotations_manpage-PropertyLayout_cssClass"><code>@PropertyLayout#cssClass()</code></a>, <a href="rg.html#_rg_annotations_manpage-CollectionLayout_cssClass"><code>@CollectionLayout#cssClass()</code></a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_ui-hints_names-and-descriptions">5.2.2. Names and Descriptions</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
see also <a href="#_ug_more-advanced_i18n">Internationalization</a>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_class_object">Class (object)</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_annotations_manpage-DomainObjectLayout_named"><code>@DomainObjectLayout#named()</code></a>, <a href="rg.html#_rg_annotations_manpage-DomainObjectLayout_describedAs"><code>@DomainObjectLayout#describedAs()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_property">Property</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_annotations_manpage-PropertyLayout_named"><code>@PropertyLayout#named()</code></a>, <a href="rg.html#_rg_annotations_manpage-PropertyLayout_describedAs"><code>@PropertyLayout#describedAs()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_collections_2">Collections</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_annotations_manpage-CollectionLayout_named"><code>@CollectionLayout#named()</code></a>, <a href="rg.html#_rg_annotations_manpage-CollectionLayout_describedAs"><code>@CollectionLayout#describedAs()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_actions_2">Actions</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_annotations_manpage-ActionLayout_named"><code>@ActionLayout#named()</code></a>, <a href="rg.html#_rg_annotations_manpage-ActionLayout_describedAs"><code>@ActionLayout#describedAs()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_action_parameters">Action Parameters</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_annotations_manpage-ParameterLayout_named"><code>@ParameterLayout#named()</code></a>, <a href="rg.html#_rg_annotations_manpage-ParameterLayout_describedAs"><code>@ParameterLayout#describedAs()</code></a>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you&#8217;re running on Java 8, then note that it&#8217;s possible to write Isis applications without using <code>@ParameterLayout(named=&#8230;&#8203;)</code> annotation.  Support for this can be found in the <a href="http://github.com/isisaddons/isis-metamodel-paraname8">Isis addons' paraname8</a> metamodel extension (non-ASF).  (In the future we&#8217;ll fold this into core).  See also our guidance on <a href="release-notes.html#_migration-notes_1.8.0-to-1.9.0_upgrading-to-java8">upgrading to Java 8</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_ui-hints_layout">5.2.3. Layout</h4>
<div class="paragraph">
<p>See the <a href="rg.html#_rg_object-layout">object layout</a> chapter.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_ui-hints_eager-rendering">5.2.4. Eager rendering</h4>
<div class="paragraph">
<p>By default, collections all rendered lazily, in other words in a "collapsed" table view:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - screenshot here
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For the more commonly used collections we want to show the table expanded:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - screenshot here
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For this we annotate the collection using the <code>@CollectionLayout(render=RenderType.EAGERLY</code>; for example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Persistent(table=<span class="string"><span class="delimiter">&quot;</span><span class="content">ToDoItemDependencies</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">Set</span>&lt;ToDoItem&gt; dependencies = <span class="keyword">new</span> <span class="predefined-type">TreeSet</span>&lt;&gt;();
<span class="annotation">@Collection</span>
<span class="annotation">@CollectionLayout</span>(
    render = RenderType.EAGERLY
)
<span class="directive">public</span> <span class="predefined-type">Set</span>&lt;ToDoItem&gt; getDependencies() {
    <span class="keyword">return</span> dependencies;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, it can be specified the <code>Xxx.layout.json</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="string"><span class="delimiter">&quot;</span><span class="content">dependencies</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">collectionLayout</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">render</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">EAGERLY</span><span class="delimiter">&quot;</span></span>
    },
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It might be thought that collections that are eagerly rendered should also be eagerly loaded from the database by enabling the <code>defaultFetchGroup</code> attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Persistent(table=<span class="string"><span class="delimiter">&quot;</span><span class="content">ToDoItemDependencies</span><span class="delimiter">&quot;</span></span>, defaultFetchGroup=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">Set</span>&lt;ToDoItem&gt; dependencies = <span class="keyword">new</span> <span class="predefined-type">TreeSet</span>&lt;&gt;();
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>While this can be done, it&#8217;s likely to be a bad idea, because doing so will cause DataNucleus to query for more data than required even if the object is being rendered within some referencing object&#8217;s table.</p>
</div>
<div class="paragraph">
<p>Of course, your mileage may vary, so don&#8217;t think you can&#8217;t experiment.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_ui-hints_action-icons-and-css">5.2.5. Action Icons and CSS</h4>
<div class="paragraph">
<p>Apache Isis allows <a href="http://fortawesome.github.io/Font-Awesome/icons/">font awesome</a> icons to be associated with each action, and for <a href="http://getbootstrap.com/css/#buttons">Bootstrap CSS</a> to be applied to action rendered as buttons.</p>
</div>
<div class="paragraph">
<p>These UI hint can be applied either to individual actions, or can be applied en-masse using pattern matching.</p>
</div>
<div class="sect4">
<h5 id="_per_action">Per action</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_annotations_manpage-ActionLayout_cssClass"><code>@ActionLayout#cssClass()</code></a> and <a href="rg.html#_rg_annotations_manpage-ActionLayout_cssClassFa"><code>@ActionLayout#cssClassFa()</code></a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, you can specify these hints dynamically in the <a href="rg.html#_rg_object-layout"><code>Xxx.layout.json</code></a> for the entity.</p>
</div>
</div>
<div class="sect4">
<h5 id="_per_pattern_matching">Per pattern matching</h5>
<div class="paragraph">
<p>Rather than annotating every action with <a href="rg.html#_rg_annotations_manpage-ActionLayout_cssClassFa"><code>@ActionLayout#cssClassFa()</code></a> and <a href="rg.html#_rg_annotations_manpage-ActionLayout_cssClass"><code>@ActionLayout#cssClass()</code></a> you can instead specify the UI hint globally using regular expressions.</p>
</div>
<div class="paragraph">
<p>The <a href="rg.html#_rg_runtime_configuring-core">configuration property</a> <code>isis.reflector.facet.cssClassFa.patterns</code> is a comma separated list of key:value pairs, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.reflector.facet.cssClassFa.patterns=\
                        new.*:fa-plus,\
                        add.*:fa-plus-square,\
                        create.*:fa-plus,\
                        list.*:fa-list, \
                        all.*:fa-list, \
                        download.*:fa-download, \
                        upload.*:fa-upload, \
                        execute.*:fa-bolt, \
                        run.*:fa-bolt</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the key is a regex matching action names (eg <code>create.*</code>) and the value is a <a href="http://fortawesome.github.io/Font-Awesome/icons/">font-awesome</a> icon name (eg <code>fa-plus</code>) to be applied (as per <code>@CssClassFa()</code>) to all action members matching the regex.</p>
</div>
<div class="paragraph">
<p>Similarly, the <a href="rg.html#_rg_runtime_configuring-core">configuration property</a> <code>isis.reflector.facet.cssClass.patterns</code> is a comma separated list of key:value pairs, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.reflector.facet.cssClass.patterns=\
                        delete.*:btn-warning</code></pre>
</div>
</div>
<div class="paragraph">
<p>where (again)the key is a regex matching action names (eg <code>delete.*</code>) and the value is a <a href="http://getbootstrap.com/css/">Bootstrap</a> CSS button class (eg <code>btn-warning) to be applied (as per `@CssClass()</code>) to all action members matching the regex.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We strongly recommend that you use this technique rather than annotating each action with <a href="rg.html#_rg_annotations_manpage-ActionLayout_cssClassFa"><code>@ActionLayout#cssClassFa()</code></a> or <a href="rg.html#_rg_annotations_manpage-ActionLayout_cssClass"><code>@ActionLayout#cssClass()</code></a>.  Not only is the code more maintainable, you&#8217;ll also find that it forces you to be consistent in your action names.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_how-tos_domain-services">5.3. Domain Services</h3>
<div class="paragraph">
<p>It&#8217;s worth extending the <a href="#_ug_core-concepts_philosophy_hexagonal-architecture">Hexagonal Architecture</a> to show where domain services&#8201;&#8212;&#8201;and in particular the domain services provided by <a href="http://www.isisaddons.org">Isis Addons</a> (non-ASF)&#8201;&#8212;&#8201;fit in:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/how-tos/domain-services/hexagonal-architecture-addons.png" alt="hexagonal architecture addons" width="700px">
</div>
<div class="title">Figure 2. The hexagonal architecture with Isis addons</div>
</div>
<div class="paragraph">
<p>Here, we can see that the addons provide services both to the Apache Isis framework (for example security, command and auditing) and also - by way of dependency injection - to the domain objects (eg tags, excel, settings). Of course, you can also write your own domain services as well, for example to interface with some external CMS system, say.</p>
</div>
<div class="paragraph">
<p>The Apache Isis framework also provides numerous in-built domain services.  These are catalogued in the reference guide, see <a href="rg.html#_rg_services-api">here</a> and <a href="rg.html#_rg_services-spi">here</a>.</p>
</div>
<div class="sect3">
<h4 id="_scoped_services">5.3.1. Scoped services</h4>
<div class="paragraph">
<p>By default all domain services are considered to be singletons, and thread-safe.</p>
</div>
<div class="paragraph">
<p>Sometimes though a service&#8217;s lifetime is applicable only to a single request; in other words it is request-scoped.</p>
</div>
<div class="paragraph">
<p>The CDI annotation <a href="rg.html#_rg_annotations_manpage-RequestScoped"><code>@javax.enterprise.context.RequestScoped</code></a> is used to indicate this fact:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.enterprise.context.RequestScoped
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyService</span> <span class="directive">extends</span> AbstractService {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The framework provides a number of request-scoped services, include a scratchpad service, query results caching, and support for co-ordinating bulk actions.  See <a href="rg.html#_rg_services-api">here</a> and <a href="rg.html#_rg_services-spi">here</a> for further details.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_domain_services">5.3.2. Registering domain services</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - discuss @DomainService if <code>isis.services-installer=annotation-and-configuration</code>; how to override these defaults by explicit registration
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Domain services (which includes repositories and factories) can be registered in the <code>isis.properties</code> configuration file, under <code>isis.services</code> key (a comma-separated list):</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services = com.mycompany.myapp.employee.Employees\,
                com.mycompany.myapp.claim.Claims\,
                ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will then result in the framework instantiating a single instance of each of the services listed.</p>
</div>
<div class="paragraph">
<p>If all services reside under a common package, then the <code>isis.services.prefix</code> can specify this prefix:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services.prefix = com.mycompany.myapp
isis.services = employee.Employees,\
                claim.Claims,\
                ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is quite rare, however; you will often want to use default implementations of domain services that are provided by the framework and so will not reside under this prefix.</p>
</div>
<div class="paragraph">
<p>Examples of framework-provided services (as defined in the applib) include clock, auditing, publishing, exception handling, view model support, snapshots/mementos, and user/application settings management; see the <a href="rg.html#_rg_services-api">here</a> and _rg_services-spi[here] for further details.</p>
</div>
</div>
<div class="sect3">
<h4 id="_contributions_2">5.3.3. Contributions</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - just xref <a href="#_ug_how-tos_contributed-members">contributed members</a> section.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_menu_items">5.3.4. Menu items</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - update to new annotations, including @DomainService(nature=&#8230;&#8203;)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default every action of a service (by which we also mean repositories and factories) will be rendered in the viewer, eg as a menu item for that service menu. This behaviour can be suppressed by annotating the action using <code>@org.apache.isis.applib.annotations.NotInServiceMenu</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Library</span> {
    <span class="annotation">@NotInServiceMenu</span>
    <span class="directive">public</span> Loan borrow(Loanable l, Borrower b);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that an action annotated as being <code>@NotInServiceMenu</code> will still be contributed. If an action should neither be contributed nor appear in service menu items, then simply annotate it as <code>@Hidden</code>.</p>
</div>
<div class="paragraph">
<p>Alternatively, this can be performed using a supporting method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LibraryImpl</span> <span class="directive">implements</span> Library {
    <span class="directive">public</span> Loan borrow(Loanable l, Borrower b) { ... }
    <span class="directive">public</span> <span class="type">boolean</span> notInServiceMenuBorrow() { ... }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_menus">5.3.5. Menus</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - update to new annotations, including @DomainService(nature=&#8230;&#8203;)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If none of the service menu items should appear, then the service itself should be annotated as <code>@Hidden</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Hidden</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">EmailService</span> {
    <span class="directive">public</span> <span class="type">void</span> sendEmail(<span class="predefined-type">String</span> to, <span class="predefined-type">String</span> from, <span class="predefined-type">String</span> subject, <span class="predefined-type">String</span> body);
    <span class="directive">public</span> <span class="type">void</span> forwardEmail(<span class="predefined-type">String</span> to, <span class="predefined-type">String</span> from, <span class="predefined-type">String</span> subject, <span class="predefined-type">String</span> body);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_initialization">5.3.6. Initialization</h4>
<div class="paragraph">
<p>Services can optionally declare lifecycle callbacks to initialize them (when the app is deployed) and to shut them down (when the app is undeployed).</p>
</div>
<div class="paragraph">
<p>An Apache Isis session <em>is</em> available when initialization occurs (so services can interact with the object store, for example).</p>
</div>
<div class="paragraph">
<p>The framework will call any <code>public</code> method annotated with <a href="rg.html#_rg_annotations_manpage-PostConstruct"><code>@PostConstruct</code></a> with either no arguments of an argument of type <code>Map&lt;String,String&gt;</code></p>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="paragraph">
<p>In the latter case, the framework passes in the configuration (<code>isis.properties</code> and any other component-specific configuration files).</p>
</div>
<div class="paragraph">
<p>Shutdown is similar; the framework will call any method annotated with <a href="rg.html#_rg_annotations_manpage-PreDestroy"><code>@PreDestroy</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_getid_method">5.3.7. The getId() method</h4>
<div class="paragraph">
<p>Optionally, a service may provide a <a href="rg.html#_rg_methods_reserved_manpage-getId"><code>getId()</code></a> method.  This method returns a logical identifier for a service, independent of its implementation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_how-tos_crud">5.4. Object Management (CRUD)</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_instantiating_and_persisting_objects">5.4.1. Instantiating and Persisting Objects</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - using <code>DomainObjectContainer</code>'s support for  <a href="rg.html#_rg_services-api_manpage-DomainObjectContainer_object-creation-api">creation</a> and <a href="rg.html#_rg_services-api_manpage-DomainObjectContainer_object-persistence-api">persistence</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_finding_objects">5.4.2. Finding Objects</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - using <a href="rg.html#_rg_services-api_manpage-DomainObjectContainer_generic-repository-api"><code>DomainObjectContainer</code></a>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_using_datanucleus_type_safe_queries">Using DataNucleus type-safe queries</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - as described <a href="rg.html#_rg_services-api_manpage-IsisJdoSupport_type-safe-jdoql-queries">here</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_deleting_objects">5.4.3. Deleting Objects</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO using <code>DomainObjectContainer</code>'s support for  <a href="rg.html#_rg_services-api_manpage-DomainObjectContainer_object-persistence-api">persistence</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_how-tos_entity-relationships">5.5. Entity Relationships</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_mandatory_and_optional">5.5.1. Mandatory and Optional</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_entity-relationships_managed-1-to-m-bidirectional-relationships">5.5.2. 1-m bidir relationships</h4>
<div class="paragraph">
<p>When an object is added to a 1:m bidirectional relationship, the child object must refer to the parent and the child must be added to the parent&#8217;s children collection.</p>
</div>
<div class="paragraph">
<p>If there were no database involved then we would have recommended that you use the <a href="http://www.two-sdg.demon.co.uk/curbralan/papers/MutualRegistration.pdf">mutual registration</a> pattern to ensure that both the parent and child are updated correctly.  (The  <a href="rg.html#_rg_methods_prefixes_manpage-modify"><code>modify&#8230;&#8203;()</code></a> and <a href="rg.html#_rg_methods_prefixes_manpage-clear"><code>clear&#8230;&#8203;()</code></a> supporting methods were introduced in the framework primarily to help support implement the mutual registration pattern.</p>
</div>
<div class="paragraph">
<p>However, in a relational database, these two operations in the domain object model correspond simply to updating the foreign key of the child table to reference the parent&#8217;s primary key.</p>
</div>
<div class="paragraph">
<p>So long as the parent&#8217;s children collection is a <code>java.util.Set</code> (rather than a <code>Collection</code> or a <code>List</code>), the JDO Objectstore will automatically maintain both sides of the relationship. All that is necessary is to set the child to refer to the parent.</p>
</div>
<div class="paragraph">
<p>For example, all you need write is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Department</span> {
    <span class="annotation">@javax</span>.jdo.annotations.Persistent(mappedBy=<span class="string"><span class="delimiter">&quot;</span><span class="content">department</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">private</span> <span class="predefined-type">SortedSet</span>&lt;Employee&gt; employees = <span class="keyword">new</span> <span class="predefined-type">TreeSet</span>&lt;Employee&gt;();

    <span class="directive">public</span> <span class="predefined-type">SortedSet</span>&lt;Employee&gt; getEmployees() { ... }
    <span class="directive">public</span> <span class="type">void</span> setEmployees(<span class="predefined-type">SortedSet</span>&lt;Employee&gt; employees) { ... }
    ...
}
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {
    <span class="directive">private</span> Department department;
    <span class="directive">public</span> Department getDepartment() { ... }
    <span class="directive">public</span> <span class="type">void</span> setDepartment(Department department) { ... }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>it&#8217;s the <code>mappedBy</code> attribute that tells DataNucleus this is a bidirectional relationship.  The value "department" refers to the Employee#department property.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Moreover, when maintaining a bidirectional 1-n relationship that is automatically managed by DataNucleus, it&#8217;s preferred to "add" to the parent&#8217;s child collection, don&#8217;t set the parent on the child.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you don&#8217;t do this then you may (as of Apache Isis 1.4.1) hit an NullPointerException. This may be a bug in DataNucleus, we are not completely sure, but the above idiom seems to fix the issue.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="http://isis.markmail.org/thread/ipu2lzqqikqdglox">this thread</a> on the Apache Isis users mailing list, including this <a href="http://markmail.org/message/hblptpw675mlw723">message</a> with the above recommendation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In fact, not only do you not need to manually maintain the relationship, we have noted on at least <a href="http://markmail.org/message/agnwmzocvdfht32f">one occasion</a> a subtle error if the code is programmatically added.</p>
</div>
<div class="paragraph">
<p>The error in that case was that the same object was contained in the parents collection. This of course should not happen for a <code>TreeSet</code>. However, JDO/DataNucleus replaces the <code>TreeSet</code> with its own implementation, and (either by design or otherwise) this does not enforce <code>Set</code> semantics.</p>
</div>
<div class="paragraph">
<p>The upshot is that you should NEVER programmatically add the child object to the parent&#8217;s collection if using JDO Objectstore.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_how-tos_contributed-members">5.6. Contributed Members</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - generalize to discussion on contributed collections/properties; update to new annotations
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Any n-parameter action provided by a service will automatically be contributed to the list of actions for each of its (entity) parameters. From the viewpoint of the entity the action is called a contributed action.</p>
</div>
<div class="paragraph">
<p>For example, given a service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Library</span> {
    <span class="directive">public</span> Loan borrow(Loanable l, Borrower b);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the entities:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Book</span> <span class="directive">implements</span> Loanable { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LibraryMember</span> <span class="directive">implements</span> Borrower { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>then the <code>borrow(&#8230;&#8203;)</code> action will be contributed to both <code>Book</code> and to <code>LibraryMember</code>.</p>
</div>
<div class="paragraph">
<p>This is an important capability because it helps to decouple the concrete classes from the services.</p>
</div>
<div class="paragraph">
<p>If necessary, though, this behaviour can be suppressed by annotating the service action with <code>@org.apache.isis.applib.annotations.NotContributed</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Library</span> {
    <span class="annotation">@NotContributed</span>
    <span class="directive">public</span> Loan borrow(Loanable l, Borrower b);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If annotated at the interface level, then the annotation will be inherited by every concrete class. Alternatively the annotation can be applied at the implementation class level and only apply to that particular implementation.</p>
</div>
<div class="paragraph">
<p>Note that an action annotated as being <code>@NotContributed</code> will still appear in the service menu for the service. If an action should neither be contributed nor appear in service menu items, then simply annotate it as <code>@Hidden</code>.</p>
</div>
<div class="sect3">
<h4 id="_contributed_action">5.6.1. Contributed Action</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_contributed_property">5.6.2. Contributed Property</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_contributed_collection">5.6.3. Contributed Collection</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_how-tos_business-rules">5.7. Business Rules</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_visibility_see_it">5.7.1. Visibility ("see it")</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_prefixes_manpage-hide"><code>hide&#8230;&#8203;()</code></a>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_hide_a_property">Hide a Property</h5>

</div>
<div class="sect4">
<h5 id="_hide_a_collection">Hide a Collection</h5>

</div>
<div class="sect4">
<h5 id="_hide_an_action">Hide an Action</h5>

</div>
<div class="sect4">
<h5 id="_hide_a_contributed_property_collection_or_action">Hide a Contributed Property, Collection or Action</h5>

</div>
<div class="sect4">
<h5 id="_all_members_hidden">All Members Hidden</h5>

</div>
</div>
<div class="sect3">
<h4 id="_usability_use_it">5.7.2. Usability ("use it")</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_prefixes_manpage-disable"><code>disable&#8230;&#8203;()</code></a>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_disable_a_property">Disable a Property</h5>

</div>
<div class="sect4">
<h5 id="_disable_a_collection">Disable a Collection</h5>

</div>
<div class="sect4">
<h5 id="_disable_an_action">Disable an Action</h5>

</div>
<div class="sect4">
<h5 id="_disable_a_contributed_property_collection_or_action">Disable a Contributed Property, Collection or Action</h5>

</div>
<div class="sect4">
<h5 id="_all_members_unmodifiable_disabling_the_edit_button">All Members Unmodifiable (Disabling the Edit Button)</h5>
<div class="paragraph">
<p>Sometimes an object is unmodifiable.</p>
</div>
<div class="paragraph">
<p>In the Wicket viewer this means disabling the edit button.</p>
</div>
<div class="sect5">
<h6 id="_declarative">Declarative</h6>
<div class="paragraph">
<p><code>@DomainObject(editing=&#8230;&#8203;)</code></p>
</div>
</div>
<div class="sect5">
<h6 id="_imperative">Imperative</h6>

</div>
</div>
</div>
<div class="sect3">
<h4 id="_validity_do_it">5.7.3. Validity ("do it")</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_prefixes_manpage-validate"><code>validate&#8230;&#8203;()</code></a>, <a href="rg.html#_rg_methods_prefixes_manpage-validateAddTo"><code>validateAddTo&#8230;&#8203;()</code></a>, <a href="rg.html#_rg_methods_prefixes_manpage-validateRemoveFrom"><code>validateRemoveFrom&#8230;&#8203;()</code></a> and <a href="rg.html#_rg_methods_reserved_manpage-validate"><code>validate()</code></a>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_validate_change_to_a_property">Validate (change to) a Property</h5>

</div>
<div class="sect4">
<h5 id="_validate_adding_or_removing_from_a_collection">Validate (adding or removing from) a Collection</h5>

</div>
<div class="sect4">
<h5 id="_validate_arguments_to_invoke_an_action">Validate (arguments to invoke) an Action</h5>

</div>
<div class="sect4">
<h5 id="_validating_a_contributed_property_collection_or_action">Validating a Contributed Property, Collection or Action</h5>

</div>
<div class="sect4">
<h5 id="_declarative_validation">Declarative validation</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - using <a href="rg.html#_rg_annotations_manpage-Parameter_mustSatisfy"><code>@Parameter#mustSatisfy()</code></a>, <a href="rg.html#_rg_annotations_manpage-Property_mustSatisfy"><code>@Property#mustSatisfy()</code></a>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_how-tos_derived-members">5.8. Derived Members</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_derived_property">5.8.1. Derived Property</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_derived_collection">5.8.2. Derived Collection</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>While derived properties and derived collections typically "walk the graph" to associated objects, there is nothing to prevent the returned value being the result of invoking a repository (domain service) action.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    ...
    public <span class="predefined-type">List</span>&lt;Order&gt; getMostRecentOrders() {
        <span class="keyword">return</span> orderRepo.findMostRecentOrders(<span class="local-variable">this</span>, <span class="integer">5</span>);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_trigger_on_property_change">5.8.3. Trigger on property change</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_prefixes_manpage-modify"><code>modify&#8230;&#8203;()</code></a>, <a href="rg.html#_rg_methods_prefixes_manpage-clear"><code>clear&#8230;&#8203;()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_trigger_on_collection_change">5.8.4. Trigger on collection change</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_prefixes_manpage-addTo"><code>addTo&#8230;&#8203;()</code></a>, <a href="rg.html#_rg_methods_prefixes_manpage-removeFrom"><code>removeFrom&#8230;&#8203;()</code></a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_how-tos_drop-downs-and-defaults">5.9. Drop Downs and Defaults</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_for_properties">5.9.1. For Properties</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_choices_for_property">Choices for Property</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_prefixes_manpage-choices"><code>choices&#8230;&#8203;()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_auto_complete_for_property">Auto-complete for property</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_prefixes_manpage-autoComplete"><code>autoComplete&#8230;&#8203;()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_default_for_property">Default for property</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO -  <a href="rg.html#_rg_methods_prefixes_manpage-default"><code>default&#8230;&#8203;()</code></a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_for_action_parameters">5.9.2. For Action Parameters</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_choices_for_action_parameter">Choices for action parameter</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_prefixes_manpage-choices"><code>choices&#8230;&#8203;()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_dependent_choices_for_action_params">Dependent choices for action params</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_prefixes_manpage-choices"><code>choices&#8230;&#8203;()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_auto_complete_for_action_param">Auto-complete for action param</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_prefixes_manpage-autoComplete"><code>autoComplete&#8230;&#8203;()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_default_for_action_param">Default for action param</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO -  <a href="rg.html#_rg_methods_prefixes_manpage-default"><code>default&#8230;&#8203;()</code></a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_for_both_properties_and_action_parameters">5.9.3. For both Properties and Action Parameters</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_drop_down_for_limited_number_of_instances">Drop-down for limited number of instances</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_annotations_manpage-DomainObject_bounded"><code>@DomainObject#bounded()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_auto_complete_repository_based">Auto-complete (repository-based)</h5>
<div class="paragraph">
<p><a href="rg.html#_rg_annotations_manpage-DomainObject_autoCompleteRepository"><code>@DomainObject#autoCompleteRepository()</code></a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_how-tos_persisted-title">5.10. Persisted Title</h3>
<div class="paragraph">
<p>Normally the title of an object is not persisted to the database, rather it is recomputed automatically from underlying properties.  On occasion though you might want the title to also be persisted; either to make things easier for the DBA, or for an integration scenario, or some other purpose.</p>
</div>
<div class="paragraph">
<p>We can implement this feature by leveraging the <a href="rg.html#_rg_methods_lifecycle_jdo-api">JDO lifecycle</a>.  In the design we discuss here we make it a responsibility of the entities to persist the title as a property, by implementing a <code>ObjectWithPersistedTitle</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ObjectWithPersistedTitle</span> {
    <span class="annotation">@PropertyLayout</span>(hidden = Where.EVERYWHERE)  <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="predefined-type">String</span> getTitle();
    <span class="type">void</span> setTitle(<span class="directive">final</span> <span class="predefined-type">String</span> title);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>we don&#8217;t want to expose this in the UI because the title is already prominently displayed.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can then define a domain service that leverage this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequestScoped</span>
<span class="annotation">@DomainService</span>(nature = NatureOfService.DOMAIN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TitlingService</span> {
    <span class="annotation">@PostConstruct</span>
    <span class="directive">public</span> <span class="type">void</span> init() {
        isisJdoSupport.getJdoPersistenceManager().addInstanceLifecycleListener(
            <span class="keyword">new</span> StoreLifecycleListener() {
                <span class="annotation">@Override</span>
                <span class="directive">public</span> <span class="type">void</span> preStore(<span class="directive">final</span> InstanceLifecycleEvent event) {
                    <span class="directive">final</span> <span class="predefined-type">Object</span> persistentInstance = event.getPersistentInstance();
                    <span class="keyword">if</span>(persistentInstance <span class="keyword">instanceof</span> ObjectWithPersistedTitle) {
                        <span class="directive">final</span> ObjectWithPersistedTitle objectWithPersistedTitle =
                            (ObjectWithPersistedTitle) persistentInstance;
                        objectWithPersistedTitle.setTitle(container.titleOf(objectWithPersistedTitle));
                    }
                }
                <span class="annotation">@Override</span>
                <span class="directive">public</span> <span class="type">void</span> postStore(<span class="directive">final</span> InstanceLifecycleEvent event) {
                }
            }, <span class="predefined-constant">null</span>);
    }
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> IsisJdoSupport isisJdoSupport;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> DomainObjectContainer container;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above is probably the easiest and most straightforward design. One could imagine other designs where the persisted title is stored elsewhere.  It could even be stored off into an <a href="http://lucene.apache.org/">Apache Lucene</a> (or similar) database to allow for free-text searches.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ug_more-advanced">6. More Advanced Techniques</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter pulls together a number of more advanced techniques that we&#8217;ve discovered and developed while building our own Isis applications.</p>
</div>
<div class="sect2">
<h3 id="_ug_more-advanced_decoupling">6.1. Decoupling</h3>
<div class="paragraph">
<p>We use Java packages as a way to group related domain objects together; the package name forms a namespace. We can then
reason about all the classes in that package/namespace as a single unit, or module.</p>
</div>
<div class="paragraph">
<p>This section describes how to use Apache Isis' features to ensure that your domain application remains decoupled.  The techniques described here are also the ones that have been adopted by the various <a href="http://github.com/isisaddons">Isis Addons</a> modules (not ASF) for security, commands, auditing etc.</p>
</div>
<div class="paragraph">
<p>The following sections describe how to re-assemble an application, in particular where some modules are in-house but others are potentially third-party (eg the Isis Addons modules).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There is some overlap with OSGi and Java 9&#8217;s Jigsaw concepts of "module"; in the future we expect to refactor Apache Isis to leverage these module systems.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_ug_more-advanced_decoupling_db-schemas">6.1.1. Database Schemas</h4>
<div class="paragraph">
<p>In the same way that Java packages act as a namespace for domain objects, it&#8217;s good practice to map domain entities to
their own (database) schemas. As of 1.9.0-SNAPSHOT, all the <a href="http://www.isisaddons.org">Isis Addons</a> (non-ASF) modules do this, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.PersistenceCapable( ...
        schema = <span class="string"><span class="delimiter">&quot;</span><span class="content">isissecurity</span><span class="delimiter">&quot;</span></span>,
        table = <span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationUser</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ApplicationUser</span> ... { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in a <code>CREATE TABLE</code> statement of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">TABLE</span> isissecurity.<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationUser</span><span class="delimiter">&quot;</span></span> (
    ...
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>while:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.PersistenceCapable( ...
        schema = <span class="string"><span class="delimiter">&quot;</span><span class="content">isisaudit</span><span class="delimiter">&quot;</span></span>,
        table=<span class="string"><span class="delimiter">&quot;</span><span class="content">AuditEntry</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AuditEntry</span> ... { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>similarly results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">TABLE</span> isisaudit.<span class="string"><span class="delimiter">&quot;</span><span class="content">AuditEntry</span><span class="delimiter">&quot;</span></span> (
    ...
)</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If for some reason you don&#8217;t want to use schemas (though we strongly recommend that you do), then note that you can override the <code>@PersistenceCapable</code> annotation by providing XML metadata (the <code>mappings.jdo</code> file); see the section on <a href="rg.html#_rg_runtime_configuring-datanucleus">configuring DataNucleus Overriding Annotations</a> for more details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_listener_to_create_schema">Listener to create schema</h5>
<div class="paragraph">
<p>JDO/DataNucleus does not automatically create these schema objects, but it <em>does</em> provide a listener callback API
on the initialization of each class into the JDO metamodel.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Actually, the above statement isn&#8217;t quite true.  In DN 3.2.x (as used by Apache Isis up to v1.8.0) there was no support for schemas.  As of Apache Isis 1.9.0-SNAPSHOT and DN 4.0 there is now support.  But we implemented this feature initially against DN 3.2.x, and it still works, so for now we&#8217;ve decided to leave it in.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Therefore Apache Isis attaches a listener, <code>CreateSchemaObjectFromClassMetadata</code>, that checks for the schema&#8217;s existence, and creates the schema if required.</p>
</div>
<div class="paragraph">
<p>The guts of its implementation is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CreateSchemaObjectFromClassMetadata</span>
        <span class="directive">implements</span> MetaDataListener,
                   PersistenceManagerFactoryAware,
                   DataNucleusPropertiesAware {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> loaded(<span class="directive">final</span> AbstractClassMetaData cmd) { ... }

    <span class="directive">protected</span> <span class="predefined-type">String</span> buildSqlToCheck(<span class="directive">final</span> AbstractClassMetaData cmd) {
        <span class="directive">final</span> <span class="predefined-type">String</span> schemaName = schemaNameFor(cmd);
        <span class="keyword">return</span> <span class="predefined-type">String</span>.format(
            <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT count(*) FROM INFORMATION_SCHEMA.SCHEMATA where SCHEMA_NAME = '%s'</span><span class="delimiter">&quot;</span></span>, schemaName);
    }
    <span class="directive">protected</span> <span class="predefined-type">String</span> buildSqlToExec(<span class="directive">final</span> AbstractClassMetaData cmd) {
        <span class="directive">final</span> <span class="predefined-type">String</span> schemaName = schemaNameFor(cmd);
        <span class="keyword">return</span> <span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE SCHEMA </span><span class="char">\&quot;</span><span class="content">%s</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span>, schemaName);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>MetaDataListener</code> is the DataNucleus listener API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">MetaDataListener</span> {
    <span class="type">void</span> loaded(AbstractClassMetaData cmd);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Although not formal API, the default <code>CreateSchemaObjectFromClassMetadata</code> has been designed to be easily overrideable if you
need to tweak it to support other RDBMS'.  Any implementation must implement <code>org.datanucleus.metadata.MetaDataListener</code>:</p>
</div>
<div class="paragraph">
<p>The implementation provided has has been tested for HSQLDB, PostgreSQL and MS SQL Server, and is used automatically unless an alternative implementation is specified (as described in the section below).</p>
</div>
</div>
<div class="sect4">
<h5 id="_alternative_implementation">Alternative implementation</h5>
<div class="paragraph">
<p>An alternative implementation can be registered and used through the following configuration property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.persistor.datanucleus.classMetadataLoadedListener=\
        org.apache.isis.objectstore.jdo.datanucleus.CreateSchemaObjectFromClassMetadata</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because this pertains to the JDO Objectstore we suggest you put this configuration property in <code>WEB-INF/persistor_datanucleus.properties</code>; but putting it in <code>isis.properties</code> will also work.</p>
</div>
<div class="paragraph">
<p>Any implementation must implement <code>org.datanucleus.metadata.MetaDataListener</code>.  In many cases simply subclassing from <code>CreateSchemaObjectFromClassMetadata</code> and overriding <code>buildSqlToCheck(&#8230;&#8203;)</code> and <code>buildSqlToExec(&#8230;&#8203;)</code> should suffice.</p>
</div>
<div class="paragraph">
<p>If you <em>do</em> need more control, your implementation can also optionally implement <code>org.apache.isis.objectstore.jdo.datanucleus.PersistenceManagerFactoryAware</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">PersistenceManagerFactoryAware</span> {
    <span class="directive">public</span> <span class="type">void</span> setPersistenceManagerFactory(<span class="directive">final</span> PersistenceManagerFactory persistenceManagerFactory);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and also <code>org.apache.isis.objectstore.jdo.datanucleus.DataNucleusPropertiesAware</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">DataNucleusPropertiesAware</span> {
    <span class="directive">public</span> <span class="type">void</span> setDataNucleusProperties(<span class="directive">final</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; properties);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This latter interface provides access to the properties passed through to JDO/DataNucleus.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you do extend Apache Isis' <code>CreateSchemaObjectFromClassMetadata</code> class for some other database, please <a href="https://issues.apache.org/jira/browse/ISIS">contribute back</a> your improvements.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_more-advanced_decoupling_contributions">6.1.2. Contributions</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_more-advanced_decoupling_vetoing-visibility">6.1.3. Vetoing Visibility</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - a write-up of the "vetoing subscriber" design pattern, eg as described in the  <a href="rg.html#_rg_services-api_manpage-BookmarkService"><code>BookmarkService</code></a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>eg if included an addon such as auditing or security.</p>
</div>
<div class="paragraph">
<p>solution is to write a domain event subscriber that vetoes the visibility</p>
</div>
<div class="paragraph">
<p>All the addons actions inherit from common base classes so this can be as broad-brush or fine-grained as required</p>
</div>
</div>
<div class="sect3">
<h4 id="_ug_more-advanced_decoupling_event-bus">6.1.4. Event Bus</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - see <a href="rg.html#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a>, <a href="rg.html#_rg_annotations_manpage-Action_domainEvent"><code>@Action#domainEvent()</code></a>, <a href="rg.html#_rg_annotations_manpage-Property_domainEvent"><code>@Property#domainEvent()</code></a>, <a href="rg.html#_rg_annotations_manpage-Collection_domainEvent"><code>@Collection#domainEvent()</code></a>, <a href="rg.html#_rg_services-api_manpage-WrapperFactory"><code>WrapperFactory</code></a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_more-advanced_decoupling_pushing-changes">6.1.5. Pushing Changes</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This technique is much less powerful than using <a href="#_ug_more-advanced_decoupling_event-bus">the event bus</a> .  We present it mostly for completeness.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_when_a_property_is_changed">When a property is changed</h5>
<div class="paragraph">
<p>If you want to invoke functionality whenever a property is changed by the user, then you should create a supporting <code>modifyXxx()</code> method and include the functionality within that. The syntax is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> modifyPropertyName(PropertyType param) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Why not just put this functionality in the setter? Well, the setter is used by the object store to recreate the state of an already persisted object. Putting additional behaviour in the setter would cause it to be triggered incorrectly.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Order</span>() {
    <span class="directive">public</span> <span class="predefined-type">Integer</span> getAmount() { ... }
    <span class="directive">public</span> <span class="type">void</span> setAmount(<span class="predefined-type">Integer</span> amount) { ... }
    <span class="directive">public</span> <span class="type">void</span> modifyAmount(<span class="predefined-type">Integer</span> amount) { <i class="conum" data-value="1"></i><b>(1)</b>
        setAmount(amount);  <i class="conum" data-value="3"></i><b>(3)</b>
        addToTotal(amount); <i class="conum" data-value="2"></i><b>(2)</b>
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>modifyAmount()</code> method calls &#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>&#8230;&#8203; the <code>addToTotal()</code> (not shown) to maintain some running total.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We don&#8217;t want this <code>addToCall()</code> method to be called when pulling the object back from the object store, so we put it into the modify, not the setter.</p>
</div>
<div class="paragraph">
<p>You may optionally also specify a <code>clearXxx()</code> which works the same way as modify <code>modify Xxx()</code> but is called when the property is cleared by the user (i.e. the current value replaced by nothing). The syntax is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> clearPropertyName() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>To extend the above example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Order</span>() {
    <span class="directive">public</span> <span class="predefined-type">Integer</span> getAmount() { ... }
    <span class="directive">public</span> <span class="type">void</span> setAmount(<span class="predefined-type">Integer</span> amount) { ... }
    <span class="directive">public</span> <span class="type">void</span> modifyAmount(<span class="predefined-type">Integer</span> amount) { ... }
    <span class="directive">public</span> <span class="type">void</span> clearAmount() {
        removeFromTotal(<span class="local-variable">this</span>.amount);
        setAmount(<span class="predefined-constant">null</span>);
    }
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_when_a_collection_is_modified">When a collection is modified</h5>
<div class="paragraph">
<p>A collection may have a corresponding <code>addToXxx()</code> and/or
<code>removeFromXxx()</code> method. If present, and direct manipulation of the
contents of the connection has not been disabled (see ?), then they will
be called (instead of adding/removing an object directly to the
collection returned by the accessor).</p>
</div>
<div class="paragraph">
<p>The reason for this behaviour is to allow other behaviour to be
triggered when the contents of the collection is altered. That is, it is
directly equivalent to the supporting <code>modifyXxx()</code> and <code>clearXxx()</code>
methods for properties (see ?).</p>
</div>
<div class="paragraph">
<p>The syntax is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> addTo&lt;CollectionName&gt;(EntityType param) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> removeFromCollectionName(EntityType param) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>EntityType</code> is the same type as the generic collection type.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> { ... }

<span class="directive">public</span> <span class="type">class</span> <span class="class">Department</span> {

    <span class="directive">private</span> <span class="type">int</span> numMaleEmployees;                           <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">private</span> <span class="type">int</span> numFemaleEmployees;                         <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="directive">private</span> <span class="predefined-type">Set</span>&lt;Employee&gt; employees = <span class="keyword">new</span> <span class="predefined-type">TreeSet</span>&lt;Employee&gt;();
    <span class="directive">public</span> <span class="predefined-type">Set</span>&lt;Employee&gt; getEmployees() {
        <span class="keyword">return</span> employees;
    }
    <span class="directive">private</span> <span class="type">void</span> setEmployees(<span class="predefined-type">Set</span>&lt;Employee&gt; employees) {
        <span class="local-variable">this</span>.employees = employees;
    }
    <span class="directive">public</span> <span class="type">void</span> addToEmployees(Employee employee) {         <i class="conum" data-value="3"></i><b>(3)</b>
        numMaleEmployees += countOneMale(employee);
        numFemaleEmployees += countOneFemale(employee);
        employees.add(employee);
    }
    <span class="directive">public</span> <span class="type">void</span> removeFromEmployees(Employee employee) {    <i class="conum" data-value="4"></i><b>(4)</b>
        numMaleEmployees -= countOneMale(employee);
        numFemaleEmployees -= countOneFemale(employee);
        employees.remove(employee);
    }
    <span class="directive">private</span> <span class="type">int</span> countOneMale(Employee employee) { <span class="keyword">return</span> employee.isMale()?<span class="integer">1</span>:<span class="integer">0</span>; }
    <span class="directive">private</span> <span class="type">int</span> countOneFemale(Employee employee) { <span class="keyword">return</span> employee.isFemale()?<span class="integer">1</span>:<span class="integer">0</span>; }

    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>maintain a count of the number of male &#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>&#8230;&#8203; and female employees (getters and setters omitted)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the <a href="rg.html#_rg_methods_prefixes_manpage-addTo"><code>addTo&#8230;&#8203;()</code></a> method increments the derived properties</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the <a href="rg.html#_rg_methods_prefixes_manpage-removeFrom"><code>removeFrom&#8230;&#8203;()</code></a> method similarly decrements the derived properties</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_more-advanced_overriding-jdo-annotations">6.2. Overriding JDO Annotations</h3>
<div class="paragraph">
<p>The JDO Objectstore (or rather, the underlying DataNucleus implementation) builds its own persistence metamodel by reading both annotations on the class and also by searching for metadata in XML files. The metadata in the XML files takes precedence over the annotations, and so can be used to override metadata that is "hard-coded" in annotations.</p>
</div>
<div class="paragraph">
<p>For example, as of 1.9.0-SNAPSHOT the various <a href="http://www.isisaddons.org">Isis addons</a> modules (not ASF) use schemas for each entity. For example, the <code>AuditEntry</code> entity in the <a href="http://github.com/isisaddons/isis-module-audit">audit module</a> is annotated as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.PersistenceCapable(
        identityType=IdentityType.DATASTORE,
        schema = <span class="string"><span class="delimiter">&quot;</span><span class="content">IsisAddonsAudit</span><span class="delimiter">&quot;</span></span>,
        table=<span class="string"><span class="delimiter">&quot;</span><span class="content">AuditEntry</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AuditEntry</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will map the <code>AuditEntry</code> class to a table <code>&quot;IsisAddonsAudit&quot;.&quot;AuditEntry&quot;</code>; that is using a custom schema to own the object.</p>
</div>
<div class="paragraph">
<p>Suppose though that for whatever reason we didn&#8217;t want to use a custom schema but would rather use the default. We can override the above annotation using a <code>package.jdo</code> file, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="tag">&lt;jdo</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/jdo/jdo</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/jdo/jdo</span>
        <span class="content">http://xmlns.jcp.org/xml/ns/jdo/jdo_3_0.xsd</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;package</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.isisaddons.module.audit.dom</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;class</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">AuditEntry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">schema</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PUBLIC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">table</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">IsisAddonsAuditEntry</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;/class&gt;</span>
    <span class="tag">&lt;/package&gt;</span>
<span class="tag">&lt;/jdo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This file should be placed can be placed in <code>src/main/java/META-INF</code> within your application&#8217;s <code>dom</code> module.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The same approach should work for any other JDO metadata, but some experimentation might be required.+</p>
<div class="paragraph">
<p>For example, in writing up the above example we found that writing <code>schema=&quot;&quot;</code> (in an attempt to say, "use the default schema for this table") actually caused the original annotation value to be used instead.</p>
</div>
</li>
<li>
<p>Forcing the schema to "PUBLIC" (as in the above example) works, but it isn&#8217;t ideal because the name "PUBLIC" is not vendor-neutral (it works for HSQLDB, but MS SQL Server uses "dbo" as its default).</p>
</li>
<li>
<p>As of 1.9.0-SNAPSHOT Apache Isis will automatically (attempt) to create the owning schema for a given table if it does not exist. This behaviour can be customized, as described in the section on <a href="#_ug_more-advanced_decoupling_db-schemas">using modules</a>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ug_more-advanced_bulk-actions">6.3. Bulk Actions</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_annotations_manpage-Action_invokeOn"><code>@Action#invokeOn()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ug_more-advanced_view-models">6.4. View Models</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_annotations_manpage-ViewModel"><code>@ViewModel</code></a>, <a href="rg.html#_rg_classes_super_manpage-AbstractViewModel"><code>AbstractViewModel</code></a>, <a href="rg.html#_rg_annotations_manpage-DomainObject_nature"><code>@DomainObject#nature()</code></a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Nature of view models</p>
</div>
<div class="ulist">
<ul>
<li>
<p>inmemory-entity</p>
</li>
<li>
<p>external_entity</p>
</li>
<li>
<p>application layer</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Consumers of view models</p>
</div>
<div class="ulist">
<ul>
<li>
<p>within the Wicket viewer</p>
</li>
<li>
<p>within the REST viewer, as an external client consuming a stable API</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An alternative to using view models is to map the domain object using the <a href="rg.html#_rg_services-spi_manpage-ContentMappingService"><code>ContentMappingService</code></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ug_more-advanced_mapping-rdbms-views">6.5. Mapping RDBMS Views</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - as used in <a href="http://github.com/estatio/estatio">Estatio</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ug_more-advanced_transactions-and-errors">6.6. Transactions and Errors</h3>
<div class="paragraph">
<p>In Apache Isis, every action invocation (in fact, every interaction) is automatically wrapped in a transaction, and any repository query automatically does a flush.</p>
</div>
<div class="paragraph">
<p>What that means is that there&#8217;s no need to explicitly start or commit transactions in Apache Isis; this will be done for you. Indeed, if you do try to manage transactions (eg by reaching into the JDO <code>PersistenceManager</code> exposed by the <a href="rg.html#_rg_services-api_manpage-IsisJdoSupport">IsisJdoSupport</a> domain service, then you are likely to confuse Isis and get a stack trace for your trouble.</p>
</div>
<div class="sect3">
<h4 id="_aborting_transactions">6.6.1. Aborting Transactions</h4>
<div class="paragraph">
<p>If you want to abort Apache Isis' transaction, this can be done by throwing <code>RecoverableException</code> (or any subclass, eg <code>ApplicationException</code>). The transaction will be aborted, and the exception message will be displayed to the user.</p>
</div>
<div class="paragraph">
<p>If you throw any other exception (ie not a subclass of <code>RecoverableException</code>), then the users will see an error page (if Wicket viewer) or a 500 (if Restful Objects viewer).</p>
</div>
</div>
<div class="sect3">
<h4 id="_raise_message_errors_to_users">6.6.2. Raise message/errors to users</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_services-api_manpage-DomainObjectContainer_messages-api"><code>DomainObjectContainer</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_exception_recognizers">6.6.3. Exception Recognizers</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_services-spi_manpage-ExceptionRecognizer"><code>ExceptionRecognizer</code></a> service
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_more-advanced_i18n">6.7. i18n</h3>
<div class="paragraph">
<p>Apache Isis' support for i18n allows every element of the domain model (the class names, property names, action names, parameter names and so forth) to be translated.</p>
</div>
<div class="paragraph">
<p>It also supports translations of messages raised imperatively, by which we mean as the result of a call to <code>title()</code> to obtain an object&#8217;s title, or messages messages resulting from any business rule violations (eg <code>disableXxx()</code> or <code>validateXxx()</code>, and so on.</p>
</div>
<div class="paragraph">
<p>Isis does not translate the values of your domain objects, though.  So, if you have a domain concept such as <code>Country</code> whose name is intended to be localized according to the current user, you will need to model</p>
</div>
<div class="sect3">
<h4 id="_implementation_approach">6.7.1. Implementation Approach</h4>
<div class="paragraph">
<p>Most Java frameworks tackle i18n by using Java&#8217;s own <code>ResourceBundle</code> API.  However, there are some serious drawbacks in this approach, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if a string appears more than once (eg "name" or "description") then it must be translated everywhere it appears in every resource bundle file</p>
</li>
<li>
<p>there is no support for plural forms (see this <a href="http://stackoverflow.com/questions/14326653/java-internationalization-i18n-with-proper-plurals/14327683#14327683">SO answer</a>)</p>
</li>
<li>
<p>there is no tooling support for translators</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Apache Isis therefore takes a different approach, drawing inspiration from GNU&#8217;s <a href="https://www.gnu.org/software/gettext/manual/index.html">gettext</a> API and specifically its <code>.pot</code> and <code>.po</code> files.  These are intended to be used as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>.pot</code> (portable object template) file holds the message text to be translated</p>
</li>
<li>
<p>this file is translated into multiple <code>.po</code> (portable object) files, one per supported locale</p>
</li>
<li>
<p>these <code>.po</code> files are renamed according to their locale, and placed into the 'appropriate' location to be picked up by the runtime.  The name of each <code>.po</code> resolved in a very similar way to resource bundles.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>.pot</code> and <code>.po</code> files is identical; the only difference is that the <code>.po</code> file has translations for each of the message strings.   These message strings can also have singular and plural forms.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Although Apache Isis' implementation is modelled after GNU&#8217;s API, it does <em>not</em> use any GNU software.  This is for two reasons: (a) to simplify the toolchain/developer experience, and (b) because GNU software is usually GPL, which would be incompatible with the Apache license).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This design tackles all the issues of <code>ResourceBundle</code>s:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>.po</code> message format is such that any given message text to translate need only be translated once, even if it appears in multiple places in the application (eg "Name")</p>
</li>
<li>
<p>the <code>.po</code> message format includes translations for (optional) plural form as well as singular form</p>
</li>
<li>
<p>there are lots of freely available editors <a href="https://www.google.co.uk/search?q=.po+file+editor">to be found</a>, many summarized on this <a href="https://www.drupal.org/node/11131">Drupal.org</a> webpage.<br></p>
<div class="paragraph">
<p>In fact, there are also online communities/platforms of translators to assist with translating files. One such is <a href="https://crowdin.com/">crowdin</a> (nb: this link does not imply endorsement).</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In Apache Isis' implementation, if the translation is missing from the <code>.po</code> file then the original message text from the <code>.pot</code> file will be returned.  In fact, it isn&#8217;t even necessary for there to be any <code>.po</code> files; <code>.po</code> translations can be added piecemeal as the need arises.</p>
</div>
</div>
<div class="sect3">
<h4 id="__code_translationservice_code">6.7.2. <code>TranslationService</code></h4>
<div class="paragraph">
<p>The cornerstone of Apache Isis' support for i18n is the <code>TranslationService</code> service. This is defined in the applib with the following API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">TranslationService</span> {
    <span class="directive">public</span> <span class="predefined-type">String</span> translate(      <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="directive">final</span> <span class="predefined-type">String</span> context,
            <span class="directive">final</span> <span class="predefined-type">String</span> text);
    <span class="directive">public</span> <span class="predefined-type">String</span> translate(      <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="directive">final</span> <span class="predefined-type">String</span> context,
            <span class="directive">final</span> <span class="predefined-type">String</span> singularText,
            <span class="directive">final</span> <span class="predefined-type">String</span> pluralText,
            <span class="directive">final</span> <span class="type">int</span> num);
    <span class="directive">public</span> <span class="type">enum</span> Mode {
        READ,
        WRITE;
    }
    Mode getMode();               <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>is to translate the singular form of the text</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>is to translate the plural form of the text</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>indicates whether the translation service is in read or write mode.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>translate(&#8230;&#8203;)</code> methods are closely modelled on GNU&#8217;s gettext API.  The first version is used when no translation is required, the second is when both a singular and plural form will be required, with the <code>num</code> parameter being used to select which is returned.  In both cases the <code>context</code> parameter provides some contextual information for the translator; this generally corresponds to the class member.</p>
</div>
<div class="paragraph">
<p>The mode meanwhile determines the behaviour of the service.  More on this below.</p>
</div>
<div class="sect4">
<h5 id="__code_translationservicepo_code"><code>TranslationServicePo</code></h5>
<div class="paragraph">
<p>Isis provides a default implementation of <code>TranslationService</code>, namely <code>TranslationServicePo</code>.</p>
</div>
<div class="paragraph">
<p>If the service is running in the normal read mode, then it simply provides translations for the locale of the current user.  This means locates the appropriate <code>.po</code> file (based on the requesting user&#8217;s locale), finds the translation and returns it.</p>
</div>
<div class="paragraph">
<p>If however the service is configured to run in write mode, then it instead records the fact that the message was requested to be translated (a little like a spy/mock in unit testing mock), and returns the original message. The service can then be queried to discover which messages need to be translated.  All requested translations are written into the <code>.pot</code> file.</p>
</div>
<div class="paragraph">
<p>To make the service as convenient as possible to use, the service configures itself as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if running in prototype mode <a href="rg.html#_rg_runtime_deployment-types">deployment type</a> or during integration tests, then the service runs in <strong>write</strong> mode, in which case it records all translations into the <code>.pot</code> file.  The <code>.pot</code> file is written out when the system is shutdown.</p>
</li>
<li>
<p>if running in server (production) mode <a href="rg.html#_rg_runtime_deployment-types">deployment type</a>, then the service runs in <strong>read</strong> mode. It is also possible to set a configuration setting in <code>isis.properties</code> to force read mode even if running in prototype mode (useful to manually test/demo the translations).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When running in write mode the original text is returned to the caller untranslated. If in read mode, then the translated <code>.po</code> files are read and translations provided as required.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_imperative_messages">6.7.3. Imperative messages</h4>
<div class="paragraph">
<p>The <code>TranslationService</code> is used internally by Apache Isis when building up the metamodel; the name and description of every class, property, collection, action and action parameter is automatically translated.  Thus the simple act of bootstrapping Apache Isis will cause most of the messages requiring translation (that is: those for the Apache Isis metamodel) to be captured by the <code>TranslationService</code>.</p>
</div>
<div class="paragraph">
<p>However, for an application to be fully internationalized, any validation messages (from either <code>disableXxx()</code> or <code>validateXxx()</code> supporting methods) and also possibly an object&#8217;s title (from the <code>title()</code> method) will also require translation. Moreover, these messages must be captured in the <code>.pot</code> file such that they can be translated.</p>
</div>
<div class="sect4">
<h5 id="__code_translatablestring_code"><code>TranslatableString</code></h5>
<div class="paragraph">
<p>The first part of the puzzle is tackled by an extension to Apache Isis' programming model.  Whereas previously the <code>disableXxx()</code> / <code>validateXxx()</code> / <code>title()</code> methods could only return a <code>java.lang.String</code>, they may now optionally return a <code>TranslatableString</code> (defined in Isis applib) instead.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a (silly) example from the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> TranslatableString validateUpdateName(<span class="directive">final</span> <span class="predefined-type">String</span> name) {
    <span class="keyword">return</span> name.contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">!</span><span class="delimiter">&quot;</span></span>)? TranslatableString.tr(<span class="string"><span class="delimiter">&quot;</span><span class="content">Exclamation mark is not allowed</span><span class="delimiter">&quot;</span></span>): <span class="predefined-constant">null</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This corresponds to the following entry in the <code>.pot</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">#: dom.simple.SimpleObject#updateName()
msgid &quot;Exclamation mark is not allowed&quot;
msgstr &quot;&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The full API of <code>TranslatableString</code> is modelled on the design of GNU gettext (in particular the <a href="https://code.google.com/p/gettext-commons/wiki/Tutorial">gettext-commons</a> library):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">TranslatableString</span> {
    <span class="directive">public</span> <span class="directive">static</span> TranslatableString tr(       <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="directive">final</span> <span class="predefined-type">String</span> pattern,
            <span class="directive">final</span> <span class="predefined-type">Object</span>... paramArgs) { ... }
    <span class="directive">public</span> <span class="directive">static</span> TranslatableString trn(      <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="directive">final</span> <span class="predefined-type">String</span> singularPattern,
            <span class="directive">final</span> <span class="predefined-type">String</span> pluralPattern,
            <span class="directive">final</span> <span class="type">int</span> number,
            <span class="directive">final</span> <span class="predefined-type">Object</span>... paramArgs) { ... }
    <span class="directive">public</span> <span class="predefined-type">String</span> translate(                   <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="directive">final</span> TranslationService translationService,
            <span class="directive">final</span> <span class="predefined-type">String</span> context) { ... }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>returns a translatable string with a single pattern for both singular and plural forms.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>returns a translatable string with different patterns for singular and plural forms; the one to use is determined by the 'number' argument</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>translates the string using the provided <code>TranslationService</code>, using the appropriate singular/regular or plural form, and interpolating any arguments.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The interpolation uses the format <code>{xxx}</code>, where the placeholder can occur multiple times.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> TranslatableString ts = TranslatableString.tr(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">My name is {lastName}, {firstName} {lastName}.</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bond</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">James</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>would interpolate (for the English locale) as "My name is Bond, James Bond".</p>
</div>
<div class="paragraph">
<p>For a German user, on the other hand, if the translation in the corresponding <code>.po</code> file was:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">#: xxx.yyy.Whatever#context()
msgid &quot;My name is {lastName}, {firstName} {lastName}.&quot;
msgstr &quot;Iche heisse {firstName} {lastName}.&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>then the translation would be: "Ich heisse James Bond".</p>
</div>
<div class="paragraph">
<p>The same class is used in <a href="rg.html#_rg_services-api_manpage-DomainObjectContainer"><code>DomainObjectContainer</code></a> so that you can raise translatable info, warning and error messages; each of the relevant methods are overloaded.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">DomainObjectContainer</span> {
    <span class="type">void</span> informUser(<span class="predefined-type">String</span> message);
    <span class="type">void</span> informUser(
        TranslatableMessage message,
        <span class="directive">final</span> <span class="predefined-type">Class</span>&lt;?&gt; contextClass, <span class="directive">final</span> <span class="predefined-type">String</span> contextMethod); <i class="conum" data-value="1"></i><b>(1)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>are concatenated together to form the context for the <code>.pot</code> file.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="__code_translatableexception_code"><code>TranslatableException</code></h5>
<div class="paragraph">
<p>Another mechanism by which messages can be rendered to the user are as the result of exception messages thrown and recognized by an <a href="rg.html#_rg_services-spi_manpage-ExceptionRecognizer"><code>ExceptionRecognizer</code></a>.</p>
</div>
<div class="paragraph">
<p>In this case, if the exception implements <code>TranslatableException</code>, then the message will automatically be translated before being rendered.  The <code>TranslatableException</code> itself takes the form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">TranslatableException</span> {
    TranslatableString getTranslatableMessage(); <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="predefined-type">String</span> getTranslationContext();              <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the message to translate.  If returns <code>null</code>, then the <code>Exception#getMessage()</code> is used as a fallback</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the context to use when translating the message</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_integration_testing_2">6.7.4. Integration Testing</h4>
<div class="paragraph">
<p>So much for the API; but as noted, it is also necessary to ensure that the required translations are recorded (by the <code>TranslationService</code>) into the <code>.pot</code> file.</p>
</div>
<div class="paragraph">
<p>For this, we recommend that you ensure that all such methods are tested through an <a href="#_ug_testing_integ-test-support">integration test</a> (not unit test).</p>
</div>
<div class="paragraph">
<p>For example, here&#8217;s the corresponding integration test for the "Exclamation mark" example from the simpleapp (above):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Rule</span>
<span class="directive">public</span> ExpectedException expectedException = ExpectedException.none();

<span class="annotation">@Inject</span>
FixtureScripts fixtureScripts;

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> failsValidation() <span class="directive">throws</span> <span class="exception">Exception</span> {
    <span class="comment">// given</span>
    RecreateSimpleObjects fs = <span class="keyword">new</span> RecreateSimpleObjects().setNumber(<span class="integer">1</span>);
    fixtureScripts.runFixtureScript(fs, <span class="predefined-constant">null</span>);
    SimpleObject simpleObjectWrapped = wrap(fs.getSimpleObjects().get(<span class="integer">0</span>));

    <span class="comment">// expect</span>
    expectedExceptions.expect(InvalidException.class);
    expectedExceptions.expectMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Exclamation mark is not allowed</span><span class="delimiter">&quot;</span></span>);

    <span class="comment">// when</span>
    simpleObjectWrapped.updateName(<span class="string"><span class="delimiter">&quot;</span><span class="content">new name!</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Running this test will result in the framework calling the <code>validateUpdateName(&#8230;&#8203;)</code> method, and thus to record that a translation is required in the <code>.pot</code> file.</p>
</div>
<div class="paragraph">
<p>When the integration tests are complete (that is, when Apache Isis is shutdown), the <code>TranslationServicePo</code> will write out all captured translations to its log (more on this below). This will include all the translations captured from the Apache Isis metamodel, along with all translations as exercised by the integration tests.</p>
</div>
<div class="paragraph">
<p>To ensure your app is fully internationalized app, you must therefore:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>use <code>TranslatableString</code> rather than <code>String</code> for all validation/disable and title methods.</p>
</li>
<li>
<p>ensure that (at a minimum) all validation messages and title methods are integration tested.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We make no apologies for this requirement: one of the reasons that we decided to implement Apache Isis' i18n support in this way is because it encourages/requires the app to be properly tested.</p>
</div>
<div class="paragraph">
<p>Behind the scenes Apache Isis uses a JUnit rule (<code>ExceptionRecognizerTranslate</code>) to intercept any exceptions that are thrown.  These are simply passed through to the registered <a href="rg.html#_rg_services-spi_manpage-ExceptionRecognizer"><code>ExceptionRecognizer</code></a>s so that any messages are recorded as requiring translation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_configuration">6.7.5. Configuration</h4>
<div class="paragraph">
<p>There are several different aspects of the translation service that can be configured.</p>
</div>
<div class="sect4">
<h5 id="_logging">Logging</h5>
<div class="paragraph">
<p>To configure the <code>TranslationServicePo</code> to write to out the <code>translations.pot</code> file, add the following to the <em>integtests</em> <code>logging.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">log4j.appender.translations-po=org.apache.log4j.FileAppender
log4j.appender.translations-po.File=./translations.pot
log4j.appender.translations-po.Append=false
log4j.appender.translations-po.layout=org.apache.log4j.PatternLayout
log4j.appender.translations-po.layout.ConversionPattern=%m%n

log4j.logger.org.apache.isis.core.runtime.services.i18n.po.PoWriter=INFO,translations-po
log4j.additivity.org.apache.isis.core.runtime.services.i18n.po.PotWriter=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just to repeat, this is <em>not</em> the <code>WEB-INF/logging.properties</code> file, it should instead be added to the <code>integtests/logging.properties</code> file.</p>
</div>
</div>
<div class="sect4">
<h5 id="_location_of_the_code_po_code_files">Location of the <code>.po</code> files</h5>
<div class="paragraph">
<p>The default location of the translated <code>.po</code> files is in the <code>WEB-INF</code> directory. These are named and searched for similarly to regular Java resource bundles.</p>
</div>
<div class="paragraph">
<p>For example, assuming these translations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">/WEB-INF/translations-en-US.po
        /translations-en.po
        /translations-fr-FR.po
        /translations.po</code></pre>
</div>
</div>
<div class="paragraph">
<p>then:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a user with <code>en-US</code> locale will use <code>translations-en-US.po</code></p>
</li>
<li>
<p>a user with <code>en-GB</code> locale will use <code>translations-en.po</code></p>
</li>
<li>
<p>a user with <code>fr-FR</code> locale will use <code>translations-fr-FR.po</code></p>
</li>
<li>
<p>a user with <code>fr-CA</code> locale will use <code>translations.po</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The basename for translation files is always <code>translations</code>; this cannot be altered.</p>
</div>
</div>
<div class="sect4">
<h5 id="_externalized_translation_files">Externalized translation files</h5>
<div class="paragraph">
<p>Normally Apache Isis configuration files are read from the <code>WEB-INF</code> file. However, Apache Isis can be configured to read config files from an <a href="#_ug_deployment_externalized-configuration">external directory</a>; this is also supported for translations.</p>
</div>
<div class="paragraph">
<p>Thus, if in <code>web.xml</code> the external configuration directory has been set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>isis.config.dir<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>location of external config directory<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then this directory will be used as the base for searching for translations (rather than the default 'WEB-INF/' directory).</p>
</div>
</div>
<div class="sect4">
<h5 id="_force_read_mode">Force read mode</h5>
<div class="paragraph">
<p>As noted above, if running in prototype mode then <code>TranslationServicePo</code> will be in write mode, if in production mode then will be in read mode. To force read mode (ie use translations) even if in prototype mode, add the following configuration property to <code>isis.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services.translation.po.mode=read</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_supporting_services">6.7.6. Supporting services</h4>
<div class="paragraph">
<p>The <code>TranslationServicePo</code> has a number of supporting/related services.</p>
</div>
<div class="sect4">
<h5 id="__code_localeprovider_code"><code>LocaleProvider</code></h5>
<div class="paragraph">
<p>The <code>LocaleProvider</code> API is used by the <code>TranslationServicePo</code> implementation to obtain the locale of the "current user".</p>
</div>
<div class="paragraph">
<p>A default implementation is provided by the Wicket viewer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that this default implementation does not support requests made through the Restful Objects viewer (there is no Wicket 'application' object available); the upshot is that requests through Restful Objects are never translated. Registering a different implementation of <code>LocaleProvider</code> that taps into appropriate REST (RestEasy?) APIs would be the way to address this.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="__code_translationsresolver_code"><code>TranslationsResolver</code></h5>
<div class="paragraph">
<p>The <code>TranslationResolver</code> is used by the <code>TranslationService</code> implementation to lookup translations for a specified locale. It is this service that reads from the <code>WEB-INF/</code> (or externalized directory).</p>
</div>
</div>
<div class="sect4">
<h5 id="__code_translationservicepomenu_code"><code>TranslationServicePoMenu</code></h5>
<div class="paragraph">
<p>The <code>TranslationServicePoMenu</code> provides a couple of menu actions in the UI (prototype mode only) that interacts with the underlying <code>TranslationServicePo</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>downloadTranslationsFile()</code> action - available only in write mode - allows the current <code>.pot</code> file to be downloaded.<br></p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While this will contain all the translations from the metamodel, it will not necessarily contain all translations for all imperative methods returning <code>TranslatableString</code> instances; which are present and which are missing will depend on which imperative methods have been called (recorded by the service) prior to downloading.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>the <code>clearTranslationsCache()</code> action - available only in read mode - will clear the cache so that new translations can be loaded.<br></p>
<div class="paragraph">
<p>This allows a translator to edit the appropriate <code>translations-xx-XX.po</code> file and check the translation is correct without having to restart the app.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_more-advanced_multi-tenancy">6.8. Multi-tenancy</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - as supported by (non-ASF) <a href="http://github.com/isisaddons/isis-module-security">Isis addons' security</a> module.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ug_more-advanced_persistence-lifecycle">6.9. Persistence Lifecycle</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ug_more-advanced_tips-n-tricks">6.10. Tips n Tricks</h3>
<div class="paragraph">
<p>This section catalogues a miscellaneous collection of hints-and-tips.</p>
</div>
<div class="sect3">
<h4 id="_ug_more-advanced_tips-n-tricks_are-you-sure">6.10.1. 'Are you sure?' idiom</h4>
<div class="paragraph">
<p>If providing an action that will perform irreversible changes, include a
mandatory boolean parameter that must be explicitly checked by the end-user
in order for the action to proceed.</p>
</div>
<div class="sect4">
<h5 id="_screenshots">Screenshots</h5>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images//how-tos/tips-n-tricks/are-you-sure.png" alt="are you sure">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that these screenshots shows an earlier version of the <a href="#_ug_wicket-viewer">Wicket viewer</a> UI (specifically, pre 1.8.0).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the user checks the box:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images//how-tos/tips-n-tricks/are-you-sure-happy-case.png" alt="are you sure happy case">
</div>
</div>
<div class="paragraph">
<p>then the action will complete.</p>
</div>
<div class="paragraph">
<p>However, if the user fails to check the box, then a validation message is shown:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images//how-tos/tips-n-tricks/are-you-sure-sad-case.png" alt="are you sure sad case">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_code_example">Code example</h5>
<div class="paragraph">
<p>The code for this is pretty simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">List</span>&lt;ToDoItem&gt; delete(<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Are you sure?</span><span class="delimiter">&quot;</span></span>) <span class="type">boolean</span> areYouSure) {
    container.removeIfNotAlready(<span class="local-variable">this</span>);
    container.informUser(<span class="string"><span class="delimiter">&quot;</span><span class="content">Deleted </span><span class="delimiter">&quot;</span></span> + container.titleOf(<span class="local-variable">this</span>));
    <span class="keyword">return</span> toDoItems.notYetComplete();          <i class="conum" data-value="1"></i><b>(1)</b>
}
<span class="directive">public</span> <span class="predefined-type">String</span> validateDelete(<span class="type">boolean</span> areYouSure) {
    <span class="keyword">return</span> areYouSure? <span class="predefined-constant">null</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Please confirm you are sure</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>invalid to return <code>this</code> (cannot render a deleted object)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that the action itself does not use the boolean parameter, it is only
used by the supporting <a href="rg.html#_rg_methods_prefixes_manpage-validate"><code>validate&#8230;&#8203;()</code></a> method.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_more-advanced_tips-n-tricks_simulating-collections-of-values">6.10.2. Collections of values</h4>
<div class="paragraph">
<p>Although in Apache Isis you can have properties of either values (string, number, date etc) or of (references to other) entities, with collections the framework (currently) only supports collections of (references to) entities.  That is, collections of values (a bag of numbers, say) are not supported.</p>
</div>
<div class="paragraph">
<p>However, it is possible to simulate a bag of numbers using view models.</p>
</div>
<div class="sect4">
<h5 id="_view_model">View Model</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_persistence_concerns">Persistence Concerns</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO -  easiest to simply store using DataNucleus' support for collections, marked as <a href="rg.html#_rg_annotations_manpage-Programmatic"><code>@Programmatic</code></a> so that it is ignored by Apache Isis.  Alternatively can store as json/xml in a varchar(4000) or clob and manually unpack.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_more-advanced_tips-n-tricks_render-all-properties-in-tables">6.10.3. Subclass properties in tables</h4>
<div class="paragraph">
<p>Suppose you have a hierarchy of classes where a property is derived and abstract in the superclass, concrete implementations in the subclasses. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">LeaseTerm</span> {
    <span class="directive">public</span> <span class="directive">abstract</span> <span class="predefined-type">BigDecimal</span> getEffectiveValue();
    ...
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">LeaseTermForIndexableTerm</span> <span class="directive">extends</span> LeaseTerm {
    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> getEffectveValue() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Currently the Wicket viewer will not render the property in tables (though the property is correctly rendered in views).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more background on this workaround, see <a href="https://issues.apache.org/jira/browse/ISIS-582">ISIS-582</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The work-around is simple enough; make the method concrete in the superclass and return a dummy implementation, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">LeaseTerm</span> {
    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> getEffectiveValue() {
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;        <span class="comment">// workaround for ISIS-582</span>
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively the implementation could throw a <code>RuntimeException</code>, eg</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">never called; workaround for ISIS-582</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_more-advanced_tips-n-tricks_per-user-themes">6.10.4. Per-user Themes</h4>
<div class="paragraph">
<p>From the Apache Isis mailing list is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Is it possible to have each of our resellers (using our Isis application) use there own theme/branding with their own logo and colors? Would this also be possible for the login page, possibly depending on the used host name?</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Yes, you can do this, by installing a custom implementation of the Wicket Bootstrap&#8217;s <code>ActiveThemeProvider</code>.</p>
</div>
<div class="paragraph">
<p>The <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a> (non-ASF) actually <a href="https://github.com/isisaddons/isis-app-todoapp/tree/61b8114a8e01dbb3c380b31cf09eaed456407570">does this</a>, storing the info via the <a href="http://github.com/isisaddons/isis-module-settings">Isis addons' settings module</a> settings modules:</p>
</div>
<div class="listingblock">
<div class="title">IActiveThemeProvider implementation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">UserSettingsThemeProvider</span> <span class="directive">implements</span> ActiveThemeProvider {
    ...
    <span class="annotation">@Override</span>
    <span class="directive">public</span> ITheme getActiveTheme() {
        <span class="keyword">if</span>(IsisContext.getSpecificationLoader().isInitialized()) {
            <span class="directive">final</span> <span class="predefined-type">String</span> themeName = IsisContext.doInSession(<span class="keyword">new</span> <span class="predefined-type">Callable</span>&lt;<span class="predefined-type">String</span>&gt;() {
                <span class="annotation">@Override</span>
                <span class="directive">public</span> <span class="predefined-type">String</span> call() <span class="directive">throws</span> <span class="exception">Exception</span> {
                    <span class="directive">final</span> <span class="predefined-type">Class</span>&lt;UserSettingsService&gt; serviceClass = UserSettingsService.class;
                    <span class="directive">final</span> UserSettingsService userSettingsService = lookupService(serviceClass);
                    <span class="directive">final</span> UserSetting activeTheme = userSettingsService.find(
                            IsisContext.getAuthenticationSession().getUserName(), ACTIVE_THEME);
                    <span class="keyword">return</span> activeTheme != <span class="predefined-constant">null</span> ? activeTheme.valueAsString() : <span class="predefined-constant">null</span>;
                }
            });
            <span class="keyword">return</span> themeFor(themeName);
        }
        <span class="keyword">return</span> <span class="keyword">new</span> SessionThemeProvider().getActiveTheme();
    }
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> setActiveTheme(<span class="directive">final</span> <span class="predefined-type">String</span> themeName) {
        IsisContext.doInSession(<span class="keyword">new</span> <span class="predefined-type">Runnable</span>() {
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> run() {
                <span class="directive">final</span> <span class="predefined-type">String</span> currentUsrName = IsisContext.getAuthenticationSession().getUserName();
                <span class="directive">final</span> UserSettingsServiceRW userSettingsService =
                        lookupService(UserSettingsServiceRW.class);
                <span class="directive">final</span> UserSettingJdo activeTheme =
                        (UserSettingJdo) userSettingsService.find(currentUsrName, ACTIVE_THEME);
                <span class="keyword">if</span>(activeTheme != <span class="predefined-constant">null</span>) {
                    activeTheme.updateAsString(themeName);
                } <span class="keyword">else</span> {
                    userSettingsService.newString(
                        currentUsrName, ACTIVE_THEME, <span class="string"><span class="delimiter">&quot;</span><span class="content">Active Bootstrap theme for user</span><span class="delimiter">&quot;</span></span>, themeName);
                }
            }
        });
    }
    <span class="directive">private</span> ITheme themeFor(<span class="directive">final</span> <span class="predefined-type">String</span> themeName) {
        <span class="directive">final</span> ThemeProvider themeProvider = settings.getThemeProvider();
        <span class="keyword">if</span>(themeName != <span class="predefined-constant">null</span>) {
            <span class="keyword">for</span> (<span class="directive">final</span> ITheme theme : themeProvider.available()) {
                <span class="keyword">if</span> (themeName.equals(theme.name()))
                    <span class="keyword">return</span> theme;
            }
        }
        <span class="keyword">return</span> themeProvider.defaultTheme();
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="title">Using the ActiveThemeProvider</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">protected</span> <span class="type">void</span> init() {
    <span class="local-variable">super</span>.init();

    <span class="directive">final</span> IBootstrapSettings settings = Bootstrap.getSettings();
    settings.setThemeProvider(<span class="keyword">new</span> BootswatchThemeProvider(BootswatchTheme.Flatly));

    settings.setActiveThemeProvider(<span class="keyword">new</span> UserSettingsThemeProvider(settings));
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_more-advanced_tips-n-tricks_enhance-only">6.10.5. Enhance only (IntelliJ)</h4>
<div class="paragraph">
<p>From the Apache Isis mailing list is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Is there a simple way to make a run configuration in IntelliJ for running the datanucleus enhancer before running integration test?</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Yes, you can; here&#8217;s one way:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Duplicate your run configuration for running the webapp</p>
<div class="ulist">
<ul>
<li>
<p>the one where the main class is <code>org.apache.isis.WebServer</code></p>
</li>
<li>
<p>there&#8217;s a button for this on the run configurations dialog.</p>
</li>
</ul>
</div>
</li>
<li>
<p>then, on your copy change the main class to <code>org.apache.isis.Dummy</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ug_wicket-viewer">7. Wicket Viewer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes end-user features, configuration and customization of the Wicket viewer.</p>
</div>
<div class="paragraph">
<p>Note that extending the Wicket viewer is described in the <a href="#_ug_extending">Extending</a> chapter.</p>
</div>
<div class="sect2">
<h3 id="_ug_wicket-viewer_features">7.1. Features/end-user usage</h3>
<div class="paragraph">
<p>This section discusses features of the wicket viewer from the perspective of an end-user actually using your Isis application.</p>
</div>
<div class="sect3">
<h4 id="_ug_wicket-viewer_features_recent-pages">7.1.1. Recent pages (drop down)</h4>
<div class="paragraph">
<p>The Wicket viewer provides a recent pages drop-down that acts as a breadcrumb trail. Using it, the user can quickly open a recently accessed domain object.</p>
</div>
<div class="sect4">
<h5 id="_screenshots_2">Screenshots</h5>
<div class="paragraph">
<p>The following screenshot, taken from the <a href="https://github.com/estatio/estatio">Estatio</a> application, shows the recent pages drop-down after a number of pages have been accessed.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/recent-pages/recent-pages.png"><img src="images/wicket-viewer/recent-pages/recent-pages.png" alt="recent pages" width="800px"></a>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that this screenshot show an earlier version of the <a href="#_ug_wicket-viewer">Wicket viewer</a> UI (specifically, pre 1.8.0).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_domain_code">Domain Code</h5>
<div class="paragraph">
<p>The recent pages drop-down is automatically populated; no changes need to be made to the domain classes.</p>
</div>
</div>
<div class="sect4">
<h5 id="_user_experience">User Experience</h5>
<div class="paragraph">
<p>Selecting the domain object from the list causes the viewer to automatically navigate to the page for the selected object.</p>
</div>
</div>
<div class="sect4">
<h5 id="_related_functionality">Related functionality</h5>
<div class="paragraph">
<p>The <a href="#_ug_wicket-viewer_features_bookmarked-pages">bookmarked pages</a> (sliding panel) also provides links to recently visited objects, but only those explicitly marked as <code>@DomainObject(bookmarking=&#8230;&#8203;)</code>.  The bookmarks panel also nests related objects together hierarchically (the recent pages drop-down does not).</p>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_2">Configuration</h5>
<div class="paragraph">
<p>The number of objects is hard-coded as 10; it cannot currently be configured.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_wicket-viewer_features_bookmarked-pages">7.1.2. Bookmarked pages</h4>
<div class="paragraph">
<p>The Wicket viewer supports the bookmarking of both domain objects and query-only (<a href="rg.html#_rg_annotations_manpage-Action_semantics">@Action(semantics=&#8230;&#8203;)</a>) actions.</p>
</div>
<div class="paragraph">
<p>Domain objects, if bookmarkable, can be nested.</p>
</div>
<div class="paragraph">
<p>Bookmarking is automatic; whenever a bookmarkable object/action is visited, then a bookmark is created. To avoid the number of bookmarks from indefinitely growing, bookmarks that have not been followed after a whle are automatically removed (an MRU/LRU algorithm). The number of bookmarks to preserve can be configured.</p>
</div>
<div class="sect4">
<h5 id="_screenshots_3">Screenshots</h5>
<div class="paragraph">
<p>The following screenshot, taken from <a href="https://github.com/isisaddons/isis-app-todoapp">Isisaddons example todoapp</a> (not ASF) shows how the bookmarks are listed in a sliding panel.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/bookmarked-pages/panel.png"><img src="images/wicket-viewer/bookmarked-pages/panel.png" alt="panel" width="800px"></a>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that these screenshots show an earlier version of the <a href="#_ug_wicket-viewer">Wicket viewer</a> UI (specifically, pre 1.8.0).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note how the list contains both domain objects and an action ("not yet complete").</p>
</div>
<div class="paragraph">
<p>Bookmarks can also form a hierarchy.  The following screenshot, also taken from the <a href="https://github.com/estatio/estatio">Estatio</a> application, shows a variety of different bookmarked objects with a nested structure:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/bookmarked-pages/panel-estatio.png"><img src="images/wicket-viewer/bookmarked-pages/panel-estatio.png" alt="panel estatio" width="800px"></a>
</div>
</div>
<div class="paragraph">
<p>Some - like <code>Property</code>, <code>Lease</code> and <code>Party</code> - are root nodes. However, <code>LeaseItem</code> is bookmarkable as a child of <code>Lease</code>, and <code>LeaseTerm</code> is bookmarkable only as a child of <code>LeaseItem</code>. This parent/child relationship is reflected in the layout.</p>
</div>
</div>
<div class="sect4">
<h5 id="_domain_code_2">Domain Code</h5>
<div class="paragraph">
<p>To indicate a class is bookmarkable, use the <a href="rg.html#_rg_annotations_manpage-DomainObjectLayout">@DomainObjectLayout</a> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObjectLayout</span>(
    bookmarking=BookmarkPolicy.AS_ROOT
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Lease</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>To indicate a class is bookmarkable but only as a child of some parent bookmark, specify the bookmark policy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainObjectLayout</span>(
    bookmarking=BookmarkPolicy.AS_CHILD
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">LeaseItem</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>To indicate that a safe (query only) action is bookmarkable, use the <a href="rg.html#_rg_annotations_manpage-ActionLayout">@ActionLayout</a> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> ... {
    ...
    <span class="annotation">@ActionLayout</span>(
         bookmarking=BookmarkPolicy.AS_ROOT
     )
    <span class="annotation">@ActionSemantics</span>(Of.SAFE)
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;ToDoItem&gt; notYetComplete() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The BookmarkPolicy.AS_CHILD does not have a meaning for actions; if the <code>bookmarking</code> attribute is set to any other value, it will be ignored.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_user_experience_2">User Experience</h5>
<div class="paragraph">
<p>The sliding panel appears whenever the mouse pointer hovers over the thin blue tab (to the left of the top header region).</p>
</div>
<div class="paragraph">
<p>Alternatively, <code>alt+[</code> will toggle open/close the panel; it can also be closed using <code>Esc</code> key.</p>
</div>
<div class="sect5">
<h6 id="_related_functionality_2">Related functionality</h6>
<div class="paragraph">
<p>The <a href="#_ug_wicket-viewer_features_recent-pages">Recent Pages</a> also lists recently visited pages, selected from a drop-down.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_3">Configuration</h5>
<div class="paragraph">
<p>By default, the bookmarked pages panel will show a maximum of 15 'root' pages. This can be overridden using a property (in <code>isis.properties</code>), for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.viewer.wicket.bookmarkedPages.maxSize=20</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_wicket-viewer_features_hints-and-copy-url">7.1.3. Hints and copy URL</h4>
<div class="paragraph">
<p>While the user can often copy the URL of a domain object directly from the browser&#8217;s address bar, the Wicket viewer also allows the URL of domain objects to be easily copied from a dialog.</p>
</div>
<div class="paragraph">
<p>More interestingly, this URL can also contain hints capturing any sorting or page numbering, or hiding/viewing of collections.  End-users can therefore share these URLs as a form of deep linking into a particular view on a domain object.</p>
</div>
<div class="paragraph">
<p>The copy URL and hinting is automatic.</p>
</div>
<div class="sect4">
<h5 id="_screenshots_4">Screenshots</h5>
<div class="paragraph">
<p>The following screenshots are taken from the [Estatio](<a href="https://github.com/estatio/estatio" class="bare">https://github.com/estatio/estatio</a>) application.</p>
</div>
<div class="sect5">
<h6 id="_copy_url">Copy URL</h6>
<div class="paragraph">
<p>This screenshot shows the copy URL button (top right):</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/copy-link/010-copy-link-button.png"><img src="images/wicket-viewer/copy-link/010-copy-link-button.png" alt="010 copy link button" width="800px"></a>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that these screenshots show an earlier version of the <a href="#_ug_wicket-viewer">Wicket viewer</a> UI (specifically, pre 1.8.0).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Clicking on this button brings up a dialog with the URL preselected:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/copy-link/020-copy-link-dialog.png"><img src="images/wicket-viewer/copy-link/020-copy-link-dialog.png" alt="020 copy link dialog" width="800px"></a>
</div>
</div>
<div class="paragraph">
<p>The URL in this case is something like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://localhost:8080/wicket/entity/org.estatio.dom.lease.Lease:0</pre>
</div>
</div>
<div class="paragraph">
<p>The user can copy the link (eg <code>ctrl+C</code>) into the clipboard, then hit <code>OK</code> or <code>Esc</code> to dismiss the dialog.</p>
</div>
</div>
<div class="sect5">
<h6 id="_hints">Hints</h6>
<div class="paragraph">
<p>Using the viewer the user can hide/show collection tables, can sort the tables by header columns:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/copy-link/030-hints.png"><img src="images/wicket-viewer/copy-link/030-hints.png" alt="030 hints" width="800px"></a>
</div>
</div>
<div class="paragraph">
<p>Also, if the collection spans multiple pages, then the individual page can be selected.</p>
</div>
<div class="paragraph">
<p>Once the view has been customised, the URL shown in the copy URL dialog is in an extended form:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/copy-link/040-copy-link-with-hints.png"><img src="images/wicket-viewer/copy-link/040-copy-link-with-hints.png" alt="040 copy link with hints" width="800px"></a>
</div>
</div>
<div class="paragraph">
<p>The URL in this case is something like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://localhost:8080/wicket/entity/org.estatio.dom.lease.Lease:0?hint-1:collectionContents-view=3&amp;hint-1:collectionContents:collectionContents-3:table-DESCENDING=value&amp;hint-1:collectionContents:collectionContents-3:table-pageNumber=0&amp;hint-2:collectionContents-view=0&amp;hint-2:collectionContents:collectionContents-2:table-pageNumber=0&amp;hint-3:collectionContents-view=2&amp;hint-3:collectionContents:collectionContents-2:table-pageNumber=0&amp;hint-4:collectionContents-view=3&amp;hint-4:collectionContents:collectionContents-3:table-ASCENDING=exerciseDate&amp;hint-4:collectionContents:collectionContents-3:table-pageNumber=0&amp;hint-5:collectionContents-view=0&amp;hint-5:collectionContents:collectionContents-3:table-pageNumber=0</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_copy_url_from_title">Copy URL from title</h6>
<div class="paragraph">
<p>When the user invokes an action on the object, the URL (necessarily) changes to indicate that the action was invoked.  This URL is specific to the user&#8217;s session and cannot be shared with others.</p>
</div>
<div class="paragraph">
<p>A quick way for the user to grab a shareable URL is simply by clicking on the object&#8217;s title:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/copy-link/050-title-url.png"><img src="images/wicket-viewer/copy-link/050-title-url.png" alt="050 title url" width="800px"></a>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_user_experience_3">User Experience</h5>
<div class="paragraph">
<p>The copy URL dialog is typically obtained by clicking on the icon.</p>
</div>
<div class="paragraph">
<p>Alternatively, <code>alt+]</code> will also open the dialog.  It can be closed with either <code>OK</code> or the <code>Esc</code> key.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_wicket-viewer_features_titles-in-tables">7.1.4. Titles in Tables</h4>
<div class="paragraph">
<p>Object titles can often be quite long if the intention is to uniquely identify the object.  While this is appropriate for the object view, it can be cumbersome within tables.</p>
</div>
<div class="paragraph">
<p>If an object&#8217;s title is specified with from <code>@Title</code> annotation then the Wicket viewer will (for parented collections) automatically "contextualize" a title by excluding the part of the title corresponding to a reference to the owning (parent) object.</p>
</div>
<div class="paragraph">
<p>In other words, suppose we have:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/how-tos/ui-hints/object-titles-and-icons/cust-order-product.png"><img src="images/how-tos/ui-hints/object-titles-and-icons/cust-order-product.png" alt="cust order product" width="579px"></a>
</div>
</div>
<div class="paragraph">
<p>so that <code>Customer</code> has a collection of `Order`s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">public</span> <span class="predefined-type">Set</span>&lt;Order&gt; getOrders() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and <code>Product</code> also has a collection of `Order`s (please forgive the suspect domain modelling in this example (!)):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Product</span> {
    <span class="directive">public</span> <span class="predefined-type">Set</span>&lt;Order&gt; getOrders() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and where the <code>Order</code> class references both <code>Customer</code> and <code>Product</code>.</p>
</div>
<div class="paragraph">
<p>The `Order&#8217;s might involve each of these:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Order</span> {
    <span class="annotation">@Title</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Customer getCustomer() { ... }
    <span class="annotation">@Title</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Product getProduct() { ... }
    <span class="annotation">@Title</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getOtherInfo() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, if we view a <code>Customer</code> with its collection of <code>Order`s, then in that parented collection&#8217;s table the customer&#8217;s property will be automatically excluded from the title of the `Order</code> (but it would show the product).  Conversely, if a <code>Product</code> is viewed then its collection of `Order`s would suppress product (but would show the customer).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is a close cousin of the <code>@PropertyLayout(hidden=Where.REFERENCES_PARENT)</code> annotation, which will cause the property itself to be hidden as a column in the table. An Isis idiom is therefore:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Order</span> {
    <span class="annotation">@Title</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@PropertyLayout</span>(hidden=Where.REFERENCES_PARENT)
    <span class="directive">public</span> Customer getCustomer() { ... }
    ...
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above annotations mean that titles usually "just work", altering according to the context in which they are viewed.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is also possible to configure the Wicket viewer to <a href="#_ug_wicket-viewer_configuration-properties_abbreviating-titles">abbreviate titles or suppress them</a> completely.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_wicket-viewer_features_blob-attachments">7.1.5. File upload/download</h4>
<div class="paragraph">
<p>The Isis application library provides the <a href="rg.html#_rg_classes_value-types_manpage-Blob">Blob</a> value type (binary large objects) and also the <a href="rg.html#_rg_classes_value-types_manpage-Clob">Clob</a>
value type (character large object), each of which also includes metadata about the data (specifically the filename and mime type).</p>
</div>
<div class="paragraph">
<p>A class can define a property using either of these types, for example:</p>
</div>
<div class="sect4">
<h5 id="_screenshots_5">Screenshots</h5>
<div class="paragraph">
<p>The following screenshots are taken from the Isis addons example <a href="https://github.com/isisaddons/isis-app-todoapp">todoapp</a> (not ASF):</p>
</div>
<div class="sect5">
<h6 id="_view_mode_empty">View mode, empty</h6>
<div class="paragraph">
<p><code>Blob</code> field rendered as attachment (with no data):</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/blob-attachments/010-attachment-field.png"><img src="images/wicket-viewer/blob-attachments/010-attachment-field-940.png" alt="010 attachment field 940" width="800px"></a>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that these screenshots show an earlier version of the <a href="#_ug_wicket-viewer">Wicket viewer</a> UI (specifically, pre 1.8.0).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_edit_mode">Edit mode</h6>
<div class="paragraph">
<p>Hit edit; 'choose file' button appears:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/blob-attachments/020-edit-choose-file.png"><img src="images/wicket-viewer/blob-attachments/020-edit-choose-file-940.png" alt="020 edit choose file 940" width="800px"></a>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_choose_file">Choose file</h6>
<div class="paragraph">
<p>Choose file using the regular browser window:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/blob-attachments/030-choose-file-using-browser.png"><img src="images/wicket-viewer/blob-attachments/030-choose-file-using-browser-520.png" alt="030 choose file using browser 520" width="520px"></a>
</div>
</div>
<div class="paragraph">
<p>Chosen file is indicated:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/blob-attachments/040-edit-chosen-file-indicated.png"><img src="images/wicket-viewer/blob-attachments/040-edit-chosen-file-indicated-940.png" alt="040 edit chosen file indicated 940" width="800px"></a>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_image_rendered">Image rendered</h6>
<div class="paragraph">
<p>Back in view mode (ie once hit OK) if the <code>Blob</code> is an image, then it is shown:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/blob-attachments/050-ok-if-image-then-rendered.png"><img src="images/wicket-viewer/blob-attachments/050-ok-if-image-then-rendered-940.png" alt="050 ok if image then rendered 940" width="800px"></a>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_download">Download</h6>
<div class="paragraph">
<p><code>Blob</code> can be downloaded:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/blob-attachments/060-download.png"><img src="images/wicket-viewer/blob-attachments/060-download-940.png" alt="060 download 940" width="800px"></a>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_clear">Clear</h6>
<div class="paragraph">
<p>Back in edit mode, can choose a different file or clear (assuming property is not mandatory):</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/blob-attachments/070-edit-clear.png"><img src="images/wicket-viewer/blob-attachments/070-edit-clear-940.png" alt="070 edit clear 940" width="800px"></a>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_domain_code_3">Domain Code</h5>
<div class="paragraph">
<p>To define a <code>Blob</code>, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="predefined-type">Blob</span> attachment;
<span class="annotation">@javax</span>.jdo.annotations.Persistent(defaultFetchGroup=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@javax</span>.jdo.annotations.Persistent(defaultFetchGroup=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>, columns = {
            <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_name</span><span class="delimiter">&quot;</span></span>),
            <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_mimetype</span><span class="delimiter">&quot;</span></span>),
            <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_bytes</span><span class="delimiter">&quot;</span></span>, jdbcType = <span class="string"><span class="delimiter">&quot;</span><span class="content">BLOB</span><span class="delimiter">&quot;</span></span>, sqlType = <span class="string"><span class="delimiter">&quot;</span><span class="content">BLOB</span><span class="delimiter">&quot;</span></span>)
    })
<span class="annotation">@Property</span>(
        domainEvent = AttachmentDomainEvent.class,
        optionality = Optionality.OPTIONAL
)
<span class="directive">public</span> <span class="predefined-type">Blob</span> getAttachment() { <span class="keyword">return</span> attachment; }
<span class="directive">public</span> <span class="type">void</span> setAttachment(<span class="directive">final</span> <span class="predefined-type">Blob</span> attachment) { <span class="local-variable">this</span>.attachment = attachment; }</code></pre>
</div>
</div>
<div class="paragraph">
<p>To define a <code>Clob</code>, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="predefined-type">Clob</span> doc;
<span class="annotation">@javax</span>.jdo.annotations.Persistent(defaultFetchGroup=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>, columns = {
        <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">doc_name</span><span class="delimiter">&quot;</span></span>),
        <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">doc_mimetype</span><span class="delimiter">&quot;</span></span>),
        <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">doc_chars</span><span class="delimiter">&quot;</span></span>, jdbcType = <span class="string"><span class="delimiter">&quot;</span><span class="content">CLOB</span><span class="delimiter">&quot;</span></span>, sqlType = <span class="string"><span class="delimiter">&quot;</span><span class="content">CLOB</span><span class="delimiter">&quot;</span></span>)
})
<span class="annotation">@Property</span>(
        optionality = Optionality.OPTIONAL
)
<span class="directive">public</span> <span class="predefined-type">Clob</span> getDoc() { <span class="keyword">return</span> doc; }
<span class="directive">public</span> <span class="type">void</span> setDoc(<span class="directive">final</span> <span class="predefined-type">Clob</span> doc) { <span class="local-variable">this</span>.doc = doc; }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Blob</code> and <code>Clob</code> types can also be used as parameters to actions.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_wicket-viewer_features_user-registration">7.1.6. User Registration</h4>
<div class="paragraph">
<p>The Wicket viewer provides the ability for users to sign-up by providing a valid email address:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>from the login page the user can instead follow a link to take them to a sign-up page, where they enter their email address.</p>
</li>
<li>
<p>a verification email is sent using this service; the email includes a link back to the running application.</p>
</li>
<li>
<p>the user then completes the registration process by choosing a user name and password.</p>
</li>
<li>
<p>the Wicket viewer then creates an account for them and logs them in.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In a similar way, if the user has forgotten their password then they can request a reset link to be sent to their email, again by providing their email address.</p>
</div>
<div class="paragraph">
<p>To support this the framework requires three services to be registered and configured:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <a href="rg.html#_rg_services-spi_manpage-UserRegistrationService">user registration service</a>, which provides an API to create the user account</p>
</li>
<li>
<p>the <a href="rg.html#_rg_services-spi_manpage-EmailNotificationService">email notification service</a>, which provides an API for to send the verification emails</p>
</li>
<li>
<p>the <a href="rg.html#_rg_services-api_manpage-EmailService">email service</a>, that is used by the email notification service to actually send the email.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Apache Isis core framework provides a default implementation of both the email notification service and the email service. If your application uses the <a href="https://github.com/isisaddons/isis-module-security">Isis addons security module</a> (not ASF) then an implementation is provided by that module; just add to the classpath. Otherwise you will need to provide your own implementation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There is <em>no</em> default implementation of the user registration service in the core framework.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_screenshots_6">Screenshots</h5>
<div class="paragraph">
<p>The user is presented with a login page:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/user-registration/login-page-default.png"><img src="images/wicket-viewer/user-registration/login-page-default.png" alt="login page default" width="300px"></a>
</div>
</div>
<div class="paragraph">
<p>Navigate to the sign up page. Complete the page, and verify:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/user-registration/sign-up-page.png"><img src="images/wicket-viewer/user-registration/sign-up-page.png" alt="sign up page" width="300px"></a>
</div>
</div>
<div class="paragraph">
<p>Back to the login page:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/user-registration/sign-up-login-page-after-sign-up.png"><img src="images/wicket-viewer/user-registration/sign-up-login-page-after-sign-up.png" alt="sign up login page after sign up" width="300px"></a>
</div>
</div>
<div class="paragraph">
<p>Email arrives, with link:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/user-registration/sign-up-email-with-verification-link.png"><img src="images/wicket-viewer/user-registration/sign-up-email-with-verification-link.png" alt="sign up email with verification link" width="500px"></a>
</div>
</div>
<div class="paragraph">
<p>Follow the link, complete the page:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/user-registration/sign-up-registration-page.png"><img src="images/wicket-viewer/user-registration/sign-up-registration-page.png" alt="sign up registration page" width="300px"></a>
</div>
</div>
<div class="paragraph">
<p>Automatically logged in:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/user-registration/sign-up-after-registration.png"><img src="images/wicket-viewer/user-registration/sign-up-after-registration.png" alt="sign up after registration" width="800px"></a>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_4">Configuration</h5>
<div class="paragraph">
<p>There are two prerequisites:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>register an implementation of the <a href="rg.html#_rg_services-spi_manpage-UserRegistrationService">user registration service</a> (eg by using the <a href="https://github.com/isisaddons/isis-module-security">Isis addons security module</a>)</p>
</li>
<li>
<p>configure the <a href="rg.html#_rg_services-api_manpage-EmailService">email service</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The latter is required if you are using the default email notification service and email service. If you are using your own alternative implementation of the email notification service then it may be omitted (and configure your own alternative implementation as required).</p>
</div>
<div class="paragraph">
<p>It is also possible to configure the Wicket viewer to suppress <a href="#_ug_wicket-viewer_configuration-properties_suppressing-sign-up">the sign-up page link</a> and/or the <a href="#_ug_wicket-viewer_configuration-properties_suppressing-password-reset">password reset page</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_wicket-viewer_configuration-properties">7.2. Configuration Properties</h3>
<div class="paragraph">
<p>Wicket configuration properties alter the way in which Apache Isis' Wicket viewer renders domain objects.  They are typically stored in <code>WEB-INF/viewer_wicket.properties</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To tell Apache Isis that the Wicket viewer is in use (and should therefore search for the <code>viewer_wicket.properties</code> file), add the following to <code>WEB-INF/web.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>isis.viewers<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>wicket<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you prefer you can place all configuration properties into <code>WEB-INF/isis.properties</code> (the configuration properties from all config files are merged together).</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Wicket Viewer Configuration Properties</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 16%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Value<br>
(<em>default value</em>)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewer.wicket.</code><br>
<code>bookmarkedPages</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+ve int (<code><em>15</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of pages to bookmark</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewer.wicket.</code><br>
<code>disableDependentChoiceAutoSelection</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (<code><em>false</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For dependent choices, whether to automatically select the first dependent (eg subcategory) when the parameter on which it depends (category) changes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewer.wicket.</code><br>
<code>disableModalDialogs</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (<code><em>false</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default the Apache Isis Wicket viewer uses a modal dialog for action parameters.  Before this feature was implemented (prior to 1.4.0), Apache Isis rendered action parameters on its own page.  This property re-enables the old behaviour.
</p><p class="tableblock">Note that action pages are still used for bookmarked actions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewer.wicket.</code><br>
<code>maxTitleLengthInParentedTables</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+ve integer, (<code><em>12</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See discussion <a href="#_ug_wicket-viewer_configuration-properties_abbreviating-titles">below</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewer.wicket.</code><br>
<code>maxTitleLengthInStandaloneTables</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+ve integer, (<code><em>12</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See discussion <a href="#_ug_wicket-viewer_configuration-properties_abbreviating-titles">below</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewer.wicket.</code><br>
<code>maxTitleLengthInTables</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+ve integer, (<code><em>12</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See discussion <a href="#_ug_wicket-viewer_configuration-properties_abbreviating-titles">below</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewer.wicket.</code><br>
<code>regularCase</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (<code><em>false</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ignored for 1.8.0+; in earlier versions forced regular case rather than title case in the UI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewer.wicket.</code><br>
<code>stripWicketTags</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (<code><em>true</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to force Wicket tags to be stripped in prototype/development mode.  See discussion <a href="#_ug_wicket-viewer_configuration-properties_stripped-wicket-tags">below</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewer.wicket.</code><br>
<code>suppressPasswordReset</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (<code><em>false</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If user registration is enabled, whether to suppress the "password reset" link on the login page.  See discussion <a href="#_ug_wicket-viewer_configuration-properties_suppressing-password-reset">below</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewer.wicket.</code><br>
<code>suppressRememberMe</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (<code><em>false</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to suppress "remember me" checkbox on the login page.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewer.wicket.</code><br>
<code>suppressSignUp</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (<code><em>false</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If user registration is enabled, whether to suppress the "sign up" link on the login page.  See discussion <a href="#_ug_wicket-viewer_configuration-properties_suppressing-sign-up">below</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewer.wicket.</code><br>
<code>themes.enabled</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">comma separated list &#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203; of bootswatch themes.  Only applies if <code>themes.showChooser</code>==<code>true</code>.  See discussion <a href="#_ug_wicket-viewer_configuration-properties_showing-theme-chooser">below</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewer.wicket.</code><br>
<code>themes.showChooser</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (<code><em>false</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to show chooser for Bootstrap themes.  See discussion <a href="#_ug_wicket-viewer_configuration-properties_showing-theme-chooser">below</a></p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_ug_wicket-viewer_configuration-properties_abbreviating-titles">7.2.1. Abbreviating/suppressing titles in tables</h4>
<div class="paragraph">
<p>Objects whose title is overly long can be cumbersome in titles.  The Wicket viewer has a <a href="#_ug_wicket-viewer_features_titles-in-tables">mechanism to automatically shorten</a> the titles of objects specified using <code>@Title</code>.  As an alternative/in addition, the viewer can also be configured to simply truncate titles longer than a certain length.</p>
</div>
<div class="paragraph">
<p>The properties themselves are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.viewer.wicket.maxTitleLengthInStandaloneTables=20
isis.viewer.wicket.maxTitleLengthInParentedTables=8</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you wish to use the same value in both cases, you can also specify just:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.viewer.wicket.maxTitleLengthInTables=15</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is used as a fallback if the more specific properties are not provided.</p>
</div>
<div class="paragraph">
<p>If no properties are provided, then the Wicket viewer defaults to abbreviating titles to a length of <code>12</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ug_wicket-viewer_configuration-properties_suppressing-remember-me">7.2.2. Suppressing 'remember me'</h4>
<div class="paragraph">
<p>The 'remember me' checkbox on the login page can be suppressed, if required, by setting a configuration flag.</p>
</div>
<div class="sect4">
<h5 id="_screenshots_7">Screenshots</h5>
<div class="paragraph">
<p>With 'remember me' not suppressed (the default):</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/suppress-remember-me/login-page-default.png"><img src="images/wicket-viewer/suppress-remember-me/login-page-default.png" alt="login page default" width="300px"></a>
</div>
</div>
<div class="paragraph">
<p>and with the checkbox suppressed:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/suppress-remember-me/login-page-suppress-remember-me.png"><img src="images/wicket-viewer/suppress-remember-me/login-page-suppress-remember-me.png" alt="login page suppress remember me" width="300px"></a>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_5">Configuration</h5>
<div class="paragraph">
<p>To suppress the 'remember me' checkbox, add the following configuration flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.viewer.wicket.suppressRememberMe=true</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_wicket-viewer_configuration-properties_suppressing-sign-up">7.2.3. Suppressing 'sign up'</h4>
<div class="paragraph">
<p>If <a href="#_user_registration">user registration</a> has been configured, then the Wicket viewer allows the user to sign-up a new account and to reset their password from the login page.</p>
</div>
<div class="paragraph">
<p>The 'sign up' link can be suppressed, if required, by setting a configuration flag.</p>
</div>
<div class="sect4">
<h5 id="_screenshots_8">Screenshots</h5>
<div class="paragraph">
<p>With 'sign up' not suppressed (the default):</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/suppress-sign-up/login-page-default.png"><img src="images/wicket-viewer/suppress-sign-up/login-page-default.png" alt="login page default" width="300px"></a>
</div>
</div>
<div class="paragraph">
<p>and with the link suppressed:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/suppress-sign-up/login-page-suppress-sign-up.png"><img src="images/wicket-viewer/suppress-sign-up/login-page-suppress-sign-up.png" alt="login page suppress sign up" width="300px"></a>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_6">Configuration</h5>
<div class="paragraph">
<p>To suppress the 'sign up' link, add the following configuration flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.viewer.wicket.suppressSignUp=true</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_see_also">See also</h5>
<div class="paragraph">
<p>The <a href="#_ug_wicket-viewer_configuration-properties_suppressing-password-reset">password reset link</a> can be suppressed in a similar manner.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_wicket-viewer_configuration-properties_suppressing-password-reset">7.2.4. Suppressing 'password reset'</h4>
<div class="paragraph">
<p>If <a href="#_user_registration">user registration</a> has been configured, then the Wicket viewer allows the user to sign-up a new account and to reset their password from the login page.</p>
</div>
<div class="paragraph">
<p>The 'password reset' link can be suppressed, if required, by setting a configuration flag.</p>
</div>
<div class="sect4">
<h5 id="_screenshots_9">Screenshots</h5>
<div class="paragraph">
<p>With 'password reset' not suppressed (the default):</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/suppress-password-reset/login-page-default.png"><img src="images/wicket-viewer/suppress-password-reset/login-page-default.png" alt="login page default" width="300px"></a>
</div>
</div>
<div class="paragraph">
<p>and with the link suppressed:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/suppress-password-reset/login-page-suppress-password-reset.png"><img src="images/wicket-viewer/suppress-password-reset/login-page-suppress-password-reset.png" alt="login page suppress password reset" width="300px"></a>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_7">Configuration</h5>
<div class="paragraph">
<p>To suppress the 'password reset' link, add the following configuration flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.viewer.wicket.suppressPasswordReset=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Typically this should be added to the <code>viewer_wicket.properties</code> file (in <code>WEB-INF</code>), though you can add to <code>isis.properties</code> if you wish.</p>
</div>
</div>
<div class="sect4">
<h5 id="_see_also_2">See also</h5>
<div class="paragraph">
<p>The <a href="#_ug_wicket-viewer_configuration-properties_suppressing-sign-up">sign up link</a> can be suppressed in a similar manner.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_wicket-viewer_configuration-properties_stripped-wicket-tags">7.2.5. Stripped Wicket tags</h4>
<div class="paragraph">
<p>By default the Apache Isis Wicket viewer will always strip wicket tags. However, when running in prototype mode, this behaviour can be overridden using a configuration property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.viewer.wicket.stripWicketTags=false</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In 1.7.0 and earlier, the behaviour is different; the Apache Isis Wicket viewer will preserve wicket tags when running in Apache Isis' prototype/development mode, but will still strip wicket tags in Apache Isis' server/deployment mode.</p>
</div>
<div class="paragraph">
<p>We changed the behaviour in 1.8.0 because we found that Internet Explorer can be sensitive to the presence of Wicket tags.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_wicket-viewer_configuration-properties_showing-theme-chooser">7.2.6. Showing a theme chooser</h4>
<div class="paragraph">
<p>The Wicket viewer uses <a href="http://getbootstrap.com/">Bootstrap</a> styles and components (courtesy of the <a href="https://github.com/l0rdn1kk0n/wicket-bootstrap">Wicket Bootstrap</a> integration).</p>
</div>
<div class="paragraph">
<p>Unless a <a href="#_ug_wicket-viewer_customisation_default-theme">default theme has been specified</a>, the viewer uses the default bootstrap theme. However,
the viewer can also be configured to allow the end-user to switch theme to another theme, in particular one of those provided by <a href="http://bootswatch.com">bootswatch.com</a>.</p>
</div>
<div class="paragraph">
<p>This is done using the following configuration property (in <code>WEB-INF/viewer_wicket.properties</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.viewer.wicket.themes.showChooser=true</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/theme-chooser/example-1.png"><img src="images/wicket-viewer/theme-chooser/example-1.png" alt="example 1" width="720px"></a>
</div>
<div class="title">Figure 3. Example 1</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/theme-chooser/example-2.png"><img src="images/wicket-viewer/theme-chooser/example-2.png" alt="example 2" width="720px"></a>
</div>
<div class="title">Figure 4. Example 2:</div>
</div>
<div class="paragraph">
<p>It is also possible to restrict the themes shown to some subset of those in bootswatch. This is done using a further
property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.viewer.wicket.themes.enabled=bootstrap-theme,Cosmo,Flatly,Darkly,Sandstone,United</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the value is the list of themes (from <a href="http://bootswatch.com">bootswatch.com</a>) to be made available.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can also develop and install a custom themes (eg to fit your company&#8217;s look-n-feel/interface guidelines); see the <a href="#_ug_extending_wicket-viewer_custom-bootstrap-theme">Extending</a> chapter for further details.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_wicket-viewer_request-parameters">7.3. Request Parameters</h3>
<div class="paragraph">
<p>This section describes features that are dependent on HTTP request parameters (<strong>not</strong> by setting configuration properties in <code>isis.properties</code>).</p>
</div>
<div class="sect3">
<h4 id="_suppressing_header_and_footer_embedded_view">7.3.1. Suppressing Header and Footer (Embedded View)</h4>
<div class="paragraph">
<p>The Wicket viewer provides some support such that an Isis application can be embedded within a host webapp, for example within an iframe.</p>
</div>
<div class="paragraph">
<p>Currently this support consists simply of being able to suppress the header and/or footer.</p>
</div>
<div class="sect4">
<h5 id="_screenshots_10">Screenshots</h5>
<div class="paragraph">
<p>For example, the regular view is:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/embedded-view/regular.png"><img src="images/wicket-viewer/embedded-view/regular.png" alt="regular" width="720px"></a>
</div>
</div>
<div class="paragraph">
<p>With the header and footer both suppressed only the main content is shown:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/embedded-view/no-header-no-footer.png"><img src="images/wicket-viewer/embedded-view/no-header-no-footer.png" alt="no header no footer" width="720px"></a>
</div>
</div>
<div class="paragraph">
<p>It is also possible to suppress just the header, or just the footer.</p>
</div>
</div>
<div class="sect4">
<h5 id="_request_parameters">Request parameters</h5>
<div class="paragraph">
<p>To suppress the header, add the following as a request parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.no.header</code></pre>
</div>
</div>
<div class="paragraph">
<p>and to suppress the header, add the following as a request parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.no.footer</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">http://localhost:8080/wicket/entity/TODO:0?isis.no.header&amp;isis.no.footer</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_wicket-viewer_layout">7.4. Layout</h3>
<div class="paragraph">
<p>The wicket viewer has full support for the various methods of specifying the <a href="rg.html#_rg_object-layout">layout of objects</a>, either statically or dynamically.</p>
</div>
<div class="paragraph">
<p>Dynamic reloading is automatically supported when running in <a href="rg.html#_rg_runtime_deployment-types">prototype (development) mode</a>, the Wicket viewer automatically rebuilds the metamodel for each class as it is rendered.    Conversely, do note that the Wicket viewer will <strong>not</strong> pick up new metadata if running in production/server mode.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To pick up a change, edit the <code>.layout.json</code> file in the IDE and rebuild.  Then click on the title of the object <em>*twice*</em>.</p>
</div>
<div class="paragraph">
<p>The first click will cause Apache Isis to pick up the new metadata, but too late in the process to adjust the rendering.  The second click will re-render the object with the new metadata.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The screenshots below show some of the effects that can be accomplished, for the open source <a href="https://github.com/estatio/estatio">Estatio</a> app.</p>
</div>
<div class="paragraph">
<p>First, an <code>Invoice</code>.  This places the properties in three equal-sized columns, with collections underneath:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/layouts/estatio-Invoice.png"><img src="images/wicket-viewer/layouts/estatio-Invoice.png" alt="estatio Invoice" width="800px"></a>
</div>
</div>
<div class="paragraph">
<p>Next, <code>Lease</code>.  This places its properties in two columns (one wide, one narrow), with its collections shown in the right-most column:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/layouts/estatio-Lease.png"><img src="images/wicket-viewer/layouts/estatio-Lease.png" alt="estatio Lease" width="800px"></a>
</div>
</div>
<div class="paragraph">
<p>Next, <code>LeaseItem</code>.  This is similar to <code>Lease</code>, with two columns for properties and the third column for collections:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/layouts/estatio-LeaseItem.png"><img src="images/wicket-viewer/layouts/estatio-LeaseItem.png" alt="estatio LeaseItem" width="800px"></a>
</div>
</div>
<div class="paragraph">
<p>And finally, from the (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a>, its <code>ToDoItem</code>.  This puts its properties in two columns; the collections (not visible in the screenshot below) are underneath (like Estatio&#8217;s <code>Invoice</code>):</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/layouts/todoapp-ToDoItem.png"><img src="images/wicket-viewer/layouts/todoapp-ToDoItem.png" alt="todoapp ToDoItem" width="800px"></a>
</div>
</div>
<div class="paragraph">
<p>To learn more about how to configure these types of layout, see the <a href="rg.html#_rg_object-layout">object layout</a> chapter.</p>
</div>
<div class="sect3">
<h4 id="_screencast">7.4.1. Screencast</h4>
<div class="paragraph">
<p>How to layout properties and collections dynamically, in the Wicket viewer.</p>
</div>
<div class="videoblock">
<div class="content">
<iframe width="530px" height="354px" src="//www.youtube.com/embed/zmrg49WeEPc?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that this screencast shows an earlier version of the <a href="#_ug_wicket-viewer">Wicket viewer</a> UI (specifically, pre 1.8.0).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_required_updates_to_the_dom_project_s_pom_xml">7.4.2. Required updates to the dom project&#8217;s pom.xml</h4>
<div class="paragraph">
<p>If using the <code>.layout.json</code> files, these must be compiled and available in the classpath. When using an IDE such as Eclipse+M2E, any <code>.layout.json</code> files in <code>src/main/java</code> or <code>src/main/resources</code> will be part of the classpath automatically. However, unless the <code>pom.xml</code> is changed, these will not be part of the compiled WAR.</p>
</div>
<div class="paragraph">
<p>Therefore, make sure the following is added to the dom project&#8217;s <code>pom.xml</code>:</p>
</div>
<div class="listingblock xml">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;resources&gt;
    &lt;resource&gt;
        &lt;filtering&gt;false&lt;/filtering&gt;
        &lt;directory&gt;src/main/resources&lt;/directory&gt;
    &lt;/resource&gt;
    &lt;resource&gt;
        &lt;filtering&gt;false&lt;/filtering&gt;
        &lt;directory&gt;src/main/java&lt;/directory&gt;
        &lt;includes&gt;
            &lt;include&gt;**&lt;/include&gt;
        &lt;/includes&gt;
        &lt;excludes&gt;
            &lt;exclude&gt;**/*.java&lt;/exclude&gt;
        &lt;/excludes&gt;
    &lt;/resource&gt;
&lt;/resources&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If using an Apache Isis <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a>, then the POM is already correctly configured.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_wicket-viewer_customisation">7.5. Customisation</h3>
<div class="sect3">
<h4 id="_ug_wicket-viewer_customisation_brand-logo">7.5.1. Brand logo</h4>
<div class="paragraph">
<p>By default the Wicket viewer will display the application name top-left in the header menu. This can be changed to
display a png logo instead.</p>
</div>
<div class="sect4">
<h5 id="_screenshots_11">Screenshots</h5>
<div class="paragraph">
<p>The screenshot below shows the Isis addons example <a href="https://github.com/isisaddons/isis-app-todoapp/">todoapp</a> (not ASF) with a 'brand logo' image in its header:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/brand-logo/brand-logo.png"><img src="images/wicket-viewer/brand-logo/brand-logo.png" alt="brand logo" width="750px"></a>
</div>
</div>
<div class="paragraph">
<p>A custom brand logo (typically larger) can also be specified for the signin page:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/brand-logo/brand-logo-signin.png"><img src="images/wicket-viewer/brand-logo/brand-logo-signin.png" alt="brand logo signin" width="750px"></a>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_8">Configuration</h5>
<div class="paragraph">
<p>In the application-specific subclass of <code>IsisWicketApplication</code>, bind:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a string with name "brandLogoHeader" to the URL of a header image. A size of 160x40 works well.</p>
</li>
<li>
<p>a string with name "brandLogoSignin" to the URL of a image for the sign-in page. A size of 400x100 works well.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">protected</span> Module newIsisWicketModule() {
    <span class="directive">final</span> Module isisDefaults = <span class="local-variable">super</span>.newIsisWicketModule();

    <span class="directive">final</span> Module overrides = <span class="keyword">new</span> AbstractModule() {
        <span class="annotation">@Override</span>
        <span class="directive">protected</span> <span class="type">void</span> configure() {
            ...
            bind(<span class="predefined-type">String</span>.class).annotatedWith(Names.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">brandLogoHeader</span><span class="delimiter">&quot;</span></span>))
                              .toInstance(<span class="string"><span class="delimiter">&quot;</span><span class="content">/images/todoapp-logo-header.png</span><span class="delimiter">&quot;</span></span>);
            bind(<span class="predefined-type">String</span>.class).annotatedWith(Names.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">brandLogoSignin</span><span class="delimiter">&quot;</span></span>))
                              .toInstance(<span class="string"><span class="delimiter">&quot;</span><span class="content">/images/todoapp-logo-signin.png</span><span class="delimiter">&quot;</span></span>);
            ...
        }
    };

    <span class="keyword">return</span> Modules.override(isisDefaults).with(overrides);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the logo is hosted locally, add to the relevant directory (eg <code>src/main/webapp/images</code>). It is also valid for the
URL to be absolute.</p>
</div>
<div class="paragraph">
<p>You may also wish to tweak the <a href="rg.html#_rg_runtime_application-specific_application-css"><code>application.css</code></a>. For example, a logo with height 40px works well with the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="css"><span class="class">.navbar-brand</span> <span class="tag">img</span> {
    <span class="key">margin-top</span>: <span class="float">-5px</span>;
    <span class="key">margin-left</span>: <span class="float">5px</span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_wicket-viewer_customisation_default-theme">7.5.2. Specifying a default theme</h4>
<div class="paragraph">
<p>The Apache Isis Wicket viewer uses <a href="http://getbootstrap.com/">Bootstrap</a> styles and components (courtesy of the <a href="https://github.com/l0rdn1kk0n/wicket-bootstrap">Wicket Bootstrap</a> integration).</p>
</div>
<div class="paragraph">
<p>Unless specified otherwise, the viewer uses the default bootstrap theme. However, this can be changed by overriding <code>init()</code> in the application&#8217;s subclass of <code>IsisWicketApplication</code>. For example, to set the <a href="http://bootswatch.com/flatly/">bootswatch.com flatly</a> theme
 as the default, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">protected</span> <span class="type">void</span> init() {
    <span class="local-variable">super</span>.init();
    IBootstrapSettings settings = Bootstrap.getSettings();
    settings.setThemeProvider(<span class="keyword">new</span> BootswatchThemeProvider(BootswatchTheme.Flatly));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have developed a custom Bootstrap theme (as described <a href="#_ug_extending_wicket-viewer_custom-bootstrap-theme">here</a>) then this can also be specified using the <a href="https://github.com/l0rdn1kk0n/wicket-bootstrap/wiki/Themes">Wicket Bootstrap API</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ug_wicket-viewer_customisation_welcome-page">7.5.3. Welcome page</h4>
<div class="paragraph">
<p>It&#8217;s possible to customize the application name, welcome message and about message can also be customized. This is done by adjusting the Guice bindings (part of Apache Isis' bootstrapping) in your custom subclass of <code>IsisWicketApplication</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyAppApplication</span> <span class="directive">extends</span> IsisWicketApplication {
    <span class="annotation">@Override</span>
    <span class="directive">protected</span> Module newIsisWicketModule() {
        <span class="directive">final</span> Module isisDefaults = <span class="local-variable">super</span>.newIsisWicketModule();
        <span class="directive">final</span> Module myAppOverrides = <span class="keyword">new</span> AbstractModule() {
            <span class="annotation">@Override</span>
            <span class="directive">protected</span> <span class="type">void</span> configure() {
                ...
                bind(<span class="predefined-type">String</span>.class)
                    .annotatedWith(Names.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">applicationName</span><span class="delimiter">&quot;</span></span>))
                     .toInstance(<span class="string"><span class="delimiter">&quot;</span><span class="content">My Wonderful App</span><span class="delimiter">&quot;</span></span>);
                bind(<span class="predefined-type">String</span>.class)
                    .annotatedWith(Names.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">welcomeMessage</span><span class="delimiter">&quot;</span></span>))
                    .toInstance(readLines(<span class="string"><span class="delimiter">&quot;</span><span class="content">welcome.html</span><span class="delimiter">&quot;</span></span>));         <i class="conum" data-value="1"></i><b>(1)</b>
                bind(<span class="predefined-type">String</span>.class)
                    .annotatedWith(Names.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">aboutMessage</span><span class="delimiter">&quot;</span></span>))
                    .toInstance(<span class="string"><span class="delimiter">&quot;</span><span class="content">My Wonderful App v1.0</span><span class="delimiter">&quot;</span></span>);
                ...
            }
        };

        <span class="keyword">return</span> Modules.override(isisDefaults).with(myAppOverrides);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>welcome.html</code> file is resolved relative to <code>src/main/webapp</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_wicket-viewer_customisation_about-page">7.5.4. About page</h4>
<div class="paragraph">
<p>Isis' Wicket viewer has an About page that, by default, will provide a dump of the JARs that make up the webapp. This page will also show the manifest attributes of the WAR archive itself, if there are any. One of these attributes may also be used as the application version number.</p>
</div>
<div class="sect4">
<h5 id="_screenshot">Screenshot</h5>
<div class="paragraph">
<p>Here&#8217;s what the About page looks like with this configuration added:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/wicket-viewer/about-page/about-page.png"><img src="images/wicket-viewer/about-page/about-page.png" alt="about page" width="800px"></a>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that this screenshot shows an earlier version of the <a href="#_ug_wicket-viewer">Wicket viewer</a> UI (specifically, pre 1.8.0).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that the <code>Build-Time</code> attribute has been used as the version number. The Wicket viewer is hard-coded to search for specific attributes and use as the application version. In order, it searches for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Implementation-Version</code></p>
</li>
<li>
<p><code>Build-Time</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If none of these are found, then no version is displayed.</p>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_9">Configuration</h5>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This configuration is included within the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_adding_attributes_to_the_war_s_manifest">Adding attributes to the WAR&#8217;s manifest</h6>
<div class="paragraph">
<p>Add the following to the webapp&#8217;s <code>pom.xml</code> (under <code>&lt;build&gt;/&lt;plugins&gt;</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.codehaus.mojo<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>build-helper-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.5<span class="tag">&lt;/version&gt;</span>
      <span class="tag">&lt;executions&gt;</span>
        <span class="tag">&lt;execution&gt;</span>
          <span class="tag">&lt;phase&gt;</span>validate<span class="tag">&lt;/phase&gt;</span>
          <span class="tag">&lt;goals&gt;</span>
            <span class="tag">&lt;goal&gt;</span>maven-version<span class="tag">&lt;/goal&gt;</span>
          <span class="tag">&lt;/goals&gt;</span>
        <span class="tag">&lt;/execution&gt;</span>
      <span class="tag">&lt;/executions&gt;</span>
<span class="tag">&lt;/plugin&gt;</span>

<span class="tag">&lt;plugin&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>maven-war-plugin<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;configuration&gt;</span>
        <span class="tag">&lt;archive&gt;</span>
            <span class="tag">&lt;manifest&gt;</span>
                <span class="tag">&lt;addDefaultImplementationEntries&gt;</span>true<span class="tag">&lt;/addDefaultImplementationEntries&gt;</span>
            <span class="tag">&lt;/manifest&gt;</span>
            <span class="tag">&lt;manifestEntries&gt;</span>
                <span class="tag">&lt;Build-Time&gt;</span>${maven.build.timestamp}<span class="tag">&lt;/Build-Time&gt;</span>
                <span class="tag">&lt;Build-Number&gt;</span>${buildNumber}<span class="tag">&lt;/Build-Number&gt;</span>
                <span class="tag">&lt;Build-Host&gt;</span>${agent.name}<span class="tag">&lt;/Build-Host&gt;</span>
                <span class="tag">&lt;Build-User&gt;</span>${user.name}<span class="tag">&lt;/Build-User&gt;</span>
                <span class="tag">&lt;Build-Maven&gt;</span>Maven ${maven.version}<span class="tag">&lt;/Build-Maven&gt;</span>
                <span class="tag">&lt;Build-Java&gt;</span>${java.version}<span class="tag">&lt;/Build-Java&gt;</span>
                <span class="tag">&lt;Build-OS&gt;</span>${os.name}<span class="tag">&lt;/Build-OS&gt;</span>
                <span class="tag">&lt;Build-Label&gt;</span>${project.version}<span class="tag">&lt;/Build-Label&gt;</span>
            <span class="tag">&lt;/manifestEntries&gt;</span>
        <span class="tag">&lt;/archive&gt;</span>
    <span class="tag">&lt;/configuration&gt;</span>
    <span class="tag">&lt;executions&gt;</span>
        <span class="tag">&lt;execution&gt;</span>
            <span class="tag">&lt;phase&gt;</span>package<span class="tag">&lt;/phase&gt;</span>
            <span class="tag">&lt;goals&gt;</span>
                <span class="tag">&lt;goal&gt;</span>war<span class="tag">&lt;/goal&gt;</span>
            <span class="tag">&lt;/goals&gt;</span>
            <span class="tag">&lt;configuration&gt;</span>
                <span class="tag">&lt;classifier&gt;</span>${env}<span class="tag">&lt;/classifier&gt;</span>
            <span class="tag">&lt;/configuration&gt;</span>
        <span class="tag">&lt;/execution&gt;</span>
    <span class="tag">&lt;/executions&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you then build the webapp from the Maven command line (<code>mvn clean package</code>), then the WAR should contain a <code>META-INF/MANIFEST.MF</code> with those various attribute entries.</p>
</div>
</div>
<div class="sect5">
<h6 id="_exporting_the_attributes_into_the_app">Exporting the attributes into the app</h6>
<div class="paragraph">
<p>The manifest attributes are provided to the rest of the application by way of the Wicket viewer&#8217;s integration with Google Guice.</p>
</div>
<div class="paragraph">
<p>In your subclass of <code>IsisWicketApplication</code>, there is a method <code>newIsisWicketModule()</code>. In this method you need to bind an <code>InputStream</code> that will read the manifest attributes. This is all boilerplate so you can just copy-n-paste:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">protected</span> Module newIsisWicketModule() {
    ...
    final Module simpleappOverrides = <span class="keyword">new</span> AbstractModule() {
        <span class="annotation">@Override</span>
        <span class="directive">protected</span> <span class="type">void</span> configure() {
            ...
            bind(<span class="predefined-type">InputStream</span>.class)
                .annotatedWith(Names.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">metaInfManifest</span><span class="delimiter">&quot;</span></span>))
                .toProvider(Providers.of(
                    getServletContext().getResourceAsStream(<span class="string"><span class="delimiter">&quot;</span><span class="content">/META-INF/MANIFEST.MF</span><span class="delimiter">&quot;</span></span>)));
        }
    };
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With that you should be good to go!</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_wicket-viewer_customisation_tweaking-css-classes">7.5.5. Tweaking CSS classes</h4>
<div class="paragraph">
<p>The HTML generated by the Wicket viewer include plenty of CSS classes so that you can easily target the required elements as required. For example, you could use CSS to suppress the entity&#8217;s icon alongside its title. This would be done using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="css"><span class="class">.entityIconAndTitlePanel</span> <span class="tag">a</span> <span class="tag">img</span> {
    <span class="key">display</span>: <span class="value">none</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These customizations should generally be added to <a href="rg.html#_rg_runtime_application-specific_application-css"><code>application.css</a></code>; this file is included by default in every webpage served up by the Wicket viewer.</p>
</div>
<div class="sect4">
<h5 id="_targeting_individual_members">Targeting individual members</h5>
<div class="paragraph">
<p>For example, the <code>ToDoItem</code> object of the Isis addons example <a href="https://github.com/isisaddons/isis-app-todoapp/">todoapp</a> (not ASF) has a <code>notes</code> property. The HTML for this will be something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;div&gt;</span>
    <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">property ToDoItem-notes</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">multiLineStringPanel scalarNameAndValueComponentType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;label</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id83</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">scalarName</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Notes<span class="tag">&lt;/span&gt;</span>
                <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">scalarValue</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;textarea</span>
                        <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">middleColumn:memberGroup:1:properties:4:property:scalarIfRegular:scalarValue</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">disabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">disabled</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id83</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">rows</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">maxlength</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">400</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">125</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;/textarea&gt;</span>
                    <span class="tag">&lt;span&gt;</span>
                    <span class="tag">&lt;/span&gt;</span>
                <span class="tag">&lt;/span&gt;</span>
            <span class="tag">&lt;/label&gt;</span>
       <span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="rg.html#_rg_runtime_application-specific_application-css"><code>application.css</code></a> file is the place to add application-specific styles. By way of an example, if (for some reason) we wanted to completely hide the notes value, we could do so using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="css"><span class="tag">div</span><span class="class">.ToDoItem-notes</span> <span class="tag">span</span><span class="class">.scalarValue</span> {
    <span class="key">display</span>: <span class="value">none</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use a similar approach for collections and actions.</p>
</div>
</div>
<div class="sect4">
<h5 id="_targeting_members_through_a_custom_css_style">Targeting members through a custom CSS style</h5>
<div class="paragraph">
<p>The above technique works well if you know the class member to target, but you might instead want to apply a custom style to a set of members. For this, you can use the <code>@CssClass</code>.</p>
</div>
<div class="paragraph">
<p>For example, in the <code>ToDoItem</code> class the following annotation (indicating that this is a key, important, property) :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PropertyLayout</span>(cssClass=<span class="string"><span class="delimiter">&quot;</span><span class="content">x-myapp-highlight</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> LocalDate getDueBy() {
    <span class="keyword">return</span> dueBy;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>would generate the HTML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;div&gt;</span>
    <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">property ToDoItem-dueBy x-myapp-highlight</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        ...
    <span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This can then be targeted, for example using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="css"><span class="tag">div</span><span class="class">.x-myapp-highlight</span> <span class="tag">span</span><span class="class">.scalarName</span> {
    <span class="key">color</span>: <span class="value">red</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note also that instead of using <code>@PropertyLayout(cssClass=&#8230;&#8203;)</code> annotation, you can also specify the CSS style using a <a href="rg.html#_rg_object-layout_dynamic">dynamic layout</a> JSON file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="string"><span class="delimiter">&quot;</span><span class="content">dueBy</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">propertyLayout</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">cssClass</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">x-myapp-important</span><span class="delimiter">&quot;</span></span>
    }
},</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_wicket-viewer_customisation_tweaking-css-classes">7.5.6. Tweaking CSS classes</h4>
<div class="paragraph">
<p>The HTML generated by the Wicket viewer include plenty of CSS classes so that you can easily target the required elements as required. For example, you could use CSS to suppress the entity&#8217;s icon alongside its title. This would be done using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="css"><span class="class">.entityIconAndTitlePanel</span> <span class="tag">a</span> <span class="tag">img</span> {
    <span class="key">display</span>: <span class="value">none</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These customizations should generally be added to <a href="rg.html#_rg_runtime_application-specific_application-css"><code>application.css</a></code>; this file is included by default in every webpage served up by the Wicket viewer.</p>
</div>
<div class="sect4">
<h5 id="_targeting_individual_members_2">Targeting individual members</h5>
<div class="paragraph">
<p>For example, the <code>ToDoItem</code> object of the Isis addons example <a href="https://github.com/isisaddons/isis-app-todoapp/">todoapp</a> (not ASF) has a <code>notes</code> property. The HTML for this will be something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;div&gt;</span>
    <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">property ToDoItem-notes</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">multiLineStringPanel scalarNameAndValueComponentType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;label</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id83</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">scalarName</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Notes<span class="tag">&lt;/span&gt;</span>
                <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">scalarValue</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;textarea</span>
                        <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">middleColumn:memberGroup:1:properties:4:property:scalarIfRegular:scalarValue</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">disabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">disabled</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id83</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">rows</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">maxlength</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">400</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">125</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;/textarea&gt;</span>
                    <span class="tag">&lt;span&gt;</span>
                    <span class="tag">&lt;/span&gt;</span>
                <span class="tag">&lt;/span&gt;</span>
            <span class="tag">&lt;/label&gt;</span>
       <span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="rg.html#_rg_runtime_application-specific_application-css"><code>application.css</code></a> file is the place to add application-specific styles. By way of an example, if (for some reason) we wanted to completely hide the notes value, we could do so using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="css"><span class="tag">div</span><span class="class">.ToDoItem-notes</span> <span class="tag">span</span><span class="class">.scalarValue</span> {
    <span class="key">display</span>: <span class="value">none</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use a similar approach for collections and actions.</p>
</div>
</div>
<div class="sect4">
<h5 id="_targeting_members_through_a_custom_css_style_2">Targeting members through a custom CSS style</h5>
<div class="paragraph">
<p>The above technique works well if you know the class member to target, but you might instead want to apply a custom style to a set of members. For this, you can use the <code>@CssClass</code>.</p>
</div>
<div class="paragraph">
<p>For example, in the <code>ToDoItem</code> class the following annotation (indicating that this is a key, important, property) :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PropertyLayout</span>(cssClass=<span class="string"><span class="delimiter">&quot;</span><span class="content">x-myapp-highlight</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> LocalDate getDueBy() {
    <span class="keyword">return</span> dueBy;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>would generate the HTML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;div&gt;</span>
    <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">property ToDoItem-dueBy x-myapp-highlight</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        ...
    <span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This can then be targeted, for example using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="css"><span class="tag">div</span><span class="class">.x-myapp-highlight</span> <span class="tag">span</span><span class="class">.scalarName</span> {
    <span class="key">color</span>: <span class="value">red</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note also that instead of using <code>@PropertyLayout(cssClass=&#8230;&#8203;)</code> annotation, you can also specify the CSS style using a <a href="rg.html#_rg_object-layout_dynamic">dynamic layout</a> JSON file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="string"><span class="delimiter">&quot;</span><span class="content">dueBy</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">propertyLayout</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">cssClass</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">x-myapp-important</span><span class="delimiter">&quot;</span></span>
    }
},</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_wicket-viewer_customisation_using-different-css-file">7.5.7. Using a different CSS file</h4>
<div class="paragraph">
<p>If for some reason you wanted to name the CSS file differently (eg <code>stylesheets/myapp.css</code>), then adjust the Guice bindings (part of Apache Isis' bootstrapping) in your custom subclass of <code>IsisWicketApplication</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyAppApplication</span> <span class="directive">extends</span> IsisWicketApplication {
    <span class="annotation">@Override</span>
    <span class="directive">protected</span> Module newIsisWicketModule() {
        <span class="directive">final</span> Module isisDefaults = <span class="local-variable">super</span>.newIsisWicketModule();
        <span class="directive">final</span> Module myAppOverrides = <span class="keyword">new</span> AbstractModule() {
            <span class="annotation">@Override</span>
            <span class="directive">protected</span> <span class="type">void</span> configure() {
                ...
                bind(<span class="predefined-type">String</span>.class)
                    .annotatedWith(Names.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">applicationCss</span><span class="delimiter">&quot;</span></span>))
                    .toInstance(<span class="string"><span class="delimiter">&quot;</span><span class="content">stylesheets/myapp.css</span><span class="delimiter">&quot;</span></span>);
                ...
            }
        };

        <span class="keyword">return</span> Modules.override(isisDefaults).with(myAppOverrides);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As indicated above, this file is resolved relative to <code>src/main/webapp</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ug_wicket-viewer_customisation_custom-javascript">7.5.8. Custom Javascript</h4>
<div class="paragraph">
<p>The Wicket viewer ships with embedded JQuery, so this can be leveraged to perform arbitrary transformations of the rendered page (eg to run some arbitrary JQuery on page load).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Just because something is possible, it doesn&#8217;t necessarily mean we encourage it.  Please be aware that there is no formal API for any custom javascript that you might implement to target; future versions of Apache Isis might break your code.</p>
</div>
<div class="paragraph">
<p>If possible, consider using the <code>ComponentFactory</code> API described in the <a href="#_ug_extending_wicket-viewer">Extending</a> chapter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To register your Javascript code, adjusting the Guice bindings (part of Apache Isis' bootstrapping) in your custom subclass of <code>IsisWicketApplication</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public class MyAppApplication extends IsisWicketApplication {
    @Override
    protected Module newIsisWicketModule() {
        final Module isisDefaults = super.newIsisWicketModule();
        final Module myAppOverrides = new AbstractModule() {
            @Override
            protected void configure() {
                ...
                bind(String.class)
                    .annotatedWith(Names.named("applicationJs"))
                    .toInstance("scripts/application.js");
                ...
            }
        };
        return Modules.override(isisDefaults).with(myAppOverrides);
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>Currently only one such <code>.js</code> file can be registered.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ug_wicket-viewer_customisation_auto-refresh">7.5.9. Auto-refresh page</h4>
<div class="paragraph">
<p>This requirement from the users mailing list:</p>
</div>
<div class="paragraph">
<p><div class="extended-quote-first"><p>Suppose you want to build a monitoring application, eg for an electricity grid. Data is updated in the background (eg via the Restful Objects REST API).  What is needed is the ability to show an entity that includes a <a href="http://github.com/isisaddons/isis-wicket-gmap3">map</a>, and have it auto-refresh every 5 seconds or so.
</p></div></p>
</div>
<div class="paragraph">
<p>Here&#8217;s one (somewhat crude, but workable) way to accomplish this.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First, update the domain object to return custom CSS:<br></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyDomainObject</span> {
    ...
    public <span class="predefined-type">String</span> cssClass() {<span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">my-special-auto-updating-entity</span><span class="delimiter">&quot;</span></span>; }
    ...
}</code></pre>
</div>
</div>
</li>
<li>
<p>Then, use javascript in <code>webapp/src/main/webapp/scripts/application.js</code> to reload:<br></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="predefined">$</span>(<span class="keyword">function</span>() {
    <span class="keyword">if</span> (<span class="predefined">$</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">.my-special-auto-updating-entity</span><span class="delimiter">&quot;</span></span>).length) {
        setTimeout(<span class="keyword">function</span>() {document.location.reload();}, <span class="integer">5000</span>); <span class="comment">// 1000 is 5 sec</span>
    }
});</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_extending_the_viewer">7.6. Extending the viewer</h3>
<div class="paragraph">
<p>APIs to extend the Wicket viewer are discussed in the <a href="#_ug_extending">Extending</a> chapter.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ug_wicket-viewer_isis-addons">7.7. Isis Add-ons (not ASF)</h3>
<div class="paragraph">
<p>The (non-ASF) <a href="http://www.isisaddons.org">Isis Addons</a> website provides a number of extensions to the Wicket viewer (leveraging the APIs described in <a href="#_ug_extending_wicket-viewer">Extending the Wicket viewer</a> section, later.  While you are free to fork and adapt any of them to your needs, they are also intended for use "out-of-the-box".</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that Isis addons, while maintained by Apache Isis committers, are not part of the ASF.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This short section gives an overview of their capabilities.  For full information, check out the README on their respective github repo.  Each wicket extension also includes a demo app so you can (a) see what the extension does and (b) see how to use it within your own code.</p>
</div>
<div class="sect3">
<h4 id="_excel_download_2">7.7.1. Excel download</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_fullcalendar2_2">7.7.2. Fullcalendar2</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_gmap3_2">7.7.3. Gmap3</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_wicked_charts">7.7.4. Wicked charts</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ug_restfulobjects-viewer">8. Restful Objects Viewer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apache Isis' Restful Objects viewer is an implementation of the <a href="http://restfulobjects.org">Restful Objects spec</a>, which defines a generic way to expose a domain model through a REST (or more precisely, hypermedia) API.</p>
</div>
<div class="paragraph">
<p>The Restful Objects viewer also provides a number of proprietary extensions.</p>
</div>
<div class="sect2">
<h3 id="_ug_restfulobjects-viewer_features">8.1. Features</h3>
<div class="paragraph">
<p>The REST API opens up an Apache Isis domain model to a huge variety of applications, from bespoke single-page apps, through integration scenarious, through providing an API for bulk-upload/migration from an existing system.</p>
</div>
<div class="sect3">
<h4 id="_restful_objects_specification">8.1.1. Restful Objects Specification</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - a brief summary here
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Restful Objects spec can be downloaded <a href="http://restfulobjects.org">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_pretty_printing">8.1.2. Pretty printing</h4>
<div class="paragraph">
<p>The JSON representations generated by the Restful Objects viewer are in compact form if the <a href="rg.html#_rg_runtime_deployment-types">deployment type</a> is SERVER (ie production), but will automatically be "pretty printed" (in other words indented) if the deployment type is PROTOTYPE.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_restfulobjects-viewer_configuration-properties">8.2. Configuration Properties</h3>
<div class="paragraph">
<p>The Restful Objects viewer provides a number of configuration option that extend/simplify/alter the representations generated from the Restful Objects specification.</p>
</div>
<div class="paragraph">
<p>These configuration properties are typically stored in <code>WEB-INF/viewer_restfulobjects.properties</code>.  However, you can place all configuration properties into <code>WEB-INF/isis.properties</code> if you wish (the configuration properties from all config files are merged together).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>These configuration settings should be considered beta, and may change in the future in response to emerging requirements.</p>
</div>
<div class="paragraph">
<p>Also, be aware enabling these settings makes the representations with respect to the <a href="http://restfulobjects.org">Restful Object spec</a>.  (Based on experience in Apache Isis, in the future the spec may be updated to allow such extensions).</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. Restful Objects Viewer Configuration Properties</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 16%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Value<br>
(<em>default value</em>)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewer.restfulobjects.</code><br>
<code>honorUiHints</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (<code><em>false</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <a href="#_ug_restfulobjects-viewer_configuration-properties_honor-ui-hints">discussion</a>, below.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewer.restfulobjects.</code><br>
<code>suppressDescribedByLinks</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (<code><em>false</em></code>)</p></td>
<td class="tableblock halign-left valign-top" rowspan="6"><p class="tableblock">See <a href="#_ug_restfulobjects-viewer_configuration-properties_suppressing-elements">discussion</a>, below.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewer.restfulobjects.</code><br>
<code>suppressUpdateLink</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (<code><em>false</em></code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewer.restfulobjects.</code><br>
<code>suppressMemberId</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (<code><em>false</em></code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewer.restfulobjects.</code><br>
<code>suppressMemberLinks</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (<code><em>false</em></code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewer.restfulobjects.</code><br>
<code>suppressMemberExtensions</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (<code><em>false</em></code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewer.restfulobjects.</code><br>
<code>suppressMemberDisabledReason</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (<code><em>false</em></code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.viewer.restfulobjects.</code><br>
<code>objectPropertyValuesOnly</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>,<code>false</code> (<code><em>false</em></code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <a href="#_ug_restfulobjects-viewer_configuration-properties_simplified-object-representation">discussion</a>, below.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_ug_restfulobjects-viewer_configuration-properties_honor-ui-hints">8.2.1. Honor UI hints</h4>
<div class="paragraph">
<p>By default the representations generated by Restful Objects ignore any Apache Isis metamodel hints referring to the UI.
In particular, if a collection is annotated then <code>Render(EAGERLY)</code> then the contents of the collection are <em>not</em>
eagerly embedded in the object representation.</p>
</div>
<div class="paragraph">
<p>However, this behaviour can be overridden globally using following property (typically added to <code>WEB-INF/viewer_restfulobjects.properties</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.viewer.restfulobjects.honorUiHints=true</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the future we might extend this per-request.  Raise/vote on a JIRA ticket if you require this feature.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_restfulobjects-viewer_configuration-properties_suppressing-elements">8.2.2. Suppressing elements of the representation</h4>
<div class="paragraph">
<p>The representations specified by the <a href="http://restfulobjects.org">Restful Object spec</a> are very rich in hypermedia controls and metadata, intended to support a wide variety of possible REST clients. However, if an application is providing its REST API only for a small well-defined set of REST clients, then it is possible to suppress (remove) various elements of these representations.</p>
</div>
<div class="paragraph">
<p>This is done by globally using the following properties (typically added to <code>WEB-INF/viewer_restfulobjects.properties</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.viewer.restfulobjects.suppressDescribedByLinks=true      <i class="conum" data-value="1"></i><b>(1)</b>
isis.viewer.restfulobjects.suppressUpdateLink=true            <i class="conum" data-value="2"></i><b>(2)</b>
isis.viewer.restfulobjects.suppressMemberId=true              <i class="conum" data-value="3"></i><b>(3)</b>
isis.viewer.restfulobjects.suppressMemberLinks=true           <i class="conum" data-value="4"></i><b>(4)</b>
isis.viewer.restfulobjects.suppressMemberExtensions=true      <i class="conum" data-value="5"></i><b>(5)</b>
isis.viewer.restfulobjects.suppressMemberDisabledReason=true  <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>suppresses the "describedby" links (on all representations)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>suppresses the  "update" link (on object representation)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>suppresses the  "id" json-prop for object members (on object representation and member detail representations)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>suppresses the  "links" json-prop for object members (on the object representation and member detail representations)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>suppresses the  "extensions" json-prop for object members (on the object representation and member detail representations)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>suppresses the  "disabledReason" json-prop for object members (on the object representation and member detail representations)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The defaults for all of these is false, meaning that the hypermedia/metadata is NOT suppressed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the future we might extend this per-request.  Raise/vote on a JIRA ticket if you require this feature.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If an even simpler representations (of objects) are required, see <a href="#_ug_restfulobjects-viewer_configuration-properties_simplified-object-representation">simplified object representation</a>, immediately below.  And if the above isn&#8217;t flexible and you need complete control over all representations see the section on <a href="#_ug_extending_restfulobjects-viewer">Extending the Restful Objects viewer</a> in the <a href="#_ug_extending">Extending</a> chapter.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ug_restfulobjects-viewer_configuration-properties_simplified-object-representation">8.2.3. Simplified object representation</h4>
<div class="paragraph">
<p>The representations specified by the <a href="http://restfulobjects.org">Restful Object spec</a> are very rich in hypermedia
controls and metadata, intended to support a wide variety of possible REST clients.</p>
</div>
<div class="paragraph">
<p>As described <a href="#_ug_restfulobjects-viewer_configuration-properties_suppressing-elements">above</a>, it is possible to suppress various elements of these representations. Even then, though, the representations may be too complex for some bespoke REST clients that require a very "flat" object representation.</p>
</div>
<div class="paragraph">
<p>The Restful Objects viewer therefore supports generating a much simpler representation of objects using the following configuration property (typically added to <code>WEB-INF/viewer_restfulobjects.properties</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.viewer.restfulobjects.objectPropertyValuesOnly=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>This generates a representation such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Buy milk due by 2014-10-27</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">domainType</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">TODO</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">instanceId</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">members</span><span class="delimiter">&quot;</span></span> : {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Buy milk</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">category</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Domestic</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">subcategory</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Shopping</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">complete</span><span class="delimiter">&quot;</span></span> : <span class="predefined-constant">false</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">versionSequence</span><span class="delimiter">&quot;</span></span> : <span class="integer">1</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">relativePriority</span><span class="delimiter">&quot;</span></span> : <span class="integer">2</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">dueBy</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">2014-10-27</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">cost</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">0.75</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">notes</span><span class="delimiter">&quot;</span></span> : <span class="predefined-constant">null</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">attachment</span><span class="delimiter">&quot;</span></span> : <span class="predefined-constant">null</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">doc</span><span class="delimiter">&quot;</span></span> : <span class="predefined-constant">null</span>
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">links</span><span class="delimiter">&quot;</span></span> : [
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">rel</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">self</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/restful/objects/TODO/0</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">method</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json;profile=</span><span class="char">\&quot;</span><span class="content">urn:org.restfulobjects:repr-types/object</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Buy milk due by 2014-10-27</span><span class="delimiter">&quot;</span></span>
        },
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">rel</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">describedby</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/restful/domain-types/TODO</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">method</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json;profile=</span><span class="char">\&quot;</span><span class="content">urn:org.restfulobjects:repr-types/domain-type</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span>
        }
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">extensions</span><span class="delimiter">&quot;</span></span> : {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">oid</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">TODO:0</span><span class="delimiter">&quot;</span></span>
    },
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the future we might extend this per-request.  Raise/vote on a JIRA ticket if you require this feature.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the above isn&#8217;t flexible and you need complete control over all representations see the section on <a href="#_ug_extending_restfulobjects-viewer">Extending the Restful Objects viewer</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_restfulobjects-viewer_hints-and-tips">8.3. Hints and Tips</h3>
<div class="paragraph">
<p>Since the Restful Objects viewer is designed for computer programs to interact with (rather than human beings), it can be a little difficult to explore and generally "grok" how it works.</p>
</div>
<div class="paragraph">
<p>This section provides a few hints-and-tips to help you on your way.</p>
</div>
<div class="sect3">
<h4 id="_using_chrome_tools">8.3.1. Using Chrome Tools</h4>
<div class="paragraph">
<p>The screencast below shows how to explore the Restful API using Chrome plugins/extensions, and how we use them to write end-2-end (TCK) tests for the Restful Objects viewer.</p>
</div>
<div class="videoblock">
<div class="content">
<iframe width="840px" height="472px" src="//www.youtube.com/embed/_-TOvVYWCHc?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_angularjs_tips">8.3.2. AngularJS Tips</h4>
<div class="paragraph">
<p>The hypermedia API exposed by Apache Isis' Restful Objects viewer is intended be support both bespoke custom-written viewers as well as generic viewers. Indeed, we expect most clients consuming the API will be bespoke, not generic.</p>
</div>
<div class="paragraph">
<p>This page captures one or two tips on using AngularJS to write such a bespoke client.</p>
</div>
<div class="sect4">
<h5 id="_invoking_a_get_link_eg_invoking_a_query_action">Invoking a GET link (eg invoking a query action)</h5>
<div class="paragraph">
<p>Suppose you have a <code>CustomerService</code> providing a <code>findCustomer</code> action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerService</span> {
  <span class="directive">public</span> <span class="predefined-type">String</span> id() { <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span>; }
  <span class="annotation">@ActionSemantics</span>(Of.SAFE)
  <span class="directive">public</span> Customer findCustomer(<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">customerName</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> customerName) { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Restful Objects will expose this as action with the following link that looks something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">rel</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">urn:org.restfulobjects:rels/invoke</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/restful/services/customers/actions/findCustomer/invoke</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">method</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json;profile=</span><span class="char">\&quot;</span><span class="content">urn:org.restfulobjects:repr-types/action-result</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">arguments</span><span class="delimiter">&quot;</span></span> : {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">customerName</span><span class="delimiter">&quot;</span></span> : {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span> : <span class="predefined-constant">null</span>
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then invoke this using AngularJs' <code>$resource</code> service as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> findCustomer = <span class="predefined">$resource</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/restful/services/customers/actions/findCustomer/invoke?:queryString</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">var</span> findCustomerArgs = {
  <span class="key"><span class="delimiter">&quot;</span><span class="content">customerName</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>
    }
};
findCustomer.get({<span class="key">queryString</span>: JSON.stringify(findCustomerArgs)}, <span class="keyword">function</span>(data) { ... } )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the <code>:queryString</code> placeholder in the initial <code>$resource</code> constructor is expanded with a stringified version of the JSON object representing the args. Note how the <code>findCustomerArgs</code> is the same as the <code>&quot;arguments&quot;</code> attribute in the original link (with a value provided instead of <code>null</code>).</p>
</div>
</div>
<div class="sect4">
<h5 id="_invoking_a_put_or_post_link">Invoking a PUT or POST link</h5>
<div class="paragraph">
<p>If the method is a PUT or a POST, then no <code>:queryString</code> placeholder is required in the URL, and the args are instead part of the body.</p>
</div>
<div class="paragraph">
<p>Use <code>$resource.put(&#8230;&#8203;)</code> or <code>$resource.post(&#8230;&#8203;)</code> instead.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_extending_the_viewer_2">8.4. Extending the viewer</h3>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>is discussed in <a href="#_ug_extending_restfulobjects-viewer">Extending the Restful Objects viewer</a>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ug_security">9. Security</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apache Isis has built-in support for authentication and authorization:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By "authentication" we mean logging into the application using some credentials, typically a username and password.  Authentication also means looking up the set of roles to which a user belongs.</p>
</li>
<li>
<p>By "authorization" we mean permissions: granting roles to have access to features (object member) of the app.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Isis has two levels of permissions.  <em>Read</em> permission means that the user can view the object member; it will be rendered in the UI.  An action with only read permission will be shown disabled ("greyed out".  <em>Write</em> permission means that the object member can be changed.  For actions this means that they can be invoked.</p>
</div>
<div class="paragraph">
<p>Isis provides an API for both authentication and authorization, and provides an implementation that integrates with <a href="http://shiro.apache.org">Apache Shiro</a>.  Shiro in turn uses the concept of a <em>realm</em> as a source for both authentication and optionally authorization.</p>
</div>
<div class="paragraph">
<p>Shiro ships with a simple text-based realm&#8201;&#8212;&#8201;the <code>IniRealm</code>&#8201;&#8212;&#8201;which reads users (and password), user roles and role permissions from the <code>WEB-INF/shiro.ini</code> file.  The <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a> is configured to use this realm.</p>
</div>
<div class="paragraph">
<p>Shiro also ships with an implementation of an LDAP-based realm; LDAP is often used to manage user/passwords and corresponding user groups.  Apache Isis in turn extends this with its <code>IsisLdapRealm</code>, which provides more flexibility for both group/role and role/permissions management.</p>
</div>
<div class="paragraph">
<p>In addition, the (non-ASF) <a href="http://www.isisaddons.org">Isis Addons</a> provides the <a href="http://github.com/isisaddons/isis-module-security">Isis addons' security</a> module, which also provides an implementation of the Shiro <code>Realm</code> API.  However, the security module also represents users, roles and permissions as domain objects, allowing them to be administered through Apache Isis itself.  Moreover, the security module can optionally delegate password management to a subsidiary (delegate) realm (usually LDAP as discussed above).</p>
</div>
<div class="paragraph">
<p>In addition to Apache Isis' Shiro-based implementation of its authentication and authorization APIs, Isis also provides a "bypass" implementation, useful for quick-n-dirty prototyping when you want to in effect disable (bypass) security completely.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">What about auditing?</div>
<div class="paragraph">
<p>A further aspect of security is auditing: recording what data was modified by which user.   Apache Isis does define two service APIs&#8201;&#8212;&#8201;<a href="rg.html#_rg_services-spi_manpage-CommandService"><code>CommandService</code></a> and <a href="rg.html#_rg_services-spi_manpage-AuditingService"><code>AuditingService</code></a>&#8201;&#8212;&#8201;that provide hooks to track which actions (commands) are invoked, and what data was modified as a result (auditing).</p>
</div>
<div class="paragraph">
<p>Isis does not itself provide any in-built implementations of these APIs, but there are implementations within (non-ASF) <a href="http://www.isisaddons.org">Isis Addons</a>, namely the <a href="http://github.com/isisaddons/isis-module-command">Isis addons' command</a> module and the <a href="http://github.com/isisaddons/isis-module-audit">Isis addons' auditing</a> module.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_ug_security_configuring-isis-to-use-shiro">9.1. Configuring Apache Isis to use Shiro</h3>
<div class="paragraph">
<p>Apache Isis' security mechanism is configurable, specifying an <code>Authenticator</code> and an <code>Authorizor</code> (non-public) APIs.  The Shiro security mechanism is an integration wih Apache Shiro that implements both interfaces.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a> is pre-configured to use Apache Shiro, so much of what follows is set up already.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_telling_apache_isis_to_use_shiro">9.1.1. Telling Apache Isis to use Shiro</h4>
<div class="paragraph">
<p>To tell Apache Isis to use Shiro, update the <code>WEB-INF/isis.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.authentication=shiro
isis.authorization=shiro</code></pre>
</div>
</div>
<div class="paragraph">
<p>This installs the appropriate implementation (the <code>ShiroAuthenticatorOrAuthorizor</code> class) that use Shiro&#8217;s APIs to perform authentication and authorization:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/security/security-apis-impl/configure-isis-to-use-shiro.png" alt="configure isis to use shiro" width="600px">
</div>
</div>
<div class="paragraph">
<p>The figure above doesn&#8217;t tell the whole story; we haven&#8217;t yet seen how Shiro itself is configured to use realms.  The <code>ShiroAuthenticatorOrAuthorizor</code> is in essence the glue between the Apache Isis runtime and Shiro.</p>
</div>
</div>
<div class="sect3">
<h4 id="_bootstrapping_shiro">9.1.2. Bootstrapping Shiro</h4>
<div class="paragraph">
<p>The Shiro environment (in essence, thread-locals holding the security credentials) needs to be bootstrapped using the following settings in the <code>WEB-INF/web.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;listener&gt;</span>
    <span class="tag">&lt;listener-class&gt;</span>org.apache.shiro.web.env.EnvironmentLoaderListener<span class="tag">&lt;/listener-class&gt;</span>
<span class="tag">&lt;/listener&gt;</span>
<span class="tag">&lt;filter&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>ShiroFilter<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;filter-class&gt;</span>org.apache.shiro.web.servlet.ShiroFilter<span class="tag">&lt;/filter-class&gt;</span>
<span class="tag">&lt;/filter&gt;</span>
<span class="tag">&lt;filter-mapping&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>ShiroFilter<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>/*<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/filter-mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Based on this Shiro will then read <code>WEB-INF/shiro.ini</code> file to configure its Realm definitions for authentication and authorization.</p>
</div>
</div>
<div class="sect3">
<h4 id="__code_web_inf_shiro_ini_code">9.1.3. <code>WEB-INF/shiro.ini</code></h4>
<div class="paragraph">
<p>The <code>shiro.ini</code> file is used to specify the realm(s) that Shiro will delegate to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">securityManager.realms = $realmName</code></pre>
</div>
</div>
<div class="paragraph">
<p>Shiro&#8217;s ini file supports a "poor-man&#8217;s" dependency injection (<a href="https://shiro.apache.org/configuration.html">their words</a>), and so <code>$realmName</code> in the above example is a reference to a realm defined elsewhere in <code>shiro.ini</code>.  The subsequent sections describe the specifics for thevarious realm implementations available to you.</p>
</div>
<div class="paragraph">
<p>It&#8217;s also possible to configure Shiro to support multiple realms.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">securityManager.realms = $realm1,$realm2</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can learn more about Shiro realms in the <a href="http://shiro.apache.org/realm.html">Shiro documentation</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_security_shiro-ini-realm">9.2. Shiro Ini Realm</h3>
<div class="paragraph">
<p>Probably the simplest realm to use is Shiro&#8217;s built-in <code>IniRealm</code>, which reads from the (same) <code>WEB-INF/shiro.ini</code> file.</p>
</div>
<div class="paragraph">
<p>This is suitable for prototyping, but isn&#8217;t intended for production use, if only because user/password credentials are stored in plain text.  Nevertheless, it&#8217;s a good starting point.  The app generated by the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a> is configured to use this realm.</p>
</div>
<div class="paragraph">
<p>The diagram below shows the Isis and components involved:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/security/security-apis-impl/configure-shiro-to-use-ini-realm.png" alt="configure shiro to use ini realm" width="600px">
</div>
</div>
<div class="paragraph">
<p>The realm is responsible for validating the user credentials, and then creates a Shiro <a href="http://shiro.apache.org/static/latest/apidocs/org/apache/shiro/subject/Subject.html"><code>Subject</code></a> which represents the user (for the current request).  Apache Isis <code>Authenticator</code> component then interacts with the <code>Subject</code> in order to check permissions.</p>
</div>
<div class="sect3">
<h4 id="_shiro_configuration">9.2.1. Shiro Configuration</h4>
<div class="paragraph">
<p>To use the built-in <code>IniRealm</code>, we add the following to <code>WEB-INF/shiro.ini</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">securityManager.realms = $iniRealm</code></pre>
</div>
</div>
<div class="paragraph">
<p>(Unlike other realms) there is no need to "define" <code>$iniRealm</code>; it is automatically available to us.</p>
</div>
<div class="paragraph">
<p>Specifying <code>$iniRealm</code> means that the usernames/passwords, roles and permissions are read from the <code>shiro.ini</code> file itself.  Specifically:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the users/passwords and their roles from the <code>[users]</code> sections;</p>
</li>
<li>
<p>the roles are mapped to permissions in the <code>[roles]</code> section.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of these is described below.</p>
</div>
<div class="sect4">
<h5 id="__code_users_code_section"><code>[users]</code> section</h5>
<div class="paragraph">
<p>This section lists users, passwords and their roles.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">sven = pass, admin_role
dick = pass, user_role, analysis_role, self-install_role
bob  = pass, user_role, self-install_role</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first value is the password (eg "pass", the remaining values are the role(s).</p>
</div>
</div>
<div class="sect4">
<h5 id="__code_roles_code_section"><code>[roles]</code> section</h5>
<div class="paragraph">
<p>This section lists roles and their corresponding permissions.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">user_role = *:ToDoItems:*:*,\
            *:ToDoItem:*:*,\
            *:ToDoAppDashboard:*:*
analysis_role = *:ToDoItemAnalysis:*:*,\
            *:ToDoItemsByCategoryViewModel:*:*,\
            *:ToDoItemsByDateRangeViewModel:*:*
self-install_role = *:ToDoItemsFixturesService:install:*
admin_role = *</code></pre>
</div>
</div>
<div class="paragraph">
<p>The value is a comma-separated list of permissions for the role.  The format is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">packageName:className:memberName:r,w</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>memberName</code> is the property, collection or action name.</p>
</li>
<li>
<p><code>r</code> indicates that the member is visible</p>
</li>
<li>
<p><code>w</code> indicates that the member is usable (editable or invokable)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and where each of the parts of the permission string can be wildcarded using <code>*</code>.</p>
</div>
<div class="paragraph">
<p>Because these are wildcards, a '*' can be used at any level. Additionally, missing levels assume wildcards.</p>
</div>
<div class="paragraph">
<p>Thus:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">com.mycompany.myapp:Customer:firstName:r,w   # view or edit customer's firstName
com.mycompany.myapp:Customer:lastName:r      # view customer's lastName only
com.mycompany.myapp:Customer:placeOrder:*    # view and invoke placeOrder action
com.mycompany.myapp:Customer:placeOrder      # ditto
com.mycompany.myapp:Customer:*:r             # view all customer class members
com.mycompany.myapp:*:*:r                    # view-only access for all classes in myapp package
com.mycompany.myapp:*:*:*                    # view/edit for all classes in myapp package
com.mycompany.myapp:*:*                      # ditto
com.mycompany.myapp:*                        # ditto
com.mycompany.myapp                          # ditto
*                                            # view/edit access to everything</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The format of the permissions string is configurable in Shiro, and Apache Isis uses this to provide an extended wildcard format, described <a href="#_ug_security_shiro-isis-enhanced-wildcard-permission">here</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_externalized_inirealm">9.2.2. Externalized IniRealm</h4>
<div class="paragraph">
<p>There&#8217;s no requirement for all users/roles to be defined in the <code>shiro.ini</code> file.  Instead, a realm can be defined that loads its users/roles from some other resource.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">$realm1=org.apache.shiro.realm.text.IniRealm <i class="conum" data-value="1"></i><b>(1)</b>
realm1.resourcePath=classpath:webapp/realm1.ini <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>happens to (coincidentally) be the <a href="http://shiro.apache.org/static/latest/apidocs/org/apache/shiro/realm/text/IniRealm.html">same implementation</a> as Shiro&#8217;s built-in $iniRealm</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>in this case load the users/roles from the <code>src/main/resources/webapp/realm1.ini</code> file.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that a URL could be provided as the <code>resourcePath</code>, so a centralized config file could be used.  Even so, the</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If configured this way then the <code>[users]</code> and <code>[roles]</code> sections of <code>shiro.ini</code> become unused. Instead, the corresponding sections from for <code>realm1.ini</code> are used instead.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_security_shiro-isis-ldap-realm">9.3. Isis Ldap Realm</h3>
<div class="paragraph">
<p>Isis ships with an implementation of <a href="http://shiro.apache.org">Apache Shiro</a>'s <code>Realm</code> class that allows user authentication and authorization to be performed against an LDAP server.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/security/security-apis-impl/configure-shiro-to-use-isis-ldap-realm.png" alt="configure shiro to use isis ldap realm" width="600px">
</div>
</div>
<div class="paragraph">
<p>The LDAP database stores the user/passwords and user groups, while the <code>shiro.ini</code> file is used to map the LDAP groups to roles, and to map the roles to permissions.</p>
</div>
<div class="sect3">
<h4 id="_shiro_configuration_2">9.3.1. Shiro Configuration</h4>
<div class="paragraph">
<p>To use LDAP involves telling Shiro how to instantiate the realm.  This bootstrapping info lives in the <code>WEB-INF/shiro.ini</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">contextFactory = org.apache.isis.security.shiro.IsisLdapContextFactory
contextFactory.url = ldap://localhost:10389
contextFactory.systemUsername = uid=admin,ou=system        <i class="conum" data-value="1"></i><b>(1)</b>
contextFactory.systemPassword = secret
contextFactory.authenticationMechanism = CRAM-MD5          <i class="conum" data-value="2"></i><b>(2)</b>
contextFactory.systemAuthenticationMechanism = simple

ldapRealm = org.apache.isis.security.shiro.IsisLdapRealm   <i class="conum" data-value="3"></i><b>(3)</b>
ldapRealm.contextFactory = $contextFactory

ldapRealm.searchBase = ou=groups,o=mojo                    <i class="conum" data-value="4"></i><b>(4)</b>
ldapRealm.groupObjectClass = groupOfUniqueNames            <i class="conum" data-value="5"></i><b>(5)</b>
ldapRealm.uniqueMemberAttribute = uniqueMember             <i class="conum" data-value="6"></i><b>(6)</b>
ldapRealm.uniqueMemberAttributeValueTemplate = uid={0}

# optional mapping from physical groups to logical application roles
ldapRealm.rolesByGroup = \                                 <i class="conum" data-value="7"></i><b>(7)</b>
    LDN_USERS: user_role,\
    NYK_USERS: user_role,\
    HKG_USERS: user_role,\
    GLOBAL_ADMIN: admin_role,\
    DEMOS: self-install_role

ldapRealm.permissionsByRole=\                              <i class="conum" data-value="8"></i><b>(8)</b>
   user_role = *:ToDoItemsJdo:*:*,\
               *:ToDoItem:*:*; \
   self-install_role = *:ToDoItemsFixturesService:install:* ; \
   admin_role = *

securityManager.realms = $ldapRealm</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>user accounts are searched using a dedicated service account</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>SASL (CRAM-MD5) authentication is used for this authentication</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Apache Isis' implementation of the LDAP realm.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>groups are searched under <code>ou=groups,o=mojo</code> (where <code>mojo</code> is the company name)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>each group has an LDAP objectClass of <code>groupOfUniqueNames</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>each group has a vector attribute of <code>uniqueMember</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>groups looked up from LDAP can optionally be mapped to logical roles; otherwise groups are used as role names directly</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>roles are mapped in turn to permissions</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The value of <code>uniqueMember</code> is in the form <code>uid=xxx</code>, with <code>xxx</code> being the uid of the user
* users searched under <code>ou=system</code>
* users have, at minimum, a <code>uid</code> attribute and a password
* the users credentials are used to verify their user/password</p>
</div>
<div class="paragraph">
<p>The above configuration has been tested against <a href="http://directory.apache.org/apacheds/">ApacheDS</a>, v1.5.7. This can be administered using <a href="http://directory.apache.org/studio/">Apache Directory Studio</a>, v1.5.3.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Shiro Realm Mappings</div>
<div class="paragraph">
<p>When configuring role based permission mapping, there can only be one of these entries per realm:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">realm.groupToRolesMappings = ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">realm.roleToPermissionsMappings = ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This forces you to put everything on one line for each of the above.  This is, unfortunately, a Shiro "feature".  And if you repeat the entries above then it&#8217;s "last one wins".)</p>
</div>
<div class="paragraph">
<p>To make the configuration maintainable, use "\" to separate the mappings onto separate lines in the file.  Use this technique for both group to roles mapping and role to permission mapping. If you use the '&#39; after the "," that separates the key:value pairs it is more readable.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_externalizing_role_perms">9.3.2. Externalizing role perms</h4>
<div class="paragraph">
<p>As an alternative to injecting the <code>permissionsByRole</code> property, the role/permission mapping can alternatively be specified by injecting a resource path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">ldapRealm.resourcePath=classpath:webapp/myroles.ini</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>myroles.ini</code> is in <code>src/main/resources/webapp</code>, and takes the form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">[roles]
user_role = *:ToDoItemsJdo:*:*,\
            *:ToDoItem:*:*
self-install_role = *:ToDoItemsFixturesService:install:*
admin_role = *</code></pre>
</div>
</div>
<div class="paragraph">
<p>This separation of the role/mapping can be useful if Shiro is configured to support multiple realms (eg an LdapRealm based one and also an TextRealm)</p>
</div>
</div>
<div class="sect3">
<h4 id="_active_ds_ldap_tutorial">9.3.3. Active DS LDAP tutorial</h4>
<div class="paragraph">
<p>The screenshots below show how to setup LDAP accounts in ApacheDS using the Apache Directory Studio.</p>
</div>
<div class="paragraph">
<p>The setup here was initially based on <a href="http://krams915.blogspot.co.uk/2011/01/ldap-apache-directory-studio-basic.html">this tutorial</a>, however we have moved the user accounts so that they are defined in a separate LDAP node.</p>
</div>
<div class="paragraph">
<p>To start, create a partition in order to hold the mojo node (holding the groups):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images//configuration/configuring-shiro/ldap/activeds-ldap-mojo-partition.png" alt="ActiveDS LDAP Users">
</div>
</div>
<div class="paragraph">
<p>Create the <code>ou=groups,o=mojo</code> hierarchy:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images//configuration/configuring-shiro/ldap/activeds-ldap-mojo-root-dse.png" alt="ActiveDS LDAP Users">
</div>
</div>
<div class="paragraph">
<p>Configure SASL authentication. This means that the checking of user/password is done implicitly by virtue of Apache Isis connecting to LDAP using these credentials:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images//configuration/configuring-shiro/ldap/activeds-ldap-sasl-authentication.png" alt="ActiveDS LDAP Users">
</div>
</div>
<div class="paragraph">
<p>In order for SASL to work, it seems to be necessary to put users under <code>o=system</code>. (This is why the setup is slightly different than the tutorial mentioned above):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images//configuration/configuring-shiro/ldap/activeds-ldap-users.png" alt="ActiveDS LDAP Users">
</div>
</div>
<div class="paragraph">
<p>Configure the users into the groups:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images//configuration/configuring-shiro/ldap/activeds-ldap-groups.png" alt="ActiveDS LDAP Users">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_security_shiro-isisaddons-security-module-realm">9.4. Security Module Realm</h3>
<div class="paragraph">
<p>The <a href="https://github.com/isisaddons/isis-module-security">Isis Addons' security module</a> (not ASF) provides a complete
security subdomain for users, roles, permissions; all are persisted as domain entities.</p>
</div>
<div class="paragraph">
<p>What that means, of course, that they can also be administered through your Isis application.  Moreover, the set of permissions (to features) is derived completely from your application&#8217;s metamodel; in essence the permissions are "type-safe".</p>
</div>
<div class="paragraph">
<p>In order to play along, the module includes a Shiro realm, which fits in as follows:</p>
</div>
<div class="paragraph">
<p>The general configuration is as follows:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/security/security-apis-impl/configure-shiro-to-use-isisaddons-security-module-realm.png" alt="configure shiro to use isisaddons security module realm" width="600px">
</div>
</div>
<div class="paragraph">
<p>where the <code>IsisModuleSecurityRealm</code> realm is the implementation provided by the module.</p>
</div>
<div class="paragraph">
<p>In the configuration above user passwords are stored in the database.  The module uses <a href="http://www.mindrot.org/projects/jBCrypt/">jBCrypt</a> so that passwords are only stored in a (one-way) encrypted form in the database.</p>
</div>
<div class="paragraph">
<p>The security module also supports a slightly more sophisticated configuration.  Most organizations use LDAP for user credentials, and maintaining two separate user accounts would be less than ideal.  The <code>IsisModuleSecurityRealm</code> can therefore be configured with a subsidiary "delegate" realm that is responsible for performing the primary authentication of the user; if that passes then a user is created (as a domain entity) automatically.
In most cases this delegate realm will be the LDAP realm, and so the architecture becomes:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/security/security-apis-impl/configure-shiro-to-use-isisaddons-security-module-realm-with-delegate-realm.png" alt="configure shiro to use isisaddons security module realm with delegate realm" width="600px">
</div>
</div>
<div class="paragraph">
<p>The security module has many more features than are described here, all of which are described in the module&#8217;s <a href="https://github.com/isisaddons/isis-module-security">README</a>.  The README also explains in detail how to configure an existing app to use this module.</p>
</div>
<div class="paragraph">
<p>You can also look at the Isisaddons <a href="https://github.com/isisaddons/isis-app-todoapp">todoapp example</a> (not ASF), which is preconfigured to use the security module.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ug_security_shiro-jdbc-realm">9.5. Shiro JDBC Realm</h3>
<div class="paragraph">
<p>There is nothing to stop you from using some other <code>Realm</code> implementation (or indeed writing one yourself).  For example, you could use Shiro&#8217;s own JDBC realm that loads user/password details from a database.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are happy to use a database then we strongly recommend you use the <a href="http://github.com/isisaddons/isis-module-security">Isis addons' security</a> module instead of a vanilla JDBC; it is far more sophisticated and moreover gives you the ability to administer the system from within your Isis application.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you go down this route, then the architecture is as follows:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/security/security-apis-impl/configure-shiro-to-use-custom-jdbc-realm.png" alt="configure shiro to use custom jdbc realm" width="600px">
</div>
</div>
<div class="paragraph">
<p>There&#8217;s quite a lot of configuration required (in <code>WEB-INF/shiro.ini</code>) to set up a JDBC realm, so we&#8217;ll break it out into sections.</p>
</div>
<div class="paragraph">
<p>First, we need to set up the connection to JDBC:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">jdbcRealm=org.apache.shiro.realm.jdbc.JdbcRealm        <i class="conum" data-value="1"></i><b>(1)</b>

jof = org.apache.shiro.jndi.JndiObjectFactory          <i class="conum" data-value="2"></i><b>(2)</b>
jof.resourceName = jdbc/postgres                       <i class="conum" data-value="3"></i><b>(3)</b>
jof.requiredType = javax.sql.DataSource
jof.resourceRef = true

jdbcRealm.dataSource = $jof                            <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>instantiate the JDBC realm</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>instantiate factory object to lookup DataSource from servlet container</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>name of the datasource (as configured in <code>web.xml</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>instruct JDBC realm to obtain datasource from the JNDI</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We next need to tell the realm how to query the database.  Shiro supports any schema; what matters is the input search argument and the output results.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">jdbcRealm.authenticationQuery =         \              <i class="conum" data-value="1"></i><b>(1)</b>
        select password                 \
          from users                    \
         where username = ?

jdbcRealm.userRolesQuery =              \              <i class="conum" data-value="2"></i><b>(2)</b>
        select r.label                  \
          from users_roles ur           \
    inner join roles r                  \
            on ur.role_id = r.id        \
         where user_id = (              \
            select id                   \
             from users                 \
            where username = ?);        \

jdbcRealm.permissionsQuery=             \               <i class="conum" data-value="3"></i><b>(3)</b>
        select p.permission             \
          from roles_permissions rp     \
    inner join permissions p            \
            on rp.permission_id = p.id  \
         where rp.role_id = (           \
            select id                   \
             from roles                 \
            where label = ?);

jdbcRealm.permissionsLookupEnabled=true                 <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>query to find password for user</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>query to find roles for user</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>query to find permissions for role</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>enable permissions lookup</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>permissionsLookupEnabled</code> is very important, otherwise Shiro just returns an empty list of permissions and your users will have no access to any features(!).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We also should ensure that the passwords are not stored as plain-text:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">dps = org.apache.shiro.authc.credential.DefaultPasswordService   <i class="conum" data-value="1"></i><b>(1)</b>
pm = org.apache.shiro.authc.credential.PasswordMatcher           <i class="conum" data-value="2"></i><b>(2)</b>
pm.passwordService = $dps
jdbcRealm.credentialsMatcher = $pm                               <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mechanism to encrypts password</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>service to match passwords</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>instruct JDBC realm to use password matching service when authenticating</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And finally we need to tell Shiro to use the realm, in the usual fashion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">securityManager.realms = $jdbcRealm</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the above configuration you will also need to setup a <code>DataSource</code>.  The details vary by servlet container, for example this is <a href="https://tomcat.apache.org/tomcat-8.0-doc/jndi-datasource-examples-howto.html">how to do the setup on Tomcat 8.0</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The name of the <code>DataSource</code> can also vary by servlet container; see for example <a href="http://stackoverflow.com/questions/17441019/how-to-configure-jdbcrealm-to-obtain-its-datasource-from-jndi/23784702#23784702">this StackOverflow answer</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ug_security_shiro-isis-enhanced-wildcard-permission">9.6. Enhanced Wildcard Permission</h3>
<div class="paragraph">
<p>If using the text-based <a href="#_ug_security_shiro-ini-realm"><code>IniRealm</code></a> or <a href="#_ug_security_shiro-isis-ldap-realm">Isis' LDAP realm</a>, then note that Shiro also allows the string representation of the permissions to be mapped (resolved) to alternative <code>Permission</code> instances.  Apache Isis provides its own <code>IsisPermission</code> which introduces the concept of a "veto".</p>
</div>
<div class="paragraph">
<p>A vetoing permission is one that prevents access to a feature, rather than grants it.  This is useful in some situations where most users have access to most features, and only a small number of features are particularly sensitive.  The configuration can therefore be set up to grant fairly broad-brush permissions and then veto permission for the sensitive features for those users that do not have access.</p>
</div>
<div class="paragraph">
<p>The string representation of the <code>IsisPermission</code> uses the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">([!]?)([^/]+)[/](.+)</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the optional <code>!</code> prefix indicates this permission is a vetoing permission</p>
</li>
<li>
<p>the optional <code>xxx/</code> prefix is a permission group that scopes any vetoing permissions</p>
</li>
<li>
<p>the remainder of the string is the permission (possibly wildcarded, with :rw as optional suffix)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">user_role   = !reg/org.estatio.api,\
              !reg/org.estatio.webapp.services.admin,\
              reg/* ; \
api_role    = org.estatio.api ;\
admin_role = adm/*</code></pre>
</div>
</div>
<div class="paragraph">
<p>sets up:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>user_role</code> with access to all permissions except those in <code>org.estatio.api</code> and <code>org.estatio.webapp.services.admin</code></p>
</li>
<li>
<p>the <code>api_role</code> with access to all permissions in <code>org.estatio.api</code></p>
</li>
<li>
<p>the <code>admin_role</code> with access to everything.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The permission group concept is required to scope the applicability of any veto permission. This is probably best explained by an example.  Suppose that a user has both <code>admin_role</code> and <code>user_role</code>; we would want the <code>admin_role</code> to trump the vetos of the <code>user_role</code>, in other words to give the user access to everything.</p>
</div>
<div class="paragraph">
<p>Because of the permission groups, the two "!reg/...+""" vetos in user_role only veto out selected permissions granted by the "reg/<strong>" permissions, but they do not veto the permissions granted by a different scope, namely "adm/</strong>+".</p>
</div>
<div class="paragraph">
<p>The net effect is therefore what we would want: that a user with both <code>admin_role</code> and <code>user_role</code> would have access to everything, irrespective of those two veto permissions of the <code>user_role</code>.</p>
</div>
<div class="paragraph">
<p>Finally, the Apache Isis permission resolver is specified in <code>WEB-INF/shiro.ini</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">permissionResolver = org.apache.isis.security.shiro.authorization.IsisPermissionResolver
myRealm.permissionResolver = $permissionResolver  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>myRealm</code> is the handle to the configured realm, eg <code>$iniRealm</code> or <code>$isisLdapRealm</code> etc.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ug_security_configuring-isis-to-use-bypass">9.7. Bypassing security</h3>
<div class="paragraph">
<p>The bypass security component consists of an implementation of both the <code>AuthenticationManager</code> and <code>AuthorizationManager</code> APIs, and are intended for prototyping use only.</p>
</div>
<div class="paragraph">
<p>The authentication manager allows access with any credentials (in a sense, "bypassing" authentication), while the authorization manager provides access to all class members (in a sense, "bypassing" authorization).</p>
</div>
<div class="paragraph">
<p>To tell Apache Isis to bypass security, just update the <code>WEB-INF/isis.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.authentication=bypass
isis.authorization=bypass</code></pre>
</div>
</div>
<div class="paragraph">
<p>This installs the appropriate no-op implementations for both authentication and authorization:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/security/security-apis-impl/configure-isis-to-use-bypass.png" alt="configure isis to use bypass" width="600px">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_security_api-for-applications">9.8. API for Applications</h3>
<div class="paragraph">
<p>Generally speaking your domain objects (or more generally your application) should be agnostic of the user/roles that are interacting with them; applying security permissions is the responsibility of the framework.</p>
</div>
<div class="paragraph">
<p>Still, on very rare occasion you may have a need, in which case you can either use Apache Isis' <code>DomainObjectContainer</code> API or you can reach further down the stack and use the JEE Servlet API.</p>
</div>
<div class="sect3">
<h4 id="__code_domainobjectcontainer_code_api">9.8.1. <code>DomainObjectContainer</code> API</h4>
<div class="paragraph">
<p>The <a href="rg.html#_rg_services-api_manpage-DomainObjectContainer"><code>DomainObjectContainer</code></a> service exposes the following API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> UserMemento user = container.getUser();
<span class="directive">final</span> <span class="predefined-type">List</span>&lt;RoleMemento&gt; roles = user.getRoles();
<span class="keyword">for</span> (RoleMemento role : roles) {
    <span class="predefined-type">String</span> roleName = role.getName();
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each role&#8217;s <code>name</code> property encodes both the realm that provided the role, and the role identity itself.</p>
</div>
<div class="paragraph">
<p>For example, in the simpleapp, if logging in as <code>dick</code> with the following entries for <code>realm1</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">dick = pass, user_role, analysis_role, self-install_role</code></pre>
</div>
</div>
<div class="paragraph">
<p>then this corresponds to the roles "realm1:user_role", "realm1:self-install_role" and "realm1:analysis_role".</p>
</div>
<div class="paragraph">
<p>If using the Wicket viewer, then note there will also be another role which is used internally (namely "org.apache.isis.viewer.wicket.roles.USER").</p>
</div>
</div>
<div class="sect3">
<h4 id="_servlet_api">9.8.2. Servlet API</h4>
<div class="paragraph">
<p>On occasion you may find it necessary to reach below Isis and to the underlying servlet API.  For example, the <a href="http://github.com/isisaddons/isis-module-togglz">Isis addons' togglz</a> module (non-ASF) has a requirement to do this in order to expose its embedded togglz web console.  (</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you do need to access the servlet API and are running within the context of Wicket viewer, the <a href="http://github.com/isisaddons/isis-module-servletapi">Isis addons' servletapi</a> module can provide access to the <code>HttpServletRequest</code>, <code>HttpServletResponse</code> and <code>ServletContext</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this situation, you can still obtain some information about the user and its roles:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Principal</span> principal = httpServletRequest.getPrincipal();
<span class="predefined-type">String</span> username = principal.getName();
<span class="type">boolean</span> analyst = httpServletRequest.isUserInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">analysis_role</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, it isn&#8217;t possible to obtain any role permissions for the user.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_security_usage-by-isis-viewers">9.9. Usage by Apache Isis' Viewers</h3>
<div class="paragraph">
<p>By and large the security mechanisms within Isis are transparent to the rest of the framework (the <a href="#_ug_wicket-viewer">Wicket Viewer</a> and <a href="#_ug_restfulobjects-viewer">Restful Objects viewer</a>, and the overall <a href="rg.html#_rg_runtime">runtime</a>).</p>
</div>
<div class="paragraph">
<p>That said, it is the responsibility of the viewers to ensure that there is a viewers to ensure that for each request there is a valid user session present.  The sections below explain how this works.</p>
</div>
<div class="sect3">
<h4 id="_wicket_viewer">9.9.1. Wicket Viewer</h4>
<div class="paragraph">
<p>The <a href="#_ug_wicket-viewer">Wicket viewer</a> defines a relatively small number of pages (by which we mean subclasses of <a href="http://ci.apache.org/projects/wicket/apidocs/6.0.x/org/apache/wicket/markup/html/WebPage.html"><code>org.apache.wicket.markup.html.WebPage</code></a>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>about page</p>
</li>
<li>
<p>action prompt page</p>
</li>
<li>
<p>entity page</p>
</li>
<li>
<p>error page</p>
</li>
<li>
<p>home page</p>
</li>
<li>
<p>standalone collection page</p>
</li>
<li>
<p>value page</p>
</li>
<li>
<p>void return page</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All of these (except about page) are annotated with the Wicket annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@AuthorizeInstantiation</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.isis.viewer.wicket.roles.USER</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>which means that they can only be accessed by a user with an authenticated session that has this special, reserved role.  If not, Wicket will automatically redirect the user to the sign-in page.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The sign-in page to render is pluggable; see <a href="#_ug_extending_wicket-viewer_custom-pages">extensions chapter</a> for details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the sign-in page the viewer calls to the Isis Authenticator API, and obtains back a user/role.  It also adds in its special reserved role (per the annotation above) and then continues on to whichever page the user was attempting to access (usually the home page).</p>
</div>
<div class="paragraph">
<p>And that&#8217;s really all there is to it.  When the viewer renders a domain object it queries the Apache Isis metamodel, and suppresses from the view any object members (properties, actions etc) that are invisible.  These may be invisible because the user has no (read ) permission, or they may be invisible because of domain object logic (eg a <code>hideXxx()</code> method).  The viewer neither knows nor cares.</p>
</div>
<div class="paragraph">
<p>Similarly, for those object members that <em>are</em> visible, the viewer also checks if they are enabled or disabled.  Again, an object member will be disabled if the user does not have (write) permission, or it could be disabled because of domain object logic (eg a <code>disableXxx()</code> method).</p>
</div>
<div class="sect4">
<h5 id="_user_registration">User-registration</h5>
<div class="paragraph">
<p>As well as providing a sign-in screen, the Wicket viewer also provides the ability for <a href="#_user_registration">users to self-register</a>.  By and large this operates outside of Apache Isis' security mechanisms; indeed the various pages (sign-up, sign-up verification, password reset) are all rendered <em>without</em> there being any current user session.  These pages all "reach inside" Apache Isis framework using a mechanism similar to <a href="#_ug_headless-access">Headless access</a> in order to actually do their stuff.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The sign-in verification page to render is pluggable; see <a href="#_ug_extending_wicket-viewer_custom-pages">extensions chapter</a> for details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>User registration is only available if the <a href="rg.html#_rg_services-spi_manpage-UserRegistrationService"><code>UserRegistrationService</code></a> is configured; this is used by the framework to actually create new instances of the user as accessed by the corresponding (Shiro) realm.</p>
</div>
<div class="paragraph">
<p>Because Shiro realms are pluggable, the Apache Isis framework does not provide default implementations of this service.  However, if you are using the <a href="http://github.com/isisaddons/isis-module-security">Isis addons' security</a> module (non-ASF), then this module <em>does</em> provide an implementation (that, as you might expect, creates new "user" domain entities).</p>
</div>
<div class="paragraph">
<p>If you are using an LDAP realm and want to enable user-self registration then you&#8217;ll need to write your own implementation of this service.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_restful_objects_viewer">9.9.2. Restful Objects Viewer</h4>
<div class="paragraph">
<p>Unlike the Wicket viewer, the <a href="#_ug_restfulobjects-viewer">Restful Objects viewer</a> does <strong>not</strong> provide any sort of login page; rather it provides a pluggable authentication strategy, delegated to by the <code>IsisSessionFilter</code> filter defined in <code>web.xml</code>.  The authentication strategy is responsible for ensuring that a session is available for the REST resource.</p>
</div>
<div class="paragraph">
<p>The API of <code>AuthenticationSessionStrategy</code> is simply:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.apache.isis.core.webapp.auth</span>;
...
public <span class="type">interface</span> <span class="class">AuthenticationSessionStrategy</span> {
    AuthenticationSession lookupValid(     <i class="conum" data-value="1"></i><b>(1)</b>
        ServletRequest servletRequest,
        ServletResponse servletResponse);
    <span class="type">void</span> bind(                             <i class="conum" data-value="2"></i><b>(2)</b>
        ServletRequest servletRequest,
        ServletResponse servletResponse,
        AuthenticationSession authSession);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>returns a valid <code>AuthenticationSession</code> for the specified request, response</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>binds (associates the provided <code>AuthenticationSession</code>) to the request and response</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here <code>AuthenticationSession</code> is Apache Isis' internal API that represents a signed-on user.</p>
</div>
<div class="paragraph">
<p>The framework provides a number of simple strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AuthenticationSessionStrategyBasicAuth</code> implements the HTTP basic auth protocol (the pop-up dialog box shown by the web browser)</p>
</li>
<li>
<p><code>AuthenticationSessionStrategyHeader</code> that simply reads the user identity from an HTTP header</p>
</li>
<li>
<p><code>AuthenticationSessionStrategyTrusted</code> that always logs in with a special "exploration" user</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As you can see, none of these should be considered production-quality.</p>
</div>
<div class="paragraph">
<p>The strategy is configured in <code>web.xml</code>; for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>IsisSessionFilterForRestfulObjects<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;filter-class&gt;</span>org.apache.isis.core.webapp.IsisSessionFilter<span class="tag">&lt;/filter-class&gt;</span>
    <span class="tag">&lt;init-param&gt;</span>
        <span class="tag">&lt;param-name&gt;</span>authenticationSessionStrategy<span class="tag">&lt;/param-name&gt;</span>
        <span class="tag">&lt;param-value&gt;</span>                                           <i class="conum" data-value="1"></i><b>(1)</b>
    org.apache.isis.viewer.restfulobjects.server.authentication.AuthenticationSessionStrategyBasicAuth
        <span class="tag">&lt;/param-value&gt;</span>
    <span class="tag">&lt;/init-param&gt;</span>
    <span class="tag">&lt;init-param&gt;</span>
        <span class="tag">&lt;param-name&gt;</span>whenNoSession<span class="tag">&lt;/param-name&gt;</span>
        <span class="tag">&lt;param-value&gt;</span>basicAuthChallenge<span class="tag">&lt;/param-value&gt;</span>           <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tag">&lt;/init-param&gt;</span>
<span class="tag">&lt;/filter&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>configure basic auth strategy</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>what to do if no session was found; we indicate to issue a 401 basic authentication challenge</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>IsisSessionFilter</code> has a further plugin point if no session was found (that is, if <code>AuthenticationSessionStrategy#lookupValid()</code> returns null), which is how to respond.  The value "basicAuthChallenge" means to return a 401, which is what triggers the web browser to pop-up the basic HTTP challenge dialog box.</p>
</div>
<div class="paragraph">
<p>The above filter must then be chained before the servlet that actually handles the REST requests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter-mapping&gt;</span>
    <span class="tag">&lt;filter-name&gt;</span>IsisSessionFilterForRestfulObjects<span class="tag">&lt;/filter-name&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>RestfulObjectsRestEasyDispatcher<span class="tag">&lt;/servlet-name&gt;</span>
<span class="tag">&lt;/filter-mapping&gt;</span>
...
<span class="tag">&lt;servlet&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>RestfulObjectsRestEasyDispatcher<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;servlet-class&gt;</span>org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher<span class="tag">&lt;/servlet-class&gt;</span>
<span class="tag">&lt;/servlet&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The above <code>web.xml</code> fragments do <em>not</em> constitute the full configuration for the Restful Objects viewer, just those parts that pertain to security.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_user_registration_2">User-registration</h5>
<div class="paragraph">
<p>Isis currently does not have any out-of-the-box support for user-registration for applications using only the Restful viewer.  However, in principal the pieces do exist to put together a solution.</p>
</div>
<div class="paragraph">
<p>The general idea is similar to the design of the Wicket viewer; define some subsidiary resources that can operate <em>without</em> a user session in place, and which "reach into" the framework using headless access in order to setup the user.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An alternative approach, possibly less work and overall of more value, would be to implement <code>AuthenticationSessionStrategy</code> for oAuth, in other words allow users to use their existing Google or Facebook account.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following steps sketch out the solution in a little more detail:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define some new Restful resources (cf <a href="https://github.com/apache/isis/blob/master/core/viewer-restfulobjects-server/src/main/java/org/apache/isis/viewer/restfulobjects/server/resources/DomainObjectResourceServerside.java"><code>DomainServiceResourceServerside</code></a> that correspond to sign-up/register page, eg <code>SignupResource</code><br></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/signup</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SignupResource</span> {
    ...
}</code></pre>
</div>
</div>
</li>
<li>
<p>Create a new subclass of <code>RestfulObjectsApplication</code>, eg "CustomRestfulObjectsApplication" and register your resources<br></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomRestfulObjectsApplication</span> <span class="directive">extends</span> RestfulObjectsApplication {
    <span class="directive">public</span> CustomRestfulObjectsApplication() {
        addClass(SignupResource.class);
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Register your application class in <code>web.xml</code> instead of the default:<br></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>javax.ws.rs.Application<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>com.mycompany.myapp.CustomRestfulObjectsApplication<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>So far this is just standard javax.rs stuff.</p>
</div>
<div class="paragraph">
<p>Next, we need to ensure that a client can hit your new resource <strong>with</strong> the Apache Isis runtime in place, but without there being an Apache Isis session.  For that&#8230;&#8203;.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>create a subclass of the <code>AuthenticationSessionStrategy</code> that automatically returns a dummy session if the resource being accessed is "/restful/signup", say. <br></p>
<div class="paragraph">
<p>You could do this by subclassing <code>AuthenticationSessionStrategyBasicAuth</code>, but then using code from <code>AuthenticationSessionStrategyBasicAuth</code> to return an "exploration" (or better, "signup") session if accessing the "/restful/signup" resource.</p>
</div>
</li>
<li>
<p>in the <code>SignUpResource</code> resource, you can then do a lookup of the <code>UserRegistrationService</code> in order to allow the user to be created:<br></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> UserRegistrationService userRegistrationService =
    IsisContext.getPersistenceSession().getServicesInjector().lookupService(UserRegistrationService.class);
userRegistrationService.registerUser(userDetails);</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Obviously the methods exposed by the <code>SignupResource</code> are up to you; ultimately they need to be able to gather information to populate the <code>UserDetails</code> object as passed to the <code>UserRegistrationService</code>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ug_isis-maven-plugin">10. Apache Isis Maven Plugin</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ug_deployment">11. Deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides guidance on some common deployment scenarios.</p>
</div>
<div class="sect2">
<h3 id="_ug_deployment_cmd-line">11.1. Command Line</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="__code_webserver_code_class">11.1.1. <code>WebServer</code> class</h4>
<div class="paragraph">
<p>The <code>org.apache.isis.WebServer</code> utility class provides a <code>main(String[])</code> method so that an Apache Isis application can be run from within the IDE or command line, without the need to package the app as a WAR file and deploying to a servlet container.  Internally the class it uses jetty to programmatically bootstrap the app.</p>
</div>
<div class="paragraph">
<p>The utility class also supports a number of command line arguments:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. Command line args for <code>org.apache.isis.Webserver</code></caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Long format</th>
<th class="tableblock halign-left valign-top">Values (default)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>server_prototype</code>,<code>server</code><br>
(<code>server</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deployment type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--fixture</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-u</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--user</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-p</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--password</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-D</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additional property, in form <code>-Dxxx=yyy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--help</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The utility class also supports a number of other flags, but their usage is extremely rare (and some may be removed in the future):</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. Command line args for <code>org.apache.isis.Webserver</code></caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Long format</th>
<th class="tableblock halign-left valign-top">Values (default)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-l</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--reflector</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FQCN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementing <code>ObjectReflectorInstaller</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-r</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--persistor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FQCN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implementing <code>PersistenceMechanismInstaller</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--config</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--nosplash</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--diagnostics</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--version</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--debug</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--verbose</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--quiet</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="__code_dummy_code_class">11.1.2. <code>Dummy</code> class</h4>
<div class="paragraph">
<p><code>org.apache.isis.Dummy</code></p>
</div>
<div class="paragraph">
<p>etc&#8230;&#8203;</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_deployment_tomcat">11.2. Deploying to Tomcat</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_externalized_configuration">11.2.1. Externalized Configuration</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_jvm_args">11.2.2. JVM Args</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>for the <code>WrapperFactory</code> (uses <a href="http://www.javassist.org">Javassist</a>)</p>
</div>
<div class="paragraph">
<p>using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">-XX:+CMSClassUnloadingEnabled -XX:+UseConcMarkSweepGC</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can hint the JVM to unload dynamically created classes which ClassLoaders are still around.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_a_jndi_datasource">11.2.3. Using a JNDI Datasource</h4>
<div class="paragraph">
<p>See the guidance in the <a href="rg.html#_rg_runtime_configuring-datanucleus_using-jndi-data-source">configuring datanucleus</a> section.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_deployment_externalized-configuration">11.3. Externalized Configuration</h3>
<div class="paragraph">
<p>As described <a href="rg.html#_rg_runtime_configuration-files">here</a>, by default Apache Isis itself bootstraps from the <code>isis.properties</code> configuration file.  It will also read configuration from the (optional) component/implementation-specific configuration files (such as
<code>persistor_datanucleus.properties</code> or <code>viewer_wicket.properties</code>), and also (optional) component-specific configuration
files (such as <code>persistor.properties</code> or <code>viewer.properties</code>).</p>
</div>
<div class="paragraph">
<p>By default these are read from the <code>WEB-INF</code> directory. Having this configuration "baked into" the application is
okay in a development environment, but when the app needs to be deployed to a test or production environment, this
configuration should be read from an external location.</p>
</div>
<div class="paragraph">
<p>There are in fact several frameworks involved here, all of which need to be pointed to this external location:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apache Isis itself, which (as already discussed) reads <code>isis.properties</code> and optional component-specific config files.</p>
</li>
<li>
<p><a href="http://shiro.apache.org">Apache Shiro</a>,  which reads the <code>shiro.ini</code> file (and may read other files referenced from that file)</p>
</li>
<li>
<p><a href="http://logging.apache.org/log4j/1.2">Apache log4j 1.2</a>, for logging, which reads <code>logging.properties</code> file</p>
</li>
<li>
<p>although not used by Apache Isis, there&#8217;s a good chance you may be using the Spring framework (eg if using <a href="http://activemq.apache.org">Apache Active MQ</a> or <a href="http://camel.apache.org">Apache Camel</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of these frameworks has its own way of externalizing its configuration.</p>
</div>
<div class="sect3">
<h4 id="_ug_deployment_externalized-configuration_Isis">11.3.1. Apache Isis' Config</h4>
<div class="paragraph">
<p>To tell Apache Isis to load configuration from an external directory, specify the <code>isis.config.dir</code> context parameter.</p>
</div>
<div class="paragraph">
<p>If the external configuration directory is fixed for all environments (systest, UAT, prod etc), then you can specify within the <code>web.xml</code> itself:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>isis.config.dir<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>location of external config directory<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If however the configuration directory varies by environment, then the context parameter will be specified to each installation of your servlet container. Most (if not all) servlet containers will provide a means to define context parameters through proprietary config files.</p>
</div>
<div class="paragraph">
<p>For example, if using Tomcat 7.0, you would typically copy the empty <code>$TOMCAT_HOME/webapps/conf/context.xml</code> to a file specific to the webapp, for example <code>$TOMCAT_HOME/webapps/conf/todo.xml</code>. The context parameter would then be specified by adding the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;Parameter</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">isis.config.dir</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/usr/local/tomcat/myapp/conf/</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">override</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For more detail, see the Tomcat documentation on <a href="http://tomcat.apache.org/tomcat-7.0-doc/config/context.html#Defining_a_context">defining a context</a> and on <a href="http://tomcat.apache.org/tomcat-7.0-doc/config/context.html#Context_Parameters">context parameters</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that running the app using Apache Isis' <code>org.apache.isis.WebServer</code> bootstrapper currently does not externalized Apache Isis configuration.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_deployment_externalized-configuration_Shiro">11.3.2. Shiro Config</h4>
<div class="paragraph">
<p>If using Apache Isis' <a href="#_ug_security_configuring-isis-to-use-shiro">Shiro integration</a> for authentication and/or authorization, note that it reads from the <code>shiro.ini</code> configuration file. By default this also resides in <code>WEB-INF</code>.</p>
</div>
<div class="paragraph">
<p>Similar to Apache Isis, Shiro lets this configuration directory be altered, by specifying the <code>shiroConfigLocations</code> context parameter.</p>
</div>
<div class="paragraph">
<p>You can therefore override the default location using the same technique as described above for Apache Isis' <code>isis.config.dir</code> context parameter. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;Parameter</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">shiroConfigLocations</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file:/usr/local/myapp/conf/shiro.ini</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">override</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that Shiro is more flexible than Apache Isis; it will read its configuration from any URL, not just a directory on the local filesystem.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_deployment_externalized-configuration_Log4j">11.3.3. Log4j Config</h4>
<div class="paragraph">
<p>By default Apache Isis configures log4j to read the <code>logging.properties</code> file in the <code>WEB-INF</code> directory. This can be overridden by setting the <code>log4j.properties</code> system property to the URL of the log4j properties file.</p>
</div>
<div class="paragraph">
<p>For example, if deploying to Tomcat7, this amounts to adding the following to the <code>CATALINA_OPTS</code> flags:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">export CATALINA_OPTS=&quot;-Dlog4j.configuration=/usr/local/tomcat/myapp/conf/logging.properties&quot;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>CATALINA_OPTS</code> was called <code>TOMCAT_OPTS</code> in earlier versions of Tomcat.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Further details an be found in the <a href="https://logging.apache.org/log4j/1.2/manual.html#Example_Configurations">log4j documentation</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_spring_config">11.3.4. Spring Config</h4>
<div class="paragraph">
<p>Although Apache Isis does not use Spring, it&#8217;s possible that your app may use other components that do use Spring.  For example, the (non-ASF) <a href="http://github.com/isisaddons/isis-module-publishmq">Isis addons' publishmq</a> module uses ActiveMQ and Camel to support publishing; both of these leverage Spring.</p>
</div>
<div class="paragraph">
<p>There are several ways to externalized Spring config, but the mechanism described here is similar in nature to those that we use for externalizing Apache Isis' and Shiro&#8217;s configuration.  In your <code>web.xml</code>, you will probably load the Spring application context using code such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;listener&gt;</span>
    <span class="tag">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/listener-class&gt;</span>
<span class="tag">&lt;/listener&gt;</span>
<span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>contextConfigLocation<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>
        classpath:my-application-context-config.xml
    <span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Add a new application context <code>propertyPlaceholderConfigurer-config.xml</code> defining a <code>PropertyPlaceholderConfigurer</code> bean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span>
  <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
  <span class="content">http://activemq.apache.org/schema/core http://activemq.apache.org/schema/core/activemq-core.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.PropertyPlaceholderConfigurer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">locations</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;list&gt;</span>
                <span class="tag">&lt;value&gt;</span>${spring.config.file}<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;/list&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This reads the properties from a <code>spring.config.file</code>, defined as a context-param in the <code>web.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>spring.config.file<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>classpath:spring.properties<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then update the bootstrapping in <code>web.xml</code> to use this new application context, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>contextConfigLocation<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>
        classpath:my-application-context-config.xml,
        classpath:propertyPlaceholderConfigurer-config.xml
    <span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To use some other externalized configuration, override the <code>spring.config.file</code> property, eg using Tomcat&#8217;s config file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;Parameter</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">spring.config.dir</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file:/usr/local/myapp/conf/spring.properties</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">override</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_an_alternative_approach">An alternative approach</h5>
<div class="paragraph">
<p>As mentioned, there are several other ways to externalize Spring&#8217;s config; one approach is to use Spring&#8217;s profile support.</p>
</div>
<div class="paragraph">
<p>For example, in the application context you could have:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">profile</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.PropertyPlaceholderConfigurer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">locations</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;list&gt;</span>
                <span class="tag">&lt;value&gt;</span>classpath:dev.properties<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;/list&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/beans&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">profile</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">externalized</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">propertyPlaceHolder</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.PropertyPlaceholderConfigurer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">locations</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;list&gt;</span>
                <span class="tag">&lt;value&gt;</span>classpath:prod.properties<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;/list&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The idea being that specifying the "prod" profile rather than the "default" profile would cause a different set of configuration properties to be read.</p>
</div>
<div class="paragraph">
<p>The active profile can be overridden with a system property, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">-Dspring.active.profiles=prod</code></pre>
</div>
</div>
<div class="paragraph">
<p>take a look at <a href="http://stackoverflow.com/a/10041835/56880">this SO answer</a> on using Spring profiles.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_see_also_3">11.3.5. See also</h4>
<div class="paragraph">
<p>See <a href="ug.adoc#_ug_deployment_jvm-flags">JVM args</a> for other JVM args and system properties that you might want to consider setting.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_deployment_gae">11.4. Deploying to Google App Engine</h3>
<div class="paragraph">
<p>The <a href="https://cloud.google.com/appengine/docs">Google App Engine</a> (GAE) provides a JDO API, meaning that you can deploy Apache Isis onto GAE using the JDO objectstore.</p>
</div>
<div class="paragraph">
<p>However, GAE is not an RDBMS, and so there are some limitations that it imposes. This page gathers together various hints, tips and workarounds.</p>
</div>
<div class="sect3">
<h4 id="_primary_keys_and_owned_unowned_relationships">11.4.1. Primary Keys and Owned/Unowned Relationships</h4>
<div class="paragraph">
<p>All entities must have a <code>@PrimaryKey</code>. Within GAE, the type of this key matters.</p>
</div>
<div class="paragraph">
<p>For an entity to be an aggregate root, (ie a root of an GAE entity group), its key must be a <code>Long</code>, eg:</p>
</div>
<div class="paragraph">
<p>Any collection that holds this entity type (eg <code>ToDoItem#dependencies</code> holding a collection of <code>ToDoItem`s) should then be annotated with `@Unowned</code> (a GAE annotation).</p>
</div>
<div class="paragraph">
<p>If on the other hand you want the object to be owned (through a 1:m relationship somewhere) by some other root, then use a String:</p>
</div>
<div class="paragraph">
<p>Note: if you store a relationship with a String key it means that the parent object <em>owns</em> the child, any attempt to change the relationship raise and exception.</p>
</div>
</div>
<div class="sect3">
<h4 id="_custom_types">11.4.2. Custom Types</h4>
<div class="paragraph">
<p>Currently Apache Isis' <code>Blob</code> and <code>Clob</code> types and the JODA types (<code>LocalDate</code> et al) are <em>not</em> supported in GAE.</p>
</div>
<div class="paragraph">
<p>Instead, GAE defines a <a href="https://cloud.google.com/appengine/docs/java/datastore/entities#Properties_and_Value_Types">fixed set of value types</a>, including <code>BlobKey</code>. Members of the Apache Isis community have this working, though I haven&#8217;t seen the code.</p>
</div>
<div class="paragraph">
<p>The above notwithstanding, Andy Jefferson at DataNucleus tells us:</p>
</div>
<div class="paragraph">
<p><div class="extended-quote-first"><p>GAE JDO/JPA does support <em>some</em> type conversion, because looking at <a href="http://code.google.com/p/datanucleus-appengine/source/browse/trunk/src/com/google/appengine/datanucleus/StoreFieldManager.java#349">StoreFieldManager.java</a> for any field that is Object-based and not a relation nor Serialized it will call <a href="http://code.google.com/p/datanucleus-appengine/source/browse/trunk/src/com/google/appengine/datanucleus/TypeConversionUtils.java#736">TypeConverstionUtils.java</a> and that looks for a <code>TypeConverter</code> (specify <code>@Extension</code> with key of "type-converter-name" against a field and value as the <code>TypeConverter</code> class) and it should convert it. Similarly when getting the value from the datastore.
</p></div></p>
</div>
<div class="paragraph">
<p>On further investigation, it seems that the GAE implementation performs a type check on a <code>SUPPORTED_TYPES</code> Java set, in <code>com.google.appengine.api.datastore.DataTypeUtils</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">if</span> (!supportedTypes.contains(value.getClass())) {
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(prefix + value.getClass().getName() + <span class="string"><span class="delimiter">&quot;</span><span class="content"> is not a supported property type.</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We still need to try out Andy&#8217;s recipe, above.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_deployment_neo4j">11.5. Neo4J</h3>
<div class="paragraph">
<p>As of 1.8.0 Apache Isis has experimental support for Neo4J, courtesy of DataNucleus' <a href="http://www.datanucleus.org/products/datanucleus/datastores/neo4j.html">Neo4J Datastore</a> implementation.</p>
</div>
<div class="paragraph">
<p>The <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a> has been updated so that they can be optionally run under Neo4J.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In addition, the <a href="http://github.com/isisaddons/isis-app-neoapp">Isis addons' neoapp</a> (non-ASF) is configured to run with an embedded Neo4J server running alongside the Apache Isis webapp.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The steps below describe the configuration steps required to update an existing app.</p>
</div>
<div class="sect3">
<h4 id="_connectionurl">11.5.1. ConnectionURL</h4>
<div class="paragraph">
<p>In <code>persistor.properties</code>, update the JDO <code>ConnectionURL</code> property, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.persistor.datanucleus.impl.javax.jdo.option.ConnectionURL=neo4j:neo4j_DB</code></pre>
</div>
</div>
<div class="paragraph">
<p>The other connection properties (<code>ConnectionDriverName</code>, <code>ConnectionUserName</code> and <code>ConnectionPassword</code>) should be commented out.</p>
</div>
</div>
<div class="sect3">
<h4 id="_update_pom_xml">11.5.2. Update pom.xml</h4>
<div class="paragraph">
<p>Add the following dependency to the <code>webapp</code> project&#8217;s <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
    ...
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.datanucleus<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>datanucleus-neo4j<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>3.2.3<span class="tag">&lt;/version&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tag">&lt;/dependency&gt;</span>
    ...
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>for 1.8.0, use the value shown.  for 1.9.0-SNAPSHOT, use 4.0.5.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a> this is defined under the "neo4j" profile so can be activated using <code>-P neo4j</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_try_it_out">11.5.3. Try it out!</h4>
<div class="paragraph">
<p>If you want to quickly try out neo4j for yourself:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>run the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a> (v1.8.0)</p>
</li>
<li>
<p>build the app:</p>
</li>
<li>
<p>run the app:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you visit the about page you should see the neo4j JAR files are linked in, and a <code>neo4j_DB</code> subdirectory within the <code>webapp</code> directory.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_deployment_jvm-flags">11.6. JVM Flags</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The default JVM configuration will most likely not be appropriate for running Isis as a webapp.  The table below suggests some JVM args that you will probably want to modify:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 6. JVM args</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run the JVM in server mode, meaning that the JVM should spend more time on the optimization of the fragments of codes that are most often used (hotspots). This leads to better performance at the price of a higher overhead at startup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Xms128m
Minimum heap size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Xmx768m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum heap size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-XX:PermSize=64m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum perm size (for class definitions)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-XX:MaxPermSize=256m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum perm size (for class definitions)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-XX:+DisableExplicitGC</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There are also a whole bunch of GC-related flags, that you might want to explore; see this detailed <a href="http://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html">Hotspot JVM</a> documentation and also this <a href="http://blog.ragozin.info/2011/09/hotspot-jvm-garbage-collection-options.html">blog post</a>.</p>
</div>
<div class="sect3">
<h4 id="_configuring_in_tomcat">11.6.1. Configuring in Tomcat</h4>
<div class="paragraph">
<p>If using Tomcat, update the <code>CATALINA_OPTS</code> variable.  (This variable is also updated if <a href="#_ug_deployment_externalized-configuration_Log4j">configuring logging to run externally</a>).</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ug_testing">12. Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are going to use Apache Isis for developing complex business-critical applications, then being able to write automated tests for those applications becomes massively important.  As such Apache Isis treats the topic of testing very seriously, and (though we say it ourselves) has support that goes way above what is provided by other application frameworks.</p>
</div>
<div class="sect2">
<h3 id="_ug_testing_aaa">12.1. Overview</h3>
<div class="sect3">
<h4 id="_unit_tests_vs_integ_tests">12.1.1. Unit tests vs Integ tests</h4>
<div class="paragraph">
<p>We divide automated tests into two broad categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>unit tests exercise a single unit (usually a method) of a domain object, in isolation. <br></p>
<div class="paragraph">
<p>Dependencies of that object are mocked out.  These are written by a developer and for a developer; they are to ensure that a particular "cog in the machine" works correctly</p>
</div>
</li>
<li>
<p>integration tests exercise the application as a whole, usually focusing on one particular business operation (action). <br></p>
<div class="paragraph">
<p>These are tests that represent the acceptance criteria of some business story; their intent should make sense to the domain expert (even if the domain expert is "non-technical")</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To put it another way:</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Integration tests help ensure that you are <strong><em>building the right system</em></strong></p>
</div>
<div class="paragraph">
<p>Unit tests help ensure that you are <strong><em>building the system right</em></strong>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_integ_tests_vs_bdd_specs">12.1.2. Integ tests vs BDD Specs</h4>
<div class="paragraph">
<p>We further sub-divide integration tests into:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>those that are implemented in Java and JUnit (we call these simply <em>"integration tests"</em>)<br></p>
<div class="paragraph">
<p>Even if a domain expert understands the intent of these tests, the actual implementation will be opaque to them.  Also, the only output from the tests is a (hopefully) green CI job</p>
</div>
</li>
<li>
<p>tests (or rather, specifications) that are implemented in a <em>behaviour-driven design</em> (BDD) language such as <a href="https://cucumber.io/">Cucumber</a> (we call these <em>"BDD specs"</em>)<br></p>
<div class="paragraph">
<p>The natural language specification then maps down onto some glue code that is used to drive the application.  But the benefits of taking a BDD approach include the fact that your domain expert will be able to read the tests/specifications, and that when you run the specs, you also get documentation of the application&#8217;s behaviour ("living documentation").</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s up to you whether you use BDD specs for your apps; it will depend on your development process and company culture.  But you if don&#8217;t then you certainly should write integration tests: acceptance criteria for user stories should be automated!</p>
</div>
</div>
<div class="sect3">
<h4 id="_simulated_ui_code_wrapperfactory_code">12.1.3. Simulated UI (<code>WrapperFactory</code>)</h4>
<div class="paragraph">
<p>When we talk about integration tests/specs here, we mean tests that exercise the domain object logic, through to the actual database.  But we also want the tests to exercise the app from the users&#8217;s perspective, which means including the user interface.</p>
</div>
<div class="paragraph">
<p>For most other frameworks that would require having to test the application in a very heavy weight/fragile fashion using a tool such as <a href="http://docs.seleniumhq.org/">Selenium</a>, driving a web browser to navigate .  In this regard though, Apache Isis has a significant trick up its sleeve.  Because Apache Isis implements the naked objects pattern, it means that the UI is generated automatically from the UI.  This therefore allows for other implementations of the UI.</p>
</div>
<div class="paragraph">
<p>The <a href="rg.html#_rg_services-api_manpage-WrapperFactory"><code>WrapperFactory</code></a> domain service allows a test to wrap domain objects and thus to interact with said objects "as if" through the UI:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/testing/integ-tests.png" alt="integ tests" width="700px">
</div>
</div>
<div class="paragraph">
<p>If the test invokes an action that is disabled, then the wrapper will throw an appropriate exception.  If the action is ok to invoke, it delegates through.</p>
</div>
<div class="paragraph">
<p>What this means is that an Isis application can be tested end-to-end without having to deploy it onto a webserver; the whole app can be tested while running in-memory.  Although integration tests re (necessarily) slower than unit tests, they are not any harder to write (in fact, in some respects they are easier).</p>
</div>
</div>
<div class="sect3">
<h4 id="_dependency_injection">12.1.4. Dependency Injection</h4>
<div class="paragraph">
<p>Isis provides autowiring dependency injection into every domain object.  This is most useful when writing unit tests; simply mock out the service and inject into the domain object.</p>
</div>
<div class="paragraph">
<p>There are a number of syntaxes supported, but the simplest is to use <code>@javax.inject.Inject</code> annotation; for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.inject.Inject
CustomerRepository customers;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Isis can inject into this even if the field has package-level (or even <code>private</code>) visibility.  We recommend that you use package-level visibility, though, so that your unit tests (in the same package as the class under test) are able to inject mocks.</p>
</div>
<div class="paragraph">
<p>Isis does also support a couple of other syntaxes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> setCustomerRepository(CustomerRepository customers) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> injectCustomerRepository(CustomerRepository customers) { ... }</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Apache Isis also supports automatic dependency injection into integration tests; just declare the service dependency in the usual fashion and it will be automatically injected.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_given_when_then">12.1.5. Given/When/Then</h4>
<div class="paragraph">
<p>Whatever type of test/spec you are writing, we recommend you follow the given/when/then idiom:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>given</strong> the system is in this state (preconditions)</p>
</li>
<li>
<p><strong>when</strong> I poke it with a stick</p>
</li>
<li>
<p><strong>then</strong> it looks like this (postconditions)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A good test should be 5 to 10 lines long; the test should be there to help you reason about the behaviour of the system.  Certainly if the test becomes more than 20 lines it&#8217;ll be too difficult to understand.</p>
</div>
<div class="paragraph">
<p>The "when" part is usually a one-liner, and in the "then" part there will often be only two or three assertions that you want to make that the system has changed as it should.</p>
</div>
<div class="paragraph">
<p>For unit test the "given" part shouldn&#8217;t be too difficult either: just instantiate the class under test, wire in the appropriate mocks and set up the expectations.  And if there are too many mock expectations to set up, then "listen to the tests" &#8230;&#8203; they are telling you your design needs some work.</p>
</div>
<div class="paragraph">
<p>Where things get difficult though is the "given" for integration tests; which is the topic of the next section&#8230;&#8203;</p>
</div>
</div>
<div class="sect3">
<h4 id="_fixture_management">12.1.6. Fixture Management</h4>
<div class="paragraph">
<p>In the previous section we discussed using given/when/then as a form of organizing tests, and why you should keep your tests small.</p>
</div>
<div class="paragraph">
<p>For integration tests though it can be difficult to keep the "given" short; there could be a lot of prerequisite data that needs to exist before you can actually exercise your system.  Moreover, however we do set up that data, but we also want to do so in a way that is resilient to the system changing over time.</p>
</div>
<div class="paragraph">
<p>The solution that Apache Isis provides is a domain service called <a href="rg.html#_rg_classes_super_manpage-FixtureScripts">Fixture Scripts</a>, that defines a pattern and supporting classes to help ensure that the "data setup" for your tests are reusable and maintainable over time.</p>
</div>
</div>
<div class="sect3">
<h4 id="_fake_data">12.1.7. Fake data</h4>
<div class="paragraph">
<p>In any given test there are often quite a few variables involved, to initialize the state of the objects, or to act as arguments for invoking a method, or when asserting on post-conditions.  Sometimes those values are important (eg verifying that an `Order&#8217;s state went from PENDING to SHIPPED, say), but often they aren&#8217;t (a customer&#8217;s name, for example) but nevertheless need to be set up (especially in integration tests).</p>
</div>
<div class="paragraph">
<p>We want our tests to be easily understood, and we want the reader&#8217;s eye to be drawn to the values that are significant and ignore those that are not.</p>
</div>
<div class="paragraph">
<p>One way to do this is to use random (or fake) values for any insignificant data.  This in effect tells the reader that "any value will do".  Moreover, if it turns out that any data won&#8217;t do, and that there&#8217;s some behaviour that is sensitive to the value, then the test will start to flicker, passing and then failing depending on inputs.  This is A Good Thing&#8482;.</p>
</div>
<div class="paragraph">
<p>Apache Isis does not, itself, ship with a fake data library.  However, the <a href="http://github.com/isisaddons/isis-module-fakedata">Isis addons' fakedata</a> module (non-ASF) does provide exactly this capability.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using fake data works very well with fixture scripts; the fixture script can invoke the business action with sensible (fake/random) defaults, and only require that the essential information is passed into it by the test.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_feature_toggles">12.1.8. Feature Toggles</h4>
<div class="paragraph">
<p>Writing automated tests is just good development practice.  Also good practice is developing on the mainline (master, trunk); so that your continuous integration system really is integrating all code.  Said another way: <a href="http://martinfowler.com/bliki/FeatureBranch.html">don&#8217;t use branches</a>!</p>
</div>
<div class="paragraph">
<p>Sometimes, though, a feature will take longer to implement than your iteration cycle.  In such a case, how do you use continuous integration to keep everyone working on the mainline without revealing a half-implemented feature on your releases?  One option is to use <a href="http://martinfowler.com/bliki/FeatureToggle.html">feature toggle</a>s.</p>
</div>
<div class="paragraph">
<p>Apache Isis does not, itself, ship with a feature toggle library.  However, the <a href="http://github.com/isisaddons/isis-module-togglz">Isis addons' togglz</a> module (non-ASF) does provide exactly this capability.</p>
</div>
<div class="paragraph">
<p>With all that said, let&#8217;s look in detail at the testing features provided by Apache Isis.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_testing_unit-test-support">12.2. Unit Test Support</h3>
<div class="paragraph">
<p>Isis Core provides a number of unit test helpers for you to use (if you wish) to unit test your domain objects.</p>
</div>
<div class="sect3">
<h4 id="_ug_testing_unit-test-support_contract-tests">12.2.1. Contract Tests</h4>
<div class="paragraph">
<p>Contract tests ensure that all instances of a particular idiom/pattern that occur within your codebase are implemented correctly.  You could think of them as being a way to enforce a certain type of coding standard.  Implementation-wise they use <a href="https://code.google.com/p/reflections/">Reflections</a> library to scan for classes.</p>
</div>
<div class="sect4">
<h5 id="__code_sortedset_code_s_contract_test"><code>SortedSet</code>s Contract Test</h5>
<div class="paragraph">
<p>This contract test automatically checks that all fields of type <code>java.util.Collection</code> are declared as <code>java.util.SortedSet</code>. In other words, it precludes either <code>java.util.List</code> or <code>java.util.Set</code> from being used as a collection.</p>
</div>
<div class="paragraph">
<p>For example, the following passes the contract test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Department</span> {
    <span class="directive">private</span> <span class="predefined-type">SortedSet</span>&lt;Employee&gt; employees = <span class="keyword">new</span> <span class="predefined-type">TreeSet</span>&lt;Employee&gt;();
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>whereas this would not:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SomeDomainObject</span> {
    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;Employee&gt; employees = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;Employee&gt;();
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If using DataNucleus against an RDBMS (as you probably are) then we strongly recommend that you implement this test, for several reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>first, <code>Set</code>s align more closely to the relational model than do <code>List`s. A `List</code> must have an additional index to specify order.</p>
</li>
<li>
<p>second, <code>SortedSet</code> is preferable to <code>Set</code> because then the order is well-defined and predictable (to an end user, to the programmer).<br></p>
<div class="paragraph">
<p>The <a href="rg.html#_rg_classes_utility_manpage-ObjectContracts"><code>ObjectContracts</code></a>  utility class substantially simplifies the task of implementing <code>Comparable</code> in your domain classes.</p>
</div>
</li>
<li>
<p>third, if the relationship is bidirectional then JDO/Objectstore will automatically maintain the relationship.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use the contract test, subclass <code>SortedSetsContractTestAbstract</code>, specifying the root package to search for domain classes.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SortedSetsContractTestAll</span> <span class="directive">extends</span> SortedSetsContractTestAbstract {

    <span class="directive">public</span> SortedSetsContractTestAll() {
        <span class="local-variable">super</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.estatio.dom</span><span class="delimiter">&quot;</span></span>);
        withLoggingTo(<span class="predefined-type">System</span>.out);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_bidirectional_contract_test">Bidirectional Contract Test</h5>
<div class="paragraph">
<p>This contract test automatically checks that bidirectional 1:m or 1:1 associations are being maintained correctly (assuming that they follow the <a href="#_ug_how-tos_entity-relationships_managed-1-to-m-bidirectional-relationships">mutual registration pattern</a></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>(If using the JDO objectstore, then) there is generally no need to programmatically maintain 1:m relationships (indeed it may introduce subtle errors). For more details, see <a href="#_ug_how-tos_entity-relationships_managed-1-to-m-bidirectional-relationships">here</a>.  Also check out the  <a href="dg.adoc">IDE templates</a> for further guidance.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, suppose that <code>ParentDomainObject</code> and <code>ChildDomainObject</code> have a 1:m relationship (<code>ParentDomainObject#children</code> / <code>ChildDomainObject#parent</code>), and also <code>PeerDomainObject</code> has a 1:1 relationship with itself (<code>PeerDomainObject#next</code> / <code>PeerDomainObject#previous</code>).</p>
</div>
<div class="paragraph">
<p>The following will exercise these relationships:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">BidirectionalRelationshipContractTestAll</span>
        <span class="directive">extends</span> BidirectionalRelationshipContractTestAbstract {

    <span class="directive">public</span> BidirectionalRelationshipContractTestAll() {
        <span class="local-variable">super</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.isis.core.unittestsupport.bidir</span><span class="delimiter">&quot;</span></span>,
                ImmutableMap.&lt;<span class="predefined-type">Class</span>&lt;?&gt;,Instantiator&gt;of(
                    ChildDomainObject.class, <span class="keyword">new</span> InstantiatorForChildDomainObject(),
                    PeerDomainObject.class, <span class="keyword">new</span> InstantiatorSimple(PeerDomainObjectForTesting.class)
                ));
        withLoggingTo(<span class="predefined-type">System</span>.out);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first argument to the constructor scopes the search for domain objects; usually this would be something like <code>&quot;com.mycompany.dom&quot;</code>.</p>
</div>
<div class="paragraph">
<p>The second argument provides a map of <code>Instantiator</code> for certain of the domain object types. This has two main purposes. First, for abstract classes, it nominates an alternative concrete class to be instantiated. Second, for classes (such as <code>ChildDomainObject</code>) that are <code>Comparable</code> and are held in a <code>SortedSet</code>), it provides the ability to ensure that different instances are unique when compared against each other. If no <code>Instantiator</code> is provided, then the contract test simply attempts to instantiates the class.</p>
</div>
<div class="paragraph">
<p>If any of the supporting methods (<code>addToXxx()</code>, <code>removeFromXxx()</code>, <code>modifyXxx()</code> or <code>clearXxx()</code>) are missing, the relationship is skipped.</p>
</div>
<div class="paragraph">
<p>To see what&#8217;s going on (and to identify any skipped relationships), use the <code>withLoggingTo()</code> method call. If any assertion fails then the error should be descriptive enough to figure out the problem (without enabling logging).</p>
</div>
<div class="paragraph">
<p>The example tests can be found <a href="https://github.com/apache/isis/tree/master/core/unittestsupport/src/test/java/org/apache/isis/core/unittestsupport/bidir">here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_injected_services_method_contract_test">Injected Services Method Contract Test</h5>
<div class="paragraph">
<p>It is quite common for some basic services to be injected in a project-specific domain object superclass; for example a <code>ClockService</code> might generally be injected everywhere:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">EstatioDomainObject</span> {
    <span class="annotation">@javax</span>.inject.Inject
    <span class="directive">protected</span> ClockService clockService;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a subclass inadvertantly overrides this method and provides its own <code>ClockService</code> field, then the field in the superclass will never initialized. As you might imagine, <code>NullPointerException</code>s could then arise.</p>
</div>
<div class="paragraph">
<p>This contract test automatically checks that the <code>injectXxx(&#8230;&#8203;)</code> method, to allow for injected services, is not overridable, ie <code>final</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This contract test is semi-obsolete; most of the time you will want to use <code>@javax.inject.Inject</code> on fields rather than the <code>injectXxx()</code> method.  The feature dates from a time before Apache Isis supported the <code>@Inject</code> annotation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To use the contract test, , subclass <code>SortedSetsContractTestAbstract</code>, specifying the root package to search for domain classes.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">InjectServiceMethodMustBeFinalContractTestAll</span> <span class="directive">extends</span> InjectServiceMethodMustBeFinalContractTestAbstract {

    <span class="directive">public</span> InjectServiceMethodMustBeFinalContractTestAll() {
        <span class="local-variable">super</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.estatio.dom</span><span class="delimiter">&quot;</span></span>);
        withLoggingTo(<span class="predefined-type">System</span>.out);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_value_objects_contract_test">Value Objects Contract Test</h5>
<div class="paragraph">
<p>The <code>ValueTypeContractTestAbstract</code> automatically tests that a custom value type implements <code>equals()</code> and <code>hashCode()</code> correctly.</p>
</div>
<div class="paragraph">
<p>For example, testing JDK&#8217;s own <code>java.math.BigInteger</code> can be done as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ValueTypeContractTestAbstract_BigIntegerTest</span> <span class="directive">extends</span> ValueTypeContractTestAbstract&lt;<span class="predefined-type">BigInteger</span>&gt; {

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">BigInteger</span>&gt; getObjectsWithSameValue() {
        <span class="keyword">return</span> <span class="predefined-type">Arrays</span>.asList(<span class="keyword">new</span> <span class="predefined-type">BigInteger</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>), <span class="keyword">new</span> <span class="predefined-type">BigInteger</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>));
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">BigInteger</span>&gt; getObjectsWithDifferentValue() {
        <span class="keyword">return</span> <span class="predefined-type">Arrays</span>.asList(<span class="keyword">new</span> <span class="predefined-type">BigInteger</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example unit tests can be found <a href="https://github.com/apache/isis/tree/master/core/unittestsupport/src/test/java/org/apache/isis/core/unittestsupport/value">here</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_testing_unit-test-support_jmock-extensions">12.2.2. JMock Extensions</h4>
<div class="paragraph">
<p>As noted earlier, for unit tests we tend to use <a href="http://www.jmock.org">JMock</a> as our mocking library.  The usual given/when/then format gets an extra step:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>given</strong> the system is in this state</p>
</li>
<li>
<p><strong>expecting</strong> these interactions (set up the mock expectations here)</p>
</li>
<li>
<p><strong>when</strong> I poke it with a stick</p>
</li>
<li>
<p><strong>then</strong> these state changes and interactions with Mocks should have occurred.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If using JMock then the interactions (in the "then") are checked automatically by a JUnit rule.  However, you probably will still have some state changes to assert upon.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Distinguish between queries vs mutators</div>
<div class="paragraph">
<p>For mock interactions that simply retrieve some data, your test should not need to verify that it occurred.  If the system were to be refactored and starts caching some data, you don&#8217;t really want your tests to start breaking because they are no longer performing a query that once they did.  If using JMock API this means using the <code>allowing(..)</code> method to set up the expectation.</p>
</div>
<div class="paragraph">
<p>On the other hand mocks that mutate the state of the system you probably should assert have occurred.  If using JMock this typically means using the <code>oneOf(&#8230;&#8203;)</code> method.</p>
</div>
<div class="paragraph">
<p>For more tips on using JMock and mocking in general, check out the <a href="http://www.growing-object-oriented-software.com/">GOOS</a> book, written by JMock&#8217;s authors, Steve Freeman and Nat Pryce and also <a href="http://natpryce.com/articles.html">Nat&#8217;s blog</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Apache Isis' unit test support provides <code>JUnitRuleMockery2</code> which is an extension to the <a href="http://www.jmock.org/">JMock</a>'s <code>JunitRuleMockery</code>.  It provides a simpler API and also providing support for autowiring.</p>
</div>
<div class="paragraph">
<p>For example, here we see that the class under test, an instance of <code>CollaboratingUsingSetterInjection</code>, is automatically wired up with its <code>Collaborator</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">JUnitRuleMockery2Test_autoWiring_setterInjection_happyCase</span> {

    <span class="annotation">@Rule</span>
    <span class="directive">public</span> JUnitRuleMockery2 context = JUnitRuleMockery2.createFor(Mode.INTERFACES_AND_CLASSES);

    <span class="annotation">@Mock</span>
    <span class="directive">private</span> Collaborator collaborator;

    <span class="annotation">@ClassUnderTest</span>
    <span class="directive">private</span> CollaboratingUsingSetterInjection collaborating;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> wiring() {
        assertThat(collaborating.collaborator, is(not(nullValue())));
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Isis also includes (and automatically uses) a <a href="http://www.javassist.org">Javassist</a>-based implementation of JMock&#8217;s <a href="http://www.jmock.org/mocking-classes.html"><code>ClassImposteriser</code></a> interface, so that you can mock out concrete classes as well as interfaces.  We&#8217;ve provided this rather than JMock&#8217;s own cglib-based implementation (which is problematic for us given its own dependencies on <a href="http://asm.ow2.org/">asm</a>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example tests can be found <a href="https://github.com/apache/isis/tree/master/core/unittestsupport/src/test/java/org/apache/isis/core/unittestsupport/jmocking">here</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_ug_testing_unit-test-support_soap-fake-server-junit-rule">12.2.3. SOAP Fake Endpoints</h4>
<div class="paragraph">
<p>No man is an island, and neither are most applications.  Chances are that at some point you may need to integrate your Apache Isis application to other external systems, possibly using old-style SOAP web services.  The SOAP client in this case could be a domain service within your app, or it might be externalized, eg invoked through a scheduler or using <a href="http://camel.apache.org">Apache Camel</a>.</p>
</div>
<div class="paragraph">
<p>While you will want to (of course) perform manual system testing/UAT with a test instance of that external system, it&#8217;s also useful to be able to perform unit testing of your SOAP client component.</p>
</div>
<div class="paragraph">
<p>The <code>SoapEndpointPublishingRule</code> is a simple JUnit rule that allows you to run a fake SOAP endpoint within an unit test.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The (non-ASF) <a href="http://github.com/isisaddons/isis-module-publishmq">Isis addons' publishmq</a> module provides a full example of how to integrate and test an Apache Isis application with a (faked out) external system.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="__code_soapendpointpublishingrule_code"><code>SoapEndpointPublishingRule</code></h5>
<div class="paragraph">
<p>The idea behind this rule is that you write a fake server endpoint that implements the same WSDL contract as the "real" external system does, but which also exposes additional API to specify responses (or throw exceptions) from SOAP calls.  It also typically records the requests and allows these to be queried.</p>
</div>
<div class="paragraph">
<p>In its setup your unit test and gets the rule to instantiate and publish that fake server endpoint, and then obtains a reference to that server endpoint.  It also instantiates the SOAP client, pointing it at the address (that is, a URL) that the fake server endpoint is running on.  This way the unit test has control of both the SOAP client and server: the software under test and its collaborator.</p>
</div>
<div class="paragraph">
<p>In the test methods your unit test sets up expectations on your fake server, and then exercises the SOAP client.  The SOAP client calls the fake server, which then responds accordingly.  The test can then assert that all expected interactions have occurred.</p>
</div>
<div class="paragraph">
<p>So that tests don&#8217;t take too long to run, the rule puts the fake server endpoints onto a thread-local.  Therefore the unit tests should clear up any state on the fake server endpoints.</p>
</div>
<div class="paragraph">
<p>Your unit test uses the rule by specifying the endpoint class (must have a no-arg constructor):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">FakeExternalSystemEndpointRuleTest</span> {
    <span class="annotation">@Rule</span>
    <span class="directive">public</span> SoapEndpointPublishingRule serverRule =
        <span class="keyword">new</span> SoapEndpointPublishingRule(FakeExternalSystemEndpoint.class);         <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">private</span> FakeExternalSystemEndpoint fakeServerEndpoint;
    <span class="directive">private</span> DemoObject externalSystemContract;                                    <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="annotation">@Before</span>
    <span class="directive">public</span> <span class="type">void</span> setUp() <span class="directive">throws</span> <span class="exception">Exception</span> {
        fakeServerEndpoint =
            serverRule.getEndpointImplementor(FakeExternalSystemEndpoint.class);  <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="directive">final</span> <span class="predefined-type">String</span> endpointAddress =
            serverRule.getEndpointAddress(FakeExternalSystemEndpoint.class);      <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="directive">final</span> DemoObjectService externalSystemService =                           <i class="conum" data-value="5"></i><b>(5)</b>
                <span class="keyword">new</span> DemoObjectService(ExternalSystemWsdl.getWsdl());              <i class="conum" data-value="6"></i><b>(6)</b>
        externalSystemContract = externalSystemService.getDemoObjectOverSOAP();
        BindingProvider provider = (BindingProvider) externalSystemContract;
        provider.getRequestContext().put(
                BindingProvider.ENDPOINT_ADDRESS_PROPERTY,
                endpointAddress)
        );
    }
    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> happy_case() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="comment">// given</span>
        <span class="directive">final</span> Update update = <span class="keyword">new</span> Update();                              <i class="conum" data-value="7"></i><b>(7)</b>
        ...
        <span class="comment">// expect</span>
        final UpdateResponse response = <span class="keyword">new</span> UpdateResponse();            <i class="conum" data-value="8"></i><b>(8)</b>
        ...
        fakeServerEndpoint.control().setResponse(updateResponse);
        <span class="comment">// when</span>
        PostResponse response = externalSystemContract.post(update);     <i class="conum" data-value="9"></i><b>(9)</b>
        <span class="comment">// then</span>
        <span class="directive">final</span> <span class="predefined-type">List</span>&lt;Update&gt; updates =                                     <i class="conum" data-value="10"></i><b>(10)</b>
            fakeServerEndpoint.control().getUpdates();
        ...
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>specify the class that implements the endpoint (must have a no-arg constructor)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the SOAP contract as defined in WSDL and generated by wsdl2java</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>get hold of the fake server-side endpoint from the rule&#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>&#8230;&#8203; and its endpoint address</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>use factory (also generated by wsdl2java) to create client-side endpoint</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>getWsdl()</code> is a utility method to return a URL for the WSDL (eg from the classpath)</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>create a request object in order to invoke the SOAP web service</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>instruct the fake server endpoint how to respond</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>invoke the web service</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>check the fake server endpoint was correctly invoked etc.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The rule can also host multiple endpoints; just provide multiple classes in the constructor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Rule</span>
<span class="directive">public</span> SoapEndpointPublishingRule serverRule =
                <span class="keyword">new</span> SoapEndpointPublishingRule(
                    FakeCustomersEndpoint.class,
                    FakeOrdersEndpoint.class,
                    FakeProductsEndpoint.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To lookup a particular endpoint, specify its type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">FakeProductsEndpoint fakeProductsServerEndpoint =
            serverRule.getPublishedEndpoint(FakeProductsEndpoint.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The endpoint addresses that the server endpoints run on are determined automatically.  If you want more control, then you can call one of <code>SoapEndpointPublishingRule</code>'s overloaded constructors, passing in one or more <code>SoapEndpointSpec</code> instances.</p>
</div>
</div>
<div class="sect4">
<h5 id="_xml_marshalling_support">XML Marshalling Support</h5>
<div class="paragraph">
<p>Apache Isis' unit testing support also provides helper <code>JaxbUtil</code> and <code>JaxbMatchers</code> classes.  These are useful if you have exampler XML-serialized representations of the SOAP requests and response payloads and want to use these within your tests.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_testing_unit-test-support_maven-configuration">12.2.4. Maven Configuration</h4>
<div class="paragraph">
<p>Apache Isis' unit test support is automatically configured if you use the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a>.  To set it up manually, update the <code>pom.xml</code> of your domain object model module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.apache.isis.core<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>isis-core-unittestsupport<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Normally <code>test</code>; usual Maven scoping rules apply.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We also recommend that you configure the <code>maven-surefire-plugin</code> to pick up the following class patterns:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.10<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;configuration&gt;</span>
        <span class="tag">&lt;includes&gt;</span>
            <span class="tag">&lt;include&gt;</span>**/*Test.java<span class="tag">&lt;/include&gt;</span>
            <span class="tag">&lt;include&gt;</span>**/*Test_*.java<span class="tag">&lt;/include&gt;</span>
            <span class="tag">&lt;include&gt;</span>**/*Spec*.java<span class="tag">&lt;/include&gt;</span>
        <span class="tag">&lt;/includes&gt;</span>
        <span class="tag">&lt;excludes&gt;</span>
            <span class="tag">&lt;exclude&gt;</span>**/Test*.java<span class="tag">&lt;/exclude&gt;</span>
            <span class="tag">&lt;exclude&gt;</span>**/*ForTesting.java<span class="tag">&lt;/exclude&gt;</span>
            <span class="tag">&lt;exclude&gt;</span>**/*Abstract*.java<span class="tag">&lt;/exclude&gt;</span>
        <span class="tag">&lt;/excludes&gt;</span>
        <span class="tag">&lt;useFile&gt;</span>true<span class="tag">&lt;/useFile&gt;</span>
        <span class="tag">&lt;printSummary&gt;</span>true<span class="tag">&lt;/printSummary&gt;</span>
        <span class="tag">&lt;outputDirectory&gt;</span>${project.build.directory}/surefire-reports<span class="tag">&lt;/outputDirectory&gt;</span>
    <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_testing_integ-test-support">12.3. Integration Test Support</h3>
<div class="paragraph">
<p>As discussed in the introductory overview of this chapter, Apache Isis allows you to integration test your domain objects from within JUnit.  There are several parts to this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>configuring the Apache Isis runtime so it can be bootstrapped (mostly boilerplate)</p>
</li>
<li>
<p>defining a base class to perform said bootstrapping</p>
</li>
<li>
<p>using fixture scripts to set up the app</p>
</li>
<li>
<p>using <code>WrapperFactory</code> so that the UI can be simulated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We&#8217;ll get to all that shortly, but let&#8217;s start by taking a look at what a typical integration test looks like.</p>
</div>
<div class="sect3">
<h4 id="_ug_testing_integ-test-support_typical-usage">12.3.1. Typical Usage</h4>
<div class="paragraph">
<p>This example adapted from the <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a> (non-ASF).  The code we want to test (simplified) is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> ... {

    <span class="directive">private</span> <span class="type">boolean</span> complete;
    <span class="annotation">@Property</span>( editing = Editing.DISABLED )
    <span class="directive">public</span> <span class="type">boolean</span> isComplete() {
        <span class="keyword">return</span> complete;
    }
    <span class="directive">public</span> <span class="type">void</span> setComplete(<span class="directive">final</span> <span class="type">boolean</span> complete) {
        <span class="local-variable">this</span>.complete = complete;
    }

    <span class="annotation">@Action</span>()
    <span class="directive">public</span> ToDoItem completed() {
        setComplete(<span class="predefined-constant">true</span>);
        ...
        return <span class="local-variable">this</span>;
    }
    <span class="directive">public</span> <span class="predefined-type">String</span> disableCompleted() {
        <span class="keyword">return</span> isComplete() ? <span class="string"><span class="delimiter">&quot;</span><span class="content">Already completed</span><span class="delimiter">&quot;</span></span> : <span class="predefined-constant">null</span>;
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We typically put the bootstrapping of Apache Isis into a superclass (<code>AbstractToDoIntegTest</code> below), then subclass as required.</p>
</div>
<div class="paragraph">
<p>For this test (of the "completed()" action) we need an instance of a <code>ToDoItem</code> that is not yet complete.  Here&#8217;s the setup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItemIntegTest</span> <span class="directive">extends</span> AbstractToDoIntegTest {

    <span class="annotation">@Inject</span>
    FixtureScripts fixtureScripts;                              <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Inject</span>
    ToDoItems toDoItems;                                        <i class="conum" data-value="2"></i><b>(2)</b>
    ToDoItem toDoItem;                                          <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="annotation">@Before</span>
    <span class="directive">public</span> <span class="type">void</span> setUp() <span class="directive">throws</span> <span class="exception">Exception</span> {
        RecreateToDoItemsForCurrentUser fixtureScript =         <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="keyword">new</span> RecreateToDoItemsForCurrentUser();
        fixtureScripts.runFixtureScript(fixtureScript, <span class="predefined-constant">null</span>);
        <span class="directive">final</span> <span class="predefined-type">List</span>&lt;ToDoItem&gt; all = toDoItems.notYetComplete();  <i class="conum" data-value="5"></i><b>(5)</b>
        toDoItem = wrap(all.get(<span class="integer">0</span>));                            <i class="conum" data-value="6"></i><b>(6)</b>
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <a href="rg.html#_rg_classes_super_manpage-FixtureScripts"><code>FixtureScripts</code></a> domain service is injected, providing us with the ability to run fixture scripts</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>likewise, an instance of the <code>ToDoItems</code> domain service is injected.  We&#8217;ll use this to lookup&#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the object under test, held as a field</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the fixture script for this test; it deletes all existing todo items (for the current user only) and then recreates them</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>we lookup one of the just-created todo items&#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>and then wrap it so that our interactions with it are as if through the UI</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following code tests the happy case, that a not-yet-completed <code>ToDoItem</code> can be completed by invoking the <code>completed()</code> action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItemIntegTest</span> ... {
    ...
    public <span class="directive">static</span> <span class="type">class</span> <span class="class">Completed</span> <span class="directive">extends</span> ToDoItemIntegTest { <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="annotation">@Test</span>
        <span class="directive">public</span> <span class="type">void</span> happyCase() <span class="directive">throws</span> <span class="exception">Exception</span> {
            <span class="comment">// given</span>
            assertThat(toDoItem.isComplete()).isFalse();      <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="comment">// when</span>
            toDoItem.completed();
            <span class="comment">// then</span>
            assertThat(toDoItem.isComplete()).isTrue();
        }
        ...
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the idiom we follow is to use nested static classes to identify the class responsibility being tested</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <a href="http://github.com/isisaddons/isis-app-todoapp">todoapp</a> uses <a href="http://joel-costigliola.github.io/assertj">AssertJ</a>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>What about when a todo item is already completed?  The <code>disableCompleted()</code> method in the class says that it shouldn&#8217;t be allowed (the action would be greyed out in the UI with an appropriate tooltip).  The following test verifies this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">        <span class="annotation">@Test</span>
        <span class="directive">public</span> <span class="type">void</span> cannotCompleteIfAlreadyCompleted() <span class="directive">throws</span> <span class="exception">Exception</span> {
            <span class="comment">// given</span>
            unwrap(toDoItem).setComplete(<span class="predefined-constant">true</span>);                     <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="comment">// expect</span>
            expectedExceptions.expectMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Already completed</span><span class="delimiter">&quot;</span></span>);  <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="comment">// when</span>
            toDoItem.completed();
        }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>we unwrap the domain object in order to set its state directly</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the expectedExceptions <a href="http://junit.org/apidocs/org/junit/rules/ExpectedException.html">JUnit rule</a> (defined by a superclass) verifies that the appropiate exception is indeed thrown (in the "when")</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And what about the fact that the underlying "complete" property is disabled (the <code>@Disabled</code> annotation?).  If the <code>ToDoItem</code> is put into edit mode in the UI, the complete checkbox should remain read-only.  Here&#8217;s a verify similar test that verifies this also:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">        <span class="annotation">@Test</span>
        <span class="directive">public</span> <span class="type">void</span> cannotSetPropertyDirectly() <span class="directive">throws</span> <span class="exception">Exception</span> {
            <span class="comment">// expect</span>
            expectedExceptions.expectMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Always disabled</span><span class="delimiter">&quot;</span></span>);  <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="comment">// when</span>
            toDoItem.setComplete(<span class="predefined-constant">true</span>);
        }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>again we use the exceptedExceptions rule.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_testing_integ-test-support_bootstrapping">12.3.2. Bootstrapping</h4>
<div class="paragraph">
<p>Integration tests instantiate an Apache Isis "runtime" (as a singleton) within a JUnit test.  Because (depending on the size of your app) it takes a little time to bootstrap Apache Isis, the framework caches the runtime on a thread-local from one test to the next.</p>
</div>
<div class="paragraph">
<p>Nevertheless, we do need to bootstrap the runtime for the very first test.</p>
</div>
<div class="paragraph">
<p>Since the integration tests don&#8217;t depend on the <code>webapp</code> module, it&#8217;s necessary to repeat all the (relevant) all the configuration in <code>isis.properties</code> and related files.  That said, in practice the relevant information isn&#8217;t all that much.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We hope to simplify the way this works in future versions of Apache Isis.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example code in this section is taken from the app generated by the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a>.</p>
</div>
<div class="sect4">
<h5 id="_builder">Builder</h5>
<div class="paragraph">
<p>The bootstrapping itself is mostly performed by a subclass of the <code>IsisSystemForTest.Builder</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">SimpleAppSystemBuilder</span> <span class="directive">extends</span> IsisSystemForTest.Builder {      <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="directive">public</span> SimpleAppSystemBuilder() {
        withLoggingAt(org.apache.log4j.Level.INFO);
        with(testConfiguration());
        with(<span class="keyword">new</span> DataNucleusPersistenceMechanismInstaller());                        <i class="conum" data-value="2"></i><b>(2)</b>

        withServicesIn( <span class="string"><span class="delimiter">&quot;</span><span class="content">domainapp</span><span class="delimiter">&quot;</span></span> );                                               <i class="conum" data-value="3"></i><b>(3)</b>
    }

    <span class="directive">private</span> <span class="directive">static</span> IsisConfiguration testConfiguration() {
        <span class="directive">final</span> IsisConfigurationForJdoIntegTests testConfiguration =
            <span class="keyword">new</span> IsisConfigurationForJdoIntegTests();                                 <i class="conum" data-value="4"></i><b>(4)</b>

        testConfiguration.addRegisterEntitiesPackagePrefix(<span class="string"><span class="delimiter">&quot;</span><span class="content">domainapp.dom.modules</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="keyword">return</span> testConfiguration;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>subclass the framework-provided <code>IsisSystemForTest.Builder</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>equivalent to <code>isis.persistor=datanucleus</code> in <code>isis.properties</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>specify the <code>isis.services</code> key in <code>isis.properties</code> (where "domainapp" is the base package for all classes within the app)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>IsisConfigurationForJdoIntegTests</code> has pre-canned configuration for using an in-memory HSQLDB and other standard settings; more on this below.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>equivalent to <code>isis.persistor.datanucleus.RegisterEntities.packagePrefix</code> key (typically in <code>persistor_datanucleus.properties</code></td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_isisconfigurationforjdointegtests">IsisConfigurationForJdoIntegTests</h6>
<div class="paragraph">
<p>Integration tests are configured programmatically, with a default set of properties to bootstrap the JDO/DataNucleus objectstore using an HSQLDB in-memory database.</p>
</div>
<div class="paragraph">
<p>To remove a little bit of boilerplate, the <code>IsisConfigurationForJdoIntegTests</code> class (in the <code>org.apache.isis.objectstore.jdo.datanucleus</code> package) can be used to bootstrap the application.  If necessary, this class can be subclassed to override these defaults.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 7. Default Configuration Properties for Integration Tests</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 16%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.persistor.datanucleus.impl.</code><br>
<code>javax.jdo.option.ConnectionURL</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:hsqldb:mem:test</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>JDBC URL</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.persistor.datanucleus.impl.</code><br>
<code>javax.jdo.option.ConnectionDriverName</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.hsqldb.jdbcDriver</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>JDBC Driver</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.persistor.datanucleus.impl.</code><br>
<code>javax.jdo.option.ConnectionUserName</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sa</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Username</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.persistor.datanucleus.impl.</code><br>
<code>javax.jdo.option.ConnectionPassword</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;empty string&gt;</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Password</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.persistor.datanucleus.impl.</code><br>
<code>datanucleus.schema.autoCreateAll</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Recreate DB for each test run (an in-memory database)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.persistor.datanucleus.impl.</code><br>
<code>datanucleus.schema.validateAll</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Disable validations (minimize bootstrap time)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.persistor.datanucleus.impl.</code><br>
<code>datanucleus.persistenceByReachabilityAtCommit</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>As per WEB-INF/persistor_datanucleus.properties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.persistor.datanucleus.impl.</code><br>
<code>datanucleus.identifier.case</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MixedCase</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>As per WEB-INF/persistor_datanucleus.properties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.persistor.datanucleus.impl.</code><br>
<code>datanucleus.cache.level2.type</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>As per WEB-INF/persistor_datanucleus.properties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.persistor.datanucleus.impl.</code><br>
<code>datanucleus.cache.level2.mode</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENABLE_SELECTIVE</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>As per WEB-INF/persistor_datanucleus.properties</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.persistor.datanucleus.</code><br>
<code>install-fixtures</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Automatically install any fixtures that might have been registered</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.persistor.</code><br>
<code>enforceSafeSemantics</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>isis.deploymentType</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server_prototype</p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_system_initializer">System Initializer</h5>
<div class="paragraph">
<p>The builder is defined and used within a class we call the system initializer that is responsible for instantiating the Apache Isis runtime, and binding it to a thread-local.  This is performed within a static <code>initIsft()</code> method.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleAppSystemInitializer</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> initIsft() {
        IsisSystemForTest isft = IsisSystemForTest.getElseNull();
        <span class="keyword">if</span>(isft == <span class="predefined-constant">null</span>) {
            isft = <span class="keyword">new</span> SimpleAppSystemBuilder()    <i class="conum" data-value="1"></i><b>(1)</b>
                            .build()
                            .setUpSystem();
            IsisSystemForTest.set(isft);           <i class="conum" data-value="2"></i><b>(2)</b>
        }
    }
    <span class="directive">private</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">SimpleAppSystemBuilder</span>
        <span class="directive">extends</span> IsisSystemForTest.Builder { ... }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>instantiates and initializes the Apache Isis runtime (the <code>IsisSystemForTest</code> class)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>binds the runtime to a thread-local.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_abstract_class">Abstract Class</h5>
<div class="paragraph">
<p>We recommend defining a base class for all your other classes to integration classes to inherit from.  The main responsibility of this class is tocall the system initializer, described earlier.  We only need the initialization to be performed once, so this call is performed in a <code>@BeforeClass</code> hook.</p>
</div>
<div class="paragraph">
<p>The code below shows the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">SimpleAppIntegTest</span> {
    <span class="annotation">@BeforeClass</span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> initClass() {
        org.apache.log4j.PropertyConfigurator.configure(<span class="string"><span class="delimiter">&quot;</span><span class="content">logging.properties</span><span class="delimiter">&quot;</span></span>);   <i class="conum" data-value="1"></i><b>(1)</b>
        SimpleAppSystemInitializer.initIsft();                                   <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="keyword">new</span> ScenarioExecutionForIntegration();                                   <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>ensure that logging messages don&#8217;t get swallowed</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>initialize the Apache Isis runtime</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>primarily exists to support the writing of <a href="#_ug_testing_bdd-spec-support">BDD specifications</a>, but also enables finer-grained management of sessions/transactions (discussed below).</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="__code_integrationtestabstract_code"><code>IntegrationTestAbstract</code></h6>
<div class="paragraph">
<p>In fact, we recommend that your base class inherit from Apache Isis' <code>IntegrationTestAbstract</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">SimpleAppIntegTest</span> <span class="directive">extends</span> IntegrationTestAbstract {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Although not mandatory, this provides a number of helper/convenience methods and JUnit rules:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Rule</span>
    <span class="directive">public</span> IsisTransactionRule isisTransactionRule =                         <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="keyword">new</span> IsisTransactionRule();
    <span class="annotation">@Rule</span>
    <span class="directive">public</span> JUnitRuleMockery2 context =                                       <i class="conum" data-value="2"></i><b>(2)</b>
        JUnitRuleMockery2.createFor(Mode.INTERFACES_AND_CLASSES);
    <span class="annotation">@Rule</span>
    <span class="directive">public</span> ExpectedException expectedExceptions =                            <i class="conum" data-value="3"></i><b>(3)</b>
        ExpectedException.none();
    <span class="annotation">@Rule</span>
    <span class="directive">public</span> ExceptionRecognizerTranslate exceptionRecognizerTranslations =    <i class="conum" data-value="4"></i><b>(4)</b>
        ExceptionRecognizerTranslate.create();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>ensures an Apache Isis session/transaction running for each test</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>sets up a JMock context (using Apache Isis' extension to JMock as described in <a href="#_ug_testing_unit-test-support_jmock-extensions">JMock Extensions</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>standard JUnit rule for writing tests that throw exceptions</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>to capture messages that require translation, as described in <a href="#_ug_more-advanced_i18n">i18 support</a>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All of these rules could be inlined in your own base class; as we say, they are a convenience.</p>
</div>
<div class="paragraph">
<p>In addition, <code>IntegrationTestAbstract</code> provides a number of helper/convenience methods.  Most important amongst these are <code>nextSession()</code> and <code>nextTransaction()</code> that to allow tests to simulate multiple separate user interactions (each of which would normally occur in a separate transaction).</p>
</div>
<div class="paragraph">
<p>It also provides <code>wrap(&#8230;&#8203;)</code> and <code>unwrap(&#8230;&#8203;)</code> which delegate to the <code>WrapperFactory</code>.  We talk about these methods in the next section</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_testing_integ-test-support_wrapper-factory">12.3.3. Wrapper Factory</h4>
<div class="paragraph">
<p>The <a href="rg.html#_rg_services-api_manpage-WrapperFactory"><code>WrapperFactory</code></a> service is responsible for wrapping a domain object in a dynamic proxy, of the same type as the object being proxied.  And the role of this wrapper is to simulate the UI.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>WrapperFactory</code> uses <a href="http://www.javassist.org">javassist</a> to perform its magic; this is the same technology that ORMs such as <a href="http://hibernate.org/">Hibernate</a> use to manage lazy loading/dirty tracking (DataNucleus uses a different mechanism).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It does this by allowing through method invocations that would be allowed if the user were interacting with the domain object through one of the viewers, but throwing an exception if the user attempts to interact with the domain object in a way that would not be possible if using the UI.</p>
</div>
<div class="paragraph">
<p>The mechanics are as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the integration test calls the <code>WrapperFactory</code> to obtain a wrapper for the domain object under test.  This is usually done in the test&#8217;s <code>setUp()</code> method.</p>
</li>
<li>
<p>the test calls the methods on the wrapper rather than the domain object itself</p>
</li>
<li>
<p>the wrapper performs a reverse lookup from the method invoked (a regular <code>java.lang.reflect.Method</code> instance) into the Apache Isis metamodel</p>
</li>
<li>
<p>(like a viewer), the wrapper then performs the "see it/use it/do it" checks, checking that the member is visible, that it is enabled and (if there are arguments) that the arguments are valid</p>
</li>
<li>
<p>if the business rule checks pass, then the underlying member is invoked.  Otherwise an exception is thrown.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The type of exception depends upon what sort of check failed.  It&#8217;s straightforward enough: if the member is invisible then a <code>HiddenException</code> is thrown; if it&#8217;s not usable then you&#8217;ll get a <code>DisabledException</code>, if the args are not valid then catch an <code>InvalidException</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/testing/wrapper-factory.png" alt="wrapper factory" width="600px">
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s look in a bit more detail at what the test can do with the wrapper.</p>
</div>
<div class="sect4">
<h5 id="_wrapping_and_unwrapping">Wrapping and Unwrapping</h5>
<div class="paragraph">
<p>Wrapping a domain object is very straightforward; simply call <code>WrapperFactory#wrap(&#8230;&#8203;)</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Customer customer = ...;
Customer wrappedCustomer = wrapperFactory.wrap(wrappedCustomer);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Going the other way&#8201;&#8212;&#8201;getting hold of the underlying (wrapped) domain object&#8201;&#8212;&#8201;is just as easy; just call <code>WrapperFactory#unwrap(&#8230;&#8203;)</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Customer wrappedCustomer = ...;
Customer customer = wrapperFactory.unwrap(wrappedCustomer);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you prefer, you also can get the underlying object from the wrapper itself, by downcasting to <code>WrappingObject</code> and calling <code>__isis_wrapped()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Customer wrappedCustomer = ...;
Customer customer = (Customer)((WrappingObject)wrappedCustomer).__isis_wrapped());</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;re not sure that&#8217;s any easier (in fact we&#8217;re certain it looks rather obscure).  Stick with calling <code>unwrap(&#8230;&#8203;)</code>!</p>
</div>
</div>
<div class="sect4">
<h5 id="_using_the_wrapper">Using the wrapper</h5>
<div class="paragraph">
<p>As the wrapper is intended to simulate the UI, only those methods that correspond to the "primary" methods of the domain object&#8217;s members are allowed to be called.  That means:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for <strong><em>object properties</em></strong> the test can call the getter or setter method</p>
</li>
<li>
<p>for <strong><em>object collections</em></strong> the test can call the getter. <br></p>
<div class="paragraph">
<p>If there is a supporting <code>addTo&#8230;&#8203;()</code> or <code>removeFrom&#8230;&#8203;()</code> method, then these can be called.  It can also call <code>add(&#8230;&#8203;)</code> or <code>remove(&#8230;&#8203;)</code> on the collection (returned by the gettter) itself.<br></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In this respect the wrapper is more functional than the <a href="#_ug_wicket-viewer">Wicket viewer</a> (which does not expose the ability to mutate collections directly).</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>for <strong><em>object actions</em></strong> the test can call the action method itself.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a convenience, we also allow the test to call any <code>default&#8230;&#8203;()</code>,<code>choices&#8230;&#8203;()</code> or <code>autoComplete&#8230;&#8203;()</code> method.  These are often useful for obtaining a valid value to use.</p>
</div>
<div class="paragraph">
<p>What the test can&#8217;t call is any of the remaining supporting methods, such as <code>hide&#8230;&#8203;()</code>, <code>disable&#8230;&#8203;()</code> or <code>validate&#8230;&#8203;()</code>.  That&#8217;s because their value is implied by the exception being thrown.</p>
</div>
<div class="paragraph">
<p>The wrapper <em>does</em> also allow the object&#8217;s <code>title()</code> method or its  <code>toString()</code> , however this is little use for objects whose title is built up using the <code>@Title</code> annotation.  Instead, we recommend that your test verifies an object&#8217;s title by calling <code>DomainObjectContainer#titleOf(&#8230;&#8203;)</code> method.</p>
</div>
</div>
<div class="sect4">
<h5 id="_firing_domain_events">Firing Domain Events</h5>
<div class="paragraph">
<p>As well as enforcing business rules, the wrapper has another important feature, namely that it will cause domain events to be fired.</p>
</div>
<div class="paragraph">
<p>For example, if we have an action annotated with <code>@Action(domainEvent=&#8230;&#8203;</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> ... {
    <span class="annotation">@Action</span>(
            domainEvent =CompletedEvent.class
    )
    <span class="directive">public</span> ToDoItem completed() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>then invoking the action through the proxy will cause the event (<code>CompletedEvent</code> above) to be fired to any subscribers.  A test might therefore look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> EventBusService eventBusService;                                          <i class="conum" data-value="1"></i><b>(1)</b>

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> subscriberReceivesEvents() <span class="directive">throws</span> <span class="exception">Exception</span> {

    <span class="comment">// given</span>
    <span class="directive">final</span> ToDoItem.CompletedEvent<span class="type">[]</span> evHolder = <span class="keyword">new</span> ToDoItem.CompletedEvent[<span class="integer">1</span>];    <i class="conum" data-value="2"></i><b>(2)</b>
    eventBusService.register(<span class="keyword">new</span> <span class="predefined-type">Object</span>() {
        <span class="annotation">@Subscribe</span>
        <span class="directive">public</span> <span class="type">void</span> on(<span class="directive">final</span> ToDoItem.CompletedEvent ev) {                        <i class="conum" data-value="3"></i><b>(3)</b>
            evHolder[<span class="integer">0</span>] = ev;
        }
    });

    <span class="comment">// when</span>
    toDoItem.completed();                                                         <i class="conum" data-value="4"></i><b>(4)</b>

    <span class="comment">// then</span>
    then(evHolder[<span class="integer">0</span>].getSource()).isEqualTo(unwrap(toDoItem));                    <i class="conum" data-value="5"></i><b>(5)</b>
    then(evHolder[<span class="integer">0</span>].getIdentifier().getMemberName()).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">completed</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>inject <a href="rg.html#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a> into this test</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>holder for subscriber to capture event to</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>subscriber&#8217;s callback, using the guava subscriber syntax</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>invoking the domain object using the wrapper</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>assert that the event was populated</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The wrapper will also fire domain events for properties (if annotated with <code>@Property(domainEvent=&#8230;&#8203;)</code>) or collections (if annotated with <code>@Collection(domainEvent=&#8230;&#8203;)</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It isn&#8217;t possible to use the <code>WrapperFactory</code> in a unit test, because there needs to be a running instance of Apache Isis that holds the metamodel.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_testing_integ-test-support_maven-configuration">12.3.4. Maven Configuration</h4>
<div class="paragraph">
<p>Apache Isis' integration test support is automatically configured if you use the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a>.  To set it up manually, update the <code>pom.xml</code> of your domain object model module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.apache.isis.core<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>isis-core-integtestsupport<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.apache.isis.core<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>isis-core-wrapper<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We also recommend that you configure the <code>maven-surefire-plugin</code> to pick up the following class patterns:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.10<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;configuration&gt;</span>
        <span class="tag">&lt;includes&gt;</span>
            <span class="tag">&lt;include&gt;</span>**/*Test.java<span class="tag">&lt;/include&gt;</span>
            <span class="tag">&lt;include&gt;</span>**/*Test_*.java<span class="tag">&lt;/include&gt;</span>
            <span class="tag">&lt;include&gt;</span>**/*Spec*.java<span class="tag">&lt;/include&gt;</span>
        <span class="tag">&lt;/includes&gt;</span>
        <span class="tag">&lt;excludes&gt;</span>
            <span class="tag">&lt;exclude&gt;</span>**/Test*.java<span class="tag">&lt;/exclude&gt;</span>
            <span class="tag">&lt;exclude&gt;</span>**/*ForTesting.java<span class="tag">&lt;/exclude&gt;</span>
            <span class="tag">&lt;exclude&gt;</span>**/*Abstract*.java<span class="tag">&lt;/exclude&gt;</span>
        <span class="tag">&lt;/excludes&gt;</span>
        <span class="tag">&lt;useFile&gt;</span>true<span class="tag">&lt;/useFile&gt;</span>
        <span class="tag">&lt;printSummary&gt;</span>true<span class="tag">&lt;/printSummary&gt;</span>
        <span class="tag">&lt;outputDirectory&gt;</span>${project.build.directory}/surefire-reports<span class="tag">&lt;/outputDirectory&gt;</span>
    <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_testing_bdd-spec-support">12.4. BDD Spec Support</h3>
<div class="paragraph">
<p><a href="http://en.wikipedia.org/wiki/Behavior-driven_development">Behaviour-driven design</a> (BDD) redefines testing not as an after-the-fact "let&#8217;s check the system works", but rather as a means to work with the domain expert to (a) specify the behaviour of the feature <em>before</em> starting implementation, and (b) provide a means that the domain expert can verify the feature after it has been implemented.</p>
</div>
<div class="paragraph">
<p>Since domain experts are usually non-technical (at least, they are unlikely to be able to read or want to learn how to read JUnit/Java code), then applying BDD typically requires writing specifications in using structured English text and (ASCII) tables.  The BDD tooling parses this text and uses it to actually interact with the system under test.  As a byproduct the BDD frameworks generate readable output of some form; this is often an annotated version of the original specification, marked up to indicate which specifications passed, which have failed.  This readable output is a form of "living documentation"; it captures the actual behaviour of the system, and so is guaranteed to be accurate.</p>
</div>
<div class="paragraph">
<p>There are many BDD tools out there; Apache Isis provides an integration with <a href="https://cucumber.io/docs/reference/jvm#java">Cucumber JVM</a> (see also the <a href="https://github.com/cucumber/cucumber-jvm">github site</a>):</p>
</div>
<div class="sect3">
<h4 id="_ug_testing_bdd-spec-support_how-it-works">12.4.1. How it works</h4>
<div class="paragraph">
<p>At a high level, here&#8217;s how Cucumber works</p>
</div>
<div class="ulist">
<ul>
<li>
<p>specifications are written in the <a href="https://github.com/cucumber/cucumber/wiki/Gherkin">Gherkin</a> DSL, following the <a href="https://github.com/cucumber/cucumber/wiki/Given-When-Then">"given/when/then"</a> format.</p>
</li>
<li>
<p>Cucumber-JVM itself is a JUnit runner, and searches for <a href="https://github.com/cucumber/cucumber/wiki/Feature-Introduction">feature files</a> on the classpath.</p>
</li>
<li>
<p>These in turn are matched to <a href="https://github.com/cucumber/cucumber/wiki/Step-Definitions">step definition</a>s through regular expressions.<br></p>
<div class="paragraph">
<p>It is the step definitions (the "glue") that exercise the system.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The code that goes in step definitions is broadly the same as the code that goes in an integration test method.  One benefit of using step definitions (rather than integration tests) is that the step definitions are reusable across scenarios, so there may be less code overall to maintain.  For example, if you have a step definition that maps to "given an uncompleted todo item", then this can be used for all the scenarios that start with that as their precondition.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ug_testing_bdd-spec-support_key-classes">12.4.2. Key classes</h4>
<div class="paragraph">
<p>There are some key framework classes that make up the spec support; these are discussed below.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
some of these are also used by Apache Isis' <a href="#_ug_testing_integ-test-support">Integration Test support</a>.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="__code_isissystemfortest_code"><code>IsisSystemForTest</code></h5>
<div class="paragraph">
<p>The <code>IsisSystemForTest</code> class allows a complete running instance of Apache Isis to be bootstrapped (with the JDO objectstore); this is then held on a a <code>ThreadLocal</code> from one test to another.</p>
</div>
<div class="paragraph">
<p>Typically bootstrapping code is used to lazily instantiate the <code>IsisSystemForTest</code> once and once only. The mechanism for doing this is line-for-line identical in both BDD step defs and integration tests.</p>
</div>
</div>
<div class="sect4">
<h5 id="__code_scenarioexecution_code"><code>ScenarioExecution</code></h5>
<div class="paragraph">
<p>The <code>ScenarioExecution</code> provides a context for a scenario that is being executed.  It is Cucumber that determines which step definitions are run, and in which order, and so state cannot be passed between step definitions using local variables or instance variables.  Instead the <code>ScenarioExecution</code> acts like a hashmap, allowing each step to put data (eg "given an uncompleted todoitem") into the map or get data ("when I complete the todoitem") from the map.  This is done using the <code>putVar(&#8230;&#8203;)</code> and <code>getVar(&#8230;&#8203;)</code> methods.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This corresponds broadly to the "World" object in Ruby-flavoured Cucumber.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>ScenarioExecution</code> also provids access to the configured domain services (using the <code>service(&#8230;&#8203;)</code> method) and the <code>DomainObjectContainer</code> (through the <code>container()</code> method).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This could probably be refactored; Cucumber JVM provides automatic dependency injection into setp definitions, but Apache Isis does not currently leverage or exploit this capability.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Like the <code>IsisSystemForTest</code> class, the <code>ScenarioExecution</code> class binds an instance of itself onto a <code>ThreadLocal</code>. It can then be accessed in BDD step definitions using <code>ScenarioExecution.current()</code> static method.</p>
</div>
</div>
<div class="sect4">
<h5 id="__code_wrapperfactory_code"><code>WrapperFactory</code></h5>
<div class="paragraph">
<p>As with integration tests, the UI can be simulated by "wrapping" each domain object in a proxy using the <code>WrapperFactory</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="__code_cukeglueabstract_code"><code>CukeGlueAbstract</code></h5>
<div class="paragraph">
<p>The <code>CukeGlueAbstract</code> acts as a convenience superclass for writing BDD step definitions (analogous to the <code>IntegrationTestAbstract</code> for integation tests).  Underneath the covers it delegates to an underlying <code>ScenarioExecution</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_testing_bdd-spec-support_writing-a-bdd-spec">12.4.3. Writing a BDD spec</h4>
<div class="paragraph">
<p>BDD specifications contain:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <code>XxxSpec.feature</code> file, describing the feature and the scenarios (given/when/then)s that constitute its acceptance criteria</p>
</li>
<li>
<p>a <code>RunSpecs.java</code> class file to run the specification (all boilerplate). This will run all <code>.feature</code> files in the same package or subpackages.</p>
</li>
<li>
<p>one or several <code>XxxGlue</code> constituting the step definitions to be matched against.<br></p>
<div class="paragraph">
<p>The "glue" (step definitions) are intended to be reused across features. We therefore recommend that they reside in a separate package, and are organized by the entity type upon which they act.<br></p>
</div>
<div class="paragraph">
<p>For example, given a feature that involves <code>Customer</code> and <code>Order</code>, have the step definitions pertaining to <code>Customer</code> reside in <code>CustomerGlue</code>, and the step definitions pertaining to <code>Order</code> reside in <code>OrderGlue</code>.<br></p>
</div>
<div class="paragraph">
<p>The <code>glue</code> attribute of the Cucumber-JVM JUnit runner eallows you to indicate which package(s) should be recursively searched to find any glue.</p>
</div>
</li>
<li>
<p>a system initializer class.  You can reuse the  system initializer from any integration tests (as described in <a href="#_ug_testing_integ-test-support">Integration Test Support</a>, bootstrapping section).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of a feature from the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SimpleObjectsFixture</span>
Feature: <span class="predefined-type">List</span> and Create New Simple Objects

  <span class="annotation">@integration</span>
  Scenario: Existing simple objects can be listed and <span class="keyword">new</span> ones created
    Given there are initially <span class="integer">3</span> simple objects
    When  I create a <span class="keyword">new</span> simple object
    Then  there are <span class="integer">4</span> simple objects</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@SimpleObjectsFixture</code> is a custom tag we&#8217;ve specified to indicate the prerequisite fixtures to be loaded; more on this in a moment. The <code>@integration</code> tag, meanwhile, says that this feature should be run with integration-level scope.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Although BDD specs are most commonly used for end-to-end tests (ie at the same scope as an integration test), the two concerns (expressability of a test to a business person vs granularity of the test) should not be conflated. There are a couple of <a href="http://silkandspinach.net/2013/01/18/a-testing-strategy/">good</a> blog <a href="http://claysnow.co.uk/the-testing-iceberg/">posts</a> discussing <a href="http://claysnow.co.uk/living-documentation-can-be-readable-and-fast/">this</a>. The basic idea is to avoid the overhead of a heavy-duty integration test if possible.</p>
</div>
<div class="paragraph">
<p>Apache Isis does also support running BDD specs in unit test mode; by annotating the scenario with the <code>@unit</code> (rather than <code>@integration</code> tag).  When running under unit-level scope, the Apache Isis system is <em>not</em> instantiated.  Instead, the <code>ScenarioExecution</code> class returns JMock mocks (except for the <code>WrapperFactory</code>, if configured).</p>
</div>
<div class="paragraph">
<p>To support unit testing scope Apache Isis provides the <code>InMemoryDB</code> class; a glorified hashmap of "persisted" objects.  Use of this utility class is optional.</p>
</div>
<div class="paragraph">
<p>Writing a BDD spec that supports both modes of operation therefore takes more effort and we expect most users interested in BDD will use integration-testing scope; for these reasons we have chosen <em>not</em> to include unit-testing support in the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a>.  For those who do require faster-executing test suite, it&#8217;s worthwhile knowing that Apache Isis can support this.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>RunSpecs</code> class to run this feature (and any other features in this package or subpackages) is just boilerplate</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(Cucumber.class)
<span class="annotation">@CucumberOptions</span>(
        format = {
                <span class="string"><span class="delimiter">&quot;</span><span class="content">html:target/cucumber-html-report</span><span class="delimiter">&quot;</span></span>
                ,<span class="string"><span class="delimiter">&quot;</span><span class="content">json:target/cucumber.json</span><span class="delimiter">&quot;</span></span>
        },
        glue={<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:domainapp.integtests.specglue</span><span class="delimiter">&quot;</span></span>},
        strict = <span class="predefined-constant">true</span>,
        tags = { <span class="string"><span class="delimiter">&quot;</span><span class="content">~@backlog</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">~@ignore</span><span class="delimiter">&quot;</span></span> })
<span class="directive">public</span> <span class="type">class</span> <span class="class">RunSpecs</span> {
    <span class="comment">// intentionally empty</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The JSON formatter allows integration with enhanced reports, for example as provided by <a href="http://www.masterthought.net/section/cucumber-reporting">Masterthought.net</a> (screenshots at end of page). (Commented out) configuration for this is provided in the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a>.</p>
</div>
<div class="paragraph">
<p>The bootstrapping of Apache Isis can be moved into a <code>BootstrappingGlue</code> step definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">BootstrappingGlue</span> <span class="directive">extends</span> CukeGlueAbstract {
    <span class="annotation">@Before</span>(value={<span class="string"><span class="delimiter">&quot;</span><span class="content">@integration</span><span class="delimiter">&quot;</span></span>}, order=<span class="integer">100</span>)
    <span class="directive">public</span> <span class="type">void</span> beforeScenarioIntegrationScope() {
        org.apache.log4j.PropertyConfigurator.configure(<span class="string"><span class="delimiter">&quot;</span><span class="content">logging.properties</span><span class="delimiter">&quot;</span></span>);
        SimpleAppSystemInitializer.initIsft();

        before(ScenarioExecutionScope.INTEGRATION);
    }
    <span class="annotation">@After</span>
    <span class="directive">public</span> <span class="type">void</span> afterScenario(cucumber.api.Scenario sc) {
        assertMocksSatisfied();
        after(sc);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The fixture to run also lives in its own step definition, <a href="https://github.com/apache/isis/blob/07fe61ef3fb029ae36427f60da2afeeb931e4f88/example/application/simpleapp/integtests/src/test/java/domainapp/integtests/specglue/CatalogOfFixturesGlue.java#L24"><code>CatalogOfFixturesGlue</code></a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CatalogOfFixturesGlue</span> <span class="directive">extends</span> CukeGlueAbstract {
    <span class="annotation">@Before</span>(value={<span class="string"><span class="delimiter">&quot;</span><span class="content">@integration</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">@SimpleObjectsFixture</span><span class="delimiter">&quot;</span></span>}, order=<span class="integer">20000</span>)
    <span class="directive">public</span> <span class="type">void</span> integrationFixtures() <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
        scenarioExecution().install(<span class="keyword">new</span> RecreateSimpleObjects());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this is annotated with a tag (<code>@SimpleObjectsFixture</code>) so that the correct fixture runs. (We might have a whole variety of these).</p>
</div>
<div class="paragraph">
<p>The step definitions pertaining to <code>SimpleObject</code> domain entity then reside in the <a href="https://github.com/apache/isis/blob/07fe61ef3fb029ae36427f60da2afeeb931e4f88/example/application/simpleapp/integtests/src/test/java/domainapp/integtests/specglue/modules/simple/SimpleObjectGlue.java#L31"><code>SimpleObjectGlue</code></a> class. This is where the heavy lifting gets done:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleObjectGlue</span> <span class="directive">extends</span> CukeGlueAbstract {
    <span class="annotation">@Given</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">^there are.* (</span><span class="char">\\</span><span class="content">d+) simple objects$</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> there_are_N_simple_objects(<span class="type">int</span> n) <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
        <span class="keyword">try</span> {
            <span class="directive">final</span> <span class="predefined-type">List</span>&lt;SimpleObject&gt; findAll = service(SimpleObjects.class).listAll();
            assertThat(findAll.size(), is(n));
            putVar(<span class="string"><span class="delimiter">&quot;</span><span class="content">list</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">all</span><span class="delimiter">&quot;</span></span>, findAll);

        } <span class="keyword">finally</span> {
            assertMocksSatisfied();
        }
    }
    <span class="annotation">@When</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">^I create a new simple object$</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> I_create_a_new_simple_object() <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
        service(SimpleObjects.class).create(<span class="predefined-type">UUID</span>.randomUUID().toString());
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If using Java 8, note that Cucumber JVM supports a <a href="https://cucumber.io/docs/reference/jvm#java-8-lambdas">simplified syntax using lambdas</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_testing_bdd-spec-support_bdd-tooling">12.4.4. BDD Tooling</h4>
<div class="paragraph">
<p>To help write feature files and generate step definitions, we recommend <a href="https://github.com/rlogiacco/Natural">Roberto Lo Giacco&#8217;s Eclipse plugin</a>. For more information, see Dan&#8217;s short <a href="http://danhaywood.com/2013/07/05/cucumber-editors-in-eclipse/">blog post</a>. It works very well. Of interest: this is implemented using <a href="http://www.eclipse.org/Xtext/">XText</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ug_testing_bdd-spec-support_maven-configuration">12.4.5. Maven Configuration</h4>
<div class="paragraph">
<p>Apache Isis' BDD spec support is automatically configured if you use the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a>.  To set it up manually, update the <code>pom.xml</code> of your domain object model module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.apache.isis.core<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>isis-core-specsupport<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Normally <code>test</code>; usual Maven scoping rules apply.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We also recommend that you configure the <code>maven-surefire-plugin</code> to pick up the following class patterns:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.10<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;configuration&gt;</span>
        <span class="tag">&lt;includes&gt;</span>
            <span class="tag">&lt;include&gt;</span>**/*Test.java<span class="tag">&lt;/include&gt;</span>
            <span class="tag">&lt;include&gt;</span>**/*Test_*.java<span class="tag">&lt;/include&gt;</span>
            <span class="tag">&lt;include&gt;</span>**/*Spec*.java<span class="tag">&lt;/include&gt;</span>
        <span class="tag">&lt;/includes&gt;</span>
        <span class="tag">&lt;excludes&gt;</span>
            <span class="tag">&lt;exclude&gt;</span>**/Test*.java<span class="tag">&lt;/exclude&gt;</span>
            <span class="tag">&lt;exclude&gt;</span>**/*ForTesting.java<span class="tag">&lt;/exclude&gt;</span>
            <span class="tag">&lt;exclude&gt;</span>**/*Abstract*.java<span class="tag">&lt;/exclude&gt;</span>
        <span class="tag">&lt;/excludes&gt;</span>
        <span class="tag">&lt;useFile&gt;</span>true<span class="tag">&lt;/useFile&gt;</span>
        <span class="tag">&lt;printSummary&gt;</span>true<span class="tag">&lt;/printSummary&gt;</span>
        <span class="tag">&lt;outputDirectory&gt;</span>${project.build.directory}/surefire-reports<span class="tag">&lt;/outputDirectory&gt;</span>
    <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You may also find it more convenient to place the <code>.feature</code> files in <code>src/test/java</code>, rather than <code>src/test/resources</code>.  If you wish to do this, then your integtest module&#8217;s <code>pom.xml</code> must contain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;build&gt;</span>
    <span class="tag">&lt;testResources&gt;</span>
        <span class="tag">&lt;testResource&gt;</span>
            <span class="tag">&lt;filtering&gt;</span>false<span class="tag">&lt;/filtering&gt;</span>
            <span class="tag">&lt;directory&gt;</span>src/test/resources<span class="tag">&lt;/directory&gt;</span>
        <span class="tag">&lt;/testResource&gt;</span>
        <span class="tag">&lt;testResource&gt;</span>
            <span class="tag">&lt;filtering&gt;</span>false<span class="tag">&lt;/filtering&gt;</span>
            <span class="tag">&lt;directory&gt;</span>src/test/java<span class="tag">&lt;/directory&gt;</span>
            <span class="tag">&lt;includes&gt;</span>
                <span class="tag">&lt;include&gt;</span>**<span class="tag">&lt;/include&gt;</span>
            <span class="tag">&lt;/includes&gt;</span>
            <span class="tag">&lt;excludes&gt;</span>
                <span class="tag">&lt;exclude&gt;</span>**/*.java<span class="tag">&lt;/exclude&gt;</span>
            <span class="tag">&lt;/excludes&gt;</span>
        <span class="tag">&lt;/testResource&gt;</span>
    <span class="tag">&lt;/testResources&gt;</span>
<span class="tag">&lt;/build&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_testing_fixture-scripts">12.5. Fixture Scripts</h3>
<div class="paragraph">
<p>When writing integration tests (and implementing the glue for BDD specs) it can be difficult to keep the "given" short; there could be a lot of prerequisite data that needs to exist before you can actually exercise your system.  Moreover, however we do set up that data, but we also want to do so in a way that is resilient to the system changing over time.</p>
</div>
<div class="paragraph">
<p>On a very simple system you could probably get away with using SQL to insert directly into the database, or you could use a toolkit such as <a href="http://dbunit.sourceforge.net/howto.html">dbunit</a> to upload data from flat files.  Such approaches aren&#8217;t particularly maintainable though.  If in the future the domain entities (and therefore corresponding database tables) change their structure, then all of those data sets will need updating.</p>
</div>
<div class="paragraph">
<p>Even more significantly, there&#8217;s no way to guarantee that the data that&#8217;s being loaded is logically consistent with the business behaviour of the domain objects themselves.  That is, there&#8217;s nothing to stop your test from putting data into the database that would be invalid if one attempted to add it through the app.</p>
</div>
<div class="paragraph">
<p>The solution that Apache Isis provides is a small library called <strong><em>fixture scripts</em></strong>.  A fixture script is basically a wrapper for executing arbitrary work, but that work almost always invoking a business action.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to learn more on this topic (with live coding!), check out this <a href="https://skillsmatter.com/skillscasts/5638-to-those-whom-much-is-given-much-is-expected">presentation</a> given at BDD Exchange 2014.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There is another benefit to Apache Isis' fixture script approach; the fixtures can be (in prototyping mode) run from your application.  This means that fixture scripts can actually help all the way through the development lifecycle:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>when specifying a new feature, you can write a fixture script to get the system into the "given" state, and then start exploring the required functionality with the domain expert actually <em>within</em> the application<br></p>
<div class="paragraph">
<p>And if you can&#8217;t write a fixture script for the story, it probably means that there&#8217;s some prerequisite feature that needs implementing that you hadn&#8217;t previously recognized</p>
</div>
</li>
<li>
<p>when the developer implements the story, s/he has a precanned script to run when they manually verify the functionality works</p>
</li>
<li>
<p>when the developer automates the story&#8217;s acceptance test as an integration test, they already have the "given" part of the test implemented</p>
</li>
<li>
<p>when you want to pass the feature over to the QA/tester for additional manual exploratory testing, they have a fixture script to get them to a jumping off point for their explorations</p>
</li>
<li>
<p>when you want to demonstrate the implemented feature to your domain expert, your demo can use the fixture script so you don&#8217;t bore your audience in performing lots of boring setup before getting to the actual feature</p>
</li>
<li>
<p>when you want to roll out training to your users, you can write fixture scripts as part of their training exercises</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following  sections explain the API and how to go about using the API.</p>
</div>
<div class="sect3">
<h4 id="_ug_testing_fixture-scripts_api-and-usage">12.5.1. API and Usage</h4>
<div class="paragraph">
<p>There are two parts to using fixture scripts: the <code>FixtureScripts</code> domain service class, and the <code>FixtureScript</code> view model class, both being <code>abstract</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The job of the <code>FixtureScripts</code> domain service is to locate all fixture scripts from the classpath and to let them be invoked, either from an integration test/BDD spec or from the UI of your Isis app.</p>
</li>
<li>
<p>With <code>FixtureScript</code> meanwhile you subclass for each of the scenarios that you want to define.  You can also subclass from <code>FixtureScript</code> to create helpers; more on this below.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s look at <code>FixtureScripts</code> domain service in more detail first.</p>
</div>
<div class="sect4">
<h5 id="__code_fixturescripts_code"><code>FixtureScripts</code></h5>
<div class="paragraph">
<p>In your code you subclass <code>FixtureScripts</code> domain service primarily just to specify which package to search for.  For example, here&#8217;s the service that&#8217;s generated by the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>
<span class="annotation">@DomainServiceLayout</span>(
        menuBar = DomainServiceLayout.MenuBar.SECONDARY,           <i class="conum" data-value="1"></i><b>(1)</b>
        named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Prototyping</span><span class="delimiter">&quot;</span></span>,                                       <i class="conum" data-value="2"></i><b>(2)</b>
        menuOrder = <span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span>
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">DomainAppFixturesService</span> <span class="directive">extends</span> FixtureScripts {     <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="directive">public</span> DomainAppFixturesService() {
        <span class="local-variable">super</span>(
            <span class="string"><span class="delimiter">&quot;</span><span class="content">domainapp</span><span class="delimiter">&quot;</span></span>,                                           <i class="conum" data-value="4"></i><b>(4)</b>
            MultipleExecutionStrategy.EXECUTE);                    <i class="conum" data-value="5"></i><b>(5)</b>
    }
    <span class="annotation">@Override</span>
    <span class="directive">public</span> FixtureScript default0RunFixtureScript() {
        <span class="keyword">return</span> findFixtureScriptFor(RecreateSimpleObjects.class);  <i class="conum" data-value="6"></i><b>(6)</b>
    }
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;FixtureScript&gt; choices0RunFixtureScript() {        <i class="conum" data-value="7"></i><b>(7)</b>
        <span class="keyword">return</span> <span class="local-variable">super</span>.choices0RunFixtureScript();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>in the UI, render the on the right hand side (secondary) menu bar&#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>&#8230;&#8203; under the "Prototyping" menu</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>inherit from <code>org.apache.isis.applib.fixturescripts.FixtureScripts</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>search for all fixture scripts under the "domainapp" package; in your code this would probably be "com.mycompany.myapp" or similar</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>if the same fixture script (class) is encountered more than once, then run anyway; more on this in <a href="#_ug_testing_fixture-scripts_api-and-usage_organizing">Organizing Fixture scripts</a>], below.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>(optional) specify a default fixture script to run, in this case <code>RecreateSimpleObjects</code> fixture script (see below)</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>make all fixture scripts found available as a drop-down (by increasing the visibility of this method to <code>public</code>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here&#8217;s how the domain service looks like in the UI:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/testing/fixture-scripts/prototyping-menu.png"><img src="images/testing/fixture-scripts/prototyping-menu.png" alt="prototyping menu" width="700px"></a>
</div>
</div>
<div class="paragraph">
<p>and here&#8217;s what the <code>runFixtureScript</code> action prompt looks like:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/testing/fixture-scripts/prompt.png"><img src="images/testing/fixture-scripts/prompt.png" alt="prompt" width="700px"></a>
</div>
</div>
<div class="paragraph">
<p>when this is executed, the resultant objects (actually, instances of FixtureResult`) are shown in the UI:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/testing/fixture-scripts/result-list.png"><img src="images/testing/fixture-scripts/result-list.png" alt="result list" width="700px"></a>
</div>
</div>
<div class="paragraph">
<p>If you had defined many fixture scripts then a drop-down might become unwieldy, in which case your code would probably override the <code>autoComplete&#8230;&#8203;())</code> instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;FixtureScript&gt; autoComplete0RunFixtureScript(<span class="directive">final</span> <span class="annotation">@MinLength</span>(<span class="integer">1</span>) <span class="predefined-type">String</span> searchArg) {
        <span class="keyword">return</span> <span class="local-variable">super</span>.autoComplete0RunFixtureScript(searchArg);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You are free, of course, to add additional "convenience" actions into it if you wish for the most commonly used/demo&#8217;d setups ; you&#8217;ll find that the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a> adds this additional action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Action</span>(
            restrictTo = RestrictTo.PROTOTYPING
    )
    <span class="annotation">@ActionLayout</span>(
            cssClassFa=<span class="string"><span class="delimiter">&quot;</span><span class="content">fa fa-refresh</span><span class="delimiter">&quot;</span></span>
    )
    <span class="annotation">@MemberOrder</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">Object</span> recreateObjectsAndReturnFirst() {
        <span class="directive">final</span> <span class="predefined-type">List</span>&lt;FixtureResult&gt; run = findFixtureScriptFor(RecreateSimpleObjects.class).run(<span class="predefined-constant">null</span>);
        <span class="keyword">return</span> run.get(<span class="integer">0</span>).getObject();
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s now look at the <code>FixtureScript</code> class, where there&#8217;s a bit more going on.</p>
</div>
</div>
<div class="sect4">
<h5 id="__code_fixturescript_code"><code>FixtureScript</code></h5>
<div class="paragraph">
<p>A fixture script is ultimately just a block of code that can be executed, so it&#8217;s up to you how you implement it to set up the system.  However, we strongly recommend that you use it to invoke actions on business objects, in essence to replay what a real-life user would have done.  That way, the fixture script will remain valid even if the underlying implementation of the system changes in the future.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s the <code>RecreateSimpleObjects</code> fixture script from the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">RecreateSimpleObjects</span> <span class="directive">extends</span> FixtureScript {                   <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="directive">public</span> <span class="directive">final</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; NAMES = <span class="predefined-type">Collections</span>.unmodifiableList(<span class="predefined-type">Arrays</span>.asList(
            <span class="string"><span class="delimiter">&quot;</span><span class="content">Foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bar</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Baz</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Frodo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Froyo</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">Fizz</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bip</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bop</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bang</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Boo</span><span class="delimiter">&quot;</span></span>));                           <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> RecreateSimpleObjects() {
        withDiscoverability(Discoverability.DISCOVERABLE);                   <i class="conum" data-value="3"></i><b>(3)</b>
    }
    <span class="directive">private</span> <span class="predefined-type">Integer</span> number;                                                  <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="directive">public</span> <span class="predefined-type">Integer</span> getNumber() { <span class="keyword">return</span> number; }
    <span class="directive">public</span> RecreateSimpleObjects setNumber(<span class="directive">final</span> <span class="predefined-type">Integer</span> number) {
        <span class="local-variable">this</span>.number = number;
        <span class="keyword">return</span> <span class="local-variable">this</span>;
    }
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">List</span>&lt;SimpleObject&gt; simpleObjects = Lists.newArrayList();   <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;SimpleObject&gt; getSimpleObjects() {
        <span class="keyword">return</span> simpleObjects;
    }
    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> execute(<span class="directive">final</span> ExecutionContext ec) {          <i class="conum" data-value="6"></i><b>(6)</b>
        <span class="comment">// defaults</span>
        <span class="directive">final</span> <span class="type">int</span> number = defaultParam(<span class="string"><span class="delimiter">&quot;</span><span class="content">number</span><span class="delimiter">&quot;</span></span>, ec, <span class="integer">3</span>);        <i class="conum" data-value="7"></i><b>(7)</b>
        <span class="comment">// validate</span>
        <span class="keyword">if</span>(number &lt; <span class="integer">0</span> || number &gt; NAMES.size()) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(
                <span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">number must be in range [0,%d)</span><span class="delimiter">&quot;</span></span>, NAMES.size()));
        }
        <span class="comment">// execute</span>
        ec.executeChild(<span class="local-variable">this</span>, <span class="keyword">new</span> SimpleObjectsTearDown());      <i class="conum" data-value="8"></i><b>(8)</b>
        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; number; i++) {
            <span class="directive">final</span> SimpleObjectCreate fs =
                <span class="keyword">new</span> SimpleObjectCreate().setName(NAMES.get(i));
            ec.executeChild(<span class="local-variable">this</span>, fs.getName(), fs);             <i class="conum" data-value="9"></i><b>(9)</b>
            simpleObjects.add(fs.getSimpleObject());             <i class="conum" data-value="10"></i><b>(10)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>inherit from <code>org.apache.isis.applib.fixturescripts.FixtureScript</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>a hard-coded list of values for the names.  Note that the <a href="http://github.com/isisaddons/isis-module-fakedata">Isis addons' fakedata</a> module (non-ASF) could also have been used</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>whether the script is "discoverable"; in other words whether it should be rendered in the drop-down by the <code>FixtureScripts</code> service</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>input property: the number of objects to create, up to 10; for the calling test to specify, but note this is optional and has a default (see below).  It&#8217;s important that a wrapper class is used (ie <code>java.lang.Integer</code>, not <code>int</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>output property: the generated list of objects, for the calling test to grab</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>the mandatory execute(&#8230;&#8203;) API</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>the <code>defaultParam(&#8230;&#8203;)</code> (inherited from <code>FixtureScript</code>) will default the <code>number</code> property (using Java&#8217;s Reflection API) if none was specified</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>call another fixture script (<code>SimpleObjectsTearDown</code>) using the provided <code>ExecutionContext</code>.  Note that although the fixture script is a view model, it&#8217;s fine to simply instantiate it (rather than using <code>DomainObjectContainer#newTransientInstance(&#8230;&#8203;)</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>calling another fixture script (<code>SimpleObjectCreate</code>) using the provided <code>ExecutionContext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>adding the created object to the list, for the calling object to use.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Because this script has exposed a "number" property, it&#8217;s possible to set this from within the UI.  For example:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/testing/fixture-scripts/prompt.png" alt="prompt" width="700px">
</div>
</div>
<div class="paragraph">
<p>When this is executed, the framework will parse the text and attempt to reflectively set the corresponding properties on the fixture result.  So, in this case, when the fixture script is executed we actually get 6 objects created:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/testing/fixture-scripts/result-list.png" alt="result list" width="700px">
</div>
</div>
<div class="paragraph">
<p>It&#8217;s commonplace for one fixture script to call another.  In the above example this script called <code>SimpleObjectsTearDown</code> and <code>SimpleObjectCreate</code>.  Let&#8217;s take a quick look at <code>SimpleObjectCreate</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleObjectCreate</span> <span class="directive">extends</span> FixtureScript {       <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="directive">private</span> <span class="predefined-type">String</span> name;                                      <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> <span class="predefined-type">String</span> getName() { <span class="keyword">return</span> name; }
    <span class="directive">public</span> SimpleObjectCreate setName(<span class="directive">final</span> <span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
        <span class="keyword">return</span> <span class="local-variable">this</span>;
    }
    <span class="directive">private</span> SimpleObject simpleObject;                        <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="directive">public</span> SimpleObject getSimpleObject() {
        <span class="keyword">return</span> simpleObject;
    }
    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> execute(<span class="directive">final</span> ExecutionContext ec) {       <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="predefined-type">String</span> name = checkParam(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, ec, <span class="predefined-type">String</span>.class);   <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="local-variable">this</span>.simpleObject = wrap(simpleObjects)               <i class="conum" data-value="6"></i><b>(6)</b>
                                .create(name);                <i class="conum" data-value="7"></i><b>(7)</b>
        ec.addResult(<span class="local-variable">this</span>, simpleObject);                     <i class="conum" data-value="8"></i><b>(8)</b>
    }
    <span class="annotation">@javax</span>.inject.Inject
    <span class="directive">private</span> SimpleObjects simpleObjects;                      <i class="conum" data-value="9"></i><b>(9)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>inherit from <code>org.apache.isis.applib.fixturescripts.FixtureScript</code>, as above</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>input property: name of the object; this time it is required</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>output property: the created simple object</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the mandatory execute(&#8230;&#8203;) API</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the <code>checkParam(&#8230;&#8203;)</code> (inherited from <code>FixtureScript</code>) will check that the "name" property has been populated (using Java&#8217;s Reflection API) and throw an exception if not</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>wrap the injected <code>SimpleObjects</code> domain service (using the <a href="rg.html#_rg_services-api_manpage-WrapperFactory"><code>WrapperFactory</code></a>) to simulate interaction through the UI&#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>.. and actually create the object using the "create" business action of that service</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>add the resulting object to the execution context; this makes the object available to access if run from the UI</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>inject the domain service into the fixture script</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_using_within_tests">Using within Tests</h5>
<div class="paragraph">
<p>Fixture scripts can be called from integration tests just the same way that fixture scripts can call one another.</p>
</div>
<div class="paragraph">
<p>For example, here&#8217;s an integration test from the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleObjectIntegTest</span> <span class="directive">extends</span> SimpleAppIntegTest {
    <span class="annotation">@Inject</span>
    FixtureScripts fixtureScripts;                      <i class="conum" data-value="1"></i><b>(1)</b>
    SimpleObject simpleObjectWrapped;
    <span class="annotation">@Before</span>
    <span class="directive">public</span> <span class="type">void</span> setUp() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="comment">// given</span>
        RecreateSimpleObjects fs =
             <span class="keyword">new</span> RecreateSimpleObjects().setNumber(<span class="integer">1</span>);  <i class="conum" data-value="2"></i><b>(2)</b>
        fixtureScripts.runFixtureScript(fs, <span class="predefined-constant">null</span>);      <i class="conum" data-value="3"></i><b>(3)</b>

        SimpleObject simpleObjectPojo =
            fs.getSimpleObjects().get(<span class="integer">0</span>);               <i class="conum" data-value="4"></i><b>(4)</b>
        assertThat(simpleObjectPojo).isNotNull();

        simpleObjectWrapped = wrap(simpleObjectPojo);   <i class="conum" data-value="5"></i><b>(5)</b>
    }
    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> accessible() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="comment">// when</span>
        <span class="directive">final</span> <span class="predefined-type">String</span> name = simpleObjectWrapped.getName();
        <span class="comment">// then</span>
        assertThat(name).isEqualTo(fs.NAMES.get(<span class="integer">0</span>));
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>inject the <code>FixtureScripts</code> domain service (just like any other domain service)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>instantiate the fixture script for this test, and configure</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>execute the fixture script</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>obtain the object under test from the fixture</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>wrap the object (to simulate being interacted with through the UI)</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_ug_testing_fixture-scripts_api-and-usage_organizing">Organizing Fixture scripts</h5>
<div class="paragraph">
<p>There are lots of ways to organize fixture scripts, but we&#8217;ve used them as either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a fairly flat style, eg as in the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a>, also as in the <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a>;</p>
</li>
<li>
<p>in a "composite pattern" style, eg as in the <a href="https://github.com/estatio/estatio/blob/ea20a6ce257acede50de6ce4fd2ff29713fcd689/estatioapp/fixture/src/main/java/org/estatio/fixture/invoice/InvoiceForLeaseItemTypeOfDiscountOneQuarterForOxfMiracle005.java#L66)">Estatio open source app</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These two styles are probably best illustrated with, well, some illustrations.  Here&#8217;s a fixture script in the "flat" style for setting up a customer with some orders, a number of which has been placed:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/testing/fixture-scripts/flat-1.png"><img src="images/testing/fixture-scripts/flat-1.png" alt="flat 1" width="700px"></a>
</div>
</div>
<div class="paragraph">
<p>Notice how we have a single script that&#8217;s in control of the overall process, and takes responsibility for passing data from one fixture script to the next.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a similar, simpler script, from the same fictional app, to set up two customers:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/testing/fixture-scripts/flat-2.png"><img src="images/testing/fixture-scripts/flat-2.png" alt="flat 2" width="500px"></a>
</div>
</div>
<div class="paragraph">
<p>We can reuse the same fixture "customer" script, either calling it twice or (perhaps better) passing it an array of customer details to set up.</p>
</div>
<div class="paragraph">
<p>With the composite style, we rely on each fixture script to set up its own prerequisites.  Thus:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/testing/fixture-scripts/composite.png"><img src="images/testing/fixture-scripts/composite.png" alt="composite" width="550px"></a>
</div>
</div>
<div class="paragraph">
<p>Back in the earlier section we noted the <code>MultipleExecutionStrategy</code> setting.  We can now explain the meaning of this: the enum value of <code>EXECUTE</code> is designed for the flat style (where every fixture script will be called), whereas the enum value of <code>IGNORE</code> is designed for the composite style, and ensures that any fixture scripts visited more than once (eg TearDown) are only every executed the first time.</p>
</div>
<div class="paragraph">
<p>As already noted , the app generated by the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a> uses the flat structure, and we feel that it&#8217;s a better at separating out the "how" (how we set up some graph of domain objects into a known state, eg a customer with shipped placed orders and a newly placed order) from the "what" (what data should we actually use for the customer&#8217;s name, say).</p>
</div>
<div class="paragraph">
<p>The composite style tends to combine these, which one could argue does not separate responsibilities well enough.  On the other hand, one could also make an argument that the composite style is a good way to implement precanned personas, eg "Joe", the customer who has a newly placed order, from "Mary" customer who has none.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_testing_fixture-scripts_sudo-service">12.5.2. <code>SudoService</code></h4>
<div class="paragraph">
<p>Sometimes in our fixture scripts we want to perform a business action running as a particular user.  This might be for the usual reason - so that our fixtures accurately reflect the reality of the system with all business constraints enforced using the <code>WrapperFactory</code> - or more straightforwardly it might be simply that the action depends on the identity of the user invoking the action.</p>
</div>
<div class="paragraph">
<p>An example of the latter case is in the (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a>'s <code>ToDoItem</code> class:</p>
</div>
<div class="listingblock">
<div class="title">Production code that depends on current user</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> ToDoItem newToDo(
        <span class="annotation">@Parameter</span>(regexPattern = <span class="string"><span class="delimiter">&quot;</span><span class="char">\\</span><span class="content">w[@&amp;:</span><span class="char">\\</span><span class="content">-</span><span class="char">\\</span><span class="content">,</span><span class="char">\\</span><span class="content">.</span><span class="char">\\</span><span class="content">+ </span><span class="char">\\</span><span class="content">w]*</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Description</span><span class="delimiter">&quot;</span></span>)
        <span class="directive">final</span> <span class="predefined-type">String</span> description,
        <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Category</span><span class="delimiter">&quot;</span></span>)
        <span class="directive">final</span> Category category,
        <span class="annotation">@Parameter</span>(optionality = Optionality.OPTIONAL) <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Subcategory</span><span class="delimiter">&quot;</span></span>)
        <span class="directive">final</span> Subcategory subcategory,
        <span class="annotation">@Parameter</span>(optionality = Optionality.OPTIONAL) <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Due by</span><span class="delimiter">&quot;</span></span>)
        <span class="directive">final</span> LocalDate dueBy,
        <span class="annotation">@Parameter</span>(optionality = Optionality.OPTIONAL) <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">&quot;</span><span class="content">Cost</span><span class="delimiter">&quot;</span></span>)
        <span class="directive">final</span> <span class="predefined-type">BigDecimal</span> cost) {
    <span class="keyword">return</span> newToDo(description, category, subcategory, currentUserName(), dueBy, cost);
}
<span class="directive">private</span> <span class="predefined-type">String</span> currentUserName() {
    <span class="keyword">return</span> container.getUser().getName(); <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>is the current user.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The fixture for this can use the <code>SudoService</code> to run a block of code as a specified user:</p>
</div>
<div class="listingblock">
<div class="title">Fixture Script</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> <span class="predefined-type">String</span> description = ...
final Category category = ...
final Subcategory subcategory = ...
final LocalDate dueBy = ...
final <span class="predefined-type">BigDecimal</span> cost = ...
final Location location = ...

toDoItem = sudoService.sudo(username,
        <span class="keyword">new</span> <span class="predefined-type">Callable</span>&lt;ToDoItem&gt;() {
            <span class="annotation">@Override</span>
            <span class="directive">public</span> ToDoItem call() {
                <span class="directive">final</span> ToDoItem toDoItem = wrap(toDoItems).newToDo(
                        description, category, subcategory, dueBy, cost);
                wrap(toDoItem).setLocation(location);
                <span class="keyword">return</span> toDoItem;
            }
        });</code></pre>
</div>
</div>
<div class="paragraph">
<p>Behind the scenes the <code>SudoService</code> simply talks to the <code>DomainObjectContainer</code> to override the user returned by the <code>getUser()</code> API.  It is possible to override both users and roles.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ug_headless-access">13. Headless access</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter tackles the topic of enabling access to an Isis application directly, or at least, not through either the <a href="#_ug_wicket-viewer">Wicket</a> or <a href="#_ug_restfulobjects-viewer">Restful</a> viewers.</p>
</div>
<div class="paragraph">
<p>There are several main use-cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>enabling background execution, eg of a thread managed by Quartz scheduler and running within the webapp</p>
</li>
<li>
<p>integration from other systems, eg for a subscriber on a pub/sub mechanism such as Camel, pushing changes through an Apache Isis domain model.</p>
</li>
<li>
<p>leveraging an Isis application within a batch process</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the calling thread runs in the same process space as the Apache Isis domain object model (must be physically linked to the JAR files containing the domain classes).  For use cases where the calling thread runs in some other process space (eg migrating data from a legacy system), then the <a href="#_ug_restfulobjects-viewer">Restful Objects viewer</a> is usually the way to go.</p>
</div>
<div class="paragraph">
<p>The API described in this chapter is reasonably low-level, allowing code to interact very directly with the Apache Isis metamodel and runtime.  Such callers should be considered trusted: they do not (by default) honour any business rules eg implicit in the Isis annotations or hide/disable/validate methods.  However the <a href="rg.html#_rg_services-api_manpage-WrapperFactory"><code>WrapperFactory</code></a> service could be used to enforce such business rules if required.</p>
</div>
<div class="sect2">
<h3 id="_ug_headless-access_AbstractIsisSessionTemplate">13.1. AbstractIsisSessionTemplate</h3>
<div class="paragraph">
<p>The <code>AbstractIsisSessionTemplate</code> class (whose name is inspired by the Spring framework&#8217;s naming convention for similar classes that query <a href="http://docs.spring.io/spring/docs/2.5.x/reference/jdbc.html#jdbc-JdbcTemplate">JDBC</a>, <a href="http://docs.spring.io/spring/docs/2.5.x/reference/jms.html#jms-jmstemplate">JMS</a>, <a href="http://docs.spring.io/spring/docs/2.5.x/reference/orm.html#orm-jpa-template">JPA</a> etc.) provides the mechanism to open up a 'session' within the Apache Isis framework, in order to resolve and interact with entities.</p>
</div>
<div class="paragraph">
<p>The class itself is intended to be subclassed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">AbstractIsisSessionTemplate</span> {

    <span class="directive">public</span> <span class="type">void</span> execute(<span class="directive">final</span> AuthenticationSession authSession, <span class="directive">final</span> <span class="predefined-type">Object</span> context) { ... } <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">protected</span> <span class="directive">abstract</span> <span class="type">void</span> doExecute(<span class="predefined-type">Object</span> context); <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="directive">protected</span> ObjectAdapter adapterFor(<span class="directive">final</span> <span class="predefined-type">Object</span> targetObject) { ... }
    <span class="directive">protected</span> ObjectAdapter adapterFor(<span class="directive">final</span> RootOid rootOid) { ... }

    <span class="directive">protected</span> PersistenceSession getPersistenceSession() { ... }
    <span class="directive">protected</span> IsisTransactionManager getTransactionManager() { ... }
    <span class="directive">protected</span> AdapterManager getAdapterManager() { ... }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>execute(&#8230;&#8203;)</code> sets up the <code>IsisSession</code> and delegates to &#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>doExecute(&#8230;&#8203;)</code>, the mandatory hook method for subclasses to implement.
The passed object represents passes a context from the caller (eg the scheduler, cron job, JMS etc) that instantiated and executed the class.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>protected</code> methods expose key internal APIs within Apache Isis, for the subclass to use as necessary.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>One notable feature of <code>AbstractIsisSessionTemplate</code> is that it will automatically inject any domain services into itself. Thus, it is relatively easy for the subclass to "reach into" the domain, through injected repository services.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ug_headless-access_BackgroundCommandExecution">13.2. BackgroundCommandExecution</h3>
<div class="paragraph">
<p>The <code>BackgroundCommandExecution</code> class (a subclass of <a href="#_ug_headless-access_AbstractIsisSessionTemplate">AbstractIsisSessionTemplate</a>) is intended to simplify the execution of background <code>Command</code>s persisted by way of the <a href="rg.html#_rg_services-spi_manpage-CommandService"><code>CommandService</code></a> and the <a href="rg.html#_rg_services-spi_manpage-BackgroundCommandService"><code>BackgroundCommandService</code></a>.</p>
</div>
<div class="paragraph">
<p>Its signature is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">BackgroundCommandExecution</span> <span class="directive">extends</span> AbstractIsisSessionTemplate {
    <span class="directive">protected</span> <span class="type">void</span> doExecute(<span class="predefined-type">Object</span> context) { ... }
    <span class="directive">protected</span> <span class="directive">abstract</span> <span class="predefined-type">List</span>&lt;? <span class="directive">extends</span> Command&gt; findBackgroundCommandsToExecute(); <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>findBackgroundCommandsToExecute()</code> is a mandatory hook method for subclasses to implement.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This allows for different implementations of the <code>CommandService</code> and <code>BackgroundCommandService</code> to persist to wherever.</p>
</div>
<div class="paragraph">
<p>The diagram below (<a href="http://yuml.me/edit/363b335f">yuml.me/363b335f</a>) shows the dependencies between these various classes:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/headless-access/BackgroundCommandExecution.png" alt="BackgroundCommandExecution" width="400px">
</div>
<div class="title">Figure 5. Inheritance Hierarchy for <code>BackgroundCommandExecution</code></div>
</div>
<div class="sect3">
<h4 id="_background_execution">13.2.1. Background Execution</h4>
<div class="paragraph">
<p>The <code>BackgroundCommandExecutionFromBackgroundCommandServiceJdo</code> is a concrete subclass of <code>BackgroundCommandExecution</code> (see the <a href="rg.html#_rg_services-api_manpage-BackgroundService"><code>BackgroundCommandService</code></a>), the intended use being for the class to be instantiated regularly (eg every 10 seconds) by a scheduler such as <a href="http://quartz-scheduler.org">Quartz</a>) to poll for <code>Command</code>s to be executed, and then execute them.</p>
</div>
<div class="paragraph">
<p>This implementation queries for <code>Command</code>s persisted by the <a href="http://www.isisaddons.org/isis-module-command">Isis addons Command Module</a>'s  implementations of <a href="rg.html#_rg_services-spi_manpage-CommandService"><code>CommandService</code></a> and <a href="rg.html#_rg_services-spi_manpage-BackgroundCommandService"><code>BackgroundCommandService</code></a> using the <code>BackgroundCommandServiceJdoRepository</code>.</p>
</div>
<div class="paragraph">
<p>The diagram below (<a href="http://yuml.me/edit/25343da1">yuml.me/25343da1</a>) shows the inheritance hierarchy for this class:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/headless-access/BackgroundCommandExecutionFromBackgroundCommandServiceJdo.png" alt="BackgroundCommandExecutionFromBackgroundCommandServiceJdo" width="500px">
</div>
<div class="title">Figure 6. Inheritance Hierarchy for <code>BackgroundCommandExecutionFromBackgroundCommandServiceJdo</code></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ug_extending">14. Extending</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter explains the main APIs for extending Apache Isis: the programming model conventions, the Wicket viewer, and the Restful Objects viewer.</p>
</div>
<div class="sect2">
<h3 id="_ug_extending_programming-model">14.1. Programming Model</h3>
<div class="paragraph">
<p>This section describes three mechanisms you can use to extend or alter the programming conventions that Isis understands to build up its metamodel.</p>
</div>
<div class="sect3">
<h4 id="_ug_extending_programming-model_custom-validator">14.1.1. Custom validator</h4>
<div class="paragraph">
<p>Apache Isis' programming model includes a validator component that detects and prevents (by failing fast) a number of situations where the domain model is logically inconsistent with itself.</p>
</div>
<div class="paragraph">
<p>For example, the validator will detect any orphaned supporting methods (eg <code>hideXxx()</code>) if the corresponding property or action has been renamed or deleted but the supporting method was not also updated.  Another example is that a class cannot have a title specified both using <code>title()</code> method and also using <code>@Title</code> annotation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The support for <a href="rg.html#_rg_annotations_aaa_deprecated">disallowing deprecated annotations</a> is also implemented using the metamodel validator.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also impose your own application-specific rules by installing your own metamodel validator.  To give just one example, you could impose naming standards such as ensuring that a domain-specific abbreviation such as "ISBN" is always consistently capitalized wherever it appears in a class member.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Isis' <a href="#_ug_isis-maven-plugin">Maven plugin</a> will also validate the domain object model during build time.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_api_and_implementation">API and Implementation</h5>
<div class="paragraph">
<p>There are several ways to go about implementing a validator.</p>
</div>
<div class="sect5">
<h6 id="__code_metamodelvalidator_code"><code>MetaModelValidator</code></h6>
<div class="paragraph">
<p>Any custom validator must implement Apache Isis' internal <code>MetaModelValidator</code> interface, so the simplest option is just to implement <code>MetaModelValidator</code> directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">MetaModelValidator</span>
        <span class="directive">implements</span> SpecificationLoaderSpiAware { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="type">void</span> validate(
        ValidationFailures validationFailures);  <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>SpecificationLoader</code> is the internal API providing access to the Apache Isis metamodel.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>add any metamodel violations to the <code>ValidationFailures</code> parameter (the <a href="http://c2.com/cgi/wiki?CollectingParameter">collecting parameter</a> pattern)</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="__code_visitor_code"><code>Visitor</code></h6>
<div class="paragraph">
<p>More often than not, you&#8217;ll want to visit every element in the metamodel, and so for this you can instead subclass from <code>MetaModelValidatorVisiting.Visitor</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">MetaModelValidatorVisiting</span> ... {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">interface</span> <span class="class">Visitor</span> {
        <span class="directive">public</span> <span class="type">boolean</span> visit(                       <i class="conum" data-value="1"></i><b>(1)</b>
            ObjectSpecification objectSpec,         <i class="conum" data-value="2"></i><b>(2)</b>
            ValidationFailures validationFailures); <i class="conum" data-value="3"></i><b>(3)</b>
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>return <code>true</code> continue visiting specs.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>ObjectSpecification</code> is the internal API representing a class</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>add any metamodel violations to the <code>ValidationFailures</code> parameter</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can then create your custom validator by subclassing <code>MetaModelValidatorComposite</code> and adding the visiting validator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyMetaModelValidator</span> <span class="directive">extends</span> MetaModelValidatorComposite {
    <span class="directive">public</span> MyMetaModelValidator() {
        add(<span class="keyword">new</span> MetaModelValidatorVisiting(<span class="keyword">new</span> MyVisitor()));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have more than one rule then each can live in its own visitor.</p>
</div>
</div>
<div class="sect5">
<h6 id="__code_summarizingvisitor_code"><code>SummarizingVisitor</code></h6>
<div class="paragraph">
<p>As a slight refinement, you can also subclass from <code>MetaModelValidatorVisiting.SummarizingVisitor</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">MetaModelValidatorVisiting</span> ... {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">interface</span> <span class="class">SummarizingVisitor</span> <span class="directive">extends</span> Visitor {
        <span class="directive">public</span> <span class="type">void</span> summarize(ValidationFailures validationFailures);
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>SummarizingVisitor</code> will be called once after every element in the metamodel has been visited.  This is great for performing checks on the metamodel as a whole.  For example, Apache Isis uses this to check that there is at least one <code>@Persistable</code> domain entity defined.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_10">Configuration</h5>
<div class="paragraph">
<p>Once you have implemented your validator, you must register it with the framework by defining the appropriate configuration property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.reflector.validator=com.mycompany.myapp.MyMetaModelValidator</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_extending_programming-model_finetuning">14.1.2. Finetuning</h4>
<div class="paragraph">
<p>The core metamodel defines APIs and implementations for building the Apache Isis metamodel: a description of the set of entities, domain services and values that make up the domain model.</p>
</div>
<div class="paragraph">
<p>The description of each domain class consists of a number of elements:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://github.com/apache/isis/blob/master/core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/ObjectSpecification.java">ObjectSpecification</a></dt>
<dd>
<p>Analogous to <code>java.lang.Class</code>; holds information about the class itself and holds collections of each of the three types of class' members (below);</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/apache/isis/blob/master/core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/feature/OneToOneAssociation.java">OneToOneAssociation</a></dt>
<dd>
<p>Represents a class member that is a single-valued property of the class. The property&#8217;s type is either a reference to another entity, or is a value type.</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/apache/isis/blob/master/core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/feature/OneToManyAssociation.java">OneToManyAssociation</a></dt>
<dd>
<p>Represents a class member that is a collection of references to other entities. Note that Apache Isis does not currently support collections of values.</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/apache/isis/blob/master/core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/feature/ObjectAction.java">ObjectAction</a></dt>
<dd>
<p>Represents a class member that is an operation that can be performed on the action. Returns either a single value, a collection of entities, or is <code>void</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The metamodel is built up through the <a href="https://github.com/apache/isis/blob/master/core/metamodel/src/main/java/org/apache/isis/core/metamodel/progmodel/ProgrammingModel.java">ProgrammingModel</a>, which defines an API for registering a set of <a href="https://github.com/apache/isis/blob/master/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/FacetFactory.java">FacetFactory</a>s.  Two special <code>FacetFactory</code> implementations - <a href="https://github.com/apache/isis/blob/master/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/properties/accessor/PropertyAccessorFacetViaAccessorFactory.java">PropertyAccessorFacetFactory</a> and <a href="https://github.com/apache/isis/blob/master/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/collections/accessor/CollectionAccessorFacetViaAccessorFactory.java">CollectionAccessorFacetFactory</a> - are used to identify the class members.
Pretty much all the other <code>FacetFactory</code>s are responsible for installing <a href="https://github.com/apache/isis/blob/master/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facetapi/Facet.java">Facet</a>s onto the metamodel elements.</p>
</div>
<div class="paragraph">
<p>There are many many such <code>Facet</code>s, and are used to do such things get values from properties or collections, modify properties or collections, invoke action, hide or disable class members, provide UI hints for class members, and so on. In short, the <code>FacetFactory</code>s registered defines the Apache Isis programming conventions.</p>
</div>
<div class="sect4">
<h5 id="_modifying_the_prog_model">Modifying the Prog. Model</h5>
<div class="paragraph">
<p>The default implementation of <code>ProgrammingModel</code> is <a href="https://github.com/apache/isis/blob/master/core/metamodel/src/main/java/org/apache/isis/progmodels/dflt/ProgrammingModelFacetsJava5.java">ProgrammingModelFacetsJava5</a>, which registers a large number of <code>FacetFactory</code>s.</p>
</div>
<div class="paragraph">
<p>By editing <code>isis.properties</code> you can modify the programming conventions either by (a) using the default programming model, but tweaking it to include new `FacetFactory`s or exclude existing, or (b) by specifying a completely different programming model implementation.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see how this is done.</p>
</div>
<div class="sect5">
<h6 id="_including_or_excluding_facets">Including or excluding facets</h6>
<div class="paragraph">
<p>Suppose that you wanted to completely remove support for the (already deprecated) <code>@ActionOrder</code> annotation. This would be done using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.reflector.facets.exclude=org.apache.isis.core.metamodel.facets.object.actionorder.annotation.ActionOrderFacetAnnotationFactory</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, suppose you wanted to use the example <a href="https://github.com/apache/isis/blob/master/mothballed/misc/metamodel/namefile/src/main/java/org/apache/isis/example/metamodel/namefile/facets/NameFileFacetFactory.java">"namefile"</a> <code>FacetFactory</code> as part of your programming conventions, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.reflector.facets.include=org.apache.isis.example.metamodel.namefile.facets.NameFileFacetFactory</code></pre>
</div>
</div>
<div class="paragraph">
<p>To include/exclude more than one <code>FacetFactory</code>, specify as a comma-separated list. And if you want to dig into this in more detail, the code that implements this logic is <a href="https://github.com/apache/isis/blob/master/core/metamodel/src/main/java/org/apache/isis/progmodels/dflt/JavaReflectorInstallerNoDecorators.java">JavaReflectorInstallerNoDecorators</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This <a href="http://isis.markmail.org/thread/472c3mrvcgnripst">thread</a> from the users mailing list (in Apr 2014) shows a typical customization (to enable per-instance security) (though note that <a href="#_ug_more-advanced_multi-tenancy">Multi-Tenancy</a> is now a better solution to that particular use-case.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_replacing_the_prog_model">Replacing the Prog. Model</h5>
<div class="paragraph">
<p>If you want to make many changes to the programming model, then (rather than include/exclude lots of facet factories) you can specify a completely new programming model.  For this you&#8217;ll first need an implementation of <code>ProgrammingModel</code>.</p>
</div>
<div class="paragraph">
<p>One option is to subclass from <code>ProgrammingModelFacetsJava5</code>; in your subclass you could remove any <code>FacetFactory</code>s that you wanted to exclude, as well as registering your own implementations.</p>
</div>
<div class="paragraph">
<p>To tell Apache Isis to use your new programming model, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.reflector.facets=com.mycompany.myapp.isis.IsisProgrammingModel</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, the code that implements this logic is <a href="https://github.com/apache/isis/blob/master/core/metamodel/src/main/java/org/apache/isis/progmodels/dflt/JavaReflectorInstallerNoDecorators.java">JavaReflectorInstallerNoDecorators</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_extending_programming-model_layout-metadata-reader">14.1.3. Layout Metadata Reader</h4>
<div class="paragraph">
<p>The metadata for domain objects is obtained both <a href="rg.html#_rg_object-layout_static">statically</a> and <a href="rg.html#_rg_object-layout_dynamic">dynamically</a>.</p>
</div>
<div class="paragraph">
<p>The default implementation for reading dynamic layout metadata is <code>org.apache.isis.core.metamodel.layoutmetadata.json.LayoutMetadataReaderFromJson</code>, which is responsible for reading from the <code>Xxx.layout.json</code> files on the classpath (for each domain entity <code>Xxx</code>).</p>
</div>
<div class="paragraph">
<p>You can also implement your own metadata readers and plug them into Apache Isis.  These could read from a different file format, or they could, even, read data dynamically from a URL or database.  (Indeed, one could imagine an implementation whereby users could share layouts, all stored in some central repository).</p>
</div>
<div class="sect4">
<h5 id="_api_and_implementation_2">API and Implementation</h5>
<div class="paragraph">
<p>Any reader must implement Apache Isis' internal <code>LayoutMetadataReader</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">LayoutMetadataReader</span> {
    <span class="directive">public</span> <span class="predefined-type">Properties</span> asProperties(<span class="predefined-type">Class</span>&lt;?&gt; domainClass) <span class="directive">throws</span> ReaderException;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The implementation "simply" returns a set of properties where the property key is a unique identifier to both the class member and also the facet of the class member to which the metadata relates.</p>
</div>
<div class="paragraph">
<p>See the implementation of the built-in <code>LayoutMetadataReaderFromJson</code> for more detail.</p>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_11">Configuration</h5>
<div class="paragraph">
<p>Once you have implemented your validator, you must register it with the framework by defining the appropriate configuration property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.reflector.layoutMetadataReaders=\
           com.mycompany.myapp.MyMetaModelValidator,\
           org.apache.isis.core.metamodel.layoutmetadata.json.LayoutMetadataReaderFromJson   <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the property replaces any existing metadata readers; if you want to preserve the ability to read from <code>Xxx.layout.json</code> then also register Apache Isis' built-in implementation.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_extending_wicket-viewer">14.2. Wicket viewer</h3>
<div class="paragraph">
<p>The Wicket viewer allows you to customize the GUI in several (progressively more sophisticated) ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>by <a href="#_ug_wicket-viewer_customisation_tweaking-css-classes">tweaking the UI using CSS</a></p>
</li>
<li>
<p>by <a href="#_ug_wicket-viewer_customisation_custom-javascript">tweaking the UI using Javascript</a></p>
</li>
<li>
<p>by writing a <a href="#_ug_extending_wicket-viewer_custom-bootstrap-theme">custom bootstrap theme</a></p>
</li>
<li>
<p>by <a href="#_ug_extending_wicket-viewer_replacing-page-elements">replacing elements of the page</a> using the <code>ComponentFactory</code> interface</p>
</li>
<li>
<p>by implementing <a href="#_ug_extending_wicket-viewer_custom-pages">replacement page implementations</a> for the standard page types</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first two of these options are discussed in the <a href="#_ug_wicket-viewer">Wicket viewer</a> chapter.  This chapter describes the remaining "heavier-weight/more powerful" options.</p>
</div>
<div class="sect3">
<h4 id="_ug_extending_wicket-viewer_custom-bootstrap-theme">14.2.1. Custom Bootstrap theme</h4>
<div class="paragraph">
<p>The Apache Isis Wicket viewer uses <a href="http://getbootstrap.com/">Bootstrap</a> styles and components (courtesy of the <a href="https://github.com/l0rdn1kk0n/wicket-bootstrap">Wicket Bootstrap</a> integration).</p>
</div>
<div class="paragraph">
<p>By default the viewer uses the default bootstrap theme. It is possible to configure the Wicket viewer to allow the user to <a href="#_ug_wicket-viewer_configuration-properties_showing-theme-chooser">select other themes</a> provided by <a href="http://bootswatch.com">bootswatch.com</a>, and if required one of these can be <a href="#_ug_wicket-viewer_customisation_default-theme">set as the default</a>.</p>
</div>
<div class="paragraph">
<p>However, you may instead want to write your own custom theme, for example to fit your company&#8217;s look-n-feel/interface guidelines. This is done by implementing <a href="https://github.com/l0rdn1kk0n/wicket-bootstrap">Wicket Bootstrap</a>â€™s <code>de.agilecoders.wicket.core.settings.ITheme</code> class. This defines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the name of the theme</p>
</li>
<li>
<p>the resources it needs (the CSS and optional JS and/or fonts), and</p>
</li>
<li>
<p>optional urls to load them from a Content Delivery Network (CDN).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To make use of the custom <code>ITheme</code> the application should register it by adding the following snippet in
(your application&#8217;s subclass of) <code>IsisWicketApplication</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> init() {
    ...
    IBootstrapSettings settings = <span class="keyword">new</span> BootstrapSettings();
    ThemeProvider themeProvider = <span class="keyword">new</span> SingleThemeProvider(<span class="keyword">new</span> MyTheme());
    settings.setThemeProvider(themeProvider);
    Bootstrap.install(getClass(), settings);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_extending_wicket-viewer_replacing-page-elements">14.2.2. Replacing page elements</h4>
<div class="paragraph">
<p>Replacing elements of the page is the most powerful general-purpose way to customize the look-n-feel of the viewer.  Examples at the (non-ASF) <a href="http://www.isisaddons.org">Isis Add-ons</a> include the <a href="http://github.com/isisaddons/isis-wicket-gmap3">gmap3</a> extension, the <a href="http://github.com/isisaddons/isis-wicket-fullcalendar2">calendar</a> extension, the <a href="http://github.com/isisaddons/isis-wicket-excel">excel download</a> and the <a href="http://github.com/isisaddons/isis-wicket-wickedcharts">wickedcharts</a> charting integration.</p>
</div>
<div class="paragraph">
<p>The pages generated by Apache Isis' Wicket viewer are built up of numerous elements, from fine-grained widgets for property/parameter fields, to much larger components that take responsibility for rendering an entire entity entity, or a collection of entities. Under the covers these are all implementations of the the Apache Wicket <code>Component</code> API. The larger components delegate to the smaller, of course.</p>
</div>
<div class="sect4">
<h5 id="_how_the_viewer_selects_components">How the viewer selects components</h5>
<div class="paragraph">
<p>Components are created using Apache Isis' <code>ComponentFactory</code> interface, which are registered in turn through the <code>ComponentFactoryRegistrar</code> interface. Every component is categorizes by type (the <code>ComponentType</code> enum), and Apache Isis uses this to determine which <code>ComponentFactory</code> to use. For example, the <code>ComponentType.BOOKMARKED_PAGES</code> is used to locate the <code>ComponentFactory</code> that will build the bookmarked pages panel.</p>
</div>
<div class="paragraph">
<p>Each factory is also handed a model (an implementation of <code>org.apache.wicket.IModel</code>) appropriate to its <code>ComponentType</code>; this holds the data to be rendered. For example, <code>ComponentType.BOOKMARKED_PAGES</code> is given a <code>BookmarkedPagesModel</code>, while <code>ComponentType.SCALAR_NAME_AND_VALUE</code> factories are provided a model of type of type <code>ScalarModel</code> .</p>
</div>
<div class="paragraph">
<p>In some cases there are several factories for a given <code>ComponentType</code>; this is most notably the case for <code>ComponentType.SCALAR_NAME_AND_VALUE</code>. After doing a first pass selection of candidate factories by <code>ComponentType</code>, each factory is then asked if it <code>appliesTo(Model)</code>. This is an opportunity for the factory to check the model itself to see if the data within it is of the appropriate type.</p>
</div>
<div class="paragraph">
<p>Thus, the <code>BooleanPanelFactory</code> checks that the <code>ScalarModel</code> holds a boolean, while the <code>JodaLocalDatePanelFactory</code> checks to see if it holds <code>org.joda.time.LocalDate</code>.</p>
</div>
<div class="paragraph">
<p>There will typically be only one <code>ComponentFactory</code> capable of rendering a particular <code>ComponentType</code>/<code>ScalarModel</code> combination; at any rate, the framework stops as soon as one is found.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There is one refinement to the above algorithm where multiple component factories might be used to render an object; this is discussed in <a href="#_ug_extending_wicket-viewer_replacing-page-elements_collections">Additional Views of Collections</a>, below.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_how_to_replace_a_component">How to replace a component</h5>
<div class="paragraph">
<p>This design (the <a href="http://en.wikipedia.org/wiki/Chain-of-responsibility_pattern">chain of responsibility</a> design pattern) makes it quite straightforward to change the rendering of any element of the page. For example, you might switch out Apache Isis' sliding bookmark panel and replace it with one that presents the bookmarks in some different fashion.</p>
</div>
<div class="paragraph">
<p>First, you need to write a <code>ComponentFactory</code> and corresponding <code>Component</code>. The recommended approach is to start with the source of the <code>Component</code> you want to switch out. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyBookmarkedPagesPanelFactory</span> <span class="directive">extends</span> ComponentFactoryAbstract {
    <span class="directive">public</span> MyBookmarkedPagesPanelFactory() {
        <span class="local-variable">super</span>(ComponentType.BOOKMARKED_PAGES);
    }
    <span class="annotation">@Override</span>
    <span class="directive">public</span> ApplicationAdvice appliesTo(<span class="directive">final</span> IModel&lt;?&gt; model) {
        <span class="keyword">return</span> appliesIf(model <span class="keyword">instanceof</span> BookmarkedPagesModel);
    }
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Component</span> createComponent(<span class="directive">final</span> <span class="predefined-type">String</span> id, <span class="directive">final</span> IModel&lt;?&gt; model) {
        <span class="directive">final</span> BookmarkedPagesModel bookmarkedPagesModel = (BookmarkedPagesModel) model;
        <span class="keyword">return</span> <span class="keyword">new</span> MyBookmarkedPagesPanel(id, bookmarkedPagesModel);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyBookmarkedPagesPanel</span>
    <span class="directive">extends</span> PanelAbstract&lt;BookmarkedPagesModel&gt; {
   ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here <code>PanelAbstract</code> ultimately inherits from <code>org.apache.wicket.Component</code>.
Your new <code>Component</code> uses the information in the provided model (eg <code>BookmarkedPagesModel</code>) to know what to render.</p>
</div>
<div class="paragraph">
<p>Next, you will require a custom implementation of the <code>ComponentFactoryRegistrar</code> that registers your custom <code>ComponentFactory</code> as a replacement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyComponentFactoryRegistrar</span> <span class="directive">extends</span> ComponentFactoryRegistrarDefault {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> addComponentFactories(ComponentFactoryList componentFactories) {
        <span class="local-variable">super</span>.addComponentFactories(componentFactories);
        componentFactories.add(<span class="keyword">new</span> MyBookmarkedPagesPanelFactory());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will result in the new component being used instead of (that is, discovered prior to) Isis' default implementation.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Previously we suggested using "replace" rather than "add"; however this has unclear semantics for some component types; see <a href="https://issues.apache.org/jira/browse/ISIS-996">ISIS-996</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally (as for other customizations), you need to adjust the Guice bindings in your custom subclass of <code>IsisWicketApplication</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyAppApplication</span> <span class="directive">extends</span> IsisWicketApplication {
    <span class="annotation">@Override</span>
    <span class="directive">protected</span> Module newIsisWicketModule() {
        <span class="directive">final</span> Module isisDefaults = <span class="local-variable">super</span>.newIsisWicketModule();
        <span class="directive">final</span> Module myAppOverrides = <span class="keyword">new</span> AbstractModule() {
            <span class="annotation">@Override</span>
            <span class="directive">protected</span> <span class="type">void</span> configure() {
                ...
                bind(ComponentFactoryRegistrar.class)
                    .to(MyComponentFactoryRegistrar.class);
                ...
            }
        };

        <span class="keyword">return</span> Modules.override(isisDefaults).with(myAppOverrides);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ug_extending_wicket-viewer_replacing-page-elements_collections">Additional Views of Collections</h5>
<div class="paragraph">
<p>As explained above, in most cases Apache Isis' Wicket viewer will search for the first <code>ComponentFactory</code> that can render an element, and use it. In the case of (either standalone or parented) collections, though, Apache Isis will show all available views.</p>
</div>
<div class="paragraph">
<p>For example, out-of-the-box Apache Isis provides a table view, a summary view (totals/sums/averages of any data), and a collapsed view (for <code>@Render(LAZILY)</code> collections). These are selected by clicking on the toolbar by each collection.</p>
</div>
<div class="paragraph">
<p>Additional views though could render the objects in the collection as a variety of ways. Indeed, some third-party implementations already exist:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/isisaddons/isis-wicket-excel">excel integration</a> (collection as a downloadable excel spreadsheet)</p>
</li>
<li>
<p><a href="https://github.com/isisaddons/isis-wicket-gmap3">google maps v3 integration</a> (render any objects with a location on a map)</p>
</li>
<li>
<p><a href="https://github.com/isisaddons/isis-wicket-wickedcharts">wicked charts integration</a> (barchart of any data)</p>
</li>
<li>
<p><a href="https://github.com/isisaddons/isis-wicket-fullcalendar2">full calendar integration</a> (render any objects with date properties on a calendar)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Registering these custom views is just a matter of adding the appropriate Maven module to the classpath. Apache Isis uses the JDK <code>ServiceLoader</code> API to automatically discover and register the <code>ComponentFactory</code> of each such component.</p>
</div>
<div class="paragraph">
<p>If you want to write your own alternative component and auto-register, then include a file <code>META-INF/services/org.apache.isis.viewer.wicket.ui.ComponentFactory</code> whose contents is the fully-qualified class name of the custom <code>ComponentFactory</code> that you have written.</p>
</div>
<div class="paragraph">
<p>Wicket itself has lots of components available at its <a href="http://wicketstuff.org">wicketstuff.org</a> companion website; you might find some of these useful for your own customizations.</p>
</div>
</div>
<div class="sect4">
<h5 id="_custom_object_view_eg_dashboard">Custom object view (eg dashboard)</h5>
<div class="paragraph">
<p>One further use case in particular is worth highlighting; the rendering of an entire entity. Normally entities this is done using <code>EntityCombinedPanelFactory</code>, this being the first <code>ComponentFactory</code> for the <code>ComponentType.ENTITY</code> that is registered in Apache Isis default <code>ComponentFactoryRegistrarDefault</code>.</p>
</div>
<div class="paragraph">
<p>You could, though, register your own <code>ComponentFactory</code> for entities that is targeted at a particular class of entity - some sort of object representing a dashboard, for example. It can use the <code>EntityModel</code> provided to it to determine the class of the entity, checking if it is of the appropriate type. Your custom factory should also be registered before the <code>EntityCombinedPanelFactory</code> so that it is checked prior to the default <code>EntityCombinedPanelFactory</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyComponentFactoryRegistrar</span> <span class="directive">extends</span> ComponentFactoryRegistrarDefault {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> addComponentFactories(ComponentFactoryList componentFactories) {
        componentFactories.add(<span class="keyword">new</span> DashboardEntityFactory());
        ...
        super.addComponentFactories(componentFactories);
        ...
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_extending_wicket-viewer_custom-pages">14.2.3. Custom pages</h4>
<div class="paragraph">
<p>In the vast majority of cases customization should be sufficient by <a href="#_ug_extending_wicket-viewer_replacing-page-elements">replacing elements of a page</a>. However, it is also possible to define an entirely new page for a given page type.</p>
</div>
<div class="paragraph">
<p>Isis defines eight page types (see the <code>org.apache.isis.viewer.wicket.model.models.PageType</code> enum):</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 8. PageType enum</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Page type</th>
<th class="tableblock halign-left valign-top">Renders</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SIGN_IN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The initial sign-in (aka login) page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SIGN_UP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sign-up page (if <a href="rg.html#_rg_services-spi_manpage-UserRegistrationService">user registration</a> is enabled).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SIGN_UP_VERIFY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sign-up verification page (if <a href="rg.html#_rg_services-spi_manpage-UserRegistrationService">user registration</a> is enabled; as accessed by link from verification email)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PASSWORD_RESET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password reset page (if enabled).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HOME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The home page, displaying either the welcome message or dashboard</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ABOUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The about page, accessible from link top-right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENTITY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renders a single entity or view model</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">STANDALONE_COLLECTION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Page rendered after invoking an action that returns a collection of entites</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VALUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After invoking an action that returns a value type (though not URLs or Blob/Clobs, as these are handled appropriately automatically).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VOID_RETURN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After invoking an action that is <code>void</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTION_PROMPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(No longer used).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>PageClassList</code> interface declares which class (subclass of <code>org.apache.wicket.Page</code> is used to render for each of these types.  For example, Apache Isis' <code>WicketSignInPage</code> renders the signin page.</p>
</div>
<div class="paragraph">
<p>To specify a different page class, create a custom subclass of <code>PageClassList</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyPageClassList</span> <span class="directive">extends</span> PageClassListDefault {
    <span class="directive">protected</span> <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> Page&gt; getSignInPageClass() {
        <span class="keyword">return</span> MySignInPage.class;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You then need to register your custom <code>PageClassList</code>.  This is done by adjusting the Guice bindings (part of Apache Isis' bootstrapping) in your custom subclass of <code>IsisWicketApplication</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyAppApplication</span> <span class="directive">extends</span> IsisWicketApplication {
    <span class="annotation">@Override</span>
    <span class="directive">protected</span> Module newIsisWicketModule() {
        <span class="directive">final</span> Module isisDefaults = <span class="local-variable">super</span>.newIsisWicketModule();
        <span class="directive">final</span> Module myAppOverrides = <span class="keyword">new</span> AbstractModule() {
            <span class="annotation">@Override</span>
            <span class="directive">protected</span> <span class="type">void</span> configure() {
                ...
                bind(PageClassList.class).to(MyPageClassList.class);
                ...
            }
        };
        <span class="keyword">return</span> Modules.override(isisDefaults).with(myAppOverrides);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_extending_wicket-viewer_isis-addons-extensions">14.2.4. Isis Addons Extensions</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that Isis addons, while maintained by Apache Isis committers, are not part of the ASF.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_extending_restfulobjects-viewer">14.3. Restful Objects viewer</h3>
<div class="paragraph">
<p>The <a href="#_ug_restfulobjects-viewer">RestfulObjects viewer</a> implements the <a href="http://restfulobjects.org">Restful Object spec</a>, meaning that it defines a well-defined set of endpoint URLs as resources, and generates a well-defined set of (JSON) representations when these resources are accessed.</p>
</div>
<div class="paragraph">
<p>Sometimes though you may want to extend or change the representations generated.  This might be because you want to write a RESTful client that uses a particular library (say a Javascript library or web components) that can only handle representations in a certain form.</p>
</div>
<div class="paragraph">
<p>Or, you might want to have Apache Isis generate representations according to some other "standard", of which there are many (see note).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Other "standards" for defining representations that we are aware of include: <a href="http://stateless.co/hal_specification.html">HAL</a> (Mike Kelly), <a href="http://amundsen.com/media-types/collection/">Collection+JSON</a> (Mike Amundsen), <a href="https://github.com/kevinswiber/siren">Siren</a> (Kevin Swiber), <a href="http://jsonapi.org/">JSON API</a> (Steve Klabnik), <a href="https://github.com/cainus/hyper-json-spec">Hyper+JSON</a> (Gregg Cainus), <a href="https://www.w3.org/TR/json-ld/">JSON-LD</a> (W3C) and <a href="http://www.markus-lanthaler.com/hydra/">Hydra</a> (Markus Lanthaler).</p>
</div>
<div class="paragraph">
<p>A good discussion about the relative merits of several of these different hypermedia formats can be found <a href="https://groups.google.com/forum/#!msg/api-craft/NgjzQYVOE4s/EAB2jxtU_TMJ">here</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Whatever your reasons, Apache Isis provides several mechanisms by which you can change the generated representation.  This section lists these, from the simplest (most limited) to the most flexible (more work).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configuration Properties<br></p>
<div class="paragraph">
<p>If all that is required is a very simple representations (of objects), you can reconfigure the <a href="#_ug_restfulobjects-viewer">RestfulObjects viewer</a> to provide a simplified output, as described <a href="#_ug_restfulobjects-viewer_configuration-properties_simplified-object-representation">here</a>.<br></p>
</div>
<div class="paragraph">
<p>If you simply want to suppress certain elements, as described  <a href="#_ug_restfulobjects-viewer_configuration-properties_suppressing-elements">here</a>.</p>
</div>
</li>
<li>
<p><code>RepresentationService</code><br></p>
<div class="paragraph">
<p>The <a href="rg.html#_rg_services-spi_manpage-RepresentationService"><code>RepresentationService</code></a> is an SPI domain service (plugin-point) that allows an arbitrary representation to be generated for any of the resources defined in the RO spec.<br></p>
</div>
<div class="paragraph">
<p>The default implementation does, of course, generate the representations as defined in the RO spec.</p>
</div>
</li>
<li>
<p><code>ContentNegotiationService</code><br></p>
<div class="paragraph">
<p>The <a href="rg.html#_rg_services-spi_manpage-ContentNegotiationService"><code>ContentNegotiationService</code></a> is very similar to <code>RepresentationService</code>, in that it allows for a different representation to be generated.  It isn&#8217;t responsible for generating the default RO representations, however; if can simply return <code>null</code> (and leave it to the <code>RepresentationService</code> to generate the correct representations.<br></p>
</div>
<div class="paragraph">
<p>The default implementation provides support for the <code>x-ro-domain-type</code> parameter for HTTP <code>Accept</code> headers, providing the capability sketched out in section 34.1 of the RO spec v1.0.  As such, it delegates to <code>ContentMappingService</code>, described below.</p>
</div>
</li>
<li>
<p><code>ContentMappingService</code><br></p>
<div class="paragraph">
<p>The <a href="rg.html#_rg_services-spi_manpage-ContentMappingService"><code>ContentMappingService</code></a> is used by the default implementation of <code>ContentNegotationService</code> to transform a domain object (usually an entity) into some other form (usually a DTO), as specified by the <code>x-ro-domain-type</code> parameter.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This diagram shows how these services collaborate:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-services-spi/RepresentationService/service-collaborations.png"><img src="images/reference-services-spi/RepresentationService/service-collaborations.png" alt="service collaborations" width="700px"></a>
</div>
</div>
<div class="paragraph">
<p>Taken together these configuration properties and domain services offer a lot of flexibility in terms of the representations that can be generated from the <a href="#_ug_restfulobjects-viewer">RestfulObjects viewer</a>.  Please be aware though that these using these SPIs means that the representations generated by the viewer are no longer conformant with those of the RO spec.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ug_troubleshooting">15. Troubleshooting</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_logging_2">15.1. Logging</h3>

</div>
<div class="sect2">
<h3 id="_ug_troubleshooting_enabling-logging">15.2. Enabling Logging</h3>
<div class="paragraph">
<p>Sometimes you just need to see what is going on. There are various ways in which logging can be enabled, here are the ones we tend to use.</p>
</div>
<div class="sect3">
<h4 id="_in_apache_isis">15.2.1. In Apache Isis</h4>
<div class="paragraph">
<p>Modify <code>WEB-INF/logging.properties</code> (a log4j config file)</p>
</div>
</div>
<div class="sect3">
<h4 id="_in_datanucleus">15.2.2. In DataNucleus</h4>
<div class="paragraph">
<p>As per the <a href="http://www.datanucleus.org/products/accessplatform/logging.html">DN logging page</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_in_the_jdbc_driver">15.2.3. In the JDBC Driver</h4>
<div class="paragraph">
<p>Configure log4jdbc JDBC rather than the vanilla driver (see <code>WEB-INF/persistor_datanucleus.properties</code>) and configure log4j logging (see <code>WEB-INF/logging.properties</code>).</p>
</div>
<div class="paragraph">
<p>There are examples of both in the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_in_the_database">15.2.4. In the Database</h4>
<div class="sect4">
<h5 id="_hsqldb_logging">HSQLDB Logging</h5>
<div class="paragraph">
<p>Add <code>;sqllog=3</code> to the end of the JDBC URL.</p>
</div>
</div>
<div class="sect4">
<h5 id="_postgresql_logging">PostgreSQL Logging</h5>
<div class="paragraph">
<p>In <code>postgresql\9.2\data\postgresql.conf</code>:</p>
</div>
<div class="paragraph">
<p>Will then log to <code>postgresql\9.2\data\pg_log</code> directory.</p>
</div>
<div class="paragraph">
<p>Note that you must restart the service for this to be picked up.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ms_sql_server_logging">MS SQL Server Logging</h5>
<div class="paragraph">
<p>Use the excellent SQL Profiler tool.</p>
</div>
</div>
</div>
</div>
</div>
</div>
        </div>

        <footer>
          <hr>
          <p class="small">
          Copyright &copy; 2010~2015 The Apache&nbsp;Software&nbsp;Foundation, licensed under the Apache&nbsp;License,&nbsp;v2.0.
          <br/>
          Apache, the Apache feather logo, Apache&nbsp;Isis, and the Apache&nbsp;Isis project logo are all trademarks of The&nbsp;Apache&nbsp;Software&nbsp;Foundation.
          </p>
        </footer>

    </div>

    <div id="doc-content-right" class="large-3 medium-3 xcolumns">
        <div id="toc" class="toc2">
            <div class="fallback-toc">
                <ul class="sectlevel1">
<li><a href="#_users_guide">1. Users' Guide</a></li>
<li><a href="#_ug_core-concepts">2. Core Concepts</a>
<ul class="sectlevel2">
<li><a href="#_ug_core-concepts_philosophy">2.1. Philosophy and Architecture</a>
<ul class="sectlevel3">
<li><a href="#_ug_core-concepts_philosophy_domain-driven-design">2.1.1. Domain-Driven Design</a>
<ul class="sectlevel4">
<li><a href="#_ubiquitous_language">Ubiquitous Language</a></li>
<li><a href="#_model_driven_design">Model-Driven Design</a></li>
</ul>
</li>
<li><a href="#_ug_core-concepts_philosophy_naked-objects-pattern">2.1.2. Naked Objects Pattern</a>
<ul class="sectlevel4">
<li><a href="#_ug_core-concepts_philosophy_naked-objects-pattern_object-interface-mapping">Object Interface Mapping</a></li>
<li><a href="#_what_this_means_in_practice">What this means in practice</a></li>
</ul>
</li>
<li><a href="#_ug_core-concepts_philosophy_hexagonal-architecture">2.1.3. Hexagonal Architecture</a></li>
<li><a href="#_ug_core-concepts_philosophy_aop">2.1.4. Aspect Oriented</a>
<ul class="sectlevel4">
<li><a href="#_aop_concepts">AOP Concepts</a></li>
<li><a href="#_realization_within_apache_isis">Realization within Apache Isis</a></li>
</ul>
</li>
<li><a href="#_ug_core-concepts_philosophy_how-eases-ddd">2.1.5. How Apache Isis eases DDD</a>
<ul class="sectlevel4">
<li><a href="#_ddd_takes_a_conscious_effort">DDD takes a conscious effort</a></li>
<li><a href="#_ddd_must_be_grounded">DDD must be grounded</a></li>
<li><a href="#_abstract_models_are_difficult_to_represent">Abstract models are difficult to represent</a></li>
<li><a href="#_layered_architectures_are_easily_compromised">Layered architectures are easily compromised</a></li>
<li><a href="#_extending_the_reach_of_ddd">Extending the reach of DDD</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_core-concepts_principles">2.2. Principles and Values</a>
<ul class="sectlevel3">
<li><a href="#_ug_core-concepts_principles_your-apps">2.2.1. Your Applications</a>
<ul class="sectlevel4">
<li><a href="#_decoupled">Decoupled</a></li>
<li><a href="#_honouring_the_single_responsibility_principle">Honouring the Single Responsibility Principle</a></li>
<li><a href="#_testable">Testable</a></li>
</ul>
</li>
<li><a href="#_ug_core-concepts_principles_isis-itself">2.2.2. Apache Isis itself</a>
<ul class="sectlevel4">
<li><a href="#_full_stack_but_extensible">Full-stack but Extensible</a></li>
<li><a href="#_focuses_on_its_usp">Focuses on its USP</a></li>
</ul>
</li>
<li><a href="#_ug_core-concepts_principles_apache-isis-vs">2.2.3. Apache Isis vs &#8230;&#8203;</a>
<ul class="sectlevel4">
<li><a href="#_ug_core-concepts_principles_apache-isis-vs_mvc-server-side-frameworks">vs MVC server-side frameworks</a></li>
<li><a href="#_vs_cqrs">vs CQRS</a></li>
<li><a href="#_vs_event_sourcing">vs Event Sourcing</a></li>
<li><a href="#_vs_angular">vs Angular</a></li>
<li><a href="#_ug_core-concepts_principles_apache-isis-vs_metawidget">vs MetaWidget</a></li>
<li><a href="#_vs_openxava">vs OpenXava</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_core-concepts_building-blocks">2.3. Building Blocks</a>
<ul class="sectlevel3">
<li><a href="#_a_metamodel_with_explicit_and_inferred_semantics">2.3.1. A MetaModel with Explicit and Inferred Semantics</a></li>
<li><a href="#_domain_objects_and_domain_services">2.3.2. Domain Objects and Domain Services</a></li>
<li><a href="#_properties_collections_and_actions">2.3.3. Properties, Collections and Actions</a></li>
<li><a href="#_domain_entities_vs_view_models">2.3.4. Domain Entities vs View Models</a></li>
<li><a href="#_domain_services">2.3.5. Domain Services</a>
<ul class="sectlevel4">
<li><a href="#_domain_services_vs_view_services">Domain Services vs View Services</a></li>
</ul>
</li>
<li><a href="#_value_objects_primitives">2.3.6. Value Objects (Primitives)</a></li>
<li><a href="#_contributions">2.3.7. Contributions</a></li>
<li><a href="#_event_bus">2.3.8. Event Bus</a></li>
</ul>
</li>
<li><a href="#_ug_core-concepts_framework-provided-services">2.4. Framework-provided Services</a></li>
<li><a href="#_ug_core-concepts_add-ons">2.5. Isis Add-ons</a></li>
<li><a href="#_ug_core-concepts_other-deployment-options">2.6. Other Deployment Options</a>
<ul class="sectlevel3">
<li><a href="#_deploy_to_production">2.6.1. Deploy to production</a></li>
<li><a href="#_use_for_prototyping">2.6.2. Use for prototyping</a></li>
<li><a href="#_deploy_on_your_own_platform">2.6.3. Deploy on your own platform</a></li>
<li><a href="#_deploy_the_rest_api">2.6.4. Deploy the REST API</a></li>
<li><a href="#_implement_your_own_viewer">2.6.5. Implement your own viewer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_getting-started">3. Getting Started</a>
<ul class="sectlevel2">
<li><a href="#_prerequisites">3.1. Prerequisites</a></li>
<li><a href="#_ug_getting-started_simpleapp-archetype">3.2. SimpleApp Archetype</a>
<ul class="sectlevel3">
<li><a href="#_generating_the_app">3.2.1. Generating the App</a></li>
<li><a href="#_building_the_app">3.2.2. Building the App</a></li>
<li><a href="#_running_the_app">3.2.3. Running the App</a>
<ul class="sectlevel4">
<li><a href="#_self_hosted">Self-hosted</a></li>
<li><a href="#_using_mvn_jetty_plugin">Using mvn Jetty plugin</a></li>
<li><a href="#_using_a_regular_servlet_container">Using a regular servlet container</a></li>
<li><a href="#_from_within_the_ide">From within the IDE</a></li>
</ul>
</li>
<li><a href="#_running_with_fixtures">3.2.4. Running with Fixtures</a></li>
<li><a href="#_using_the_app">3.2.5. Using the App</a></li>
<li><a href="#_modifying_the_app">3.2.6. Modifying the App</a></li>
<li><a href="#_app_structure">3.2.7. App Structure</a></li>
</ul>
</li>
<li><a href="#_ug_getting-started_datanucleus-enhancer">3.3. Datanucleus Enhancer</a>
<ul class="sectlevel3">
<li><a href="#__code_meta_inf_persistence_xml_code">3.3.1. <code>META-INF/persistence.xml</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_tutorials">4. Tutorials</a>
<ul class="sectlevel2">
<li><a href="#_ug_tutorials_pet-clinic">4.1. Pet Clinic</a>
<ul class="sectlevel3">
<li><a href="#_prerequisites_2">4.1.1. Prerequisites</a></li>
<li><a href="#_run_the_archetype">4.1.2. Run the archetype</a></li>
<li><a href="#_build_and_run">4.1.3. Build and run</a></li>
<li><a href="#_using_the_app_2">4.1.4. Using the app</a></li>
<li><a href="#_dev_environment">4.1.5. Dev environment</a></li>
<li><a href="#_explore_codebase">4.1.6. Explore codebase</a></li>
<li><a href="#_testing">4.1.7. Testing</a></li>
<li><a href="#_update_pom_files">4.1.8. Update POM files</a></li>
<li><a href="#_delete_the_bdd_specs">4.1.9. Delete the BDD specs</a></li>
<li><a href="#_rename_artifacts">4.1.10. Rename artifacts</a></li>
<li><a href="#_update_package_names">4.1.11. Update package names</a></li>
<li><a href="#_add_code_petspecies_code_enum">4.1.12. Add <code>PetSpecies</code> enum</a></li>
<li><a href="#_icon_to_reflect_pet_species">4.1.13. Icon to reflect pet species</a></li>
<li><a href="#_add_pet_s_code_owner_code">4.1.14. Add pet&#8217;s <code>Owner</code></a></li>
</ul>
</li>
<li><a href="#_ug_tutorials_stop-scaffolding-start-coding">4.2. Stop scaffolding, start coding</a>
<ul class="sectlevel3">
<li><a href="#_prerequisites_3">4.2.1. Prerequisites</a></li>
<li><a href="#_run_the_archetype_2">4.2.2. Run the archetype</a></li>
<li><a href="#_build_and_run_2">4.2.3. Build and run</a></li>
<li><a href="#_using_the_app_3">4.2.4. Using the app</a></li>
<li><a href="#_dev_environment_2">4.2.5. Dev environment</a></li>
<li><a href="#_explore_codebase_2">4.2.6. Explore codebase</a></li>
<li><a href="#_testing_2">4.2.7. Testing</a></li>
<li><a href="#_prototyping">4.2.8. Prototyping</a></li>
<li><a href="#_build_a_domain_app">4.2.9. Build a domain app</a></li>
<li><a href="#_domain_entity">4.2.10. Domain entity</a></li>
<li><a href="#_domain_service">4.2.11. Domain service</a></li>
<li><a href="#_fixture_scripts">4.2.12. Fixture scripts</a></li>
<li><a href="#_actions">4.2.13. Actions</a></li>
<li><a href="#_rest_api">4.2.14. REST API</a></li>
<li><a href="#_specify_action_semantics">4.2.15. Specify Action semantics</a></li>
<li><a href="#_value_properties">4.2.16. Value properties</a></li>
<li><a href="#_reference_properties">4.2.17. Reference properties</a></li>
<li><a href="#_usability_defaults">4.2.18. Usability: Defaults</a></li>
<li><a href="#_collections">4.2.19. Collections</a></li>
<li><a href="#_actions_and_collections">4.2.20. Actions and Collections</a></li>
<li><a href="#_css_ui_hints">4.2.21. CSS UI Hints</a></li>
<li><a href="#_dynamic_layout">4.2.22. Dynamic Layout</a></li>
<li><a href="#_business_rules">4.2.23. Business rules</a>
<ul class="sectlevel4">
<li><a href="#_see_it">See it!</a></li>
<li><a href="#_use_it">Use it!</a></li>
<li><a href="#_do_it">Do it!</a></li>
</ul>
</li>
<li><a href="#_home_page">4.2.24. Home page</a></li>
<li><a href="#_clock_service">4.2.25. Clock Service</a></li>
<li><a href="#_using_contributions">4.2.26. Using Contributions</a>
<ul class="sectlevel4">
<li><a href="#_contributed_actions">Contributed Actions</a></li>
<li><a href="#_contributed_collections">Contributed Collections</a></li>
<li><a href="#_contributed_properties">Contributed Properties</a></li>
</ul>
</li>
<li><a href="#_using_the_event_bus">4.2.27. Using the Event Bus</a></li>
<li><a href="#_bulk_actions">4.2.28. Bulk actions</a></li>
<li><a href="#_performance_tuning">4.2.29. Performance tuning</a></li>
<li><a href="#_extending_the_wicket_ui">4.2.30. Extending the Wicket UI</a>
<ul class="sectlevel4">
<li><a href="#_excel_download">Excel download</a></li>
<li><a href="#_fullcalendar2">Fullcalendar2</a></li>
<li><a href="#_gmap3">gmap3</a></li>
</ul>
</li>
<li><a href="#_add_on_modules_optional">4.2.31. Add-on modules (optional)</a></li>
<li><a href="#_view_models">4.2.32. View models</a></li>
<li><a href="#_testing_3">4.2.33. Testing</a>
<ul class="sectlevel4">
<li><a href="#_unit_testing">Unit testing</a></li>
<li><a href="#_integration_testing">Integration testing</a></li>
</ul>
</li>
<li><a href="#_customising_the_rest_api">4.2.34. Customising the REST API</a></li>
<li><a href="#_configuring_to_use_an_external_database">4.2.35. Configuring to use an external database</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_how-tos">5. How tos</a>
<ul class="sectlevel2">
<li><a href="#_ug_how-tos_class-structure">5.1. Class Structure</a>
<ul class="sectlevel3">
<li><a href="#_ug_how-tos_class-structure_class-definition">5.1.1. Class Definition</a></li>
<li><a href="#_ug_how-tos_class-structure_properties">5.1.2. Property</a>
<ul class="sectlevel4">
<li><a href="#_value_vs_reference_types">Value vs Reference Types</a></li>
<li><a href="#_optional_properties">Optional Properties</a></li>
<li><a href="#__code_string_code_s_length"><code>String</code>s (Length)</a></li>
<li><a href="#_ug_how-tos_class-structure_properties_mapping-joda-dates">Mapping JODA Dates</a></li>
<li><a href="#__code_bigdecimal_code_s_precision"><code>BigDecimal</code>s (Precision)</a></li>
<li><a href="#_mapping_blobs_and_clobs">Mapping Blobs and Clobs</a></li>
</ul>
</li>
<li><a href="#_ug_how-tos_class-structure_collections">5.1.3. Collections</a></li>
<li><a href="#_ug_how-tos_class-structure_actions">5.1.4. Actions</a></li>
<li><a href="#_ug_how-tos_class-structure_action-parameters">5.1.5. Action Parameters</a>
<ul class="sectlevel4">
<li><a href="#__code_string_code_s_length_2"><code>String</code>s (Length)</a></li>
<li><a href="#__code_bigdecimal_code_s_precision_2"><code>BigDecimal</code>s (Precision)</a></li>
<li><a href="#_optional">Optional</a></li>
</ul>
</li>
<li><a href="#_ug_how-tos_class-structure_inject-services">5.1.6. Injecting services</a>
<ul class="sectlevel4">
<li><a href="#_field_injection">Field Injection</a></li>
<li><a href="#_method_injection">Method Injection</a></li>
<li><a href="#_constructor_injection">Constructor injection</a></li>
</ul>
</li>
<li><a href="#_ug_how-tos_class-structure_properties-vs-parameters">5.1.7. Properties vs Parameters</a></li>
<li><a href="#_ug_how-tos_class-structure_ignoring-methods">5.1.8. Ignoring Methods</a></li>
</ul>
</li>
<li><a href="#_ug_how-tos_ui-hints">5.2. UI Hints</a>
<ul class="sectlevel3">
<li><a href="#_ug_how-tos_ui-hints_object-titles-and-icons">5.2.1. Object Titles and Icons</a>
<ul class="sectlevel4">
<li><a href="#_object_title">Object Title</a></li>
<li><a href="#_object_icon">Object Icon</a></li>
<li><a href="#_object_css_styling">Object CSS Styling</a></li>
</ul>
</li>
<li><a href="#_ug_how-tos_ui-hints_names-and-descriptions">5.2.2. Names and Descriptions</a>
<ul class="sectlevel4">
<li><a href="#_class_object">Class (object)</a></li>
<li><a href="#_property">Property</a></li>
<li><a href="#_collections_2">Collections</a></li>
<li><a href="#_actions_2">Actions</a></li>
<li><a href="#_action_parameters">Action Parameters</a></li>
</ul>
</li>
<li><a href="#_ug_how-tos_ui-hints_layout">5.2.3. Layout</a></li>
<li><a href="#_ug_how-tos_ui-hints_eager-rendering">5.2.4. Eager rendering</a></li>
<li><a href="#_ug_how-tos_ui-hints_action-icons-and-css">5.2.5. Action Icons and CSS</a>
<ul class="sectlevel4">
<li><a href="#_per_action">Per action</a></li>
<li><a href="#_per_pattern_matching">Per pattern matching</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_how-tos_domain-services">5.3. Domain Services</a>
<ul class="sectlevel3">
<li><a href="#_scoped_services">5.3.1. Scoped services</a></li>
<li><a href="#_registering_domain_services">5.3.2. Registering domain services</a></li>
<li><a href="#_contributions_2">5.3.3. Contributions</a></li>
<li><a href="#_menu_items">5.3.4. Menu items</a></li>
<li><a href="#_menus">5.3.5. Menus</a></li>
<li><a href="#_initialization">5.3.6. Initialization</a></li>
<li><a href="#_the_getid_method">5.3.7. The getId() method</a></li>
</ul>
</li>
<li><a href="#_ug_how-tos_crud">5.4. Object Management (CRUD)</a>
<ul class="sectlevel3">
<li><a href="#_instantiating_and_persisting_objects">5.4.1. Instantiating and Persisting Objects</a></li>
<li><a href="#_finding_objects">5.4.2. Finding Objects</a>
<ul class="sectlevel4">
<li><a href="#_using_datanucleus_type_safe_queries">Using DataNucleus type-safe queries</a></li>
</ul>
</li>
<li><a href="#_deleting_objects">5.4.3. Deleting Objects</a></li>
</ul>
</li>
<li><a href="#_ug_how-tos_entity-relationships">5.5. Entity Relationships</a>
<ul class="sectlevel3">
<li><a href="#_mandatory_and_optional">5.5.1. Mandatory and Optional</a></li>
<li><a href="#_ug_how-tos_entity-relationships_managed-1-to-m-bidirectional-relationships">5.5.2. 1-m bidir relationships</a></li>
</ul>
</li>
<li><a href="#_ug_how-tos_contributed-members">5.6. Contributed Members</a>
<ul class="sectlevel3">
<li><a href="#_contributed_action">5.6.1. Contributed Action</a></li>
<li><a href="#_contributed_property">5.6.2. Contributed Property</a></li>
<li><a href="#_contributed_collection">5.6.3. Contributed Collection</a></li>
</ul>
</li>
<li><a href="#_ug_how-tos_business-rules">5.7. Business Rules</a>
<ul class="sectlevel3">
<li><a href="#_visibility_see_it">5.7.1. Visibility ("see it")</a>
<ul class="sectlevel4">
<li><a href="#_hide_a_property">Hide a Property</a></li>
<li><a href="#_hide_a_collection">Hide a Collection</a></li>
<li><a href="#_hide_an_action">Hide an Action</a></li>
<li><a href="#_hide_a_contributed_property_collection_or_action">Hide a Contributed Property, Collection or Action</a></li>
<li><a href="#_all_members_hidden">All Members Hidden</a></li>
</ul>
</li>
<li><a href="#_usability_use_it">5.7.2. Usability ("use it")</a>
<ul class="sectlevel4">
<li><a href="#_disable_a_property">Disable a Property</a></li>
<li><a href="#_disable_a_collection">Disable a Collection</a></li>
<li><a href="#_disable_an_action">Disable an Action</a></li>
<li><a href="#_disable_a_contributed_property_collection_or_action">Disable a Contributed Property, Collection or Action</a></li>
<li><a href="#_all_members_unmodifiable_disabling_the_edit_button">All Members Unmodifiable (Disabling the Edit Button)</a></li>
</ul>
</li>
<li><a href="#_validity_do_it">5.7.3. Validity ("do it")</a>
<ul class="sectlevel4">
<li><a href="#_validate_change_to_a_property">Validate (change to) a Property</a></li>
<li><a href="#_validate_adding_or_removing_from_a_collection">Validate (adding or removing from) a Collection</a></li>
<li><a href="#_validate_arguments_to_invoke_an_action">Validate (arguments to invoke) an Action</a></li>
<li><a href="#_validating_a_contributed_property_collection_or_action">Validating a Contributed Property, Collection or Action</a></li>
<li><a href="#_declarative_validation">Declarative validation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_how-tos_derived-members">5.8. Derived Members</a>
<ul class="sectlevel3">
<li><a href="#_derived_property">5.8.1. Derived Property</a></li>
<li><a href="#_derived_collection">5.8.2. Derived Collection</a></li>
<li><a href="#_trigger_on_property_change">5.8.3. Trigger on property change</a></li>
<li><a href="#_trigger_on_collection_change">5.8.4. Trigger on collection change</a></li>
</ul>
</li>
<li><a href="#_ug_how-tos_drop-downs-and-defaults">5.9. Drop Downs and Defaults</a>
<ul class="sectlevel3">
<li><a href="#_for_properties">5.9.1. For Properties</a>
<ul class="sectlevel4">
<li><a href="#_choices_for_property">Choices for Property</a></li>
<li><a href="#_auto_complete_for_property">Auto-complete for property</a></li>
<li><a href="#_default_for_property">Default for property</a></li>
</ul>
</li>
<li><a href="#_for_action_parameters">5.9.2. For Action Parameters</a>
<ul class="sectlevel4">
<li><a href="#_choices_for_action_parameter">Choices for action parameter</a></li>
<li><a href="#_dependent_choices_for_action_params">Dependent choices for action params</a></li>
<li><a href="#_auto_complete_for_action_param">Auto-complete for action param</a></li>
<li><a href="#_default_for_action_param">Default for action param</a></li>
</ul>
</li>
<li><a href="#_for_both_properties_and_action_parameters">5.9.3. For both Properties and Action Parameters</a>
<ul class="sectlevel4">
<li><a href="#_drop_down_for_limited_number_of_instances">Drop-down for limited number of instances</a></li>
<li><a href="#_auto_complete_repository_based">Auto-complete (repository-based)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_how-tos_persisted-title">5.10. Persisted Title</a></li>
</ul>
</li>
<li><a href="#_ug_more-advanced">6. More Advanced Techniques</a>
<ul class="sectlevel2">
<li><a href="#_ug_more-advanced_decoupling">6.1. Decoupling</a>
<ul class="sectlevel3">
<li><a href="#_ug_more-advanced_decoupling_db-schemas">6.1.1. Database Schemas</a>
<ul class="sectlevel4">
<li><a href="#_listener_to_create_schema">Listener to create schema</a></li>
<li><a href="#_alternative_implementation">Alternative implementation</a></li>
</ul>
</li>
<li><a href="#_ug_more-advanced_decoupling_contributions">6.1.2. Contributions</a></li>
<li><a href="#_ug_more-advanced_decoupling_vetoing-visibility">6.1.3. Vetoing Visibility</a></li>
<li><a href="#_ug_more-advanced_decoupling_event-bus">6.1.4. Event Bus</a></li>
<li><a href="#_ug_more-advanced_decoupling_pushing-changes">6.1.5. Pushing Changes</a>
<ul class="sectlevel4">
<li><a href="#_when_a_property_is_changed">When a property is changed</a></li>
<li><a href="#_when_a_collection_is_modified">When a collection is modified</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_more-advanced_overriding-jdo-annotations">6.2. Overriding JDO Annotations</a></li>
<li><a href="#_ug_more-advanced_bulk-actions">6.3. Bulk Actions</a></li>
<li><a href="#_ug_more-advanced_view-models">6.4. View Models</a></li>
<li><a href="#_ug_more-advanced_mapping-rdbms-views">6.5. Mapping RDBMS Views</a></li>
<li><a href="#_ug_more-advanced_transactions-and-errors">6.6. Transactions and Errors</a>
<ul class="sectlevel3">
<li><a href="#_aborting_transactions">6.6.1. Aborting Transactions</a></li>
<li><a href="#_raise_message_errors_to_users">6.6.2. Raise message/errors to users</a></li>
<li><a href="#_exception_recognizers">6.6.3. Exception Recognizers</a></li>
</ul>
</li>
<li><a href="#_ug_more-advanced_i18n">6.7. i18n</a>
<ul class="sectlevel3">
<li><a href="#_implementation_approach">6.7.1. Implementation Approach</a></li>
<li><a href="#__code_translationservice_code">6.7.2. <code>TranslationService</code></a>
<ul class="sectlevel4">
<li><a href="#__code_translationservicepo_code"><code>TranslationServicePo</code></a></li>
</ul>
</li>
<li><a href="#_imperative_messages">6.7.3. Imperative messages</a>
<ul class="sectlevel4">
<li><a href="#__code_translatablestring_code"><code>TranslatableString</code></a></li>
<li><a href="#__code_translatableexception_code"><code>TranslatableException</code></a></li>
</ul>
</li>
<li><a href="#_integration_testing_2">6.7.4. Integration Testing</a></li>
<li><a href="#_configuration">6.7.5. Configuration</a>
<ul class="sectlevel4">
<li><a href="#_logging">Logging</a></li>
<li><a href="#_location_of_the_code_po_code_files">Location of the <code>.po</code> files</a></li>
<li><a href="#_externalized_translation_files">Externalized translation files</a></li>
<li><a href="#_force_read_mode">Force read mode</a></li>
</ul>
</li>
<li><a href="#_supporting_services">6.7.6. Supporting services</a>
<ul class="sectlevel4">
<li><a href="#__code_localeprovider_code"><code>LocaleProvider</code></a></li>
<li><a href="#__code_translationsresolver_code"><code>TranslationsResolver</code></a></li>
<li><a href="#__code_translationservicepomenu_code"><code>TranslationServicePoMenu</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_more-advanced_multi-tenancy">6.8. Multi-tenancy</a></li>
<li><a href="#_ug_more-advanced_persistence-lifecycle">6.9. Persistence Lifecycle</a></li>
<li><a href="#_ug_more-advanced_tips-n-tricks">6.10. Tips n Tricks</a>
<ul class="sectlevel3">
<li><a href="#_ug_more-advanced_tips-n-tricks_are-you-sure">6.10.1. 'Are you sure?' idiom</a>
<ul class="sectlevel4">
<li><a href="#_screenshots">Screenshots</a></li>
<li><a href="#_code_example">Code example</a></li>
</ul>
</li>
<li><a href="#_ug_more-advanced_tips-n-tricks_simulating-collections-of-values">6.10.2. Collections of values</a>
<ul class="sectlevel4">
<li><a href="#_view_model">View Model</a></li>
<li><a href="#_persistence_concerns">Persistence Concerns</a></li>
</ul>
</li>
<li><a href="#_ug_more-advanced_tips-n-tricks_render-all-properties-in-tables">6.10.3. Subclass properties in tables</a></li>
<li><a href="#_ug_more-advanced_tips-n-tricks_per-user-themes">6.10.4. Per-user Themes</a></li>
<li><a href="#_ug_more-advanced_tips-n-tricks_enhance-only">6.10.5. Enhance only (IntelliJ)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_wicket-viewer">7. Wicket Viewer</a>
<ul class="sectlevel2">
<li><a href="#_ug_wicket-viewer_features">7.1. Features/end-user usage</a>
<ul class="sectlevel3">
<li><a href="#_ug_wicket-viewer_features_recent-pages">7.1.1. Recent pages (drop down)</a>
<ul class="sectlevel4">
<li><a href="#_screenshots_2">Screenshots</a></li>
<li><a href="#_domain_code">Domain Code</a></li>
<li><a href="#_user_experience">User Experience</a></li>
<li><a href="#_related_functionality">Related functionality</a></li>
<li><a href="#_configuration_2">Configuration</a></li>
</ul>
</li>
<li><a href="#_ug_wicket-viewer_features_bookmarked-pages">7.1.2. Bookmarked pages</a>
<ul class="sectlevel4">
<li><a href="#_screenshots_3">Screenshots</a></li>
<li><a href="#_domain_code_2">Domain Code</a></li>
<li><a href="#_user_experience_2">User Experience</a></li>
<li><a href="#_configuration_3">Configuration</a></li>
</ul>
</li>
<li><a href="#_ug_wicket-viewer_features_hints-and-copy-url">7.1.3. Hints and copy URL</a>
<ul class="sectlevel4">
<li><a href="#_screenshots_4">Screenshots</a></li>
<li><a href="#_user_experience_3">User Experience</a></li>
</ul>
</li>
<li><a href="#_ug_wicket-viewer_features_titles-in-tables">7.1.4. Titles in Tables</a></li>
<li><a href="#_ug_wicket-viewer_features_blob-attachments">7.1.5. File upload/download</a>
<ul class="sectlevel4">
<li><a href="#_screenshots_5">Screenshots</a></li>
<li><a href="#_domain_code_3">Domain Code</a></li>
</ul>
</li>
<li><a href="#_ug_wicket-viewer_features_user-registration">7.1.6. User Registration</a>
<ul class="sectlevel4">
<li><a href="#_screenshots_6">Screenshots</a></li>
<li><a href="#_configuration_4">Configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_wicket-viewer_configuration-properties">7.2. Configuration Properties</a>
<ul class="sectlevel3">
<li><a href="#_ug_wicket-viewer_configuration-properties_abbreviating-titles">7.2.1. Abbreviating/suppressing titles in tables</a></li>
<li><a href="#_ug_wicket-viewer_configuration-properties_suppressing-remember-me">7.2.2. Suppressing 'remember me'</a>
<ul class="sectlevel4">
<li><a href="#_screenshots_7">Screenshots</a></li>
<li><a href="#_configuration_5">Configuration</a></li>
</ul>
</li>
<li><a href="#_ug_wicket-viewer_configuration-properties_suppressing-sign-up">7.2.3. Suppressing 'sign up'</a>
<ul class="sectlevel4">
<li><a href="#_screenshots_8">Screenshots</a></li>
<li><a href="#_configuration_6">Configuration</a></li>
<li><a href="#_see_also">See also</a></li>
</ul>
</li>
<li><a href="#_ug_wicket-viewer_configuration-properties_suppressing-password-reset">7.2.4. Suppressing 'password reset'</a>
<ul class="sectlevel4">
<li><a href="#_screenshots_9">Screenshots</a></li>
<li><a href="#_configuration_7">Configuration</a></li>
<li><a href="#_see_also_2">See also</a></li>
</ul>
</li>
<li><a href="#_ug_wicket-viewer_configuration-properties_stripped-wicket-tags">7.2.5. Stripped Wicket tags</a></li>
<li><a href="#_ug_wicket-viewer_configuration-properties_showing-theme-chooser">7.2.6. Showing a theme chooser</a></li>
</ul>
</li>
<li><a href="#_ug_wicket-viewer_request-parameters">7.3. Request Parameters</a>
<ul class="sectlevel3">
<li><a href="#_suppressing_header_and_footer_embedded_view">7.3.1. Suppressing Header and Footer (Embedded View)</a>
<ul class="sectlevel4">
<li><a href="#_screenshots_10">Screenshots</a></li>
<li><a href="#_request_parameters">Request parameters</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_wicket-viewer_layout">7.4. Layout</a>
<ul class="sectlevel3">
<li><a href="#_screencast">7.4.1. Screencast</a></li>
<li><a href="#_required_updates_to_the_dom_project_s_pom_xml">7.4.2. Required updates to the dom project&#8217;s pom.xml</a></li>
</ul>
</li>
<li><a href="#_ug_wicket-viewer_customisation">7.5. Customisation</a>
<ul class="sectlevel3">
<li><a href="#_ug_wicket-viewer_customisation_brand-logo">7.5.1. Brand logo</a>
<ul class="sectlevel4">
<li><a href="#_screenshots_11">Screenshots</a></li>
<li><a href="#_configuration_8">Configuration</a></li>
</ul>
</li>
<li><a href="#_ug_wicket-viewer_customisation_default-theme">7.5.2. Specifying a default theme</a></li>
<li><a href="#_ug_wicket-viewer_customisation_welcome-page">7.5.3. Welcome page</a></li>
<li><a href="#_ug_wicket-viewer_customisation_about-page">7.5.4. About page</a>
<ul class="sectlevel4">
<li><a href="#_screenshot">Screenshot</a></li>
<li><a href="#_configuration_9">Configuration</a></li>
</ul>
</li>
<li><a href="#_ug_wicket-viewer_customisation_tweaking-css-classes">7.5.5. Tweaking CSS classes</a>
<ul class="sectlevel4">
<li><a href="#_targeting_individual_members">Targeting individual members</a></li>
<li><a href="#_targeting_members_through_a_custom_css_style">Targeting members through a custom CSS style</a></li>
</ul>
</li>
<li><a href="#_ug_wicket-viewer_customisation_tweaking-css-classes">7.5.6. Tweaking CSS classes</a>
<ul class="sectlevel4">
<li><a href="#_targeting_individual_members_2">Targeting individual members</a></li>
<li><a href="#_targeting_members_through_a_custom_css_style_2">Targeting members through a custom CSS style</a></li>
</ul>
</li>
<li><a href="#_ug_wicket-viewer_customisation_using-different-css-file">7.5.7. Using a different CSS file</a></li>
<li><a href="#_ug_wicket-viewer_customisation_custom-javascript">7.5.8. Custom Javascript</a></li>
<li><a href="#_ug_wicket-viewer_customisation_auto-refresh">7.5.9. Auto-refresh page</a></li>
</ul>
</li>
<li><a href="#_extending_the_viewer">7.6. Extending the viewer</a></li>
<li><a href="#_ug_wicket-viewer_isis-addons">7.7. Isis Add-ons (not ASF)</a>
<ul class="sectlevel3">
<li><a href="#_excel_download_2">7.7.1. Excel download</a></li>
<li><a href="#_fullcalendar2_2">7.7.2. Fullcalendar2</a></li>
<li><a href="#_gmap3_2">7.7.3. Gmap3</a></li>
<li><a href="#_wicked_charts">7.7.4. Wicked charts</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_restfulobjects-viewer">8. Restful Objects Viewer</a>
<ul class="sectlevel2">
<li><a href="#_ug_restfulobjects-viewer_features">8.1. Features</a>
<ul class="sectlevel3">
<li><a href="#_restful_objects_specification">8.1.1. Restful Objects Specification</a></li>
<li><a href="#_pretty_printing">8.1.2. Pretty printing</a></li>
</ul>
</li>
<li><a href="#_ug_restfulobjects-viewer_configuration-properties">8.2. Configuration Properties</a>
<ul class="sectlevel3">
<li><a href="#_ug_restfulobjects-viewer_configuration-properties_honor-ui-hints">8.2.1. Honor UI hints</a></li>
<li><a href="#_ug_restfulobjects-viewer_configuration-properties_suppressing-elements">8.2.2. Suppressing elements of the representation</a></li>
<li><a href="#_ug_restfulobjects-viewer_configuration-properties_simplified-object-representation">8.2.3. Simplified object representation</a></li>
</ul>
</li>
<li><a href="#_ug_restfulobjects-viewer_hints-and-tips">8.3. Hints and Tips</a>
<ul class="sectlevel3">
<li><a href="#_using_chrome_tools">8.3.1. Using Chrome Tools</a></li>
<li><a href="#_angularjs_tips">8.3.2. AngularJS Tips</a>
<ul class="sectlevel4">
<li><a href="#_invoking_a_get_link_eg_invoking_a_query_action">Invoking a GET link (eg invoking a query action)</a></li>
<li><a href="#_invoking_a_put_or_post_link">Invoking a PUT or POST link</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_extending_the_viewer_2">8.4. Extending the viewer</a></li>
</ul>
</li>
<li><a href="#_ug_security">9. Security</a>
<ul class="sectlevel2">
<li><a href="#_ug_security_configuring-isis-to-use-shiro">9.1. Configuring Apache Isis to use Shiro</a>
<ul class="sectlevel3">
<li><a href="#_telling_apache_isis_to_use_shiro">9.1.1. Telling Apache Isis to use Shiro</a></li>
<li><a href="#_bootstrapping_shiro">9.1.2. Bootstrapping Shiro</a></li>
<li><a href="#__code_web_inf_shiro_ini_code">9.1.3. <code>WEB-INF/shiro.ini</code></a></li>
</ul>
</li>
<li><a href="#_ug_security_shiro-ini-realm">9.2. Shiro Ini Realm</a>
<ul class="sectlevel3">
<li><a href="#_shiro_configuration">9.2.1. Shiro Configuration</a>
<ul class="sectlevel4">
<li><a href="#__code_users_code_section"><code>[users]</code> section</a></li>
<li><a href="#__code_roles_code_section"><code>[roles]</code> section</a></li>
</ul>
</li>
<li><a href="#_externalized_inirealm">9.2.2. Externalized IniRealm</a></li>
</ul>
</li>
<li><a href="#_ug_security_shiro-isis-ldap-realm">9.3. Isis Ldap Realm</a>
<ul class="sectlevel3">
<li><a href="#_shiro_configuration_2">9.3.1. Shiro Configuration</a></li>
<li><a href="#_externalizing_role_perms">9.3.2. Externalizing role perms</a></li>
<li><a href="#_active_ds_ldap_tutorial">9.3.3. Active DS LDAP tutorial</a></li>
</ul>
</li>
<li><a href="#_ug_security_shiro-isisaddons-security-module-realm">9.4. Security Module Realm</a></li>
<li><a href="#_ug_security_shiro-jdbc-realm">9.5. Shiro JDBC Realm</a></li>
<li><a href="#_ug_security_shiro-isis-enhanced-wildcard-permission">9.6. Enhanced Wildcard Permission</a></li>
<li><a href="#_ug_security_configuring-isis-to-use-bypass">9.7. Bypassing security</a></li>
<li><a href="#_ug_security_api-for-applications">9.8. API for Applications</a>
<ul class="sectlevel3">
<li><a href="#__code_domainobjectcontainer_code_api">9.8.1. <code>DomainObjectContainer</code> API</a></li>
<li><a href="#_servlet_api">9.8.2. Servlet API</a></li>
</ul>
</li>
<li><a href="#_ug_security_usage-by-isis-viewers">9.9. Usage by Apache Isis' Viewers</a>
<ul class="sectlevel3">
<li><a href="#_wicket_viewer">9.9.1. Wicket Viewer</a>
<ul class="sectlevel4">
<li><a href="#_user_registration">User-registration</a></li>
</ul>
</li>
<li><a href="#_restful_objects_viewer">9.9.2. Restful Objects Viewer</a>
<ul class="sectlevel4">
<li><a href="#_user_registration_2">User-registration</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_isis-maven-plugin">10. Apache Isis Maven Plugin</a></li>
<li><a href="#_ug_deployment">11. Deployment</a>
<ul class="sectlevel2">
<li><a href="#_ug_deployment_cmd-line">11.1. Command Line</a>
<ul class="sectlevel3">
<li><a href="#__code_webserver_code_class">11.1.1. <code>WebServer</code> class</a></li>
<li><a href="#__code_dummy_code_class">11.1.2. <code>Dummy</code> class</a></li>
</ul>
</li>
<li><a href="#_ug_deployment_tomcat">11.2. Deploying to Tomcat</a>
<ul class="sectlevel3">
<li><a href="#_externalized_configuration">11.2.1. Externalized Configuration</a></li>
<li><a href="#_jvm_args">11.2.2. JVM Args</a></li>
<li><a href="#_using_a_jndi_datasource">11.2.3. Using a JNDI Datasource</a></li>
</ul>
</li>
<li><a href="#_ug_deployment_externalized-configuration">11.3. Externalized Configuration</a>
<ul class="sectlevel3">
<li><a href="#_ug_deployment_externalized-configuration_Isis">11.3.1. Apache Isis' Config</a></li>
<li><a href="#_ug_deployment_externalized-configuration_Shiro">11.3.2. Shiro Config</a></li>
<li><a href="#_ug_deployment_externalized-configuration_Log4j">11.3.3. Log4j Config</a></li>
<li><a href="#_spring_config">11.3.4. Spring Config</a>
<ul class="sectlevel4">
<li><a href="#_an_alternative_approach">An alternative approach</a></li>
</ul>
</li>
<li><a href="#_see_also_3">11.3.5. See also</a></li>
</ul>
</li>
<li><a href="#_ug_deployment_gae">11.4. Deploying to Google App Engine</a>
<ul class="sectlevel3">
<li><a href="#_primary_keys_and_owned_unowned_relationships">11.4.1. Primary Keys and Owned/Unowned Relationships</a></li>
<li><a href="#_custom_types">11.4.2. Custom Types</a></li>
</ul>
</li>
<li><a href="#_ug_deployment_neo4j">11.5. Neo4J</a>
<ul class="sectlevel3">
<li><a href="#_connectionurl">11.5.1. ConnectionURL</a></li>
<li><a href="#_update_pom_xml">11.5.2. Update pom.xml</a></li>
<li><a href="#_try_it_out">11.5.3. Try it out!</a></li>
</ul>
</li>
<li><a href="#_ug_deployment_jvm-flags">11.6. JVM Flags</a>
<ul class="sectlevel3">
<li><a href="#_configuring_in_tomcat">11.6.1. Configuring in Tomcat</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_testing">12. Testing</a>
<ul class="sectlevel2">
<li><a href="#_ug_testing_aaa">12.1. Overview</a>
<ul class="sectlevel3">
<li><a href="#_unit_tests_vs_integ_tests">12.1.1. Unit tests vs Integ tests</a></li>
<li><a href="#_integ_tests_vs_bdd_specs">12.1.2. Integ tests vs BDD Specs</a></li>
<li><a href="#_simulated_ui_code_wrapperfactory_code">12.1.3. Simulated UI (<code>WrapperFactory</code>)</a></li>
<li><a href="#_dependency_injection">12.1.4. Dependency Injection</a></li>
<li><a href="#_given_when_then">12.1.5. Given/When/Then</a></li>
<li><a href="#_fixture_management">12.1.6. Fixture Management</a></li>
<li><a href="#_fake_data">12.1.7. Fake data</a></li>
<li><a href="#_feature_toggles">12.1.8. Feature Toggles</a></li>
</ul>
</li>
<li><a href="#_ug_testing_unit-test-support">12.2. Unit Test Support</a>
<ul class="sectlevel3">
<li><a href="#_ug_testing_unit-test-support_contract-tests">12.2.1. Contract Tests</a>
<ul class="sectlevel4">
<li><a href="#__code_sortedset_code_s_contract_test"><code>SortedSet</code>s Contract Test</a></li>
<li><a href="#_bidirectional_contract_test">Bidirectional Contract Test</a></li>
<li><a href="#_injected_services_method_contract_test">Injected Services Method Contract Test</a></li>
<li><a href="#_value_objects_contract_test">Value Objects Contract Test</a></li>
</ul>
</li>
<li><a href="#_ug_testing_unit-test-support_jmock-extensions">12.2.2. JMock Extensions</a></li>
<li><a href="#_ug_testing_unit-test-support_soap-fake-server-junit-rule">12.2.3. SOAP Fake Endpoints</a>
<ul class="sectlevel4">
<li><a href="#__code_soapendpointpublishingrule_code"><code>SoapEndpointPublishingRule</code></a></li>
<li><a href="#_xml_marshalling_support">XML Marshalling Support</a></li>
</ul>
</li>
<li><a href="#_ug_testing_unit-test-support_maven-configuration">12.2.4. Maven Configuration</a></li>
</ul>
</li>
<li><a href="#_ug_testing_integ-test-support">12.3. Integration Test Support</a>
<ul class="sectlevel3">
<li><a href="#_ug_testing_integ-test-support_typical-usage">12.3.1. Typical Usage</a></li>
<li><a href="#_ug_testing_integ-test-support_bootstrapping">12.3.2. Bootstrapping</a>
<ul class="sectlevel4">
<li><a href="#_builder">Builder</a></li>
<li><a href="#_system_initializer">System Initializer</a></li>
<li><a href="#_abstract_class">Abstract Class</a></li>
</ul>
</li>
<li><a href="#_ug_testing_integ-test-support_wrapper-factory">12.3.3. Wrapper Factory</a>
<ul class="sectlevel4">
<li><a href="#_wrapping_and_unwrapping">Wrapping and Unwrapping</a></li>
<li><a href="#_using_the_wrapper">Using the wrapper</a></li>
<li><a href="#_firing_domain_events">Firing Domain Events</a></li>
</ul>
</li>
<li><a href="#_ug_testing_integ-test-support_maven-configuration">12.3.4. Maven Configuration</a></li>
</ul>
</li>
<li><a href="#_ug_testing_bdd-spec-support">12.4. BDD Spec Support</a>
<ul class="sectlevel3">
<li><a href="#_ug_testing_bdd-spec-support_how-it-works">12.4.1. How it works</a></li>
<li><a href="#_ug_testing_bdd-spec-support_key-classes">12.4.2. Key classes</a>
<ul class="sectlevel4">
<li><a href="#__code_isissystemfortest_code"><code>IsisSystemForTest</code></a></li>
<li><a href="#__code_scenarioexecution_code"><code>ScenarioExecution</code></a></li>
<li><a href="#__code_wrapperfactory_code"><code>WrapperFactory</code></a></li>
<li><a href="#__code_cukeglueabstract_code"><code>CukeGlueAbstract</code></a></li>
</ul>
</li>
<li><a href="#_ug_testing_bdd-spec-support_writing-a-bdd-spec">12.4.3. Writing a BDD spec</a></li>
<li><a href="#_ug_testing_bdd-spec-support_bdd-tooling">12.4.4. BDD Tooling</a></li>
<li><a href="#_ug_testing_bdd-spec-support_maven-configuration">12.4.5. Maven Configuration</a></li>
</ul>
</li>
<li><a href="#_ug_testing_fixture-scripts">12.5. Fixture Scripts</a>
<ul class="sectlevel3">
<li><a href="#_ug_testing_fixture-scripts_api-and-usage">12.5.1. API and Usage</a>
<ul class="sectlevel4">
<li><a href="#__code_fixturescripts_code"><code>FixtureScripts</code></a></li>
<li><a href="#__code_fixturescript_code"><code>FixtureScript</code></a></li>
<li><a href="#_using_within_tests">Using within Tests</a></li>
<li><a href="#_ug_testing_fixture-scripts_api-and-usage_organizing">Organizing Fixture scripts</a></li>
</ul>
</li>
<li><a href="#_ug_testing_fixture-scripts_sudo-service">12.5.2. <code>SudoService</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_headless-access">13. Headless access</a>
<ul class="sectlevel2">
<li><a href="#_ug_headless-access_AbstractIsisSessionTemplate">13.1. AbstractIsisSessionTemplate</a></li>
<li><a href="#_ug_headless-access_BackgroundCommandExecution">13.2. BackgroundCommandExecution</a>
<ul class="sectlevel3">
<li><a href="#_background_execution">13.2.1. Background Execution</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_extending">14. Extending</a>
<ul class="sectlevel2">
<li><a href="#_ug_extending_programming-model">14.1. Programming Model</a>
<ul class="sectlevel3">
<li><a href="#_ug_extending_programming-model_custom-validator">14.1.1. Custom validator</a>
<ul class="sectlevel4">
<li><a href="#_api_and_implementation">API and Implementation</a></li>
<li><a href="#_configuration_10">Configuration</a></li>
</ul>
</li>
<li><a href="#_ug_extending_programming-model_finetuning">14.1.2. Finetuning</a>
<ul class="sectlevel4">
<li><a href="#_modifying_the_prog_model">Modifying the Prog. Model</a></li>
<li><a href="#_replacing_the_prog_model">Replacing the Prog. Model</a></li>
</ul>
</li>
<li><a href="#_ug_extending_programming-model_layout-metadata-reader">14.1.3. Layout Metadata Reader</a>
<ul class="sectlevel4">
<li><a href="#_api_and_implementation_2">API and Implementation</a></li>
<li><a href="#_configuration_11">Configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_extending_wicket-viewer">14.2. Wicket viewer</a>
<ul class="sectlevel3">
<li><a href="#_ug_extending_wicket-viewer_custom-bootstrap-theme">14.2.1. Custom Bootstrap theme</a></li>
<li><a href="#_ug_extending_wicket-viewer_replacing-page-elements">14.2.2. Replacing page elements</a>
<ul class="sectlevel4">
<li><a href="#_how_the_viewer_selects_components">How the viewer selects components</a></li>
<li><a href="#_how_to_replace_a_component">How to replace a component</a></li>
<li><a href="#_ug_extending_wicket-viewer_replacing-page-elements_collections">Additional Views of Collections</a></li>
<li><a href="#_custom_object_view_eg_dashboard">Custom object view (eg dashboard)</a></li>
</ul>
</li>
<li><a href="#_ug_extending_wicket-viewer_custom-pages">14.2.3. Custom pages</a></li>
<li><a href="#_ug_extending_wicket-viewer_isis-addons-extensions">14.2.4. Isis Addons Extensions</a></li>
</ul>
</li>
<li><a href="#_ug_extending_restfulobjects-viewer">14.3. Restful Objects viewer</a></li>
</ul>
</li>
<li><a href="#_ug_troubleshooting">15. Troubleshooting</a>
<ul class="sectlevel2">
<li><a href="#_logging_2">15.1. Logging</a></li>
<li><a href="#_ug_troubleshooting_enabling-logging">15.2. Enabling Logging</a>
<ul class="sectlevel3">
<li><a href="#_in_apache_isis">15.2.1. In Apache Isis</a></li>
<li><a href="#_in_datanucleus">15.2.2. In DataNucleus</a></li>
<li><a href="#_in_the_jdbc_driver">15.2.3. In the JDBC Driver</a></li>
<li><a href="#_in_the_database">15.2.4. In the Database</a>
<ul class="sectlevel4">
<li><a href="#_hsqldb_logging">HSQLDB Logging</a></li>
<li><a href="#_postgresql_logging">PostgreSQL Logging</a></li>
<li><a href="#_ms_sql_server_logging">MS SQL Server Logging</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
            </div>
        </div>
    </div>

</div>


<script src="../js/foundation/5.5.1/vendor/jquery.js"></script>
<script src="../js/foundation/5.5.1/foundation.min.js"></script>


<link href="../css/jquery.tocify/1.9.0/jquery.tocify.css" rel="stylesheet">
<script src="../js/jqueryui/1.11.4/jquery-ui.min.js"></script>
<script src="../js/jquery.tocify/1.9.0/jquery.tocify.js"></script>



<script type="text/javascript">
    $(function () {
        $("#toc").tocify({
            scrollTo: 50,
            extendPage: true,
            context: "#doc-content",
            highlightOnScroll: true,
            hashGenerator: "pretty",
            hideEffect: "slideUp",
            selectors: "h2,h3,h4,h5"
        });
        $(".fallback-toc").hide();
    });
</script>

<script type="text/javascript">

  /****

      $(document).foundation();

      $(document).ready(function(){
        // Cache selectors
        var lastId,
            topMenu = $("div#toc ul"),
            topMenuHeight = 100,

            menuItems = topMenu.find("a"),
            menuItemsHrefs = menuItems.map(function(){
              var item = $($(this).attr("href"));
              if (item.length) { return item; }
            });

        // Bind click handler to menu items to scroll animation
        menuItems.click(function(e){
          var href = $(this).attr("href"),
              offsetTop = href === "#" ? 0 : $(href).offset().top-topMenuHeight+1;
          $('html, body').stop().animate({
              scrollTop: offsetTop
          }, 300);

          e.preventDefault();
        });

        // Bind to scroll of window
        $(  window ).scroll(function(){

           // Get container scroll position
           var fromTop = $(this).scrollTop()+topMenuHeight;

           var cur = menuItemsHrefs.map(function(){
             if ($(this).offset().top < fromTop)
               return this;
           });

           // Get the id of the current element
           cur = cur[cur.length-1];

           var id = cur && cur.length ? cur[0].id : "";

           if (lastId !== id && id) {
               scrollTo(id);
           }

           window.history.pushState({}, "", window.location.origin + window.location.pathname + "#" + id);
        });

        scrollTo = function(id) {
              lastId = id;

              menuItems
                .removeClass("active");

              menuItems
                .parents()
                .removeClass("active-region");

              menuItems
                .parents("ul").hide();

              menuItems
                .filter("[href=#"+id+"]")
                .addClass("active");

              menuItems
                .filter("[href=#"+id+"]")
                .parents("ul").show();

              menuItems
                .filter("[href=#"+id+"]")
                .parent().children("ul").show();

              menuItems
                .filter("[href=#"+id+"]")
                .parents("li").addClass("active-region");

        }
      menuItems
        .removeClass("active");

      menuItems
        .parents()
        .removeClass("active-region");

        var syncMenuItem;
        if(window.location.hash!=="") {
            var menuItemFor = $.grep(menuItems, function(e) {
                return e.hash === window.location.hash;
            });
            console.log(menuItemFor);
            if(menuItemFor.length === 1) {
                syncMenuItem = menuItemFor[0];
            }
        }

        if(!syncMenuItem){
            syncMenuItem = menuItems[0];
        }

        $(syncMenuItem).click();

      });

    ***/

</script>

<script type="text/javascript">

$(document).ready(function(){
    if("Documentation" === "User Guide") {
        console.log( "processing 'Documentation'" );

        $("#doc-content-left").removeClass("large-9").removeClass("medium-9").addClass("large-12").addClass("medium-12");
        $("#doc-content-right").removeClass("large-3").removeClass("medium-3").hide();
    }

});

</script>


<script>

$( document ).ready(function() {

    (function() {
      $(function() {
        return $("#doc-content h2, #doc-content h3, #doc-content h4, #doc-content h5, #doc-content h6").each(function(i, el) {
          var $el, icon, id;
          $el = $(el);
          id = $el.attr('id');
          icon = '<i class="fa fa-link"></i>';
          if (id) {
            return $el.prepend($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
          }
        });
      });
    }).call(this);



	/*
        http://osvaldas.info/auto-hide-sticky-header
        MIT license
	*/
	;( function( $, window, document, undefined )
	{
		'use strict';

		var elSelector		= '.header',
			elClassHidden	= 'header--hidden',
			throttleTimeout	= 500,
			$element		= $( elSelector );

		if( !$element.length ) return true;

		var $window			= $( window ),
			wHeight			= 0,
			wScrollCurrent	= 0,
			wScrollBefore	= 0,
			wScrollDiff		= 0,
			$document		= $( document ),
			dHeight			= 0,

			throttle = function( delay, fn )
			{
				var last, deferTimer;
				return function()
				{
					var context = this, args = arguments, now = +new Date;
					if( last && now < last + delay )
					{
						clearTimeout( deferTimer );
						deferTimer = setTimeout( function(){ last = now; fn.apply( context, args ); }, delay );
					}
					else
					{
						last = now;
						fn.apply( context, args );
					}
				};
			};

		$window.on( 'scroll', throttle( throttleTimeout, function()
		{
			dHeight			= $document.height();
			wHeight			= $window.height();
			wScrollCurrent	= $window.scrollTop();
			wScrollDiff		= wScrollBefore - wScrollCurrent;

			if( wScrollCurrent <= 0 ) // scrolled to the very top; element sticks to the top
				$element.removeClass( elClassHidden );

			else if( wScrollDiff > 0 && $element.hasClass( elClassHidden ) ) // scrolled up; element slides in
				$element.removeClass( elClassHidden );

			else if( wScrollDiff < 0 ) // scrolled down
			{
				if( wScrollCurrent + wHeight >= dHeight && $element.hasClass( elClassHidden ) ) // scrolled to the very bottom; element slides in
					$element.removeClass( elClassHidden );

				else // scrolled down; element slides out
					$element.addClass( elClassHidden );
			}

			wScrollBefore = wScrollCurrent;
		}));

	})( jQuery, window, document );


});
</script>

</body>
</html>
