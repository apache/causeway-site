<!doctype html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <title>User Guide</title>

    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->

    <!-- No caching headers -->
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="expires" content="-1" />


    <!-- TODO: need to (re)instate CDN in the future (not using for now just so can develop off-line -->
    <link href="../css/foundation/5.5.1/foundation.css" rel="stylesheet" />
    <script src="../js/foundation/5.5.1/vendor/modernizr.js"></script>
    <link href="../css/asciidoctor/colony.css" rel="stylesheet">
    <link href="../css/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">




    <link href="../css/github-fork-ribbon-css/0.1.1/gh-fork-ribbon.css" rel="stylesheet" />
    <!--[if lt IE 9]>
      <link href="../css/github-fork-ribbon-css/0.1.1/gh-fork-ribbon.ie.css" rel="stylesheet" />
    <![endif]-->


    <style type="text/css">
        /* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{font-weight: normal}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#00}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}

        pre.CodeRay code {
            background-color: inherit;
            border-style: none;
        }

        pre.CodeRay code > span:first-child {
            margin-left: -5px;
        }

        .literalblock pre,
        .listingblock pre:not(.highlight),
        .listingblock pre[class="highlight"],
        .listingblock pre[class^="highlight "],
        .listingblock pre.CodeRay,
        .listingblock pre.prettyprint {
            background: rgb(253, 250, 246);
         }
        .sidebarblock .literalblock pre,
        .sidebarblock .listingblock pre:not(.highlight),
        .sidebarblock .listingblock pre[class="highlight"],
        .sidebarblock .listingblock pre[class^="highlight "],
        .sidebarblock .listingblock pre.CodeRay,
        .sidebarblock .listingblock pre.prettyprint {
            background: rgb(253, 250, 246);
         }

    <style>

    <style>
    .github-fork-ribbon-wrapper.right {
        position: fixed;
    }
    .github-fork-ribbon {
        background: #090;
    }
    .github-fork-ribbon a:hover {
        background:#0D0;
        color:#fff;
        font-size: 1.1em;
    }
    </style>

    <style>
        @media only screen and (min-width: 40.063em) {
          .top-bar {
            .contain-to-grid .top-bar {
                max-width: 80rem;
            }
          }
        }
        .row {
            max-width: 80rem;
        }
    </style>

    <style>
        .extended-quote,
        .extended-quote-first {
            margin-left: 40px;
            margin-right: 40px;
            font-style: italic;
        }
        .extended-quote-attribution {
            text-align: right;
            margin-right: 100px;
            color: #10B061;
        }

        .extended-quote-first:before {
            content: "\201c";
            float: left;
            font-size: 2.75em;
            font-weight: bold;
            line-height: 0.6em;
            margin-left: -0.6em;
            color: #003b6b;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
    </style>

    <style>
        body {
          position: relative;
        }

        *:not(pre) a > code {
            color: #210DDC;
        }

        *:not(pre) > code {
            background-color: inherit;
            border: none;
            font-weight: normal;
        }

        body div#toc li,
        body div#toc2 li {
            list-style-type: none;
        }

        div#doc-content {
            margin-top: 30px;
        }

        div.documentation-page table.frame-all {
            border-left: none;
            border-right: none;
        }

        body div#toc li.active-region:before,
        body div#toc2 li.active-region:before {
            content: "\00BB \0020";
            margin-left: -12px;
        }

        body div#toc li a.active,
        body div#toc2 li a.active {
            color: red;
        }

        body div#toc.toc,
        body div#toc.toc2 {
            position: fixed;
            left: auto;
            padding-top: 60px;
            z-index: auto;
            background-color: white;
            border-left-color: #eee;
            border-left-style: solid;
            border-right: none;
            min-height: 2000px;
        }

    </style>

    <style>

        @media only screen and (min-width: 768px) {
          #toc.toc2 ul ul { margin-left: -10px; }
        }


        body div#toc .tocify-subheader ul {
            margin-bottom: 0px;
        }

        body div#toc .tocify-subheader li {
            font-size: 14px;
        }
        .tocify li.tocify-item, .tocify ul.tocify-item {
            line-height: 24px;
        }

        body div#toc li.tocify-item.active:before,
        body div#toc2 li.tocify-item.active:before {
            content: "\00BB \0020";
            margin-left: -12px;
        }

        body div#toc li.tocify-item.active a,
        body div#toc2 li.tocify-item.active a {
            color: red;
        }
    </style>

    <style>
        footer {
            margin-top: 1000px;
        }
    </style>

    <style>
        /* overriding colony.css stylesheet */
        .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] {
           /*padding: 1.25em 1.5625em 1.125em 1.5625em;*/
           padding: 0.3em 0.6em 0.25em 0.6em;
        }
        @media only screen and (min-width: 1280px)
        #toc.toc2 {
          /*width: 20em;*/
          width: 25em;
        }

        #doc-content a {
          color: #210DDC;
        }

        .top-bar h1 {
            border-bottom: inherit;
        }

        h2 {
          margin-top: 80px;
        }
        h3 {
          margin-top: 40px;
        }
        h4,h5 {
          margin-top: 30px;
        }

        .admonitionblock.tip > table td.content {
            color: #10B061;
        }
        .admonitionblock.note > table td.content {
            color: #B509AB;
        }
        .admonitionblock.important > table td.content {
            color: #D5810A;
        }

        .admonitionblock .title {
            font-size: larger;
            font-style: italic;
        }

        .imageblock img {
            margin-bottom: 10px;
        }
    </style>

    <style>
        /* from http://ben.balter.com/2014/03/13/pages-anchor-links/ */
        .header-link {
          position: absolute;
          left: -0.5em;
          opacity: 0;

          /*
          -webkit-transition: opacity 0.2s ease-in-out 0.1s;
          -moz-transition: opacity 0.2s ease-in-out 0.1s;
          -ms-transition: opacity 0.2s ease-in-out 0.1s;
          */
        }

        h2:hover .header-link,
        h3:hover .header-link,
        h4:hover .header-link,
        h5:hover .header-link,
        h6:hover .header-link {
          opacity: 1;
        }
    </style>

    <style>
        .top-bar
        {
            -webkit-transition-duration: .5s;
            transition-duration: .5s;

            -webkit-transition-timing-function: cubic-bezier( 0.215, 0.610, 0.355, 1.000 );
            transition-timing-function: cubic-bezier( 0.215, 0.610, 0.355, 1.000 );

            -webkit-transition-property: -webkit-transform;
            transition-property: transform;
        }

        /*
        http://osvaldas.info/auto-hide-sticky-header
        MIT license
        */
        .header--hidden
        {
            -webkit-transform: translateY( -100% );
            -ms-transform: translateY( -100% );
            transform: translateY( -100% );

            transition-duration: .5s;
            transition-timing-function: cubic-bezier( 0.215, 0.610, 0.355, 1.000 );
            -webkit-transition-property: -webkit-transform;
            transition-property: transform;
        }
    </style>

    <style>
        #doc-content a.guide {
            color: white;
        }
    </style>

    <style>
        .tocify {
            margin-top: 80px;
        }
    </style>


</script>

</head>
<body>

<<div class="github-fork-ribbon-wrapper right" style="position: fixed;">
    <div class="github-fork-ribbon">
        <a href="https://github.com/apache/isis/fork">Fork me on GitHub</a>
    </div>
</div>


<div class="row">

    <div class="fixed contain-to-grid header">
        <nav class="top-bar" data-topbar role="navigation" style="max-width: 80rem">
            <ul class="title-area">
                <li class="name">
                    <h1>
                        <a href="/index.html">Apache Isis&trade;</a>
                    </h1>
                </li>
                <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
                <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
            </ul>

            <section class="top-bar-section">
                <ul class="right">

                    <li class="has-form">
                       <FORM class="searchbox navbar-form navbar-right" id="searchbox_012614087480249044419:dn-q5gtwxya" action="http://www.google.com/cse">
                        <div class="row collapse">
                            <input type="hidden" name="cx" value="012614087480249044419:dn-q5gtwxya">
                            <INPUT type="hidden" name="cof" value="FORID:0">
                            <INPUT class="form-control" name="q" type="text" placeholder="Search">
                        </div>
                    </FORM>
                     </li>

                </ul>

                <!-- Left Nav Section -->
                <ul class="left">

                    <li><a href="/documentation.html">Documentation</a></li>
                    <li><a href="/downloads.html">Downloads</a></li>
                    <li><a href="/help.html">Help</a></li>
                    <li><a href="/asf.html">@ASF</a></li>

                </ul>

            </section>
        </nav>
    </div>
</div>

<div class="row">

    <div id="doc-content-left" class="large-9 medium-9 columns">


        <div id="doc-content">
          <div class="sect1">
<h2 id="_ug">1. Users' Guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This users' guide introduces the <a href="#_ug_core-concepts">core concepts</a> and ideas behind Apache Isis, tells you how to <a href="#_ug_getting-started">get started</a> with a Maven archetype, and provides <a href="#_ug_how-tos">how-to</a>s and <a href="#_ug_more-advanced">more advanced</a> guidance on writing maintainable larger applications.</p>
</div>
<div class="paragraph">
<p>It goes on to discuss the <a href="#_ug_wicket-viewer">Wicket viewer</a>, both from an end-user perspective and also how as a programmer you can customize the UI.  There is a similar chapter discussing the <a href="#_ug_restfulobjects-viewer">Restful Objects viewer</a> which provides Apache Isis' REST API.  The guide also explains how to configure <a href="#_ug_security">security</a>, principally involving Apache Isis' integration with Apache Shiro.</p>
</div>
<div class="paragraph">
<p>Later chapters discuss essential topics such as <a href="#_ug_testing">testing</a> and how to <a href="#_ug_deployment">deploy</a> your app, and discuss other ways in which you can <a href="#_ug_extending">extend</a> or adapt the framework itself to your particular needs.</p>
</div>
<div class="paragraph">
<p>The users' guide is <em>not</em> intended as a reference manual; for that see the <strong><a href="rg.html#_rg">Reference Guide</a></strong>.  The users' guide also doesn&#8217;t explain how to setup your development environment; for that see the <strong><a href="cg.html#_cg">Contributors' Guide</a></strong>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ug_core-concepts">2. Core Concepts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This introductory chapter should give you a good about what Apache Isis actually <strong>is</strong>: the fundamental ideas and principles that it builds upon, how it compares with other frameworks, what the fundamental building blocks are for actually writing an Isis application, and what services and features the framework provides for you to leverage in your own apps.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Parts of this chapter have been adapted from Dan Haywood&#8217;s 2009 book, 'Domain Driven Design using Naked Objects'.  We&#8217;ve also added some new insights and made sure the material we&#8217;ve used is relevant to Apache Isis.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_ug_core-concepts_philosophy">2.1. Philosophy and Architecture</h3>
<div class="paragraph">
<p>This section describes some of the core ideas and architectural patterns upon which Apache Isis builds.</p>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_philosophy_domain-driven-design">2.1.1. Domain-Driven Design</h4>
<div class="paragraph">
<p>There&#8217;s no doubt that we developers love the challenge of understanding and deploying complex technologies. But understanding the nuances and subtleties of the business domain itself is just as great a challenge, perhaps more so. If we devoted our efforts to understanding and addressing those subtleties, we could build better, cleaner, and more maintainable software that did a better job for our stakeholders. And there&#8217;s no doubt that our stakeholders would thank us for it.</p>
</div>
<div class="paragraph">
<p>A couple of years back Eric Evans wrote his book <a href="http://www.amazon.co.uk/Domain-driven-Design-Tackling-Complexity-Software/dp/0321125215">Domain-Driven Design</a>, which is well on its way to becoming a seminal work. In fact, most if not all of the ideas in Evans' book have been expressed before, but what he did was pull those ideas together to show how predominantly object-oriented techniques can be used to develop rich, deep, insightful, and ultimately useful business applications.</p>
</div>
<div class="paragraph">
<p>There are two central ideas at the heart of domain-driven design.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <strong><em>ubiquitous language</em></strong> is about getting the whole team (both domain experts and developers) to communicate more transparently using a domain model.</p>
</li>
<li>
<p>Meanwhile, <strong><em>model-driven design</em></strong> is about capturing that model in a very straightforward manner in code.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s look at each in turn.</p>
</div>
<div class="sect4">
<h5 id="_ubiquitous_language">Ubiquitous Language</h5>
<div class="paragraph">
<p>It&#8217;s no secret that the IT industry is plagued by project failures. Too often systems take longer than intended to implement, and when finally implemented, they don&#8217;t address the real requirements anyway.</p>
</div>
<div class="paragraph">
<p>Over the years we in IT have tried various approaches to address this failing. Using waterfall methodologies, we&#8217;ve asked for requirements to be fully and precisely written down before starting on anything else. Or, using agile methodologies, we&#8217;ve realized that requirements are likely to change anyway and have sought to deliver systems incrementally using feedback loops to refine the implementation.</p>
</div>
<div class="paragraph">
<p>But let&#8217;s not get distracted talking about methodologies. At the end of the day what really matters is communication between the domain experts (that is, the business) who need the system and the techies actually implementing it. If the two don&#8217;t have and cannot evolve a shared understanding of what is required, then the chance of delivering a useful system will be next to nothing.</p>
</div>
<div class="paragraph">
<p>Bridging this gap is traditionally what business analysts are for; they act as interpreters between the domain experts and the developers. However, this still means there are two (or more) languages in use, making it difficult to verify that the system being built is correct. If the analyst mistranslates a requirement, then neither the domain expert nor the application developer will discover this until (at best) the application is first demonstrated or (much worse) an end user sounds the alarm once the application has been deployed into production.</p>
</div>
<div class="paragraph">
<p>Rather than trying to translate between a business language and a technical language, with  <em>DDD</em> we aim to have the business and developers using the same terms for the same concepts in order to create a single <strong><em>domain model</em></strong>. This domain model identifies the relevant concepts of the domain, how they relate, and ultimately where the responsibilities are. This single domain model provides the vocabulary for the  ubiquitous language for our system.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Ubiquitous Language</div>
<div class="paragraph">
<p>Build a common language between the domain experts and developers by using the concepts of the domain model as the primary means of communication. Use the terms in speech, in diagrams, in writing, and when presenting.</p>
</div>
<div class="paragraph">
<p>If an idea cannot be expressed using this set of concepts, then go back and extend the model. Look for and remove ambiguities and inconsistencies.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Creating a  ubiquitous language calls upon everyone involved in the system&#8217;s development to express what they are doing through the vocabulary provided by the model. If this can&#8217;t be done, then our model is incomplete. Finding the missing words deepens our understanding of the domain being modeled.</p>
</div>
<div class="paragraph">
<p>This might sound like nothing more than me insisting that the developers shouldn&#8217;t use jargon when talking to the business. Well, that&#8217;s true enough, but it&#8217;s not a one-way street. A  <strong>ubiquitous language</strong> demands that the developers work hard to understand the problem domain, but it also demands that the business works hard in being  <strong>precise</strong> in its naming and descriptions of those concepts. After all, ultimately the developers will have to express those concepts in a computer programming language.</p>
</div>
<div class="paragraph">
<p>Also, although here I&#8217;m talking about the "domain experts" as being a homogeneous group of people, often they may come from different branches of the business. Even if we weren&#8217;t building a computer system, there&#8217;s a lot of value in helping the domain experts standardize their own terminology. Is the marketing department&#8217;s "prospect" the same as sales' "customer," and is that the same as an after-sales "contract"?</p>
</div>
<div class="paragraph">
<p>The need for precision within the  ubiquitous language also helps us scope the system. Most business processes evolve piecemeal and are often quite ill-defined. If the domain experts have a very good idea of what the business process should be, then that&#8217;s a good candidate for automation, that is, including it in the scope of the system. But if the domain experts find it hard to agree, then it&#8217;s probably best to leave it out. After all, human beings are rather more capable of dealing with fuzzy situations than computers.</p>
</div>
<div class="paragraph">
<p>So, if the development team (business and developers together) continually searches to build their  ubiquitous language, then the domain model naturally becomes richer as the nuances of the domain are uncovered. At the same time, the knowledge of the business domain experts also deepens as edge conditions and contradictions that have previously been overlooked are explored.</p>
</div>
<div class="paragraph">
<p>We use the  ubiquitous language to build up a domain model. But what do we do  <strong>with</strong> that model? The answer to that is the second of our central ideas.</p>
</div>
</div>
<div class="sect4">
<h5 id="_model_driven_design">Model-Driven Design</h5>
<div class="paragraph">
<p>Of the various methodologies that the IT industry has tried, many advocate the production of separate analysis models and implementation models. One example (from the mid 2000s) was that of the  <em>OMG</em>'s Model-Driven Architecture ( <em>MDA</em>) initiative, with its platform-independent model (the  <em>PIM</em>) and a platform-specific model (the  <em>PSM</em>).</p>
</div>
<div class="paragraph">
<p>Bah and humbug! If we use our  ubiquitous language just to build up a high-level analysis model, then we will re-create the communication divide. The domain experts and business analysts will look only to the analysis model, and the developers will look only to the implementation model. Unless the mapping between the two is completely mechanical, inevitably the two will diverge.</p>
</div>
<div class="paragraph">
<p>What do we mean by  <strong>model</strong> anyway? For some, the term will bring to mind  UML class or sequence diagrams and the like. But this isn&#8217;t a model; it&#8217;s a visual  <strong>representation</strong> of some aspect of a model. No, a domain model is a group of related concepts, identifying them, naming them, and defining how they relate. What is in the model depends on what our objective is. We&#8217;re not looking to simply model everything that&#8217;s out there in the real world. Instead, we want to take a relevant abstraction or simplification of it and then make it do something useful for us.  A model is neither right nor wrong, just more or less useful.</p>
</div>
<div class="paragraph">
<p>For our  ubiquitous language to have value, the domain model that encodes it must have a straightforward, literal representation to the design of the software, specifically to the implementation. Our software&#8217;s design should be driven by this model; we should have a model-driven design.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Model-Driven Design</div>
<div class="paragraph">
<p>There must be a straightforward and very literal way to represent the domain model in terms of software. The model should balance these two requirements: form the  ubiquitous language of the development team and be representable in code.</p>
</div>
<div class="paragraph">
<p>Changing the code means changing the model; refining the model requires a change to the code.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Here also the word  <strong>design</strong> might mislead; some might be thinking of design documents and design diagrams, or perhaps of user interface (UX) design. But by  <strong>design</strong> we mean a way of organizing the domain concepts, which in turn leads to the way in which we organize their representation in code.</p>
</div>
<div class="paragraph">
<p>Luckily, using <strong><em>object-oriented</em></strong> (<em>OO</em>) languages such as Java, this is relatively easy to do;  <em>OO</em> is based on a modeling paradigm anyway. We can express domain concepts using classes and interfaces, and we can express the relationships between those concepts using associations.</p>
</div>
<div class="paragraph">
<p>So far so good. Or maybe, so far so much motherhood and apple pie. Understanding the  <em>DDD</em> concepts isn&#8217;t the same as being able to apply them, and some of the  <em>DDD</em> ideas can be difficult to put into practice. Time to discuss the naked objects pattern and how it eases that path by applying these central ideas of <em>DDD</em> in a very concrete way.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_philosophy_naked-objects-pattern">2.1.2. Naked Objects Pattern</h4>
<div class="paragraph">
<p>Apache Isis implements the naked objects pattern, originally formulated by Richard Pawson.  So who better than Richard to explain the origination of the idea?</p>
</div>
<div class="paragraph">
<p><div class="extended-quote-first"><p>The Naked Objects pattern arose, at least in part, from my own frustration at the lack of success of the domain-driven approach. Good examples were hard to find&#8212;&#8203;as they are still.
</p></div></p>
</div>
<div class="paragraph">
<p><div class="extended-quote"><p>A common complaint from <em>DDD</em> practitioners was that it was hard to gain enough commitment from business stakeholders, or even to engage them at all. My own experience suggested that it was nearly impossible to engage business managers with UML diagrams.  It was much easier to engage them in rapid prototyping&#8201;&#8212;&#8201;where they could see and interact with the results&#8201;&#8212;&#8201;but most forms of rapid prototyping concentrate on the presentation layer, often at the expense of the underlying model and certainly at the expense of abstract thinking.
</p></div></p>
</div>
<div class="paragraph">
<p><div class="extended-quote"><p>Even if you could engage the business sponsors sufficiently to design a domain model, by the time you&#8217;d finished developing the system on top of the domain model, most of its benefits had disappeared. It&#8217;s all very well creating an agile domain object model, but if any change to that model also dictates the modification of one or more layers underneath it (dealing with persistence) and multiple layers on top (dealing with presentation), then that agility is practically worthless.
</p></div></p>
</div>
<div class="paragraph">
<p><div class="extended-quote"><p>The other concern that gave rise to the birth of Naked Objects was how to make user interfaces of mainstream business systems more "expressive"&#8201;&#8212;&#8201;how to make them feel more like using a drawing program or <em>CAD</em> system. Most business systems are not at all expressive; they treat the user merely as a dumb <strong>process-follower</strong>, rather than as an empowered <strong>problem-solver</strong>.  Even the so-called usability experts had little to say on the subject: try finding the word "empowerment" or any synonym thereof in the index of any book on usability. Research had demonstrated that the best way to achieve expressiveness was to create an object-oriented user interface (<em>OOUI</em>). In practice, though, <em>OOUI</em>s were notoriously hard to develop.
</p></div></p>
</div>
<div class="paragraph">
<p><div class="extended-quote"><p>Sometime in the late 1990s, it dawned on me that if the domain model really did represent the "ubiquitous language" of the business and those domain objects were behaviorally rich (that is, business logic is encapsulated as methods on the domain objects rather than in procedural scripts on top of them), then the <em>UI</em> could be nothing more than a reflection of the user interface. This would solve both of my concerns. It would make it easier to do domain-driven design, because one could instantly translate evolving domain modeling ideas into a working prototype. And it would deliver an expressive, object-oriented user interface for free. Thus was born the idea of Naked Objects.
</p></div></p>
</div>
<div class="paragraph">
<p><div class="extended-quote-attribution"><p>-- Richard Pawson
</p></div></p>
</div>
<div class="paragraph">
<p>You can learn much more about the pattern in the book, <a href="http://www.amazon.com/exec/obidos/ISBN=0470844205/">Naked Objects</a>, also freely available to <a href="http://www.nakedobjects.org/book/">read online</a>.  Richard co-wrote the book with one of Apache Isis' committers, Robert Matthews, who was in turn the author of the Naked Objects Framework for Java (the original codebase of of Apache Isis).</p>
</div>
<div class="paragraph">
<p>You might also want to read Richard&#8217;s <a href="resources/core-concepts/Pawson-Naked-Objects-thesis.pdf">PhD on the subject</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>One of the external examiners for Richard&#8217;s PhD was <a href="http://en.wikipedia.org/wiki/Trygve_Reenskaug">Trygve Reenskaug</a>, who originally formulated the MVC pattern at Xeroc PARC.  In his paper, <a href="http://heim.ifi.uio.no/~trygver/2007/2007.02.13-babyUML.pdf">Baby UML</a>, Reenskaug describes that when implemented the first MVC, "the conventional wisdom in the group was that objects should be visible and tangible, thus bridging the gap between the human brain and the abstract data within the computer."  Sound familiar?  It&#8217;s interesting to speculate what might have been if this idea had been implemented back then in the late 70s.</p>
</div>
<div class="paragraph">
<p>Reenskaug then goes on to say that "this simple and powerful idea failed because &#8230;&#8203; users were used to seeing [objects] from different perspectives. The visible and tangible object would get very complex if it should be able to show itself and be manipulated in many different ways."</p>
</div>
<div class="paragraph">
<p>In Apache Isis the responsibility of rendering an object is not the object itself, it is the framework.  Rather, the object inspects the object and uses that to decide how to render the object.  This is also extensible.  In the <a href="http://www.isisaddons.org">Isis Addons</a> (non-ASF) the <a href="http://github.com/isisaddons/isis-wicket-gmap3">Isis addons' gmap3</a> wicket extension renders any object with latitude/longitude on a map, while <a href="http://github.com/isisaddons/isis-wicket-fullcalendar2">Isis addons' fullcalendar2 wicket extension</a> renders any object with date(s) on a calendar.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_ug_core-concepts_philosophy_naked-objects-pattern_object-interface-mapping">Object Interface Mapping</h5>
<div class="paragraph">
<p>Another&#8201;&#8212;&#8201;more technical&#8201;&#8212;&#8201;way to think about the naked objects pattern is as an <em>object interface mapper</em>, or <code>OIM</code>.  We sometimes use this idea to explain naked objects to a bunch of developers.</p>
</div>
<div class="paragraph">
<p>Just as an ORM (such as <a href="http://datanucleus.org">DataNucleus</a> or <a href="http://hibernate.org">Hibernate</a>) maps domain entities to a database, you can think of the naked objects pattern as representing the concept of mapping domain objects to a user interface.</p>
</div>
<div class="paragraph">
<p>This is the way that the <a href="http://metawidget.org/">MetaWidget</a> team, in particular Richard Kennard, the primary contributor, likes to describe their tool.  MetaWidget has a number of ideas in common with Apache Isis, specifically the runtime generation of a UI for domain objects.  You can hear more from Kennard and others on this <a href="http://devchat.tv/js-jabber/150-jsj-oims">Javascript Jabber podcast</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We compare Apache Isis' with MetaWidget <a href="#_ug_core-concepts_principles_apache-isis-vs_metawidget">here</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_what_this_means_in_practice">What this means in practice</h5>
<div class="paragraph">
<p>The screencast below shows what all of this means in practice, showing the relationship between a running app and the actual code underneath.</p>
</div>
<div class="videoblock">
<div class="title">How Apache Isis builds a webapp from the underlying domain object modelâ€¦</div>
<div class="content">
<iframe width="640px" height="472px" src="//www.youtube.com/embed/ludOLyi6VyY?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This screencast shows Apache Isis v1.0.0, Jan 2013.  The UI has been substantially refined since that release.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_philosophy_hexagonal-architecture">2.1.3. Hexagonal Architecture</h4>
<div class="paragraph">
<p>One of the patterns that Evans discusses in his book is that of a <strong>layered architecture</strong>.  In it he describes why the domain model lives in its own layer within the architecture. The other layers of the application (usually presentation, application, and persistence) have their own responsibilities, and are completely separate.  Each layer is cohesive and depending only on the layers below.  In particular, we have a layer dedicated to the domain model. The code in this layer is unencumbered with the (mostly technical) responsibilities of the other layers and so can evolve to tackle complex domains as well as simple ones.</p>
</div>
<div class="paragraph">
<p>This is a well-established pattern, almost a de-facto; there&#8217;s very little debate that these responsibilities should be kept separate from each other.  With Apache Isis the responsibility for presentation is a framework concern, the responsibility for the domain logic is implemented by the (your) application code.</p>
</div>
<div class="paragraph">
<p>A few years ago Alistair Cockburn reworked the traditional layered architecture diagram and came up with the <strong><em>hexagonal architecture</em></strong>:.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The hexagonal architecture is also known as the <a href="http://c2.com/cgi/wiki?PortsAndAdaptersArchitecture">Ports and Adapters</a> architecture or (less frequently) as the <a href="http://jeffreypalermo.com/blog/the-onion-architecture-part-1/">Onion</a> architecture.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/core-concepts/philosophy/hexagonal-architecture.png" alt="hexagonal architecture" width="700px">
</div>
<div class="title">Figure 1. The hexagonal architecture emphasizes multiple implementations of the different layers.</div>
</div>
<div class="paragraph">
<p>What Cockburn is emphasizing is that there&#8217;s usually more than one way <strong>into</strong> an application (what he called the <strong><em>user-side' ports</em></strong>) and more than one way  <strong>out of</strong> an application too (the <strong><em>data-side ports</em></strong>). This is very similar to the concept of primary and secondary actors in use cases: a primary actor (often a human user but not always) is active and initiates an interaction, while a secondary actor (almost always an external system) is passive and waits to be interacted with.</p>
</div>
<div class="paragraph">
<p>Associated with each port can be an <strong><em>adapter</em></strong> (in fact, Cockburn&#8217;s alternative name for this architecture is <strong><em>ports and adapters</em></strong>). An adapter is a device (piece of software) that talks in the protocol (or  <em>API</em>) of the port. Each port could have several adapters.</p>
</div>
<div class="paragraph">
<p>Apache Isis maps very nicely onto the  <strong>hexagonal architecture</strong>.  Apache Isis' viewers act as user-side adapters and use the Apache Isis metamodel API as a port into the domain objects.   For the data side, we are mostly concerned with persisting domain objects to some sort of object store.  Here Apache Isis delegates most of the heavy lifting to ORM implementing the JDO API.  Most of the time this will be DataNucleus configured to persist to an RDBMS, but DataNucleus can also support other object stores, for example Neo4J.  Alternatively Apache Isis can be configured to persist using some other JDO implementation, for example Google App Engine.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_philosophy_aop">2.1.4. Aspect Oriented</h4>
<div class="paragraph">
<p>Although not a book about object modelling, Evans' "Domain Driven Design" does use object orientation as its primary modelling tool; while <a href="#_ug_core-concepts_philosophy_naked-objects-pattern">naked objects pattern</a> very much comes from an OO background (it even has 'object' in its name); Richard Pawson lists Alan Kay as a key influence.</p>
</div>
<div class="paragraph">
<p>It&#8217;s certainly true that to develop an Apache Isis application you will need to have good object oriented modelling skills.  But given that all the mainstream languages for developing business systems are object oriented (Java, C#, Ruby), that&#8217;s not such a stretch.</p>
</div>
<div class="paragraph">
<p>However, what you&#8217;ll also find as you write your applications is that in some ways an Isis application is more aspect-oriented than it is object oriented.  Given that aspect-orientation&#8201;&#8212;&#8201;as a programming paradigm at least&#8201;&#8212;&#8201;hasn&#8217;t caught on, that statement probably needs unpacking a little.</p>
</div>
<div class="sect4">
<h5 id="_aop_concepts">AOP Concepts</h5>
<div class="paragraph">
<p>Aspect-orientation, then, is a different way of decomposing your application, by treating <em>cross-cutting concerns</em> as a first-class citizen.  The canonical (also rather boring) example of a cross-cutting concern is that of logging (or tracing) all method calls.  An aspect can be written that will weave in some code (a logging statement) at specified points in the code).</p>
</div>
<div class="paragraph">
<p>This idea sounds rather abstract, but what it really amounts to is the idea of interceptors.  When one method calls another the AOP code is called in first.  This is actually then one bit of AOP that is quite mainstream; DI containers such as Spring provide aspect orientation in supporting annotations such as <code>@Transactional</code> or <code>@Secured</code> to java beans.</p>
</div>
<div class="paragraph">
<p>Another aspect (ahem!) of aspect-oriented programming has found its way into other programming languages, that of a mix-in or trait.  In languages such as Scala these mix-ins are specified statically as part of the inheritance hierarchy, whereas with AOP the binding of a trait to some other class/type is done without the class "knowing" that additional behaviour is being mixed-in to it.</p>
</div>
</div>
<div class="sect4">
<h5 id="_realization_within_apache_isis">Realization within Apache Isis</h5>
<div class="paragraph">
<p>What has all this to do with Apache Isis, then?</p>
</div>
<div class="paragraph">
<p>Well, a different way to think of the naked objects pattern is that the visualization of a domain object within a UI is a cross-cutting concern.  By following certain very standard programming conventions that represent the <em>Apache Isis Programming Model</em> (POJOs plus annotations), the framework is able to build a metamodel and from this can render your domain objects in a standard generic fashion.  That&#8217;s a rather more interesting cross-cutting concern than boring old logging!</p>
</div>
<div class="paragraph">
<p>Isis also draws heavily on the AOP concept of interceptors.  Whenever an object is rendered in the UI, it is filtered with respect to the user&#8217;s permissions.  That is, if a user is not authorized to either view or perhaps modify an object, then this is applied transparently by the framework.  The <a href="http://github.com/isisaddons/isis-module-security">Isis addons' security</a> module, mentioned previously, provides a rich user/role/permissions subdomain to use out of the box; but you can integrate with a different security mechanism if you have one already.</p>
</div>
<div class="paragraph">
<p>Another example of interceptors are the <a href="http://github.com/isisaddons/isis-module-command">Isis addons' command</a> and <a href="http://github.com/isisaddons/isis-module-audit">Isis addons' audit</a> modules.  The command module captures every user interaction that modifies the state of the system (the "cause" of a change) while the audit module captures every change to every object (the "effect" of a change).  Again, this is all transparent to the user.</p>
</div>
<div class="paragraph">
<p>Apache Isis also has an internal event bus (you can switch between an underlying implementation of Gauva or Axon).  A domain event is fired whenever an object is interacted with, and this allows any subscribers to influence the operation (or even veto it).  This is a key mechanism in ensuring that Isis applications are maintainable, and we discuss it in depth in the section on  <a href="#_ug_more-advanced_decoupling">Decoupling</a>.  But fundamentally its relying on this AOP concept of interceptors.</p>
</div>
<div class="paragraph">
<p>Finally, Isis also a feature that is akin to AOP mix-ins.  A "contributed action" is one that is implemented on a domain service but that appears to be a behaviour of rendered domain object.  In other words, we can dissociate behaviour from data.  That&#8217;s not always the right thing to do of course.  In Richard Pawson&#8217;s description of the <a href="#_ug_core-concepts_philosophy_naked-objects-pattern">naked objects pattern</a> he talks about "behaviourally rich" objects, in other words where the business functionality encapsulated the data.   But on the other hand sometimes the behaviour and data structures change at different rates.  The <a href="http://en.wikipedia.org/wiki/Single_responsibility_principle">single responsibility principle</a> says we should only lump code together that changes at the same rate.  Apache Isis' support for contributions (not only contributed actions, but also contributed properties and contributed collections) enables this.  And again, to loop back to the topic of this section, it&#8217;s an AOP concept that being implemented by the framework.</p>
</div>
<div class="paragraph">
<p>The nice thing about aspect orientation is that for the most part you can ignore these cross-cutting concerns and - at least initially at least - just focus on implementing your domain object.  Later when your app starts to grow and you start to break it out into smaller modules, you can leverage Apache Isis' AOP support for (<a href="#_ug_more-advanced_decoupling_mixins">mixins</a>), (<a href="#_ug_more-advanced_decoupling_contributions">contributions</a>) and interceptors (the <a href="#_ug_more-advanced_decoupling_event-bus">event bus</a>) to ensure that your codebase remains maintainable.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_philosophy_how-eases-ddd">2.1.5. How Apache Isis eases DDD</h4>
<div class="paragraph">
<p>The case for  <em>DDD</em> might be compelling, but that doesn&#8217;t necessarily make it easy to do. Let&#8217;s take a look at some of the
challenges that  <em>DDD</em> throws up and see how Apache Isis (and its implementation of the naked objects pattern) helps address them.</p>
</div>
<div class="sect4">
<h5 id="_ddd_takes_a_conscious_effort">DDD takes a conscious effort</h5>
<div class="paragraph">
<p>Here&#8217;s what Eric Evans says about ubiquitous language:</p>
</div>
<div class="paragraph">
<p><div class="extended-quote-first"><p>With a conscious effort by the [development] team the domain model can provide the backbone for [the] common [ubiquitous] language&#8230;&#8203;connecting team communication to the software implementation."
</p></div></p>
</div>
<div class="paragraph">
<p><div class="extended-quote-attribution"><p>-- Eric Evans
</p></div></p>
</div>
<div class="paragraph">
<p>The word to pick up on here is <strong>conscious</strong>.  It takes a conscious effort by the entire team to develop the ubiquitous language. Everyone in the team must challenge the use of new or unfamiliar terms, must clarify concepts when used in a new context, and in general must be on the lookout for sloppy thinking. This takes willingness on the part of all involved, not to mention some practice.</p>
</div>
<div class="paragraph">
<p>With Apache Isis, though, the  ubiquitous language evolves with scarcely any effort at all. For the business experts, the Apache Isis viewers show the domain concepts they identify and the relationships between those concepts in a straightforward fashion. Meanwhile, the developers can devote themselves to encoding those domain concepts directly as domain classes. There&#8217;s no technology to get distracted by; there is literally nothing else for the developers to work on.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ddd_must_be_grounded">DDD must be grounded</h5>
<div class="paragraph">
<p>Employing a  model-driven design isn&#8217;t necessarily straightforward, and the development processes used by some organizations positively hinder it. It&#8217;s not sufficient for the business analysts or architects to come up with some idealized representation of the business domain and then chuck it over the wall for the programmers to do their best with.</p>
</div>
<div class="paragraph">
<p>Instead, the concepts in the model must have a very literal representation in code. If we fail to do this, then we open up the communication divide, and our  ubiquitous language is lost. There is literally no point having a domain model that cannot be represented in code. We cannot invent our ubiquitous language in a vacuum, and the developers must ensure that the model remains grounded in the doable.</p>
</div>
<div class="paragraph">
<p>In Apache Isis, we have a very pure one-to-one correspondence between the domain concepts and its implementation. Domain concepts are represented as classes and interfaces, easily demonstrated back to the business. If the model is clumsy, then the application will be clumsy too, and so the team can work together to find a better implementable model.</p>
</div>
</div>
<div class="sect4">
<h5 id="_model_must_be_understandable">Model must be understandable</h5>
<div class="paragraph">
<p>If we are using code as the primary means of expressing the model, then we need to find a way to make this model understandable to the business.</p>
</div>
<div class="paragraph">
<p>We could generate UML diagrams and the like from code. That will work for some members of the business community, but not for everyone. Or we could generate a PDF document from Javadoc comments, but comments aren&#8217;t code and so the document may be inaccurate.  Anyway, even if we do create such a document, not everyone will read it.</p>
</div>
<div class="paragraph">
<p>A better way to represent the model is to show it in action as a working prototype. As we show in the <a href="#_ug_getting-started">Getting Started</a> section, Apache Isis enables this with ease. Such prototypes bring the domain model to life, engaging the audience in a way that a piece of paper never can.</p>
</div>
<div class="paragraph">
<p>Moreover, with Apache Isis prototypes, the domain model will come shining through. If there are mistakes or misunderstandings in the domain model (inevitable when building any complex system), they will be obvious to all.</p>
</div>
</div>
<div class="sect4">
<h5 id="_architecture_must_be_robust">Architecture must be robust</h5>
<div class="paragraph">
<p><em>DDD</em> rightly requires that the domain model lives in its own layer within the architecture. The other layers of the application (usually presentation, application, and persistence) have their own responsibilities, and are completely separate.</p>
</div>
<div class="paragraph">
<p>However, there are two immediate issues. The first is rather obvious: custom coding each of those other layers is an expensive proposition. Picking up on the previous point, this in itself can put the kibosh on using prototyping to represent the model, even if we wanted to do so.</p>
</div>
<div class="paragraph">
<p>The second issue is more subtle. It takes real skill to ensure the correct separation of concerns between these layers, if indeed you can get an agreement as to what those concerns actually are. Even with the best intentions, it&#8217;s all too easy for custom-written layers to blur the boundaries and put (for example) validation in the user interface layer when it should belong to the domain layer. At the other extreme, it&#8217;s quite possible for custom layers to distort or completely subvert the underlying domain model.</p>
</div>
<div class="paragraph">
<p>Because of Apache Isis' generic  <em>OOUI</em>s, there&#8217;s no need to write the other layers of the architecture.  Of course, this reduces the development cost. But more than that, there will be no leakage of concerns outside the domain model. All the validation logic <strong>must</strong> be in the domain model because there is nowhere else to put it.</p>
</div>
<div class="paragraph">
<p>Moreover, although Apache Isis does provide a complete runtime framework, there is no direct coupling of your domain model to the framework. That means it is very possible to take your domain model prototyped in Naked Objects and then deploy it on some other  <em>J(2)EE</em> architecture, with a custom <em>UI</em> if you want.  Apache Isis guarantees that your domain model is complete.</p>
</div>
</div>
<div class="sect4">
<h5 id="_extending_the_reach_of_ddd">Extending the reach of DDD</h5>
<div class="paragraph">
<p>Domain-driven design is often positioned as  being applicable only to complex domains; indeed, the subtitle of Evans book is  "Tackling Complexity in the Heart of Software". The corollary is that DDD is overkill for simpler domains. The trouble is that we immediately have to make a choice: is the domain complex enough to warrant a domain-driven approach?</p>
</div>
<div class="paragraph">
<p>This goes back to the previous point, building and maintaining a layered architecture. It doesn&#8217;t seem cost effective to go to all the effort of a DDD approach if the underlying domain is simple.</p>
</div>
<div class="paragraph">
<p>However, with Apache Isis, we don&#8217;t write these other layers, so we don&#8217;t have to make a call on how complex our domain is. We can start working solely on our domain, even if we suspect it will be simple. If it is indeed a simple domain, then there&#8217;s no hardship, but if unexpected subtleties arise, then we&#8217;re in a good position to handle them.</p>
</div>
<div class="paragraph">
<p>If you&#8217;re just starting out writing domain-driven applications, then Apache Isis should significantly ease your journey into applying <em>DDD</em>. On the other hand, if you&#8217;ve used <em>DDD</em> for a while, then you should find Isis a very useful new tool in your arsenal.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_core-concepts_principles">2.2. Principles and Values</h3>
<div class="paragraph">
<p>This section describes some of the core principles and values that the framework aims to honour and support.</p>
</div>
<div class="paragraph">
<p>The first of these relate to how we believe your domain application should be written: it should be decoupled, testable and so on).  Others relate to the implementation of the framework itself.</p>
</div>
<div class="paragraph">
<p>The section concludes by contrasting the framework with some other open source frameworks commonly used.</p>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_principles_your-apps">2.2.1. Your Applications</h4>
<div class="paragraph">
<p>Apache Isis is primarily aimed at custom-built "enterprise" applications.  The UI exposed by the <a href="#_ug_wicket-viewer">Wicket viewer</a> is intended to be usable by domain experts, typically end-users within the organization.  The REST API exposed by the <a href="#_ug_restfulobjects-viewer">RestfulObjects viewer</a> allows custom apps to be developed - eg using AngularJS or similar - for use by those requiring more guidance; typically end-users outside of the organization.</p>
</div>
<div class="paragraph">
<p>But should your organization buy, or build?  Buying packaged software makes sense for statutory requirements, such as payroll or general ledger, or document management/retrieval.  But it makes much less sense to buy packaged software for the systems that support the core business: the software should fit the business, not the other way around.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - flesh out the following:
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Flexible, "just enough"</p>
</li>
<li>
<p>Decoupled</p>
</li>
<li>
<p>Long-term Cost of ownership</p>
<div class="ulist">
<ul>
<li>
<p>dependency injection of services</p>
</li>
<li>
<p>OO design techniques, eg dependency inversion principle</p>
</li>
<li>
<p>an in-memory event bus</p>
</li>
<li>
<p>applib</p>
</li>
<li>
<p>(no "Big Ball of Mud")</p>
</li>
</ul>
</div>
</li>
<li>
<p>Honouring the Single Responsibility Principle</p>
<div class="ulist">
<ul>
<li>
<p>behaviourally Complete vs Contributions/Mixins</p>
</li>
</ul>
</div>
</li>
<li>
<p>Testable<br></p>
<div class="paragraph">
<p>While Apache Isis can be used (very effectively) for simple CRUD-style applications, it is also intended to be used for complex business domains.  Ensuring that the business logic in
such applications is correct means that the framework must (and does) provide robust testing support, both for developer-level unit testing and business-level (end-to-end) integration testing.</p>
</div>
</li>
<li>
<p>Reusable building blocks<br></p>
<div class="paragraph">
<p>Isis addons, catalog.incode.org</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_principles_isis-itself">2.2.2. Apache Isis itself</h4>
<div class="paragraph">
<p>This section discusses some of the principles and values we apply to the development of the Apache Isis framework itself.</p>
</div>
<div class="sect4">
<h5 id="_full_stack_but_extensible">Full-stack but Extensible</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_focuses_on_its_usp">Focuses on its USP</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>add-ons</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apache Isis is at heart a metamodel with runtime, and coordinates interations using an AOP set of principles</p>
</li>
<li>
<p>Apache Isis vs Isis Addons</p>
</li>
<li>
<p>Apache Isis vs Shiro vs DataNucleus</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>all code has legacy in it&#8230;&#8203;. parts of the Isis codebase are well over a decade old; and back then a lot of the JEE technologies that we&#8217;d like to be using just didn&#8217;t exist, so we had to invent the features we required ourselves.</p>
</li>
<li>
<p>also, Apache Isis today is more pragmatic than previously</p>
</li>
</ol>
</div>
</li>
<li>
<p>a client/server solution, with AWT-based client</p>
</li>
<li>
<p>a HTML browser, Scimpi (JSF-like, but not using JSF), &#8230;&#8203;</p>
</li>
<li>
<p>security</p>
</li>
<li>
<p>objectstores</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We&#8217;re working hard to remove duplication, reuse existing open source/JEE, and simplify.</p>
</div>
<div class="paragraph">
<p>The areas of Apache Isis we consider mature are those that have been developed in support of real-world applications implemented by the committers.  Foremost among these is Estatio.</p>
</div>
<div class="paragraph">
<p>Focus on enterprise / line-of-business applications, for use by internal staff.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>problem solvers, not process followers</p>
</li>
<li>
<p>view models</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_principles_apache-isis-vs">2.2.3. Apache Isis vs &#8230;&#8203;</h4>
<div class="paragraph">
<p>Many other frameworks promise rapid application development and provide automatically generated user interfaces, so how
do they compare to Apache Isis?</p>
</div>
<div class="sect4">
<h5 id="_ug_core-concepts_principles_apache-isis-vs_mvc-server-side-frameworks">vs MVC server-side frameworks</h5>
<div class="paragraph">
<p>Some of most commonly used frameworks today are <a href="http://www.spring.io/">Spring MVC</a>, <a href="http://rubyonrails.org/">Ruby on Rails</a> and <a href="http://www.grails.org">Grails</a>, all of which implement one flavour or another of the server-side MVC pattern.  The MVC 1.0 specification (scheduled for JavaEE 8) is also similar.</p>
</div>
<div class="paragraph">
<p>These frameworks all use the classic  <strong>model-view-controller</strong> ( <em>MVC</em>) pattern for web applications, with scaffolding, code-generation, and/or metaprogramming tools for the controllers and views, as well as convention over configuration to define how these components interact.  The views provided out of the box by these frameworks tend to be simple  <em>CRUD</em>-style interfaces. More sophisticated behavior is accomplished by customizing the generated controllers.</p>
</div>
<div class="paragraph">
<p>The most obvious difference when developing an Apache Isis application is its deliberate lack of an explicit controller layer; non- <em>CRUD</em> behavior is automatically made available in its generic object-oriented  _UI_s.  More sophisticated UIs can be built either by <a href="#_ug_extending_wicket-viewer">extending Apache Isis' Wicket viewer</a> or by writing a bespoke UI leveraging the REST (hypermedia) API automatically exposed by <a href="#_ug_restfulobjects-viewer">Isis' Restful Objects viewer</a>.  Other frameworks can also be used to implement REST APIs, of course, but generally they require a significant amount of development to get anywhere near the level of sophistication provided automatically by Apache Isis' REST API.</p>
</div>
<div class="paragraph">
<p>Although these frameworks all provide their own ecosystems of extensions, Apache Isis' equivalent <a href="http://www.isisaddons.org">Isis Addons</a> (non-ASF) tend to work at a higher-level of abstraction.  For example, each of these frameworks will integrate with various security mechanism, but the <a href="http://github.com/isisaddons/isis-module-security">Isis addons' security module</a> provides a full subdomain of users, roles, features and permissions that can be plugged into any Isis application.  Similarly, the <a href="http://github.com/isisaddons/isis-module-command">Isis addons' command</a> and <a href="http://github.com/isisaddons/isis-module-audit">Isis addons' audit</a> modules in combination provide a support for auditing and traceability that can also be used for out of the box profiling.  Again, these addons can be plugged into any Isis app.</p>
</div>
<div class="paragraph">
<p>In terms of testing support, each of these other frameworks provide mechanisms to allow the webapp to be tested from within a JUnit test harness. Apache Isis' support is similar.  Where Apache Isis differs though is that it enables end-to-end testing without the need for slow and fragile Selenium tests. Instead, Apache Isis provides a "<a href="#_ug_testing_integ-test-support_wrapper-factory">WrapperFactory</a>" domain service that allows the generic UI provided to in essence be simulated. On a more pragmatic level, the <a href="http://github.com/isisaddons/isis-module-fakedata">Isis addons' fakedata</a> module does "what it says on the tin", allowing both unit- and integration-tests to focus on the salient data and fake out the rest.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ug_core-concepts_principles_apache-isis-vs_cqrs">vs CQRS</h5>
<div class="paragraph">
<p>The CQRS architectural pattern (it stands for "Command Query Responsbility Separation") is the idea that the domain objects that mutate the state of the system - to which commands are sent and which then execute - should be separated from the mechanism by which the state of the system is queried (rendered).  The former are sometimes called the "write (domain) model", the latter the "read model".</p>
</div>
<div class="paragraph">
<p>In the canonical version of this pattern there are separate datastores.  The commands act upon a command/write datastore.  The data in this datastore is then replicated in some way to the query/read datastore, usually denormalized or otherwise such that it is easy to query.  CQRS advocates recommend using very simple (almost naive) technology for the query/read model; it should be a simple projection of the query datastore.  Complexity instead lives elsewhere: business logic in the command/write model, and in the transformation logic betweeen the command/write and read/query datastores.  In particular, there is no requirement for the two datastores to use the same technology: one might be an RDBMS while the other a NoSQL datastore or even datawarehouse.</p>
</div>
<div class="paragraph">
<p>In most implementations the command and query datastores are <em>not</em> updated in the same transaction; instead there is some sort of replication mechanism.  This also means that the query datastore is eventually consistent rather than always consistent; there could be a lag of a few seconds before it is updated.  This means in turn that CQRS implementations require mechanisms to cater for offline query datastores; usually some sort of event bus.</p>
</div>
<div class="paragraph">
<p>The CQRS architecture&#8217;s extreme separation of responsibilities can result in a lot of boilerplate.  Any given domain concept, eg <code>Customer</code>, must be represented both in the command/write model and also in the query/read model.  Each business operation upon the command model is reified as a command object, for example <code>PlaceOrderCommand</code>.</p>
</div>
<div class="paragraph">
<p>Comparing CQRS to Apache Isis, the most obvious difference is that Apache Isis does not separate out a command/write model from a query/read model, and there is usually just a single datastore.  But then again, having a separate read model just so that the querying is very straightforward is pointless with Apache Isis because, of course, Isis provides the UI "for free".</p>
</div>
<div class="paragraph">
<p>There are other reasons though why a separate read model might make sense, such as to precompute particular queries, or against denormalized data.  In these cases Apache Isis can often provide a reasonable alternative, namely to map domain entities against RDBMS views, either materialized views or dynamic.  In such cases there is still only a single physical datastore, and so transactional integrity is retained.</p>
</div>
<div class="paragraph">
<p>Or, the CQRS architecture can be more fully implemented with Apache Isis by introducing a separate read model, synchronized using the <a href="rg.html#_rg_services-api_manpage-PublishingService"><code>PublishingService</code></a>, or using <a href="rg.html#_rg_classes_super_manpage-AbstractSubscriber">subscribers</a>  on the <a href="rg.html#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a>.  One can then use <a href="#_ug_more-advanced_view-models">view models</a> to surface the data in the external read datastore.</p>
</div>
<div class="paragraph">
<p>With respect to commands, Apache Isis does of course support the <a href="rg.html#_rg_services-spi_manpage-CommandService"><code>CommandService</code></a> which allows each business action to be reified into a <code>Command</code>.  However, names are misleading here: Apache Isis' commands are relatively passive, merely recording the intent of the user to invoke some operation.  In a CQRS architecture, though, commands take a more active role, locating and acting upon the domain objects.  More significantly, in CQRS each command has its own class, such as <code>PlaceOrderCommand</code>, instantiated by the client and then executed.  With Apache Isis, though, the end-user merely invokes the <code>placeOrder(&#8230;&#8203;)</code> action upon the domain object; the framework itself creates the <code>Command</code> as a side-effect of this.</p>
</div>
<div class="paragraph">
<p>In CQRS the commands correspond to the business logic that mutates the system.  Whether this logic is part of the command class (<code>PlaceOrderCommand</code>) or whether that command delegates to methods on the domain object is an implementation detail; but it certainly is common for the business logic to be wholly within the command object and for the domain object to be merely a data holder of the data within the command/write datastore.</p>
</div>
<div class="paragraph">
<p>In Apache Isis this same separation of business logic from the underlying data can be accomplished most straightforwardly using <a href="#_ug_more-advanced_decoupling_mixins">mixins</a> or <a href="#_ug_how-tos_contributed-members">contributions</a>.  In the UI (surfaced by the <a href="#_ug_wicket-viewer">Wicket viewer</a>) or in the REST API (surfaced by the <a href="#_ug_restfulobjects-viewer">RestfulObjects viewer</a>) the behaviour appears to reside on the domain object; however the behaviour actually resides on separate classes and is mixed in (like a trait) only at runtime.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ug_core-concepts_principles_apache-isis-vs_event-sourcing">vs Event Sourcing</h5>
<div class="paragraph">
<p>The <a href="_ug_core-concepts_principles_apache-isis-vs_cqrs">CQRS architecture</a>, discussed above, is often combined with <em>Event Sourcing</em> pattern, though they are separate ideas.</p>
</div>
<div class="paragraph">
<p>With event sourcing, each business operation emits a domain event (or possibly events) that allow other objects in the system to act accordingly.  For example, if a customer places an order then this might emit the <code>OrderPlacedEvent</code>.  Most significantly, the subscribers to these events can include the datastore itself; the state of the system is in effect a transaction log of every event that has occurred since "the beginning of time": it is sometimes called an event store.   With CQRS, this event datastore corresponds to the command/write datastore (the query/read datastore is of course derived from the command datastore).</p>
</div>
<div class="paragraph">
<p>Although it might seem counter-intuitive to be able store persistent state in this way (as a souped up "transaction log"), the reality is that with modern compute capabilities make it quite feasible to replay many 10s/100s of thousands of events in a second.  And the architecture supports some interesting use cases; for example it becomes quite trivial to rewind the system back to some previous point in time.</p>
</div>
<div class="paragraph">
<p>When combined with CQRS we see a command that triggers a business operation, and an event that results from it.  So, a <code>PlaceOrderCommand</code> command can result in an <code>OrderPlacedEvent</code> event.  A subscriber to this event might then generate a further command to act upon some other system (eg to dispatch the system).  Note that the event might be dispatched and consumed in-process or alternatively this might occur out-of-process.  If the latter, then the subscriber will operate within a separate transaction, meaning the usual eventual consistency concerns and also compensating actions if a rollback is required.  CQRS/event sourcing advocates point out - correctly  that this is just how things are in the "real world" too.</p>
</div>
<div class="paragraph">
<p>In Apache Isis every business action (and indeed, property and collection) emits domain events through the <a href="rg.html#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a> , and can optionally also be published through the <a href="rg.html#_rg_services-spi_manpage-PublishingService"><code>PublishingService</code></a>.  The former are dispatched and consumed in-process and within the same transaction, and for this reason the <a href="rg.html#_rg_classes_super_manpage-AbstractSubscriber">subscribers</a> can also veto the events.  The latter are intended for out-of-process consumption; the (non-ASF) <a href="http://github.com/isisaddons/isis-module-publishing">Isis addons' publishing</a> and <a href="http://github.com/isisaddons/isis-module-publishmq">Isis addons' publishmq</a> modules provide implementations for dispatching either through a RDBMS database table, or directly through to an <a href="http://camel.apache.org">ActiveMQ</a> message queue (eg wired up to <a href="http://camel.apache.org">Apache Camel</a> event bus).</p>
</div>
</div>
<div class="sect4">
<h5 id="_ug_core-concepts_principles_apache-isis-vs_metawidget">vs MetaWidget</h5>
<div class="paragraph">
<p>MetaWidget (mentioned <a href="#_ug_core-concepts_philosophy_naked-objects-pattern_object-interface-mapping">earlier</a> has a number of ideas in common with Apache Isis, specifically the runtime generation of a UI for domain objects.  And like Apache Isis, MetaWidget builds its own metamodel of the domain objects and uses this to render the object.</p>
</div>
<div class="paragraph">
<p>However, there is a difference in philosophy in that MW is not a full-stack framework and does not (in their words) try to "own the UI".  Rather they support a huge variety of UI technologies and allow the domain object to be rendered in any of them.</p>
</div>
<div class="paragraph">
<p>In contrast, Apache Isis is full-stack and does generate a complete UI; we then allow you to customize or extend this UI (as per the various <a href="http://www.isisaddons.org">Isis Addons</a> (non-ASF), and we also provide a full REST API through the <a href="#_ug_restfulobjects-viewer">Restful Objects viewer</a></p>
</div>
<div class="paragraph">
<p>Also, it&#8217;s worth noting that MetaWidget does have an elegant pipeline architecture, with APIs to allow even its metamodel to be replaced.  It would be feasible and probably quite straightforward to use Apache Isis' own metamodel as an implementation of the MetaWidget API.  This would allow MetaWidget to be able to render an Apache Isis domain application.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_core-concepts_building-blocks">2.3. Building Blocks</h3>
<div class="paragraph">
<p>In this section we run through the main building blocks that make up an Apache Isis application.</p>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_building-blocks_metamodel">2.3.1. A MetaModel</h4>
<div class="paragraph">
<p>At its core, Apache Isis is a metamodel that is built at runtime from the domain classes (eg <code>Customer.java</code>), along
with optional supporting metadata (eg <code>Customer.layout.json</code>).</p>
</div>
<div class="paragraph">
<p>The contents of this metamodel is inferred from the Java classes discovered on the classpath: the entities and
supporting services, as well the members of those classes.  The detail of the metamodel is generally explicit, usually
represented by Java annotations such as <code>@Title</code> or <code>@Action</code>.  Notably the metamodel is
<a href="#_ug_extending_programming-model">extensible</a>; it is possible to teach Apache Isis new programming
conventions/rules (and conversely to remove those that are built in).</p>
</div>
<div class="paragraph">
<p>Most of the annotations recognized by the framework are defined by the Apache Isis framework itself.  For example the
<code>@Title</code> annotation - which identifies how the framework should derive a human-readable label for each rendered
domain object - is part of the <code>org.apache.isis.applib.annotations</code> package.  However the framework also recognizes
certain other JEE annotations such as <code>@javax.inject.Inject</code> (used for dependency injection).</p>
</div>
<div class="paragraph">
<p>The framework uses DataNucleus for its persistence mechanism.  This is an ORM that implements the JDO and JPA APIs, and
which can map domain objects either to an RDBMS or to various NoSQL objectstores such as MongoDB or Neo4J.  Apache Isis
recognizes a number of the JDO annotations such as <code>@javax.jdo.annotations.Column(allowNulls=&#8230;&#8203;)</code>.</p>
</div>
<div class="paragraph">
<p>In addition, the framework builds up the metamodel for each domain object using
<a href="rg.html#_rg_object-layout">layout hints</a>, such as <code>Customer.layout.json</code>.  These provide metadata such as
grouping elements of the UI together, using multi-column layouts, and so on.  The layout file can be modified while the
application is still running, and are picked up automatically; a useful way to speed up feedback.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>At the time of writing Apache Isis only recognizes and supports the JDO API, though we expect JPA to be supported
in the future.  We also expect to generalize support for <code>.layout.json</code> to be able to read such metadata from other
sources.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_building-blocks_types-of-domain-objects">2.3.2. Type of Domain Objects</h4>
<div class="paragraph">
<p>Most domain objects that the end-user interacts with are <strong>domain entities</strong>, such as <code>Customer</code>, <code>Order</code>, <code>Product</code> and
so on.  These are persistent objects and which are mapped to a database (usually relational), using JDO/DataNucleus
annotations.  From the end-user&#8217;s perspective the UI displays a single domain object per page; they can then inspect
and modify its state, and navigate to related objects.</p>
</div>
<div class="paragraph">
<p>The next type of domain object to discuss is <strong>domain services</strong>.  These are (usually) singleton stateless services
that provide additional functionality.  The behaviour of these services is rendered in various ways, though the most
obvious is as the menu actions on the top-level menu bars in the <a href="#_ug_wicket-viewer">Wicket viewer</a>'s UI.</p>
</div>
<div class="paragraph">
<p>Domain objects can also delegate to domain services; domain services are automatically injected into every other domain
object; this includes domain entities as well as other services.  This injection of domain services into entities is
significant: it allows business logic to be implemented in the domain entities, rather than have it "leach away" into
supporting service layers.  Said another way: it is the means by which Apache Isis helps you avoid the anaemic
domain model anti-pattern.</p>
</div>
<div class="paragraph">
<p>As well as domain entities - mapped to a datastore - Apache Isis also supports <strong>view models</strong>.  End users interact with
view models in the same way as a domain entity, indeed they are unlikely to distinguish one from the other.  However
view models are <em>not</em> mapped to the underlying database, rather they represent some aggregation of state from one or
more underlying entities.  Their state is serialized and recreated from their internal identifier; this identifier is
visible as the object&#8217;s URL in the <a href="#_ug_wicket-viewer">Wicket viewer</a> or
<a href="#_ug_restfulobjects-viewer">RestfulObjects viewer</a>.</p>
</div>
<div class="paragraph">
<p>There&#8217;s no need though for the view model to aggregate the state of regular domain entities.  A view model could also
be used as a proxy for some externally managed entity, accessed over a web service or REST API; it could even be a
representation of state held in-memory (such as user preferences, for example).</p>
</div>
<div class="paragraph">
<p>There are also several types of domain services.  Most easily described are those domain services (discussed above)
that are represented as the menu actions on top-level menu bars.  Another variation are <strong>contributed services</strong> - domain
services that contribute behaviour or (derived) state to entities/view models.  Finally domain services may also
simply provide additional non-UI functionality; an example being to perform an address geocoding lookup against the
google-maps API.</p>
</div>
<div class="paragraph">
<p>Also worth mentioning: domain services can also be either singletons (discussed above) or request-scoped; the latter
being annotated with <code>@javax.enterprise.context.RequestScoped</code>.  An example of the request-scoped service is the
<a href="rg.html#_rg_services-api_manpage-Scratchpad"><code>Scratchpad</code></a> service, for sharing arbitrary data between multiple objects.</p>
</div>
<div class="paragraph">
<p>The final type of domain object is the <strong>mixin</strong>.  These are similar to contributed services in that they also contribute (or rather,
mixin) both behaviour or (derived) state to entities/view models.  However, they provide a more control over contributed services,
with a cleaner programming model similar to traits found in other languages.</p>
</div>
<div class="paragraph">
<p>The diagram below summarizes the various types of domain object:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/core-concepts/building-blocks/types-of-domain-object.png"><img src="images/core-concepts/building-blocks/types-of-domain-object.png" alt="types of domain object" width="860px"></a>
</div>
</div>
<div class="paragraph">
<p>The Apache Isis programming model uses annotations to distinguish these object types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>view models</strong> are annotated either with <code>@DomainObject(nature=VIEW_MODEL)</code> or using <code>@ViewModel</code>.  Which is used is
a matter of personal preference. <br></p>
<div class="paragraph">
<p>It is also possible to implement the <code>ViewModel</code> interface, for finer-grained control.</p>
</div>
</li>
<li>
<p><strong>domain entities</strong> that are persisted to the database (as the vast majority will) are annotated with
<code>@DomainObject(nature=ENTITY)</code>. In addition such domain entities are annotated with the JDO/DataNucleus annotation of
<code>@javax.jdo.annotations.PersistenceCapable</code>.<br></p>
<div class="paragraph">
<p>In addition, if a domain entity is a proxy for state managed in an external system, or merely for some state held
in-memory, then <code>@DomainObject(nature=EXTERNAL_ENTITY)</code> or <code>@DomainObject(nature=INMEMORY_ENTITY)</code> can be used.</p>
</div>
</li>
<li>
<p><strong>mixins</strong> are annotated either with <code>@DomainObject(nature=MIXIN)</code> or using <code>@Mixin</code>.  As for view models, which is
used is a matter of personal preference.</p>
</li>
<li>
<p>finally, <strong>domain services</strong>` are annotated with <code>@DomainService(nature=&#8230;&#8203;)</code> where the nature is either
<code>VIEW_MENU_ONLY</code> (for domain services whose actions appear on the top-level menu bars), or <code>VIEW_CONTRIBUTIONS_ONLY</code>
(for domain services whose actions are contributed to entities or view models), or <code>DOMAIN</code> (for domain services whose
functionality is simply for other domain objects to invoke programmatically).</p>
<div class="paragraph">
<p>It is also possible to specify a nature of simply <code>VIEW</code>, this combining <code>VIEW_MENU_ONLY</code> and <code>VIEW_CONTRIBUTIONS_ONLY</code>.
This is in fact the default, useful for initial prototyping.  A final nature is <code>VIEW_REST_ONLY</code> which is for domain
services whose functionality is surfaced only by the <a href="#_ug_restfulobjects-viewer">RestfulObjects viewer</a>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Worth emphasising is that domain entities and view models hold state, whereas domain services are generally
stateless.  If a domain service does hold state (eg the <code>Scratchpad</code> service noted above) then it should be
<code>@RequestScoped</code> so that this state is short-lived and usable only within a single request.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_building-blocks_objects-members">2.3.3. Object Members</h4>
<div class="paragraph">
<p>Every domain object in Apache Isis consists of (at most) three types of members:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>properties, such as a `Customer&#8217;s `firstName</p>
</li>
<li>
<p>collections, such as a <code>Customer&#8217;s `orders</code> collection of <code>Order</code>s</p>
</li>
<li>
<p>actions, such as a <code>Customer'`s `placeOrder(&#8230;&#8203;)</code> method.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some domain objects - specifically domain services and mixins - only have actions.  In the case of contributing services
and mixins these actions can (depending upon their semantics and signatures) be represented as derived properties or
collections on the entity/view model to which they contribute/mix-in.</p>
</div>
<div class="sect4">
<h5 id="_properties">Properties</h5>
<div class="paragraph">
<p>Properties follow the standard getter/setter pattern, with the return type being a scalar (a value object or another
entity or view model).</p>
</div>
<div class="paragraph">
<p>For example, with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> firstName;
    <span class="directive">public</span> <span class="predefined-type">String</span> getFirstName() { <span class="keyword">return</span> firstName; }
    <span class="directive">public</span> <span class="type">void</span> setFirstName(<span class="predefined-type">String</span> firstName) { <span class="local-variable">this</span>.firstName = firstName; }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>the framework infers the <code>Customer</code> domain entity, which in turn has a <code>firstName</code> string <em>property</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_collections">Collections</h5>
<div class="paragraph">
<p>Collections are also represented by a getter and setter, however the return type is a <code>Collection</code> or subtype.</p>
</div>
<div class="paragraph">
<p>For example, with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span>
    <span class="directive">private</span> <span class="predefined-type">SortedSet</span>&lt;Order&gt; orders = <span class="keyword">new</span> <span class="predefined-type">TreeSet</span>&lt;Order&gt;();
    <span class="directive">public</span> <span class="predefined-type">SortedSet</span>&lt;Order&gt; getOrders() { <span class="keyword">return</span> orders; }
    <span class="directive">public</span> <span class="type">void</span> setOrders(<span class="predefined-type">SortedSet</span>&lt;Order&gt; orders) { <span class="local-variable">this</span>.orders = orders; }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>the framework infers the <code>orders</code> <em>collection</em>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The most commonly used collection type is <code>java.util.SortedSet</code>; entities are most commonly mapped to a relational
database (ie a datastore with set semantics) and we recommend that all entities define a natural ordering so that when
rendered in the UI they will be ordered "meaningfully" to the end-user.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_actions">Actions</h5>
<div class="paragraph">
<p>The third type of object member is actions.  (To a first approximation), actions are all public methods that do not
represent properties or collections.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span>
    <span class="directive">public</span> Customer placeOrder(Product p, <span class="type">int</span> quantity) { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>corresponds to the <code>placeOrder</code> <em>action</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The above <em>is</em> a simplification; the Apache Isis programming model also recognizes a number of other supporting methods
each of which has its own prefix such as <code>hide</code>, <code>disable</code> or <code>validate</code>.  These can be considered as "reserved words"
in Apache Isis, and do <em>not</em> correspond to actions even though they have public visibility.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_domain_entities_vs_view_models">2.3.4. Domain Entities vs View Models</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>@DomainObject(nature=&#8230;&#8203;)</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_building-blocks_domain-services">2.3.5. Domain Services</h4>
<div class="paragraph">
<p>Domain services consist of a set of logically grouped actions, and as such follow the same conventions as for entities. However, a service cannot have (persisted) properties, nor can it have (persisted) collections.</p>
</div>
<div class="paragraph">
<p>Domain services are instantiated once and once only by the framework, and are used to centralize any domain logic that does not logically belong in a domain entity or value. Apache Isis will automatically inject services into every domain entity that requests them, and into each other.</p>
</div>
<div class="paragraph">
<p>For convenience you can inherit from AbstractService or one of its subclasses, but this is not mandatory.</p>
</div>
<div class="sect4">
<h5 id="_domain_services_vs_view_services">Domain Services vs View Services</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>@DomainService(nature=&#8230;&#8203;)</code></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Factories, Repositories and Services</div>
<div class="paragraph">
<p>A distinction is sometimes made between a factory (that creates object) and a repository (that is used to find existing objects).  You will find them discussed separately in Evans' <a href="http://books.google.com/books/about/Domain_Driven_Design.html?id=hHBf4YxMnWMC">Domain Driven Design</a>, for example.</p>
</div>
<div class="paragraph">
<p>In Apache Isis these are all implemented as domain services.  Indeed, it is quite common to have a domain service that acts as both a factory and a repository.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_building-blocks_value-objects">2.3.6. Value Objects (Primitives)</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_building-blocks_mixins-and-contributions">2.3.7. Mixins &amp; Contributions</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_core-concepts_building-blocks_domain-events">2.3.8. Domain Events</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_core-concepts_framework-provided-services">2.4. Framework-provided Services</h3>
<div class="paragraph">
<p>Most framework domain services are API: they exist to provide support functionality to the application&#8217;s domain objects and services.  In this case an implementation of the service will be available, either by Apache Isis itself or by Isis Addons (non ASF).</p>
</div>
<div class="paragraph">
<p>Some framework domain services are SPI: they exist primarily so that the application can influence the framework&#8217;s behaviour.  In these cases there is (usually) no default implementation; it is up to the application to provide an implementation.</p>
</div>
<div class="paragraph">
<p>General purpose:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="rg.html#_rg_services-api_manpage-DomainObjectContainer"><code>DomainObjectContainer</code></a></p>
</li>
<li>
<p><a href="rg.html#_rg_services-api_manpage-ClockService"><code>ClockService</code></a></p>
</li>
<li>
<p><a href="rg.html#_rg_services-api_manpage-IsisJdoSupport"><code>IsisJdoSupport</code></a></p>
</li>
<li>
<p><a href="rg.html#_rg_services-api_manpage-WrapperFactory"><code>WrapperFactory</code></a></p>
</li>
<li>
<p><a href="rg.html#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a></p>
</li>
<li>
<p><a href="rg.html#_rg_services-api_manpage-EmailService"><code>EmailService</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Commands/Background/Auditing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="rg.html#_rg_services-api_manpage-CommandContext"><code>CommandContext</code></a> (SPI)</p>
</li>
<li>
<p><a href="rg.html#_rg_services-spi_manpage-CommandService"><code>CommandService</code></a> (SPI)</p>
</li>
<li>
<p><a href="rg.html#_rg_services-spi_manpage-AuditingService"><code>AuditingService</code></a> (SPI)</p>
</li>
<li>
<p><a href="rg.html#_rg_services-api_manpage-BackgroundService"><code>BackgroundService</code></a></p>
</li>
<li>
<p><a href="rg.html#_rg_services-spi_manpage-BackgroundCommandService"><code>BackgroundCommandService</code></a> (SPI)</p>
</li>
<li>
<p><a href="rg.html#_rg_services-spi_manpage-PublishingService"><code>PublishingService</code></a> (SPI)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Information Sharing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="rg.html#_rg_services-api_manpage-Scratchpad"><code>Scratchpad</code></a></p>
</li>
<li>
<p><a href="rg.html#_rg_services-api_manpage-ActionInvocationContext"><code>ActionInvocationContext</code></a></p>
</li>
<li>
<p><a href="rg.html#_rg_services-api_manpage-QueryResultsCache"><code>QueryResultsCache</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>UserManagement:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="rg.html#_rg_services-spi_manpage-UserProfileService"><code>UserProfileService</code></a> (SPI)</p>
</li>
<li>
<p><a href="rg.html#_rg_services-spi_manpage-UserRegistrationService"><code>UserRegistrationService</code></a> (SPI)</p>
</li>
<li>
<p><a href="rg.html#_rg_services-spi_manpage-EmailNotificationService"><code>EmailNotificationService</code></a> (SPI)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Bookmarks and Mementos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="rg.html#_rg_services-api_manpage-BookmarkService"><code>BookmarkService</code></a></p>
</li>
<li>
<p><a href="rg.html#_rg_services-api_manpage-MementoService"><code>MementoService</code></a></p>
</li>
<li>
<p><a href="rg.html#_rg_services-api_manpage-DeepLinkService"><code>DeepLinkService</code></a></p>
</li>
<li>
<p><a href="rg.html#_rg_services-api_manpage-XmlSnapshotService"><code>XmlSnapshotService</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A full list of services can be found in the <a href="rg.html#_rg_services-api">Domain Services (API)</a>  and <a href="rg.html#_rg_services-spi">Domain Services (SPI)</a> chapters of the reference guide.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ug_core-concepts_add-ons">2.5. Isis Add-ons</h3>
<div class="paragraph">
<p>The <a href="http://www.isisaddons.org">Isis Addons</a> website provides a number of reusable modules and other extensions for Apache Isis.  This chapter focuses just on the modules, all of which have a name of the form <code>isis-module-xxx</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that Isis addons, while maintained by Apache Isis committers, are not part of the ASF.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The modules themselves fall into four broad groups:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>modules that provide an implementations of API defined by Apache Isis<br></p>
<div class="paragraph">
<p>where Apache Isis has hooks to use the service if defined by provides no implementations of its own.  The <a href="http://github.com/isisaddons/isis-module-command">command</a>, <a href="http://github.com/isisaddons/isis-module-audit">auditing</a>, <a href="http://github.com/isisaddons/isis-module-publishing">publishing</a>, <a href="http://github.com/isisaddons/isis-module-security">security</a>  and <a href="http://github.com/isisaddons/isis-module-sessionlogger">sessionlogger</a> modules fall into this category.  Typically the domain objects themselves wouldn&#8217;t interact with these services</p>
</div>
</li>
<li>
<p>modules that provide standalone domain services with their own API and implementation<br></p>
<div class="paragraph">
<p>These are simply intended to be used by domain objects.  The <a href="http://github.com/isisaddons/isis-module-docx">docx</a>, <a href="http://github.com/isisaddons/isis-module-excel">excel</a>, <a href="http://github.com/isisaddons/isis-module-settings">settings</a> and <a href="http://github.com/isisaddons/isis-module-stringinterpolator">stringinterpolator</a> fall into this category.</p>
</div>
</li>
<li>
<p>modules that provide standalone domain entities (and supporting services) for a particular subdomain<br></p>
<div class="paragraph">
<p>The <a href="http://github.com/isisaddons/isis-module-tags">tags</a> module falls into this category</p>
</div>
</li>
<li>
<p>modules that provide developer utilities<br></p>
<div class="paragraph">
<p>Not intended for use by either the framework or domain objects, but provide utilities that the developer themselves might use.  The <a href="http://github.com/isisaddons/isis-module-devutils">devutils</a> module (not suprisingly) falls into this category</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of the modules has a full README and example application demonstrating their usage.  The sections below briefly outline the capabilities of these modules.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ug_core-concepts_other-deployment-options">2.6. Other Deployment Options</h3>
<div class="paragraph">
<p>Apache Isis is a mature platform suitable for production deployment, with its "sweet spot" being line-of-business enterprise applications.  So if you&#8217;re looking to develop that sort of application, we certainly hope you&#8217;ll seriously evaluate it.</p>
</div>
<div class="paragraph">
<p>But there are other ways that you can make Apache Isis work for you; in this chapter we explore a few of them.</p>
</div>
<div class="sect3">
<h4 id="_deploy_to_production">2.6.1. Deploy to production</h4>
<div class="paragraph">
<p>Let&#8217;s start though with the default use case for Apache Isis: building line-of-business enterprise applications, on top of its Wicket viewer.</p>
</div>
<div class="paragraph">
<p>Apache Wicket, and therefore Apache Isis in this configuration, is a stateful architecture.  As a platform it is certainly capable of supporting user bases of several thousand (with perhaps one or two hundred concurrent); however it isn&#8217;t an architecture that you should try to scale up to tens of thousands of concurrent users.</p>
</div>
<div class="paragraph">
<p>The UI UI generated by the Wicket viewer is well suited to many line-of-business apps, but it&#8217;s also worth knowing that (with a little knowledge of the Wicket APIs) it relatively straightforward to extend.  As described in <a href="#_ug_core-concepts_add-ons">Isis addons</a> chapter, the viewer already has integrations with <a href="https://github.com/isisaddons/isis-wicket-gmap3">google maps</a>, <a href="https://github.com/isisaddons/isis-wicket-fullcalendar2">a full calendar</a> and an <a href="https://github.com/isisaddons/isis-wicket-excel">export to Excel</a> component.  We are also aware of integrations with SVG images (for floor maps of shopping center) and of custom widgets displaying a catalogue (text and images) of medical diseases.</p>
</div>
<div class="paragraph">
<p>Deploying on Apache Isis means that the framework also manages object persistence.  For many line-of-business applications this will mean using a relational database.  It is also possible (courtesy of its integratinon with <a href="http://www.datanucleus.org">DataNucleus</a>) to deploy an Isis app to a NoSQL store such as Neo4J or MongoDB; and it is also possible to deploy to cloud platforms such as <a href="https://cloud.google.com/appengine/docs">Google App Engine (GAE)</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_use_for_prototyping">2.6.2. Use for prototyping</h4>
<div class="paragraph">
<p>Even if you don&#8217;t intend to deploy your application on top of Apache Isis, there can be a lot of value in using Apache Isis for prototyping.  Because all you need do to get an app running is write domain objects, you can very quickly explore a domain object model and validate ideas with a domain expert.</p>
</div>
<div class="paragraph">
<p>By focusing just on the domain, you&#8217;ll also find that you start to develop a ubiquitous language - a set of terms and concepts that the entire team (business and technologists alike) have a shared understanding.</p>
</div>
<div class="paragraph">
<p>Once you&#8217;ve sketched out your domain model, you can then "start-over" using your preferred platform.</p>
</div>
</div>
<div class="sect3">
<h4 id="_deploy_on_your_own_platform">2.6.3. Deploy on your own platform</h4>
<div class="paragraph">
<p>The programming model defined by Apache Isis deliberately minimizes the dependencies on the rest of the framework. In fact, the only hard dependency that the domain model classes have on Apache Isis is through the <code>org.apache.isis.applib</code> classes, mostly to pick up annotations such as <code>@Disabled</code>.
So, if you have used Apache Isis for prototyping (discussed above), then note that it&#8217;s quite feasible to take your domain model a the basis of your actual development effort; Apache Isis' annotations and programming conventions will help ensure that any subtle semantics you might have captured in your prototyping are not lost.</p>
</div>
<div class="paragraph">
<p>If you go this route, your deployment platform will of course need to provide similar capabilities to Apache Isis.  In particular, you&#8217;ll need to figure out a way to inject domain services into domain entities (eg using a JPA listener), and you&#8217;ll also need to reimplement any domain services you have used that Apache Isis provides "out-of-the-box" (eg <a href="rg.html#_rg_services-api_manpage-QueryResultsCache"><code>QueryResultsCache</code></a> domain service).</p>
</div>
</div>
<div class="sect3">
<h4 id="_deploy_the_rest_api">2.6.4. Deploy the REST API</h4>
<div class="paragraph">
<p>REST (Representation State Transfer) is an architectural style for building highly scalable distributed systems, using the same principles as the World Wide Web. Many commercial web APIs (twitter, facebook, Amazon) are implemented as either pure REST APIs or some approximation therein.</p>
</div>
<div class="paragraph">
<p>The <a href="http://restfulobjects.org">Restful Objects specification</a> defines a means by a domain object model can be exposed as RESTful resources using JSON representations over HTTP. Apache Isis' <a href="#_ug_restfulobjects-viewer">RestfulObjects viewer</a> is an implementation of that spec, making any Apache Isis domain object automatically available via REST.</p>
</div>
<div class="paragraph">
<p>There are a number of use cases for deploying Isis as a REST API, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to allow a custom UI to be built against the RESTful API<br></p>
<div class="paragraph">
<p>For example, using AngularJS or some other RIA technology such as Flex, JavaFX, Silverlight</p>
</div>
</li>
<li>
<p>to enable integration between systems<br></p>
<div class="paragraph">
<p>REST is designed to be machine-readable, and so is an excellent choice for synchronous data interchange scenarios.</p>
</div>
</li>
<li>
<p>as a ready-made API for migrating data from one legacy system to its replacement.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As for the auto-generated webapps, the framework manages object persistence. It is perfectly possible to deploy the REST API alongside an auto-generated webapp; both work from the same domain object model.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implement_your_own_viewer">2.6.5. Implement your own viewer</h4>
<div class="paragraph">
<p>Isis' architecture was always designed to support multiple viewers; and indeed Apache Isis out-of-the-box supports two: the Wicket viewer, and the Restful Objects viewer (or three, if one includes the Wrapper Factory).</p>
</div>
<div class="paragraph">
<p>While we mustn&#8217;t understate the effort involved here, it is feasible to implement your own viewers too.  Indeed, one of Apache Isis' committers does indeed have a (closed source) viewer, based on <a href="http://www.wavemaker.com/">Wavemaker</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ug_how-tos">3. How tos</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides instructions on how to go about actually developing Apache Isis domain applications.</p>
</div>
<div class="sect2">
<h3 id="_ug_how-tos_class-structure">3.1. Class Structure</h3>
<div class="paragraph">
<p>Apache Isis works by building a metamodel of the domain objects: entities, view models and services.  The class members of both entities and view models represent both state&#8201;&#8212;&#8201;(single-valued) properties and (multi-valued) collections&#8201;&#8212;&#8201;and behaviour&#8201;&#8212;&#8201;actions.  The class members of domain services is simpler: just behaviour, ie actions.</p>
</div>
<div class="paragraph">
<p>In the automatically generated UI a property is rendered as a field.  This can be either of a value type (a string, number, date, boolean etc) or can be a reference to another entity.  A collection is generally rendered as a table.</p>
</div>
<div class="paragraph">
<p>In order for Apache Isis to build its metamodel the domain objects must follow some conventions: what we call the <em>Apache Isis Programming Model</em>.  This is just an extension of the pojo / JavaBean standard of yesteryear: properties and collections are getters/setters, while actions are simply any remaining <code>public</code> methods.</p>
</div>
<div class="paragraph">
<p>Additional metamodel semantics are inferred both imperatively from <em>supporting methods</em> and declaratively from annotations.</p>
</div>
<div class="paragraph">
<p>In this section we discuss the mechanics of writing domain objects that comply with Apache Isis' programming model.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In fact, the Apache Isis programming model is extensible; you can teach Apache Isis new programming conventions and you can remove existing ones; ultimately they amount to syntax.   The only real fundamental that can&#8217;t be changed is the notion that objects consist of properties, collections and actions.</p>
</div>
<div class="paragraph">
<p>You can learn more about extending Apache Isis programming model <a href="#_ug_extending_programming-model">here</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_class-structure_class-definition">3.1.1. Class Definition</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Classes are defined both to Isis and (if an entity) also to JDO/DataNucleus.</p>
</div>
<div class="paragraph">
<p>We use Java packages as a way to group related domain objects together; the package name forms a namespace. We can then reason about all the classes in that package/namespace as a single unit.</p>
</div>
<div class="paragraph">
<p>In the same way that Java packages act as a namespace for domain objects, it&#8217;s good practice to map domain entities to their own (database) schemas.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more on this topic, see the topic discussing modules and <a href="#_ug_more-advanced_decoupling">decoupling</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_class-structure_properties">3.1.2. Property</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_value_vs_reference_types">Value vs Reference Types</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The annotations for mapping value types tend to be different for properties vs action parameters, because JDO annotations are only valid on properties.  The table in the <a href="#_ug_how-tos_class-structure_properties-vs-parameters">Properties vs Parameters</a> section provides a handy reference of each.</p>
</div>
</div>
<div class="sect4">
<h5 id="_optional_properties">Optional Properties</h5>
<div class="paragraph">
<p>JDO/DataNucleus' default is that a property is assumed to be mandatory if it is a primitive type (eg <code>int</code>, <code>boolean</code>), but optional if a reference type (eg <code>String</code>, <code>BigDecimal</code> etc).  To override optionality in JDO/DataNucleus the <code>@Column(allowsNull="&#8230;&#8203;")</code> annotations is used.</p>
</div>
<div class="paragraph">
<p>Apache Isis on the other hand assumes that all properties (and action parameters, for that matter) are mandatory, not optional.  These defaults can also be overridden using Apache Isis' own annotations, specifically <code>@Property(optionality=&#8230;&#8203;)</code>.</p>
</div>
<div class="paragraph">
<p>These different defaults can lead to incompatibilities between the two frameworks.  To counteract that, Apache Isis also recognizes and honours JDO&#8217;s <code>@Column(allowsNull=&#8230;&#8203;)</code>.</p>
</div>
<div class="paragraph">
<p>For example, rather than:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Column(allowNulls=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> LocalDate date;
<span class="annotation">@Property</span>(optionality=Optionality.OPTIONAL)
<span class="directive">public</span> LocalDate getDate() { ... }
<span class="directive">public</span> <span class="type">void</span> setDate(LocalDate d) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>you should instead simply write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> LocalDate date;
<span class="annotation">@javax</span>.jdo.annotations.Column(allowNulls=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> LocalDate getDate() { ... }
<span class="directive">public</span> <span class="type">void</span> setDate(LocalDate d) { ... }</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>With JDO/DataNucleus it&#8217;s valid for the <code>@Column</code> annotation to be placed on either the field or the getter.  Apache Isis (currently) only looks for annotations on the getter.  We therefore recommend that you always place <code>@Column</code> on the gettter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In all cases the framework will search for any incompatibilities in optionality (whether specified explicitly or defaulted implicitly) between Isis' defaults and DataNucleus, and refuse to boot if any are found (fail fast).</p>
</div>
<div class="sect5">
<h6 id="_handling_mandatory_properties_in_subtypes">Handling Mandatory Properties in Subtypes</h6>
<div class="paragraph">
<p>If you have a hierarchy of classes then you need to decide which inheritance strategy to use.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"table per hierarchy", or "rollup" (<code>InheritanceStrategy.SUPERCLASS_TABLE</code>)<br></p>
<div class="paragraph">
<p>whereby a single table corresponds to the superclass, and also holds the properties of the subtype (or subtypes) being rolled up</p>
</div>
</li>
<li>
<p>"table per class" (<code>InheritanceStrategy.NEW_TABLE</code>)<br></p>
<div class="paragraph">
<p>whereby is a table for both superclass and subclass, in 1:1 correspondence</p>
</div>
</li>
<li>
<p>"rolldown" (<code>InheritanceStrategy.SUBCLASS_TABLE</code>)<br></p>
<div class="paragraph">
<p>whereby a single table holds the properties of the subtype, and also holds the properties of its supertype</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the first "rollup" case, we can have a situation where - logically speaking - the property is mandatory in the subtype - but it must be mapped as nullable in the database because it is n/a for any other subtypes that are rolled up.</p>
</div>
<div class="paragraph">
<p>In this situation we must tell JDO that the column is optional, but to Apache Isis we want to enforce it being mandatory. This can be done using the <code>@Property(optionality=Optionality.MANDATORY)</code> annotation.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Inheritance(strategy = InheritanceStrategy.SUPER_TABLE)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeSubtype</span> <span class="directive">extends</span> SomeSuperType {
    <span class="directive">private</span> LocalDate date;
    <span class="annotation">@javax</span>.jdo.annotations.Column(allowNulls=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Property</span>(optionality=Optionality.MANDATORY)
    <span class="directive">public</span> LocalDate getDate() { ... }
    <span class="directive">public</span> <span class="type">void</span> setDate(LocalDate d) { ... }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>@Property(optionality=&#8230;&#8203;)</code> annotation is equivalent to the older but still supported <code>@Optional</code> annotation and <code>@Mandatory</code> annotations. Its benefit is that it lumps together all Apache Isis' property metadata in a single annotation.  Its downside is that it is rather verbose if the only semantic that needs to be specified&#8201;&#8212;&#8201;as is often the case&#8201;&#8212;&#8201;is optionality.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An alternative way to achieve this is to leave the JDO annotation on the field (where it is invisible to Apache Isis), and rely on Isis' default, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Inheritance(strategy = InheritanceStrategy.SUPER_TABLE)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeSubtype</span> <span class="directive">extends</span> SomeSuperType {
    <span class="annotation">@javax</span>.jdo.annotations.Column(allowNulls=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> LocalDate date;
    <span class="comment">// mandatory in Apache Isis by default</span>
    <span class="directive">public</span> LocalDate getDate() { }
    <span class="directive">public</span> <span class="type">void</span> setDate(LocalDate d) { }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We recommend the former mapping, though, using <code>@Property(optionality=Optionality.MANDATORY)</code>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="__code_string_code_s_length"><code>String</code>s (Length)</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_ug_how-tos_class-structure_properties_mapping-joda-dates">Mapping JODA Dates</h5>
<div class="paragraph">
<p>Isis' JDO objectstore bundles DataNucleus' <a href="http://www.datanucleus.org/documentation/products/plugins.html">built-in support</a> for Joda <code>LocalDate</code> and <code>LocalDateTime</code> datatypes, meaning that entity properties of these types will be persisted as appropriate data types in the database tables.</p>
</div>
<div class="paragraph">
<p>It is, however, necessary to annotate your properties with <code>@javax.jdo.annotations.Persistent</code>, otherwise the data won&#8217;t actually be persisted. See the <a href="http://db.apache.org/jdo/field_types.html">JDO docs</a> for more details on this.</p>
</div>
<div class="paragraph">
<p>Moreover, these datatypes are <em>not</em> in the default fetch group, meaning that JDO/DataNucleus will perform an additional <code>SELECT</code> query for each attribute. To avoid this extra query, the annotation should indicate that the property is in the default fetch group.</p>
</div>
<div class="paragraph">
<p>For example, the <code>ToDoItem</code> (in the <a href="https://github.com/isisaddons/isis-app-todoapp">todoapp example app</a> (not ASF)) defines the <code>dueBy</code> property as follows:</p>
</div>
</div>
<div class="sect4">
<h5 id="__code_bigdecimal_code_s_precision"><code>BigDecimal</code>s (Precision)</h5>
<div class="paragraph">
<p>Working with <code>java.math.BigDecimal</code> properties takes a little care due to scale/precision issues.</p>
</div>
<div class="paragraph">
<p>For example, suppose we have:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="predefined-type">BigDecimal</span> impact;
<span class="directive">public</span> <span class="predefined-type">BigDecimal</span> getImpact() {
    <span class="keyword">return</span> impact;
}
<span class="directive">public</span> <span class="type">void</span> setImpact(<span class="directive">final</span> <span class="predefined-type">BigDecimal</span> impact) {
    <span class="local-variable">this</span>.impact = impact;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>JDO/DataNucleus creates, at least with HSQL, the table with the field type as NUMERIC(19). No decimal digits are admitted. (Further details <a href="http://hsqldb.org/doc/2.0/guide/sqlgeneral-chapt.html#sgc_numeric_types">here</a>).</p>
</div>
<div class="paragraph">
<p>What this implies is that, when a record is inserted, a log entry similar to this one appears:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">INSERT INTO ENTITY(..., IMPACT, ....) VALUES (...., <span class="float">0.5</span>, ....)</code></pre>
</div>
</div>
<div class="paragraph">
<p>But when that same record is retrieved, the log will show that a value of "0" is returned, instead of 0.5.</p>
</div>
<div class="paragraph">
<p>The solution is to explicitly add the scale to the field like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Column(scale=<span class="integer">2</span>)
<span class="directive">private</span> <span class="predefined-type">BigDecimal</span> impact;
<span class="directive">public</span> <span class="predefined-type">BigDecimal</span> getImpact() {
    <span class="keyword">return</span> impact;
}
<span class="directive">public</span> <span class="type">void</span> setImpact(<span class="directive">final</span> <span class="predefined-type">BigDecimal</span> impact) {
    <span class="local-variable">this</span>.impact = impact;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, you should also set the scale of the <code>BigDecimal</code>, using <code>setScale(scale, roundingMode)</code>.</p>
</div>
<div class="paragraph">
<p>More information can be found <a href="http://www.opentaps.org/docs/index.php/How_to_Use_Java_BigDecimal:_A_Tutorial">here</a> and <a href="http://www.tutorialspoint.com/java/math/bigdecimal_setscale_rm_roundingmode.htm">here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_mapping_blobs_and_clobs">Mapping Blobs and Clobs</h5>
<div class="paragraph">
<p>Apache Isis configures JDO/DataNucleus so that the properties of type <code>org.apache.isis.applib.value.Blob</code> and <code>org.apache.isis.applib.value.Clob</code> can also be persisted.</p>
</div>
<div class="paragraph">
<p>As for <a href="#_ug_how-tos_class-structure_properties_mapping-joda-dates">Joda dates</a>, this requires the <code>@javax.jdo.annotations.Persistent</code> annotation. However, whereas for dates one would always expect this value to be retrieved eagerly, for blobs and clobs it is not so clear cut.</p>
</div>
<div class="sect5">
<h6 id="_mapping_blobs">Mapping Blobs</h6>
<div class="paragraph">
<p>For example, in the <code>ToDoItem</code> class (of the <a href="https://github.com/isisaddons/isis-app-todoapp/blob/61b8114a8e01dbb3c380b31cf09eaed456407570/dom/src/main/java/todoapp/dom/module/todoitem/ToDoItem.java#L475">todoapp example app</a> (non-ASF) the <code>attachment</code> property is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Persistent(defaultFetchGroup=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>, columns = {
    <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_name</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_mimetype</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_bytes</span><span class="delimiter">&quot;</span></span>, jdbcType=<span class="string"><span class="delimiter">&quot;</span><span class="content">BLOB</span><span class="delimiter">&quot;</span></span>, sqlType = <span class="string"><span class="delimiter">&quot;</span><span class="content">LONGVARBINARY</span><span class="delimiter">&quot;</span></span>)
})
<span class="directive">private</span> <span class="predefined-type">Blob</span> attachment;
<span class="annotation">@Property</span>(
        optionality = Optionality.OPTIONAL
)
<span class="directive">public</span> <span class="predefined-type">Blob</span> getAttachment() {
    <span class="keyword">return</span> attachment;
}
<span class="directive">public</span> <span class="type">void</span> setAttachment(<span class="directive">final</span> <span class="predefined-type">Blob</span> attachment) {
    <span class="local-variable">this</span>.attachment = attachment;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The three <code>@javax.jdo.annotations.Column</code> annotations are required because the mapping classes that Apache Isis provides (<a href="https://github.com/apache/isis/blob/isis-1.4.0/component/objectstore/jdo/jdo-datanucleus/src/main/java/org/apache/isis/objectstore/jdo/datanucleus/valuetypes/IsisBlobMapping.java#L59">IsisBlobMapping</a> and <a href="https://github.com/apache/isis/blob/isis-1.4.0/component/objectstore/jdo/jdo-datanucleus/src/main/java/org/apache/isis/objectstore/jdo/datanucleus/valuetypes/IsisClobMapping.java#L59">IsisClobMapping</a>) map to 3 columns. (It is not an error to omit these <code>@Column</code> annotations, but without them the names of the table columns are simply suffixed <code>_0</code>, <code>_1</code>, <code>_2</code> etc.</p>
</div>
<div class="paragraph">
<p>If the <code>Blob</code> is mandatory, then use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Persistent(defaultFetchGroup=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>, columns = {
    <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_name</span><span class="delimiter">&quot;</span></span>, allowsNull=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_mimetype</span><span class="delimiter">&quot;</span></span>, allowsNull=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_bytes</span><span class="delimiter">&quot;</span></span>,
                                  jdbcType=<span class="string"><span class="delimiter">&quot;</span><span class="content">BLOB</span><span class="delimiter">&quot;</span></span>, sqlType = <span class="string"><span class="delimiter">&quot;</span><span class="content">LONGVARBINARY</span><span class="delimiter">&quot;</span></span>,
                                  allowsNull=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>)
})
<span class="directive">private</span> <span class="predefined-type">Blob</span> attachment;
<span class="annotation">@Property</span>(
    optionality = Optionality.MANDATORY
)
<span class="directive">public</span> <span class="predefined-type">Blob</span> getAttachment() {
<span class="keyword">return</span> attachment;
}
<span class="directive">public</span> <span class="type">void</span> setAttachment(<span class="directive">final</span> <span class="predefined-type">Blob</span> attachment) {
<span class="local-variable">this</span>.attachment = attachment;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If specifying a <code>sqlType</code> of "LONGVARBINARY" does not work, try instead "BLOB".  There can be differences in behaviour between JDBC drivers.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_mapping_clobs">Mapping Clobs</h6>
<div class="paragraph">
<p>Mapping <code>Clob`s works in a very similar way, but the `jdbcType</code> and <code>sqlType</code> attributes will, respectively, be <code>CLOB</code> and <code>LONGVARCHAR</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Persistent(defaultFetchGroup=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>, columns = {
    <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_name</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_mimetype</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_chars</span><span class="delimiter">&quot;</span></span>,
                                  jdbcType=<span class="string"><span class="delimiter">&quot;</span><span class="content">CLOB</span><span class="delimiter">&quot;</span></span>, sqlType = <span class="string"><span class="delimiter">&quot;</span><span class="content">LONGVARCHAR</span><span class="delimiter">&quot;</span></span>)
})
<span class="directive">private</span> <span class="predefined-type">Clob</span> doc;
<span class="annotation">@Property</span>(
    optionality = Optionality.OPTIONAL
)
<span class="directive">public</span> <span class="predefined-type">Clob</span> getDoc() {
    <span class="keyword">return</span> doc;
}
<span class="directive">public</span> <span class="type">void</span> setDoc(<span class="directive">final</span> <span class="predefined-type">Clob</span> doc) {
    <span class="local-variable">this</span>.doc = doc;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If specifying a <code>sqlType</code> of "LONGVARCHAR" does not work, try instead "CLOB".  There can be differences in behaviour between JDBC drivers.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_mapping_to_varbinary_or_varchar">Mapping to VARBINARY or VARCHAR</h6>
<div class="paragraph">
<p>Instead of mapping to a sqlType of <code>LONGVARBINARY</code> (or perhaps <code>BLOB</code>), you might instead decide to map to a <code>VARBINARY</code>.  The difference is whether the binary data is held "on-row" or as a pointer "off-row"; with a <code>VARBINARY</code> the data is held on-row and so you will need to specify a length.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_bytes</span><span class="delimiter">&quot;</span></span>, jdbcTypr=<span class="string"><span class="delimiter">&quot;</span><span class="content">BLOB</span><span class="delimiter">&quot;</span></span>, sqlType = <span class="string"><span class="delimiter">&quot;</span><span class="content">VARBINARY</span><span class="delimiter">&quot;</span></span>, length=<span class="integer">2048</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same argument applies to <code>LONGVARCHAR</code> (or <code>CLOB</code>); you could instead map to a regular <code>VARCHAR</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Column(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment_chars</span><span class="delimiter">&quot;</span></span>, sqlType = <span class="string"><span class="delimiter">&quot;</span><span class="content">VARCHAR</span><span class="delimiter">&quot;</span></span>, length=<span class="integer">2048</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Support and maximum allowed length will vary by database vendor.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_class-structure_collections">3.1.3. Collections</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While Apache Isis support collections of references, the framework (currently) does not support collections of values. That is, it isn&#8217;t possible to define a collection of type <code>Set&lt;String&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Or, actually, you can, because that is a valid mapping supported by JDO/DataNucleus .  However, Apache Isis has no default visualization.</p>
</div>
<div class="paragraph">
<p>One workaround is to mark the collection as <a href="rg.html#_rg_annotations_manpage-Programmatic"><code>@Programmatic</code></a>.  This ensures that the collection is ignored by Apache Isis.</p>
</div>
<div class="paragraph">
<p>Another workaround is to wrap each value in a view model, as explained in this <a href="#_ug_more-advanced_tips-n-tricks_simulating-collections-of-values">tip</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_class-structure_actions">3.1.4. Actions</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While Apache Isis support actions whose parameters' types are scalar (values such as <code>String</code>, <code>int</code>, or references such as <code>Customer</code>), the framework (currently) does not support parameter types that are collections or maps.</p>
</div>
<div class="paragraph">
<p>The workaround is to mark the collection as <code>@Programmatic</code>, as described in <a href="#_ug_how-tos_class-structure_ignoring-methods">Ignoring Methods</a>.  This ensures that the collection is ignored by Apache Isis.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_class-structure_action-parameters">3.1.5. Action Parameters</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="__code_string_code_s_length_2"><code>String</code>s (Length)</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="__code_bigdecimal_code_s_precision_2"><code>BigDecimal</code>s (Precision)</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_optional">Optional</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_class-structure_inject-services">3.1.6. Injecting services</h4>
<div class="paragraph">
<p>Apache Isis autowires (automatically injects) domain services into each entity, as well as into the domain services themselves, using either method injection or field injection. The applib <code>DomainObjectContainer</code> is also a service, so can be injected in exactly the same manner.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Isis currently does <em>not</em> support qualified injection of services; the domain service of each type must be distinct from any other.</p>
</div>
<div class="paragraph">
<p>If you find a requirement to inject two instances of type <code>SomeService</code>, say, then the work-around is to create trivial subclasses <code>SomeServiceA</code> and <code>SomeServiceB</code> and inject these instead.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_field_injection">Field Injection</h5>
<div class="paragraph">
<p>Field injection is recommended, using the <code>@javax.inject.Inject</code> annotation. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@javax</span>.inject.Inject
    OrderRepository orderRepository;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We recommend using default rather than <code>private</code> visibility so that the field can be mocked out within unit tests (placed in the same package as the code under test).</p>
</div>
</div>
<div class="sect4">
<h5 id="_method_injection">Method Injection</h5>
<div class="paragraph">
<p>Isis also supports two forms of method injection.  All that is required to inject a service into a entity/service is to provide an appropriate method or field. The name
of the method does not matter, only that it is prefixed either <code>set</code> or <code>inject</code>, is
public, and has a single parameter of the correct type.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">private</span> OrderRepository orderRepository;
    <span class="directive">public</span> <span class="type">void</span> setOrderRepository(OrderRepository orderRepository) {
        <span class="local-variable">this</span>.orderRepository = orderRepository;
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or alternatively, using 'inject' as the prefix:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="directive">private</span> OrderRepository orderRepository;
    <span class="directive">public</span> <span class="type">void</span> injectOrderRepository(OrderRepository orderRepository) {
        <span class="local-variable">this</span>.orderRepository = orderRepository;
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the method name can be anything; it doesn&#8217;t need to be related to the type being injected.</p>
</div>
</div>
<div class="sect4">
<h5 id="_constructor_injection">Constructor injection</h5>
<div class="paragraph">
<p>Simply to note that constructor injection is <em>not</em> supported by Apache Isis (and is unlikely to be, because the JDO specification for entities requires a no-arg constructor).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_class-structure_properties-vs-parameters">3.1.7. Properties vs Parameters</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In many cases the value types of properties and of action parameters align. For example, a <code>Customer</code> entity might have a <code>surname</code> property, and there might also be corresponding <code>changeSurname</code>.  Ideally we want the surname property and surname action parameter to use the same value type.</p>
</div>
<div class="paragraph">
<p>Having first-class support for this is a goal of Apache Isis, and it is already possible (by writing some plumbing and glue code using Isis and DataNucleus APIs) to get some way towards this ideal.  However, in the vast majority of cases it is much easier and more practical to simply use standard value types such as <code>java.lang.String</code>.</p>
</div>
<div class="paragraph">
<p>However, the JDO/DataNucleus annotations for specifying semantics such as optionality or maximum length are restricted to only apply to fields and to methods; they cannot be applied to action parameters.  It is therefore necessary to use Apache Isis' equivalent annotations for action parameters.</p>
</div>
<div class="paragraph">
<p>The table below summarises the equivalence of some of the most common cases.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Comparing annotations of Properties vs Action Parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 37%;">
<col style="width: 37%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">value type/semantic</th>
<th class="tableblock halign-left valign-top">property</th>
<th class="tableblock halign-left valign-top">action parameter</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (length)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">big decimal (precision)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Isis blob</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Column(allowsNull="true")</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ParameterLayout(optionality=Optionality.OPTIONAL</code>) or <code>@Optional</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_class-structure_ignoring-methods">3.1.8. Ignoring Methods</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sometimes you want to define a <code>public</code> method on a domain object that is not intended to be rendered in Apache Isis' UI.</p>
</div>
<div class="paragraph">
<p>To exclude such methods, use the <a href="rg.html#_rg_annotations_manpage-Programmatic"><code>@Programmatic</code></a> annotation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_how-tos_ui-hints">3.2. UI Hints</h3>
<div class="paragraph">
<p>The Apache Isis programming model includes several mechanisms for a domain object to provide UI hints.  These range from their title (so an end-user can distinguish one object from another) through to hints that can impact their CSS styling.</p>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_ui-hints_object-titles-and-icons">3.2.1. Object Titles and Icons</h4>
<div class="paragraph">
<p>In Apache Isis every object is identified to the user by a title (label) and an icon.  This is shown in several places: as the main heading for an object; as a link text for an object referencing another object, and also in tables representing collections of objects.</p>
</div>
<div class="paragraph">
<p>The icon is often the same for all instances of a particular class, but it&#8217;s also possible for an individual instance to return a custom icon.  This could represent the state of that object (eg a shipped order, say, or overdue library book).</p>
</div>
<div class="paragraph">
<p>It is also possible for an object to provide a CSS class hint.  In conjunction with <a href="#_ug_wicket-viewer_customisation_tweaking-css-classes">customized CSS</a> this can be used to apply arbitrary styling; for example each object could be rendered in a page with a different background colour.</p>
</div>
<div class="sect4">
<h5 id="_object_title">Object Title</h5>
<div class="paragraph">
<p>The object title is a label to identify an object to the end-user.  Generally the object title is a label to identify an object to the end-user.  There is no requirement for it to be absolutely unique, but it should be "unique enough" to distinguish the object from other object&#8217;s likely to be rendered on the same page.</p>
</div>
<div class="paragraph">
<p>The title is always shown with an icon, so there is generally no need for the title to include information about the object&#8217;s type.  For example the title of a customer object shouldn&#8217;t include the literal string "Customer"; it can just have the customer&#8217;s name, reference or some other meaningful business identifier.</p>
</div>
<div class="sect5">
<h6 id="_declarative_style">Declarative style</h6>
<div class="paragraph">
<p>The <a href="rg.html#_rg_annotations_manpage-Title"><code>@Title</code></a> annotation can be used build up the title of an object from its constituent parts.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@Title</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>, append=<span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getFirstName() { ... }
    <span class="annotation">@Title</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Product getLastName() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>might return "Arthur Clarke", while:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerAlt</span> {
    <span class="annotation">@Title</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>, prepend=<span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getFirstName() { ... }

    <span class="annotation">@Title</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Product getLastName() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>could return "Clarke, Arthur".</p>
</div>
<div class="paragraph">
<p>Note that the sequence is in Dewey Decimal Format.  This allows a subclass to intersperse information within the title.  For example (please forgive this horrible domain modelling (!)):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Author</span> <span class="directive">extends</span> Customer {
    <span class="annotation">@Title</span>(sequence=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.5</span><span class="delimiter">&quot;</span></span>, append=<span class="string"><span class="delimiter">&quot;</span><span class="content">. </span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getMiddleInitial() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>could return "Arthur C. Clarke".</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Titles can sometimes get be long and therefore rather cumbersome in "parented" tables.  If <code>@Title</code> has been used then the Wicket viewer will automatically exclude portions of the title belonging to the owning object.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_imperative_style">Imperative style</h6>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - see <a href="rg.html#_rg_methods_reserved_manpage-title"><code>title()</code></a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_object_icon">Object Icon</h5>
<div class="paragraph">
<p>The icon is often the same for all instances of a particular class, but it&#8217;s also possible for an individual instance to return a custom icon.  This could represent the state of that object (eg a shipped order, say, or overdue library book).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_reserved_manpage-iconName"><code>iconName()</code></a>, <a href="rg.html#_rg_annotations_manpage-DomainObjectLayout_cssClassFa"><code>@DomainObjectLayout#cssClassFa()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_object_css_styling">Object CSS Styling</h5>
<div class="paragraph">
<p>It is also possible for an object to return a <a href="rg.html#_rg_methods_reserved_manpage-cssClass">CSS class</a>.  In conjunction with <a href="#_ug_wicket-viewer_customisation_tweaking-css-classes">customized CSS</a> this can be used to apply arbitrary styling; for example each object could be rendered in a page with a different background colour.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_reserved_manpage-cssClass"><code>cssClass()</code></a>, <a href="rg.html#_rg_annotations_manpage-DomainObjectLayout_cssClass"><code>@DomainObjectLayout#cssClass()</code></a> <a href="rg.html#_rg_annotations_manpage-ActionLayout_cssClass"><code>@ActionLayout#cssClass()</code></a>, <a href="rg.html#_rg_annotations_manpage-PropertyLayout_cssClass"><code>@PropertyLayout#cssClass()</code></a>, <a href="rg.html#_rg_annotations_manpage-CollectionLayout_cssClass"><code>@CollectionLayout#cssClass()</code></a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_ui-hints_names-and-descriptions">3.2.2. Names and Descriptions</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
see also <a href="#_ug_more-advanced_i18n">Internationalization</a>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_class_object">Class (object)</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_annotations_manpage-DomainObjectLayout_named"><code>@DomainObjectLayout#named()</code></a>, <a href="rg.html#_rg_annotations_manpage-DomainObjectLayout_describedAs"><code>@DomainObjectLayout#describedAs()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_property">Property</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_annotations_manpage-PropertyLayout_named"><code>@PropertyLayout#named()</code></a>, <a href="rg.html#_rg_annotations_manpage-PropertyLayout_describedAs"><code>@PropertyLayout#describedAs()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_collections_2">Collections</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_annotations_manpage-CollectionLayout_named"><code>@CollectionLayout#named()</code></a>, <a href="rg.html#_rg_annotations_manpage-CollectionLayout_describedAs"><code>@CollectionLayout#describedAs()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_actions_2">Actions</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_annotations_manpage-ActionLayout_named"><code>@ActionLayout#named()</code></a>, <a href="rg.html#_rg_annotations_manpage-ActionLayout_describedAs"><code>@ActionLayout#describedAs()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_action_parameters">Action Parameters</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_annotations_manpage-ParameterLayout_named"><code>@ParameterLayout#named()</code></a>, <a href="rg.html#_rg_annotations_manpage-ParameterLayout_describedAs"><code>@ParameterLayout#describedAs()</code></a>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you&#8217;re running on Java 8, then note that it&#8217;s possible to write Isis applications without using <code>@ParameterLayout(named=&#8230;&#8203;)</code> annotation.  Support for this can be found in the <a href="http://github.com/isisaddons/isis-metamodel-paraname8">Isis addons' paraname8</a> metamodel extension (non-ASF).  (In the future we&#8217;ll fold this into core).  See also our guidance on <a href="release-notes.html#_migration-notes_1.8.0-to-1.9.0_upgrading-to-java8">upgrading to Java 8</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_ui-hints_layout">3.2.3. Layout</h4>
<div class="paragraph">
<p>See the <a href="rg.html#_rg_object-layout">object layout</a> chapter.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_ui-hints_eager-rendering">3.2.4. Eager rendering</h4>
<div class="paragraph">
<p>By default, collections all rendered lazily, in other words in a "collapsed" table view:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - screenshot here
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For the more commonly used collections we want to show the table expanded:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - screenshot here
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For this we annotate the collection using the <code>@CollectionLayout(render=RenderType.EAGERLY</code>; for example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Persistent(table=<span class="string"><span class="delimiter">&quot;</span><span class="content">ToDoItemDependencies</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">Set</span>&lt;ToDoItem&gt; dependencies = <span class="keyword">new</span> <span class="predefined-type">TreeSet</span>&lt;&gt;();
<span class="annotation">@Collection</span>
<span class="annotation">@CollectionLayout</span>(
    render = RenderType.EAGERLY
)
<span class="directive">public</span> <span class="predefined-type">Set</span>&lt;ToDoItem&gt; getDependencies() {
    <span class="keyword">return</span> dependencies;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, it can be specified the <code>Xxx.layout.json</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="string"><span class="delimiter">&quot;</span><span class="content">dependencies</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">collectionLayout</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">render</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">EAGERLY</span><span class="delimiter">&quot;</span></span>
    },
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It might be thought that collections that are eagerly rendered should also be eagerly loaded from the database by enabling the <code>defaultFetchGroup</code> attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.Persistent(table=<span class="string"><span class="delimiter">&quot;</span><span class="content">ToDoItemDependencies</span><span class="delimiter">&quot;</span></span>, defaultFetchGroup=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">Set</span>&lt;ToDoItem&gt; dependencies = <span class="keyword">new</span> <span class="predefined-type">TreeSet</span>&lt;&gt;();
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>While this can be done, it&#8217;s likely to be a bad idea, because doing so will cause DataNucleus to query for more data than required even if the object is being rendered within some referencing object&#8217;s table.</p>
</div>
<div class="paragraph">
<p>Of course, your mileage may vary, so don&#8217;t think you can&#8217;t experiment.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_ui-hints_action-icons-and-css">3.2.5. Action Icons and CSS</h4>
<div class="paragraph">
<p>Apache Isis allows <a href="http://fortawesome.github.io/Font-Awesome/icons/">font awesome</a> icons to be associated with each action, and for <a href="http://getbootstrap.com/css/#buttons">Bootstrap CSS</a> to be applied to action rendered as buttons.</p>
</div>
<div class="paragraph">
<p>These UI hint can be applied either to individual actions, or can be applied en-masse using pattern matching.</p>
</div>
<div class="sect4">
<h5 id="_per_action">Per action</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_annotations_manpage-ActionLayout_cssClass"><code>@ActionLayout#cssClass()</code></a> and <a href="rg.html#_rg_annotations_manpage-ActionLayout_cssClassFa"><code>@ActionLayout#cssClassFa()</code></a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, you can specify these hints dynamically in the <a href="rg.html#_rg_object-layout"><code>Xxx.layout.json</code></a> for the entity.</p>
</div>
</div>
<div class="sect4">
<h5 id="_per_pattern_matching">Per pattern matching</h5>
<div class="paragraph">
<p>Rather than annotating every action with <a href="rg.html#_rg_annotations_manpage-ActionLayout_cssClassFa"><code>@ActionLayout#cssClassFa()</code></a> and <a href="rg.html#_rg_annotations_manpage-ActionLayout_cssClass"><code>@ActionLayout#cssClass()</code></a> you can instead specify the UI hint globally using regular expressions.</p>
</div>
<div class="paragraph">
<p>The <a href="rg.html#_rg_runtime_configuring-core">configuration property</a> <code>isis.reflector.facet.cssClassFa.patterns</code> is a comma separated list of key:value pairs, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.reflector.facet.cssClassFa.patterns=\
                        new.*:fa-plus,\
                        add.*:fa-plus-square,\
                        create.*:fa-plus,\
                        list.*:fa-list, \
                        all.*:fa-list, \
                        download.*:fa-download, \
                        upload.*:fa-upload, \
                        execute.*:fa-bolt, \
                        run.*:fa-bolt</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the key is a regex matching action names (eg <code>create.*</code>) and the value is a <a href="http://fortawesome.github.io/Font-Awesome/icons/">font-awesome</a> icon name (eg <code>fa-plus</code>) to be applied (as per <code>@CssClassFa()</code>) to all action members matching the regex.</p>
</div>
<div class="paragraph">
<p>Similarly, the <a href="rg.html#_rg_runtime_configuring-core">configuration property</a> <code>isis.reflector.facet.cssClass.patterns</code> is a comma separated list of key:value pairs, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.reflector.facet.cssClass.patterns=\
                        delete.*:btn-warning</code></pre>
</div>
</div>
<div class="paragraph">
<p>where (again)the key is a regex matching action names (eg <code>delete.*</code>) and the value is a <a href="http://getbootstrap.com/css/">Bootstrap</a> CSS button class (eg <code>btn-warning) to be applied (as per `@CssClass()</code>) to all action members matching the regex.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We strongly recommend that you use this technique rather than annotating each action with <a href="rg.html#_rg_annotations_manpage-ActionLayout_cssClassFa"><code>@ActionLayout#cssClassFa()</code></a> or <a href="rg.html#_rg_annotations_manpage-ActionLayout_cssClass"><code>@ActionLayout#cssClass()</code></a>.  Not only is the code more maintainable, you&#8217;ll also find that it forces you to be consistent in your action names.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_how-tos_domain-services">3.3. Domain Services</h3>
<div class="paragraph">
<p>In Apache Isis domain services have several responsibilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to expose actions to be rendered in the menu</p>
</li>
<li>
<p>to provide actions that are rendered as contributed actions/properties/collections on the contributee domain object</p>
</li>
<li>
<p>they act as subscribers to the event bus</p>
</li>
<li>
<p>they act as repositories (find existing objects) or as factories (create new objects)</p>
</li>
<li>
<p>they provide other services (eg performing calculations, attach a barcode, send an email etc).</p>
</li>
<li>
<p>to implement an SPI of the framework, most notably cross-cutting concerns such as security, command profiling, auditing and publishing.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s worth extending the <a href="#_ug_core-concepts_philosophy_hexagonal-architecture">Hexagonal Architecture</a> to show where domain services&#8201;&#8212;&#8201;and in particular the domain services provided by <a href="http://www.isisaddons.org">Isis Addons</a> (non-ASF)&#8201;&#8212;&#8201;fit in:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/how-tos/domain-services/hexagonal-architecture-addons.png" alt="hexagonal architecture addons" width="700px">
</div>
<div class="title">Figure 2. The hexagonal architecture with Isis addons</div>
</div>
<div class="paragraph">
<p>The (non-ASF) <a href="http://isisaddons.org">Isis Addons</a> are a good source of domain services, providing SPI implementations of the common cross-cutting concerns, and also a number of APIs for domain objects to invoke (eg tags, excel, settings).  Of course, you can also write your own domain services as well, for example to interface with some external CMS system, say.</p>
</div>
<div class="paragraph">
<p>The Apache Isis framework also provides numerous in-built domain services.  These are catalogued in the reference guide, see <a href="rg.html#_rg_services-api">here</a> and <a href="rg.html#_rg_services-spi">here</a>.</p>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_domain-services_organizing-services">3.3.1. Organizing Services</h4>
<div class="paragraph">
<p>In larger applications we have found it worthwhile to ensure that our domain services only act aligned with these responsibilities, employing a naming convention so that it is clear what the responsibilities of each domain service is.</p>
</div>
<div class="paragraph">
<p>The application provides the <code>@DomainService(nature=&#8230;&#8203;)</code> annotation that helps distinguish some of these responsibilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VIEW</code> indicates that the actions should appear both on the menu and also be used as contributions</p>
</li>
<li>
<p><code>VIEW_MENU_ONLY</code> indicates that the actions should appear on the menu</p>
</li>
<li>
<p><code>VIEW_CONTRIBUTED_ONLY</code> indicates that the actions should appear on the menu</p>
</li>
<li>
<p><code>DOMAIN</code> indicates that the actions are for other domain objects to invoke (either directly or indirectly through the event bus), but in any case should not be rendered at all in the UI</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Pulling all the above together, here are our suggestions as to how you should organize your domain services.</p>
</div>
<div class="sect4">
<h5 id="_factory_and_repository">Factory and Repository</h5>
<div class="paragraph">
<p>The factory/repository uses an injected <code>DomainObjectContainer</code> to both instantiate new objects and to query the database for existing objects of a given entity type.  It is not visible in UI, rather other services delegate to it.</p>
</div>
<div class="paragraph">
<p>We suggest naming such classes <code>XxxRepository</code>, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(
    nature=NatureOfService.DOMAIN                               <i class="conum" data-value="1"></i><b>(1)</b>
)
<span class="directive">public</span> CustomerRepository {
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Customer&gt; findCustomerBy...(...) {
        <span class="keyword">return</span> allMatches(...);
    }
    <span class="directive">public</span> Customer newCustomer(...) {
        Customer Customer = container.newTransientInstance(Customer.class);
        ...
        persistIfNotAlready(Customer);
        <span class="keyword">return</span> Customer;
    }
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Customer&gt; allCustomers() {
        <span class="keyword">return</span> container.allInstances(Customer.class);
    }
    <span class="annotation">@Inject</span>
    DomainObjectContainer container;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>interacted with only programmatically by other objects in the domain layer.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There is no need to annotate the actions; they are implicitly hidden because of the domain service&#8217;s nature.</p>
</div>
</div>
<div class="sect4">
<h5 id="_menu">Menu</h5>
<div class="paragraph">
<p>Menu services provide actions to be rendered on the menu.</p>
</div>
<div class="paragraph">
<p>For the Wicket viewer, each service&#8217;s actions appear as a collection of menu items of a named menu, and this menu is on one of the three menu bars provided by the Wicket viewer.  It is possible for more than one menu service&#8217;s actions to appear on the same menu; a separator is shown between each.</p>
</div>
<div class="paragraph">
<p>For the Restful Objects viewer, all menu services are shown in the services representation.</p>
</div>
<div class="paragraph">
<p>We suggest naming such classes <code>XxxMenu</code>, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(
    nature = NatureOfService.VIEW_MENU_ONLY                     <i class="conum" data-value="1"></i><b>(1)</b>
)
<span class="annotation">@DomainServiceLayout</span>(
        named = <span class="string"><span class="delimiter">&quot;</span><span class="content">Customers</span><span class="delimiter">&quot;</span></span>,                                    <i class="conum" data-value="2"></i><b>(2)</b>
        menuBar = DomainServiceLayout.MenuBar.PRIMARY,
        menuOrder = <span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerMenu</span> {
    <span class="annotation">@Action</span>(
            semantics = SemanticsOf.SAFE
    )
    <span class="annotation">@MemberOrder</span>( sequence = <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> )
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Customer&gt; findCustomerBy...(...) {
        <span class="keyword">return</span> CustomerRepository.findCustomerBy(...);          <i class="conum" data-value="3"></i><b>(3)</b>
    }

    <span class="annotation">@Action</span>(
            semantics = SemanticsOf.NON_IDEMPOTENT
    )
    <span class="annotation">@MemberOrder</span>( sequence = <span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span> )
    <span class="directive">public</span> Customer newCustomer(...) {
        <span class="keyword">return</span> CustomerRepository.newCustomer(...);
    }

    <span class="annotation">@Action</span>(
            semantics = SemanticsOf.SAFE,
            restrictTo = RestrictTo.PROTOTYPING
    )
    <span class="annotation">@MemberOrder</span>( sequence = <span class="string"><span class="delimiter">&quot;</span><span class="content">99</span><span class="delimiter">&quot;</span></span> )
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Customer&gt; allCustomers() {
        <span class="keyword">return</span> CustomerRepository.allBankMandates();
    }

    <span class="annotation">@Inject</span>
    <span class="directive">protected</span> CustomerRepository customerRepository;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the service&#8217;s actions should be rendered as menu items</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>specifies the menu name.  All services with the same menu name will be displayed on the same menu, with separators between</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>delegates to an injected repository.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Not every action on the repository need to be delegated to of course (the above example does but only because it is very simple).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note also that while there&#8217;s nothing to stop <code>VIEW_MENU</code> domain services being injected into other domain objects and interacted with programmatically, we recommend against it.  Instead, inject the underlying repository.  If there is additional business logic, then consider introducing a further <code>DOMAIN</code>-scoped service and call that instead.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_contributions">Contributions</h5>
<div class="paragraph">
<p>Services can contribute either actions, properties or collections, based on the type of their parameters.</p>
</div>
<div class="paragraph">
<p>We suggest naming such classes <code>XxxContributions</code>, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(
    nature=NatureOfService.VIEW_CONTRIBUTIONS_ONLY              <i class="conum" data-value="1"></i><b>(1)</b>
)
<span class="annotation">@DomainServiceLayout</span>(
    menuOrder=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>,
    name=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>,
}
<span class="directive">public</span> OrderContributions {
    <span class="annotation">@Action</span>(semantics=SemanticsOf.SAFE)
    <span class="annotation">@ActionLayout</span>(contributed=Contributed.AS_ASSOCIATION)       <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="annotation">@CollectionLayout</span>(render=RenderType.EAGERLY)
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Order&gt; orders(Customer customer) {              <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="keyword">return</span> container.allMatches(...);
    }

    <span class="annotation">@Inject</span>
    CustomerRepository customerRepository;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the service&#8217;s actions should be contributed to the entities of the parameters of those actions</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>contributed as an association, in particular as a collection because returns a <code>List&lt;T&gt;</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Only actions with a single argument can be contributed as associations</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>More information about contributions can be found <a href="#_ug_how-tos_contributed-members">here</a>.  More information
about using contributions and mixins to keep your domain application decoupled can be found <a href="#_ug_more-advanced_decoupling_contributions">here</a> and <a href="#_ug_more-advanced_decoupling_mixins">here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_event_subscribers">Event Subscribers</h5>
<div class="paragraph">
<p>Event subscribers can both veto interactions (hiding members, disabling members or validating changes), or can react to interactions (eg action invocation or property edit).</p>
</div>
<div class="paragraph">
<p>We suggest naming such classes <code>XxxSubscriptions</code>, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>(
    nature=NatureOfService.DOMAIN                       <i class="conum" data-value="1"></i><b>(1)</b>
)
<span class="annotation">@DomainServiceLayout</span>(
    menuOrder=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>,
    name=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>,
}
<span class="directive">public</span> CustomerOrderSubscriptions {
    <span class="annotation">@com</span>.google.common.eventbus.Subscribe
    <span class="directive">public</span> <span class="type">void</span> on(<span class="directive">final</span> Customer.DeletedEvent ev) {
        Customer customer = ev.getSource();
        orderRepository.delete(customer);
    }
    <span class="annotation">@Inject</span>
    OrderRepository orderRepository;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>subscriptions do not appear in the UI at all, so should use the domain nature of service</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_prototyping">3.3.2. Prototyping</h4>
<div class="paragraph">
<p>While for long-term maintainability we do recommend the naming conventions described <a href="#_ug_how-tos_domain-services_organizing-services">above</a>, you can get away with far fewer services when just prototyping a domain.</p>
</div>
<div class="paragraph">
<p>If the domain service nature is not specified (or is left to its default, <code>VIEW</code>), then the service&#8217;s actions will
appear in the UI both as menu items <em>and</em> as contributions (and the service can of course be injected into other domain objects for programmatic invocation).</p>
</div>
<div class="paragraph">
<p>Later on it is easy enough to refactor the code to tease apart the different responsibilities.</p>
</div>
</div>
<div class="sect3">
<h4 id="_scoped_services">3.3.3. Scoped services</h4>
<div class="paragraph">
<p>By default all domain services are considered to be singletons, and thread-safe.</p>
</div>
<div class="paragraph">
<p>Sometimes though a service&#8217;s lifetime is applicable only to a single request; in other words it is request-scoped.</p>
</div>
<div class="paragraph">
<p>The CDI annotation <a href="rg.html#_rg_annotations_manpage-RequestScoped"><code>@javax.enterprise.context.RequestScoped</code></a> is used to indicate this fact:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.enterprise.context.RequestScoped
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyService</span> <span class="directive">extends</span> AbstractService {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The framework provides a number of request-scoped services, include a scratchpad service, query results caching, and support for co-ordinating bulk actions.  See <a href="rg.html#_rg_services-api">here</a> and <a href="rg.html#_rg_services-spi">here</a> for further details.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_domain_services">3.3.4. Registering domain services</h4>
<div class="paragraph">
<p>The easiest way to register domain services is using <a href="rg.html#_rg_classes_AppManifest-bootstrapping"><code>AppManifest</code></a> to specify the modules
which contain <a href="rg.html#_rg_annotations_manpage-DomainService"><code>@DomainService</code></a>-annotated classes.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">public class MyAppManifest implements AppManifest {
    public List&lt;Class&lt;?&gt;&gt; getModules() {
        return Arrays.asList(
                ToDoAppDomainModule.class,
                ToDoAppFixtureModule.class,
                ToDoAppAppModule.class,
                org.isisaddons.module.audit.AuditModule.class);
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will load all services in the packages underneath the four modules listed.</p>
</div>
<div class="paragraph">
<p>An alternative (older) mechanism is to registered domain services in the <code>isis.properties</code> configuration file, under <code>isis.services</code> key (a comma-separated list); for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services = com.mycompany.myapp.employee.Employees\,
                com.mycompany.myapp.claim.Claims\,
                ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will then result in the framework instantiating a single instance of each of the services listed.</p>
</div>
<div class="paragraph">
<p>If all services reside under a common package, then the <code>isis.services.prefix</code> can specify this prefix:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services.prefix = com.mycompany.myapp
isis.services = employee.Employees,\
                claim.Claims,\
                ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is quite rare, however; you will often want to use default implementations of domain services that are provided by the framework and so will not reside under this prefix.</p>
</div>
<div class="paragraph">
<p>Examples of framework-provided services (as defined in the applib) include clock, auditing, publishing, exception handling, view model support, snapshots/mementos, and user/application settings management; see the <a href="rg.html#_rg_services-api">here</a> and _rg_services-spi[here] for further details.</p>
</div>
</div>
<div class="sect3">
<h4 id="_initialization">3.3.5. Initialization</h4>
<div class="paragraph">
<p>Services can optionally declare lifecycle callbacks to initialize them (when the app is deployed) and to shut them down (when the app is undeployed).</p>
</div>
<div class="paragraph">
<p>An Apache Isis session <em>is</em> available when initialization occurs (so services can interact with the object store, for example).</p>
</div>
<div class="paragraph">
<p>The framework will call any <code>public</code> method annotated with <a href="rg.html#_rg_annotations_manpage-PostConstruct"><code>@PostConstruct</code></a> with either no arguments of an argument of type <code>Map&lt;String,String&gt;</code></p>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="paragraph">
<p>In the latter case, the framework passes in the configuration (<code>isis.properties</code> and any other component-specific configuration files).</p>
</div>
<div class="paragraph">
<p>Shutdown is similar; the framework will call any method annotated with <a href="rg.html#_rg_annotations_manpage-PreDestroy"><code>@PreDestroy</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_getid_method">3.3.6. The getId() method</h4>
<div class="paragraph">
<p>Optionally, a service may provide a <a href="rg.html#_rg_methods_reserved_manpage-getId"><code>getId()</code></a> method.  This method returns a logical identifier for a service, independent of its implementation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_how-tos_crud">3.4. Object Management (CRUD)</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_instantiating_and_persisting_objects">3.4.1. Instantiating and Persisting Objects</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - using <code>DomainObjectContainer</code>'s support for  <a href="rg.html#_rg_services-api_manpage-DomainObjectContainer_object-creation-api">creation</a> and <a href="rg.html#_rg_services-api_manpage-DomainObjectContainer_object-persistence-api">persistence</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_finding_objects">3.4.2. Finding Objects</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - using <a href="rg.html#_rg_services-api_manpage-DomainObjectContainer_generic-repository-api"><code>DomainObjectContainer</code></a>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_using_datanucleus_type_safe_queries">Using DataNucleus type-safe queries</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - as described <a href="rg.html#_rg_services-api_manpage-IsisJdoSupport_type-safe-jdoql-queries">here</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_deleting_objects">3.4.3. Deleting Objects</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO using <code>DomainObjectContainer</code>'s support for  <a href="rg.html#_rg_services-api_manpage-DomainObjectContainer_object-persistence-api">persistence</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_how-tos_entity-relationships">3.5. Entity Relationships</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_mandatory_and_optional">3.5.1. Mandatory and Optional</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_how-tos_entity-relationships_managed-1-to-m-bidirectional-relationships">3.5.2. 1-m bidir relationships</h4>
<div class="paragraph">
<p>When an object is added to a 1:m bidirectional relationship, the child object must refer to the parent and the child must be added to the parent&#8217;s children collection.</p>
</div>
<div class="paragraph">
<p>If there were no database involved then we would have recommended that you use the <a href="http://www.two-sdg.demon.co.uk/curbralan/papers/MutualRegistration.pdf">mutual registration</a> pattern to ensure that both the parent and child are updated correctly.  (The  <a href="rg.html#_rg_methods_prefixes_manpage-modify"><code>modify&#8230;&#8203;()</code></a> and <a href="rg.html#_rg_methods_prefixes_manpage-clear"><code>clear&#8230;&#8203;()</code></a> supporting methods were introduced in the framework primarily to help support implement the mutual registration pattern.</p>
</div>
<div class="paragraph">
<p>However, in a relational database, these two operations in the domain object model correspond simply to updating the foreign key of the child table to reference the parent&#8217;s primary key.</p>
</div>
<div class="paragraph">
<p>So long as the parent&#8217;s children collection is a <code>java.util.Set</code> (rather than a <code>Collection</code> or a <code>List</code>), the JDO Objectstore will automatically maintain both sides of the relationship. All that is necessary is to set the child to refer to the parent.</p>
</div>
<div class="paragraph">
<p>For example, all you need write is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Department</span> {
    <span class="annotation">@javax</span>.jdo.annotations.Persistent(mappedBy=<span class="string"><span class="delimiter">&quot;</span><span class="content">department</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">private</span> <span class="predefined-type">SortedSet</span>&lt;Employee&gt; employees = <span class="keyword">new</span> <span class="predefined-type">TreeSet</span>&lt;Employee&gt;();

    <span class="directive">public</span> <span class="predefined-type">SortedSet</span>&lt;Employee&gt; getEmployees() { ... }
    <span class="directive">public</span> <span class="type">void</span> setEmployees(<span class="predefined-type">SortedSet</span>&lt;Employee&gt; employees) { ... }
    ...
}
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {
    <span class="directive">private</span> Department department;
    <span class="directive">public</span> Department getDepartment() { ... }
    <span class="directive">public</span> <span class="type">void</span> setDepartment(Department department) { ... }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>it&#8217;s the <code>mappedBy</code> attribute that tells DataNucleus this is a bidirectional relationship.  The value "department" refers to the Employee#department property.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Moreover, when maintaining a bidirectional 1-n relationship that is automatically managed by DataNucleus, it&#8217;s preferred to "add" to the parent&#8217;s child collection, don&#8217;t set the parent on the child.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you don&#8217;t do this then you may (as of Apache Isis 1.4.1) hit an NullPointerException. This may be a bug in DataNucleus, we are not completely sure, but the above idiom seems to fix the issue.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="http://isis.markmail.org/thread/ipu2lzqqikqdglox">this thread</a> on the Apache Isis users mailing list, including this <a href="http://markmail.org/message/hblptpw675mlw723">message</a> with the above recommendation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In fact, not only do you not need to manually maintain the relationship, we have noted on at least <a href="http://markmail.org/message/agnwmzocvdfht32f">one occasion</a> a subtle error if the code is programmatically added.</p>
</div>
<div class="paragraph">
<p>The error in that case was that the same object was contained in the parents collection. This of course should not happen for a <code>TreeSet</code>. However, JDO/DataNucleus replaces the <code>TreeSet</code> with its own implementation, and (either by design or otherwise) this does not enforce <code>Set</code> semantics.</p>
</div>
<div class="paragraph">
<p>The upshot is that you should NEVER programmatically add the child object to the parent&#8217;s collection if using JDO Objectstore.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_how-tos_contributed-members">3.6. Contributed Members</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - generalize to discussion on contributed collections/properties; update to new annotations
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Any n-parameter action provided by a service will automatically be contributed to the list of actions for each of its (entity) parameters. From the viewpoint of the entity the action is called a contributed action.</p>
</div>
<div class="paragraph">
<p>For example, given a service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Library</span> {
    <span class="directive">public</span> Loan borrow(Loanable l, Borrower b);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the entities:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Book</span> <span class="directive">implements</span> Loanable { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LibraryMember</span> <span class="directive">implements</span> Borrower { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>then the <code>borrow(&#8230;&#8203;)</code> action will be contributed to both <code>Book</code> and to <code>LibraryMember</code>.</p>
</div>
<div class="paragraph">
<p>This is an important capability because it helps to decouple the concrete classes from the services.</p>
</div>
<div class="paragraph">
<p>If necessary, though, this behaviour can be suppressed by annotating the service action with <code>@org.apache.isis.applib.annotations.NotContributed</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Library</span> {
    <span class="annotation">@NotContributed</span>
    <span class="directive">public</span> Loan borrow(Loanable l, Borrower b);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If annotated at the interface level, then the annotation will be inherited by every concrete class. Alternatively the annotation can be applied at the implementation class level and only apply to that particular implementation.</p>
</div>
<div class="paragraph">
<p>Note that an action annotated as being <code>@NotContributed</code> will still appear in the service menu for the service. If an action should neither be contributed nor appear in service menu items, then simply annotate it as <code>@Hidden</code>.</p>
</div>
<div class="sect3">
<h4 id="_contributed_action">3.6.1. Contributed Action</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_contributed_property">3.6.2. Contributed Property</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_contributed_collection">3.6.3. Contributed Collection</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_how-tos_business-rules">3.7. Business Rules</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_visibility_see_it">3.7.1. Visibility ("see it")</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_prefixes_manpage-hide"><code>hide&#8230;&#8203;()</code></a>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_hide_a_property">Hide a Property</h5>

</div>
<div class="sect4">
<h5 id="_hide_a_collection">Hide a Collection</h5>

</div>
<div class="sect4">
<h5 id="_hide_an_action">Hide an Action</h5>

</div>
<div class="sect4">
<h5 id="_hide_a_contributed_property_collection_or_action">Hide a Contributed Property, Collection or Action</h5>

</div>
<div class="sect4">
<h5 id="_all_members_hidden">All Members Hidden</h5>

</div>
</div>
<div class="sect3">
<h4 id="_usability_use_it">3.7.2. Usability ("use it")</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_prefixes_manpage-disable"><code>disable&#8230;&#8203;()</code></a>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_disable_a_property">Disable a Property</h5>

</div>
<div class="sect4">
<h5 id="_disable_a_collection">Disable a Collection</h5>

</div>
<div class="sect4">
<h5 id="_disable_an_action">Disable an Action</h5>

</div>
<div class="sect4">
<h5 id="_disable_a_contributed_property_collection_or_action">Disable a Contributed Property, Collection or Action</h5>

</div>
<div class="sect4">
<h5 id="_all_members_unmodifiable_disabling_the_edit_button">All Members Unmodifiable (Disabling the Edit Button)</h5>
<div class="paragraph">
<p>Sometimes an object is unmodifiable.</p>
</div>
<div class="paragraph">
<p>In the Wicket viewer this means disabling the edit button.</p>
</div>
<div class="sect5">
<h6 id="_declarative">Declarative</h6>
<div class="paragraph">
<p><code>@DomainObject(editing=&#8230;&#8203;)</code></p>
</div>
</div>
<div class="sect5">
<h6 id="_imperative">Imperative</h6>

</div>
</div>
</div>
<div class="sect3">
<h4 id="_validity_do_it">3.7.3. Validity ("do it")</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_prefixes_manpage-validate"><code>validate&#8230;&#8203;()</code></a>, <a href="rg.html#_rg_methods_prefixes_manpage-validateAddTo"><code>validateAddTo&#8230;&#8203;()</code></a>, <a href="rg.html#_rg_methods_prefixes_manpage-validateRemoveFrom"><code>validateRemoveFrom&#8230;&#8203;()</code></a> and <a href="rg.html#_rg_methods_reserved_manpage-validate"><code>validate()</code></a>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_validate_change_to_a_property">Validate (change to) a Property</h5>

</div>
<div class="sect4">
<h5 id="_validate_adding_or_removing_from_a_collection">Validate (adding or removing from) a Collection</h5>

</div>
<div class="sect4">
<h5 id="_validate_arguments_to_invoke_an_action">Validate (arguments to invoke) an Action</h5>

</div>
<div class="sect4">
<h5 id="_validating_a_contributed_property_collection_or_action">Validating a Contributed Property, Collection or Action</h5>

</div>
<div class="sect4">
<h5 id="_declarative_validation">Declarative validation</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - using <a href="rg.html#_rg_annotations_manpage-Parameter_mustSatisfy"><code>@Parameter#mustSatisfy()</code></a>, <a href="rg.html#_rg_annotations_manpage-Property_mustSatisfy"><code>@Property#mustSatisfy()</code></a>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_how-tos_derived-members">3.8. Derived Members</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_derived_property">3.8.1. Derived Property</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_derived_collection">3.8.2. Derived Collection</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>While derived properties and derived collections typically "walk the graph" to associated objects, there is nothing to prevent the returned value being the result of invoking a repository (domain service) action.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    ...
    public <span class="predefined-type">List</span>&lt;Order&gt; getMostRecentOrders() {
        <span class="keyword">return</span> orderRepo.findMostRecentOrders(<span class="local-variable">this</span>, <span class="integer">5</span>);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_trigger_on_property_change">3.8.3. Trigger on property change</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_prefixes_manpage-modify"><code>modify&#8230;&#8203;()</code></a>, <a href="rg.html#_rg_methods_prefixes_manpage-clear"><code>clear&#8230;&#8203;()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_trigger_on_collection_change">3.8.4. Trigger on collection change</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_prefixes_manpage-addTo"><code>addTo&#8230;&#8203;()</code></a>, <a href="rg.html#_rg_methods_prefixes_manpage-removeFrom"><code>removeFrom&#8230;&#8203;()</code></a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_how-tos_drop-downs-and-defaults">3.9. Drop Downs and Defaults</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_for_properties">3.9.1. For Properties</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_choices_for_property">Choices for Property</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_prefixes_manpage-choices"><code>choices&#8230;&#8203;()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_auto_complete_for_property">Auto-complete for property</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_prefixes_manpage-autoComplete"><code>autoComplete&#8230;&#8203;()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_default_for_property">Default for property</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO -  <a href="rg.html#_rg_methods_prefixes_manpage-default"><code>default&#8230;&#8203;()</code></a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_for_action_parameters">3.9.2. For Action Parameters</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_choices_for_action_parameter">Choices for action parameter</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_prefixes_manpage-choices"><code>choices&#8230;&#8203;()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_dependent_choices_for_action_params">Dependent choices for action params</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_prefixes_manpage-choices"><code>choices&#8230;&#8203;()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_auto_complete_for_action_param">Auto-complete for action param</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_methods_prefixes_manpage-autoComplete"><code>autoComplete&#8230;&#8203;()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_default_for_action_param">Default for action param</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO -  <a href="rg.html#_rg_methods_prefixes_manpage-default"><code>default&#8230;&#8203;()</code></a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_for_both_properties_and_action_parameters">3.9.3. For both Properties and Action Parameters</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_drop_down_for_limited_number_of_instances">Drop-down for limited number of instances</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_annotations_manpage-DomainObject_bounded"><code>@DomainObject#bounded()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_auto_complete_repository_based">Auto-complete (repository-based)</h5>
<div class="paragraph">
<p><a href="rg.html#_rg_annotations_manpage-DomainObject_autoCompleteRepository"><code>@DomainObject#autoCompleteRepository()</code></a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_how-tos_persisted-title">3.10. Persisted Title</h3>
<div class="paragraph">
<p>Normally the title of an object is not persisted to the database, rather it is recomputed automatically from underlying properties.  On occasion though you might want the title to also be persisted; either to make things easier for the DBA, or for an integration scenario, or some other purpose.</p>
</div>
<div class="paragraph">
<p>We can implement this feature by leveraging the <a href="rg.html#_rg_methods_lifecycle_jdo-api">JDO lifecycle</a>.  In the design we discuss here we make it a responsibility of the entities to persist the title as a property, by implementing a <code>ObjectWithPersistedTitle</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ObjectWithPersistedTitle</span> {
    <span class="annotation">@PropertyLayout</span>(hidden = Where.EVERYWHERE)  <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="predefined-type">String</span> getTitle();
    <span class="type">void</span> setTitle(<span class="directive">final</span> <span class="predefined-type">String</span> title);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>we don&#8217;t want to expose this in the UI because the title is already prominently displayed.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can then define a domain service that leverage this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequestScoped</span>
<span class="annotation">@DomainService</span>(nature = NatureOfService.DOMAIN)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TitlingService</span> {
    <span class="annotation">@PostConstruct</span>
    <span class="directive">public</span> <span class="type">void</span> init() {
        isisJdoSupport.getJdoPersistenceManager().addInstanceLifecycleListener(
            <span class="keyword">new</span> StoreLifecycleListener() {
                <span class="annotation">@Override</span>
                <span class="directive">public</span> <span class="type">void</span> preStore(<span class="directive">final</span> InstanceLifecycleEvent event) {
                    <span class="directive">final</span> <span class="predefined-type">Object</span> persistentInstance = event.getPersistentInstance();
                    <span class="keyword">if</span>(persistentInstance <span class="keyword">instanceof</span> ObjectWithPersistedTitle) {
                        <span class="directive">final</span> ObjectWithPersistedTitle objectWithPersistedTitle =
                            (ObjectWithPersistedTitle) persistentInstance;
                        objectWithPersistedTitle.setTitle(container.titleOf(objectWithPersistedTitle));
                    }
                }
                <span class="annotation">@Override</span>
                <span class="directive">public</span> <span class="type">void</span> postStore(<span class="directive">final</span> InstanceLifecycleEvent event) {
                }
            }, <span class="predefined-constant">null</span>);
    }
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> IsisJdoSupport isisJdoSupport;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> DomainObjectContainer container;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above is probably the easiest and most straightforward design. One could imagine other designs where the persisted title is stored elsewhere.  It could even be stored off into an <a href="http://lucene.apache.org/">Apache Lucene</a> (or similar) database to allow for free-text searches.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ug_more-advanced">4. More Advanced Techniques</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter pulls together a number of more advanced techniques that we&#8217;ve discovered and developed while building our own Isis applications.</p>
</div>
<div class="sect2">
<h3 id="_ug_more-advanced_decoupling">4.1. Decoupling</h3>
<div class="paragraph">
<p>We use Java packages as a way to group related domain objects together; the package name forms a namespace. We can then
reason about all the classes in that package/namespace as a single unit, or module.</p>
</div>
<div class="paragraph">
<p>This section describes how to use Apache Isis' features to ensure that your domain application remains decoupled.  The techniques described here are also the ones that have been adopted by the various <a href="http://github.com/isisaddons">Isis Addons</a> modules (not ASF) for security, commands, auditing etc.</p>
</div>
<div class="paragraph">
<p>The following sections describe how to re-assemble an application, in particular where some modules are in-house but others are potentially third-party (eg the Isis Addons modules).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There is some overlap with OSGi and Java 9&#8217;s Jigsaw concepts of "module"; in the future we expect to refactor Apache Isis to leverage these module systems.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_ug_more-advanced_decoupling_db-schemas">4.1.1. Database Schemas</h4>
<div class="paragraph">
<p>In the same way that Java packages act as a namespace for domain objects, it&#8217;s good practice to map domain entities to
their own (database) schemas. As of 1.9.0, all the <a href="http://www.isisaddons.org">Isis Addons</a> (non-ASF) modules do this, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.PersistenceCapable( ...
        schema = <span class="string"><span class="delimiter">&quot;</span><span class="content">isissecurity</span><span class="delimiter">&quot;</span></span>,
        table = <span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationUser</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ApplicationUser</span> ... { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in a <code>CREATE TABLE</code> statement of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">TABLE</span> isissecurity.<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationUser</span><span class="delimiter">&quot;</span></span> (
    ...
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>while:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.PersistenceCapable( ...
        schema = <span class="string"><span class="delimiter">&quot;</span><span class="content">isisaudit</span><span class="delimiter">&quot;</span></span>,
        table=<span class="string"><span class="delimiter">&quot;</span><span class="content">AuditEntry</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AuditEntry</span> ... { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>similarly results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">TABLE</span> isisaudit.<span class="string"><span class="delimiter">&quot;</span><span class="content">AuditEntry</span><span class="delimiter">&quot;</span></span> (
    ...
)</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If for some reason you don&#8217;t want to use schemas (though we strongly recommend that you do), then note that you can override the <code>@PersistenceCapable</code> annotation by providing XML metadata (the <code>mappings.jdo</code> file); see the section on <a href="rg.html#_rg_runtime_configuring-datanucleus">configuring DataNucleus Overriding Annotations</a> for more details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_listener_to_create_schema">Listener to create schema</h5>
<div class="paragraph">
<p>JDO/DataNucleus does not automatically create these schema objects, but it <em>does</em> provide a listener callback API
on the initialization of each class into the JDO metamodel.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Actually, the above statement isn&#8217;t quite true.  In DN 3.2.x (as used by Apache Isis up to v1.8.0) there was no support for schemas.  As of Apache Isis 1.9.0 and DN 4.0 there is now support.  But we implemented this feature initially against DN 3.2.x, and it still works, so for now we&#8217;ve decided to leave it in.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Therefore Apache Isis attaches a listener, <code>CreateSchemaObjectFromClassMetadata</code>, that checks for the schema&#8217;s existence, and creates the schema if required.</p>
</div>
<div class="paragraph">
<p>The guts of its implementation is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CreateSchemaObjectFromClassMetadata</span>
        <span class="directive">implements</span> MetaDataListener,
                   DataNucleusPropertiesAware {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> loaded(<span class="directive">final</span> AbstractClassMetaData cmd) { ... }

    <span class="directive">protected</span> <span class="predefined-type">String</span> buildSqlToCheck(<span class="directive">final</span> AbstractClassMetaData cmd) {
        <span class="directive">final</span> <span class="predefined-type">String</span> schemaName = schemaNameFor(cmd);
        <span class="keyword">return</span> <span class="predefined-type">String</span>.format(
            <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT count(*) FROM INFORMATION_SCHEMA.SCHEMATA where SCHEMA_NAME = '%s'</span><span class="delimiter">&quot;</span></span>, schemaName);
    }
    <span class="directive">protected</span> <span class="predefined-type">String</span> buildSqlToExec(<span class="directive">final</span> AbstractClassMetaData cmd) {
        <span class="directive">final</span> <span class="predefined-type">String</span> schemaName = schemaNameFor(cmd);
        <span class="keyword">return</span> <span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE SCHEMA </span><span class="char">\&quot;</span><span class="content">%s</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span>, schemaName);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>MetaDataListener</code> is the DataNucleus listener API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">MetaDataListener</span> {
    <span class="type">void</span> loaded(AbstractClassMetaData cmd);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Although not formal API, the default <code>CreateSchemaObjectFromClassMetadata</code> has been designed to be easily overrideable if you
need to tweak it to support other RDBMS'.  Any implementation must implement <code>org.datanucleus.metadata.MetaDataListener</code>:</p>
</div>
<div class="paragraph">
<p>The implementation provided has has been tested for HSQLDB, PostgreSQL and MS SQL Server, and is used automatically unless an alternative implementation is specified (as described in the section below).</p>
</div>
</div>
<div class="sect4">
<h5 id="_alternative_implementation">Alternative implementation</h5>
<div class="paragraph">
<p>An alternative implementation can be registered and used through the following configuration property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.persistor.datanucleus.classMetadataLoadedListener=\
        org.apache.isis.objectstore.jdo.datanucleus.CreateSchemaObjectFromClassMetadata</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because this pertains to the JDO Objectstore we suggest you put this configuration property in <code>WEB-INF/persistor_datanucleus.properties</code>; but putting it in <code>isis.properties</code> will also work.</p>
</div>
<div class="paragraph">
<p>Any implementation must implement <code>org.datanucleus.metadata.MetaDataListener</code>.  In many cases simply subclassing from <code>CreateSchemaObjectFromClassMetadata</code> and overriding <code>buildSqlToCheck(&#8230;&#8203;)</code> and <code>buildSqlToExec(&#8230;&#8203;)</code> should suffice.</p>
</div>
<div class="paragraph">
<p>If you <em>do</em> need more control, your implementation can also optionally implement  <code>org.apache.isis.objectstore.jdo.datanucleus.DataNucleusPropertiesAware</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">DataNucleusPropertiesAware</span> {
    <span class="directive">public</span> <span class="type">void</span> setDataNucleusProperties(<span class="directive">final</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; properties);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This provides access to the properties passed through to JDO/DataNucleus.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you do extend Apache Isis' <code>CreateSchemaObjectFromClassMetadata</code> class for some other database, please <a href="https://issues.apache.org/jira/browse/ISIS">contribute back</a> your improvements.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_more-advanced_decoupling_mixins">4.1.2. Mixins</h4>
<div class="paragraph">
<p>A mixin object (<code>1.10.0-SNAPSHOT</code>) allows one class to contribute behaviour - actions, (derived) properties and
(derived) collections - to another domain object, either a domain entity or view model.</p>
</div>
<div class="paragraph">
<p>Some programming languages use the term "trait" instead of mixin, and some languages (such as AspectJ) define their own
syntax for defining such constructs.  In Apache Isis a mixin is very similar to a domain service, however it also
defines a single 1-arg constructor that defines the type of the domain objects that it contributes to.</p>
</div>
<div class="paragraph">
<p>Why do this?  The main reason is to allow the app to be decoupled, so that it doesn&#8217;t degrade into the proverbial
<a href="http://www.laputan.org/mud/mud.html#BigBallOfMud">"big ball of mud"</a>.  Mixins (and contributions) allow dependency
to be inverted, so that the dependencies between modules can be kept acyclic and under control.</p>
</div>
<div class="sect4">
<h5 id="_example">Example</h5>
<div class="paragraph">
<p>This is probably best explained by way of an example.  Suppose we have the <code>Customer</code> domain object which implements
a <code>DocumentHolder</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> <span class="directive">implements</span> DocumentHolder {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We could then imagine a mixin that would contribute behaviour to list, add and remove the <code>Document</code>s for this holder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Mixin</span>                                                          <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">DocumentHolder_documents</span> {
    <span class="directive">private</span> <span class="directive">final</span> DocumentHolder holder;
    <span class="directive">public</span> DocumentHolder_documents(DocumentHolder holder) {    <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="local-variable">this</span>.holder = holder;
    }
    <span class="annotation">@Action</span>(semantics=SemanticsOf.SAFE)
    <span class="annotation">@ActionLayout</span>(contributed = Contributed.AS_ASSOCIATION)
    <span class="annotation">@CollectionLayout</span>(render = RenderType.EAGERLY)
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Document</span>&gt; documents() {
        ...                                                     <i class="conum" data-value="3"></i><b>(3)</b>
    }
    <span class="annotation">@Action</span>(semantics=SemanticsOf.IDEMPOTENT)
    <span class="directive">public</span> DocumentHolder add(<span class="predefined-type">Document</span> document) {
        ...                                                     <i class="conum" data-value="4"></i><b>(4)</b>
    }
    <span class="annotation">@Action</span>(semantics=SemanticsOf.IDEMPOTENT)
    <span class="directive">public</span> DocumentHolder remove(<span class="predefined-type">Document</span> document) {
        ...                                                     <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>alternatively can use <code>@DomainObject(nature=Nature.MIXIN)</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>constructor indicates the type that is contributed to</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>implementation could, for example, use the (non-ASF)
<a href="http://github.com/isisaddons/isis-module-poly">Isis addons' poly</a> module.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>implementation would probably delegate to an injected repository to (ultimately) insert data into some table</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>implementation would probably delegate to an injected repository to (ultimately) delete data from some table</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example also omits any supporting methods, eg <code>hideXxx()</code>, <code>disableXxx()</code>, <code>validateXxx()</code>, etc.</p>
</div>
<div class="paragraph">
<p>In the user interface the "documents" collection, the "add" and the "delete" actions will appear to be part of
<code>Customer</code>.  In essence the framework constructs a composite UI from the parts of multiple objects.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The (non-ASF) <a href="http://github.com/incodehq/incode-module-note">Incode note</a> and
<a href="http://github.com/incodehq/incode-module-commchannel">Incode commchannel</a> modules are real-world examples that use this
technique throughout.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_contributing_a_single_member">Contributing a single member</h5>
<div class="paragraph">
<p>The mixin can contribute as much or as little behaviour as makes sense.  For example, in the example above it might be
that <code>Document</code>s are created through some other mechanism (eg scanned) and are never deleted.  In that case, the
mixin might be simply:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Mixin</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">DocumentHolder_documents</span> {
    ..
    public <span class="predefined-type">List</span>&lt;<span class="predefined-type">Document</span>&gt; documents() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the case where there is only a single member being contributed, the special name "__" (that is, two underscores)
can be used instead.  In this case, the contributee member&#8217;s name will be inferred from the mixin&#8217;s class name.  If the
class name itself contains an underscore, then the last part of the class name will be used.</p>
</div>
<div class="paragraph">
<p>Thus, for a mixin whose class name is <code>DocumentHolder_documents</code>, the effective member name is <code>documents</code>.  We could
therefore rewrite the mixin as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Mixin</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">DocumentHolder_documents</span> {
    ..
    public <span class="predefined-type">List</span>&lt;<span class="predefined-type">Document</span>&gt; __() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The benefit of this is marginal unless there are supporting methods, in which case the removal of boilerplate is welcome:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Mixin</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">DocumentHolder_documents</span> {
    ..
    public <span class="predefined-type">List</span>&lt;<span class="predefined-type">Document</span>&gt; __() { ... }
    <span class="directive">public</span> <span class="type">boolean</span> hide__() { ... }
    <span class="directive">public</span> <span class="predefined-type">String</span> disable__() { ... }
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_programmatic_usage">Programmatic usage</h5>
<div class="paragraph">
<p>When a domain object is rendered, the framework will automatically instantiate all required mixins and delegate to them
dynamically.  If writing integration tests or fixtures, or (sometimes) just regular domain logic, then you may need to
instantiate mixins directly.</p>
</div>
<div class="paragraph">
<p>For this you can use the
xref:rg.adoc#_rg_services-api_manpage-DomainObjectContainer_object-creation-api[<code>DomainObjectContainer#mixin(&#8230;&#8203;)</code>
method.  For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">DocumentHolder_documents mixin = container.mixin(DocumentHolder_documents.class, customer);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="#_ug_testing_integ-test-support_bootstrapping_IntegrationTestAbstract"><code>IntegrationTestAbstract</code></a> and
<a href="rg.html#_rg_classes_super_manpage-FixtureScript"><code>FixtureScript</code></a> classes both provide a <code>mixin(&#8230;&#8203;)</code> convenience
method.</p>
</div>
</div>
<div class="sect4">
<h5 id="_other_reasons_to_use_mixins">Other reasons to use mixins</h5>
<div class="paragraph">
<p>In the introduction to this topic we mentioned that mixins are most useful for ensuring that the domain app remains
decoupled.  This applies to the case where the contributee (eg <code>Customer</code>, being mixed into) is in one module, while
the contributor mixin (<code>DocumentHolder_documents</code>) is in some other module.  The <code>customer</code> module knows about the
<code>document</code> module, but not vice versa.</p>
</div>
<div class="paragraph">
<p>However, you might also want to consider moving behaviour out of entities even within the same module, perhaps even
within the same Java package.  And the reason for this is to support hot-reloading of Java classes, so that you can
modify and recompile your application without having to restart it.  This can provide substantial productivity gains.</p>
</div>
<div class="paragraph">
<p>The Hotspot JVM has limited support for hot reloading; generally you can change method implementations but you cannot
introduce new methods.  However, the <a href="https://dcevm.github.io/">DCEVM</a> open source project will patch the JVM to
support much more complete hot reloading support.  There are also, of course, commercial products such as JRebel.</p>
</div>
<div class="paragraph">
<p>The main snag in all this is the DataNucleus enhancer&#8230;&#8203; any change to entities is going to require the entity to be
re-enhanced, and the JDO metamodel recreated, which usually "stuffs things up".  So hot-reloading of an app whose
fundamental structure is changing is likely to remain a no-no.</p>
</div>
<div class="paragraph">
<p>However, chances are that the structure of your domain objects (the data) will change much less rapidly than
the behaviour of those domain objects.  Thus, it&#8217;s the behaviour that you&#8217;re most likely wanting to change while the
app is still running.  If you move that behaviour out into mixins (or
<a href="#_ug_more-advanced_decoupling_contributions">contributed services</a>), then these can be reloaded happily.
(When running in prototype mode), Apache Isis will automatically recreate the portion of the metamodel for any domain
object as it is rendered.</p>
</div>
</div>
<div class="sect4">
<h5 id="_related_reading">Related reading</h5>
<div class="paragraph">
<p>Mixins are an implementation of the <a href="http://www.artima.com/articles/dci_vision.html">DCI architecture</a> architecture, as formulated and described by <a href="https://en.wikipedia.org/wiki/Trygve_Reenskaug">Trygve Reenskaug</a> and <a href="https://en.wikipedia.org/wiki/Jim_Coplien">Jim Coplien</a>.  Reenskaug was the inventor of the MVC pattern (and also the external
examiner for Richard Pawson&#8217;s PhD thesis), while Coplien has a long history in object-orientation, C++ and patterns.</p>
</div>
<div class="paragraph">
<p>DCI stands for Data-Context-Interaction and is presented as an evolution of object-oriented programming, but one where
behaviour is bound to objects dynamically rather than statically in some context or other.  The <code>@Mixin</code>
pattern is Apache Isis' straightforward take on the same basic concept.</p>
</div>
<div class="paragraph">
<p>You might also wish to check out <a href="http://zest.apache.org">Apache Zest</a> (formerly Qi4J), which implements a much more
general purpose implementation of the same concepts.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_more-advanced_decoupling_contributions">4.1.3. Contributions</h4>
<div class="paragraph">
<p>Contributed services provide many of the same benefits as <a href="#_ug_more-advanced_decoupling_mixins">mixins</a>;
indeed mixins (<code>1.10.0-SNAPSHOT</code>) are an evolution and refinement of the contributions concept.</p>
</div>
<div class="paragraph">
<p>The main difference between contributed services and mixins is that the actions of a contributed service will
contribute to <em>all</em> the parameters of its actions, whereas a mixin only contributes to the type accepted in its
constructor.  Also, contributed services are long-lived
singletons, whereas mixins are instantiated as required (by the framework) and then discarded almost immediately.</p>
</div>
<div class="paragraph">
<p>For more on contributed services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the syntax of writing contributed actions/properties/collections is described in this <a href="#_ug_how-tos_contributed-members">how-to</a></p>
</li>
<li>
<p>there&#8217;s also useful information in the reference guide, discussing the <a href="rg.html#_rg_annotations_manpage-DomainService_nature">@DomainService#nature()</a> attribute, for the <code>NatureOfService.VIEW_CONTRIBUTIONS_ONLY</code> nature.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ug_more-advanced_decoupling_vetoing-visibility">4.1.4. Vetoing Visibility</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - a write-up of the "vetoing subscriber" design pattern, eg as described in the  <a href="rg.html#_rg_services-api_manpage-BookmarkService"><code>BookmarkService</code></a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>eg if included an addon such as auditing or security.</p>
</div>
<div class="paragraph">
<p>solution is to write a domain event subscriber that vetoes the visibility</p>
</div>
<div class="paragraph">
<p>All the addons actions inherit from common base classes so this can be as broad-brush or fine-grained as required</p>
</div>
</div>
<div class="sect3">
<h4 id="_ug_more-advanced_decoupling_event-bus">4.1.5. Event Bus</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - see <a href="rg.html#_rg_services-api_manpage-EventBusService"><code>EventBusService</code></a>, <a href="rg.html#_rg_annotations_manpage-Action_domainEvent"><code>@Action#domainEvent()</code></a>, <a href="rg.html#_rg_annotations_manpage-Property_domainEvent"><code>@Property#domainEvent()</code></a>, <a href="rg.html#_rg_annotations_manpage-Collection_domainEvent"><code>@Collection#domainEvent()</code></a>, <a href="rg.html#_rg_services-api_manpage-WrapperFactory"><code>WrapperFactory</code></a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ug_more-advanced_decoupling_pushing-changes">4.1.6. Pushing Changes</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This technique is much less powerful than using <a href="#_ug_more-advanced_decoupling_event-bus">the event bus</a> .  We present it mostly for completeness.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_when_a_property_is_changed">When a property is changed</h5>
<div class="paragraph">
<p>If you want to invoke functionality whenever a property is changed by the user, then you should create a supporting <code>modifyXxx()</code> method and include the functionality within that. The syntax is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> modifyPropertyName(PropertyType param) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Why not just put this functionality in the setter? Well, the setter is used by the object store to recreate the state of an already persisted object. Putting additional behaviour in the setter would cause it to be triggered incorrectly.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Order</span>() {
    <span class="directive">public</span> <span class="predefined-type">Integer</span> getAmount() { ... }
    <span class="directive">public</span> <span class="type">void</span> setAmount(<span class="predefined-type">Integer</span> amount) { ... }
    <span class="directive">public</span> <span class="type">void</span> modifyAmount(<span class="predefined-type">Integer</span> amount) { <i class="conum" data-value="1"></i><b>(1)</b>
        setAmount(amount);  <i class="conum" data-value="3"></i><b>(3)</b>
        addToTotal(amount); <i class="conum" data-value="2"></i><b>(2)</b>
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>modifyAmount()</code> method calls &#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>&#8230;&#8203; the <code>addToTotal()</code> (not shown) to maintain some running total.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We don&#8217;t want this <code>addToCall()</code> method to be called when pulling the object back from the object store, so we put it into the modify, not the setter.</p>
</div>
<div class="paragraph">
<p>You may optionally also specify a <code>clearXxx()</code> which works the same way as modify <code>modify Xxx()</code> but is called when the property is cleared by the user (i.e. the current value replaced by nothing). The syntax is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> clearPropertyName() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>To extend the above example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Order</span>() {
    <span class="directive">public</span> <span class="predefined-type">Integer</span> getAmount() { ... }
    <span class="directive">public</span> <span class="type">void</span> setAmount(<span class="predefined-type">Integer</span> amount) { ... }
    <span class="directive">public</span> <span class="type">void</span> modifyAmount(<span class="predefined-type">Integer</span> amount) { ... }
    <span class="directive">public</span> <span class="type">void</span> clearAmount() {
        removeFromTotal(<span class="local-variable">this</span>.amount);
        setAmount(<span class="predefined-constant">null</span>);
    }
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_when_a_collection_is_modified">When a collection is modified</h5>
<div class="paragraph">
<p>A collection may have a corresponding <code>addToXxx()</code> and/or
<code>removeFromXxx()</code> method. If present, and direct manipulation of the
contents of the connection has not been disabled (see ?), then they will
be called (instead of adding/removing an object directly to the
collection returned by the accessor).</p>
</div>
<div class="paragraph">
<p>The reason for this behaviour is to allow other behaviour to be
triggered when the contents of the collection is altered. That is, it is
directly equivalent to the supporting <code>modifyXxx()</code> and <code>clearXxx()</code>
methods for properties (see ?).</p>
</div>
<div class="paragraph">
<p>The syntax is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> addTo&lt;CollectionName&gt;(EntityType param) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> removeFromCollectionName(EntityType param) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>EntityType</code> is the same type as the generic collection type.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> { ... }

<span class="directive">public</span> <span class="type">class</span> <span class="class">Department</span> {

    <span class="directive">private</span> <span class="type">int</span> numMaleEmployees;                           <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">private</span> <span class="type">int</span> numFemaleEmployees;                         <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="directive">private</span> <span class="predefined-type">Set</span>&lt;Employee&gt; employees = <span class="keyword">new</span> <span class="predefined-type">TreeSet</span>&lt;Employee&gt;();
    <span class="directive">public</span> <span class="predefined-type">Set</span>&lt;Employee&gt; getEmployees() {
        <span class="keyword">return</span> employees;
    }
    <span class="directive">private</span> <span class="type">void</span> setEmployees(<span class="predefined-type">Set</span>&lt;Employee&gt; employees) {
        <span class="local-variable">this</span>.employees = employees;
    }
    <span class="directive">public</span> <span class="type">void</span> addToEmployees(Employee employee) {         <i class="conum" data-value="3"></i><b>(3)</b>
        numMaleEmployees += countOneMale(employee);
        numFemaleEmployees += countOneFemale(employee);
        employees.add(employee);
    }
    <span class="directive">public</span> <span class="type">void</span> removeFromEmployees(Employee employee) {    <i class="conum" data-value="4"></i><b>(4)</b>
        numMaleEmployees -= countOneMale(employee);
        numFemaleEmployees -= countOneFemale(employee);
        employees.remove(employee);
    }
    <span class="directive">private</span> <span class="type">int</span> countOneMale(Employee employee) { <span class="keyword">return</span> employee.isMale()?<span class="integer">1</span>:<span class="integer">0</span>; }
    <span class="directive">private</span> <span class="type">int</span> countOneFemale(Employee employee) { <span class="keyword">return</span> employee.isFemale()?<span class="integer">1</span>:<span class="integer">0</span>; }

    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>maintain a count of the number of male &#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>&#8230;&#8203; and female employees (getters and setters omitted)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the <a href="rg.html#_rg_methods_prefixes_manpage-addTo"><code>addTo&#8230;&#8203;()</code></a> method increments the derived properties</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the <a href="rg.html#_rg_methods_prefixes_manpage-removeFrom"><code>removeFrom&#8230;&#8203;()</code></a> method similarly decrements the derived properties</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_more-advanced_overriding-jdo-annotations">4.2. Overriding JDO Annotations</h3>
<div class="paragraph">
<p>The JDO Objectstore (or rather, the underlying DataNucleus implementation) builds its own persistence metamodel by reading both annotations on the class and also by searching for metadata in XML files. The metadata in the XML files takes precedence over the annotations, and so can be used to override metadata that is "hard-coded" in annotations.</p>
</div>
<div class="paragraph">
<p>For example, as of 1.9.0 the various <a href="http://www.isisaddons.org">Isis addons</a> modules (not ASF) use schemas for each entity. For example, the <code>AuditEntry</code> entity in the <a href="http://github.com/isisaddons/isis-module-audit">audit module</a> is annotated as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.jdo.annotations.PersistenceCapable(
        identityType=IdentityType.DATASTORE,
        schema = <span class="string"><span class="delimiter">&quot;</span><span class="content">IsisAddonsAudit</span><span class="delimiter">&quot;</span></span>,
        table=<span class="string"><span class="delimiter">&quot;</span><span class="content">AuditEntry</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AuditEntry</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will map the <code>AuditEntry</code> class to a table <code>&quot;IsisAddonsAudit&quot;.&quot;AuditEntry&quot;</code>; that is using a custom schema to own the object.</p>
</div>
<div class="paragraph">
<p>Suppose though that for whatever reason we didn&#8217;t want to use a custom schema but would rather use the default. We can override the above annotation using a <code>package.jdo</code> file, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="tag">&lt;jdo</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/jdo/jdo</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/jdo/jdo</span>
        <span class="content">http://xmlns.jcp.org/xml/ns/jdo/jdo_3_0.xsd</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;package</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.isisaddons.module.audit.dom</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;class</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">AuditEntry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">schema</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PUBLIC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">table</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">IsisAddonsAuditEntry</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;/class&gt;</span>
    <span class="tag">&lt;/package&gt;</span>
<span class="tag">&lt;/jdo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This file should be placed can be placed in <code>src/main/java/META-INF</code> within your application&#8217;s <code>dom</code> module.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The same approach should work for any other JDO metadata, but some experimentation might be required.+</p>
<div class="paragraph">
<p>For example, in writing up the above example we found that writing <code>schema=&quot;&quot;</code> (in an attempt to say, "use the default schema for this table") actually caused the original annotation value to be used instead.</p>
</div>
</li>
<li>
<p>Forcing the schema to "PUBLIC" (as in the above example) works, but it isn&#8217;t ideal because the name "PUBLIC" is not vendor-neutral (it works for HSQLDB, but MS SQL Server uses "dbo" as its default).</p>
</li>
<li>
<p>As of 1.9.0 Apache Isis will automatically (attempt) to create the owning schema for a given table if it does not exist. This behaviour can be customized, as described in the section on <a href="#_ug_more-advanced_decoupling_db-schemas">using modules</a>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ug_more-advanced_bulk-actions">4.3. Bulk Actions</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_annotations_manpage-Action_invokeOn"><code>@Action#invokeOn()</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ug_more-advanced_view-models">4.4. View Models</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_annotations_manpage-ViewModel"><code>@ViewModel</code></a>, <a href="rg.html#_rg_classes_super_manpage-AbstractViewModel"><code>AbstractViewModel</code></a>, <a href="rg.html#_rg_annotations_manpage-DomainObject_nature"><code>@DomainObject#nature()</code></a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Nature of view models</p>
</div>
<div class="ulist">
<ul>
<li>
<p>inmemory-entity</p>
</li>
<li>
<p>external_entity</p>
</li>
<li>
<p>application layer</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Consumers of view models</p>
</div>
<div class="ulist">
<ul>
<li>
<p>within the Wicket viewer</p>
</li>
<li>
<p>within the REST viewer, as an external client consuming a stable API</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An alternative to using view models is to map the domain object using the <a href="rg.html#_rg_services-spi_manpage-ContentMappingService"><code>ContentMappingService</code></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ug_more-advanced_mapping-rdbms-views">4.5. Mapping RDBMS Views</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - as used in <a href="http://github.com/estatio/estatio">Estatio</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ug_more-advanced_transactions-and-errors">4.6. Transactions and Errors</h3>
<div class="paragraph">
<p>In Apache Isis, every action invocation (in fact, every interaction) is automatically wrapped in a transaction, and any repository query automatically does a flush.</p>
</div>
<div class="paragraph">
<p>What that means is that there&#8217;s no need to explicitly start or commit transactions in Apache Isis; this will be done for you. Indeed, if you do try to manage transactions (eg by reaching into the JDO <code>PersistenceManager</code> exposed by the <a href="rg.html#_rg_services-api_manpage-IsisJdoSupport">IsisJdoSupport</a> domain service, then you are likely to confuse Isis and get a stack trace for your trouble.</p>
</div>
<div class="sect3">
<h4 id="_aborting_transactions">4.6.1. Aborting Transactions</h4>
<div class="paragraph">
<p>If you want to abort Apache Isis' transaction, this can be done by throwing <code>RecoverableException</code> (or any subclass, eg <code>ApplicationException</code>). The transaction will be aborted, and the exception message will be displayed to the user.</p>
</div>
<div class="paragraph">
<p>If you throw any other exception (ie not a subclass of <code>RecoverableException</code>), then the users will see an error page (if Wicket viewer) or a 500 (if Restful Objects viewer).</p>
</div>
</div>
<div class="sect3">
<h4 id="_raise_message_errors_to_users">4.6.2. Raise message/errors to users</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_services-api_manpage-DomainObjectContainer_messages-api"><code>DomainObjectContainer</code></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_exception_recognizers">4.6.3. Exception Recognizers</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - <a href="rg.html#_rg_services-spi_manpage-ExceptionRecognizer"><code>ExceptionRecognizer</code></a> service
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_more-advanced_i18n">4.7. i18n</h3>
<div class="paragraph">
<p>Apache Isis' support for i18n allows every element of the domain model (the class names, property names, action names, parameter names and so forth) to be translated.</p>
</div>
<div class="paragraph">
<p>It also supports translations of messages raised imperatively, by which we mean as the result of a call to <code>title()</code> to obtain an object&#8217;s title, or messages resulting from any business rule violations (eg <a href="rg.html#_rg_methods_prefixes_manpage-disable"><code>disable&#8230;&#8203;()</code></a> or <a href="rg.html#_rg_methods_prefixes_manpage-validate"><code>validate&#8230;&#8203;()</code></a>, and so on.</p>
</div>
<div class="paragraph">
<p>Isis does not translate the values of your domain objects, though.  So, if you have a domain concept such as <code>Country</code> whose name is intended to be localized according to the current user, you will need to model</p>
</div>
<div class="sect3">
<h4 id="_implementation_approach">4.7.1. Implementation Approach</h4>
<div class="paragraph">
<p>Most Java frameworks tackle i18n by using Java&#8217;s own <code>ResourceBundle</code> API.  However, there are some serious drawbacks in this approach, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if a string appears more than once (eg "name" or "description") then it must be translated everywhere it appears in every resource bundle file</p>
</li>
<li>
<p>there is no support for plural forms (see this <a href="http://stackoverflow.com/questions/14326653/java-internationalization-i18n-with-proper-plurals/14327683#14327683">SO answer</a>)</p>
</li>
<li>
<p>there is no tooling support for translators</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Apache Isis therefore takes a different approach, drawing inspiration from GNU&#8217;s <a href="https://www.gnu.org/software/gettext/manual/index.html">gettext</a> API and specifically its <code>.pot</code> and <code>.po</code> files.  These are intended to be used as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>.pot</code> (portable object template) file holds the message text to be translated</p>
</li>
<li>
<p>this file is translated into multiple <code>.po</code> (portable object) files, one per supported locale</p>
</li>
<li>
<p>these <code>.po</code> files are renamed according to their locale, and placed into the 'appropriate' location to be picked up by the runtime.  The name of each <code>.po</code> resolved in a very similar way to resource bundles.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>.pot</code> and <code>.po</code> files is identical; the only difference is that the <code>.po</code> file has translations for each of the message strings.   These message strings can also have singular and plural forms.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Although Apache Isis' implementation is modelled after GNU&#8217;s API, it does <em>not</em> use any GNU software.  This is for two reasons: (a) to simplify the toolchain/developer experience, and (b) because GNU software is usually GPL, which would be incompatible with the Apache license).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This design tackles all the issues of <code>ResourceBundle</code>s:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>.po</code> message format is such that any given message text to translate need only be translated once, even if it appears in multiple places in the application (eg "Name")</p>
</li>
<li>
<p>the <code>.po</code> message format includes translations for (optional) plural form as well as singular form</p>
</li>
<li>
<p>there are lots of freely available editors <a href="https://www.google.co.uk/search?q=.po+file+editor">to be found</a>, many summarized on this <a href="https://www.drupal.org/node/11131">Drupal.org</a> webpage.<br></p>
<div class="paragraph">
<p>In fact, there are also online communities/platforms of translators to assist with translating files. One such is <a href="https://crowdin.com/">crowdin</a> (nb: this link does not imply endorsement).</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In Apache Isis' implementation, if the translation is missing from the <code>.po</code> file then the original message text from the <code>.pot</code> file will be returned.  In fact, it isn&#8217;t even necessary for there to be any <code>.po</code> files; <code>.po</code> translations can be added piecemeal as the need arises.</p>
</div>
</div>
<div class="sect3">
<h4 id="__code_translationservice_code">4.7.2. <code>TranslationService</code></h4>
<div class="paragraph">
<p>The cornerstone of Apache Isis' support for i18n is the <code>TranslationService</code> service. This is defined in the applib with the following API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">TranslationService</span> {
    <span class="directive">public</span> <span class="predefined-type">String</span> translate(      <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="directive">final</span> <span class="predefined-type">String</span> context,
            <span class="directive">final</span> <span class="predefined-type">String</span> text);
    <span class="directive">public</span> <span class="predefined-type">String</span> translate(      <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="directive">final</span> <span class="predefined-type">String</span> context,
            <span class="directive">final</span> <span class="predefined-type">String</span> singularText,
            <span class="directive">final</span> <span class="predefined-type">String</span> pluralText,
            <span class="directive">final</span> <span class="type">int</span> num);
    <span class="directive">public</span> <span class="type">enum</span> Mode {
        READ,
        WRITE;
    }
    Mode getMode();               <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>is to translate the singular form of the text</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>is to translate the plural form of the text</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>indicates whether the translation service is in read or write mode.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>translate(&#8230;&#8203;)</code> methods are closely modelled on GNU&#8217;s gettext API.  The first version is used when no translation is required, the second is when both a singular and plural form will be required, with the <code>num</code> parameter being used to select which is returned.  In both cases the <code>context</code> parameter provides some contextual information for the translator; this generally corresponds to the class member.</p>
</div>
<div class="paragraph">
<p>The mode meanwhile determines the behaviour of the service.  More on this below.</p>
</div>
<div class="sect4">
<h5 id="__code_translationservicepo_code"><code>TranslationServicePo</code></h5>
<div class="paragraph">
<p>Isis provides a default implementation of <code>TranslationService</code>, namely <code>TranslationServicePo</code>.</p>
</div>
<div class="paragraph">
<p>If the service is running in the normal read mode, then it simply provides translations for the locale of the current user.  This means locates the appropriate <code>.po</code> file (based on the requesting user&#8217;s locale), finds the translation and returns it.</p>
</div>
<div class="paragraph">
<p>If however the service is configured to run in write mode, then it instead records the fact that the message was requested to be translated (a little like a spy/mock in unit testing mock), and returns the original message. The service can then be queried to discover which messages need to be translated.  All requested translations are written into the <code>.pot</code> file.</p>
</div>
<div class="paragraph">
<p>To make the service as convenient as possible to use, the service configures itself as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if running in prototype mode <a href="rg.html#_rg_runtime_deployment-types">deployment type</a> or during integration tests, then the service runs in <strong>write</strong> mode, in which case it records all translations into the <code>.pot</code> file.  The <code>.pot</code> file is written out when the system is shutdown.</p>
</li>
<li>
<p>if running in server (production) mode <a href="rg.html#_rg_runtime_deployment-types">deployment type</a>, then the service runs in <strong>read</strong> mode. It is also possible to set a configuration setting in <code>isis.properties</code> to force read mode even if running in prototype mode (useful to manually test/demo the translations).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When running in write mode the original text is returned to the caller untranslated. If in read mode, then the translated <code>.po</code> files are read and translations provided as required.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_imperative_messages">4.7.3. Imperative messages</h4>
<div class="paragraph">
<p>The <code>TranslationService</code> is used internally by Apache Isis when building up the metamodel; the name and description of every class, property, collection, action and action parameter is automatically translated.  Thus the simple act of bootstrapping Apache Isis will cause most of the messages requiring translation (that is: those for the Apache Isis metamodel) to be captured by the <code>TranslationService</code>.</p>
</div>
<div class="paragraph">
<p>However, for an application to be fully internationalized, any validation messages (from either <code>disableXxx()</code> or <code>validateXxx()</code> supporting methods) and also possibly an object&#8217;s title (from the <code>title()</code> method) will also require translation. Moreover, these messages must be captured in the <code>.pot</code> file such that they can be translated.</p>
</div>
<div class="sect4">
<h5 id="__code_translatablestring_code"><code>TranslatableString</code></h5>
<div class="paragraph">
<p>The first part of the puzzle is tackled by an extension to Apache Isis' programming model.  Whereas previously the <code>disableXxx()</code> / <code>validateXxx()</code> / <code>title()</code> methods could only return a <code>java.lang.String</code>, they may now optionally return a <code>TranslatableString</code> (defined in Isis applib) instead.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a (silly) example from the <a href="#_ug_getting-started_simpleapp-archetype">SimpleApp archetype</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> TranslatableString validateUpdateName(<span class="directive">final</span> <span class="predefined-type">String</span> name) {
    <span class="keyword">return</span> name.contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">!</span><span class="delimiter">&quot;</span></span>)? TranslatableString.tr(<span class="string"><span class="delimiter">&quot;</span><span class="content">Exclamation mark is not allowed</span><span class="delimiter">&quot;</span></span>): <span class="predefined-constant">null</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This corresponds to the following entry in the <code>.pot</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">#: dom.simple.SimpleObject#updateName()
msgid &quot;Exclamation mark is not allowed&quot;
msgstr &quot;&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The full API of <code>TranslatableString</code> is modelled on the design of GNU gettext (in particular the <a href="https://code.google.com/p/gettext-commons/wiki/Tutorial">gettext-commons</a> library):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">TranslatableString</span> {
    <span class="directive">public</span> <span class="directive">static</span> TranslatableString tr(       <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="directive">final</span> <span class="predefined-type">String</span> pattern,
            <span class="directive">final</span> <span class="predefined-type">Object</span>... paramArgs) { ... }
    <span class="directive">public</span> <span class="directive">static</span> TranslatableString trn(      <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="directive">final</span> <span class="predefined-type">String</span> singularPattern,
            <span class="directive">final</span> <span class="predefined-type">String</span> pluralPattern,
            <span class="directive">final</span> <span class="type">int</span> number,
            <span class="directive">final</span> <span class="predefined-type">Object</span>... paramArgs) { ... }
    <span class="directive">public</span> <span class="predefined-type">String</span> translate(                   <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="directive">final</span> TranslationService translationService,
            <span class="directive">final</span> <span class="predefined-type">String</span> context) { ... }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>returns a translatable string with a single pattern for both singular and plural forms.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>returns a translatable string with different patterns for singular and plural forms; the one to use is determined by the 'number' argument</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>translates the string using the provided <code>TranslationService</code>, using the appropriate singular/regular or plural form, and interpolating any arguments.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The interpolation uses the format <code>{xxx}</code>, where the placeholder can occur multiple times.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> TranslatableString ts = TranslatableString.tr(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">My name is {lastName}, {firstName} {lastName}.</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bond</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">James</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>would interpolate (for the English locale) as "My name is Bond, James Bond".</p>
</div>
<div class="paragraph">
<p>For a German user, on the other hand, if the translation in the corresponding <code>.po</code> file was:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">#: xxx.yyy.Whatever#context()
msgid &quot;My name is {lastName}, {firstName} {lastName}.&quot;
msgstr &quot;Iche heisse {firstName} {lastName}.&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>then the translation would be: "Ich heisse James Bond".</p>
</div>
<div class="paragraph">
<p>The same class is used in <a href="rg.html#_rg_services-api_manpage-DomainObjectContainer"><code>DomainObjectContainer</code></a> so that you can raise translatable info, warning and error messages; each of the relevant methods are overloaded.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">DomainObjectContainer</span> {
    <span class="type">void</span> informUser(<span class="predefined-type">String</span> message);
    <span class="type">void</span> informUser(
        TranslatableMessage message,
        <span class="directive">final</span> <span class="predefined-type">Class</span>&lt;?&gt; contextClass, <span class="directive">final</span> <span class="predefined-type">String</span> contextMethod); <i class="conum" data-value="1"></i><b>(1)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>are concatenated together to form the context for the <code>.pot</code> file.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="__code_translatableexception_code"><code>TranslatableException</code></h5>
<div class="paragraph">
<p>Another mechanism by which messages can be rendered to the user are as the result of exception messages thrown and recognized by an <a href="rg.html#_rg_services-spi_manpage-ExceptionRecognizer"><code>ExceptionRecognizer</code></a>.</p>
</div>
<div class="paragraph">
<p>In this case, if the exception implements <code>TranslatableException</code>, then the message will automatically be translated before being rendered.  The <code>TranslatableException</code> itself takes the form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">TranslatableException</span> {
    TranslatableString getTranslatableMessage(); <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="predefined-type">String</span> getTranslationContext();              <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the message to translate.  If returns <code>null</code>, then the <code>Exception#getMessage()</code> is used as a fallback</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the context to use when translating the message</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_integration_testing">4.7.4. Integration Testing</h4>
<div class="paragraph">
<p>So much for the API; but as noted, it is also necessary to ensure that the required translations are recorded (by the <code>TranslationService</code>) into the <code>.pot</code> file.</p>
</div>
<div class="paragraph">
<p>For this, we recommend that you ensure that all such methods are tested through an <a href="#_ug_testing_integ-test-support">integration test</a> (not unit test).</p>
</div>
<div class="paragraph">
<p>For example, here&#8217;s the corresponding integration test for the "Exclamation mark" example from the simpleapp (above):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Rule</span>
<span class="directive">public</span> ExpectedException expectedException = ExpectedException.none();

<span class="annotation">@Inject</span>
FixtureScripts fixtureScripts;

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> failsValidation() <span class="directive">throws</span> <span class="exception">Exception</span> {
    <span class="comment">// given</span>
    RecreateSimpleObjects fs = <span class="keyword">new</span> RecreateSimpleObjects().setNumber(<span class="integer">1</span>);
    fixtureScripts.runFixtureScript(fs, <span class="predefined-constant">null</span>);
    SimpleObject simpleObjectWrapped = wrap(fs.getSimpleObjects().get(<span class="integer">0</span>));

    <span class="comment">// expect</span>
    expectedExceptions.expect(InvalidException.class);
    expectedExceptions.expectMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Exclamation mark is not allowed</span><span class="delimiter">&quot;</span></span>);

    <span class="comment">// when</span>
    simpleObjectWrapped.updateName(<span class="string"><span class="delimiter">&quot;</span><span class="content">new name!</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Running this test will result in the framework calling the <code>validateUpdateName(&#8230;&#8203;)</code> method, and thus to record that a translation is required in the <code>.pot</code> file.</p>
</div>
<div class="paragraph">
<p>When the integration tests are complete (that is, when Apache Isis is shutdown), the <code>TranslationServicePo</code> will write out all captured translations to its log (more on this below). This will include all the translations captured from the Apache Isis metamodel, along with all translations as exercised by the integration tests.</p>
</div>
<div class="paragraph">
<p>To ensure your app is fully internationalized app, you must therefore:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>use <code>TranslatableString</code> rather than <code>String</code> for all validation/disable and title methods.</p>
</li>
<li>
<p>ensure that (at a minimum) all validation messages and title methods are integration tested.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We make no apologies for this requirement: one of the reasons that we decided to implement Apache Isis' i18n support in this way is because it encourages/requires the app to be properly tested.</p>
</div>
<div class="paragraph">
<p>Behind the scenes Apache Isis uses a JUnit rule (<code>ExceptionRecognizerTranslate</code>) to intercept any exceptions that are thrown.  These are simply passed through to the registered <a href="rg.html#_rg_services-spi_manpage-ExceptionRecognizer"><code>ExceptionRecognizer</code></a>s so that any messages are recorded as requiring translation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_configuration">4.7.5. Configuration</h4>
<div class="paragraph">
<p>There are several different aspects of the translation service that can be configured.</p>
</div>
<div class="sect4">
<h5 id="_logging">Logging</h5>
<div class="paragraph">
<p>To configure the <code>TranslationServicePo</code> to write to out the <code>translations.pot</code> file, add the following to the <em>integtests</em> <code>logging.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">log4j.appender.translations-po=org.apache.log4j.FileAppender
log4j.appender.translations-po.File=./translations.pot
log4j.appender.translations-po.Append=false
log4j.appender.translations-po.layout=org.apache.log4j.PatternLayout
log4j.appender.translations-po.layout.ConversionPattern=%m%n

log4j.logger.org.apache.isis.core.runtime.services.i18n.po.PoWriter=INFO,translations-po
log4j.additivity.org.apache.isis.core.runtime.services.i18n.po.PotWriter=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just to repeat, this is <em>not</em> the <code>WEB-INF/logging.properties</code> file, it should instead be added to the <code>integtests/logging.properties</code> file.</p>
</div>
</div>
<div class="sect4">
<h5 id="_location_of_the_code_po_code_files">Location of the <code>.po</code> files</h5>
<div class="paragraph">
<p>The default location of the translated <code>.po</code> files is in the <code>WEB-INF</code> directory. These are named and searched for similarly to regular Java resource bundles.</p>
</div>
<div class="paragraph">
<p>For example, assuming these translations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">/WEB-INF/translations-en-US.po
        /translations-en.po
        /translations-fr-FR.po
        /translations.po</code></pre>
</div>
</div>
<div class="paragraph">
<p>then:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a user with <code>en-US</code> locale will use <code>translations-en-US.po</code></p>
</li>
<li>
<p>a user with <code>en-GB</code> locale will use <code>translations-en.po</code></p>
</li>
<li>
<p>a user with <code>fr-FR</code> locale will use <code>translations-fr-FR.po</code></p>
</li>
<li>
<p>a user with <code>fr-CA</code> locale will use <code>translations.po</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The basename for translation files is always <code>translations</code>; this cannot be altered.</p>
</div>
</div>
<div class="sect4">
<h5 id="_externalized_translation_files">Externalized translation files</h5>
<div class="paragraph">
<p>Normally Apache Isis configuration files are read from the <code>WEB-INF</code> file. However, Apache Isis can be configured to read config files from an <a href="#_ug_deployment_externalized-configuration">external directory</a>; this is also supported for translations.</p>
</div>
<div class="paragraph">
<p>Thus, if in <code>web.xml</code> the external configuration directory has been set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>isis.config.dir<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>location of external config directory<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then this directory will be used as the base for searching for translations (rather than the default 'WEB-INF/' directory).</p>
</div>
</div>
<div class="sect4">
<h5 id="_force_read_mode">Force read mode</h5>
<div class="paragraph">
<p>As noted above, if running in prototype mode then <code>TranslationServicePo</code> will be in write mode, if in production mode then will be in read mode. To force read mode (ie use translations) even if in prototype mode, add the following configuration property to <code>isis.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services.translation.po.mode=read</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_supporting_services">4.7.6. Supporting services</h4>
<div class="paragraph">
<p>The <code>TranslationServicePo</code> has a number of supporting/related services.</p>
</div>
<div class="sect4">
<h5 id="__code_localeprovider_code"><code>LocaleProvider</code></h5>
<div class="paragraph">
<p>The <code>LocaleProvider</code> API is used by the <code>TranslationServicePo</code> implementation to obtain the locale of the "current user".</p>
</div>
<div class="paragraph">
<p>A default implementation is provided by the Wicket viewer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that this default implementation does not support requests made through the Restful Objects viewer (there is no Wicket 'application' object available); the upshot is that requests through Restful Objects are never translated. Registering a different implementation of <code>LocaleProvider</code> that taps into appropriate REST (RestEasy?) APIs would be the way to address this.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="__code_translationsresolver_code"><code>TranslationsResolver</code></h5>
<div class="paragraph">
<p>The <code>TranslationResolver</code> is used by the <code>TranslationService</code> implementation to lookup translations for a specified locale. It is this service that reads from the <code>WEB-INF/</code> (or externalized directory).</p>
</div>
</div>
<div class="sect4">
<h5 id="__code_translationservicepomenu_code"><code>TranslationServicePoMenu</code></h5>
<div class="paragraph">
<p>The <code>TranslationServicePoMenu</code> provides a couple of menu actions in the UI (prototype mode only) that interacts with the underlying <code>TranslationServicePo</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>downloadTranslationsFile()</code> action - available only in write mode - allows the current <code>.pot</code> file to be downloaded.<br></p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While this will contain all the translations from the metamodel, it will not necessarily contain all translations for all imperative methods returning <code>TranslatableString</code> instances; which are present and which are missing will depend on which imperative methods have been called (recorded by the service) prior to downloading.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>the <code>clearTranslationsCache()</code> action - available only in read mode - will clear the cache so that new translations can be loaded.<br></p>
<div class="paragraph">
<p>This allows a translator to edit the appropriate <code>translations-xx-XX.po</code> file and check the translation is correct without having to restart the app.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug_more-advanced_multi-tenancy">4.8. Multi-tenancy</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO - as supported by (non-ASF) <a href="http://github.com/isisaddons/isis-module-security">Isis addons' security</a> module.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ug_more-advanced_persistence-lifecycle">4.9. Persistence Lifecycle</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ug_more-advanced_tips-n-tricks">4.10. Tips n Tricks</h3>
<div class="paragraph">
<p>This section catalogues a miscellaneous collection of hints-and-tips.</p>
</div>
<div class="sect3">
<h4 id="_ug_more-advanced_tips-n-tricks_are-you-sure">4.10.1. 'Are you sure?' idiom</h4>
<div class="paragraph">
<p>Sometimes an action might perform irreversible changes.  In such a case it&#8217;s probably a good idea for the UI to require that the
end-user explicitly confirms that they intended to invoke the action.</p>
</div>
<div class="sect4">
<h5 id="_using_action_semantics_code_1_10_0_snapshot_code">Using action semantics (<code>1.10.0-SNAPSHOT</code>)</h5>
<div class="paragraph">
<p>One way to meet this requirement is using the framework&#8217;s built-in <a href="rg.html#_rg_annotations_manpage-Action_semantics"><code>@Action#semantics()</code></a> attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Action</span>(
        semantics = SemanticsOf.IDEMPOTENT_ARE_YOU_SURE
)
<span class="directive">public</span> SimpleObject updateName(
        <span class="annotation">@Parameter</span>(maxLength = NAME_LENGTH)
        <span class="annotation">@ParameterLayout</span>(named = <span class="string"><span class="delimiter">&quot;</span><span class="content">New name</span><span class="delimiter">&quot;</span></span>)
        <span class="directive">final</span> <span class="predefined-type">String</span> name) {
    setName(name);
    <span class="keyword">return</span> <span class="local-variable">this</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will render as:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images//how-tos/tips-n-tricks/action-semantics-are-you-sure.png" alt="action semantics are you sure">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_using_a_checkbox">Using a checkbox</h5>
<div class="paragraph">
<p>An alternative approach (for all versions of the framework) is to require the end-user to check a dummy checkbox parameter (and prevent the action from being invoked if the user hasn&#8217;t checked that parameter).</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images//how-tos/tips-n-tricks/are-you-sure.png" alt="are you sure">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that these screenshots shows an earlier version of the <a href="#_ug_wicket-viewer">Wicket viewer</a> UI (specifically, pre 1.8.0).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the user checks the box:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images//how-tos/tips-n-tricks/are-you-sure-happy-case.png" alt="are you sure happy case">
</div>
</div>
<div class="paragraph">
<p>then the action will complete.</p>
</div>
<div class="paragraph">
<p>However, if the user fails to check the box, then a validation message is shown:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images//how-tos/tips-n-tricks/are-you-sure-sad-case.png" alt="are you sure sad case">
</div>
</div>
<div class="paragraph">
<p>The code for this is pretty simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">List</span>&lt;ToDoItem&gt; delete(<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Are you sure?</span><span class="delimiter">&quot;</span></span>) <span class="type">boolean</span> areYouSure) {
    container.removeIfNotAlready(<span class="local-variable">this</span>);
    container.informUser(<span class="string"><span class="delimiter">&quot;</span><span class="content">Deleted </span><span class="delimiter">&quot;</span></span> + container.titleOf(<span class="local-variable">this</span>));
    <span class="keyword">return</span> toDoItems.notYetComplete();          <i class="conum" data-value="1"></i><b>(1)</b>
}
<span class="directive">public</span> <span class="predefined-type">String</span> validateDelete(<span class="type">boolean</span> areYouSure) {
    <span class="keyword">return</span> areYouSure? <span class="predefined-constant">null</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Please confirm you are sure</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>invalid to return <code>this</code> (cannot render a deleted object)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that the action itself does not use the boolean parameter, it is only
used by the supporting <a href="rg.html#_rg_methods_prefixes_manpage-validate"><code>validate&#8230;&#8203;()</code></a> method.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_more-advanced_tips-n-tricks_simulating-collections-of-values">4.10.2. Collections of values</h4>
<div class="paragraph">
<p>Although in Apache Isis you can have properties of either values (string, number, date etc) or of (references to other) entities, with collections the framework (currently) only supports collections of (references to) entities.  That is, collections of values (a bag of numbers, say) are not supported.</p>
</div>
<div class="paragraph">
<p>However, it is possible to simulate a bag of numbers using view models.</p>
</div>
<div class="sect4">
<h5 id="_view_model">View Model</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_persistence_concerns">Persistence Concerns</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TODO -  easiest to simply store using DataNucleus' support for collections, marked as <a href="rg.html#_rg_annotations_manpage-Programmatic"><code>@Programmatic</code></a> so that it is ignored by Apache Isis.  Alternatively can store as json/xml in a varchar(4000) or clob and manually unpack.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_more-advanced_tips-n-tricks_render-all-properties-in-tables">4.10.3. Subclass properties in tables</h4>
<div class="paragraph">
<p>Suppose you have a hierarchy of classes where a property is derived and abstract in the superclass, concrete implementations in the subclasses. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">LeaseTerm</span> {
    <span class="directive">public</span> <span class="directive">abstract</span> <span class="predefined-type">BigDecimal</span> getEffectiveValue();
    ...
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">LeaseTermForIndexableTerm</span> <span class="directive">extends</span> LeaseTerm {
    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> getEffectveValue() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Currently the Wicket viewer will not render the property in tables (though the property is correctly rendered in views).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more background on this workaround, see <a href="https://issues.apache.org/jira/browse/ISIS-582">ISIS-582</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The work-around is simple enough; make the method concrete in the superclass and return a dummy implementation, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">LeaseTerm</span> {
    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> getEffectiveValue() {
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;        <span class="comment">// workaround for ISIS-582</span>
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively the implementation could throw a <code>RuntimeException</code>, eg</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">never called; workaround for ISIS-582</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_more-advanced_tips-n-tricks_per-user-themes">4.10.4. Per-user Themes</h4>
<div class="paragraph">
<p>From the Apache Isis mailing list is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Is it possible to have each of our resellers (using our Isis application) use there own theme/branding with their own logo and colors? Would this also be possible for the login page, possibly depending on the used host name?</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Yes, you can do this, by installing a custom implementation of the Wicket Bootstrap&#8217;s <code>ActiveThemeProvider</code>.</p>
</div>
<div class="paragraph">
<p>The <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a> (non-ASF) actually <a href="https://github.com/isisaddons/isis-app-todoapp/tree/61b8114a8e01dbb3c380b31cf09eaed456407570">does this</a>, storing the info via the <a href="http://github.com/isisaddons/isis-module-settings">Isis addons' settings module</a> settings modules:</p>
</div>
<div class="listingblock">
<div class="title">IActiveThemeProvider implementation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">UserSettingsThemeProvider</span> <span class="directive">implements</span> ActiveThemeProvider {
    ...
    <span class="annotation">@Override</span>
    <span class="directive">public</span> ITheme getActiveTheme() {
        <span class="keyword">if</span>(IsisContext.getSpecificationLoader().isInitialized()) {
            <span class="directive">final</span> <span class="predefined-type">String</span> themeName = IsisContext.doInSession(<span class="keyword">new</span> <span class="predefined-type">Callable</span>&lt;<span class="predefined-type">String</span>&gt;() {
                <span class="annotation">@Override</span>
                <span class="directive">public</span> <span class="predefined-type">String</span> call() <span class="directive">throws</span> <span class="exception">Exception</span> {
                    <span class="directive">final</span> <span class="predefined-type">Class</span>&lt;UserSettingsService&gt; serviceClass = UserSettingsService.class;
                    <span class="directive">final</span> UserSettingsService userSettingsService = lookupService(serviceClass);
                    <span class="directive">final</span> UserSetting activeTheme = userSettingsService.find(
                            IsisContext.getAuthenticationSession().getUserName(), ACTIVE_THEME);
                    <span class="keyword">return</span> activeTheme != <span class="predefined-constant">null</span> ? activeTheme.valueAsString() : <span class="predefined-constant">null</span>;
                }
            });
            <span class="keyword">return</span> themeFor(themeName);
        }
        <span class="keyword">return</span> <span class="keyword">new</span> SessionThemeProvider().getActiveTheme();
    }
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> setActiveTheme(<span class="directive">final</span> <span class="predefined-type">String</span> themeName) {
        IsisContext.doInSession(<span class="keyword">new</span> <span class="predefined-type">Runnable</span>() {
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> run() {
                <span class="directive">final</span> <span class="predefined-type">String</span> currentUsrName = IsisContext.getAuthenticationSession().getUserName();
                <span class="directive">final</span> UserSettingsServiceRW userSettingsService =
                        lookupService(UserSettingsServiceRW.class);
                <span class="directive">final</span> UserSettingJdo activeTheme =
                        (UserSettingJdo) userSettingsService.find(currentUsrName, ACTIVE_THEME);
                <span class="keyword">if</span>(activeTheme != <span class="predefined-constant">null</span>) {
                    activeTheme.updateAsString(themeName);
                } <span class="keyword">else</span> {
                    userSettingsService.newString(
                        currentUsrName, ACTIVE_THEME, <span class="string"><span class="delimiter">&quot;</span><span class="content">Active Bootstrap theme for user</span><span class="delimiter">&quot;</span></span>, themeName);
                }
            }
        });
    }
    <span class="directive">private</span> ITheme themeFor(<span class="directive">final</span> <span class="predefined-type">String</span> themeName) {
        <span class="directive">final</span> ThemeProvider themeProvider = settings.getThemeProvider();
        <span class="keyword">if</span>(themeName != <span class="predefined-constant">null</span>) {
            <span class="keyword">for</span> (<span class="directive">final</span> ITheme theme : themeProvider.available()) {
                <span class="keyword">if</span> (themeName.equals(theme.name()))
                    <span class="keyword">return</span> theme;
            }
        }
        <span class="keyword">return</span> themeProvider.defaultTheme();
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="title">Using the ActiveThemeProvider</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">protected</span> <span class="type">void</span> init() {
    <span class="local-variable">super</span>.init();

    <span class="directive">final</span> IBootstrapSettings settings = Bootstrap.getSettings();
    settings.setThemeProvider(<span class="keyword">new</span> BootswatchThemeProvider(BootswatchTheme.Flatly));

    settings.setActiveThemeProvider(<span class="keyword">new</span> UserSettingsThemeProvider(settings));
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug_more-advanced_tips-n-tricks_enhance-only">4.10.5. Enhance only (IntelliJ)</h4>
<div class="paragraph">
<p>From the Apache Isis mailing list is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Is there a simple way to make a run configuration in IntelliJ for running the datanucleus enhancer before running integration test?</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Yes, you can; here&#8217;s one way:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Duplicate your run configuration for running the webapp</p>
<div class="ulist">
<ul>
<li>
<p>the one where the main class is <code>org.apache.isis.WebServer</code></p>
</li>
<li>
<p>there&#8217;s a button for this on the run configurations dialog.</p>
</li>
</ul>
</div>
</li>
<li>
<p>then, on your copy change the main class to <code>org.apache.isis.Dummy</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
        </div>

        <footer>
          <hr>
          <p class="small">
          Copyright &copy; 2010~2015 The Apache&nbsp;Software&nbsp;Foundation, licensed under the Apache&nbsp;License,&nbsp;v2.0.
          <br/>
          Apache, the Apache feather logo, Apache&nbsp;Isis, and the Apache&nbsp;Isis project logo are all trademarks of The&nbsp;Apache&nbsp;Software&nbsp;Foundation.
          </p>
        </footer>

    </div>

    <div id="doc-content-right" class="large-3 medium-3 xcolumns">
        <div id="toc" class="toc2">
            <div class="fallback-toc">
                <ul class="sectlevel1">
<li><a href="#_ug">1. Users' Guide</a></li>
<li><a href="#_ug_core-concepts">2. Core Concepts</a>
<ul class="sectlevel2">
<li><a href="#_ug_core-concepts_philosophy">2.1. Philosophy and Architecture</a>
<ul class="sectlevel3">
<li><a href="#_ug_core-concepts_philosophy_domain-driven-design">2.1.1. Domain-Driven Design</a>
<ul class="sectlevel4">
<li><a href="#_ubiquitous_language">Ubiquitous Language</a></li>
<li><a href="#_model_driven_design">Model-Driven Design</a></li>
</ul>
</li>
<li><a href="#_ug_core-concepts_philosophy_naked-objects-pattern">2.1.2. Naked Objects Pattern</a>
<ul class="sectlevel4">
<li><a href="#_ug_core-concepts_philosophy_naked-objects-pattern_object-interface-mapping">Object Interface Mapping</a></li>
<li><a href="#_what_this_means_in_practice">What this means in practice</a></li>
</ul>
</li>
<li><a href="#_ug_core-concepts_philosophy_hexagonal-architecture">2.1.3. Hexagonal Architecture</a></li>
<li><a href="#_ug_core-concepts_philosophy_aop">2.1.4. Aspect Oriented</a>
<ul class="sectlevel4">
<li><a href="#_aop_concepts">AOP Concepts</a></li>
<li><a href="#_realization_within_apache_isis">Realization within Apache Isis</a></li>
</ul>
</li>
<li><a href="#_ug_core-concepts_philosophy_how-eases-ddd">2.1.5. How Apache Isis eases DDD</a>
<ul class="sectlevel4">
<li><a href="#_ddd_takes_a_conscious_effort">DDD takes a conscious effort</a></li>
<li><a href="#_ddd_must_be_grounded">DDD must be grounded</a></li>
<li><a href="#_model_must_be_understandable">Model must be understandable</a></li>
<li><a href="#_architecture_must_be_robust">Architecture must be robust</a></li>
<li><a href="#_extending_the_reach_of_ddd">Extending the reach of DDD</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_core-concepts_principles">2.2. Principles and Values</a>
<ul class="sectlevel3">
<li><a href="#_ug_core-concepts_principles_your-apps">2.2.1. Your Applications</a></li>
<li><a href="#_ug_core-concepts_principles_isis-itself">2.2.2. Apache Isis itself</a>
<ul class="sectlevel4">
<li><a href="#_full_stack_but_extensible">Full-stack but Extensible</a></li>
<li><a href="#_focuses_on_its_usp">Focuses on its USP</a></li>
</ul>
</li>
<li><a href="#_ug_core-concepts_principles_apache-isis-vs">2.2.3. Apache Isis vs &#8230;&#8203;</a>
<ul class="sectlevel4">
<li><a href="#_ug_core-concepts_principles_apache-isis-vs_mvc-server-side-frameworks">vs MVC server-side frameworks</a></li>
<li><a href="#_ug_core-concepts_principles_apache-isis-vs_cqrs">vs CQRS</a></li>
<li><a href="#_ug_core-concepts_principles_apache-isis-vs_event-sourcing">vs Event Sourcing</a></li>
<li><a href="#_ug_core-concepts_principles_apache-isis-vs_metawidget">vs MetaWidget</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_core-concepts_building-blocks">2.3. Building Blocks</a>
<ul class="sectlevel3">
<li><a href="#_ug_core-concepts_building-blocks_metamodel">2.3.1. A MetaModel</a></li>
<li><a href="#_ug_core-concepts_building-blocks_types-of-domain-objects">2.3.2. Type of Domain Objects</a></li>
<li><a href="#_ug_core-concepts_building-blocks_objects-members">2.3.3. Object Members</a>
<ul class="sectlevel4">
<li><a href="#_properties">Properties</a></li>
<li><a href="#_collections">Collections</a></li>
<li><a href="#_actions">Actions</a></li>
</ul>
</li>
<li><a href="#_domain_entities_vs_view_models">2.3.4. Domain Entities vs View Models</a></li>
<li><a href="#_ug_core-concepts_building-blocks_domain-services">2.3.5. Domain Services</a>
<ul class="sectlevel4">
<li><a href="#_domain_services_vs_view_services">Domain Services vs View Services</a></li>
</ul>
</li>
<li><a href="#_ug_core-concepts_building-blocks_value-objects">2.3.6. Value Objects (Primitives)</a></li>
<li><a href="#_ug_core-concepts_building-blocks_mixins-and-contributions">2.3.7. Mixins &amp; Contributions</a></li>
<li><a href="#_ug_core-concepts_building-blocks_domain-events">2.3.8. Domain Events</a></li>
</ul>
</li>
<li><a href="#_ug_core-concepts_framework-provided-services">2.4. Framework-provided Services</a></li>
<li><a href="#_ug_core-concepts_add-ons">2.5. Isis Add-ons</a></li>
<li><a href="#_ug_core-concepts_other-deployment-options">2.6. Other Deployment Options</a>
<ul class="sectlevel3">
<li><a href="#_deploy_to_production">2.6.1. Deploy to production</a></li>
<li><a href="#_use_for_prototyping">2.6.2. Use for prototyping</a></li>
<li><a href="#_deploy_on_your_own_platform">2.6.3. Deploy on your own platform</a></li>
<li><a href="#_deploy_the_rest_api">2.6.4. Deploy the REST API</a></li>
<li><a href="#_implement_your_own_viewer">2.6.5. Implement your own viewer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_how-tos">3. How tos</a>
<ul class="sectlevel2">
<li><a href="#_ug_how-tos_class-structure">3.1. Class Structure</a>
<ul class="sectlevel3">
<li><a href="#_ug_how-tos_class-structure_class-definition">3.1.1. Class Definition</a></li>
<li><a href="#_ug_how-tos_class-structure_properties">3.1.2. Property</a>
<ul class="sectlevel4">
<li><a href="#_value_vs_reference_types">Value vs Reference Types</a></li>
<li><a href="#_optional_properties">Optional Properties</a></li>
<li><a href="#__code_string_code_s_length"><code>String</code>s (Length)</a></li>
<li><a href="#_ug_how-tos_class-structure_properties_mapping-joda-dates">Mapping JODA Dates</a></li>
<li><a href="#__code_bigdecimal_code_s_precision"><code>BigDecimal</code>s (Precision)</a></li>
<li><a href="#_mapping_blobs_and_clobs">Mapping Blobs and Clobs</a></li>
</ul>
</li>
<li><a href="#_ug_how-tos_class-structure_collections">3.1.3. Collections</a></li>
<li><a href="#_ug_how-tos_class-structure_actions">3.1.4. Actions</a></li>
<li><a href="#_ug_how-tos_class-structure_action-parameters">3.1.5. Action Parameters</a>
<ul class="sectlevel4">
<li><a href="#__code_string_code_s_length_2"><code>String</code>s (Length)</a></li>
<li><a href="#__code_bigdecimal_code_s_precision_2"><code>BigDecimal</code>s (Precision)</a></li>
<li><a href="#_optional">Optional</a></li>
</ul>
</li>
<li><a href="#_ug_how-tos_class-structure_inject-services">3.1.6. Injecting services</a>
<ul class="sectlevel4">
<li><a href="#_field_injection">Field Injection</a></li>
<li><a href="#_method_injection">Method Injection</a></li>
<li><a href="#_constructor_injection">Constructor injection</a></li>
</ul>
</li>
<li><a href="#_ug_how-tos_class-structure_properties-vs-parameters">3.1.7. Properties vs Parameters</a></li>
<li><a href="#_ug_how-tos_class-structure_ignoring-methods">3.1.8. Ignoring Methods</a></li>
</ul>
</li>
<li><a href="#_ug_how-tos_ui-hints">3.2. UI Hints</a>
<ul class="sectlevel3">
<li><a href="#_ug_how-tos_ui-hints_object-titles-and-icons">3.2.1. Object Titles and Icons</a>
<ul class="sectlevel4">
<li><a href="#_object_title">Object Title</a></li>
<li><a href="#_object_icon">Object Icon</a></li>
<li><a href="#_object_css_styling">Object CSS Styling</a></li>
</ul>
</li>
<li><a href="#_ug_how-tos_ui-hints_names-and-descriptions">3.2.2. Names and Descriptions</a>
<ul class="sectlevel4">
<li><a href="#_class_object">Class (object)</a></li>
<li><a href="#_property">Property</a></li>
<li><a href="#_collections_2">Collections</a></li>
<li><a href="#_actions_2">Actions</a></li>
<li><a href="#_action_parameters">Action Parameters</a></li>
</ul>
</li>
<li><a href="#_ug_how-tos_ui-hints_layout">3.2.3. Layout</a></li>
<li><a href="#_ug_how-tos_ui-hints_eager-rendering">3.2.4. Eager rendering</a></li>
<li><a href="#_ug_how-tos_ui-hints_action-icons-and-css">3.2.5. Action Icons and CSS</a>
<ul class="sectlevel4">
<li><a href="#_per_action">Per action</a></li>
<li><a href="#_per_pattern_matching">Per pattern matching</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_how-tos_domain-services">3.3. Domain Services</a>
<ul class="sectlevel3">
<li><a href="#_ug_how-tos_domain-services_organizing-services">3.3.1. Organizing Services</a>
<ul class="sectlevel4">
<li><a href="#_factory_and_repository">Factory and Repository</a></li>
<li><a href="#_menu">Menu</a></li>
<li><a href="#_contributions">Contributions</a></li>
<li><a href="#_event_subscribers">Event Subscribers</a></li>
</ul>
</li>
<li><a href="#_prototyping">3.3.2. Prototyping</a></li>
<li><a href="#_scoped_services">3.3.3. Scoped services</a></li>
<li><a href="#_registering_domain_services">3.3.4. Registering domain services</a></li>
<li><a href="#_initialization">3.3.5. Initialization</a></li>
<li><a href="#_the_getid_method">3.3.6. The getId() method</a></li>
</ul>
</li>
<li><a href="#_ug_how-tos_crud">3.4. Object Management (CRUD)</a>
<ul class="sectlevel3">
<li><a href="#_instantiating_and_persisting_objects">3.4.1. Instantiating and Persisting Objects</a></li>
<li><a href="#_finding_objects">3.4.2. Finding Objects</a>
<ul class="sectlevel4">
<li><a href="#_using_datanucleus_type_safe_queries">Using DataNucleus type-safe queries</a></li>
</ul>
</li>
<li><a href="#_deleting_objects">3.4.3. Deleting Objects</a></li>
</ul>
</li>
<li><a href="#_ug_how-tos_entity-relationships">3.5. Entity Relationships</a>
<ul class="sectlevel3">
<li><a href="#_mandatory_and_optional">3.5.1. Mandatory and Optional</a></li>
<li><a href="#_ug_how-tos_entity-relationships_managed-1-to-m-bidirectional-relationships">3.5.2. 1-m bidir relationships</a></li>
</ul>
</li>
<li><a href="#_ug_how-tos_contributed-members">3.6. Contributed Members</a>
<ul class="sectlevel3">
<li><a href="#_contributed_action">3.6.1. Contributed Action</a></li>
<li><a href="#_contributed_property">3.6.2. Contributed Property</a></li>
<li><a href="#_contributed_collection">3.6.3. Contributed Collection</a></li>
</ul>
</li>
<li><a href="#_ug_how-tos_business-rules">3.7. Business Rules</a>
<ul class="sectlevel3">
<li><a href="#_visibility_see_it">3.7.1. Visibility ("see it")</a>
<ul class="sectlevel4">
<li><a href="#_hide_a_property">Hide a Property</a></li>
<li><a href="#_hide_a_collection">Hide a Collection</a></li>
<li><a href="#_hide_an_action">Hide an Action</a></li>
<li><a href="#_hide_a_contributed_property_collection_or_action">Hide a Contributed Property, Collection or Action</a></li>
<li><a href="#_all_members_hidden">All Members Hidden</a></li>
</ul>
</li>
<li><a href="#_usability_use_it">3.7.2. Usability ("use it")</a>
<ul class="sectlevel4">
<li><a href="#_disable_a_property">Disable a Property</a></li>
<li><a href="#_disable_a_collection">Disable a Collection</a></li>
<li><a href="#_disable_an_action">Disable an Action</a></li>
<li><a href="#_disable_a_contributed_property_collection_or_action">Disable a Contributed Property, Collection or Action</a></li>
<li><a href="#_all_members_unmodifiable_disabling_the_edit_button">All Members Unmodifiable (Disabling the Edit Button)</a></li>
</ul>
</li>
<li><a href="#_validity_do_it">3.7.3. Validity ("do it")</a>
<ul class="sectlevel4">
<li><a href="#_validate_change_to_a_property">Validate (change to) a Property</a></li>
<li><a href="#_validate_adding_or_removing_from_a_collection">Validate (adding or removing from) a Collection</a></li>
<li><a href="#_validate_arguments_to_invoke_an_action">Validate (arguments to invoke) an Action</a></li>
<li><a href="#_validating_a_contributed_property_collection_or_action">Validating a Contributed Property, Collection or Action</a></li>
<li><a href="#_declarative_validation">Declarative validation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_how-tos_derived-members">3.8. Derived Members</a>
<ul class="sectlevel3">
<li><a href="#_derived_property">3.8.1. Derived Property</a></li>
<li><a href="#_derived_collection">3.8.2. Derived Collection</a></li>
<li><a href="#_trigger_on_property_change">3.8.3. Trigger on property change</a></li>
<li><a href="#_trigger_on_collection_change">3.8.4. Trigger on collection change</a></li>
</ul>
</li>
<li><a href="#_ug_how-tos_drop-downs-and-defaults">3.9. Drop Downs and Defaults</a>
<ul class="sectlevel3">
<li><a href="#_for_properties">3.9.1. For Properties</a>
<ul class="sectlevel4">
<li><a href="#_choices_for_property">Choices for Property</a></li>
<li><a href="#_auto_complete_for_property">Auto-complete for property</a></li>
<li><a href="#_default_for_property">Default for property</a></li>
</ul>
</li>
<li><a href="#_for_action_parameters">3.9.2. For Action Parameters</a>
<ul class="sectlevel4">
<li><a href="#_choices_for_action_parameter">Choices for action parameter</a></li>
<li><a href="#_dependent_choices_for_action_params">Dependent choices for action params</a></li>
<li><a href="#_auto_complete_for_action_param">Auto-complete for action param</a></li>
<li><a href="#_default_for_action_param">Default for action param</a></li>
</ul>
</li>
<li><a href="#_for_both_properties_and_action_parameters">3.9.3. For both Properties and Action Parameters</a>
<ul class="sectlevel4">
<li><a href="#_drop_down_for_limited_number_of_instances">Drop-down for limited number of instances</a></li>
<li><a href="#_auto_complete_repository_based">Auto-complete (repository-based)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_how-tos_persisted-title">3.10. Persisted Title</a></li>
</ul>
</li>
<li><a href="#_ug_more-advanced">4. More Advanced Techniques</a>
<ul class="sectlevel2">
<li><a href="#_ug_more-advanced_decoupling">4.1. Decoupling</a>
<ul class="sectlevel3">
<li><a href="#_ug_more-advanced_decoupling_db-schemas">4.1.1. Database Schemas</a>
<ul class="sectlevel4">
<li><a href="#_listener_to_create_schema">Listener to create schema</a></li>
<li><a href="#_alternative_implementation">Alternative implementation</a></li>
</ul>
</li>
<li><a href="#_ug_more-advanced_decoupling_mixins">4.1.2. Mixins</a>
<ul class="sectlevel4">
<li><a href="#_example">Example</a></li>
<li><a href="#_contributing_a_single_member">Contributing a single member</a></li>
<li><a href="#_programmatic_usage">Programmatic usage</a></li>
<li><a href="#_other_reasons_to_use_mixins">Other reasons to use mixins</a></li>
<li><a href="#_related_reading">Related reading</a></li>
</ul>
</li>
<li><a href="#_ug_more-advanced_decoupling_contributions">4.1.3. Contributions</a></li>
<li><a href="#_ug_more-advanced_decoupling_vetoing-visibility">4.1.4. Vetoing Visibility</a></li>
<li><a href="#_ug_more-advanced_decoupling_event-bus">4.1.5. Event Bus</a></li>
<li><a href="#_ug_more-advanced_decoupling_pushing-changes">4.1.6. Pushing Changes</a>
<ul class="sectlevel4">
<li><a href="#_when_a_property_is_changed">When a property is changed</a></li>
<li><a href="#_when_a_collection_is_modified">When a collection is modified</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_more-advanced_overriding-jdo-annotations">4.2. Overriding JDO Annotations</a></li>
<li><a href="#_ug_more-advanced_bulk-actions">4.3. Bulk Actions</a></li>
<li><a href="#_ug_more-advanced_view-models">4.4. View Models</a></li>
<li><a href="#_ug_more-advanced_mapping-rdbms-views">4.5. Mapping RDBMS Views</a></li>
<li><a href="#_ug_more-advanced_transactions-and-errors">4.6. Transactions and Errors</a>
<ul class="sectlevel3">
<li><a href="#_aborting_transactions">4.6.1. Aborting Transactions</a></li>
<li><a href="#_raise_message_errors_to_users">4.6.2. Raise message/errors to users</a></li>
<li><a href="#_exception_recognizers">4.6.3. Exception Recognizers</a></li>
</ul>
</li>
<li><a href="#_ug_more-advanced_i18n">4.7. i18n</a>
<ul class="sectlevel3">
<li><a href="#_implementation_approach">4.7.1. Implementation Approach</a></li>
<li><a href="#__code_translationservice_code">4.7.2. <code>TranslationService</code></a>
<ul class="sectlevel4">
<li><a href="#__code_translationservicepo_code"><code>TranslationServicePo</code></a></li>
</ul>
</li>
<li><a href="#_imperative_messages">4.7.3. Imperative messages</a>
<ul class="sectlevel4">
<li><a href="#__code_translatablestring_code"><code>TranslatableString</code></a></li>
<li><a href="#__code_translatableexception_code"><code>TranslatableException</code></a></li>
</ul>
</li>
<li><a href="#_integration_testing">4.7.4. Integration Testing</a></li>
<li><a href="#_configuration">4.7.5. Configuration</a>
<ul class="sectlevel4">
<li><a href="#_logging">Logging</a></li>
<li><a href="#_location_of_the_code_po_code_files">Location of the <code>.po</code> files</a></li>
<li><a href="#_externalized_translation_files">Externalized translation files</a></li>
<li><a href="#_force_read_mode">Force read mode</a></li>
</ul>
</li>
<li><a href="#_supporting_services">4.7.6. Supporting services</a>
<ul class="sectlevel4">
<li><a href="#__code_localeprovider_code"><code>LocaleProvider</code></a></li>
<li><a href="#__code_translationsresolver_code"><code>TranslationsResolver</code></a></li>
<li><a href="#__code_translationservicepomenu_code"><code>TranslationServicePoMenu</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug_more-advanced_multi-tenancy">4.8. Multi-tenancy</a></li>
<li><a href="#_ug_more-advanced_persistence-lifecycle">4.9. Persistence Lifecycle</a></li>
<li><a href="#_ug_more-advanced_tips-n-tricks">4.10. Tips n Tricks</a>
<ul class="sectlevel3">
<li><a href="#_ug_more-advanced_tips-n-tricks_are-you-sure">4.10.1. 'Are you sure?' idiom</a>
<ul class="sectlevel4">
<li><a href="#_using_action_semantics_code_1_10_0_snapshot_code">Using action semantics (<code>1.10.0-SNAPSHOT</code>)</a></li>
<li><a href="#_using_a_checkbox">Using a checkbox</a></li>
</ul>
</li>
<li><a href="#_ug_more-advanced_tips-n-tricks_simulating-collections-of-values">4.10.2. Collections of values</a>
<ul class="sectlevel4">
<li><a href="#_view_model">View Model</a></li>
<li><a href="#_persistence_concerns">Persistence Concerns</a></li>
</ul>
</li>
<li><a href="#_ug_more-advanced_tips-n-tricks_render-all-properties-in-tables">4.10.3. Subclass properties in tables</a></li>
<li><a href="#_ug_more-advanced_tips-n-tricks_per-user-themes">4.10.4. Per-user Themes</a></li>
<li><a href="#_ug_more-advanced_tips-n-tricks_enhance-only">4.10.5. Enhance only (IntelliJ)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </div>
        </div>
    </div>

</div>


<script src="../js/foundation/5.5.1/vendor/jquery.js"></script>
<script src="../js/foundation/5.5.1/foundation.min.js"></script>


<link href="../css/jquery.tocify/1.9.0/jquery.tocify.css" rel="stylesheet">
<script src="../js/jqueryui/1.11.4/jquery-ui.min.js"></script>
<script src="../js/jquery.tocify/1.9.0/jquery.tocify.js"></script>



<script type="text/javascript">
    $(function () {
        $("#toc").tocify({
            scrollTo: 50,
            extendPage: true,
            context: "#doc-content",
            highlightOnScroll: true,
            hashGenerator: "pretty",
            hideEffect: "slideUp",
            selectors: "h2,h3,h4,h5"
        });
        $(".fallback-toc").hide();
    });
</script>

<script type="text/javascript">

  /****

      $(document).foundation();

      $(document).ready(function(){
        // Cache selectors
        var lastId,
            topMenu = $("div#toc ul"),
            topMenuHeight = 100,

            menuItems = topMenu.find("a"),
            menuItemsHrefs = menuItems.map(function(){
              var item = $($(this).attr("href"));
              if (item.length) { return item; }
            });

        // Bind click handler to menu items to scroll animation
        menuItems.click(function(e){
          var href = $(this).attr("href"),
              offsetTop = href === "#" ? 0 : $(href).offset().top-topMenuHeight+1;
          $('html, body').stop().animate({
              scrollTop: offsetTop
          }, 300);

          e.preventDefault();
        });

        // Bind to scroll of window
        $(  window ).scroll(function(){

           // Get container scroll position
           var fromTop = $(this).scrollTop()+topMenuHeight;

           var cur = menuItemsHrefs.map(function(){
             if ($(this).offset().top < fromTop)
               return this;
           });

           // Get the id of the current element
           cur = cur[cur.length-1];

           var id = cur && cur.length ? cur[0].id : "";

           if (lastId !== id && id) {
               scrollTo(id);
           }

           window.history.pushState({}, "", window.location.origin + window.location.pathname + "#" + id);
        });

        scrollTo = function(id) {
              lastId = id;

              menuItems
                .removeClass("active");

              menuItems
                .parents()
                .removeClass("active-region");

              menuItems
                .parents("ul").hide();

              menuItems
                .filter("[href=#"+id+"]")
                .addClass("active");

              menuItems
                .filter("[href=#"+id+"]")
                .parents("ul").show();

              menuItems
                .filter("[href=#"+id+"]")
                .parent().children("ul").show();

              menuItems
                .filter("[href=#"+id+"]")
                .parents("li").addClass("active-region");

        }
      menuItems
        .removeClass("active");

      menuItems
        .parents()
        .removeClass("active-region");

        var syncMenuItem;
        if(window.location.hash!=="") {
            var menuItemFor = $.grep(menuItems, function(e) {
                return e.hash === window.location.hash;
            });
            console.log(menuItemFor);
            if(menuItemFor.length === 1) {
                syncMenuItem = menuItemFor[0];
            }
        }

        if(!syncMenuItem){
            syncMenuItem = menuItems[0];
        }

        $(syncMenuItem).click();

      });

    ***/

</script>

<script type="text/javascript">

$(document).ready(function(){
    if("Documentation" === "User Guide") {
        console.log( "processing 'Documentation'" );

        $("#doc-content-left").removeClass("large-9").removeClass("medium-9").addClass("large-12").addClass("medium-12");
        $("#doc-content-right").removeClass("large-3").removeClass("medium-3").hide();
    }

});

</script>


<script>

$( document ).ready(function() {

    (function() {
      $(function() {
        return $("#doc-content h2, #doc-content h3, #doc-content h4, #doc-content h5, #doc-content h6").each(function(i, el) {
          var $el, icon, id;
          $el = $(el);
          id = $el.attr('id');
          icon = '<i class="fa fa-link"></i>';
          if (id) {
            return $el.prepend($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
          }
        });
      });
    }).call(this);



	/*
        http://osvaldas.info/auto-hide-sticky-header
        MIT license
	*/
	;( function( $, window, document, undefined )
	{
		'use strict';

		var elSelector		= '.header',
			elClassHidden	= 'header--hidden',
			throttleTimeout	= 500,
			$element		= $( elSelector );

		if( !$element.length ) return true;

		var $window			= $( window ),
			wHeight			= 0,
			wScrollCurrent	= 0,
			wScrollBefore	= 0,
			wScrollDiff		= 0,
			$document		= $( document ),
			dHeight			= 0,

			throttle = function( delay, fn )
			{
				var last, deferTimer;
				return function()
				{
					var context = this, args = arguments, now = +new Date;
					if( last && now < last + delay )
					{
						clearTimeout( deferTimer );
						deferTimer = setTimeout( function(){ last = now; fn.apply( context, args ); }, delay );
					}
					else
					{
						last = now;
						fn.apply( context, args );
					}
				};
			};

		$window.on( 'scroll', throttle( throttleTimeout, function()
		{
			dHeight			= $document.height();
			wHeight			= $window.height();
			wScrollCurrent	= $window.scrollTop();
			wScrollDiff		= wScrollBefore - wScrollCurrent;

			if( wScrollCurrent <= 0 ) // scrolled to the very top; element sticks to the top
				$element.removeClass( elClassHidden );

			else if( wScrollDiff > 0 && $element.hasClass( elClassHidden ) ) // scrolled up; element slides in
				$element.removeClass( elClassHidden );

			else if( wScrollDiff < 0 ) // scrolled down
			{
				if( wScrollCurrent + wHeight >= dHeight && $element.hasClass( elClassHidden ) ) // scrolled to the very bottom; element slides in
					$element.removeClass( elClassHidden );

				else // scrolled down; element slides out
					$element.addClass( elClassHidden );
			}

			wScrollBefore = wScrollCurrent;
		}));

	})( jQuery, window, document );


});
</script>

</body>
</html>
