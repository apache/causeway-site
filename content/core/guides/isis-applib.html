<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Apache Isis Application Library</title><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book" title="Apache Isis Application Library"><div class="titlepage"><div><div><h1 class="title"><a name="d5e1"></a>Apache Isis Application Library</h1></div><div><h2 class="subtitle">Developing domain driven applications using Apache Isis</h2></div><div><div class="authorgroup">
      <div class="author"><h3 class="author"><span class="firstname">Dan</span> <span class="surname">Haywood</span></h3></div>

      <div class="author"><h3 class="author"><span class="firstname">Robert</span> <span class="surname">Matthews</span></h3></div>
    </div></div><div><p class="releaseinfo">1.0.0-SNAPSHOT</p></div><div><div class="legalnotice" title="Legal Notice"><a name="d5e13"></a>
      <p>Permission is granted to make and distribute verbatim copies of
      this manual provided that the copyright notice and this permission
      notice are preserved on all copies.</p>
    </div></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dt><span class="chapter"><a href="#d5e26">1. Introduction</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e30">What's in this Guide</a></span></dt><dt><span class="sect1"><a href="#d5e40">This Guide vs the Core Documentation</a></span></dt><dt><span class="sect1"><a href="#d5e56">Where Next?</a></span></dt></dl></dd><dt><span class="part"><a href="#prt.UnderstandingApacheIsis">I. Understanding Apache Isis</a></span></dt><dd><dl><dt><span class="chapter"><a href="#chp.PrinciplesAndPatterns">2. Apache Isis and Naked Objects</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e84">Apache Isis implements the naked objects pattern... but what is
        that, exactly?</a></span></dt><dt><span class="sect1"><a href="#d5e91">What type of applications are best suited to Isis?</a></span></dt><dt><span class="sect1"><a href="#d5e99">And are there applications where the OO UIs generated by Isis
        are less suitable?</a></span></dt><dt><span class="sect1"><a href="#d5e112">What is the typical development process life cycle for
        applications built with Isis, and how does it compare to traditional
        application development process?</a></span></dt><dt><span class="sect1"><a href="#d5e144">What are the limitations of Apache Isis framework?</a></span></dt><dt><span class="sect1"><a href="#d5e172">How extensive is the application security support provided by
        Isis?</a></span></dt><dt><span class="sect1"><a href="#d5e187">How does an Isis applications manage the custom logic in terms
        of business rules, workflow and other business logic that developers
        have to manually implement outside the generated code?</a></span></dt><dt><span class="sect1"><a href="#d5e192">How does Isis support SOA-based applications, eg where an
        enterprise service component is consumed by several different
        applications and other clients?</a></span></dt><dt><span class="sect1"><a href="#d5e208">Most enterprise applications need to reuse the domain and
        service layer classes between several different applications. How does
        Apache Isis address this?</a></span></dt><dt><span class="sect1"><a href="#d5e225">What is the future road map of the project?</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.DevelopmentProcess">3. A Development Process</a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.ApplicationArchetypes">Run the Quickstart Archetype</a></span></dt><dt><span class="sect1"><a href="#d5e250">Programming Model</a></span></dt><dt><span class="sect1"><a href="#d5e258">Fixtures and Prototyping</a></span></dt><dt><span class="sect1"><a href="#sec.Viewers">Viewers</a></span></dt><dt><span class="sect1"><a href="#sec.AgileTesting">Agile Testing</a></span></dt><dd><dl><dt><span class="sect2"><a href="#sec.BddTesting">Story (BDD) Testing</a></span></dt><dt><span class="sect2"><a href="#sec.UnitTesting">Unit Testing</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e322">A Domain Library</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e331">Domain Services</a></span></dt><dt><span class="sect2"><a href="#d5e343">Domain Values</a></span></dt><dt><span class="sect2"><a href="#d5e355">Domain Entities</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DeployingAnIsisApplication">Deploying an Isis Application</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e365">Persistence (the Default Runtime / Object Store)</a></span></dt><dt><span class="sect2"><a href="#d5e398">Authentication and Authorization</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="part"><a href="#prt.WritingDomainObjects">II. Writing Domain Objects</a></span></dt><dd><dl><dt><span class="chapter"><a href="#chp.Objects">4. Domain Entities</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e429">How to not inherit from framework superclasses</a></span></dt><dt><span class="sect1"><a href="#d5e440">How to specify a title for an object</a></span></dt><dt><span class="sect1"><a href="#sec.HowToSpecifyTheIconForAnObjectsClass">How to specify the icon for an object's
        class</a></span></dt><dt><span class="sect1"><a href="#d5e483">How to specify the icon for an individual object's
        state</a></span></dt><dt><span class="sect1"><a href="#d5e494">How to specify a name and/or description for an
        object</a></span></dt><dt><span class="sect1"><a href="#d5e506">How to specify that an object should not be
        persisted</a></span></dt><dt><span class="sect1"><a href="#sec.Immutable">How to specify that an object should
        never be modified by the user</a></span></dt><dt><span class="sect1"><a href="#sec.Entity.Disabled">How to control when an object can be modified</a></span></dt><dt><span class="sect1"><a href="#sec.Entity.Hidden">How to control when an object is visible</a></span></dt><dt><span class="sect1"><a href="#sec.Bounded">How to specify that a class of objects has a limited number of
        instances</a></span></dt><dt><span class="sect1"><a href="#sec.HowToCreateAnObject">How to create or delete objects within your code</a></span></dt><dt><span class="sect1"><a href="#sec.LifecycleMethods">How to insert behaviour into the object life cycle</a></span></dt><dt><span class="sect1"><a href="#sec.ResolveAndObjectChanged">How to perform lazy loading (generally done
        automatically)</a></span></dt><dt><span class="sect1"><a href="#d5e687">How to perform dirty object tracking (generally done
        automatically)</a></span></dt><dt><span class="sect1"><a href="#d5e696">How to ensure object is in valid state</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.Properties">5. Domain Entity Properties</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e720">How to add a property to an object</a></span></dt><dt><span class="sect1"><a href="#d5e739">How to specify a name and/or description for a property</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e741">Specifying the name for a property</a></span></dt><dt><span class="sect2"><a href="#d5e747">Specifying a description for a property</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.MemberOrderForProperties">How to specify the order in which properties are
        displayed</a></span></dt><dt><span class="sect1"><a href="#d5e761">How to make a property optional (when saving an object)</a></span></dt><dt><span class="sect1"><a href="#sec.SizeProperties">How to specify the size of <code class="classname">String</code>
        properties</a></span></dt><dt><span class="sect1"><a href="#sec.DerivedProperty">How to make a derived property</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e786">Lazily derived</a></span></dt><dt><span class="sect2"><a href="#d5e797">Eagerly derived</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.HiddenProperty">How to hide a property from the user</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e813">Hiding a property always</a></span></dt><dt><span class="sect2"><a href="#d5e819">Hiding a property based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e830">Hiding a property under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e841">Hiding a property for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DisabledProperty">How to prevent a property from being modified</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e854">Disabling a property permanently</a></span></dt><dt><span class="sect2"><a href="#d5e861">Disabling a property based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e872">Disabling a property under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e885">Disabling a property for certain users/roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e890">How to validate user input for a property</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e892">Declarative validation</a></span></dt><dt><span class="sect2"><a href="#d5e907">Imperative validation</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DefaultPropertyValue">How to set up the initial value of a property
        programmatically</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e924">By each property's default values</a></span></dt><dt><span class="sect2"><a href="#d5e933">By the <code class="methodname">created()</code> lifecycle
          method</a></span></dt><dt><span class="sect2"><a href="#d5e940">Programmatically, by the creator</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e946">How to specify a set of choices for a property</a></span></dt><dt><span class="sect1"><a href="#sec.ModifyAndClear">How to trigger other behaviour when a property is
        changed</a></span></dt><dt><span class="sect1"><a href="#d5e983">How to setup a bidirectional relationship</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.Collections">6. Domain Entity Collections</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e1000">How to add a collection to an object</a></span></dt><dt><span class="sect1"><a href="#d5e1024">How to specify a name and/or description for a
        collection</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1026">Specifying the name for a collection</a></span></dt><dt><span class="sect2"><a href="#d5e1032">Specifying a description for a collection</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.MemberOrderForCollections">How to specify the order in which collections are
        displayed</a></span></dt><dt><span class="sect1"><a href="#d5e1046">How to make a derived collection</a></span></dt><dt><span class="sect1"><a href="#sec.HiddenCollection">How to hide a collection</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1059">Hiding a collection permanently</a></span></dt><dt><span class="sect2"><a href="#d5e1065">Hiding a collection based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e1076">Hiding a collection under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e1087">Hiding a collection for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DisabledCollection">How to prevent a collection from being modified</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1098">Disabling a collection permanently</a></span></dt><dt><span class="sect2"><a href="#d5e1107">Disabling a collection based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e1118">Disabling a collection under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e1127">Disabling a collection for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1132">How to validate an object being added or removed</a></span></dt><dt><span class="sect1"><a href="#sec.AddToRemoveFrom">How to trigger other behaviour when an object is added or
        removed</a></span></dt><dt><span class="sect1"><a href="#sec.MutualRegistrationPattern">How to maintain bidirectional relationships</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.Actions">7. Domain Entity Actions</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e1185">How to add an action to an object</a></span></dt><dt><span class="sect1"><a href="#d5e1215">How to specify names and/or description for an action</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1217">Specifying the name for an action</a></span></dt><dt><span class="sect2"><a href="#d5e1223">Specifying a description for a collection</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1229">How to specify the order in which actions appear on the
        menu</a></span></dt><dt><span class="sect1"><a href="#sec.HiddenActions">How to hide an action</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1240">Hiding an action permanently</a></span></dt><dt><span class="sect2"><a href="#d5e1247">Hiding an action based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e1258">Hiding an action under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e1274">Hiding an action for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DisabledAction">How to prevent an action from being invoked</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1285">Disabling an action permanently</a></span></dt><dt><span class="sect2"><a href="#d5e1289">Disabling an action based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e1301">Based on the state of the object</a></span></dt><dt><span class="sect2"><a href="#d5e1313">Disabling an action for certain users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1318">How to specify names and/or descriptions for an action
        parameter</a></span></dt><dt><span class="sect1"><a href="#d5e1329">How to specify the size of <code class="classname">String</code> action
        parameters</a></span></dt><dt><span class="sect1"><a href="#d5e1348">How to make an action parameter optional</a></span></dt><dt><span class="sect1"><a href="#d5e1352">How to validate an action parameter argument</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1354">Declarative validation</a></span></dt><dt><span class="sect2"><a href="#d5e1369">Imperative validation</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1383">How to specify default values for an action parameter</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1387">Per-parameter syntax (preferred)</a></span></dt><dt><span class="sect2"><a href="#d5e1394">All parameters syntax</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1402">How to specify a set of choices for an action parameter</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1408">Per parameter syntax (preferred)</a></span></dt><dt><span class="sect2"><a href="#d5e1416">All parameters syntax</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#d5e1425">8. Further Business Rule How-Tos</a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.MustSpecify">@MustSatisfy Specification</a></span></dt><dt><span class="sect1"><a href="#sec.BusinessRulesForCertainUsersOrRoles">Hiding, disabling or validating for specific users or
        roles</a></span></dt><dt><span class="sect1"><a href="#d5e1478">How to pass a messages and errors back to the user</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.DomainServices">9. Domain Services, Repositories and Factories</a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.AbstractService">How to not inherit from framework classes</a></span></dt><dt><span class="sect1"><a href="#sec.Services">How to register domain services, repositories and
        factories</a></span></dt><dt><span class="sect1"><a href="#d5e1528">How to inject services into entities</a></span></dt><dt><span class="sect1"><a href="#d5e1535">How to write a typical domain service</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1542">The <code class="methodname">getId()</code> method</a></span></dt><dt><span class="sect2"><a href="#d5e1550">(Suppressing) contributed actions</a></span></dt><dt><span class="sect2"><a href="#d5e1572">(Suppressing) service menu items</a></span></dt><dt><span class="sect2"><a href="#d5e1581">(Suppressing) service menus</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1586">How to use a generic repository</a></span></dt><dt><span class="sect1"><a href="#sec.CustomRepository">How to write a custom repository</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1634">Finding by Title</a></span></dt><dt><span class="sect2"><a href="#d5e1650">Finding by Pattern</a></span></dt><dt><span class="sect2"><a href="#d5e1672">Finding using the <code class="classname">Filter</code> API</a></span></dt><dt><span class="sect2"><a href="#d5e1695">Finding using the <code class="classname">Query</code> API</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1739">Factories</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.ValueTypes">10. Value Types</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e1781">Built-in Value Types</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1785">JDK Types</a></span></dt><dt><span class="sect2"><a href="#d5e1863">Value formats</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1960">Custom Value Types</a></span></dt><dt><span class="sect1"><a href="#d5e1999">Third-party Value Types</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#prt.SupportingFeatures">III. Supporting Features</a></span></dt><dd><dl><dt><span class="chapter"><a href="#chp.Clock">11. Clock</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e2030">Lazily Instantiated</a></span></dt><dt><span class="sect1"><a href="#d5e2039">Possibly Replaceable</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.UserProfiles">12. Profiles</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e2053">Profiles and Perspectives</a></span></dt><dt><span class="sect1"><a href="#d5e2076">Runtime and Viewer Support</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.Fixtures">13. Fixtures and SwitchUser</a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.HowToRegisterFixtures">How to register fixtures</a></span></dt><dt><span class="sect1"><a href="#d5e2107">How to write custom fixtures</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2113"><code class="classname">InstallableFixture</code> and
          <code class="classname">FixtureType</code></a></span></dt><dt><span class="sect2"><a href="#d5e2133"><code class="classname">BaseFixture</code> and
          <code class="classname">AbstractFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e2166"><code class="methodname">DateFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e2177"><code class="methodname">SwitchUserFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e2197"><code class="classname">LogonFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e2204"><code class="classname">UserProfileFixture</code></a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#chp.XmlSnapshots">14. XML Snapshots</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e2234">Generating an XML Snapshot</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2238">Basic Usage</a></span></dt><dt><span class="sect2"><a href="#d5e2247">Including other Elements</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e2263">Using the Fluent API</a></span></dt><dt><span class="sect1"><a href="#d5e2268">The <code class="classname">SnapshottableWithInclusions</code>
        interface</a></span></dt><dt><span class="sect1"><a href="#d5e2277">Generating an XSD schema</a></span></dt><dt><span class="sect1"><a href="#d5e2284">Hints and Tips</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#prt.ReferenceAppendices">IV. Reference Appendices</a></span></dt><dd><dl><dt><span class="appendix"><a href="#d5e2296">A. Recognized Methods and Prefixes</a></span></dt><dt><span class="appendix"><a href="#d5e2568">B. Recognized Annotations</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e2575">@ActionOrder</a></span></dt><dt><span class="sect1"><a href="#d5e2594">@ActionSemantics</a></span></dt><dt><span class="sect1"><a href="#d5e2604">@AutoComplete</a></span></dt><dt><span class="sect1"><a href="#d5e2613">@Aggregated</a></span></dt><dt><span class="sect1"><a href="#d5e2621">@Bounded</a></span></dt><dt><span class="sect1"><a href="#sec.DebugAnnotation">@Debug</a></span></dt><dt><span class="sect1"><a href="#d5e2640">@Defaulted</a></span></dt><dt><span class="sect1"><a href="#d5e2650">@DescribedAs</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2658">Providing a description for an object</a></span></dt><dt><span class="sect2"><a href="#d5e2664">Providing a description for an object member</a></span></dt><dt><span class="sect2"><a href="#d5e2670">Providing a description for an action parameter</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e2676">@Disabled</a></span></dt><dt><span class="sect1"><a href="#d5e2745">@Encodable</a></span></dt><dt><span class="sect1"><a href="#d5e2755">@EqualByContent</a></span></dt><dt><span class="sect1"><a href="#d5e2764">@Executed</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2770">Forcing a method to be executed on the client</a></span></dt><dt><span class="sect2"><a href="#d5e2774">Forcing a method to be executed on the server</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.ExplorationAnnotation">@Exploration</a></span></dt><dt><span class="sect1"><a href="#d5e2789">@Facets</a></span></dt><dt><span class="sect1"><a href="#d5e2798">@FieldOrder</a></span></dt><dt><span class="sect1"><a href="#sec.HiddenAnnotation">@Hidden</a></span></dt><dt><span class="sect1"><a href="#d5e2882">@Idempotent (deprecated)</a></span></dt><dt><span class="sect1"><a href="#d5e2886">@Ignore (deprecated)</a></span></dt><dt><span class="sect1"><a href="#d5e2893">@Immutable</a></span></dt><dt><span class="sect1"><a href="#sec.MaskAnnotation">@Mask</a></span></dt><dt><span class="sect1"><a href="#sec.MaxLengthAnnotation">@MaxLength</a></span></dt><dt><span class="sect1"><a href="#sec.MemberGroupsAnnotation">@MemberGroups</a></span></dt><dt><span class="sect1"><a href="#sec.MemberOrderAnnotation">@MemberOrder</a></span></dt><dt><span class="sect1"><a href="#d5e2984">@MultiLine</a></span></dt><dt><span class="sect1"><a href="#d5e3015">@MustSatisfy</a></span></dt><dt><span class="sect1"><a href="#sec.NamedAnnotation">@Named</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e3039">Specifying the name of an object</a></span></dt><dt><span class="sect2"><a href="#d5e3048">Specifying the name of a class member</a></span></dt><dt><span class="sect2"><a href="#d5e3057">Specifying the name for an action parameter</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.NotContributedAnnotation">@NotContributed</a></span></dt><dt><span class="sect1"><a href="#sec.NotInServiceMenuAnnotation">@NotInServiceMenu</a></span></dt><dt><span class="sect1"><a href="#not-persistable">@NotPersistable</a></span></dt><dt><span class="sect1"><a href="#d5e3108">@NotPersisted</a></span></dt><dt><span class="sect1"><a href="#d5e3116">@ObjectType</a></span></dt><dt><span class="sect1"><a href="#d5e3126">@Optional</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e3135">Making a property optional</a></span></dt><dt><span class="sect2"><a href="#d5e3144">Making an action parameter optional</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e3149">@Paged</a></span></dt><dt><span class="sect1"><a href="#d5e3164">@Parseable</a></span></dt><dt><span class="sect1"><a href="#sec.PluralAnnotation">@Plural</a></span></dt><dt><span class="sect1"><a href="#d5e3184">@Programmatic</a></span></dt><dt><span class="sect1"><a href="#sec.PrototypeAnnotation">@Prototype</a></span></dt><dt><span class="sect1"><a href="#d5e3206">@QueryOnly (deprecated)</a></span></dt><dt><span class="sect1"><a href="#sec.RegExAnnotation">@RegEx</a></span></dt><dt><span class="sect1"><a href="#d5e3227">@Resolve</a></span></dt><dt><span class="sect1"><a href="#sec.TitleAnnotation">@Title</a></span></dt><dt><span class="sect1"><a href="#d5e3258">@TypeOf</a></span></dt><dt><span class="sect1"><a href="#d5e3266">@TypicalLength</a></span></dt><dt><span class="sect1"><a href="#sec.ValueAnnotation">@Value</a></span></dt><dt><span class="sect1"><a href="#d5e3292">@ViewModel</a></span></dt></dl></dd><dt><span class="appendix"><a href="#apx.DomainObjectContainer">C. <code class="classname">DomainObjectContainer</code> interface</a></span></dt><dt><span class="appendix"><a href="#apx.SecurityClasses">D. Security Classes</a></span></dt><dt><span class="appendix"><a href="#apx.UtilityClasses">E. Utility Classes</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e3499">Title creation</a></span></dt><dt><span class="sect1"><a href="#d5e3506">Reason text creation (for disable and validate methods)</a></span></dt></dl></dd><dt><span class="appendix"><a href="#d5e3521">F. Events</a></span></dt><dt><span class="appendix"><a href="#d5e3532">G. Package Dependencies</a></span></dt></dl></dd></dl></div><div class="list-of-tables"><p><b>List of Tables</b></p><dl><dt>4.1. <a href="#d5e627">Object lifecycle methods</a></dt><dt>A.1. <a href="#d5e2300">Recognized Method Prefixes</a></dt><dt>A.2. <a href="#d5e2513">Deprecated Method Prefixes</a></dt><dt>C.1. <a href="#d5e3310">DomainObjectContainer methods (1 of 2)</a></dt><dt>C.2. <a href="#d5e3375">DomainObjectContainer methods (2 of 2)</a></dt></dl></div>
  

  

  

  <div class="preface" title="Preface"><div class="titlepage"><div><div><h2 class="title"><a name="preface"></a>Preface</h2></div></div></div>
    

    <p><span class="emphasis"><em>Apache Isis</em></span> is designed to allow programmers
    rapidly develop domain-driven applications following the <a class="ulink" href="http://en.wikipedia.org/wiki/Naked_Objects" target="_top">Naked Objects</a>
    pattern. It is made up of a core framework plus a number of alternate
    implementations, and supports various viewers and runtimes/object stores.
    Apache Isis is hosted at the <a class="ulink" href="http://incubator.apache.org/isis" target="_top">Apache Foundation</a>, and is
    licensed under <a class="ulink" href="http://www.apache.org/licenses/LICENSE-2.0.html" target="_top">Apache Software
    License v2</a>.</p>

    <p>This guide is written for programmers looking to understand the
    programming conventions, annotations and supporting utilities within the
    <span class="emphasis"><em>Apache Isis</em></span> application library (or
    <span class="emphasis"><em>applib</em></span>), in order that the framework can correctly
    pick up and render the business rules and logic encoded within their
    domain objects.</p>
  </div>

  

  <div class="chapter" title="Chapter&nbsp;1.&nbsp;Introduction"><div class="titlepage"><div><div><h2 class="title"><a name="d5e26"></a>Chapter&nbsp;1.&nbsp;Introduction</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d5e30">What's in this Guide</a></span></dt><dt><span class="sect1"><a href="#d5e40">This Guide vs the Core Documentation</a></span></dt><dt><span class="sect1"><a href="#d5e56">Where Next?</a></span></dt></dl></div>
    

    <div class="abstract" title="Abstract"><div class="titlepage"></div>
      <p>What this guide contains, who it is for, and how the applib
      relates to other parts of the framework.</p>
    </div>

    <div class="sect1" title="What's in this Guide"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e30"></a>What's in this Guide</h2></div></div></div>
      

      <p>This guide describes the set of conventions for writing domain
      objects, that are together known as the <span class="emphasis"><em>Apache Isis</em></span>
      Programming Model. It's important reading for developers who are looking
      to write domain-driven applications either for prototyping or deployment
      on <span class="emphasis"><em>Apache Isis</em></span>.</p>

      <p>More correctly, this guide actually documents the
      <span class="emphasis"><em>default</em></span> programming model, targetted for the Java
      programming language, and implemented by the
      <code class="classname">org.apache.isis.progmodels:dflt</code> module.
      <span class="emphasis"><em>Isis</em></span> is in fact capable of supporting different
      programming models, either for other JVM-based languages; for example
      the Groovy language is supported in the
      <code class="classname">org.apache.isis.progmodels:groovy</code> module. Those
      other programming models have their own documentation.</p>
    </div>

    <div class="sect1" title="This Guide vs the Core Documentation"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e40"></a>This Guide vs the Core Documentation</h2></div></div></div>
      

      <p>This guide assumes that you have at least the outline of a running
      <span class="emphasis"><em>Apache Isis</em></span> application, for example having run the
      quickstart archetype. Details of how to run the quickstart archetype can
      be found on the <span class="emphasis"><em>Isis</em></span> <a class="ulink" href="http://incubator.apache.org/isis" target="_top">website</a>.</p>

      <p>This guide has two main objectives:</p>

      <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
          <p>to describe the general approach for developing Isis
          applications solely by writing domain objects</p>
        </li><li class="listitem">
          <p>to describe the specifics of writing domain objects according
          to the conventions of the <span class="emphasis"><em>default</em></span> programming
          model.</p>
        </li></ul></div>

      <p>The core documentation, on the other hand, explains the wider
      landscape of what makes up an <span class="emphasis"><em>Isis</em></span> application,
      dealing with such matters as running the app with different components,
      eg viewers, security, programming models, profile stores and
      runtimes/object stores. Included within this is an explanation of how
      you can build your <span class="emphasis"><em>own</em></span> programming model (typically
      as a subset of the default programming model described here, but
      possibly with additional custom elements).</p>
    </div>

    <div class="sect1" title="Where Next?"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e56"></a>Where Next?</h2></div></div></div>
      

      <p>This guide is in several parts. The first part is intended to
      explain, from a developers' perspective, what exactly <span class="emphasis"><em>Apache
      Isis</em></span> is. The second part has chapters that describe the
      specifics in the style of recipes/cookbooks, providing a "how-to" guide
      on developing domain objects. The third part provides details on other
      supporting features relevant to writing domain applications. The final
      part is a series of appendices that provide details of the programming
      model in reference form. You should find this more useful if you've used
      <span class="emphasis"><em>Isis</em></span> for a while and just need to check on a
      specific detail.</p>
    </div>
  </div>

  <div class="part" title="Part&nbsp;I.&nbsp;Understanding Apache Isis"><div class="titlepage"><div><div><h1 class="title"><a name="prt.UnderstandingApacheIsis"></a>Part&nbsp;I.&nbsp;Understanding Apache Isis</h1></div></div></div>
    

    <div class="partintro" title="Understanding Apache Isis"><div></div>
      <p>The chapters in this part of the guide are intended to help you
      understand <span class="emphasis"><em>Apache Isis</em></span> from a developers'
      perspective:</p>

      <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
          <p>the principles and patterns that underpin
          <span class="emphasis"><em>Isis</em></span> (<a class="xref" href="#chp.PrinciplesAndPatterns" title="Chapter&nbsp;2.&nbsp;Apache Isis and Naked Objects">Chapter&nbsp;2, <i>Apache Isis and Naked Objects</i></a>)</p>
        </li><li class="listitem">
          <p>a development process to follow (<a class="xref" href="#chp.DevelopmentProcess" title="Chapter&nbsp;3.&nbsp;A Development Process">Chapter&nbsp;3, <i>A Development Process</i></a>)</p>
        </li></ul></div>
    <div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="chapter"><a href="#chp.PrinciplesAndPatterns">2. Apache Isis and Naked Objects</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e84">Apache Isis implements the naked objects pattern... but what is
        that, exactly?</a></span></dt><dt><span class="sect1"><a href="#d5e91">What type of applications are best suited to Isis?</a></span></dt><dt><span class="sect1"><a href="#d5e99">And are there applications where the OO UIs generated by Isis
        are less suitable?</a></span></dt><dt><span class="sect1"><a href="#d5e112">What is the typical development process life cycle for
        applications built with Isis, and how does it compare to traditional
        application development process?</a></span></dt><dt><span class="sect1"><a href="#d5e144">What are the limitations of Apache Isis framework?</a></span></dt><dt><span class="sect1"><a href="#d5e172">How extensive is the application security support provided by
        Isis?</a></span></dt><dt><span class="sect1"><a href="#d5e187">How does an Isis applications manage the custom logic in terms
        of business rules, workflow and other business logic that developers
        have to manually implement outside the generated code?</a></span></dt><dt><span class="sect1"><a href="#d5e192">How does Isis support SOA-based applications, eg where an
        enterprise service component is consumed by several different
        applications and other clients?</a></span></dt><dt><span class="sect1"><a href="#d5e208">Most enterprise applications need to reuse the domain and
        service layer classes between several different applications. How does
        Apache Isis address this?</a></span></dt><dt><span class="sect1"><a href="#d5e225">What is the future road map of the project?</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.DevelopmentProcess">3. A Development Process</a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.ApplicationArchetypes">Run the Quickstart Archetype</a></span></dt><dt><span class="sect1"><a href="#d5e250">Programming Model</a></span></dt><dt><span class="sect1"><a href="#d5e258">Fixtures and Prototyping</a></span></dt><dt><span class="sect1"><a href="#sec.Viewers">Viewers</a></span></dt><dt><span class="sect1"><a href="#sec.AgileTesting">Agile Testing</a></span></dt><dd><dl><dt><span class="sect2"><a href="#sec.BddTesting">Story (BDD) Testing</a></span></dt><dt><span class="sect2"><a href="#sec.UnitTesting">Unit Testing</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e322">A Domain Library</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e331">Domain Services</a></span></dt><dt><span class="sect2"><a href="#d5e343">Domain Values</a></span></dt><dt><span class="sect2"><a href="#d5e355">Domain Entities</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DeployingAnIsisApplication">Deploying an Isis Application</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e365">Persistence (the Default Runtime / Object Store)</a></span></dt><dt><span class="sect2"><a href="#d5e398">Authentication and Authorization</a></span></dt></dl></dd></dl></dd></dl></div></div>

    <div class="chapter" title="Chapter&nbsp;2.&nbsp;Apache Isis and Naked Objects"><div class="titlepage"><div><div><h2 class="title"><a name="chp.PrinciplesAndPatterns"></a>Chapter&nbsp;2.&nbsp;Apache Isis and Naked Objects</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d5e84">Apache Isis implements the naked objects pattern... but what is
        that, exactly?</a></span></dt><dt><span class="sect1"><a href="#d5e91">What type of applications are best suited to Isis?</a></span></dt><dt><span class="sect1"><a href="#d5e99">And are there applications where the OO UIs generated by Isis
        are less suitable?</a></span></dt><dt><span class="sect1"><a href="#d5e112">What is the typical development process life cycle for
        applications built with Isis, and how does it compare to traditional
        application development process?</a></span></dt><dt><span class="sect1"><a href="#d5e144">What are the limitations of Apache Isis framework?</a></span></dt><dt><span class="sect1"><a href="#d5e172">How extensive is the application security support provided by
        Isis?</a></span></dt><dt><span class="sect1"><a href="#d5e187">How does an Isis applications manage the custom logic in terms
        of business rules, workflow and other business logic that developers
        have to manually implement outside the generated code?</a></span></dt><dt><span class="sect1"><a href="#d5e192">How does Isis support SOA-based applications, eg where an
        enterprise service component is consumed by several different
        applications and other clients?</a></span></dt><dt><span class="sect1"><a href="#d5e208">Most enterprise applications need to reuse the domain and
        service layer classes between several different applications. How does
        Apache Isis address this?</a></span></dt><dt><span class="sect1"><a href="#d5e225">What is the future road map of the project?</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>Understanding Apache Isis and the naked objects pattern by way
        of a series of questions and answers.</p>
      </div>

      <p>The headline feature that distinguishes <span class="emphasis"><em>Apache
      Isis</em></span> from other frameworks is its support for the naked
      objects pattern - the ability to generate a user interface (at runtime)
      directly from the domain model. However, there's much more to
      <span class="emphasis"><em>Apache Isis</em></span> than this.</p>

      <p>This chapter introduces the <span class="emphasis"><em>Apache Isis</em></span> and
      the naked objects pattern by way of a series of questions and answers.
      It is adapted from an <a class="ulink" href="http://www.infoq.com/articles/haywood-ddd-no" target="_top">interview originally
      published on InfoQ</a>.</p>

      <div class="sect1" title="Apache Isis implements the naked objects pattern... but what is that, exactly?"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e84"></a>Apache Isis implements the naked objects pattern... but what is
        that, exactly?</h2></div></div></div>
        

        <p>Naked objects is an architectural pattern where the idea is to
        automatically expose a domain model objects directly within a
        object-oriented user interface... not just their state (properties and
        collections) but also their behaviour (what we call actions). You can
        think of it as analogous to an <acronym class="acronym">ORM</acronym> such as <a class="ulink" href="http://hibernate.org" target="_top">Hibernate</a>; but whereas an
        <acronym class="acronym">ORM</acronym> reflects the domain model into the persistence
        layer, naked objects reflects the domain model into the presentation
        layer.</p>

        <p>Naked Objects (capitals) was a Java framework that implemented
        the naked objects (lower case) pattern. Since then, we've taken the
        original framework, along with a number of sister projects developed
        by the community, into the Apache Incubator. So, what was originally
        "Naked Objects" is now Apache Isis.</p>
      </div>

      <div class="sect1" title="What type of applications are best suited to Isis?"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e91"></a>What type of applications are best suited to Isis?</h2></div></div></div>
        

        <p>The naked objects pattern requires that your primary
        consideration is in building an object-oriented domain model, so it's
        most suitable for enterprise applications that have complex business
        rules where there's a desire to represented them within such a domain
        model. The idea - at least during the initial stages - is to build up
        a domain model quickly, and to get feedback from the domain experts by
        exploiting the framework's ability to expose that directly domain
        model within the user interface. A picture tells a thousand
        words.</p>

        <p>Apache Isis "sweet spot" are those applications that are used
        internally within the organization, by experienced users who are
        comfortable with the entities within the domain model, and just need
        an application that imposes as few constraints as possible on how it
        is used. These are sometimes called <span class="emphasis"><em>sovereign
        applications</em></span>. If you're a developer then your
        <acronym class="acronym">IDE</acronym> is probably the sovereign application you use
        the most, and how often did you use any of its wizards? And if you use
        telephone banking then you'll also know how frustrating a sovereign
        application can be that is too invasive in dictating the workflow...
        that poor person on the other end asks making apologies while she goes
        exits from one screen and then goes into another to check some detail
        on a bank account. The generic <acronym class="acronym">OO</acronym>
        <acronym class="acronym">UI</acronym>s generated by naked objects impose no such
        restrictions, and so are ideal for this sort of application.</p>
      </div>

      <div class="sect1" title="And are there applications where the OO UIs generated by Isis are less suitable?"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e99"></a>And are there applications where the OO UIs generated by Isis
        are less suitable?</h2></div></div></div>
        

        <p>The opposite of a sovereign application (above) is sometimes
        called a <span class="emphasis"><em>transient application</em></span>. These are ones
        used only occasionally or by inexperienced users, typically outside
        the organization (ie your customers), who don't know or care to know
        the domain model, and just want to be led through the system to
        accomplish some well-defined goal. A good example here is a check-in
        kiosk at an airport... you just want to get on the plane, and be given
        the opportunity to choose your seat. But you likely won't care which
        plane, or even plane type, nor who the pilot is; these are unimportant
        details.</p>

        <p>For this sort of application a generic <acronym class="acronym">OO</acronym>
        <acronym class="acronym">UI</acronym> that exposes lots of the domain is clearly not
        appropriate. Instead, we want an application that exposes view models
        rather than entities, and where the <acronym class="acronym">UI</acronym> can be
        customized. The view model object is responsible for managing the
        workflow for the user story, exposing just the subset of the domain
        that is relevant, and hiding the rest of the domain. We find that
        these view models can be layered on top of the entities once those
        entities are understood.</p>

        <p>Using view model objects is necessary but probably not
        sufficient for transient applications; we also usually need to
        customize the <acronym class="acronym">UI</acronym>. <span class="emphasis"><em>Apache Isis</em></span>
        has two viewers that allow the UI to be customized, one that provides
        a set of taglibs, and one that provides a set of <a class="ulink" href="http://wicket.apache.org" target="_top">Apache Wicket</a>
        components.</p>

        <p>Putting both of these techniques together (custom view models
        and views) means that Apache Isis is suitable for transient
        applications as well as sovereign applications. However, the former
        will necessarily take more work as opposed to the latter.</p>
      </div>

      <div class="sect1" title="What is the typical development process life cycle for applications built with Isis, and how does it compare to traditional application development process?"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e112"></a>What is the typical development process life cycle for
        applications built with Isis, and how does it compare to traditional
        application development process?</h2></div></div></div>
        

        <p>The main difference you're likely to encounter is the emphasis
        on developing the domain model at the same time as identifying and
        prioritizing user stories, what those practicing domain driven design
        call a "ubiquitous language" for the team.</p>

        <p>So, rather than let the developers in the team "discover" the
        domain model as part of story implementation, we'd expect that the
        domain experts/business analysts have already identified some of the
        main domain concepts through prototyping or spikes, and these can be
        used to help communicate the stories to the developers during the
        planning game. Not every business analyst is going to feel comfortable
        working with an <acronym class="acronym">IDE</acronym>, but it works well to pair with
        a developer. Because an Apache Isis application can be runs just from
        domain classes, it's possible to develop the app very very quickly.
        We've found a good technique is to run workshops with the business
        analyst facilitating the meeting with the domain experts, and the
        developer acting as "code monkey" to rapidly convert the ideas into an
        app. Obviously the code isn't production quality, but it allows the
        team as a whole to go very quickly and experiment with different
        representations of the model.</p>

        <p>Another alternative is to go a little more slowly, and have the
        analyst and developer pairing to write production code. The analyst
        still focuses on identifying and naming the domain concepts and their
        relationships, while the developer's role (as well as learning about
        the domain) is to ensure that there's enough rigour and tests around
        the code that's been written while this is being done. Of course, both
        approaches to pairing can be used, sometimes spiking ideas, sometimes
        going straight to writing tested code.</p>

        <p>Of course, while the naked objects pattern means that no
        <acronym class="acronym">UI</acronym> code needs to be written in order to elicit
        feedback, there do still need to be objects in the app for the domain
        expert to view. Apache Isis has a pluggable runtime/persistence layer,
        and for prototyping and most of development we recommend using the
        in-memory object store. To populate this object store for each run we
        use fixtures, which we usually arrange into a composite pattern to
        setup data needed for the particular scenario we might be working on.
        Using Isis in this way means that we spend our time alternating
        between defining domain classes and writing fixture data. This can be
        a great benefit because it helps the domain experts - who after all
        aren't necessarily technical - distinguish between what are classes
        and what are instances of classes. For example, if I'm writing a
        library system and we identify there are loanable books and reference
        books, we need to know whether "loanable book" and "reference book"
        are different subclasses of a book superclass, or merely different
        instances of a book class with, say, a loanable property set to true
        or false. Seeing a running application makes it much easier for the
        domain expert to make the call.</p>

        <p>In terms of writing tests, there are several options. First,
        because the domain objects you write are basically pojos that follow
        some naming conventions, they are very easy to test using standard
        <acronym class="acronym">TDD</acronym> tools such as <a class="ulink" href="http://junit.org" target="_top">JUnit</a> and <a class="ulink" href="http://jmock.org" target="_top">JMock</a>. And if you wanted to, you could
        test the <acronym class="acronym">UI</acronym> generated by Isis using <a class="ulink" href="http://seleniumhq.org/" target="_top">Selenium</a> and similar; indeed we'd
        recommend that if you've customized the <acronym class="acronym">UI</acronym>.</p>

        <p>In addition, though, Isis provides a couple of additional
        BDD/testing framework integrations. One of these is an integration
        with <a class="ulink" href="http://fitnesse.org" target="_top">FitNesse</a>, and a newer
        one we've worked on is an integration with <a class="ulink" href="http://concordion.org" target="_top">Concordion</a>. In both cases the
        integrations provide the glue code so you can exercise your domain
        objects directly. For example, your spec might say "the place order
        action cannot be invoked if the product is out of stock". All the
        developer needs to do is to wire the spec to these pre-canned
        integrations, specifying that the
        <code class="methodname">placeOrder()</code> action should be called on a
        <code class="classname">Product</code>.</p>

        <p>Isis also provides a JUnit runner that works by bootstrapping
        the Isis runtime for each test, and proxying the domain objects with a
        bit of cglib so that they are interacted with "as if" through the
        <acronym class="acronym">UI</acronym>. For example, let's go back to that
        <code class="methodname">placeOrder()</code> action. To prevent this from
        being called for a <code class="classname">Product</code> that's out of stock,
        the developer would write a corresponding
        <code class="methodname">validatePlaceOrder()</code> method. Isis
        automatically calls this validate method prior to the
        <code class="methodname">placeOrder()</code> method, and uses the return
        value ("that product is out of stock") as the reason why the action
        can't be invoked. In the <acronym class="acronym">UI</acronym>, this business rule is
        represented by greying out the OK button of the action. In the JUnit
        runner, this rule is represented by having the cglib proxy throw a
        validation exception if the test calls
        <code class="methodname">placeOrder()</code> with an out of stock
        <code class="classname">Product</code>.</p>

        <p>In terms of deployment, there's several steps involved, probably
        the most significant being to select the runtime and object store. As
        noted above, Isis has a pluggable persistence layer; you can use the
        in-memory object store for developing, but will want to switch to a
        "real" object store for deployment. The amount of work required here
        depends on the object store selected; in the case of
        <acronym class="acronym">JPA</acronym>/Hibernate support, for example, it amounts to
        annotating your domain entities with annotations, and writing
        implementations of some of the repositories to make the relevant
        <acronym class="acronym">SQL</acronym> calls.</p>
      </div>

      <div class="sect1" title="What are the limitations of Apache Isis framework?"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e144"></a>What are the limitations of Apache Isis framework?</h2></div></div></div>
        

        <p>It's certainly true that naked objects pattern implemented by
        <span class="emphasis"><em>Apache Isis</em></span> is opinionated, so if you don't agree
        with all of its opinions then you're going to find it limiting in one
        way or another.</p>

        <p>The first of these is that everything that the user wants to
        interact with has to be an object of some sort. As already explained,
        for sovereign applications, these are likely to be the persisted
        domain entities, but for a transient application, the object may be a
        view model to be support a particular workflow, and which may or may
        not be persisted. Such an approach probably wouldn't be considered
        much of a limitation, but it's worth contrasting with architectures
        (eg Spring Web Flow or Struts) where put the responsibility for
        tracking workflow lives not in an object but instead within some sort
        of declarative XML markup (or even just in the interplay between
        controllers and views).</p>

        <p>A slightly more subtle consequence of the above is that
        integration of different technologies happens through the domain
        objects, rather than in front of them through application-layer or
        <acronym class="acronym">UI</acronym> layer mashups. For example, supposing that we
        wanted to have an <acronym class="acronym">SMS</acronym> sent out to confirm a
        checkout. If you were writing the <acronym class="acronym">UI</acronym> and
        application service layer yourself, you might choose to have the
        application layer make the call to the <acronym class="acronym">SMS</acronym> service,
        judging it to be a coordination responsibility. With
        <span class="emphasis"><em>Isis</em></span>, though, you don't get the chance to write
        any application layer code, and so this would be done by having the
        domain object call out to the <acronym class="acronym">SMS</acronym> service. The
        <acronym class="acronym">SMS</acronym> service would be defined by an interface, and
        the implementation would be injected into the domain object by the
        framework. For some reason not everyone is necessarily comfortable
        about injecting domain services into entities; but it works well for
        us and we're sticking with it.</p>

        <p>Another area where <span class="emphasis"><em>Isis</em></span> is going to feel
        different - and perhaps limiting to some - is that it pushes some
        responsibilities onto the domain objects that otherwise might sit in
        other layers. For example, above we discussed that a
        <code class="methodname">placeOrder()</code> action on a
        <code class="classname">Customer</code> can have a supporting
        <code class="methodname">validatePlaceOrder()</code> method. It's also
        possible to have <code class="methodname">disablePlaceOrder()</code> method,
        which if returning non-null will cause the action to be greyed out the
        action in the <acronym class="acronym">UI</acronym>. For example, a blacklisted
        <code class="classname">Customer</code> might not allow any orders to be
        placed, and would indicate this through the disable method. Some might
        consider this as a misplaced presentation concern. However, the
        <code class="classname">Customer</code> isn't greying out the
        <acronym class="acronym">UI</acronym> itself; the disable method is merely a
        convention by which the presentation layer can interrogate the
        entity.</p>

        <p>Something else we hear sometimes about naked objects-style
        systems is that they are really only suitable for
        <acronym class="acronym">CRUD</acronym> style applications. It has to be said that
        it's a criticism that does irk; because although its true that naked
        objects frameworks automatically expose object state, they also expose
        object's behaviour. That is, every public method that is not a
        property or a collection is taken to be an action and will rendered by
        the <acronym class="acronym">UI</acronym> as a button or a link. Indeed, we sometimes
        like to talk of behaviourally complete domain objects; it's the very
        antithesis of the anaemic domain model anti-pattern.</p>

        <p>All the above notwithstanding, probably the biggest impediment
        to going out and using Isis right now is that it's a small community
        and as such the codebase is still relatively new. But if that is a
        turn-off, note that you can still use Apache Isis to prototype your
        domain model, because they are just pojos after all. Indeed, embedding
        Isis' metamodel for a deployment hosted on some other framework is the
        objective of the <span class="emphasis"><em>embedded runtime</em></span> component of
        Isis</p>
      </div>

      <div class="sect1" title="How extensive is the application security support provided by Isis?"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e172"></a>How extensive is the application security support provided by
        Isis?</h2></div></div></div>
        

        <p><span class="emphasis"><em>Apache Isis</em></span> exposes a pluggable
        authentication <acronym class="acronym">API</acronym> and an authorization
        <acronym class="acronym">API</acronym>, with default implementations of both.</p>

        <p>The job of the authentication <acronym class="acronym">API</acronym> is to
        authenticate the user credentials and return the user Id and a set of
        roles for that user. This information is then used in one of two ways.
        The authorization <acronym class="acronym">API</acronym> uses it to implement
        declarative class-based security, that is, associating access to
        features based on the roles of the user. In addition, though, a domain
        object instance can also access the user credentials, and so can
        implement imperative instance-based checks if required.</p>

        <p>For example, we might say that only a user with
        <acronym class="acronym">HR</acronym> role can award pay rises to an
        <code class="classname">Employee</code>. This is a class-based check and would
        be implemented through the authorization <acronym class="acronym">API</acronym>. But,
        we might also say that a user is allowed to view (though not modify)
        their own salary of their <code class="classname">Employee</code> object, but
        no-one else's. This would be an instance-based check, and would be
        implemented in the object itself.</p>

        <p>In terms of how naked objects restricts access, this is done
        either by making an object member (property, collection or action)
        invisible, or, if it is visible, then making it unusable (greyed
        out).</p>
      </div>

      <div class="sect1" title="How does an Isis applications manage the custom logic in terms of business rules, workflow and other business logic that developers have to manually implement outside the generated code?"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e187"></a>How does an Isis applications manage the custom logic in terms
        of business rules, workflow and other business logic that developers
        have to manually implement outside the generated code?</h2></div></div></div>
        

        <p>"Business rules" is one of those amorphous terms that means
        different things to different people. A consequence is that the team
        can struggle to nail down exactly where such rules should reside, so
        that these rules can start to leach out of the domain layer and the
        application layer, or even worse, the presentation layer. As noted
        already, one of the principles of naked objects is that domain objects
        are behaviourally complete. What that means is that business rules and
        "other business logic" are the responsibility of domain objects. For
        workflow, again as noted earlier, we suggest that you introduce a view
        model object and have that manage the user's interaction.</p>

        <p>However, saying that business rules are an object's
        responsibility doesn't necessarily mean that the implementation has to
        be in Java. We already said that domain objects can delegate work out
        to domain services that are injected into them. So if you want to put
        your business rules into a rules engine, that's fine. Wrap the
        interface to the rules engine within a domain service, and have the
        domain object call out to the domain service in order to fulfil its
        responsibility.</p>

        <p>In practical terms, you're going to see business rules both in
        the small-scale and the large. Small-scale business rules tend to be
        implemented in terms of the supporting methods (disable, validate and
        so on) that encode the preconditions for interactions. These ensure
        that the object or the providing arguments is are valid and will veto
        the interaction otherwise (blacklisted customers, out-of-stock
        products). The larger-scale business rules are represented as actions
        on an object that can perform arbitrary business logic, such as
        modifying its own state, or related objects, and/or delegating out to
        domain services.</p>
      </div>

      <div class="sect1" title="How does Isis support SOA-based applications, eg where an enterprise service component is consumed by several different applications and other clients?"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e192"></a>How does Isis support SOA-based applications, eg where an
        enterprise service component is consumed by several different
        applications and other clients?</h2></div></div></div>
        

        <p>We can actually answer this both in terms of an Isis application
        consuming <acronym class="acronym">SOA</acronym><sup>[<a name="d5e196" href="#ftn.d5e196" class="footnote">1</a>]</sup> services, and in it <span class="emphasis"><em>providing</em></span>
        services.</p>

        <p>For consuming <acronym class="acronym">SOA</acronym> services, the answer is
        easy enough: wrap the <acronym class="acronym">SOA</acronym> service in a domain
        service interface, and then register the implementation with the
        framework so that the service is injected into each domain object.
        That interaction can be either synchronous or asynchronous; there's
        nothing to prevent the domain object publishing an event to be picked
        up by some other component out there on your enterprise service
        bus.</p>

        <p>As to providing <acronym class="acronym">SOA</acronym> services, Isis'
        <acronym class="acronym">JSON</acronym> viewer exposes the domain objects as a set of
        RESTful resources. We map objects and object members to the standard
        <acronym class="acronym">HTTP</acronym> verbs, eg so that a GET on an object returns
        an object representation, a PUT on an object's property will modify
        the state, or a POST on an object's actions will invoke the action. As
        its name suggests, the <acronym class="acronym">JSON</acronym> viewer produces a
        <acronym class="acronym">JSON</acronym> representation, making it easy to consume (eg
        in HTML5 or RIA applications).</p>
      </div>

      <div class="sect1" title="Most enterprise applications need to reuse the domain and service layer classes between several different applications. How does Apache Isis address this?"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e208"></a>Most enterprise applications need to reuse the domain and
        service layer classes between several different applications. How does
        Apache Isis address this?</h2></div></div></div>
        

        <p>One way to think of reuse in terms of strategic domain-driven
        design, which couches the discussion in terms of identifying bounded
        contexts and understanding the relationship between these contexts -
        context maps.</p>

        <p>You can think of a bounded context as both the user population
        that understands a particular ubiquitous language as well as the
        actual system that they use. For example, the term "Customer" is going
        to mean one thing to the marketing department, but a potentially
        different thing to those in shipping. Those two user populations
        therefore have incompatible languages, and so any integration of
        systems that support both sets of users will need to explicitly map
        their meanings of those terms.</p>

        <p>Simplifying somewhat, an Isis (naked objects) application can be
        thought of in three parts: the domain model objects themselves, the
        viewer that provides a channel to interact with the domain model, and
        the domain services that are used by the domain model objects. The
        domain model objects encode a ubiquitous language for a particular
        bounded context, so it only makes sense to reuse them by users who
        have the same understanding of that language. We can if we want use
        view model objects to provide projections of the domain entities to
        different subsets of that user population, but all must agree with
        what a Customer is, even if they use different parts of said
        Customer.</p>

        <p>Viewers are channels by which the domain model is accessed.
        <span class="emphasis"><em>Apache Isis</em></span> has viewers that expose the domain
        model as either a desktop app or as a webapp, and also has a RESTful
        viewer (producing <acronym class="acronym">JSON</acronym>) which allow the view model
        objects/domain objects to be surfaced as RESTful resources. In
        <acronym class="acronym">DDD</acronym> terms the RESTful viewers are examples of an
        "open host service" context mapping from some client bounded context
        up to our model's context.</p>

        <p>With respect to domain services, these are not reusable per se,
        rather they allow the domain objects to be the client of some other
        service within the enterprise. That said, one common type of domain
        service is to provide an interface to an enterprise service bus, in
        which case the domain objects can publish events onto that bus. In
        <acronym class="acronym">DDD</acronym> terms this would be an example of a "published
        language" context mapping; the downstream systems consuming the events
        of the publishing domain objects.</p>

        <p>Naked objects also allows a somewhat finer-grained level of
        reuse; indeed its support for "don't repeat yourself" is one of the
        reasons that some people are attracted to the pattern. For example, if
        we declare a property or an action parameter to be a date, then the
        viewers will automatically provide a date chooser widget for that
        property or parameter unless indicated otherwise. Or, if a property's
        type is an enum, then we'll get a drop-down box. It's the conventions
        of the naked objects programming model - establishing a protocol of
        interaction between the presentation layer and the domain model - that
        enable this sort of reuse.</p>

        <p>Some of Isis' more recent viewers also allow mashups within the
        <acronym class="acronym">UI</acronym>. For example, the viewer that we've implemented
        using Apache Wicket uses the chain of responsibility pattern to build
        the <acronym class="acronym">UI</acronym>. If we have an entity can provide its
        <code class="classname">Location</code> (eg, it implements
        <code class="classname">Locatable</code>), then a GoogleMapsWidget will render
        the entity in a map. Or, if an entity has a date, then a
        CalendarWidget might render the entity on a calendar. This stuff is
        extensible so you're free to write your own components and reuse (or
        indeed invent your own) domain semantics as you see fit.</p>
      </div>

      <div class="sect1" title="What is the future road map of the project?"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e225"></a>What is the future road map of the project?</h2></div></div></div>
        

        <p>Our proposal to join the incubator is online, and that captured
        the thoughts we had at that point in time <a class="ulink" href="http://wiki.apache.org/incubator/IsisProposal" target="_top">[1]</a>. A
        general theme is in the ongoing development of the various viewers,
        such as the Wicket viewer, improving JSON support within the RESTful
        viewers, and ongoing development of the taglib-based viewer, Scimpi.
        Contributors who have expressed interest in developing similar viewers
        using JSF/Facelets, Tapestry, on Android and in JavaFX/Visage.</p>

        <p>Isis has a pluggable architecture with about five major APIs
        (and numerous more fine-grained APIs) that can be developed. Probably
        the most significant of these is the runtime/persistence
        <acronym class="acronym">API</acronym>. One piece of work is to develop an ORM-based
        object store from Hibernate (which is not compatible with Apache's) to
        a compatible JPA implementation, We've also had a suggestion [<a class="ulink" href="https://issues.apache.org/jira/browse/ISIS-14" target="_top">2</a>] to
        re-implement using JDO 3.0/DataNucleus, which would allow us to cover
        a lot of persistence technologies in one fell swoop</p>

        <p>Another objective during incubation is to make Isis more easily
        bootstrappable and embeddable, and for that JSR-299 (Contexts and
        Dependency Injection) looks promising. For example, it should be easy
        to take just the <span class="emphasis"><em>Isis</em></span> metamodel component and use
        it within your own applications, eg to drive the rendering of domain
        objects within custom <acronym class="acronym">UI</acronym> code.</p>

        <p>One other area we might see work is in support for other JVM
        languages. Isis already supports Groovy as well as Java, and the way
        that Isis builds up its metamodel means that supporting other
        languages (Scala, Fantom, Go) ought to be pretty
        straightforward.</p>

        <p>Ultimately, though, Apache Isis' roadmap depends on where its
        community wants to take it; so any of the above might change as we
        progress through to graduation.</p>
      </div>
    <div class="footnotes"><br><hr width="100" align="left"><div class="footnote">
            <p><sup>[<a id="ftn.d5e196" href="#d5e196" class="para">1</a>] </sup>SOA=Service Oriented Architecture</p>
          </div></div></div>

    <div class="chapter" title="Chapter&nbsp;3.&nbsp;A Development Process"><div class="titlepage"><div><div><h2 class="title"><a name="chp.DevelopmentProcess"></a>Chapter&nbsp;3.&nbsp;A Development Process</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#sec.ApplicationArchetypes">Run the Quickstart Archetype</a></span></dt><dt><span class="sect1"><a href="#d5e250">Programming Model</a></span></dt><dt><span class="sect1"><a href="#d5e258">Fixtures and Prototyping</a></span></dt><dt><span class="sect1"><a href="#sec.Viewers">Viewers</a></span></dt><dt><span class="sect1"><a href="#sec.AgileTesting">Agile Testing</a></span></dt><dd><dl><dt><span class="sect2"><a href="#sec.BddTesting">Story (BDD) Testing</a></span></dt><dt><span class="sect2"><a href="#sec.UnitTesting">Unit Testing</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e322">A Domain Library</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e331">Domain Services</a></span></dt><dt><span class="sect2"><a href="#d5e343">Domain Values</a></span></dt><dt><span class="sect2"><a href="#d5e355">Domain Entities</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DeployingAnIsisApplication">Deploying an Isis Application</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e365">Persistence (the Default Runtime / Object Store)</a></span></dt><dt><span class="sect2"><a href="#d5e398">Authentication and Authorization</a></span></dt></dl></dd></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>This chapter describes the general approach to follow that we
        recommend for developing domain-driven applications on Isis.</p>
      </div>

      <p>There's quite a lot to <span class="emphasis"><em>Apache Isis</em></span>, with lots
      of optional components, and we do recognize that it may be difficult to
      know how to get going. This chapter outlines a development process which
      you can use as the basis for developing your own way of working.</p>

      <div class="sect1" title="Run the Quickstart Archetype"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.ApplicationArchetypes"></a>Run the Quickstart Archetype</h2></div></div></div>
        

        <p>We tend to organize <span class="emphasis"><em>Isis</em></span> applications to
        follow a standard structure, and you can use the
        <span class="emphasis"><em>quickstart</em></span> Maven archetype (see the
        <span class="emphasis"><em>Isis</em></span> <a class="ulink" href="http://incubator.apache.org/isis" target="_top">website</a>) to set this up
        for you. This sets up a simple application that can be run
        out-of-the-box using the default runtime and in-memory object store,
        and supporting a number of the webapp viewers. The WAR file can be run
        either standalone from the command line or deployed to a servlet
        container such as Tomcat.</p>
      </div>

      <div class="sect1" title="Programming Model"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e250"></a>Programming Model</h2></div></div></div>
        

        <p>Once you've got the archetype application running, you're ready
        to start developing your own domain objects. But no matter what
        application you are developing, you'll need to understand the
        <span class="emphasis"><em>Isis programming model</em></span>.</p>

        <p>The programming model is the set of annotations and programming
        conventions that Isis recognizes. You'll find full details of the
        programming model in this guide; see <a class="xref" href="#prt.WritingDomainObjects" title="Part&nbsp;II.&nbsp;Writing Domain Objects">Part&nbsp;II, &#8220;Writing Domain Objects&#8221;</a>.</p>

        <p>In addition, the applib contains a small number of utilities
        which can be useful when writing your application: one such is the
        ability to create XML snapshots of your domain object graphs, see
        <a class="xref" href="#chp.XmlSnapshots" title="Chapter&nbsp;14.&nbsp;XML Snapshots">Chapter&nbsp;14, <i>XML Snapshots</i></a>.</p>
      </div>

      <div class="sect1" title="Fixtures and Prototyping"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e258"></a>Fixtures and Prototyping</h2></div></div></div>
        

        <p>We suggest that the fastest way to develop your application is
        to start prototyping using the in-memory object store (set up
        automatically by the quickstart archetype). The nice thing about
        working this way is that there is no database schema to slow you down;
        you can make changes and then rapidly try them out.</p>

        <p>On the other hand, the in-memory object store doesn't persist
        objects between runs, so you'll soon tire of continually recreating
        test objects to try out your changes. You should therefore use
        fixtures: blocks of code that are used to setup objects in the
        in-memory object store prior to the app running.</p>

        <p>You can find more information about using fixtures in <a class="xref" href="#chp.Fixtures" title="Chapter&nbsp;13.&nbsp;Fixtures and SwitchUser">Chapter&nbsp;13, <i>Fixtures and SwitchUser</i></a>. It's also worth knowing about fixtures
        because they are used when writing tests for your domain application
        (see <a class="xref" href="#sec.AgileTesting" title="Agile Testing">the section called &#8220;Agile Testing&#8221;</a>).</p>
      </div>

      <div class="sect1" title="Viewers"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.Viewers"></a>Viewers</h2></div></div></div>
        

        <p><span class="emphasis"><em>Apache Isis</em></span> allows the same domain object
        model to be consumed by multiple presentation layers. You'll find that
        the quickstart archetype sets up a webapp module that bundles together
        two of the viewers currently available, namely:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>The <acronym class="acronym">HTML</acronym> viewer (in
            <code class="filename">viewers/html</code>) provides a basic webapp.</p>

            <p>Other than tweaking <acronym class="acronym">CSS</acronym>, the views that
            it provides of objects cannot be customized.</p>
          </li><li class="listitem">
            <p>The <acronym class="acronym">JSON</acronym> viewer (in
            <code class="filename">viewers/restfulobjects</code>) which exposes your
            domain objects through a <a class="ulink" href="http://en.wikipedia.org/wiki/Representational_State_Transfer" target="_top">RESTful</a>
            interface.</p>

            <p>The intention of this viewer is to allow programmatic access
            to your domain objects from other (perhaps non-Java)
            clients.</p>
          </li><li class="listitem">
            <p>The <acronym class="acronym">BDD</acronym> viewer (in
            <code class="filename">viewers/</code>bdd) provides an integration with the
            <a class="ulink" href="http://concordion.org" target="_top">Concordion</a> BDD
            framework; see <a class="xref" href="#sec.BddTesting" title="Story (BDD) Testing">the section called &#8220;Story (BDD) Testing&#8221;</a>.</p>
          </li><li class="listitem">
            <p>The <acronym class="acronym">JUnit</acronym> viewer (in
            <code class="filename">viewers/junit</code>) uses wrappers and a custom
            Isis JUnit test class runner (<code class="code">IsisTestRunner</code>); see
            <a class="xref" href="#sec.UnitTesting" title="Unit Testing">the section called &#8220;Unit Testing&#8221;</a>.</p>
          </li></ul></div>
      </div>

      <div class="sect1" title="Agile Testing"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.AgileTesting"></a>Agile Testing</h2></div></div></div>
        

        <p><span class="emphasis"><em>Apache Isis</em></span> is very much aligned to agile
        development practices, and provides two complementary mechanisms for
        you to test-drive the development of your application. A story test
        (BDD ensures that the right system is built. A unit test ensures that
        the system is built right.</p>

        <div class="sect2" title="Story (BDD) Testing"><div class="titlepage"><div><div><h3 class="title"><a name="sec.BddTesting"></a>Story (BDD) Testing</h3></div></div></div>
          

          <p>Many agile practitioners use story tests as a means to capture
          the acceptance (or completion) criteria for high-level user stories.
          These story tests are typically captured in a non-programmatic form
          so that is understandable to domain experts as well as
          programmers.</p>

          <p><span class="emphasis"><em>Apache Isis</em></span> provides an out-of-the-box
          integration with <a class="ulink" href="http://concordion.org" target="_top">Concordion</a> (where the story test
          is captured as <acronym class="acronym">HTML</acronym>).<sup>[<a name="d5e305" href="#ftn.d5e305" class="footnote">2</a>]</sup>There is full coverage of how to use this integration
          in the <acronym class="acronym">BDD</acronym> viewer's
          (<code class="filename">viewers/bdd</code>) documentation.</p>
        </div>

        <div class="sect2" title="Unit Testing"><div class="titlepage"><div><div><h3 class="title"><a name="sec.UnitTesting"></a>Unit Testing</h3></div></div></div>
          

          <p>Unlike story tests, unit tests are normally written in a
          programming language, typically in a framework such as <a class="ulink" href="http://junit.org" target="_top">JUnit</a>.</p>

          <p>When writing unit tests, you have a choice. Since all the
          business logic in Isis applications is encapsulated in domain object
          pojos, you can just write unit tests using nothing more than JUnit
          and perhaps also a mocking library such as <a class="ulink" href="http://jmock.org" target="_top">JMock</a>.</p>

          <p>A slightly more sophisticated approach is to use the JUnit
          integrations and supporting classes of the Wrapper programming model
          . The idea of these utilities is to wrap your domain objects in
          proxies that apply the same rules as an <span class="emphasis"><em>Apache
          Isis</em></span> viewer. For example, if you try to change a property
          or invoke an action that is disabled, then the proxy will throw an
          exception. You write your test to pass if the exception is thrown,
          and failed otherwise (eg using
          <code class="code">@Test(expected=DisabledException.class)</code>).</p>

          <p>Full documentation for unit testing support is in the JUnit
          viewer's guide (<code class="filename">viewers/junit</code>).</p>
        </div>
      </div>

      <div class="sect1" title="A Domain Library"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e322"></a>A Domain Library</h2></div></div></div>
        

        <p>The idea behind the <code class="filename">domain</code> module is to
        provide some off-the-shelf code for you to use and adapt in your own
        applications. This code is fully tested (comes with tests), and is
        intended to be well-designed. Using code from the library should give
        you a kick-start in writing your own domain applications.</p>

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>The library is currently very modest, but we hope it might
          build up in time.</p>
        </div>

        <p>Of course, there's a limit to the complexity of the code that's
        included in the library, because every domain is different. But having
        a full set of tests should allow you to safely refactor the code to
        your own requirements.</p>

        <p>There's also no guarantee that the library will contain code for
        your specific requirement. But if you do write some domain logic that
        you think might be reusable by others, why not consider donating it
        back to Isis when you've done so?</p>

        <p>The domain library breaks out into three: services, entities and
        values.</p>

        <div class="sect2" title="Domain Services"><div class="titlepage"><div><div><h3 class="title"><a name="d5e331"></a>Domain Services</h3></div></div></div>
          

          <p><span class="emphasis"><em>Apache Isis</em></span> applications use
          <span class="emphasis"><em>domain service</em></span>s (a domain-driven design
          pattern) to allow objects to interact with other domains (or
          <span class="emphasis"><em>bounded context</em></span>s, to use the correct term).
          These domain services are automatically injected into each domain
          object as it is instantiated.</p>

          <p>Domain services split into two: those that interact with
          technical domains (such as sending email, or rendering
          <acronym class="acronym">PDF</acronym>s), and those that interact with business
          domains (such as general ledger, <acronym class="acronym">CRM</acronym>s or legacy
          systems).</p>

          <p>Obviously domain services that bridge to business domain
          services are always likely to be specific to each individual
          application. So the services in the
          <code class="filename">domain/services</code> module focus on providing
          off-the-shelf implementations for some of the more common
          <span class="emphasis"><em>technical</em></span> domain services.</p>
        </div>

        <div class="sect2" title="Domain Values"><div class="titlepage"><div><div><h3 class="title"><a name="d5e343"></a>Domain Values</h3></div></div></div>
          

          <p>As you probably would expect, <span class="emphasis"><em>Apache Isis</em></span>
          treats Java primitives, Java wrapper classes,
          <code class="classname">java.lang.String</code>,
          <code class="classname">java.math.BigDecimal</code> and
          <code class="classname">java.math.BigInteger</code> as immutable values, It
          allows <code class="classname">java.util.Date</code> and its subclasses
          (java.sql.Date, java.sql.Time and
          <code class="classname">java.sql.Timestamp</code>) to be treated as values
          also. In addition, it offers a small number of its own value types,
          such as <code class="classname">Money</code>.</p>

          <p>In addition, it is possible to extend Isis support for value
          types using its <code class="classname">@Value</code> annotation. We hope in
          time to provide out-of-the-box integrations for popular 3rd party
          libraries such as JodaTime.</p>
        </div>

        <div class="sect2" title="Domain Entities"><div class="titlepage"><div><div><h3 class="title"><a name="d5e355"></a>Domain Entities</h3></div></div></div>
          

          <p>In the future we hope that Isis will provide some well-defined
          and ready-tested domain entities for use in your systems. For
          example, a set of entities to model customers
          (<code class="classname">Customer</code>/<code class="classname">Name</code>/<code class="classname">Address</code>)
          might be useful in many systems.</p>
        </div>
      </div>

      <div class="sect1" title="Deploying an Isis Application"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.DeployingAnIsisApplication"></a>Deploying an Isis Application</h2></div></div></div>
        

        <p>There are two main decisions to make in deploying an
        <span class="emphasis"><em>Isis</em></span> application.</p>

        <div class="sect2" title="Persistence (the Default Runtime / Object Store)"><div class="titlepage"><div><div><h3 class="title"><a name="d5e365"></a>Persistence (the Default Runtime / Object Store)</h3></div></div></div>
          

          <p>In the same way that viewers provide pluggability for the
          "front-end", <span class="emphasis"><em>Apache Isis</em></span> also offers
          pluggability on the back-end, i.e. persistence.</p>

          <p>In fact, there are two decisions to be made here: which
          runtime to use, and (if using the default runtime), which object
          store to use. The default runtime is the one originally developed
          within the <span class="emphasis"><em>Naked Objects Framework</em></span>, and
          therefore has been inherited by <span class="emphasis"><em>Apache
          Isis</em></span>.<sup>[<a name="d5e372" href="#ftn.d5e372" class="footnote">3</a>]</sup>The default runtime is also the one configured by the
          quickstart archetype.</p>

          <p>If using the default runtime, you have the option of choosing
          the objectstore. As already discussed, the quickstart archetype
          configures the in-memory objectstore by default, which is great for
          rapid prototyping. However, at some point you will need to integrate
          with a "real" object store that persists object to some sort of
          serialized persistence.</p>

          <p>Of the object stores to provided by the default runtime, some
          are easy to configure, some more complex; some are only suitable for
          single-user apps, others for multi-users. Each of the object stores
          has its own documentation, so you can select the correct object
          store to choose:<sup>[<a name="d5e376" href="#ftn.d5e376" class="footnote">4</a>]</sup></p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>the <acronym class="acronym">XML</acronym> object store (in
              <code class="filename">objectstores/xml</code>) is designed for
              single-user systems, and persists to its own internal
              (proprietary) <acronym class="acronym">XML</acronym> format;</p>
            </li><li class="listitem">
              <p>the <acronym class="acronym">SQL</acronym> object store (in
              <code class="filename">objectstores/sql</code>) is a multi-user object
              store that persists to an <acronym class="acronym">RDBMS</acronym> (direct over
              <acronym class="acronym">JDBC</acronym>);</p>
            </li><li class="listitem">
              <p>the <acronym class="acronym">NoSQL</acronym> object store (in
              <code class="filename">objectstores/nosql</code>) is a multi-user object
              store that persists to NoSQL databases in JSON form.</p>
            </li></ul></div>

          <p>You'll also find coverage of the object store
          <acronym class="acronym">API</acronym> itself in the default runtime's
          documentation.</p>

          <p>Alternatively, the default runtime can be configured to
          support client/server remoting. This configuration only makes sense
          for the <acronym class="acronym">DnD</acronym> viewer, whereby it is configured as
          the client and a separate instance of Isis runs as the server.
          Again, full guidance is available in the default runtime's
          documentation.</p>
        </div>

        <div class="sect2" title="Authentication and Authorization"><div class="titlepage"><div><div><h3 class="title"><a name="d5e398"></a>Authentication and Authorization</h3></div></div></div>
          

          <p><span class="emphasis"><em>Apache Isis</em></span> provides an
          <acronym class="acronym">API</acronym>s for both authentication and
          authorization.</p>

          <p>The core implementation of these <acronym class="acronym">API</acronym>s are
          simple basic noop-based authentication and authorization mechanisms.
          For deployment into production, you'll need to configure with
          another alternative implementation.</p>

          <p>One option is the file-based implementation (in
          <code class="filename">security/file</code>), that stores the security
          information in flat files. This is simple, but unlikely to be robust
          enough for enterprise use.</p>

          <p>Another alternative is to use the <acronym class="acronym">LDAP</acronym>
          implementation (in <code class="filename">security/ldap</code>), which can
          integrate with an <acronym class="acronym">LDAP </acronym>infrastructure if you have
          one. If you have a different security infrastructure, then you might
          consider to write your own implementation (the
          <acronym class="acronym">API</acronym> is not complex).</p>
        </div>
      </div>
    <div class="footnotes"><br><hr width="100" align="left"><div class="footnote">
              <p><sup>[<a id="ftn.d5e305" href="#d5e305" class="para">2</a>] </sup>An integration with <a class="ulink" href="http://fitnesse.org" target="_top">FitNesse</a> (where the story test
              is captured within a wiki) also exists. Due to licensing this is
              not part of <span class="emphasis"><em>Isis</em></span> proper.</p>
            </div><div class="footnote">
              <p><sup>[<a id="ftn.d5e372" href="#d5e372" class="para">3</a>] </sup>At the time of writing the default runtime is the only
              real runtime available; however we expect to be developing
              lighter-weight replacements for the default runtime in the
              future.</p>
            </div><div class="footnote">
              <p><sup>[<a id="ftn.d5e376" href="#d5e376" class="para">4</a>] </sup>In addition to those listed here, there have also been
              objectstores for JPA (using Hibernate) and BerkeleyDB. These are
              currently not part of Apache Isis distribution because of
              incompatible licenses. Support for an ORM will in the future be
              provided either by porting the JPA object store to the default
              runtime, or, we may support it via a JDO-based new
              runtime.</p>
            </div></div></div>
  </div>

  <div class="part" title="Part&nbsp;II.&nbsp;Writing Domain Objects"><div class="titlepage"><div><div><h1 class="title"><a name="prt.WritingDomainObjects"></a>Part&nbsp;II.&nbsp;Writing Domain Objects</h1></div></div></div>
    

    <div class="partintro" title="Writing Domain Objects"><div></div>
      <p>The conventions of the programming model are best described as
      'intentional' - they convey an intention as to how domain objects, their
      properties and behaviours, are to be made available to users. The
      specific way in which those intentions are interpreted or implemented
      will depend upon the framework, and/or the particular components or
      options selected within that framework.</p>

      <p>To pick a single example, marking up a domain class with the
      annotation <code class="code">@Bounded</code> is an indication that the class is
      intended to have only a small number of instances and that the set does
      not change very often - such as the class <code class="code">Country</code>. This is
      an indication to a viewer, for example, that the whole set of instances
      might be offered to the user in a convenient form such as a drop-down
      list. The programming convention has <span class="emphasis"><em>not</em></span> been
      defined as <code class="code">@DropDownList</code> because any equivalent mechanism
      will suffice: a viewer might not support drop-down-lists but instead
      might provide a capability to select from an <code class="code">@Bounded</code> class
      by typing the initial letters of the desired instance.</p>

      <p>This part of the guide is a set of chapters that provides how-to's
      for writing domain objects, by which we mean domain entities, value
      types, services and repositories/factories.</p>
    <div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="chapter"><a href="#chp.Objects">4. Domain Entities</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e429">How to not inherit from framework superclasses</a></span></dt><dt><span class="sect1"><a href="#d5e440">How to specify a title for an object</a></span></dt><dt><span class="sect1"><a href="#sec.HowToSpecifyTheIconForAnObjectsClass">How to specify the icon for an object's
        class</a></span></dt><dt><span class="sect1"><a href="#d5e483">How to specify the icon for an individual object's
        state</a></span></dt><dt><span class="sect1"><a href="#d5e494">How to specify a name and/or description for an
        object</a></span></dt><dt><span class="sect1"><a href="#d5e506">How to specify that an object should not be
        persisted</a></span></dt><dt><span class="sect1"><a href="#sec.Immutable">How to specify that an object should
        never be modified by the user</a></span></dt><dt><span class="sect1"><a href="#sec.Entity.Disabled">How to control when an object can be modified</a></span></dt><dt><span class="sect1"><a href="#sec.Entity.Hidden">How to control when an object is visible</a></span></dt><dt><span class="sect1"><a href="#sec.Bounded">How to specify that a class of objects has a limited number of
        instances</a></span></dt><dt><span class="sect1"><a href="#sec.HowToCreateAnObject">How to create or delete objects within your code</a></span></dt><dt><span class="sect1"><a href="#sec.LifecycleMethods">How to insert behaviour into the object life cycle</a></span></dt><dt><span class="sect1"><a href="#sec.ResolveAndObjectChanged">How to perform lazy loading (generally done
        automatically)</a></span></dt><dt><span class="sect1"><a href="#d5e687">How to perform dirty object tracking (generally done
        automatically)</a></span></dt><dt><span class="sect1"><a href="#d5e696">How to ensure object is in valid state</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.Properties">5. Domain Entity Properties</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e720">How to add a property to an object</a></span></dt><dt><span class="sect1"><a href="#d5e739">How to specify a name and/or description for a property</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e741">Specifying the name for a property</a></span></dt><dt><span class="sect2"><a href="#d5e747">Specifying a description for a property</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.MemberOrderForProperties">How to specify the order in which properties are
        displayed</a></span></dt><dt><span class="sect1"><a href="#d5e761">How to make a property optional (when saving an object)</a></span></dt><dt><span class="sect1"><a href="#sec.SizeProperties">How to specify the size of <code class="classname">String</code>
        properties</a></span></dt><dt><span class="sect1"><a href="#sec.DerivedProperty">How to make a derived property</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e786">Lazily derived</a></span></dt><dt><span class="sect2"><a href="#d5e797">Eagerly derived</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.HiddenProperty">How to hide a property from the user</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e813">Hiding a property always</a></span></dt><dt><span class="sect2"><a href="#d5e819">Hiding a property based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e830">Hiding a property under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e841">Hiding a property for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DisabledProperty">How to prevent a property from being modified</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e854">Disabling a property permanently</a></span></dt><dt><span class="sect2"><a href="#d5e861">Disabling a property based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e872">Disabling a property under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e885">Disabling a property for certain users/roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e890">How to validate user input for a property</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e892">Declarative validation</a></span></dt><dt><span class="sect2"><a href="#d5e907">Imperative validation</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DefaultPropertyValue">How to set up the initial value of a property
        programmatically</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e924">By each property's default values</a></span></dt><dt><span class="sect2"><a href="#d5e933">By the <code class="methodname">created()</code> lifecycle
          method</a></span></dt><dt><span class="sect2"><a href="#d5e940">Programmatically, by the creator</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e946">How to specify a set of choices for a property</a></span></dt><dt><span class="sect1"><a href="#sec.ModifyAndClear">How to trigger other behaviour when a property is
        changed</a></span></dt><dt><span class="sect1"><a href="#d5e983">How to setup a bidirectional relationship</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.Collections">6. Domain Entity Collections</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e1000">How to add a collection to an object</a></span></dt><dt><span class="sect1"><a href="#d5e1024">How to specify a name and/or description for a
        collection</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1026">Specifying the name for a collection</a></span></dt><dt><span class="sect2"><a href="#d5e1032">Specifying a description for a collection</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.MemberOrderForCollections">How to specify the order in which collections are
        displayed</a></span></dt><dt><span class="sect1"><a href="#d5e1046">How to make a derived collection</a></span></dt><dt><span class="sect1"><a href="#sec.HiddenCollection">How to hide a collection</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1059">Hiding a collection permanently</a></span></dt><dt><span class="sect2"><a href="#d5e1065">Hiding a collection based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e1076">Hiding a collection under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e1087">Hiding a collection for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DisabledCollection">How to prevent a collection from being modified</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1098">Disabling a collection permanently</a></span></dt><dt><span class="sect2"><a href="#d5e1107">Disabling a collection based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e1118">Disabling a collection under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e1127">Disabling a collection for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1132">How to validate an object being added or removed</a></span></dt><dt><span class="sect1"><a href="#sec.AddToRemoveFrom">How to trigger other behaviour when an object is added or
        removed</a></span></dt><dt><span class="sect1"><a href="#sec.MutualRegistrationPattern">How to maintain bidirectional relationships</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.Actions">7. Domain Entity Actions</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e1185">How to add an action to an object</a></span></dt><dt><span class="sect1"><a href="#d5e1215">How to specify names and/or description for an action</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1217">Specifying the name for an action</a></span></dt><dt><span class="sect2"><a href="#d5e1223">Specifying a description for a collection</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1229">How to specify the order in which actions appear on the
        menu</a></span></dt><dt><span class="sect1"><a href="#sec.HiddenActions">How to hide an action</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1240">Hiding an action permanently</a></span></dt><dt><span class="sect2"><a href="#d5e1247">Hiding an action based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e1258">Hiding an action under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e1274">Hiding an action for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DisabledAction">How to prevent an action from being invoked</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1285">Disabling an action permanently</a></span></dt><dt><span class="sect2"><a href="#d5e1289">Disabling an action based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e1301">Based on the state of the object</a></span></dt><dt><span class="sect2"><a href="#d5e1313">Disabling an action for certain users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1318">How to specify names and/or descriptions for an action
        parameter</a></span></dt><dt><span class="sect1"><a href="#d5e1329">How to specify the size of <code class="classname">String</code> action
        parameters</a></span></dt><dt><span class="sect1"><a href="#d5e1348">How to make an action parameter optional</a></span></dt><dt><span class="sect1"><a href="#d5e1352">How to validate an action parameter argument</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1354">Declarative validation</a></span></dt><dt><span class="sect2"><a href="#d5e1369">Imperative validation</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1383">How to specify default values for an action parameter</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1387">Per-parameter syntax (preferred)</a></span></dt><dt><span class="sect2"><a href="#d5e1394">All parameters syntax</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1402">How to specify a set of choices for an action parameter</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1408">Per parameter syntax (preferred)</a></span></dt><dt><span class="sect2"><a href="#d5e1416">All parameters syntax</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#d5e1425">8. Further Business Rule How-Tos</a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.MustSpecify">@MustSatisfy Specification</a></span></dt><dt><span class="sect1"><a href="#sec.BusinessRulesForCertainUsersOrRoles">Hiding, disabling or validating for specific users or
        roles</a></span></dt><dt><span class="sect1"><a href="#d5e1478">How to pass a messages and errors back to the user</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.DomainServices">9. Domain Services, Repositories and Factories</a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.AbstractService">How to not inherit from framework classes</a></span></dt><dt><span class="sect1"><a href="#sec.Services">How to register domain services, repositories and
        factories</a></span></dt><dt><span class="sect1"><a href="#d5e1528">How to inject services into entities</a></span></dt><dt><span class="sect1"><a href="#d5e1535">How to write a typical domain service</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1542">The <code class="methodname">getId()</code> method</a></span></dt><dt><span class="sect2"><a href="#d5e1550">(Suppressing) contributed actions</a></span></dt><dt><span class="sect2"><a href="#d5e1572">(Suppressing) service menu items</a></span></dt><dt><span class="sect2"><a href="#d5e1581">(Suppressing) service menus</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1586">How to use a generic repository</a></span></dt><dt><span class="sect1"><a href="#sec.CustomRepository">How to write a custom repository</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1634">Finding by Title</a></span></dt><dt><span class="sect2"><a href="#d5e1650">Finding by Pattern</a></span></dt><dt><span class="sect2"><a href="#d5e1672">Finding using the <code class="classname">Filter</code> API</a></span></dt><dt><span class="sect2"><a href="#d5e1695">Finding using the <code class="classname">Query</code> API</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1739">Factories</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.ValueTypes">10. Value Types</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e1781">Built-in Value Types</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1785">JDK Types</a></span></dt><dt><span class="sect2"><a href="#d5e1863">Value formats</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1960">Custom Value Types</a></span></dt><dt><span class="sect1"><a href="#d5e1999">Third-party Value Types</a></span></dt></dl></dd></dl></div></div>

    <div class="chapter" title="Chapter&nbsp;4.&nbsp;Domain Entities"><div class="titlepage"><div><div><h2 class="title"><a name="chp.Objects"></a>Chapter&nbsp;4.&nbsp;Domain Entities</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d5e429">How to not inherit from framework superclasses</a></span></dt><dt><span class="sect1"><a href="#d5e440">How to specify a title for an object</a></span></dt><dt><span class="sect1"><a href="#sec.HowToSpecifyTheIconForAnObjectsClass">How to specify the icon for an object's
        class</a></span></dt><dt><span class="sect1"><a href="#d5e483">How to specify the icon for an individual object's
        state</a></span></dt><dt><span class="sect1"><a href="#d5e494">How to specify a name and/or description for an
        object</a></span></dt><dt><span class="sect1"><a href="#d5e506">How to specify that an object should not be
        persisted</a></span></dt><dt><span class="sect1"><a href="#sec.Immutable">How to specify that an object should
        never be modified by the user</a></span></dt><dt><span class="sect1"><a href="#sec.Entity.Disabled">How to control when an object can be modified</a></span></dt><dt><span class="sect1"><a href="#sec.Entity.Hidden">How to control when an object is visible</a></span></dt><dt><span class="sect1"><a href="#sec.Bounded">How to specify that a class of objects has a limited number of
        instances</a></span></dt><dt><span class="sect1"><a href="#sec.HowToCreateAnObject">How to create or delete objects within your code</a></span></dt><dt><span class="sect1"><a href="#sec.LifecycleMethods">How to insert behaviour into the object life cycle</a></span></dt><dt><span class="sect1"><a href="#sec.ResolveAndObjectChanged">How to perform lazy loading (generally done
        automatically)</a></span></dt><dt><span class="sect1"><a href="#d5e687">How to perform dirty object tracking (generally done
        automatically)</a></span></dt><dt><span class="sect1"><a href="#d5e696">How to ensure object is in valid state</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>How-to's relating to the domain objects, specifically domain
        entities.</p>
      </div>

      <p>This chapter contains how-to's for programming conventions that
      apply to the domain objects, or more specifically domain entities.
      Domain values conventions are covered in <a class="xref" href="#chp.ValueTypes" title="Chapter&nbsp;10.&nbsp;Value Types">Chapter&nbsp;10, <i>Value Types</i></a>.</p>

      <div class="sect1" title="How to not inherit from framework superclasses"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e429"></a>How to not inherit from framework superclasses</h2></div></div></div>
        

        <p>It isn't mandatory for domain entities to inherit from any
        framework superclass; they can be plain old java objects (pojos) if
        required. However, they do at a minimum need to have a
        <code class="classname">org.apache.isis.applib.DomainObjectContainer</code>
        injected into them (an interface), from which other framework services
        can be accessed.</p>

        <p>If you don't have a requirement to inherit from any other
        superclass, then it usually makes sense to inherit from mention
        <code class="classname">org.apache.isis.applib.AbstractDomainObject</code>,
        which already supports the
        <code class="classname">DomainObjectContainer</code> and has a number of
        convenience helper methods.</p>

        <p>There is further coverage of
        <code class="classname">DomainObjectContainer</code> in <a class="xref" href="#sec.LifecycleMethods" title="How to insert behaviour into the object life cycle">the section called &#8220;How to insert behaviour into the object life cycle&#8221;</a> and also in <a class="xref" href="#chp.DomainServices" title="Chapter&nbsp;9.&nbsp;Domain Services, Repositories and Factories">Chapter&nbsp;9, <i>Domain Services, Repositories and Factories</i></a>.</p>
      </div>

      <div class="sect1" title="How to specify a title for an object"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e440"></a>How to specify a title for an object</h2></div></div></div>
        

        <p>A title is used to identify an object to the user in the user
        interface. For example, a <code class="classname">Customer</code>'s title
        might be the organization's customer reference, or perhaps (more
        informally) their first and last names.</p>

        <p>By default, the framework will use the object's <code class="literal">toString()</code> method as the title. Most titles
        tend to be made up of the same set of elements: for example a
        Customer's name might be the concatenation of their customer first
        name and their ;ast name. For these the <code class="classname">@Title</code>
        annotation can be used:</p>

        <pre class="programlisting">public class Customer {
  @Title
  public String getFirstName() { ... }
  @Title
  public String getLastName() { ... }
  ...
}</pre>

        <p>For more control, the order of the title components can be
        specified using a sequence number (specified in Dewey decimal
        format):</p>

        <pre class="programlisting">public class Customer {
  @Title("1.0")
  public String getFirstName() { ... }
  @Title("1.1")
  public String getLastName() { ... }
  ...
}</pre>

        <p>For more control the title can be declared imperately using the
        <code class="literal">title()</code> method (returning a
        <code class="literal">String</code>). This leaves the programmer
        needs to make use of the <code class="literal">toString()</code>
        method for other purposes, such as for debugging. For example, to
        return the title for a customer which is their last name and then
        first initial of their first name, we could use:</p>

        <pre class="programlisting">public class Customer {
  public String title() {
    return getLastName() + ", " + getFirstName().substring(0,1);
  } 
  ...
}</pre>

        <p>The applib contains a class,
        <code class="classname">org.apache.isis.applib.util.TitleBuffer</code>, which
        you can use to help create title strings if you so wish. See <a class="xref" href="#apx.UtilityClasses" title="Appendix&nbsp;E.&nbsp;Utility Classes">Appendix&nbsp;E, <i>Utility Classes</i></a> for more details.</p>
      </div>

      <div class="sect1" title="How to specify the icon for an object's class"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.HowToSpecifyTheIconForAnObjectsClass"></a>How to specify the icon for an object's
        class</h2></div></div></div>
        

        <p>By default, the framework will look for an image
        in the <code class="filename">images</code>
        directory (either from the classpath or from the filesystem) that has
        the same name as the object class. Multiple file extensions are
        searched for, including <code class="filename">.png</code>,
        <code class="filename">.gif</code> and <code class="filename">.jpg</code> (in order of
        preference). For example, fan object of type
        <code class="classname">Customer</code> it will look for <code class="filename">Customer.png</code>, <code class="filename">Customer.gif</code>,
        <code class="filename">Customer.jpg</code> etc.</p>

        <p>If the framework finds no such file, then it
        will work up the inheritance hierarchy to see if there is an icon
        matching the name of any of the super-classes, and use that instead.
        If no matching icon is found then the framework will look for an image
        called <code class="filename">default.png</code>,
        <code class="filename">default.gif</code> or <code class="filename">default.jpg</code>
        in the images directory, and if this has not been specified, then the
        framework will use its own default image for an icon.</p>

        <p>We strongly recommend that you adopt 'pascal case' as the
        convention for icon file names: if you have a class called <code class="classname"> OrderLine</code>, then call the icon <code class="filename">OrderLine.png</code>. Actually,
        the framework will also recognise <code class="filename">orderline.png</code>, but some operating systems
        and deployment environments are case sensitive, so it is good practice
        to adopt an unambiguous convention.</p>

        <p>Alternatively, you can use the <code class="literal">iconName</code>() method instead:</p>

        <pre class="programlisting">public String iconName() {
    return "Person";
}</pre>

        <p>This makes it easy for more than one class to use the same icon,
        without having to duplicate the image file.</p>
      </div>

      <div class="sect1" title="How to specify the icon for an individual object's state"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e483"></a>How to specify the icon for an individual object's
        state</h2></div></div></div>
        

        <p>As discussed in <a class="xref" href="#sec.HowToSpecifyTheIconForAnObjectsClass" title="How to specify the icon for an object's class">the section called &#8220;How to specify the icon for an object's
        class&#8221;</a>, the
        <code class="code">iconName()</code> method may be used to specify an object. The
        value returned from this method need not be static, and so it can be
        used to represent the state of an individual object.</p>

        <p>For example, an instance of <code class="classname">Product</code> could
        use a photograph of the product as an icon, using:</p>

        <pre class="programlisting">public class Product {
    public String iconName() {
        return "Product-" + getPhotograph();
    }
    ...
}</pre>

        <p>Alternatively, an <code class="classname">Order</code> might vary the
        icon according to the status of the object:</p><pre class="programlisting">public class Order {
    public String iconName() {
        return "Order-" + getStatus();
    }
    ...
}</pre>
      </div>

      <div class="sect1" title="How to specify a name and/or description for an object"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e494"></a>How to specify a name and/or description for an
        object</h2></div></div></div>
        

        <p>By default, the name (or type) of an object, as displayed to the
        user will be the class name. However, if an <code class="literal">@Named</code> annotation is included, then this
        will override the default name. This might be used to include
        punctuation or other characters that may not be used within a class
        name, or when - for whatever reason - the name of the class includes
        technical artifacts (for example project-defined prefixes or
        suffices). It is also useful if the required name cannot be used
        because it is a keyword in the language.</p>

        <p>By default the framework will create a plural version of the
        object name by adding an 's' to singular name, or a 'ies' to names
        ending 'y'. For irregular nouns or other special case, the
        <code class="code">@Plural</code> annotation may be used to specify the plural form
        of the name explicitly.t</p>

        <p>The programmer may optionally also provide a <code class="literal">@DescribedAs</code> annotations, containing a brief
        description of the object's purpose, from a user perspective. The
        framework will make this available to the user in a form appropriate
        to the user interface style - for example as a tooltip.</p>

        <p>For example:</p>

        <pre class="programlisting">@Named("Customer")
@Plural("Customers")
@DescribedAs("Individuals or organizations that have either "+
             "purchased from us in the past or "+
             "are likely to in the future")
public class CustomerImpl implements ICustomer {
    ...
}</pre>

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>There is an entirely separate mechanism for dealing with
          Internationalisation, details of which can be found in the core
          documentation.</p>
        </div>
      </div>

      <div class="sect1" title="How to specify that an object should not be persisted"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e506"></a>How to specify that an object should not be
        persisted</h2></div></div></div>
        

        <p>Non-persisted objects are intended to be used as view models;
        they aggregate some state with respect to a certain process. This may
        be read-only (eg a projection of certain informaiton) or read-write
        (eg a wizard-like process object). Either way, the viewer is expected
        to interpret this by not providing any sort of automatic "save" menu
        item if such an object is returned to the
        <acronym class="acronym">GUI</acronym>.</p>

        <p>Non-persisted objects that are read-only are typically also
        marked as immutable (see <a class="xref" href="#sec.Immutable" title="How to specify that an object should never be modified by the user">the section called &#8220;How to specify that an object should
        never be modified by the user&#8221;</a>).</p>

        <p>To indicate that an object cannot be persisted, use the <code class="literal">@NotPersistable</code> annotation.</p>
      </div>

      <div class="sect1" title="How to specify that an object should never be modified by the user"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.Immutable"></a>How to specify that an object should
        never be modified by the user</h2></div></div></div>
        

        <p>Some objects have state which should not be modifiable; for
        example those representing reference data. The viewer is expected to
        interpret this by which suppressing any sort of "edit" button.</p>

        <p>To indicate that an object cannot be modified, use the <code class="literal">@Immutable</code> annotation.</p>

        <p>For example:</p>

        <pre class="programlisting">@Immutable
public class ChasingLetter implements PaymentReclaimStrategy {
    ...
}</pre>

        <p>See also <a class="xref" href="#sec.Entity.Disabled" title="How to control when an object can be modified">the section called &#8220;How to control when an object can be modified&#8221;</a>.</p>
      </div>

      <div class="sect1" title="How to control when an object can be modified"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.Entity.Disabled"></a>How to control when an object can be modified</h2></div></div></div>
        

        <p>Some objects have state which should not be modifiable only
        under certain conditions; for example an invoice can not be modified
        after it has been paid. The viewer is expected to interpret this by
        suppressing any sort of "edit" button.</p>

        <p>To indicate that an object cannot be modified, use the <code class="literal">String disabled(Type type)</code> method.</p>

        <p>For example:</p>

        <pre class="programlisting">public class FeeInvoice implements Invoice {
   public String disabled(Type type){
    ...
   }
}</pre>

        <p>The Type is from
        <code class="classname">org.apache.isis.applib.Identifier</code>:</p>

        <pre class="programlisting">    /**
     * What type of feature this identifies.
     */
    public static enum Type {
        CLASS, PROPERTY_OR_COLLECTION, ACTION
    }</pre>

        <p>and provides fine grain control over disabling actions and
        properties.</p>

        <p>The return String is null if the the object (action or property)
        is not disabled, or the reason why it is disabled, similar to <a class="xref" href="#sec.DisabledProperty" title="How to prevent a property from being modified">the section called &#8220;How to prevent a property from being modified&#8221;</a>.</p>

        <p>See also <a class="xref" href="#sec.Entity.Disabled" title="How to control when an object can be modified">the section called &#8220;How to control when an object can be modified&#8221;</a>.</p>
      </div>

      <div class="sect1" title="How to control when an object is visible"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.Entity.Hidden"></a>How to control when an object is visible</h2></div></div></div>
        

        <p>To when an object is visible, provide a hidden() method:</p>

        <pre class="programlisting">public class TrackingAction implements Tracking {
   public boolean hidden(){
    ...
   }
}</pre><p>If the function returns true, all properties and methods
        will be hidden from the user, similar to <a class="xref" href="#sec.HiddenProperty" title="How to hide a property from the user">the section called &#8220;How to hide a property from the user&#8221;</a>.</p>
      </div>

      <div class="sect1" title="How to specify that a class of objects has a limited number of instances"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.Bounded"></a>How to specify that a class of objects has a limited number of
        instances</h2></div></div></div>
        

        <p>Sometimes an entity may only have a relatively small number of
        instances, for example the types of credit cards accepted (Visa,
        Mastercard, Amex). Viewers will typically expected to render the
        complete set of instances as a drop down list whenever the object type
        is used (ie as a property or action parameter).</p>

        <p>To indicate that a class has a limited number of instances, use
        the <code class="classname">@Bounded</code> annotation. Note that there is an
        implied expectation is that the list of objects is small, and
        relatively cheap to obtain from the object store.</p>

        <p>An alternative way to specify a selection of objects is using
        the <code class="classname">choicesXxx()</code> supporting methods.</p>

        <p>For example:</p>

        <pre class="programlisting">@Bounded
public class PaymentMethod {
    ...
}</pre>

        <p>Alternatively, you might want to use a (Java) <code class="code">enum</code>,
        because these are implicitly bounded.</p>
      </div>

      <div class="sect1" title="How to create or delete objects within your code"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.HowToCreateAnObject"></a>How to create or delete objects within your code</h2></div></div></div>
        

        <p>When you create any domain object within your application code,
        it is important that the framework is made aware of the existence of
        this new object - in order that it may be persisted to the object
        store, and in order that any services that the new object needs are
        injected into it.</p>

        <p>Just specifying <code class="literal">new
        Customer()</code>, for example, will create a
        <code class="classname">Customer</code> object, but that object will
        <span class="emphasis"><em>not</em></span> be known to the framework. However, since we
        do not want to tie our domain objects to a particular framework, we
        use the idea of a 'container' to mediate, specified by the <code class="literal">org.apache.isis.applib.DomainObjectContainer</code>
        interface. See <a class="xref" href="#apx.DomainObjectContainer" title="Appendix&nbsp;C.&nbsp;DomainObjectContainer interface">Appendix&nbsp;C, <i><code class="classname">DomainObjectContainer</code> interface</i></a> for the
        full list of methods provided by
        <code class="classname">DomainObjectContainer</code>.</p>

        <p>This interface defines the following methods for managing domain
        objects:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="literal">&lt;T&gt; T
            newTransientInstance(final Class&lt;T&gt;
            ofClass)</code></p>

            <p>Returns a new instance of the specified class, that is
            transient (unsaved). The object may subsequently be saved either
            by the user invoking the Save action (that will automatically be
            rendered on the object view) or programmatically by calling
            <code class="literal">persist(Object
            transientObject)</code></p>
          </li><li class="listitem">
            <p><code class="methodname">&lt;T&gt; T newPersistentInstance(final
            Class&lt;T&gt; ofClass)</code></p>

            <p>Creates a new object already persisted.</p>
          </li><li class="listitem">
            <p><code class="methodname">boolean isPersistent()</code></p>

            <p>Checks whether an object has already been persisted. This is
            often useful in controlling visibility or availability of
            properties or actions.</p>
          </li><li class="listitem">
            <p><code class="methodname">void persist(Object
            transientObject)</code></p>

            <p>Persists a transient object (created using
            <code class="methodname">newTransientInstance(...)</code>, see
            above).</p>
          </li><li class="listitem">
            <p><code class="methodname">void persistIfNotAlready(Object
            domainObject)</code></p>

            <p>It is an error to persist an object if it is already
            persistent; this method will persist only if the object is not
            already persistent (otherwise it will do nothing).</p>
          </li><li class="listitem">
            <p><code class="methodname">void remove(Object
            persistentObject)</code></p>

            <p>Removes (deletes) from the object store, making the
            reference transient.</p>
          </li><li class="listitem">
            <p><code class="methodname">void removeIfNotAlready(Object
            domainObject)</code></p>

            <p>It is an error to remove an object if it is not persistent;
            this method will remove only if the object is known to be
            persistent (otherwise it will do nothing).</p>
          </li></ul></div>

        <p>A domain object specifies that it needs to have a reference to
        the <code class="classname">DomainObjectContainer</code> injected into by
        including the following code:</p>

        <pre class="programlisting">private DomainObjectContainer container;
protected DomainObjectContainer getContainer() {
    return container;
}
public final void setContainer(final DomainObjectContainer container) {
    this.container = container;
}</pre>

        <p>Creating or deleting objects is then done by invoking those
        methods on the container. For example the following code would then
        create a new <code class="classname">Customer</code> object within another
        method:</p>

        <pre class="programlisting">Customer newCust = getContainer().newTransientInstance(Customer.class);
newCust.setName("Charlie");
getContainer().persist(newCust);</pre>

        <p>If you are able to make your domain object inherit from <code class="literal">org.apache.isis.applib.AbstractDomainObject</code>
        then you have direct access to those methods, so the code would
        become:</p>

        <pre class="programlisting">Customer newCust = newTransientInstance(Customer.class);
newCust.setName("Charlie");
persist(newCust);</pre>

        <p>As an alternative to putting the creation logic within your
        domain objects, you could alternatively delegate to an injected
        factory (see <a class="xref" href="#chp.DomainServices" title="Chapter&nbsp;9.&nbsp;Domain Services, Repositories and Factories">Chapter&nbsp;9, <i>Domain Services, Repositories and Factories</i></a>). Ultimately
        factories just delegate back to
        <code class="classname">DomainObjectContainer</code> in the same way, so from
        a technical standpoint there is little difference. However it is
        generally worth introducing a factory because it provides a place to
        centralize any business logic. It also affords the opportunity to
        introduce a domain term (eg <code class="classname">ProductCatalog</code> or
        <code class="classname">StudentRegister</code>), thereby reinforcing the
        "ubiquitous language".</p>

        <p>These methods are actually provided by the
        <code class="classname">org.apache.isis.applib.AbstractContainedObject</code>
        and so are also available on <code class="literal">org.apache.isis.applib.AbstractService</code> (and,
        hence, on <code class="literal">org.apache.isis.applib.AbstractFactoryAndRepository</code>)
        for creating objects within a service.</p>

        <div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
          <p>It is possible to create a transient object within another
          transient object. When the framework persists any transient object,
          by default it will automatically persist any other transient object
          referenced by that object. However, if any of these transient
          objects are to be exposed to the user (while in their transient
          state), then you need to write your code very carefully -
          anticipating the fact that the user could elect to save any of the
          transient objects at any point - which could cause the graph of
          related objects to be persisted in an invalid state.</p>

          <p>The recommended approach is, if possible, to mark these
          supplementary classes as not persistable by the user (see <a class="xref" href="#not-persistable" title="@NotPersistable">the section called &#8220;@NotPersistable&#8221;</a>), or not to permit the user to create a
          new transient object that is a child of an existing transient
          object, but, rather, to require the user to save the parent object
          first.</p>
        </div>
      </div>

      <div class="sect1" title="How to insert behaviour into the object life cycle"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.LifecycleMethods"></a>How to insert behaviour into the object life cycle</h2></div></div></div>
        

        <p><span class="emphasis"><em>Apache Isis</em></span> is responsible for managing the
        object lifecycle, persisting, updating or removing objects from the
        persistent object store as required. For many applications the domain
        objects are unaware of this. If required, though, an object can
        provide callback methods (all optional) so that the framework can
        notify it of its persistence state.</p>

        <p>For example, the <code class="literal"><code class="methodname">persisted</code></code>() method
        is called after an object has been persisted. This could be used to
        setup a reverse association that should only be created once the new
        object has been persisted.</p>

        <p>The full list of callbacks is shown below.</p>

        <div class="table"><a name="d5e627"></a><p class="title"><b>Table&nbsp;4.1.&nbsp;Object lifecycle methods</b></p><div class="table-contents">
          

          <table summary="Object lifecycle methods" border="1"><colgroup><col width="105" align="left"><col align="left"></colgroup><thead><tr><th align="center">Method</th><th align="center">When called by framework</th></tr></thead><tbody><tr><td align="left"><code class="methodname">created()</code></td><td align="left">following the logical creation of the object (that is,
                after <code class="methodname">newTransientInstance()</code> has been
                called)</td></tr><tr><td align="left"><code class="methodname">loading()</code></td><td align="left">when a persistent object is about to be loaded into
                memory</td></tr><tr><td align="left"><code class="methodname">loaded()</code></td><td align="left">once the persistent object has just been loaded into
                memory</td></tr><tr><td align="left"><code class="methodname">persisting()</code> or
                <code class="methodname">saving()</code></td><td align="left">just before a transient object is first
                persisted.</td></tr><tr><td align="left"><code class="methodname">persisted()</code> or
                <code class="methodname">saved()</code></td><td align="left">just after a transient object is first
                persisted.</td></tr><tr><td align="left"><code class="methodname">updating()</code></td><td align="left">after any property on a persistent object has been
                changed and just before this change is persisted</td></tr><tr><td align="left"><code class="methodname">updated()</code></td><td align="left">after a changed property on a persistent object has
                been persisted</td></tr><tr><td align="left"><code class="methodname">removing()</code> or
                <code class="methodname">deleting()</code></td><td align="left">when a persistent object is just about to be deleted
                from the persistent object store.</td></tr><tr><td align="left"><code class="methodname">removed()</code> or
                <code class="methodname">deleted()</code></td><td align="left">when a persistent object has just been deleted from the
                persistent object store.</td></tr></tbody></table>
        </div></div><br class="table-break">
      </div>

      <div class="sect1" title="How to perform lazy loading (generally done automatically)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.ResolveAndObjectChanged"></a>How to perform lazy loading (generally done
        automatically)</h2></div></div></div>
        

        <p>The <code class="classname">DomainObjectContainer</code> provides the
        <code class="methodname">resolve()</code> method in order to lazily resolve
        the value of a property or a collection. In earlier versions of the
        framework it was necessary to call this method prior to accessing or
        mutating any property or collection. This is no longer required
        because <span class="emphasis"><em>Apache Isis</em></span> uses bytecode enhancement to
        automatically call this method.</p>

        <p>While it is possible to disable this bytecode enhancement using
        <code class="filename">isis.properties</code> file, this is not generally
        recommended. If it is disabled then the
        <code class="methodname">resolve()</code> method may need to be called
        manually.</p>
      </div>

      <div class="sect1" title="How to perform dirty object tracking (generally done automatically)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e687"></a>How to perform dirty object tracking (generally done
        automatically)</h2></div></div></div>
        

        <p>The <code class="classname">DomainObjectContainer</code> provides the
        <code class="methodname">objectChanged()</code> method in order to mark an
        object's state as having changed, and therefore requiring an update to
        the persistent object store. In earlier versions of the framework it
        was necessary to call this method after mutating any the property or
        collection. This is no longer required because <span class="emphasis"><em>Apache
        Isis</em></span> uses bytecode enhancement to automatically call this
        method.</p>

        <p>While it is possible to disable this bytecode enhancement using
        <code class="filename">isis.properties</code> file, this is not generally
        recommended. If it is disabled then the
        <code class="methodname">objectChanged()</code> method may need to be called
        manually.</p>
      </div>

      <div class="sect1" title="How to ensure object is in valid state"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e696"></a>How to ensure object is in valid state</h2></div></div></div>
        

        <p>A <code class="methodname">validate()</code> method may be added to
        provided validation at object level, prior to making an object
        persistent.</p>

        <p>The syntax is:</p>

        <pre class="programlisting">public String validate()</pre>

        <p>A non-<code class="code">null</code> value is the taken to be the reason why
        the object cannot be saved.</p>

        <p>This is particularly useful for validating fields in relation to
        each other.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Booking {
    private Date fromDate;
    public Date getFromDate() {...}
    public void setFromDate(Date d) {...}
    
    private Date toDate;
    public Date getToDate() {...}
    public void setToDate(Date d) {...}

    public String validate() {
        if (fromDate.getTicks() &gt; toDate.getTicks()) {
            return "From Date cannot be after To Date";
        }
        return null;
    }
    ...
}</pre>

        <p>This will prevent the user from saving a transient
        <code class="code">Booking</code> where the From Date falls after the To Date. Note
        that in this example, the two date properties could also have their
        own individual validate methods - for example in order to test that
        each date was after today.</p>

        <div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
          <p>At the time of writing, the <code class="code">validate()</code> method is
          called only when the object is first saved, not when it is
          subsequently updated. For validation of subsequent updates, the
          workaround is necessary to build the validation logic into the
          individual property validation methods (though these could delegate
          to a common <code class="code">validate()</code> method).</p>

          <p>See <a class="ulink" href="https://issues.apache.org/jira/browse/ISIS-18" target="_top">ISIS-18</a>
          for the status of this issue.</p>
        </div>
      </div>
    </div>

    <div class="chapter" title="Chapter&nbsp;5.&nbsp;Domain Entity Properties"><div class="titlepage"><div><div><h2 class="title"><a name="chp.Properties"></a>Chapter&nbsp;5.&nbsp;Domain Entity Properties</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d5e720">How to add a property to an object</a></span></dt><dt><span class="sect1"><a href="#d5e739">How to specify a name and/or description for a property</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e741">Specifying the name for a property</a></span></dt><dt><span class="sect2"><a href="#d5e747">Specifying a description for a property</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.MemberOrderForProperties">How to specify the order in which properties are
        displayed</a></span></dt><dt><span class="sect1"><a href="#d5e761">How to make a property optional (when saving an object)</a></span></dt><dt><span class="sect1"><a href="#sec.SizeProperties">How to specify the size of <code class="classname">String</code>
        properties</a></span></dt><dt><span class="sect1"><a href="#sec.DerivedProperty">How to make a derived property</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e786">Lazily derived</a></span></dt><dt><span class="sect2"><a href="#d5e797">Eagerly derived</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.HiddenProperty">How to hide a property from the user</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e813">Hiding a property always</a></span></dt><dt><span class="sect2"><a href="#d5e819">Hiding a property based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e830">Hiding a property under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e841">Hiding a property for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DisabledProperty">How to prevent a property from being modified</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e854">Disabling a property permanently</a></span></dt><dt><span class="sect2"><a href="#d5e861">Disabling a property based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e872">Disabling a property under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e885">Disabling a property for certain users/roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e890">How to validate user input for a property</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e892">Declarative validation</a></span></dt><dt><span class="sect2"><a href="#d5e907">Imperative validation</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DefaultPropertyValue">How to set up the initial value of a property
        programmatically</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e924">By each property's default values</a></span></dt><dt><span class="sect2"><a href="#d5e933">By the <code class="methodname">created()</code> lifecycle
          method</a></span></dt><dt><span class="sect2"><a href="#d5e940">Programmatically, by the creator</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e946">How to specify a set of choices for a property</a></span></dt><dt><span class="sect1"><a href="#sec.ModifyAndClear">How to trigger other behaviour when a property is
        changed</a></span></dt><dt><span class="sect1"><a href="#d5e983">How to setup a bidirectional relationship</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>How-to's relating to an domain entity's properties.</p>
      </div>

      <p>The following conventions are concerned with specifying the
      properties of a domain entity, and the means by which a user can
      interact with those properties.</p>

      <div class="sect1" title="How to add a property to an object"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e720"></a>How to add a property to an object</h2></div></div></div>
        

        <p>Properties are specified using the JavaBean conventions,
        recognizing a standard accessor/mutator pair (<code class="code">get</code> and
        <code class="code">set</code>).</p>

        <p>The syntax is:</p>

        <pre class="programlisting">public PropertyType getPropertyName() 

public void setPropertyName(PropertyType param)</pre>

        <p>where <code class="literal">PropertyType</code> is a
        primitive, a value object or an entity object.</p>

        <p>Properties may either be for a value type or may reference
        another entity. Values include Java primitives, and JDK classes with
        value semantics (eg <code class="literal">java.lang.Strings</code> and <code class="literal">java.util.Dates</code>; see <a class="xref" href="#chp.ValueTypes" title="Chapter&nbsp;10.&nbsp;Value Types">Chapter&nbsp;10, <i>Value Types</i></a> for the full list). It is also possible to
        write your own value types (see <a class="xref" href="#chp.ValueTypes" title="Chapter&nbsp;10.&nbsp;Value Types">Chapter&nbsp;10, <i>Value Types</i></a>). A
        property referencing another domain object is sometimes called an
        association.</p>

        <p>For example, the following example contains both a value
        (<code class="literal">String</code>) property and a reference
        (<code class="literal">Organisation</code>) property:</p>

        <pre class="programlisting">public class Customer {

    private String firstName;
    public String getFirstName() {
        return firstName;
    }
    public void setFirstName(String firstName) {
        this.firstName = firstName;
    }


    private Organisation organisation;
    public Organisation getOrganisation() {
        return organisation;
    }
    public void setOrganisation(Organisation organisation) { 
        this.organisation = organisation;
    }

    ...
}</pre>
      </div>

      <div class="sect1" title="How to specify a name and/or description for a property"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e739"></a>How to specify a name and/or description for a property</h2></div></div></div>
        

        <div class="sect2" title="Specifying the name for a property"><div class="titlepage"><div><div><h3 class="title"><a name="d5e741"></a>Specifying the name for a property</h3></div></div></div>
          

          <p>By default the framework will use the property name itself to
          label the property on the user interface. If you wish to override
          this, use the <code class="literal">@Named </code>annotation
          on the property.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer() {
    @Named("Given Name")
    public String getFirstName() { ... }
    ...
}</pre>
        </div>

        <div class="sect2" title="Specifying a description for a property"><div class="titlepage"><div><div><h3 class="title"><a name="d5e747"></a>Specifying a description for a property</h3></div></div></div>
          

          <p>An additional description can be provided on a property using
          the <code class="literal">@DescribedAs</code> annotation. The
          framework will take responsibility to make this description
          available to the user, for example in the form of a tooltip.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer() {
    @DescribedAs("The customer's given name")
    public String getFirstName() { ... }
    ...
}</pre>
        </div>
      </div>

      <div class="sect1" title="How to specify the order in which properties are displayed"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.MemberOrderForProperties"></a>How to specify the order in which properties are
        displayed</h2></div></div></div>
        

        <p>The <code class="literal">@MemberOrder</code> annotation
        provides a hint to the viewer as to the order in which the properties
        (and also collections, see <a class="xref" href="#sec.MemberOrderForCollections" title="How to specify the order in which collections are displayed">the section called &#8220;How to specify the order in which collections are
        displayed&#8221;</a>) should appear in the
        <acronym class="acronym">GUI</acronym>.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Customer() {
    @MemberOrder("1")
    public String getFirstName() { ... }
    ...

    @MemberOrder("2")
    public String getLastName() { ... }
    ...
}</pre>
      </div>

      <div class="sect1" title="How to make a property optional (when saving an object)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e761"></a>How to make a property optional (when saving an object)</h2></div></div></div>
        

        <p>By default, when a new transient (unsaved) object is presented
        to the user, values must be specified for all properties before the
        object may be saved.</p>

        <p>To specify that a particular property is optional, use the
        <code class="literal">@Optional</code> annotation.</p>
      </div>

      <div class="sect1" title="How to specify the size of String properties"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.SizeProperties"></a>How to specify the size of <code class="classname">String</code>
        properties</h2></div></div></div>
        

        <p>Use:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>the <code class="literal">@MaxLength</code> to specify
            the maximum number of characters that may be stored within a
            <code class="classname">String</code> property.</p>
          </li><li class="listitem">
            <p>the <code class="literal">@TypicalLength</code> to
            specify the typical number of characters that are likely to be
            stored within a <code class="classname">String</code> property. Viewers
            are expected to use this as a hint as to the size of the field to
            render for the property.</p>
          </li><li class="listitem">
            <p>the <code class="literal">@MultiLine</code> annotation
            as a hint to indicate that the property should be displayed over
            multiple lines (eg as a text area rather than a text
            field).</p>
          </li></ul></div>

        <p>For example:</p>

        <pre class="programlisting">public class Ticket {
    @TypicalLength(50)
    @MaxLength(255)
    public String getDescription() { ... }
    ...

    @MaxLength(2048)
    @MultiLine
    public String getNotes() { ... }
    ...
}</pre>
      </div>

      <div class="sect1" title="How to make a derived property"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.DerivedProperty"></a>How to make a derived property</h2></div></div></div>
        

        <div class="sect2" title="Lazily derived"><div class="titlepage"><div><div><h3 class="title"><a name="d5e786"></a>Lazily derived</h3></div></div></div>
          

          <p>Omitting the mutator (<code class="code">setXxx()</code>) method for a
          property indicates both that the field is derived, and is not be
          persisted. This is the standard approach to derive a property from
          other information available to the object. It also happens to be
          compatible with Java Persistence Api (<acronym class="acronym">JPA</acronym>)
          semantics.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Employee {
    public Department getDepartment() { ... }
    ...

    // this is the derived property
    public Employee getManager() {
        if (getDepartment() == null) { return null; }
        return getDepartment().getManager();
    }
    ...
}</pre>

          <p>Although there is no setter, such properties can nevertheless
          be modified if a modifyXxx supporting method is provided:</p>

          <pre class="programlisting">public class Employee {
    public Department getDepartment() { ... }
    ...

    // this is the derived property
    public Employee getManager() { ... }

    // this makes the derived property modifiable
    public void modifyManager(Employee manager) {
        if (getDepartment() == null) { return; }
        getDepartment().modifyManager(manager);
    }

    ...
}</pre>

          <p>Note how the implementation of such a modifyXxx() method
          typically modifies the original source of the information (the
          <code class="classname">Department</code> object).</p>
        </div>

        <div class="sect2" title="Eagerly derived"><div class="titlepage"><div><div><h3 class="title"><a name="d5e797"></a>Eagerly derived</h3></div></div></div>
          

          <p>An alternative to omitting the mutator is to mark a property
          is to keep the mutator, but to annotate the property with
          <code class="classname">@NotPersisted</code>.</p>

          <p>Because the data is non-persisted, some other mechanism must
          be used to initialize the property. Typically this will be a
          lifecycle method (see <a class="xref" href="#sec.LifecycleMethods" title="How to insert behaviour into the object life cycle">the section called &#8220;How to insert behaviour into the object life cycle&#8221;</a>),
          which eagerly derive the value of the property.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Employee {
    public void loaded() {
        if (getDepartment() != null) { 
            setManager(getDepartment().getManager());
        }
    }

    public Department getDepartment() { ... }
    ...

    @NotPersisted
    public Employee getManager() { ... }
    private void setManager(Employee manager) { ... }
    ...
}</pre>

          <p>Eagerly derived properties can be made modifiable either
          changing the setter to have public visibility, or introducing a
          modifyXxx() method.</p>
        </div>
      </div>

      <div class="sect1" title="How to hide a property from the user"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.HiddenProperty"></a>How to hide a property from the user</h2></div></div></div>
        

        <p>The mechanism for hiding a property is broadly the same as for
        hiding a collection (see <a class="xref" href="#sec.HiddenCollection" title="How to hide a collection">the section called &#8220;How to hide a collection&#8221;</a>) or
        an action (see <a class="xref" href="#sec.HiddenActions" title="How to hide an action">the section called &#8220;How to hide an action&#8221;</a>).</p>

        <p>For control over the entire object, see <a class="xref" href="#sec.Entity.Hidden" title="How to control when an object is visible">the section called &#8220;How to control when an object is visible&#8221;</a>.</p>

        <div class="sect2" title="Hiding a property always"><div class="titlepage"><div><div><h3 class="title"><a name="d5e813"></a>Hiding a property always</h3></div></div></div>
          

          <p>To prevent a user from viewing a property at all, use the
          <code class="literal">@Hidden</code> annotation. A common use
          case is to hide an internal Id, eg perhaps as required by the object
          store.</p>

          <p>For example:</p>

          <pre class="programlisting">public class OrderLine {
    private Integer id;
    @Hidden
    public Integer getId() { ... }
    public void setId(Integer id) { ... }
    ...
}</pre>
        </div>

        <div class="sect2" title="Hiding a property based on the persistence state of the object"><div class="titlepage"><div><div><h3 class="title"><a name="d5e819"></a>Hiding a property based on the persistence state of the
          object</h3></div></div></div>
          

          <p>As a refinement of the above, a property may be optionally
          hidden using the <code class="classname">@Hidden</code> annotation based on
          the persistence state of the object:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>to hide the property when the object is transient, use
              <code class="code">@Hidden(When.UNTIL_PERSISTED)</code></p>
            </li><li class="listitem">
              <p>to hide the property when the object is persistent, use
              <code class="code">@Hidden(When.ONCE_PERSISTED)</code></p>
            </li></ul></div>
        </div>

        <div class="sect2" title="Hiding a property under certain conditions"><div class="titlepage"><div><div><h3 class="title"><a name="d5e830"></a>Hiding a property under certain conditions</h3></div></div></div>
          

          <p>A <code class="literal">hideXxx()</code> method can be
          used to indicate that a particular object's property should be
          hidden under certain conditions, typically relating to the state of
          that instance.</p>

          <p>The syntax is:</p>

          <pre class="programlisting"><code class="literal">public boolean hidePropertyName()</code> </pre>

          <p>Returning a value of <code class="code">true</code> indicates that the
          property should be hidden.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Order {
    public String getShippingInstructions() { ... }
    public void setShippingInstructions(String shippingInstructions) { ... }
    public boolean hideShippingInstructions() {
        return hasShipped();
    }
    ...
}</pre>
        </div>

        <div class="sect2" title="Hiding a property for specific users or roles"><div class="titlepage"><div><div><h3 class="title"><a name="d5e841"></a>Hiding a property for specific users or roles</h3></div></div></div>
          

          <p>It is possible to hide properties for certain users/roles by
          calling the <code class="methodname">DomainObjectContainer#getUser()</code>
          method. See <a class="xref" href="#sec.BusinessRulesForCertainUsersOrRoles" title="Hiding, disabling or validating for specific users or roles">the section called &#8220;Hiding, disabling or validating for specific users or
        roles&#8221;</a>for further
          discussion.</p>
        </div>
      </div>

      <div class="sect1" title="How to prevent a property from being modified"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.DisabledProperty"></a>How to prevent a property from being modified</h2></div></div></div>
        

        <p>Preventing the user from modifying a property value is known as
        'disabling' the property. Note that this doesn't prevent the property
        from being modified programmatically.</p>

        <p>The mechanism for disabling a property is broadly the same as
        for disabling a collection (see <a class="xref" href="#sec.DisabledCollection" title="How to prevent a collection from being modified">the section called &#8220;How to prevent a collection from being modified&#8221;</a>) or a collection (see <a class="xref" href="#sec.DisabledCollection" title="How to prevent a collection from being modified">the section called &#8220;How to prevent a collection from being modified&#8221;</a>).</p>

        <p>For control over the entire object, see <a class="xref" href="#sec.Entity.Disabled" title="How to control when an object can be modified">the section called &#8220;How to control when an object can be modified&#8221;</a>.</p>

        <div class="sect2" title="Disabling a property permanently"><div class="titlepage"><div><div><h3 class="title"><a name="d5e854"></a>Disabling a property permanently</h3></div></div></div>
          

          <p>To prevent a user from being able to modify the property at
          all, use the <code class="literal">@Disabled</code>
          annotation.</p>

          <p>For example:</p>

          <pre class="programlisting">public class OrderLine {
    private int quantity;
    @Disabled
    public String getQuantity() { ... }
    public void setQuantity(int quantity) { ... }
    ...
}</pre>

          <p>Note that a setter is still required; this is used by the
          framework to recreate the object when pulled back from the
          persistent object store.</p>
        </div>

        <div class="sect2" title="Disabling a property based on the persistence state of the object"><div class="titlepage"><div><div><h3 class="title"><a name="d5e861"></a>Disabling a property based on the persistence state of the
          object</h3></div></div></div>
          

          <p>As a refinement of the above, a property may be optionally
          disabled using the <code class="classname">@Disabled</code> annotation based
          on the persistence state of the object:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>to disable the property when the object is transient, use
              <code class="code">@Disabled(When.UNTIL_PERSISTED)</code></p>
            </li><li class="listitem">
              <p>to disable the property when the object is persistent, use
              <code class="code">@Disabled(When.ONCE_PERSISTED)</code></p>
            </li></ul></div>
        </div>

        <div class="sect2" title="Disabling a property under certain conditions"><div class="titlepage"><div><div><h3 class="title"><a name="d5e872"></a>Disabling a property under certain conditions</h3></div></div></div>
          

          <p>A supporting <code class="literal">disableXxx()</code>
          method can be used to disable a particular instance's member under
          certain conditions</p>

          <p>The syntax is:</p>

          <pre class="programlisting"><code class="literal">public String disablePropertyName()</code></pre>

          <p>A non-<code class="code">null</code> return value indicates the reason why
          the property cannot be modified. The framework is responsible for
          providing this feedback to the user.</p>

          <p>For example:</p>

          <pre class="programlisting">public class OrderLine {
    public String getQuantity() { ... }
    public void setQuantity(int quantity) { ... }
    public String disableQuantity() { 
        if (isSubmitted()) {
            return "Cannot alter any quantity after Order has been submitted"; 
        }
        return null;
    }
}</pre>

          <p>If there are multiple reasons to disable a property, take a
          look at the
          <code class="classname">org.apache.isis.applib.util.ReasonBuffer</code>
          helper.</p>
        </div>

        <div class="sect2" title="Disabling a property for certain users/roles"><div class="titlepage"><div><div><h3 class="title"><a name="d5e885"></a>Disabling a property for certain users/roles</h3></div></div></div>
          

          <p>It is possible to disable properties for certain users/roles
          by calling the
          <code class="methodname">DomainObjectContainer#getUser()</code> method. See
          <a class="xref" href="#sec.BusinessRulesForCertainUsersOrRoles" title="Hiding, disabling or validating for specific users or roles">the section called &#8220;Hiding, disabling or validating for specific users or
        roles&#8221;</a>for
          further discussion.</p>
        </div>
      </div>

      <div class="sect1" title="How to validate user input for a property"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e890"></a>How to validate user input for a property</h2></div></div></div>
        

        <div class="sect2" title="Declarative validation"><div class="titlepage"><div><div><h3 class="title"><a name="d5e892"></a>Declarative validation</h3></div></div></div>
          

          <p>For properties that accept a text input string, such as
          <code class="code">String</code> and <code class="code">Date</code>, there are convenient
          mechanisms to validate and/or normalise the values typed in:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>For <code class="literal">Date</code> and number
              values the <code class="literal">@Mask</code> annotation
              may be used.</p>
            </li><li class="listitem">
              <p>For <code class="literal">String</code> properties
              the <code class="literal">@RegEx</code> annotation may be
              used.</p>
            </li></ul></div>

          <p>More complex validation can also be performed imperatively
          (below).</p>
        </div>

        <div class="sect2" title="Imperative validation"><div class="titlepage"><div><div><h3 class="title"><a name="d5e907"></a>Imperative validation</h3></div></div></div>
          

          <p>A supporting <code class="literal">validateXxx()</code>
          method is used to check that a new value for a property is
          valid.</p>

          <p>If the proffered value is deemed to be invalid then the
          property will not be changed. A non-null return <code class="code">String</code>
          indicates the reason why the member cannot be modified/action be
          invoked; the framework is responsible for providing this feedback to
          the user.</p>

          <p>The syntax is:</p>

          <pre class="programlisting">public String validatePropertyName(PropertyType param)</pre>

          <p>where <code class="literal">PropertyType</code> is the
          same type as that of the property itself.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Exam {
    public int getMark() { ... }
    public void setMark(int mark) { ... }
    public validateMark(int mark) {
        return !withinRange(mark)? "Mark must be in range 0 to 30":null;
    }
    private boolean withinRange(int mark) { return mark &gt;= 0 &amp;&amp; mark &lt;= 30; }
}</pre>
        </div>
      </div>

      <div class="sect1" title="How to set up the initial value of a property programmatically"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.DefaultPropertyValue"></a>How to set up the initial value of a property
        programmatically</h2></div></div></div>
        

        <p>After an object has been created (see <a class="xref" href="#sec.HowToCreateAnObject" title="How to create or delete objects within your code">the section called &#8220;How to create or delete objects within your code&#8221;</a>), there are several different
        ways to setup the initial values for an object's properties.</p>

        <div class="sect2" title="By each property's default values"><div class="titlepage"><div><div><h3 class="title"><a name="d5e924"></a>By each property's default values</h3></div></div></div>
          

          <p>Firstly, the default value for a property can be supplied
          using a supporting <code class="methodname">defaultXxx()</code> method. The
          syntax for specifying a default value is:</p>

          <pre class="programlisting">public PropertyType defaultPropertyName()</pre>

          <p>where <code class="literal">PropertyType</code> is the
          same type as that of the property itself.</p>

          <pre class="programlisting">public class Order {
    public Address getShippingAddress() { ... }
    public void setShippingAddress() { ... }
    public Address defaultShippingAddress() {
        return getCustomer().normalAddress();
    }
    ...
}</pre>
        </div>

        <div class="sect2" title="By the created() lifecycle method"><div class="titlepage"><div><div><h3 class="title"><a name="d5e933"></a>By the <code class="methodname">created()</code> lifecycle
          method</h3></div></div></div>
          

          <p>Alternatively, the domain object may choose to initialize its
          property values in the <code class="literal">created()</code>
          lifecycle method (see <a class="xref" href="#sec.LifecycleMethods" title="How to insert behaviour into the object life cycle">the section called &#8220;How to insert behaviour into the object life cycle&#8221;</a>). This
          is called after any <code class="methodname">defaultXxx()</code> methods
          are called.</p>
        </div>

        <div class="sect2" title="Programmatically, by the creator"><div class="titlepage"><div><div><h3 class="title"><a name="d5e940"></a>Programmatically, by the creator</h3></div></div></div>
          

          <p>Third, and perhaps most obviously, the creator of the object
          could initialize the properties of the object immediately after
          calling <code class="methodname">newTransientInstance(...)</code>. This
          would be appropriate if the creator had reason to override any
          values setup in the <code class="methodname">defaultXxx()</code> or
          <code class="methodname">created()</code> methods discussed above.</p>
        </div>
      </div>

      <div class="sect1" title="How to specify a set of choices for a property"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e946"></a>How to specify a set of choices for a property</h2></div></div></div>
        

        <p>The simplest way to provide the user with a set of choices for a
        property (possibly rendered as a drop-down list, for example) is to
        ensure that the type used by the property is marked up as
        <code class="code">@Bounded</code> (see <a class="xref" href="#sec.Bounded" title="How to specify that a class of objects has a limited number of instances">the section called &#8220;How to specify that a class of objects has a limited number of
        instances&#8221;</a>).</p>

        <p>However, this is not always appropriate. For example you might
        wish to provide the user with the choice of all the
        <code class="classname">Address</code>es known for that
        <code class="classname">Customer</code>, with the most recently-used address
        as the default.</p>

        <p>The syntax for specifying a list of choices is either:</p>

        <pre class="programlisting">public Collection&lt;PropertyType&gt; choicesPropertyName()</pre>

        <p>or alternatively</p>

        <pre class="programlisting">public PropertyType[] choicesPropertyName()</pre>

        <p>where <code class="literal">PropertyType</code> is the
        same type as that of the property itself.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Order {
    public Address getShippingAddress() { ... }
    public void setShippingAddress() { ... }
    public List&lt;Address&gt; choicesShippingAddress() {
        return getCustomer().allActiveAddresses();
    }
    ...
}</pre>
      </div>

      <div class="sect1" title="How to trigger other behaviour when a property is changed"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.ModifyAndClear"></a>How to trigger other behaviour when a property is
        changed</h2></div></div></div>
        

        <p>If you want to invoke functionality whenever a property is
        changed by the user, then you should create a supporting <code class="literal">modifyXxx()</code> method and include the
        functionality within that. The syntax is:</p>

        <pre class="programlisting">public void modifyPropertyName(PropertyType param)</pre>

        <p>Why not just put this functionality in the setter? Well, the
        setter is used by the object store to recreate the state of an already
        persisted object. Putting additional behaviour in the setter would
        cause it to be triggered incorrectly.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Order() {
    public Integer getAmount() { ... }
    public void setAmount(Integer amount) { ... }
    public void modifyAmount(Integer amount) {
        setAmount(amount);
        addToTotal(amount);
    }
    ...
}</pre>

        <p>Here the <code class="literal">modifyAmount()</code>
        method also calls the <code class="literal">addToTotal()</code>
        call as well as the <code class="literal">setAmount()</code>
        method. We don't want this <code class="methodname">addToCall()</code> method
        to be called when pulling the object back from the object store, so we
        put it into the modify, not the setter.</p>

        <p>You may optionally also specify a <code class="code">clearXxx()</code> which
        works the same way as modify <code class="literal">modify</code>
        <code class="literal">Xxx()</code> but is called when the
        property is cleared by the user (i.e. the current value replaced by
        nothing). The syntax is:</p>

        <pre class="programlisting">public void clearPropertyName()</pre>

        <p>To extend the above example:</p>

        <pre class="programlisting">public class Order() {
    public Integer getAmount() { ... }
    public void setAmount(Integer amount) { ... }
    public void modifyAmount(Integer amount) { ... }
    public void clearAmount() {
        removeFromTotal(this.amount);
        setAmount(null);
    }
    ...
}</pre>
      </div>

      <div class="sect1" title="How to setup a bidirectional relationship"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e983"></a>How to setup a bidirectional relationship</h2></div></div></div>
        

        <p>The <code class="methodname">modifyXxx()</code> and
        <code class="methodname">clearXxx()</code> methods (see <a class="xref" href="#sec.ModifyAndClear" title="How to trigger other behaviour when a property is changed">the section called &#8220;How to trigger other behaviour when a property is
        changed&#8221;</a>) can be used to setup bidirectional
        relationships. This is typically done with 1:m relationships, eg
        between <code class="classname">Order</code> and
        <code class="classname">OrderLine</code>, or <code class="classname">Department</code>
        and <code class="classname">Employee</code>.</p>

        <p>For further discussion and a complete example, see <a class="xref" href="#sec.MutualRegistrationPattern" title="How to maintain bidirectional relationships">the section called &#8220;How to maintain bidirectional relationships&#8221;</a>.</p>
      </div>
    </div>

    <div class="chapter" title="Chapter&nbsp;6.&nbsp;Domain Entity Collections"><div class="titlepage"><div><div><h2 class="title"><a name="chp.Collections"></a>Chapter&nbsp;6.&nbsp;Domain Entity Collections</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d5e1000">How to add a collection to an object</a></span></dt><dt><span class="sect1"><a href="#d5e1024">How to specify a name and/or description for a
        collection</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1026">Specifying the name for a collection</a></span></dt><dt><span class="sect2"><a href="#d5e1032">Specifying a description for a collection</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.MemberOrderForCollections">How to specify the order in which collections are
        displayed</a></span></dt><dt><span class="sect1"><a href="#d5e1046">How to make a derived collection</a></span></dt><dt><span class="sect1"><a href="#sec.HiddenCollection">How to hide a collection</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1059">Hiding a collection permanently</a></span></dt><dt><span class="sect2"><a href="#d5e1065">Hiding a collection based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e1076">Hiding a collection under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e1087">Hiding a collection for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DisabledCollection">How to prevent a collection from being modified</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1098">Disabling a collection permanently</a></span></dt><dt><span class="sect2"><a href="#d5e1107">Disabling a collection based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e1118">Disabling a collection under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e1127">Disabling a collection for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1132">How to validate an object being added or removed</a></span></dt><dt><span class="sect1"><a href="#sec.AddToRemoveFrom">How to trigger other behaviour when an object is added or
        removed</a></span></dt><dt><span class="sect1"><a href="#sec.MutualRegistrationPattern">How to maintain bidirectional relationships</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>How-to's relating to a domain entity's collections.</p>
      </div>

      <p>A collection is a list of references to several entity that have a
      common type. The following conventions are concerned with specifying the
      collections of an object, and the means by which a user can interact
      with those collections.</p>

      <div class="sect1" title="How to add a collection to an object"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1000"></a>How to add a collection to an object</h2></div></div></div>
        

        <p>A collection is recognized via an accessor/mutator method pair
        (<code class="code">get</code> and set) for any type of collection provided by the
        programming language.</p>

        <p>The syntax is either:</p>

        <pre class="programlisting">public Collection&lt;EntityType&gt; getCollectionName()
private void setCollectionName(Collection&lt;EntityType&gt; param)</pre>

        <p>or:</p>

        <pre class="programlisting">public List&lt;EntityType&gt; getCollectionName()
private void setCollectionName(List&lt;EntityType&gt; param)</pre>

        <p>or:</p>

        <pre class="programlisting">public Set&lt;EntityType&gt; getCollectionName()
private void setCollectionName(Set&lt;EntityType&gt; param)</pre>

        <p>A mutator is required, but it need only have
        <code class="code">private</code> visibility.</p>

        <p>Note:</p>

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p><code class="classname">Map</code>s cannot be used for
          collections.</p>
        </div>

        <p>It is recommended that the collections be specified using
        generics (for example: <code class="literal">List&lt;Customer&gt;</code> ). That way the
        framework will be able to display the collection based on that type
        definition. If a raw type is used then the framework will attempt to
        infer the type from the addToXxx() / removeFromXxx() supporting
        methods, if specified (see <a class="xref" href="#sec.AddToRemoveFrom" title="How to trigger other behaviour when an object is added or removed">the section called &#8220;How to trigger other behaviour when an object is added or
        removed&#8221;</a>). If
        the framework is unable to determine the type of the collection, it
        will mean that some viewers will represent the collection is a less
        sophisticated manner (eg a simple list of titles rather than a
        table).</p>

        <p>For example:</p>

        <pre class="programlisting">public class Employee { ... }

public class Department {
    private List&lt;Employee&gt; employees = new ArrayList&lt;Employee&gt;();
    public List &lt;Employee&gt; getEmployees() {
        return employees;
    }
    private void setEmployees(List&lt;Employee&gt; employees) { 
        this.employees = employees;
    }
    ...
}</pre>
      </div>

      <div class="sect1" title="How to specify a name and/or description for a collection"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1024"></a>How to specify a name and/or description for a
        collection</h2></div></div></div>
        

        <div class="sect2" title="Specifying the name for a collection"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1026"></a>Specifying the name for a collection</h3></div></div></div>
          

          <p>By default the framework will use the collection name itself
          to label the collection on the user interface. If you wish to
          override this, use the <code class="literal">@Named</code>
          annotation on the collection.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer {
    @Named("Placed Orders")
    public List&lt;Order&gt; getOrders() { ... }
    ...
}</pre>
        </div>

        <div class="sect2" title="Specifying a description for a collection"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1032"></a>Specifying a description for a collection</h3></div></div></div>
          

          <p>An additional description can be provided on a collection
          using the <code class="literal">@DescribedAs</code>
          annotation. The framework will take responsibility to make this
          description available to the user, for example in the form of a
          tooltip.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer {
    @DescribedAs("Those orders that have been placed (and possibly shipped) " + 
                 "by this customer given name by which this customer is known")
    public List&lt;Order&gt; getOrders() { ... }
    ...
}</pre>
        </div>
      </div>

      <div class="sect1" title="How to specify the order in which collections are displayed"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.MemberOrderForCollections"></a>How to specify the order in which collections are
        displayed</h2></div></div></div>
        

        <p>The <code class="literal">@MemberOrder</code> annotation
        provides a hint to the viewer as to the order in which the collections
        (and also properties, see <a class="xref" href="#sec.MemberOrderForProperties" title="How to specify the order in which properties are displayed">the section called &#8220;How to specify the order in which properties are
        displayed&#8221;</a>) should appear in the
        <acronym class="acronym">GUI</acronym>.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Customer {
    @MemberOrder("3")
    public Collection&lt;Order&gt; getRecentOrders() { ... }
    ...

    @MemberOrder("4")
    public Collection&lt;Order&gt; getOrders() { ... }
    ...
}</pre>
      </div>

      <div class="sect1" title="How to make a derived collection"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1046"></a>How to make a derived collection</h2></div></div></div>
        

        <p>Collections can be derived by omitting the mutator (the same way
        as properties, see <a class="xref" href="#sec.DerivedProperty" title="How to make a derived property">the section called &#8220;How to make a derived property&#8221;</a>).</p>

        <p>For example:</p>

        <pre class="programlisting">public class Department {
    // Standard collection
    private List&lt;Employee&gt; employees = new ArrayList&lt;Employee&gt;();
    public List&lt;Employee&gt; getEmployees() { ... }
    private void setEmployees(List&lt;Employee&gt;) { ... }

    // Derived collection
    public List&lt;Employee&gt; getTerminatedEmployees() {
        List&lt;Employee&gt; terminatedEmployees = new ArrayList&lt;Employee&gt;();
        for(Employee e: employees) {
            if (e.isTerminated()) {
                addTo(terminatedEmployees, e);
            }
        }
        return terminatedEmployees;
    }
    ...
}</pre>

        <p>Derived collections are not persisted, though may be modified if
        there is an addToXxx() or removeFromXxx() supporting method. As for
        derived properties, the implementations of these mutators change the
        underlying data. For example:</p>

        <pre class="programlisting">public class Department {
    ...

    public void addToTerminatedEmployees(Employee employee) {
        employee.setTerminated(true);
    }
    public void removeFromTerminatedEmployees(Employee employee) {
        employee.setTerminated(false);
    }
}</pre>
      </div>

      <div class="sect1" title="How to hide a collection"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.HiddenCollection"></a>How to hide a collection</h2></div></div></div>
        

        <p>The mechanism for hiding a collection is broadly the same as for
        hiding a property (see <a class="xref" href="#sec.HiddenProperty" title="How to hide a property from the user">the section called &#8220;How to hide a property from the user&#8221;</a>) or an
        action (see <a class="xref" href="#sec.HiddenActions" title="How to hide an action">the section called &#8220;How to hide an action&#8221;</a>).</p>

        <div class="sect2" title="Hiding a collection permanently"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1059"></a>Hiding a collection permanently</h3></div></div></div>
          

          <p>To prevent a user from viewing a collection at all, use the
          <code class="literal">@Hidden</code> annotation.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Order {
    private List&lt;Order&gt; cancelledOrders = new ArrayList&lt;Order&gt;();
    @Hidden
    public List&lt;Order&gt; getCancelledOrders() { ... }
    private void setCancelledOrders(List&lt;Order&gt; cancelledOrders) { ... }
    ...
}</pre>
        </div>

        <div class="sect2" title="Hiding a collection based on the persistence state of the object"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1065"></a>Hiding a collection based on the persistence state of the
          object</h3></div></div></div>
          

          <p>As a refinement of the above, a collection may be optionally
          hidden using the <code class="classname">@Hidden</code> annotation based on
          the persistence state of the object:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>to hide the collection when the object is transient, use
              <code class="code">@Hidden(When.UNTIL_PERSISTED)</code></p>
            </li><li class="listitem">
              <p>to hide the collection when the object is persistent, use
              <code class="code">@Hidden(When.ONCE_PERSISTED)</code></p>
            </li></ul></div>
        </div>

        <div class="sect2" title="Hiding a collection under certain conditions"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1076"></a>Hiding a collection under certain conditions</h3></div></div></div>
          

          <p>A <code class="literal">hideXxx()</code> method can be
          used to indicate that a particular object's collection should be
          hidden under certain conditions, typically relating to the state of
          that instance.</p>

          <p>The syntax is:</p>

          <pre class="programlisting"><code class="literal">public boolean hideCollectionName()</code> </pre>

          <p>Returning a value of <code class="code">true</code> indicates that the
          collection should be hidden.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Order {
    @Hidden
    public List&lt;Order&gt; getRushOrders() { ... }
    ...
}</pre>
        </div>

        <div class="sect2" title="Hiding a collection for specific users or roles"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1087"></a>Hiding a collection for specific users or roles</h3></div></div></div>
          

          <p>It is possible to hide collections for certain users/roles by
          calling the <code class="methodname">DomainObjectContainer#getUser()</code>
          method. See <a class="xref" href="#sec.BusinessRulesForCertainUsersOrRoles" title="Hiding, disabling or validating for specific users or roles">the section called &#8220;Hiding, disabling or validating for specific users or
        roles&#8221;</a> for further
          discussion.</p>
        </div>
      </div>

      <div class="sect1" title="How to prevent a collection from being modified"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.DisabledCollection"></a>How to prevent a collection from being modified</h2></div></div></div>
        

        <p>Preventing the user from adding to or removing from a collection
        is known as 'disabling' the collection.</p>

        <p>The mechanism for disabling a collection is broadly the same as
        for disabling a property (see <a class="xref" href="#sec.DisabledProperty" title="How to prevent a property from being modified">the section called &#8220;How to prevent a property from being modified&#8221;</a>)
        or a action (see <a class="xref" href="#sec.DisabledAction" title="How to prevent an action from being invoked">the section called &#8220;How to prevent an action from being invoked&#8221;</a>).</p>

        <div class="sect2" title="Disabling a collection permanently"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1098"></a>Disabling a collection permanently</h3></div></div></div>
          

          <p>Some, though not all, viewers allow the user to directly
          manipulate the contents of a collection. For example, the DnD viewer
          will allow new objects to be "dropped" into a collection, and
          existing objects removed from a collection.</p>

          <p>Although it is possible to associate behaviour with such
          actions (see <a class="xref" href="#sec.AddToRemoveFrom" title="How to trigger other behaviour when an object is added or removed">the section called &#8220;How to trigger other behaviour when an object is added or
        removed&#8221;</a>), it may be
          preferred to only allow modification through actions. Or, the
          application may be deployed using a viewer that doesn't fully
          support direct manipulation of collections.</p>

          <p>In either case, annotate the collection using the <code class="literal">@Disabled</code> annotation.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Order {
    private List&lt;Order&gt; cancelledOrders = new ArrayList&lt;Order&gt;();
    @Disabled
    public List&lt;Order&gt; getCancelledOrders() { ... }
    private void setCancelledOrders(List&lt;Order&gt; cancelledOrders) { ... }
    ...
}</pre>
        </div>

        <div class="sect2" title="Disabling a collection based on the persistence state of the object"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1107"></a>Disabling a collection based on the persistence state of the
          object</h3></div></div></div>
          

          <p>As a refinement of the above, a collection may be optionally
          disabled using the <code class="classname">@Disabled</code> annotation based
          on the persistence state of the object:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>to disable the collection when the object is transient,
              use <code class="code">@Disabled(When.UNTIL_PERSISTED)</code></p>
            </li><li class="listitem">
              <p>to disable the collection when the object is persistent,
              use <code class="code">@Disabled(When.ONCE_PERSISTED)</code></p>
            </li></ul></div>
        </div>

        <div class="sect2" title="Disabling a collection under certain conditions"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1118"></a>Disabling a collection under certain conditions</h3></div></div></div>
          

          <p>A <code class="literal">disableXxx()</code> method can
          be used to disable a particular instance's collection under certain
          conditions:</p>

          <p>The syntax is:</p>

          <pre class="programlisting"><code class="literal">public String disableCollectionName()</code> </pre>

          <p>For example:</p>

          <pre class="programlisting">public class Department {
    public List&lt;Employee&gt; getEmployees() { ... }
    private void setEmployees(List&lt;Employee&gt; employees) { ... }
    public void disableEmployees() {
        return isClosed()? "This department is closed" : null;
    }
    ...
}</pre>
        </div>

        <div class="sect2" title="Disabling a collection for specific users or roles"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1127"></a>Disabling a collection for specific users or roles</h3></div></div></div>
          

          <p>It is possible to disable collections for certain users/roles
          by calling the
          <code class="methodname">DoymainObjectContainer#getUser()</code> method.
          See <a class="xref" href="#sec.BusinessRulesForCertainUsersOrRoles" title="Hiding, disabling or validating for specific users or roles">the section called &#8220;Hiding, disabling or validating for specific users or
        roles&#8221;</a> for
          further discussion.</p>
        </div>
      </div>

      <div class="sect1" title="How to validate an object being added or removed"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1132"></a>How to validate an object being added or removed</h2></div></div></div>
        

        <p>A <code class="literal">validateAddToXxx()</code> method
        can be used to check that an object is valid to be added to a
        collection. Conversely, the
        <code class="methodname">validateRemoveFromXxx()</code> method can be used to
        check that it is valid to remove an object from a collection is
        valid.</p>

        <p>The syntax is:</p>

        <pre class="programlisting">public String validateAddToCollectionName(EntityType param)</pre>

        <p>and</p>

        <pre class="programlisting">public String validateRemoveFromCollectionName(EntityType param)</pre>

        <p>A non-<code class="code">null</code> return <code class="code">String</code> indicates the
        reason why the object cannot be added/removed, and the viewing
        mechanism will display this to the user.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Department {
    public List&lt;Employee&gt; getEmployees() { ... }
    private void setEmployees(List&lt;Employee&gt; employees) { ... }
    public String validateAddToEmployee(Employee employee) {
        return employee.isRetired()?
            "Cannot add retired employees to department"
            :null;
    ...
}</pre>
      </div>

      <div class="sect1" title="How to trigger other behaviour when an object is added or removed"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.AddToRemoveFrom"></a>How to trigger other behaviour when an object is added or
        removed</h2></div></div></div>
        

        <p>A collection may have a corresponding <code class="literal">addToXxx()</code> and/or <code class="literal">removeFromXxx()</code> method. If present, and
        direct manipulation of the contents of the connection has not been
        disabled (see <a class="xref" href="#sec.DisabledCollection" title="How to prevent a collection from being modified">the section called &#8220;How to prevent a collection from being modified&#8221;</a>), then they
        will be called (instead of adding/removing an object directly to the
        collection returned by the accessor).</p>

        <p>The reason for this behaviour is to allow other behaviour to be
        triggered when the contents of the collection is altered. That is, it
        is directly equivalent to the supporting <code class="literal">modifyXxx()</code> and <code class="literal">clearXxx()</code> methods for properties (see <a class="xref" href="#sec.ModifyAndClear" title="How to trigger other behaviour when a property is changed">the section called &#8220;How to trigger other behaviour when a property is
        changed&#8221;</a>).</p>

        <p>The syntax is:</p>

        <pre class="programlisting">public void addTo&lt;CollectionName&gt;(EntityType param)</pre>

        <p>and</p>

        <pre class="programlisting">public void removeFromCollectionName(EntityType param)</pre>

        <p>where <code class="literal">EntityType</code> is the same
        type as the generic collection type.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Employee { ... }

public class Department {
    private List&lt;Employee&gt; employees = new ArrayList&lt;Employee&gt;();
    public List &lt;Employee&gt; getEmployees() {
        return employees;
    }
    private void setEmployees(List&lt;Employee&gt; employees) { 
        this.employees = employees;
    }
    public void addToEmployees(Employee employee) {
        numMaleEmployees += countOneMale(employee);
        numFemaleEmployees += countOneFemale(employee);
        employees.add(employee);
    }
    public void removeFromEmployees(Employee employee) {
        numMaleEmployees -= countOneMale(employee);
        numFemaleEmployees -= countOneFemale(employee);
        employees.remove(employee);
    }
    private int countOneMale(Employee employee) { return employee.isMale()?1:0; }
    private int countOneFemale(Employee employee) { return employee.isFemale()?1:0; }

    ...
}</pre>
      </div>

      <div class="sect1" title="How to maintain bidirectional relationships"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.MutualRegistrationPattern"></a>How to maintain bidirectional relationships</h2></div></div></div>
        

        <p>The recommended way of maintaining a bidirectional relationship
        is to use the 'mutual registration pattern', a write-up of which can
        be found at <a class="ulink" href="http://www.two-sdg.demon.co.uk/curbralan/papers/MutualRegistration.pdf" target="_top">http://www.two-sdg.demon.co.uk/curbralan/papers/MutualRegistration.pdf</a>.
        The general idea is that one side of the relationship is responsible
        for maintaining the associations, while the other side simply
        delegates.</p>

        <p>To implement this in <span class="emphasis"><em>Isis</em></span> for a 1:m
        relationship, use the <code class="methodname">addToXxx()</code> /
        <code class="methodname">removeFromXxx()</code> and
        <code class="methodname">modifyXxx()</code> /
        <code class="methodname">clearXxx()</code> methods.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Department {
    private List&lt;Employee&gt; employees = new ArrayList&lt;Employee&gt;();
    public List&lt;Employee&gt; getEmployees() { ... }
    private void setEmployees(List&lt;Employee&gt; employees) { ... }
    public void addToEmployees(Employee e) {
        if(e == null || employees.contains(e)) return;
        e.setDepartment(this);
        employees.add(e);
    }
    public void removeFromEmployees(Employee e) {
        if(e == null || !employees.contains(e)) return;
        e.setDepartment(null);
        employees.remove(e);
    }
    ...
}</pre>

        <p>and</p>

        <pre class="programlisting">public class Employee {
    private Department department;
    public Department getDepartment() { ... }
    private void setDepartment(Department department) { ... }
    public void modifyDepartment(Department d) {
        if(d==null || department==d) return;
        if(department != null) {
            department.removeFromEmployees(this);
        }
        d.addToEmployees(this);
    }
    public void clearDepartment() {
        if(department==null) return;
        department.removeFromEmployees(this);
    }
    ...
}</pre>
      </div>
    </div>

    <div class="chapter" title="Chapter&nbsp;7.&nbsp;Domain Entity Actions"><div class="titlepage"><div><div><h2 class="title"><a name="chp.Actions"></a>Chapter&nbsp;7.&nbsp;Domain Entity Actions</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d5e1185">How to add an action to an object</a></span></dt><dt><span class="sect1"><a href="#d5e1215">How to specify names and/or description for an action</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1217">Specifying the name for an action</a></span></dt><dt><span class="sect2"><a href="#d5e1223">Specifying a description for a collection</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1229">How to specify the order in which actions appear on the
        menu</a></span></dt><dt><span class="sect1"><a href="#sec.HiddenActions">How to hide an action</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1240">Hiding an action permanently</a></span></dt><dt><span class="sect2"><a href="#d5e1247">Hiding an action based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e1258">Hiding an action under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e1274">Hiding an action for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DisabledAction">How to prevent an action from being invoked</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1285">Disabling an action permanently</a></span></dt><dt><span class="sect2"><a href="#d5e1289">Disabling an action based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e1301">Based on the state of the object</a></span></dt><dt><span class="sect2"><a href="#d5e1313">Disabling an action for certain users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1318">How to specify names and/or descriptions for an action
        parameter</a></span></dt><dt><span class="sect1"><a href="#d5e1329">How to specify the size of <code class="classname">String</code> action
        parameters</a></span></dt><dt><span class="sect1"><a href="#d5e1348">How to make an action parameter optional</a></span></dt><dt><span class="sect1"><a href="#d5e1352">How to validate an action parameter argument</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1354">Declarative validation</a></span></dt><dt><span class="sect2"><a href="#d5e1369">Imperative validation</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1383">How to specify default values for an action parameter</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1387">Per-parameter syntax (preferred)</a></span></dt><dt><span class="sect2"><a href="#d5e1394">All parameters syntax</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1402">How to specify a set of choices for an action parameter</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1408">Per parameter syntax (preferred)</a></span></dt><dt><span class="sect2"><a href="#d5e1416">All parameters syntax</a></span></dt></dl></dd></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>How-to's relating to a domain entity's actions.</p>
      </div>

      <p>An 'action' is a method that we expect the user to be able to
      invoke on a domain entity via the user interface, though it may also be
      invoked programmatically within the object model. The following
      conventions are used to determine when and how methods are made
      available to the user as actions, and the means by which a user can
      interact with those actions.</p>

      <div class="sect1" title="How to add an action to an object"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1185"></a>How to add an action to an object</h2></div></div></div>
        

        <p>By default, any <code class="literal">public</code>
        instance method that you add to a class will be treated as a user
        action, unless it represents a property, collection, or another
        reserved method defined in this guide.</p>

        <p>The syntax is:</p>

        <pre class="programlisting">public void actionName([ValueOrEntityType param] ...)</pre>

        <p>or</p>

        <pre class="programlisting">public ReturnType actionName([ValueOrEntityType param] ...)</pre>

        <p>When a method returns a reference the viewer will attempt to
        display that object. If the return value is <code class="code">null</code> then
        nothing is displayed.</p>

        <p>We refer to all methods that are intended to be invoked by users
        as 'action methods'.</p>

        <p>If you have a method that you don't want to be made available as
        a user-action you can either:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>make it non-<code class="literal">public</code> (eg <code class="literal">protected</code> or <code class="literal">private</code>)</p>
          </li><li class="listitem">
            <p>annotate it with <code class="classname">@Ignore</code></p>
          </li><li class="listitem">
            <p>annotate it with <code class="classname">@Hidden</code> (discussed
            further in <a class="xref" href="#sec.HiddenActions" title="How to hide an action">the section called &#8220;How to hide an action&#8221;</a>)</p>
          </li></ul></div>

        <p>Note also that <code class="literal">static</code> methods
        are ignored: such functionality should reside in a service, such as a
        repository or factory (see <a class="xref" href="#chp.DomainServices" title="Chapter&nbsp;9.&nbsp;Domain Services, Repositories and Factories">Chapter&nbsp;9, <i>Domain Services, Repositories and Factories</i></a>).</p>
      </div>

      <div class="sect1" title="How to specify names and/or description for an action"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1215"></a>How to specify names and/or description for an action</h2></div></div></div>
        

        <div class="sect2" title="Specifying the name for an action"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1217"></a>Specifying the name for an action</h3></div></div></div>
          

          <p>By default the framework will use the action name itself to
          label the menu item on the user interface. If you wish to override
          this, use the <code class="literal">@Named</code> annotation
          on the action.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer {
    @Named("Place Order")
    public void createOrder() { ... }
    ...
}</pre>
        </div>

        <div class="sect2" title="Specifying a description for a collection"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1223"></a>Specifying a description for a collection</h3></div></div></div>
          

          <p>An additional description can be provided on an action using
          the <code class="literal">@DescribedAs</code> annotation. The
          framework will take responsibility to make this description
          available to the user, for example in the form of a tooltip.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer {
    @DescribedAs("Places an order, causing a shipping note "+
                 "to be generated and invoice to be dispatched")
    public void createOrder() { ... }
    ...
}</pre>
        </div>
      </div>

      <div class="sect1" title="How to specify the order in which actions appear on the menu"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1229"></a>How to specify the order in which actions appear on the
        menu</h2></div></div></div>
        

        <p>The <code class="literal">@MemberOrder</code> annotation
        provides a hint to the viewer as to the order in which the actions
        should be displayed, eg in a menu.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Customer {
    @MemberOrder("3")
    public void placeOrder(Product p) { ... }
    ...

    @MemberOrder("4")
    public void blackList() { ... }
    ...
}</pre>
      </div>

      <div class="sect1" title="How to hide an action"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.HiddenActions"></a>How to hide an action</h2></div></div></div>
        

        <p>The mechanism for hiding an action is broadly the same as for
        hiding a property (see <a class="xref" href="#sec.HiddenProperty" title="How to hide a property from the user">the section called &#8220;How to hide a property from the user&#8221;</a>) or a
        collection (see <a class="xref" href="#sec.HiddenCollection" title="How to hide a collection">the section called &#8220;How to hide a collection&#8221;</a>).</p>

        <div class="sect2" title="Hiding an action permanently"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1240"></a>Hiding an action permanently</h3></div></div></div>
          

          <p>To prevent a user from viewing an action at all, use the
          <code class="literal">@Hidden</code> annotation. This is
          generally used where a <code class="literal">public</code>
          method on an object is not intended to be a user action</p>

          <p>For example:</p>

          <pre class="programlisting">public class Order {
    @Hidden
    public void markAsCancelled() { ... }
    ...
}</pre>
        </div>

        <div class="sect2" title="Hiding an action based on the persistence state of the object"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1247"></a>Hiding an action based on the persistence state of the
          object</h3></div></div></div>
          

          <p>As a refinement of the above, an action may be optionally
          hidden using the <code class="classname">@Hidden</code> annotation based on
          the persistence state of the object:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>to hide the action when the object is transient, use
              <code class="code">@Hidden(When.UNTIL_PERSISTED)</code></p>
            </li><li class="listitem">
              <p>to hide the action when the object is persistent, use
              <code class="code">@Hidden(When.ONCE_PERSISTED)</code></p>
            </li></ul></div>
        </div>

        <div class="sect2" title="Hiding an action under certain conditions"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1258"></a>Hiding an action under certain conditions</h3></div></div></div>
          

          <p>A <code class="literal">hideXxx()</code> method can be
          used to indicate that a particular object's action should be hidden
          under certain conditions, typically relating to the state of that
          instance.</p>

          <p>The syntax is:</p>

          <pre class="programlisting"><code class="literal">public boolean hideActionName([ValueOrEntityType param] ...)</code> </pre>

          <p>where the parameter types should match the action itself
          (allowing for overloading)</p>

          <p>or</p>

          <pre class="programlisting"><code class="literal">public boolean hideActionName()</code> </pre>

          <p>which applies to (all overloaded versions of) the
          action.</p>

          <p>in both cases, returning a value of <code class="code">true</code>
          indicates that the action should be hidden.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Order {
    public void applyDiscount(int percentage) { ... }
    public boolean hideApplyDiscount() {
        return isWholesaleOrder();
    }
}</pre>
        </div>

        <div class="sect2" title="Hiding an action for specific users or roles"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1274"></a>Hiding an action for specific users or roles</h3></div></div></div>
          

          <p>It is possible to hide actions for certain users/roles by
          calling the <code class="methodname">DomainObjectContainer#getUser()</code>
          method. See <a class="xref" href="#sec.BusinessRulesForCertainUsersOrRoles" title="Hiding, disabling or validating for specific users or roles">the section called &#8220;Hiding, disabling or validating for specific users or
        roles&#8221;</a> for further
          discussion.</p>
        </div>
      </div>

      <div class="sect1" title="How to prevent an action from being invoked"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.DisabledAction"></a>How to prevent an action from being invoked</h2></div></div></div>
        

        <p>Preventing the user from invoking an action is known as
        'disabling' the action.</p>

        <p>The mechanism for disabling an action is broadly the same as for
        disabling a property (see <a class="xref" href="#sec.DisabledProperty" title="How to prevent a property from being modified">the section called &#8220;How to prevent a property from being modified&#8221;</a>) or
        a collection (see <a class="xref" href="#sec.DisabledCollection" title="How to prevent a collection from being modified">the section called &#8220;How to prevent a collection from being modified&#8221;</a>).</p>

        <div class="sect2" title="Disabling an action permanently"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1285"></a>Disabling an action permanently</h3></div></div></div>
          

          <p>It is possible to prevent an action from ever being invoked
          using the <code class="classname">@Disabled</code> annotation, exactly
          equivalent to the use of the annotation for properties and
          collections. However, it's not a particularly meaningful usecase:
          why display an action that can never be invoked? The only reason we
          can think of is as a placeholder during prototyping - to indicate to
          the user that an action is planned, but has not yet been
          implemented.</p>
        </div>

        <div class="sect2" title="Disabling an action based on the persistence state of the object"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1289"></a>Disabling an action based on the persistence state of the
          object</h3></div></div></div>
          

          <p>Whereas annotating an action simply as
          <code class="classname">@Disabled</code> probably does not make sense (see
          above), it does make sense to optionally disable an action using the
          <code class="classname">@Disabled</code> annotation based on the persistence
          state of the object:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>to disable the action when the object is transient, use
              <code class="code">@Disabled(When.UNTIL_PERSISTED)</code></p>
            </li><li class="listitem">
              <p>to disable the action when the object is persistent, use
              <code class="code">@Disabled(When.ONCE_PERSISTED)</code></p>
            </li></ul></div>
        </div>

        <div class="sect2" title="Based on the state of the object"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1301"></a>Based on the state of the object</h3></div></div></div>
          

          <p>There may be circumstances in which we do not want the user to
          be able to initiate the action at all - for example because that
          action is not appropriate to the current state of the object on
          which the action resides. Such rules are enforced by means of a
          <code class="literal">disableXxx()</code> supporting
          method.</p>

          <p>The syntax is:</p>

          <pre class="programlisting">public String disableActionName([ValueOrEntityType param]...)</pre>

          <p>A non-<code class="literal">null</code> return <code class="code">String</code>
          indicates the reason why the action may not be invoked. The
          framework takes responsibility to provide this feedback to the
          user.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer {
    public Order placeOrder(Product p, int quantity) { ... }
    public String disablePlaceOrder(Product p, int quantity) { 
        return isBlackListed()?
            "Blacklisted customers cannot place orders"
            :null;
    }
    ...
}</pre>
        </div>

        <div class="sect2" title="Disabling an action for certain users or roles"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1313"></a>Disabling an action for certain users or roles</h3></div></div></div>
          

          <p>It is possible to disable actions for certain users/roles by
          calling the <code class="methodname">DomainObjectContainer#getUser()</code>
          method. See <a class="xref" href="#sec.BusinessRulesForCertainUsersOrRoles" title="Hiding, disabling or validating for specific users or roles">the section called &#8220;Hiding, disabling or validating for specific users or
        roles&#8221;</a> for further
          discussion.</p>
        </div>
      </div>

      <div class="sect1" title="How to specify names and/or descriptions for an action parameter"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1318"></a>How to specify names and/or descriptions for an action
        parameter</h2></div></div></div>
        

        <p>Unlike with properties, the framework cannot pick up the names
        of parameters that you use within the domain code. By default
        parameters will be labelled only with the type of the object required
        (e.g. 'String:' or 'Customer:)</p>

        <p>If you want a parameter to have a different name (such as 'First
        Name', 'Last Name') then that parameter should be marked up with an
        <code class="literal">@Named</code> annotation - very often
        taking the same form as the parameter name used in the code.
        Alternatively though, you could create a user-defined value type,
        using <code class="literal">@Value</code> (see <a class="xref" href="#chp.ValueTypes" title="Chapter&nbsp;10.&nbsp;Value Types">Chapter&nbsp;10, <i>Value Types</i></a>).</p>

        <p>Similarly, any parameter may be given a short user-description
        using the <code class="literal">@DescribedAs</code> annotation.
        The framework takes responsibility to make this available to the
        user.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Customer {
    public Order placeOrder(
            Product p, 
            @Named("Quantity")
            @DescribedAs("The number of units of the specified product in this order")
            int quantity) {
        ...
    }
    ...
}</pre>
      </div>

      <div class="sect1" title="How to specify the size of String action parameters"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1329"></a>How to specify the size of <code class="classname">String</code> action
        parameters</h2></div></div></div>
        

        <p>As for properties (see <a class="xref" href="#sec.SizeProperties" title="How to specify the size of String properties">the section called &#8220;How to specify the size of <code class="classname">String</code>
        properties&#8221;</a>),
        use:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>the <code class="literal">@MaxLength</code> to specify
            the maximum number of characters that may be stored within a
            <code class="classname">String</code> parameter.</p>
          </li><li class="listitem">
            <p>the <code class="literal">@TypicalLength</code> to
            specify the typical number of characters that are likely to be
            stored within a <code class="classname">String</code> parameter. Viewers
            are expected to use this as a hint as to the size of the field to
            render for the parameter.</p>
          </li><li class="listitem">
            <p>the <code class="literal">@MultiLine</code> annotation
            as a hint to indicate that the parameter should be displayed over
            multiple lines (eg as a text area rather than a text
            field).</p>
          </li></ul></div>

        <p>For example:</p>

        <pre class="programlisting">public class TicketRaiser {

    public void raiseTicket(
            @TypicalLength(50) @MaxLength(255) @Named("Description")
            String getDescription,
            @MaxLength(2048) @MultiLine @Named("Notes")
            String notes) {
        ...
    }
    ...
}</pre>
      </div>

      <div class="sect1" title="How to make an action parameter optional"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1348"></a>How to make an action parameter optional</h2></div></div></div>
        

        <p>By default, the framework assumes that when an action method is
        to be invoked, all the parameters are mandatory. You may over-ride
        this behaviour by marking up one or more of the paramaters with the
        <code class="literal">@Optional</code> annotation.</p>
      </div>

      <div class="sect1" title="How to validate an action parameter argument"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1352"></a>How to validate an action parameter argument</h2></div></div></div>
        

        <div class="sect2" title="Declarative validation"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1354"></a>Declarative validation</h3></div></div></div>
          

          <p>For parameters that accept a text input string, such as
          <code class="code">String</code> and <code class="code">Date</code>, there are convenient
          mechanisms to validate and/or normalise the values typed in:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>For <code class="literal">Date</code> and number
              values the <code class="literal">@Mask</code> annotation
              may be used.</p>
            </li><li class="listitem">
              <p>For <code class="literal">String</code> parameters
              the <code class="literal">@RegEx</code> annotation may be
              used.</p>
            </li></ul></div>

          <p>More complex validation can also be performed imperatively
          (below).</p>
        </div>

        <div class="sect2" title="Imperative validation"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1369"></a>Imperative validation</h3></div></div></div>
          

          <p>A <code class="literal">validateXxx()</code> method is
          used to check that the set of arguments used by an action method is
          valid. If the arguments are invalid then the framework will not
          invoke the action.</p>

          <p>The syntax is:</p>

          <pre class="programlisting">public String validate&lt;ActionName&gt;([ValueOrEntityType param]...)</pre>

          <p>A non-<code class="code">null</code> return <code class="classname">String</code>
          indicates the reason why the member cannot be modified/action be
          invoked, and the viewing mechanism will display this feedback to the
          user.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer {
    public Order placeOrder(Product p, int quantity) { ... }
    public String validatePlaceOrder(Product p, int quantity) {
        if (p.isOutOfStock()) { return "Product is out of stock"; }
        if (quantity &lt;= 0) { return "Quantity must be a positive value"; }
        return null;
    }
    ...
}</pre>

          <p>For complex validation, you may wish to use the
          <code class="classname">org.apache.isis.applib.util.ReasonBuffer</code>
          helper class.</p>
        </div>
      </div>

      <div class="sect1" title="How to specify default values for an action parameter"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1383"></a>How to specify default values for an action parameter</h2></div></div></div>
        

        <p>When an action is about to be invoked, then default values can
        be provided for any or all of its parameters.</p>

        <p>There are two different ways to specify parameters; either per
        parameter, or for all parameters.</p>

        <div class="sect2" title="Per-parameter syntax (preferred)"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1387"></a>Per-parameter syntax (preferred)</h3></div></div></div>
          

          <p>The per-parameter form is simpler and generally to be
          preferred.</p>

          <p>The syntax is:</p>

          <pre class="programlisting">public ParameterType defaultNActionName()</pre>

          <p>where N indicates the 0-based parameter number. For
          example:</p>

          <pre class="programlisting">public class Customer {
    public Order placeOrder(
             Product product,
             @Named("Quantity") 
             int quantity) {
        ...
    }
    public Product default0PlaceOrder() {
        return productMostRecentlyOrderedBy(this.getCustomer());
    }
    public int default1PlaceOrder() {
        return 1;
    }
}</pre>
        </div>

        <div class="sect2" title="All parameters syntax"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1394"></a>All parameters syntax</h3></div></div></div>
          

          <p>The syntax for specifying all the parameter default values in
          one go is:</p>

          <pre class="programlisting">public Object[] defaultActionName([ValueOrEntityType param]...)</pre>

          <p>returning an array which must have one element per parameter
          in the action method signature of corresponding default
          values.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer {
    public Order placeOrder(
            Product product,
            @Named("Quantity") 
            int quantity) {
        ...
    }
    public Object[] defaultPlaceOrder(
            Product product,
            int quantity) {
        return new Object[] {
            productMostRecentlyOrderedBy(this.getCustomer()),
            1
        };
    }
    ...
}</pre>
        </div>
      </div>

      <div class="sect1" title="How to specify a set of choices for an action parameter"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1402"></a>How to specify a set of choices for an action parameter</h2></div></div></div>
        

        <p>The programmer may provide a set of choices for the value of any
        or all of the parameters of an action. These will be made available to
        the user - for example as a drop-down list.</p>

        <p>If the type of the parameter is annotated with <code class="literal">@Bounded</code>, then it is not necessary to
        specify the choices for that parameter, as the user will automatically
        be offered the full set to choose from.</p>

        <p>If this isn't the case, then - as for defaults - there are two
        different ways to specify parameters; either per parameter, or for all
        parameters.</p>

        <div class="sect2" title="Per parameter syntax (preferred)"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1408"></a>Per parameter syntax (preferred)</h3></div></div></div>
          

          <p>The per-parameter form is simpler and generally
          preferred.</p>

          <p>The syntax is:</p>

          <pre class="programlisting">public List&lt;ParameterType&gt; choicesNActionName()</pre>

          <p>where N indicates the 0-based parameter number.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Order {
    public Order placeOrder(
            Product product,
            @Named("Quantity") 
            int quantity) {
        ...
    }
    public List&lt;Product&gt; choices0PlaceOrder() {
        return lastFiveProductsOrderedBy(this.getCustomer());
    }
    public List&lt;Integer&gt; choices1PlaceOrder() {
        return Arrays.asList(1,2,3,4,5);
    }
    ....
}</pre>
        </div>

        <div class="sect2" title="All parameters syntax"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1416"></a>All parameters syntax</h3></div></div></div>
          

          <p>The alternative mechanism is to supply all the parameter
          choices in one go:</p>

          <pre class="programlisting">public Object[] choices&lt;ActionName&gt;([&lt;parameter type&gt; param]...)</pre>

          <p>returning an array, which must have one element per parameter
          in the method signature. Each element of the array should itself
          either be an array or a list, containing the set of values
          representing the choices for that parameter, or <code class="literal">null</code> if there are no choices to be
          specified for that parameter.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Order {
    public Order placeOrder(
            Product product,
            @Named("Quantity") 
            int quantity) {
        ...
    }
    public Object[] choicesPlaceOrder(
            Product product,
            int quantity) {
        return new Object[] {
            lastFiveProductsOrderedBy(this.getCustomer()).toArray(), 
            Arrays.asList(1,2,3,4,5)
        };
    }
    ...
}</pre>
        </div>
      </div>
    </div>

    <div class="chapter" title="Chapter&nbsp;8.&nbsp;Further Business Rule How-Tos"><div class="titlepage"><div><div><h2 class="title"><a name="d5e1425"></a>Chapter&nbsp;8.&nbsp;Further Business Rule How-Tos</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#sec.MustSpecify">@MustSatisfy Specification</a></span></dt><dt><span class="sect1"><a href="#sec.BusinessRulesForCertainUsersOrRoles">Hiding, disabling or validating for specific users or
        roles</a></span></dt><dt><span class="sect1"><a href="#d5e1478">How to pass a messages and errors back to the user</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>Further validation how-to's that apply across all class
        members</p>
      </div>

      <p>This chapter has some additional recipes/how-tos relating to
      implementing business rules. They apply across all class members.</p>

      <div class="sect1" title="@MustSatisfy Specification"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.MustSpecify"></a>@MustSatisfy Specification</h2></div></div></div>
        

        <p>The <code class="literal">@MustSatisfy</code> annotation is an alternative
        to using imperative validation, allowing validation rules to be
        captured in an (implementation of a)
        <code class="classname">org.apache.isis.applib.spec.Specification</code>.</p>

        <p>For example:</p>

        <pre class="programlisting">public class DomainObjectWithMustSatisfyAnnotations extends AbstractDomainObject {

    private String lastName;
    @MustSatisfy(SpecificationRequiresFirstLetterToBeUpperCase.class)
    public String getLastName() {
        resolve(lastName);
        return lastName;
    }
    public void setLastName(String lastName) {
        this.lastName = lastName;
        objectChanged();
    }

    public void changeLastName(
            @MustSatisfy(SpecificationRequiresFirstLetterToBeUpperCase.class)
            String lastName
            ) {
        setLastName(lastName);
    }

}</pre>

        <p>To help you write your own
        <code class="classname">Specification</code>s, there are some adapter classes
        in <span class="package">org.apache.isis.applib.specs</span>:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="classname">AbstractSpecification</code>, which
            implements <code class="classname">Specification</code> and takes
            inspiration from the <a class="ulink" href="http://code.google.com/p/hamcrest/" target="_top">Hamcrest</a>
            library's <code class="classname">TypeSafeMatcher</code> class</p>
          </li><li class="listitem">
            <p><code class="classname">SpecificationAnd</code>, which allows a set
            of <code class="classname">Specification</code>s to be grouped together
            and require that <span class="emphasis"><em>all</em></span> of them are
            satisfied</p>
          </li><li class="listitem">
            <p><code class="classname">SpecificationOr</code>, which allows a set
            of <code class="classname">Specification</code>s to be grouped together
            and require that <span class="emphasis"><em>at least one</em></span> of them is
            satisfied</p>
          </li><li class="listitem">
            <p><code class="classname">SpecificationNot</code>, which requires that
            the provided <code class="classname">Specification</code> is
            <span class="emphasis"><em>not</em></span> satisfied</p>
          </li></ul></div>
      </div>

      <div class="sect1" title="Hiding, disabling or validating for specific users or roles"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.BusinessRulesForCertainUsersOrRoles"></a>Hiding, disabling or validating for specific users or
        roles</h2></div></div></div>
        

        <p>Generally it is not good practice to embed knowledge of roles
        and/or users into the domain classes; instead, this should be the
        responsibility of the framework or platform and should be specified
        and administered externally to the domain model. However, in rare
        circumstances it might be necessary or pragmatic to implement access
        control within the domain model.</p>

        <p>The current user can be obtained from
        <code class="classname">DomainObjectContainer</code>, using its
        <code class="methodname">getUser()</code> method. Alternatively, if the
        domain object inherits from
        <code class="classname">AbstractDomainObject</code>, then
        <code class="methodname">getUser()</code> is also inherited. In either case
        the method returns an object of type
        <code class="methodname">org.apache.isis.security.UserMemento</code>, which
        holds both username and the set of roles for that user. The full
        details of the security classes can be found in <a class="xref" href="#apx.SecurityClasses" title="Appendix&nbsp;D.&nbsp;Security Classes">Appendix&nbsp;D, <i>Security Classes</i></a>.</p>

        <p>The mechanism to apply a business rule is just to return an
        appropriate value from a supporting
        <code class="methodname">hideXxx()</code>,
        <code class="methodname">disableXxx()</code> or
        <code class="methodname">validateXxx()</code> method.</p>

        <p>For example, the following requires that the MODIFY_SALARY role
        is assigned to the current user in order to update a salary property
        beyond a certain value:</p>

        <pre class="programlisting">public class Employee extends AbstractDomainObject {
    public BigDecimal getSalary() { ... }
    public void setSalary(BigDecimal salary) { ... }
    public String validateSalary() {
        return salary.doubleValue() &gt;= 30000 &amp;&amp;
              !getUser().hasRole("MODIFY_SALARY")?
              "Need MODIFY_SALARY role to increase salary above 30000": null;
    }
}</pre>
      </div>

      <div class="sect1" title="How to pass a messages and errors back to the user"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1478"></a>How to pass a messages and errors back to the user</h2></div></div></div>
        

        <p>Sometimes, within an action it is necessary or desirable to pass
        a message to the user, for example to inform them of the results of
        their action ('5 payments have been issued') or that the action was
        not successful ('No Customer found with name John Smith').</p>

        <p><code class="code">DomainObjectContainer</code> defines three methods for
        this purpose:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="methodname">informUser(String message)</code></p>

            <p>Inform the user of some event. The user should not be
            expected to acknowledge the message; typically the viewer will
            display the message for a period of time in a non-modal
            notification window.</p>
          </li><li class="listitem">
            <p><code class="methodname">warnUser(String message)</code></p>

            <p>Warn the user of some event. Because this is more serious,
            the viewer should require the user to acknowledge the
            message.</p>
          </li><li class="listitem">
            <p><code class="methodname">raiseError(String message)</code></p>

            <p>Indicate that a serious application error has occurred. The
            viewer should again require the user to acknowledge the message,
            and quite possibly indicate further steps that the user should
            perform (eg notify the help desk).</p>
          </li></ul></div>

        <p>The precise mechanics of how each of these messages is rendered
        visible to the user is determined by the viewer being used.</p>
      </div>
    </div>

    <div class="chapter" title="Chapter&nbsp;9.&nbsp;Domain Services, Repositories and Factories"><div class="titlepage"><div><div><h2 class="title"><a name="chp.DomainServices"></a>Chapter&nbsp;9.&nbsp;Domain Services, Repositories and Factories</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#sec.AbstractService">How to not inherit from framework classes</a></span></dt><dt><span class="sect1"><a href="#sec.Services">How to register domain services, repositories and
        factories</a></span></dt><dt><span class="sect1"><a href="#d5e1528">How to inject services into entities</a></span></dt><dt><span class="sect1"><a href="#d5e1535">How to write a typical domain service</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1542">The <code class="methodname">getId()</code> method</a></span></dt><dt><span class="sect2"><a href="#d5e1550">(Suppressing) contributed actions</a></span></dt><dt><span class="sect2"><a href="#d5e1572">(Suppressing) service menu items</a></span></dt><dt><span class="sect2"><a href="#d5e1581">(Suppressing) service menus</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1586">How to use a generic repository</a></span></dt><dt><span class="sect1"><a href="#sec.CustomRepository">How to write a custom repository</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1634">Finding by Title</a></span></dt><dt><span class="sect2"><a href="#d5e1650">Finding by Pattern</a></span></dt><dt><span class="sect2"><a href="#d5e1672">Finding using the <code class="classname">Filter</code> API</a></span></dt><dt><span class="sect2"><a href="#d5e1695">Finding using the <code class="classname">Query</code> API</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1739">Factories</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>How-to's relating to writing services, repositories and
        factories.</p>
      </div>

      <p>This chapter contains how-to's for programming conventions that
      writing domain services (by which we also mean repositories and
      factories); ie everything that isn't a domain object or a value
      type.</p>

      <p>Domain services are instantiated once and once only by the
      framework, and are used to centralize any domain logic that does not
      logically belong in a domain entity or value. <span class="emphasis"><em>Isis</em></span>
      will automatically inject services into every domain entity that
      requests them, and into each other.</p>

      <div class="sect1" title="How to not inherit from framework classes"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.AbstractService"></a>How to not inherit from framework classes</h2></div></div></div>
        

        <p>Like entities, it isn't mandatory for domain services to inherit
        from any framework superclass; they can be plain-old pojos if
        required. However, again, like entities, they do at a minimum need to
        have a
        <code class="classname">org.apache.isis.applib.DomainObjectContainer</code>
        injected into them (an interface), from which other framework services
        can be accessed.</p>

        <p>If you don't have a requirement to inherit from any other
        superclass, then it usually makes sense to inherit from one of the
        abstract classes in the applib, either
        <code class="classname">org.apache.isis.applib.AbstractService</code> or
        <code class="classname">org.apache.isis.applib.AbstractRepositoryAndFactory</code>.
        These already supports the
        <code class="classname">DomainObjectContainer</code> and have a number of
        convenience helper methods.</p>

        <p>The <acronym class="acronym">UML</acronym> class diagram below shows the
        relationship between these types and the
        <code class="classname">DomainObjectContainer</code>.</p>

        <div class="mediaobject"><img src="images/AbstractContainedObject-hierarchy.png" width="351"></div>

        <p>What this means is that <span class="emphasis"><em>Apache Isis</em></span> treats
        factories and repositories as just another type of domain
        service.</p>
      </div>

      <div class="sect1" title="How to register domain services, repositories and factories"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.Services"></a>How to register domain services, repositories and
        factories</h2></div></div></div>
        

        <p>All domain services (which includes repositories and factories)
        should be registered in the isis.properties configuration file, under
        the <code class="varname">isis.services.prefix</code> (a common package name)
        and <code class="varname">isis.services</code> key (a comma-separated
        list).</p>

        <p>For example:</p>

        <pre class="programlisting">isis.services.prefix = org.apache.isis.support.prototype.objstore.dflt
isis.services = employee.EmployeeRepositoryDefault, claim.ClaimRepositoryDefault</pre>

        <p>This will instantiate a single instance of each of the two
        services listed.</p>
      </div>

      <div class="sect1" title="How to inject services into entities"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1528"></a>How to inject services into entities</h2></div></div></div>
        

        <p>All that is required to inject a service into an entity (or
        indeed into another service) is to provide an appropriately typed
        setter. The name of the method does not matter, only that it is
        prefixed "set", is public, and has a single parameter of the correct
        type.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Customer {
    private OrderRepository orderRepository;
    public void setOrderRepository(OrderRepository orderRepository) {
        this.orderRepository = orderRepository;
    }
    ...
}</pre>

        <p>Note that we consider
        <code class="classname">DomainObjectContainer</code> to be a service too;
        hence it can be injected in exactly the same manner.</p>
      </div>

      <div class="sect1" title="How to write a typical domain service"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1535"></a>How to write a typical domain service</h2></div></div></div>
        

        <p>Services consist of a set of logically grouped actions, and as
        such follow the same conventions as for entities (see <a class="xref" href="#chp.Actions" title="Chapter&nbsp;7.&nbsp;Domain Entity Actions">Chapter&nbsp;7, <i>Domain Entity Actions</i></a>). However, a service cannot have (persisted)
        properties, nor can it have (persisted) collections.</p>

        <p>For convenience you can inherit from
        <code class="classname">AbstractService</code> or one of its subclasses (see
        <a class="xref" href="#sec.AbstractService" title="How to not inherit from framework classes">the section called &#8220;How to not inherit from framework classes&#8221;</a>), but this is not
        mandatory.</p>

        <div class="sect2" title="The getId() method"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1542"></a>The <code class="methodname">getId()</code> method</h3></div></div></div>
          

          <p>Optionally, a service may provide a
          <code class="methodname">getId()</code> method:</p>

          <pre class="programlisting">public String getId()</pre>

          <p>This method returns a logical identifier for a service,
          independent of its implementation. Currently it used only by
          perspectives, providing a label by which to record the services that
          are available for a current user's profile. See <a class="xref" href="#chp.UserProfiles" title="Chapter&nbsp;12.&nbsp;Profiles">Chapter&nbsp;12, <i>Profiles</i></a> for more about profiles and
          perspectives.</p>
        </div>

        <div class="sect2" title="(Suppressing) contributed actions"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1550"></a>(Suppressing) contributed actions</h3></div></div></div>
          

          <p>Any n-parameter action provided by a service will
          automatically be contributed to the list of actions for each of its
          (entity) parameters. From the viewpoint of the entity the action is
          called a contributed action.</p>

          <p>For example, given a service:</p>

          <pre class="programlisting">public interface Library {
    public Loan borrow(Loanable l, Borrower b);
}</pre>

          <p>and the entities:</p>

          <pre class="programlisting">public class Book implements Loanable { ... }y</pre>

          <p>and</p>

          <pre class="programlisting">public class LibraryMember implements Borrower { ... }</pre>

          <p>then the <code class="methodname">borrow(...)</code> action will be
          contributed to both <code class="classname">Book</code> and to
          <code class="classname">LibraryMember</code>.</p>

          <p>This is an important capability because it helps to decouple
          the concrete classes from the services.</p>

          <p>If necessary, though, this behaviour can be suppressed by
          annotating the service action with
          <code class="classname">@org.apache.isis.applib.annotations.NotContributed</code>.</p>

          <p>For example:</p>

          <pre class="programlisting">public interface Library {
    @NotContributed
    public Loan borrow(Loanable l, Borrower b);
}</pre>

          <p>If annotated at the interface level, then the annotation will
          be inherited by every concrete class. Alternatively the annotation
          can be applied at the implementation class level and only apply to
          that particular implementation.</p>

          <p>Note that an action annotated as being
          <code class="classname">@NotContributed</code> will still appear in the
          service menu for the service. If an action should neither be
          contributed nor appear in service menu items, then simply annotate
          it as <code class="classname">@Hidden</code>.</p>
        </div>

        <div class="sect2" title="(Suppressing) service menu items"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1572"></a>(Suppressing) service menu items</h3></div></div></div>
          

          <p>By default every action of a service (by which we also mean
          repositories and factories) will be rendered in the viewer, eg as a
          menu item for that service menu. This behaviour can be suppressed by
          annotating the action using
          <code class="classname">@org.apache.isis.applib.annotations.NotInServiceMenu</code>.</p>

          <p>For example:</p>

          <pre class="programlisting">public interface Library {
    @NotInServiceMenu
    public Loan borrow(Loanable l, Borrower b);
}</pre>

          <p>Note that an action annotated as being
          <code class="classname">@NotInServiceMenu</code> will still be contributed.
          If an action should neither be contributed nor appear in service
          menu items, then simply annotate it as
          <code class="classname">@Hidden</code>.</p>
        </div>

        <div class="sect2" title="(Suppressing) service menus"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1581"></a>(Suppressing) service menus</h3></div></div></div>
          

          <p>If none of the service menu items should appear, then the
          service itself should be annotated as @Hidden.</p>

          <p>For example:</p>

          <pre class="programlisting">@Hidden
public interface EmailService {
    public void sendEmail(String to, String from, String subject, String body);
    public void forwardEmail(String to, String from, String subject, String body);
}</pre>
        </div>
      </div>

      <div class="sect1" title="How to use a generic repository"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1586"></a>How to use a generic repository</h2></div></div></div>
        

        <p>To speed up initial prototype the framework allows so-called
        generic repositories to be defined, one per entity. Such a repository
        will, for its specified type, provide methods to:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>Create a new transient instance</p>
          </li><li class="listitem">
            <p>Create a new persisted instance</p>
          </li><li class="listitem">
            <p>Find all persisted instances</p>
          </li><li class="listitem">
            <p>Find instances with a specified title</p>
          </li></ul></div>

        <p>To register such a service prefix the class name with the prefix
        <code class="literal">repository#</code>.</p>

        <p>For example:</p>

        <pre class="programlisting">isis.services = repository#dom.Booking</pre>

        <p>Over time, you should expect most if not all of these generic
        repositories will be replaced with regular repository types (see <a class="xref" href="#sec.CustomRepository" title="How to write a custom repository">the section called &#8220;How to write a custom repository&#8221;</a>).</p>
      </div>

      <div class="sect1" title="How to write a custom repository"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.CustomRepository"></a>How to write a custom repository</h2></div></div></div>
        

        <p>Repositories are defined as interfaces within the domain, and
        their implementation will vary by object store. During prototyping and
        for much of development, you will probably find it easiest to use an
        in-memory object store or perhaps the <acronym class="acronym">XML</acronym> object
        store, with only a small number of instances. The
        <code class="classname">DomainObjectContainer</code> provides a set of methods
        that make it easy to pull back all instances from the object store
        which can then be filtered as required. Later on, you can replace the
        implementation depending upon the specifics of the object store that
        you'll be using for production.</p>

        <p>If you inherit from the <code class="literal">org.apache.isis.applib.AbstractFactoryAndRepository</code>
        adapter class then this will automatically have the
        <code class="classname">DomainObjectContainer</code> injected, and provides
        convenience methods that delegate to the container. Using this is not
        mandatory, however.</p>

        <p>The methods provided by the
        <code class="classname">DomainObjectContainer</code> to support repositories
        are:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="methodname">allInstances(Class&lt;T&gt;
            ofType)</code></p>

            <p>Returns all instances of the specified type. Note that this
            includes all instances of any subtypes.</p>
          </li><li class="listitem">
            <p><code class="methodname">allMatches(...)</code></p>

            <p>Returns all instances matching the provided
            arguments.</p>
          </li><li class="listitem">
            <p><code class="methodname">firstMatch(...)</code></p>

            <p>Returns the first instance matching the provided
            arguments.</p>
          </li><li class="listitem">
            <p><code class="methodname">uniqueMatch(...)</code></p>

            <p>Returns the one-and-only instance matching the provided
            arguments (else is an exception).</p>
          </li></ul></div>

        <p>The last three methods, <code class="methodname">*Match(...)</code> are
        all overloaded in order to return a subset of object instances. Some
        of these are "naive"; all instances are returned from the object
        store, and the filtering is performed within the repository. Others
        are designed to pass the query predicate back to the object store so
        that only the matching rows are returned.</p>

        <p>Each of these options are discussed in more detail below.</p>

        <div class="sect2" title="Finding by Title"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1634"></a>Finding by Title</h3></div></div></div>
          

          <p>The first version of finding instances is to specify the
          required title for the matching objects:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p><code class="methodname">allMatches(Class&lt;T&gt; ofType, String
              title)</code></p>
            </li><li class="listitem">
              <p><code class="methodname">firstMatch(Class&lt;T&gt; ofType, String
              title)</code></p>
            </li><li class="listitem">
              <p><code class="methodname">uniqueMatch(Class&lt;T&gt; ofType, String
              title)</code></p>
            </li></ul></div>

          <p>Although easy and intuitive, this isn't generally recommended
          for production use because (a) the matching is performed within the
          repository rather than the object store, and (b) the title string
          can often change as business requirements are refined.</p>

          <p>That said, it is possible to eliminate the first disadvantage
          by using the <code class="classname">Query</code> API, discussed below; this
          provides an implementation that is equivalent to find by
          title.</p>
        </div>

        <div class="sect2" title="Finding by Pattern"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1650"></a>Finding by Pattern</h3></div></div></div>
          

          <p>The next technique of finding instances is to specify pattern
          object to match against (sometimes called "query-by-example", or
          <acronym class="acronym">QBE</acronym>):</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p><code class="methodname">allMatches(Class&lt;T&gt; ofType, Object
              pattern)</code></p>
            </li><li class="listitem">
              <p><code class="methodname">firstMatch(Class&lt;T&gt; ofType, Object
              pattern)</code></p>
            </li><li class="listitem">
              <p><code class="methodname">uniqueMatch(Class&lt;T&gt; ofType, Object
              pattern)</code></p>
            </li></ul></div>

          <p>Any non-null value of the pattern object is used as the
          predicate.</p>

          <p>Although more robust that searching by title, this technique
          is also not likely to be valid for production code because the
          matching is still performed within the repository rather than within
          the object store.</p>

          <p>That said, it is possible to eliminate the first disadvantage
          by using the <code class="classname">Query</code> API, discussed below; this
          provides an implementation that is equivalent to find by
          pattern.</p>

          <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
            <p>If the pattern object is created using
            <code class="methodname">newTransientInstance(...)</code>, then any
            default values for properties will automatically be set (see <a class="xref" href="#sec.DefaultPropertyValue" title="How to set up the initial value of a property programmatically">the section called &#8220;How to set up the initial value of a property
        programmatically&#8221;</a>). If this isn't required,
            they will need to be manually cleared.</p>
          </div>
        </div>

        <div class="sect2" title="Finding using the Filter API"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1672"></a>Finding using the <code class="classname">Filter</code> API</h3></div></div></div>
          

          <p>The third overloaded version of the matching methods to find
          instances all take an
          <code class="classname">org.apache.isis.applib.Filter&lt;T&gt;</code>
          instance:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p><code class="methodname">allMatches(Class&lt;T&gt; ofType,
              Filter&lt;T&gt; filter)</code></p>
            </li><li class="listitem">
              <p><code class="methodname">firstMatch(Class&lt;T&gt; ofType,
              Filter&lt;T&gt; filter)</code></p>
            </li><li class="listitem">
              <p><code class="methodname">uniqueMatch(Class&lt;T&gt; ofType,
              Filter&lt;T&gt; filter)</code></p>
            </li></ul></div>

          <p>The <code class="classname">Filter&lt;T&gt;</code> interface is very
          straightforward:</p>

          <pre class="programlisting">public interface Filter&lt;T&gt; {
    public boolean accept(T obj);
}</pre>

          <p>Every object of the given type (and subclasses) is passed into
          the <code class="classname">Filter</code> instance; only those
          <code class="methodname">accept()</code>'ed are returned from the
          <code class="methodname">*Match()</code> method.</p>

          <p>Although flexible, with this technique the matching is also
          performed within the repository rather than the object store, and so
          is also likely not to be suitable for production use where there are
          many instances of the given type.</p>
        </div>

        <div class="sect2" title="Finding using the Query API"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1695"></a>Finding using the <code class="classname">Query</code> API</h3></div></div></div>
          

          <p>The finaly overloaded version of the matching methods take an
          instance of
          <code class="classname">org.apache.isis.applib.query.Query&lt;T&gt;</code>
          interface:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p><code class="methodname">allMatches(Query&lt;T&gt;
              query)</code></p>
            </li><li class="listitem">
              <p><code class="methodname">firstMatch(Query&lt;T&gt;
              query)</code></p>
            </li><li class="listitem">
              <p><code class="methodname">uniqueMatch(Query&lt;T&gt;
              query)</code></p>
            </li></ul></div>

          <p>Unlike all the other matching mechanisms, the point of the
          <code class="classname">Query</code> interface is for it to be passed back
          to the object store and evaluated there.</p>

          <p>The applib provides several implementations that implement the
          <code class="classname">Query&lt;T&gt;</code> interface. Probably the most
          important of these is <code class="classname">QueryDefault&lt;T&gt;</code>,
          which provides a set of factory methods for constructing
          <code class="classname">Query</code> instances that represent a named query
          with a map of parameter/argument pairs.</p>

          <p>For example:</p>

          <pre class="programlisting">public class CustomerRepositoryImpl implements CustomerRepository {
    public List&lt;Customer&gt; findCustomers(
            @Named("Last Name") String lastName,
            @Named("Postcode")  String postCode
        ) {
        QueryDefault&lt;Customer&gt; query = 
            QueryDefault.create(
                Customer.class, 
                "findCustomers", 
                "lastName", lastName, 
                "postCode", postCode);

        return getContainer().allMatches(query);
    }
    ...
}</pre>

          <p>Above it was noted that the other overloaded versions of the
          matching <acronym class="acronym">API</acronym> have the disadvantage that the
          matching is performed within the repository. As an alternative to
          using "find by title" or "find by pattern", you may wish to use
          QueryFindByTitle and QueryFind</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p><code class="classname">QueryFindByTitle&lt;T&gt;</code>, which
              corresponds to the <code class="methodname">allMatches(...)</code> for
              searching by title</p>
            </li><li class="listitem">
              <p><code class="classname">QueryFindByPattern&lt;T&gt;</code>, which
              corresponds to the <code class="methodname">allMatches(...)</code> for
              searching by pattern</p>
            </li></ul></div>

          <p>There is also a
          <code class="classname">QueryFindAllInstances&lt;T&gt;</code>, which
          corresponds to the <code class="methodname">allInstances()</code>
          method.</p>

          <p>The interpretation of a <code class="classname">Query</code> instance
          ultimately depends on the object store. All object stores will
          support <code class="classname">QueryFindAllInstances</code>, and most will
          provide a mechanism to support <code class="classname">QueryDefault</code>.
          Check the object store documentation to determine whether they
          support other <code class="classname">Query</code> implementations (ie,
          <code class="classname">QueryFindByTitle</code> and
          <code class="classname">QueryFindByPattern</code>).</p>
        </div>
      </div>

      <div class="sect1" title="Factories"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1739"></a>Factories</h2></div></div></div>
        

        <p>Like repositories, factories are defined by interface in the
        domain, decoupling the domain objects from their actual
        implementation. Unlike repositories, there is no particular need to
        change the implementation when moving from one object store to
        another, because in all cases the factory can simply delegate to its
        injected <code class="classname">DomainObjectContainer</code>.</p>

        <p>The methods for <code class="classname">DomainObjectContainer</code>
        that are relevant for a factory are:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="methodname">&lt;T&gt; T newTransientInstance(final
            Class&lt;T&gt; ofClass)</code></p>
          </li><li class="listitem">
            <p><code class="methodname">&lt;T&gt; T newPersistentInstance(final
            Class&lt;T&gt; ofClass)</code></p>
          </li><li class="listitem">
            <p><code class="methodname">persist(Object)</code></p>
          </li></ul></div>

        <p>These are discussed in more detail in <a class="xref" href="#sec.HowToCreateAnObject" title="How to create or delete objects within your code">the section called &#8220;How to create or delete objects within your code&#8221;</a>. See also <a class="xref" href="#apx.DomainObjectContainer" title="Appendix&nbsp;C.&nbsp;DomainObjectContainer interface">Appendix&nbsp;C, <i><code class="classname">DomainObjectContainer</code> interface</i></a> for full coverage of the
        methods available in
        <code class="classname">DomainObjectContainer</code>.</p>
      </div>
    </div>

    <div class="chapter" title="Chapter&nbsp;10.&nbsp;Value Types"><div class="titlepage"><div><div><h2 class="title"><a name="chp.ValueTypes"></a>Chapter&nbsp;10.&nbsp;Value Types</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d5e1781">Built-in Value Types</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1785">JDK Types</a></span></dt><dt><span class="sect2"><a href="#d5e1863">Value formats</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1960">Custom Value Types</a></span></dt><dt><span class="sect1"><a href="#d5e1999">Third-party Value Types</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>Built-in value types, writing your own value types, and
        supporting third-party value types.</p>
      </div>

      <p>The state of any given entity is characterized by properties
      (<a class="xref" href="#chp.Properties" title="Chapter&nbsp;5.&nbsp;Domain Entity Properties">Chapter&nbsp;5, <i>Domain Entity Properties</i></a>) and collections (<a class="xref" href="#chp.Collections" title="Chapter&nbsp;6.&nbsp;Domain Entity Collections">Chapter&nbsp;6, <i>Domain Entity Collections</i></a>). A collections is a one-to-many reference
      to another entities, while a property is either a one-to-one reference
      to another entity, or it is a value.</p>

      <p>But what's a value? Well, it's an atomic piece of state. A string
      is a value, so is a number, so is a date. Values should be designed to
      be immutable (though some system value types, such as
      <code class="classname">java.util.Date</code>, famously are not).</p>

      <p><span class="emphasis"><em>Isis</em></span> supports all the standard JDK value
      types, and defines a number of its own (eg
      <code class="classname">Percentage</code> and <code class="classname">Color</code>). It
      also allows you to define your own value types, such as
      <code class="classname">LastName</code>, or <code class="classname">Celsius</code>, or
      <code class="classname">ComplexNumber</code>.</p>

      <p>Finally, it's also possible to make Isis integrate with
      third-party value types, such as <a class="ulink" href="http://joda-time.sourceforge.net/" target="_top">JodaTime</a>.</p>

      <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p><span class="emphasis"><em>Isis</em></span>' support for a particular value type
          does not necessarily imply that there is a custom widget for that
          type in a particular viewer. Rather, it means that the state of the
          object can be serialized, is expected to have equal-by-content
          semantics, and is expected to be immutable. It may also be parseable
          from a string.</p>
        </div>

      <div class="sect1" title="Built-in Value Types"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1781"></a>Built-in Value Types</h2></div></div></div>
        

        <p>The following are the value types supported by
        <span class="emphasis"><em>Isis</em></span> out-of-the-box.</p>

        <div class="sect2" title="JDK Types"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1785"></a>JDK Types</h3></div></div></div>
          

          <p>The following <acronym class="acronym">JDK</acronym> types are supported by
          <span class="emphasis"><em>Isis</em></span>.</p>

          <div class="sect3" title="Primitive Types"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1790"></a>Primitive Types</h4></div></div></div>
            

            <p>All the primitive types may be used as values:
            <code class="classname">byte</code>, <code class="classname">short</code>,
            <code class="classname">int</code>, <code class="classname">long</code>,
            <code class="classname">float</code>, <code class="classname">double</code>,
            <code class="classname">char</code>, and
            <code class="classname">boolean</code>.</p>
          </div>

          <div class="sect3" title="Wrapper Types"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1801"></a>Wrapper Types</h4></div></div></div>
            

            <p>The wrapper types for each of the primitives can also be
            used as value types: <code class="classname">java.lang.Byte</code>,
            <code class="classname">java.lang.Short</code>,
            <code class="classname">java.lang.Integer</code>,
            <code class="classname">java.lang.Long</code>,
            <code class="classname">java.lang.Float</code>,
            <code class="classname">java.lang.Double</code>,
            <code class="classname">java.lang.Character</code>,
            <code class="classname">java.lang.Boolean</code>.</p>
          </div>

          <div class="sect3" title="Java Classes"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1812"></a>Java Classes</h4></div></div></div>
            

            <p>The following java classes have value semantics and may be
            used as value types:</p>

            <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p><code class="classname">java.lang.String</code></p>
              </li><li class="listitem">
                <p><code class="classname">java.math.BigInteger</code> and
                <code class="classname">java.math.BigDecimal</code></p>
              </li><li class="listitem">
                <p><code class="classname">java.util.Date</code> (date and time),
                <code class="classname">java.sql.Date</code> (date only), and
                <code class="classname">java.sql.Time</code> (time only)</p>
              </li><li class="listitem">
                <p><code class="classname">java.sql.Timestamp</code></p>
              </li><li class="listitem">
                <p><code class="classname">java.awt.Image</code></p>
              </li></ul></div>
          </div>

          <div class="sect3" title="Isis AppLib"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1834"></a>Isis AppLib</h4></div></div></div>
            

            <p><span class="emphasis"><em>Isis</em></span> itself also provides a number of
            its own value types. These are all in the
            <code class="classname">org.apache.applib.value</code> package:</p>

            <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p><code class="classname">Color</code></p>
              </li><li class="listitem">
                <p><code class="classname">Date</code> (date only),
                <code class="classname">DateTime</code> (date and time) and
                <code class="classname">Time</code> (time only)</p>
              </li><li class="listitem">
                <p><code class="classname">TimeStamp</code></p>
              </li><li class="listitem">
                <p><code class="classname">Image</code></p>
              </li><li class="listitem">
                <p><code class="classname">Money</code></p>
              </li><li class="listitem">
                <p><code class="classname">Password</code></p>
              </li><li class="listitem">
                <p><code class="classname">Percentage</code></p>
              </li></ul></div>
          </div>
        </div>

        <div class="sect2" title="Value formats"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1863"></a>Value formats</h3></div></div></div>
          

          <p><span class="emphasis"><em>Isis</em></span> provides default formats for the
          inbuilt value types, according to type. These can be modified using
          <code class="filename">isis.properties</code>.</p>

          <p>These formats cut across the above categories; for example the
          byte format relates to both <code class="classname">byte</code> (primitive)
          and <code class="classname">java.lang.Byte</code> (wrapper). In all cases
          this setting can be overriden for a specific field using the @Mask
          annotation (see <a class="xref" href="#sec.MaskAnnotation" title="@Mask">the section called &#8220;@Mask&#8221;</a>).</p>

          <div class="sect3" title="Byte format"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1872"></a>Byte format</h4></div></div></div>
            

            <p>The format for all bytes can be set, replacing the default
            format derived from the system, using the following property to
            specify a mask:</p>

            <pre class="programlisting">isis.value.format.byte=####</pre>

            <p>The mask is used to set up a
            <code class="classname">java.text.DecimalFormat</code> formatting object
            so details of the mask format can be found in the Java
            documentation.</p>
          </div>

          <div class="sect3" title="Date Format"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1878"></a>Date Format</h4></div></div></div>
            

            <p>The format for all dates can be set, replacing the default
            format derived from the system, using the following property to
            specify one of <span class="emphasis"><em>long</em></span>,
            <span class="emphasis"><em>medium</em></span>, <span class="emphasis"><em>short</em></span>,
            <span class="emphasis"><em>isolong</em></span>, <span class="emphasis"><em>isoshort</em></span> or a
            mask:</p>

            <pre class="programlisting">isis.value.format.date=dd/MM/yy</pre>

            <p>When a mask is specified it is used to set up a
            <code class="classname">java.text.SimpleDateFormat</code> formatting
            object so details of the mask format can be found in the Java
            documentation.</p>
          </div>

          <div class="sect3" title="Date/time Format"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1889"></a>Date/time Format</h4></div></div></div>
            

            <p>The format for all date/time values can be set, replacing
            the default format derived from the system, using the following
            property to specify one of <span class="emphasis"><em>long</em></span>,
            <span class="emphasis"><em>medium</em></span>, <span class="emphasis"><em>short</em></span>,
            <span class="emphasis"><em>isolong</em></span>, <span class="emphasis"><em>isoshort</em></span> or a
            mask:</p>

            <pre class="programlisting">isis.value.format.datetime=dd/MM/yy</pre>

            <p>When a mask is specified it is used to set up a
            <code class="classname">java.text.SimpleDateFormat</code> formatting
            object so details of the mask format can be found in the Java
            documentation.</p>
          </div>

          <div class="sect3" title="Decimal format"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1900"></a>Decimal format</h4></div></div></div>
            

            <p>The format for <code class="classname">BigDecimal</code> values can
            be set, replacing the default format derived from the system,
            using the following property to specify a mask:</p>

            <pre class="programlisting">isis.value.format.decimal=####</pre>

            <p>The mask is used to set up a
            <code class="classname">java.text.DecimalFormat</code> formatting object
            so details of the mask format can be found in the Java
            documentation.</p>
          </div>

          <div class="sect3" title="Double format"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1907"></a>Double format</h4></div></div></div>
            

            <p>The format for all double values can be set, replacing the
            default format derived from the system, using the following
            property to specify a mask:</p>

            <pre class="programlisting">isis.value.format.double=####</pre>

            <p>The mask is used to set up a
            <code class="classname">java.text.DecimalFormat</code> formatting object
            so details of the mask format can be found in the Java
            documentation.</p>
          </div>

          <div class="sect3" title="Float format"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1913"></a>Float format</h4></div></div></div>
            

            <p>The format for all float values can be set, replacing the
            default format derived from the system, using the following
            property to specify a mask:</p>

            <pre class="programlisting">isis.value.format.float=####</pre>

            <p>The mask is used to set up a
            <code class="classname">java.text.DecimalFormat</code> formatting object
            so details of the mask format can be found in the Java
            documentation.</p>
          </div>

          <div class="sect3" title="Integer format"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1919"></a>Integer format</h4></div></div></div>
            

            <p>The format for all integers (including
            <code class="classname">BigInteger</code>) can be set, replacing the
            default format derived from the system, using the following
            property to specify a mask:</p>

            <pre class="programlisting">isis.value.format.int=####</pre>

            <p>The mask is used to set up a
            <code class="classname">java.text.DecimalFormat</code> formatting object
            so details of the mask format can be found in the Java
            documentation.</p>
          </div>

          <div class="sect3" title="Long format"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1926"></a>Long format</h4></div></div></div>
            

            <p>The format for all long values can be set, replacing the
            default format derived from the system, using the following
            property to specify a mask:</p>

            <pre class="programlisting">isis.value.format.long=####</pre>

            <p>The mask is used to set up a
            <code class="classname">java.text.DecimalFormat</code> formatting object
            so details of the mask format can be found in the Java
            documentation.</p>
          </div>

          <div class="sect3" title="Short format"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1932"></a>Short format</h4></div></div></div>
            

            <p>The format for all short values can be set, replacing the
            default format derived from the system, using the following
            property to specify a mask:</p>

            <pre class="programlisting">isis.value.format.short=####</pre>

            <p>The mask is used to set up a
            <code class="classname">java.text.DecimalFormat</code> formatting object
            so details of the mask format can be found in the Java
            documentation.</p>
          </div>

          <div class="sect3" title="Time Format"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1938"></a>Time Format</h4></div></div></div>
            

            <p>The format for all time values can be set, replacing the
            default format derived from the system, using the following
            property to specify one of <span class="emphasis"><em>long</em></span>,
            <span class="emphasis"><em>medium</em></span>, <span class="emphasis"><em>short</em></span>,
            <span class="emphasis"><em>isolong</em></span>, <span class="emphasis"><em>isoshort</em></span> or a
            mask:</p>

            <pre class="programlisting">isis.value.format.time=ddMMyyyy hhmm</pre>

            <p>When a mask is specified it is used to set up a
            <code class="classname">java.text.SimpleDateFormat</code> formatting
            object so details of the mask format can be found in the Java
            documentation.</p>
          </div>

          <div class="sect3" title="Timestamp Format"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1949"></a>Timestamp Format</h4></div></div></div>
            

            <p>The format for time stamp values can be set, replacing the
            default format derived from the system, using the following
            property to specify one of <span class="emphasis"><em>long</em></span>,
            <span class="emphasis"><em>medium</em></span>, <span class="emphasis"><em>short</em></span>,
            <span class="emphasis"><em>isolong</em></span>, <span class="emphasis"><em>isoshort</em></span> or a
            mask:</p>

            <pre class="programlisting">isis.value.format.timestamp=hh:mm</pre>

            <p>When a mask is specified it is used to set up a
            <code class="classname">java.text.SimpleDateFormat</code> formatting
            object so details of the mask format can be found in the Java
            documentation.</p>
          </div>
        </div>
      </div>

      <div class="sect1" title="Custom Value Types"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1960"></a>Custom Value Types</h2></div></div></div>
        

        <p>In addition to the built-in value types it is also possible to
        define user-defined value types. This is typically done using the
        <code class="classname">@Value</code> annotation.</p>

        <p>The <code class="literal">@Value</code> annotation is used to provide an
        implementation of the
        <code class="classname">org.apache.isis.applib.adapters.ValueSemanticsProvider</code>
        interface. In turn this provides objects that allow the framework to
        interact with the value, specifically:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>the <code class="classname">EncoderDecoder</code> is used to convert
            the value into and back out of serializable form</p>

            <p>This is used by some object stores (eg the
            <acronym class="acronym">XML</acronym> Object Store), for remoting and also by the
            XML Snapshot capability (see <a class="xref" href="#chp.XmlSnapshots" title="Chapter&nbsp;14.&nbsp;XML Snapshots">Chapter&nbsp;14, <i>XML Snapshots</i></a>);</p>
          </li><li class="listitem">
            <p>the <code class="classname">Parser</code> is used to convert
            <code class="classname">String</code>s into the value type</p>

            <p>This is used as a fallback by viewers that do not have any
            specific widgets to support the particular value type, and make do
            with a simple text field instead.</p>

            <p>An obvious example is to parse a date. But it could be used
            to parse "TRUE" and "FALSE" into a boolean (as opposed to using a
            checkbox).</p>
          </li><li class="listitem">
            <p>the <code class="classname">DefaultsProvider</code> is used to
            provide a meaningful default for the value</p>

            <p>Not every value type will have a default, but some do (eg
            false for a boolean, 0 for a number). This is used as the default
            value for non-<code class="classname">@Optional</code> properties and
            parameters.</p>
          </li></ul></div>

        <p>Each of these interfaces also reside in
        <code class="classname">org.apache.isis.applib.adapters</code>.</p>

        <p>For more details, explore the built-in types within the applib,
        for example
        <code class="classname">org.apache.isis.applib.value.Money</code>.</p>

        <pre class="programlisting">@Value(semanticsProviderName = 
         "org.apache.isis.core.progmodel.facets.value.MoneyValueSemanticsProvider")
public class Money extends Magnitude {
    ...
}</pre>

        <p>where <code class="classname">MoneyValueSemanticsProvider</code> is the
        implementation of <code class="classname">ValueSemanticsProvider</code>
        described above.</p>

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
            <p>Using value types generally removes the need for using
            <code class="literal">@MustSatisfy</code> annotation (see <a class="xref" href="#sec.MustSpecify" title="@MustSatisfy Specification">the section called &#8220;@MustSatisfy Specification&#8221;</a>); the rules can instead move down
            into a <code class="methodname">validate()</code> method on the value
            type itself.</p>
          </div>
      </div>

      <div class="sect1" title="Third-party Value Types"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1999"></a>Third-party Value Types</h2></div></div></div>
        

        <p>Third party value types, such as those in <a class="ulink" href="http://joda-time.sourceforge.net/" target="_top">JodaTime</a>, can also
        supported, again through the use of a
        <code class="classname">ValueSemanticsProvider</code>. However, since the
        source code cannot be altered, the provider must be supplied using a
        key value in <code class="methodname">isis.properties</code> configuration
        file.</p>

        <p>For example, the following would register a semantics provider
        for <code class="classname">org.jodatime.time.DateTime</code>:</p>

        <pre class="programlisting">isis.core.progmodel.value.org.jodatime.time.DateTime.semanticsProviderName=\
    com.mycompany.values.CalendarIntervalValueSemanticsProvider</pre>

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>At the time of writing <span class="emphasis"><em>Apache Isis</em></span> does
          not currently ship with any
          <code class="classname">ValueSemanticsProvider</code>s, though doing so is
          on the roadmap.</p>
        </div>
      </div>
    </div>
  </div>

  <div class="part" title="Part&nbsp;III.&nbsp;Supporting Features"><div class="titlepage"><div><div><h1 class="title"><a name="prt.SupportingFeatures"></a>Part&nbsp;III.&nbsp;Supporting Features</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="chapter"><a href="#chp.Clock">11. Clock</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e2030">Lazily Instantiated</a></span></dt><dt><span class="sect1"><a href="#d5e2039">Possibly Replaceable</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.UserProfiles">12. Profiles</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e2053">Profiles and Perspectives</a></span></dt><dt><span class="sect1"><a href="#d5e2076">Runtime and Viewer Support</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.Fixtures">13. Fixtures and SwitchUser</a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.HowToRegisterFixtures">How to register fixtures</a></span></dt><dt><span class="sect1"><a href="#d5e2107">How to write custom fixtures</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2113"><code class="classname">InstallableFixture</code> and
          <code class="classname">FixtureType</code></a></span></dt><dt><span class="sect2"><a href="#d5e2133"><code class="classname">BaseFixture</code> and
          <code class="classname">AbstractFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e2166"><code class="methodname">DateFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e2177"><code class="methodname">SwitchUserFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e2197"><code class="classname">LogonFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e2204"><code class="classname">UserProfileFixture</code></a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#chp.XmlSnapshots">14. XML Snapshots</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e2234">Generating an XML Snapshot</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2238">Basic Usage</a></span></dt><dt><span class="sect2"><a href="#d5e2247">Including other Elements</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e2263">Using the Fluent API</a></span></dt><dt><span class="sect1"><a href="#d5e2268">The <code class="classname">SnapshottableWithInclusions</code>
        interface</a></span></dt><dt><span class="sect1"><a href="#d5e2277">Generating an XSD schema</a></span></dt><dt><span class="sect1"><a href="#d5e2284">Hints and Tips</a></span></dt></dl></dd></dl></div>
    

    <div class="chapter" title="Chapter&nbsp;11.&nbsp;Clock"><div class="titlepage"><div><div><h2 class="title"><a name="chp.Clock"></a>Chapter&nbsp;11.&nbsp;Clock</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d5e2030">Lazily Instantiated</a></span></dt><dt><span class="sect1"><a href="#d5e2039">Possibly Replaceable</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>The default Clock and alternative implementations.</p>
      </div>

      <p>Many if not all enterprise applications deal with dates and times
      in one way or another. For example, if an <code class="classname">Order</code>
      is placed, then the <code class="classname">Customer</code> may have 30 days to
      pay the Invoice, otherwise a penalty may be levied. However, this can
      complicate automated testing: "today+30" will be a different date every
      time the test is run.</p>

      <p>A common solution is to require that domain objects do not go
      directly to the system for the current date (ie don't simply instantiate
      a new <code class="classname">java.util.Date</code> in order to get the current
      time); instead they should call some sort of facade.</p>

      <p>The <span class="emphasis"><em>Apache Isis</em></span> framework provides such a
      facade through the
      <code class="classname">org.apache.isis.applib.clock.Clock</code> class. The
      defaults for all values refer back to the <code class="classname">Clock</code>,
      and - because the <code class="classname">Clock</code> is a singleton - it is
      easy for any application code to obtain the current time also.</p>

      <p>For example:</p>

      <pre class="programlisting">public class Customer {
     public Order placeOrder(Product p) {
         Date now = Clock.getTimeAsDate();
         ...
     }
     ...
}</pre>

      <div class="sect1" title="Lazily Instantiated"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2030"></a>Lazily Instantiated</h2></div></div></div>
        

        <p>The first call to <code class="methodname">Clock.getTime()</code> will
        lazily instantiate the singleton, with the default implementation
        being one that simply delegates to the system's internal clock. To use
        a different <code class="classname">Clock</code> implementation, eg one that
        delegates to an NNTP server, all that is required is to instantiate it
        any time prior to bootstrapping <span class="emphasis"><em>Isis</em></span>
        itself.</p>

        <p>One notable implementation that notably takes advantage of this
        is <code class="classname">FixtureClock</code>, used for testing. See <a class="xref" href="#chp.Fixtures" title="Chapter&nbsp;13.&nbsp;Fixtures and SwitchUser">Chapter&nbsp;13, <i>Fixtures and SwitchUser</i></a> for more information.</p>
      </div>

      <div class="sect1" title="Possibly Replaceable"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2039"></a>Possibly Replaceable</h2></div></div></div>
        

        <p>Clock implementations can indicate whether they are replaceable
        as the singleton, or not.</p>

        <p>Most (all?) production implementations (eg the default system
        clock) are <span class="emphasis"><em>not</em></span> replaceable; once instantiated,
        any attempt to instantiate another subclass will be rejected with an
        exception.</p>

        <p>However implementations to work with tests (such as
        <code class="classname">FixtureClock</code>, already mentioned) are more
        likely to be replaceable, so that they can be setup multiple times as
        required.</p>
      </div>
    </div>

    <div class="chapter" title="Chapter&nbsp;12.&nbsp;Profiles"><div class="titlepage"><div><div><h2 class="title"><a name="chp.UserProfiles"></a>Chapter&nbsp;12.&nbsp;Profiles</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d5e2053">Profiles and Perspectives</a></span></dt><dt><span class="sect1"><a href="#d5e2076">Runtime and Viewer Support</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>Support for user profiles</p>
      </div>

      <p>As well as allowing domain entities to be persisted into object
      stores, <span class="emphasis"><em>Apache Isis</em></span> also allows user
      <span class="emphasis"><em>profiles</em></span> to be persisted into a profile
      store.</p>

      <div class="sect1" title="Profiles and Perspectives"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2053"></a>Profiles and Perspectives</h2></div></div></div>
        

        <p>Every user can have one profile associated with them, which
        consists of:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>a set of options or preferences</p>
          </li><li class="listitem">
            <p>a set of perspectives</p>
          </li></ul></div>

        <p>A perspective is something akin to a layout or desktop,
        representing a configuration of relevant objects as might be displayed
        on the home page of the viewer. In particular, perspectives allow the
        set of services available to a user (eg as icons in the
        <acronym class="acronym">DnD</acronym> viewer) to be customized for that user. Since
        these services represent the "start points" for the user to interact
        with the domain model, they in a sense define an application on a
        per-user basis.</p>

        <p>The elements that make up a perspective are:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>a set of services (identified by the string returned from
            each service's <code class="methodname">getId()</code> method, see <a class="xref" href="#chp.DomainServices" title="Chapter&nbsp;9.&nbsp;Domain Services, Repositories and Factories">Chapter&nbsp;9, <i>Domain Services, Repositories and Factories</i></a>)</p>

            <p>These are the services (eg icons) that can be accessed from
            that perspective</p>
          </li><li class="listitem">
            <p>a set of objects</p>

            <p>These might represent bookmarks to objects saved from a
            previous session.</p>
          </li></ul></div>

        <p>The applib contains types to define these two concepts;
        specifically <code class="classname">Profile</code> and
        <code class="classname">Perspective</code>. These are actually interfaces, the
        implementation is provided by framework itself.</p>
      </div>

      <div class="sect1" title="Runtime and Viewer Support"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2076"></a>Runtime and Viewer Support</h2></div></div></div>
        

        <p>Support for profiles will vary across runtime implementations
        and across viewers. The <span class="emphasis"><em>default runtime</em></span>
        implementation <span class="emphasis"><em>does</em></span> support profiles, however,
        and works such that if a user logs in and no perspective exists for
        that user one will automatically be created. This will either be a
        copy of the 'template' perspective, or, if no such template exists,
        then simply a perspective containing all the known services.</p>

        <p>Moreover, the runtime must be configured to use some sort of
        persistence mechanism for profiles such that they are persisted
        between runs. The default runtime does support this (though the
        default is the in-memory profilestore that does not persist any
        information between sessions).</p>

        <p>Even if the configured runtime does support profiles, not every
        viewer necessarily uses the concept. The most notable viewer that
        <span class="emphasis"><em>does</em></span> support the idea is the <span class="emphasis"><em>dnd
        viewer</em></span>.</p>
      </div>
    </div>

    <div class="chapter" title="Chapter&nbsp;13.&nbsp;Fixtures and SwitchUser"><div class="titlepage"><div><div><h2 class="title"><a name="chp.Fixtures"></a>Chapter&nbsp;13.&nbsp;Fixtures and SwitchUser</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#sec.HowToRegisterFixtures">How to register fixtures</a></span></dt><dt><span class="sect1"><a href="#d5e2107">How to write custom fixtures</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2113"><code class="classname">InstallableFixture</code> and
          <code class="classname">FixtureType</code></a></span></dt><dt><span class="sect2"><a href="#d5e2133"><code class="classname">BaseFixture</code> and
          <code class="classname">AbstractFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e2166"><code class="methodname">DateFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e2177"><code class="methodname">SwitchUserFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e2197"><code class="classname">LogonFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e2204"><code class="classname">UserProfileFixture</code></a></span></dt></dl></dd></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>Using fixtures to setup the system, generally for testing
        purposes.</p>
      </div>

      <p>Fixtures are used to setup the framework into a known state. This
      is predominantly done for testing, and in particular when running with
      the in-memory object store. However, fixtures can also be used to
      specify the user that has "logged on", and to set the clock.</p>

      <p>Whether a fixture has any effect will depend on several
      factors:</p>

      <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
          <p>the first is the <code class="classname">DeploymentType</code>;
          specifying the logged on user will only be honoured if running in
          exploration mode (or more precisely, where
          <code class="methodname">DeploymentType#isExploring()</code> returns
          true);</p>
        </li><li class="listitem">
          <p>the second is the object store; most persistent object stores
          will either ignore fixtures, or only allow them to be installed once
          or if run with an (object store-specific) flag set</p>
        </li></ul></div>

      <div class="sect1" title="How to register fixtures"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.HowToRegisterFixtures"></a>How to register fixtures</h2></div></div></div>
        

        <p>All domain services (which includes repositories and factories)
        should be registered in the <span class="emphasis"><em>isis.properties</em></span>
        configuration file, under the <code class="varname">isis.fixtures.prefix</code>
        and <code class="varname">isis.fixtures</code> keys.</p>

        <p>For example:</p>

        <pre class="programlisting">isis.fixtures.prefix= org.apache.isis.support.prototype.fixture
isis.fixtures= ClaimsFixture,LogOnAsCliveFixture</pre>

        <p>It is also possible to specify fixtures from the command line,
        using the --fixture flag.</p>
      </div>

      <div class="sect1" title="How to write custom fixtures"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2107"></a>How to write custom fixtures</h2></div></div></div>
        

        <p>The applib defines several interfaces and classes for writing
        fixtures. The following UML diagram shows their relationships:</p>

        <div class="mediaobject"><img src="images/Fixtures.png" width="351"></div>

        <div class="sect2" title="InstallableFixture and FixtureType"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2113"></a><code class="classname">InstallableFixture</code> and
          <code class="classname">FixtureType</code></h3></div></div></div>
          

          <p>The <code class="classname">InstallableFixture</code> interface
          defines the general contract between a fixture and the framework:
          the <code class="classname">FixtureType</code>, and an
          <code class="methodname">install()</code> method.</p>

          <p>The <code class="classname">FixtureType</code> is used to characterize
          whether the fixture:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>if <code class="classname">FixtureType.DOMAIN_OBJECTS</code> (the
              default), then the fixture will be installed only so long as the
              configured object store does not indicate that fixtures have
              already been installed</p>
            </li><li class="listitem">
              <p>if <code class="classname">FixtureType.USER_PROFILES</code>, then
              the fixture will be installed only so long as the configured
              profile store does not indicate that fixtures have already been
              installed</p>
            </li><li class="listitem">
              <p>if <code class="classname">FixtureType.OTHER</code>, then the
              fixture will always be installed. This usually refers to setting
              the clock or user.</p>
            </li></ul></div>
        </div>

        <div class="sect2" title="BaseFixture and AbstractFixture"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2133"></a><code class="classname">BaseFixture</code> and
          <code class="classname">AbstractFixture</code></h3></div></div></div>
          

          <p>The <code class="classname">BaseFixture</code> class is not API, but
          is responsible for instantiating
          <code class="classname">FixtureClock</code>. This is an implementation of
          <code class="classname">Clock</code> singleton, which (as described in <a class="xref" href="#chp.Clock" title="Chapter&nbsp;11.&nbsp;Clock">Chapter&nbsp;11, <i>Clock</i></a>), is used by the rest of the
          <span class="emphasis"><em>Isis</em></span> framework delegates to in order to obtain
          the current time. The <code class="classname">FixtureClock</code>'s purpose
          is to allow the current date/time to be set by other
          fixtures.</p>

          <p>The <code class="classname">AbstractFixture</code> class (inheriting
          from <code class="classname">BaseFixture</code>) is an general-purpose
          adapter for writing fixtures. It implements
          <code class="classname">CompositeFixture</code> interface, meaning that
          hierarchies of fixtures can be created following the composite
          design pattern. It also provides a number of convenience
          methods:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>the <code class="methodname">setDate(...)</code> and
              <code class="methodname">setTime(...)</code> method allow the date/time
              to be set.</p>

              <p>This is done using by obtaining the
              <code class="classname">FixtureClock</code> (from
              <code class="classname">BaseFixture</code>). There are also some
              convenience methods to move the date/time either earlier or
              later.</p>
            </li><li class="listitem">
              <p>the <code class="methodname">switchUser(...)</code> method allow
              the logged-on user to be changed</p>

              <p>This changes the user logged-on while the fixtures are
              being installed. This is to facilitate tests that have complex
              setup requirements, eg verifying workflow between different user
              roles.</p>
            </li></ul></div>

          <p>An alternative to using
          <code class="methodname">setDate(...)</code>/<code class="methodname">setTime(...)</code>
          is to use <code class="classname">DateFixture</code>, and an alternative to
          using <code class="methodname">switchUser(...)</code> is to use
          <code class="classname">SwitchUserFixture</code>. Which you use is largely a
          matter of personal preference.</p>
        </div>

        <div class="sect2" title="DateFixture"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2166"></a><code class="methodname">DateFixture</code></h3></div></div></div>
          

          <p>The <code class="classname">DateFixture</code> provides an alternative
          to <code class="classname">AbstractFixture</code>, just allowing the current
          date/time to be set.</p>

          <p>The main difference is one of style;
          <code class="classname">DateFixture</code> can be used in a declarative way,
          whereas <code class="classname">AbstractFixture</code> is more imperative.
          For example:</p>

          <pre class="programlisting">public class DateIs13Jan2007Fixture extends DateFixture {
    public DateIs13Jan2007Fixture() {
        super(2007,1,13);
    }
}</pre>

          <p>A fixture in this style could then be used within a composite
          fixture hierarchy.</p>
        </div>

        <div class="sect2" title="SwitchUserFixture"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2177"></a><code class="methodname">SwitchUserFixture</code></h3></div></div></div>
          

          <p>The <code class="classname">SwitchUserFixture</code> provides an
          alternative to <code class="classname">AbstractFixture</code>, just allowing
          the current user to be switched.</p>

          <p>The main difference is one of style;
          <code class="classname">SwitchUserFixture</code> can be used in a
          declarative way, whereas <code class="classname">AbstractFixture</code> is
          more imperative. For example:</p>

          <pre class="programlisting">public class SwitchToFrankSupervisorFixture extends SwitchUserFixture {
    public SwitchToFrankSupervisorFixture() {
        super("frank", "user", "supervisor");
    }
}</pre>

          <p>A fixture in this style could then be used within a composite
          fixture hierarchy.</p>

          <div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
            <p>Do be aware of when you call switchUser() in a
            <code class="classname">Fixture</code> as it causes the current
            transaction to be ended and a new one started (for the new user).
            If you share a reference between the two you will get an
            exception.</p>

            <p>For example:</p>

            <pre class="programlisting">Account account = accounts.createAccount(
    "ACME", "Peter Planner", "pplanner@acme.com");
Participant peterPlanner = account.getAdmin();
        
switchUser("pplanner@acme.com", new String[0]);

Work work = plan1.createWork();
BcpPlan plan = (BcpPlan) work.getTarget();
plan.getOwner().modifyLeader(peterPlanner);</pre>

            <p>This will fail because <code class="varname">peterPlanner</code>
            reference is no longer valid after the switch user.</p>

            <p>The solution is to retrieve the object again so it is part
            of the second transaction. In this example we can change to code
            to this:</p>

            <pre class="programlisting">accounts.createAccount("ACME", "Peter Planner", "pplanner@acme.com");
        
switchUser("pplanner@acme.com", new String[0]);

Account account = uniqueMatch(Account.class, "0 ACME");
Participant peterPlanner = account.getAdmin();

Work work = plan1.createWork();
BcpPlan plan = (BcpPlan) work.getTarget();
plan.getOwner().modifyLeader(peterPlanner);
</pre>
          </div>
        </div>

        <div class="sect2" title="LogonFixture"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2197"></a><code class="classname">LogonFixture</code></h3></div></div></div>
          

          <p>Unlike the very similar
          <code class="classname">SwitchUserFixture</code>, this fixture does not
          affect the currently logged on user while the fixtures are being
          installed. Instead, it is used to specify the user to logon as once
          all the fixtures have been installed.</p>

          <p>If more than one <code class="classname">LogonFixture</code> is
          specified, the last one encountered is used.</p>
        </div>

        <div class="sect2" title="UserProfileFixture"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2204"></a><code class="classname">UserProfileFixture</code></h3></div></div></div>
          

          <p>The <code class="classname">UserProfileFixture</code> is used to
          populate the configured profile store<sup>[<a name="d5e2209" href="#ftn.d5e2209" class="footnote">5</a>]</sup> with user profiles (the concept of which is described
          in <a class="xref" href="#chp.UserProfiles" title="Chapter&nbsp;12.&nbsp;Profiles">Chapter&nbsp;12, <i>Profiles</i></a>).</p>

          <p>To create a user profile for a specific user, inherit from
          <code class="classname">UserProfileFixture</code>, use the inherited
          <code class="methodname">newUserProfile()</code> to create a profile and
          use the inherited <code class="methodname">saveForUser(...)</code> method
          to save that profile.</p>

          <p>It is also possible to create a 'template' perspective using
          the <code class="methodname">saveAsDefault(...)</code> method. This is used
          as the basis for any new perspectives that are automatically
          created, eg for users who are logging in and for whom there is no
          perspective in existence.</p>

          <p>For example:</p>

          <pre class="programlisting">public class PerspectivesFixture extends UserProfileFixture {
  @Override
  protected void installProfiles() {
    Profile profile = newUserProfile();
    Perspective perspective = profile.newPerspective("ECS");
    perspective.addToServices(LocationFactory.class);
    perspective.addToServices(CustomerRepository.class);
    perspective.addToServices(PaymentMethodFactory.class);
        
    saveAsDefault(profile);
  }
}</pre>

          <p>With that set up, when a new user now logs in they will see
          three service icons on the screen for locations, customers and
          payment methods. In the <span class="emphasis"><em>dnd viewer</em></span> the user
          will be able to add and remove services from their perspective. See
          the DnD Viewer documentation for further details.</p>

          <p>Any fixtures, if specified, are only ever loaded once; the
          fixture installer checks with
          <code class="methodname">UserProfileSevice.isInitialized()</code> to see if
          the fixture is already installed. This allows fixtures to be used
          for seeding a persisting profile store, and then be ignored
          thereafter.</p>
        </div>
      </div>
    <div class="footnotes"><br><hr width="100" align="left"><div class="footnote">
              <p><sup>[<a id="ftn.d5e2209" href="#d5e2209" class="para">5</a>] </sup>A profile store is a persistence mechanism provided by the
              configured runtime that allows user profiles to be stored
              between runs. It is similar to, but independent of, an object
              store (which stores the domain objects themselves).</p>
            </div></div></div>

    <div class="chapter" title="Chapter&nbsp;14.&nbsp;XML Snapshots"><div class="titlepage"><div><div><h2 class="title"><a name="chp.XmlSnapshots"></a>Chapter&nbsp;14.&nbsp;XML Snapshots</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d5e2234">Generating an XML Snapshot</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2238">Basic Usage</a></span></dt><dt><span class="sect2"><a href="#d5e2247">Including other Elements</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e2263">Using the Fluent API</a></span></dt><dt><span class="sect1"><a href="#d5e2268">The <code class="classname">SnapshottableWithInclusions</code>
        interface</a></span></dt><dt><span class="sect1"><a href="#d5e2277">Generating an XSD schema</a></span></dt><dt><span class="sect1"><a href="#d5e2284">Hints and Tips</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>Generating <acronym class="acronym">XML</acronym> snapshots from domain
        objects.</p>
      </div>

      <p>The <span class="emphasis"><em>Apache Isis</em></span> framework provides the
      capability to generate <acronym class="acronym">XML</acronym> snapshots (and if required
      corresponding <acronym class="acronym">XSD</acronym> schemas) based on graphs of domain
      objects. This is done using the
      <code class="classname">org.apache.isis.core.runtime.snapshot.XmlSnapshot</code>
      class.</p>

      <div class="sect1" title="Generating an XML Snapshot"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2234"></a>Generating an XML Snapshot</h2></div></div></div>
        

        <p>The <code class="classname">XmlSnapshot</code> can be created either
        directly or using a builder.</p>

        <div class="sect2" title="Basic Usage"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2238"></a>Basic Usage</h3></div></div></div>
          

          <p>The standard usage is to instantiate directly.</p>

          <pre class="programlisting">XmlSnapshot snapshot = new XmlSnapshot(customer);
Element customerAsXml = snapshot.getXmlElement();</pre>

          <p>This will return the <code class="classname">Customer</code>'s fields,
          titles of simple references, number of items in collections.</p>

          <p>In order to use the <code class="classname">XmlSnapshot</code>, the
          domain object must implement
          <code class="classname">org.apache.isis.applib.snapshot.Snapshottable</code>.
          This is just a marker interface.</p>
        </div>

        <div class="sect2" title="Including other Elements"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2247"></a>Including other Elements</h3></div></div></div>
          

          <p>It's also possible to instruct the
          <code class="classname">XmlSnapshot</code> to "walk" the object graph and
          include other information within the generated
          <acronym class="acronym">XML</acronym>.</p>

          <p>For example:</p>

          <pre class="programlisting">XmlSnapshot snapshot = new XmlSnapshot(customer);
snapshot.include("placeOfBirth");   // (1)
snapshot.include("orders/product"); // (2)
Element customerAsXml = snapshot.getXmlElement();</pre>

          <p>In (1), we indicate that we want to also navigate to another
          domain object represented by simple reference "placeOfBirth"; in
          (2), we indicate that we want to navigate the "orders" collection
          (presumably of <code class="classname">Order</code>s) and for each
          referenced <code class="classname">Order</code>, to navigate in turn its
          "product" reference (presumably to a <code class="classname">Product</code>
          class).</p>

          <p>Note that <code class="classname">XmlSnapshot</code> is mutable, in
          that calls to its <code class="methodname">getXmlElement()</code> may
          return different <acronym class="acronym">XML</acronym> structures based on whether
          additional paths have been <code class="methodname">include()</code>'d, or
          whether the state of the domain objects themselves have
          changed.</p>
        </div>
      </div>

      <div class="sect1" title="Using the Fluent API"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2263"></a>Using the Fluent API</h2></div></div></div>
        

        <p>An <code class="classname">XmlSnapshot</code> can also be constructed
        using an alternative "fluent" API:</p>

        <pre class="programlisting">XmlSnapshot snapshot = 
     XmlSnapshot.create(customer)
                .includePath("placeOfBirth")
                .include("orders/product")
                .build();
Element customerAsXml = snapshot.getXmlElement();</pre>
      </div>

      <div class="sect1" title="The SnapshottableWithInclusions interface"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2268"></a>The <code class="classname">SnapshottableWithInclusions</code>
        interface</h2></div></div></div>
        

        <p>As already mentioned, in order to be snapshotted a domain object
        must implement the <code class="classname">Snapshot</code> interface. This is
        just a marker interface, so implementing it is trivial.</p>

        <p>Alternatively, the domain object can choose to implement the
        sub-interface, <code class="classname">SnapshottableWithInclusions</code>.
        This moves the responsibility for determining what is included within
        the snapshot from the caller to the snapshottable object
        itself:</p>

        <pre class="programlisting">public interface SnapshottableWithInclusions extends Snapshottable {
    List&lt;String&gt; snapshotInclusions();
}</pre>

        <p>If necessary, both approaches can be combined.</p>
      </div>

      <div class="sect1" title="Generating an XSD schema"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2277"></a>Generating an XSD schema</h2></div></div></div>
        

        <p>As well as obtaining the XML snapshot, it is also possible to
        obtain an XSD schema that the XML snapshot conforms to.</p>

        <pre class="programlisting">XmlSnapshot snapshot = ...;
Element customerAsXml = snapshot.getXmlElement();
Element customerXsd = snapshot.getXsdElement();</pre>

        <p>This can be useful for some tools. Note that for the
        <acronym class="acronym">XSD</acronym> to be correct, the object being snapshotted
        must have non-null values for the paths that are
        <code class="methodname">include()</code>'d. If this isn't done then the XSD
        will not be correct reflect for another snapshotted object that does
        have non-null values.</p>
      </div>

      <div class="sect1" title="Hints and Tips"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2284"></a>Hints and Tips</h2></div></div></div>
        

        <p>As an alternative to using include(), you might consider
        building a non-persisted domain object (a "view model") which can
        reference only the relevant information required for the
        snapshot.</p>

        <p>For example, if only the 5 most recent
        <code class="classname">Order</code>s for a <code class="classname">Customer</code>
        were required, a <code class="classname">CustomerAndRecentOrders</code> view
        model could hold a collection of just those 5
        <code class="classname">Order</code>s.</p>

        <p>Typically such view models would implement
        <code class="classname">SnapshottableWithInclusions</code>.</p>
      </div>
    </div>
  </div>

  <div class="part" title="Part&nbsp;IV.&nbsp;Reference Appendices"><div class="titlepage"><div><div><h1 class="title"><a name="prt.ReferenceAppendices"></a>Part&nbsp;IV.&nbsp;Reference Appendices</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="appendix"><a href="#d5e2296">A. Recognized Methods and Prefixes</a></span></dt><dt><span class="appendix"><a href="#d5e2568">B. Recognized Annotations</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e2575">@ActionOrder</a></span></dt><dt><span class="sect1"><a href="#d5e2594">@ActionSemantics</a></span></dt><dt><span class="sect1"><a href="#d5e2604">@AutoComplete</a></span></dt><dt><span class="sect1"><a href="#d5e2613">@Aggregated</a></span></dt><dt><span class="sect1"><a href="#d5e2621">@Bounded</a></span></dt><dt><span class="sect1"><a href="#sec.DebugAnnotation">@Debug</a></span></dt><dt><span class="sect1"><a href="#d5e2640">@Defaulted</a></span></dt><dt><span class="sect1"><a href="#d5e2650">@DescribedAs</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2658">Providing a description for an object</a></span></dt><dt><span class="sect2"><a href="#d5e2664">Providing a description for an object member</a></span></dt><dt><span class="sect2"><a href="#d5e2670">Providing a description for an action parameter</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e2676">@Disabled</a></span></dt><dt><span class="sect1"><a href="#d5e2745">@Encodable</a></span></dt><dt><span class="sect1"><a href="#d5e2755">@EqualByContent</a></span></dt><dt><span class="sect1"><a href="#d5e2764">@Executed</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2770">Forcing a method to be executed on the client</a></span></dt><dt><span class="sect2"><a href="#d5e2774">Forcing a method to be executed on the server</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.ExplorationAnnotation">@Exploration</a></span></dt><dt><span class="sect1"><a href="#d5e2789">@Facets</a></span></dt><dt><span class="sect1"><a href="#d5e2798">@FieldOrder</a></span></dt><dt><span class="sect1"><a href="#sec.HiddenAnnotation">@Hidden</a></span></dt><dt><span class="sect1"><a href="#d5e2882">@Idempotent (deprecated)</a></span></dt><dt><span class="sect1"><a href="#d5e2886">@Ignore (deprecated)</a></span></dt><dt><span class="sect1"><a href="#d5e2893">@Immutable</a></span></dt><dt><span class="sect1"><a href="#sec.MaskAnnotation">@Mask</a></span></dt><dt><span class="sect1"><a href="#sec.MaxLengthAnnotation">@MaxLength</a></span></dt><dt><span class="sect1"><a href="#sec.MemberGroupsAnnotation">@MemberGroups</a></span></dt><dt><span class="sect1"><a href="#sec.MemberOrderAnnotation">@MemberOrder</a></span></dt><dt><span class="sect1"><a href="#d5e2984">@MultiLine</a></span></dt><dt><span class="sect1"><a href="#d5e3015">@MustSatisfy</a></span></dt><dt><span class="sect1"><a href="#sec.NamedAnnotation">@Named</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e3039">Specifying the name of an object</a></span></dt><dt><span class="sect2"><a href="#d5e3048">Specifying the name of a class member</a></span></dt><dt><span class="sect2"><a href="#d5e3057">Specifying the name for an action parameter</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.NotContributedAnnotation">@NotContributed</a></span></dt><dt><span class="sect1"><a href="#sec.NotInServiceMenuAnnotation">@NotInServiceMenu</a></span></dt><dt><span class="sect1"><a href="#not-persistable">@NotPersistable</a></span></dt><dt><span class="sect1"><a href="#d5e3108">@NotPersisted</a></span></dt><dt><span class="sect1"><a href="#d5e3116">@ObjectType</a></span></dt><dt><span class="sect1"><a href="#d5e3126">@Optional</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e3135">Making a property optional</a></span></dt><dt><span class="sect2"><a href="#d5e3144">Making an action parameter optional</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e3149">@Paged</a></span></dt><dt><span class="sect1"><a href="#d5e3164">@Parseable</a></span></dt><dt><span class="sect1"><a href="#sec.PluralAnnotation">@Plural</a></span></dt><dt><span class="sect1"><a href="#d5e3184">@Programmatic</a></span></dt><dt><span class="sect1"><a href="#sec.PrototypeAnnotation">@Prototype</a></span></dt><dt><span class="sect1"><a href="#d5e3206">@QueryOnly (deprecated)</a></span></dt><dt><span class="sect1"><a href="#sec.RegExAnnotation">@RegEx</a></span></dt><dt><span class="sect1"><a href="#d5e3227">@Resolve</a></span></dt><dt><span class="sect1"><a href="#sec.TitleAnnotation">@Title</a></span></dt><dt><span class="sect1"><a href="#d5e3258">@TypeOf</a></span></dt><dt><span class="sect1"><a href="#d5e3266">@TypicalLength</a></span></dt><dt><span class="sect1"><a href="#sec.ValueAnnotation">@Value</a></span></dt><dt><span class="sect1"><a href="#d5e3292">@ViewModel</a></span></dt></dl></dd><dt><span class="appendix"><a href="#apx.DomainObjectContainer">C. <code class="classname">DomainObjectContainer</code> interface</a></span></dt><dt><span class="appendix"><a href="#apx.SecurityClasses">D. Security Classes</a></span></dt><dt><span class="appendix"><a href="#apx.UtilityClasses">E. Utility Classes</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e3499">Title creation</a></span></dt><dt><span class="sect1"><a href="#d5e3506">Reason text creation (for disable and validate methods)</a></span></dt></dl></dd><dt><span class="appendix"><a href="#d5e3521">F. Events</a></span></dt><dt><span class="appendix"><a href="#d5e3532">G. Package Dependencies</a></span></dt></dl></div>
    

    <div class="appendix" title="Appendix&nbsp;A.&nbsp;Recognized Methods and Prefixes"><div class="titlepage"><div><div><h2 class="title"><a name="d5e2296"></a>Appendix&nbsp;A.&nbsp;Recognized Methods and Prefixes</h2></div></div></div>
      

      <p>The following table lists all of the methods or method prefixes
      that are recognized by <span class="emphasis"><em>Apache Isis</em></span>' default
      programming model:</p>

      <div class="table"><a name="d5e2300"></a><p class="title"><b>Table&nbsp;A.1.&nbsp;Recognized Method Prefixes</b></p><div class="table-contents">
        

        <table summary="Recognized Method Prefixes" border="1"><colgroup><col align="center"><col width="50" align="center"><col width="50" align="center"><col width="50" align="center"><col width="50" align="center"><col width="50" align="center"><col></colgroup><thead><tr><th align="center">Prefix</th><th align="center">object</th><th align="center">property</th><th align="center">collection</th><th align="center">action</th><th align="center">action param</th><th align="center">See also</th></tr></thead><tbody><tr><td align="center">addTo</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>removeFrom</td></tr><tr><td align="center">choices</td><td align="center">&nbsp;</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">Y</td><td>&nbsp;</td></tr><tr><td align="center">clear</td><td align="center">&nbsp;</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>modify</td></tr><tr><td align="center">created</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">default</td><td align="center">&nbsp;</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">Y</td><td>&nbsp;</td></tr><tr><td align="center">disable</td><td align="center">&nbsp;</td><td align="center">Y</td><td align="center">Y</td><td align="center">Y</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">get</td><td align="center">&nbsp;</td><td align="center">Y</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>set</td></tr><tr><td align="center">getId</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>(services only)</td></tr><tr><td align="center">hide</td><td align="center">&nbsp;</td><td align="center">Y</td><td align="center">Y</td><td align="center">Y</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">iconName</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">loaded</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">loading</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">modify</td><td align="center">&nbsp;</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>clear</td></tr><tr><td align="center">persisted</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">persisting</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">removing</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">removed</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">removeFrom</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>addTo</td></tr><tr><td align="center">set</td><td align="center">&nbsp;</td><td align="center">Y</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>get</td></tr><tr><td align="center">toString</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">title</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">updating</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">updated</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">validate</td><td align="center">Y</td><td align="center">Y</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">Y</td><td>&nbsp;</td></tr></tbody></table>
      </div></div><br class="table-break">

      <p>There are also a number of deprecated methods:</p>

      <div class="table"><a name="d5e2513"></a><p class="title"><b>Table&nbsp;A.2.&nbsp;Deprecated Method Prefixes</b></p><div class="table-contents">
        

        <table summary="Deprecated Method Prefixes" border="1"><colgroup><col align="center"><col width="50" align="center"><col width="50" align="center"><col width="50" align="center"><col width="50" align="center"><col width="50" align="center"><col></colgroup><thead><tr><th align="center">Prefix</th><th align="center">object</th><th align="center">property</th><th align="center">collection</th><th align="center">action</th><th align="center">action param</th><th align="center">See also</th></tr></thead><tbody><tr><td align="center">deleted</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">deleting</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">saved</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">saving</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr></tbody></table>
      </div></div><br class="table-break">

      <p>In order to be recognized, all methods must be
      <code class="code">public</code>. Any methods that do not match are deemed to be
      action methods that the user can invoke from the user interface.</p>
    </div>

    <div class="appendix" title="Appendix&nbsp;B.&nbsp;Recognized Annotations"><div class="titlepage"><div><div><h2 class="title"><a name="d5e2568"></a>Appendix&nbsp;B.&nbsp;Recognized Annotations</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d5e2575">@ActionOrder</a></span></dt><dt><span class="sect1"><a href="#d5e2594">@ActionSemantics</a></span></dt><dt><span class="sect1"><a href="#d5e2604">@AutoComplete</a></span></dt><dt><span class="sect1"><a href="#d5e2613">@Aggregated</a></span></dt><dt><span class="sect1"><a href="#d5e2621">@Bounded</a></span></dt><dt><span class="sect1"><a href="#sec.DebugAnnotation">@Debug</a></span></dt><dt><span class="sect1"><a href="#d5e2640">@Defaulted</a></span></dt><dt><span class="sect1"><a href="#d5e2650">@DescribedAs</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2658">Providing a description for an object</a></span></dt><dt><span class="sect2"><a href="#d5e2664">Providing a description for an object member</a></span></dt><dt><span class="sect2"><a href="#d5e2670">Providing a description for an action parameter</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e2676">@Disabled</a></span></dt><dt><span class="sect1"><a href="#d5e2745">@Encodable</a></span></dt><dt><span class="sect1"><a href="#d5e2755">@EqualByContent</a></span></dt><dt><span class="sect1"><a href="#d5e2764">@Executed</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2770">Forcing a method to be executed on the client</a></span></dt><dt><span class="sect2"><a href="#d5e2774">Forcing a method to be executed on the server</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.ExplorationAnnotation">@Exploration</a></span></dt><dt><span class="sect1"><a href="#d5e2789">@Facets</a></span></dt><dt><span class="sect1"><a href="#d5e2798">@FieldOrder</a></span></dt><dt><span class="sect1"><a href="#sec.HiddenAnnotation">@Hidden</a></span></dt><dt><span class="sect1"><a href="#d5e2882">@Idempotent (deprecated)</a></span></dt><dt><span class="sect1"><a href="#d5e2886">@Ignore (deprecated)</a></span></dt><dt><span class="sect1"><a href="#d5e2893">@Immutable</a></span></dt><dt><span class="sect1"><a href="#sec.MaskAnnotation">@Mask</a></span></dt><dt><span class="sect1"><a href="#sec.MaxLengthAnnotation">@MaxLength</a></span></dt><dt><span class="sect1"><a href="#sec.MemberGroupsAnnotation">@MemberGroups</a></span></dt><dt><span class="sect1"><a href="#sec.MemberOrderAnnotation">@MemberOrder</a></span></dt><dt><span class="sect1"><a href="#d5e2984">@MultiLine</a></span></dt><dt><span class="sect1"><a href="#d5e3015">@MustSatisfy</a></span></dt><dt><span class="sect1"><a href="#sec.NamedAnnotation">@Named</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e3039">Specifying the name of an object</a></span></dt><dt><span class="sect2"><a href="#d5e3048">Specifying the name of a class member</a></span></dt><dt><span class="sect2"><a href="#d5e3057">Specifying the name for an action parameter</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.NotContributedAnnotation">@NotContributed</a></span></dt><dt><span class="sect1"><a href="#sec.NotInServiceMenuAnnotation">@NotInServiceMenu</a></span></dt><dt><span class="sect1"><a href="#not-persistable">@NotPersistable</a></span></dt><dt><span class="sect1"><a href="#d5e3108">@NotPersisted</a></span></dt><dt><span class="sect1"><a href="#d5e3116">@ObjectType</a></span></dt><dt><span class="sect1"><a href="#d5e3126">@Optional</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e3135">Making a property optional</a></span></dt><dt><span class="sect2"><a href="#d5e3144">Making an action parameter optional</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e3149">@Paged</a></span></dt><dt><span class="sect1"><a href="#d5e3164">@Parseable</a></span></dt><dt><span class="sect1"><a href="#sec.PluralAnnotation">@Plural</a></span></dt><dt><span class="sect1"><a href="#d5e3184">@Programmatic</a></span></dt><dt><span class="sect1"><a href="#sec.PrototypeAnnotation">@Prototype</a></span></dt><dt><span class="sect1"><a href="#d5e3206">@QueryOnly (deprecated)</a></span></dt><dt><span class="sect1"><a href="#sec.RegExAnnotation">@RegEx</a></span></dt><dt><span class="sect1"><a href="#d5e3227">@Resolve</a></span></dt><dt><span class="sect1"><a href="#sec.TitleAnnotation">@Title</a></span></dt><dt><span class="sect1"><a href="#d5e3258">@TypeOf</a></span></dt><dt><span class="sect1"><a href="#d5e3266">@TypicalLength</a></span></dt><dt><span class="sect1"><a href="#sec.ValueAnnotation">@Value</a></span></dt><dt><span class="sect1"><a href="#d5e3292">@ViewModel</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>All the annotations recognized in the <span class="emphasis"><em>Apache
        Isis</em></span> default programming model.</p>
      </div>

      <p>This chapter defines the set of annotations that are recognised by
      the <span class="emphasis"><em>Apache Isis</em></span> default programming model.</p>

      <div class="sect1" title="@ActionOrder"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2575"></a>@ActionOrder</h2></div></div></div>
        

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>The recommended mechanism for specifying the order in which
          actions are listed to the user is <code class="code">@MemberOrder</code> (see
          <a class="xref" href="#sec.MemberOrderAnnotation" title="@MemberOrder">the section called &#8220;@MemberOrder&#8221;</a>)</p>
        </div>

        <p><code class="code">@ActionOrder</code> provides a mechanism to specify the
        order in which actions appear in the user interface, in which the
        order is specified in one place in the class.</p>

        <p>For example:</p>

        <pre class="programlisting"><span class="strong"><strong>@ActionOrder("PlaceNewOrder, CheckCredit")</strong></span>
public class Customer {

    public Order placeNewOrder() {}

    public CreditRating checkCredit() {}

...
}</pre>

        <p>The action names are not case sensitive.</p>

        <p>Compared to <code class="classname">@MemberOrder</code>, there is
        (currently) one additional advantage in that you can easily specify
        groupings (which may be rendered by the viewer as sub-menus). This
        information may be used by the viewing mechanism to render actions
        into sub-menus.</p>

        <p>For example:</p>

        <pre class="programlisting">@ActionOrder("(Account Management: PlaceOrder, CheckCredit), (Personal Details: ChangeOfAddress, AddEmail)")
public class Customer {
    public CreditRating checkCredit() { ... }
    public void changeOfAddress() { ... }
    public Order placeNewOrder() { ... }
    public void addEmail(String emailAddress) { ... }
    ...
}</pre>

        <p>However, <code class="code">@ActionOrder</code> is more 'brittle' to change:
        if you change the name of an existing action you will need to ensure
        that the corresponding name within the <code class="code">@ActionOrder</code>
        annotation is also changed.</p>
      </div>

      <div class="sect1" title="@ActionSemantics"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2594"></a>@ActionSemantics</h2></div></div></div>
        

        <p>This annotation, which applies only to actions, describes
        whether the invocation is safe (as no side-effects), is idempotent
        (may have side-effects but always has the same postconditions), or is
        neither safe nor idempotent. If the annotation is missing then the
        framework assumes non-idempotent.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Customer {
    @ActionSemantics(Of.SAFE)
    public CreditRating checkCredit() { ... }

    @ActionSemantics(Of.IDEMPOTENT)
    public void changeOfAddress(Address address) { ... }

    @ActionSemantics(Of.NON_IDEMPOTENT)
    public Order placeNewOrder() { ... }
    ...
}</pre>

        <p>The annotation was introduced for the restfulobjects viewer in
        order that action invocations could be made available using either
        <acronym class="acronym">HTTP</acronym> <acronym class="acronym">GET</acronym>, <acronym class="acronym">PUT</acronym>
        or <acronym class="acronym">POST</acronym> (respectively). It is now also used in core
        runtime's in-built concurrency checking; the invocation of a safe
        action does not perform a concurrency check, whereas non-safe actions
        do perform a concurrency check.</p>
      </div>

      <div class="sect1" title="@AutoComplete"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2604"></a>@AutoComplete</h2></div></div></div>
        

        <p>This annotation is to support an auto-complete capability for
        reference properties and action parameters, the idea being that the
        user enters a few characters to locate a reference, and these are
        shown - for example - in a drop-down list box.</p>

        <p>The annotation is specified on the type, and specifies an action
        on a repository; this action should take a single string and should
        return a list of the type.</p>

        <p>For example:</p>

        <pre class="programlisting">@AutoComplete(repository=Customers.class, action="autoComplete")
public class Customer extends AbstractDomainObject {
   ....
}</pre>

        <p>where:</p>

        <pre class="programlisting">public interface Customers {

    @Hidden
    List&lt;Customer&gt; autoComplete(String search);
    ...
}</pre>

        <p>This annotation was first implemented in the Wicket
        viewer.</p>
      </div>

      <div class="sect1" title="@Aggregated"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2613"></a>@Aggregated</h2></div></div></div>
        

        <p>This annotation indicates that the object is aggregated, or
        wholly owned, by a root object. This information is of use by some
        object stores implementations (to store the aggregated objects
        "inline"). At the time of writing none of the viewers exploit this
        information, though this may change in the future. (For example, the
        <acronym class="acronym">DnD</acronym> viewer could be enhanced to prevent aggregated
        objects from being "dragged out" from their root object).</p>

        <p>All value types and all collections are automatically
        aggregated.</p>

        <div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
          <p>Outside of value types and collections, the
          <code class="classname">@Aggregated</code> semantics are not completely
          well-defined and so its use is currently discouraged.</p>
        </div>
      </div>

      <div class="sect1" title="@Bounded"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2621"></a>@Bounded</h2></div></div></div>
        

        <p>For immutable objects where there is a bounded set of instances,
        the <code class="literal">@Bounded</code> annotation can be
        used.</p>

        <p>For example:</p>

        <pre class="programlisting">@Bounded
public class County {
    ...
}</pre>

        <p>The number of instances is expected to be small enough that all
        instance can be held in memory. The viewer will use this information
        to render all the instances of this class in a drop-down list or
        equivalent.</p>

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>Although this is not enforced, <code class="literal">@Bounded</code> is intended for use on <code class="literal">final</code> classes. Its behaviour when used on
          interfaces, or classes with sub-classes is not specified</p>
        </div>
      </div>

      <div class="sect1" title="@Debug"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.DebugAnnotation"></a>@Debug</h2></div></div></div>
        

        <p>The <code class="classname">@Debug</code> annotation marks an action
        method as available in debug mode only, and so will not normally be
        displayed by the user interface.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Customer {
    public Order placeNewOrder() { ... }
    @Debug
    public List&lt;Order&gt; listRecentOrders() { ... }
    ...
}</pre>

        <p>The exact means to access <code class="classname">@Debug</code> actions
        depends on the viewer.</p>
      </div>

      <div class="sect1" title="@Defaulted"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2640"></a>@Defaulted</h2></div></div></div>
        

        <p>The concept of "defaulted" means being able to provide a default
        value for the type by way of the
        <code class="classname">org.apache.isis.applib.adapters.DefaultsProvider</code>
        interface. Generally this only applies to value types, where the
        <code class="classname">@Value</code> annotation (see <a class="xref" href="#sec.ValueAnnotation" title="@Value">the section called &#8220;@Value&#8221;</a>) implies encodability through the
        <code class="classname">ValueSemanticsProvider</code> interface (see <a class="xref" href="#chp.ValueTypes" title="Chapter&nbsp;10.&nbsp;Value Types">Chapter&nbsp;10, <i>Value Types</i></a>).</p>

        <p>For these reasons the <code class="classname">@Defaulted</code>
        annotation is generally never applied directly, but can be thought of
        as a placeholder for future enhancements whereby non-value types might
        also have a default value provided for them.</p>
      </div>

      <div class="sect1" title="@DescribedAs"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2650"></a>@DescribedAs</h2></div></div></div>
        

        <p>The <code class="literal">@DescribedAs</code> annotation
        is used to provide a short description of something that features on
        the user interface. How this description is used will depend upon the
        viewing mechanism - but it may be thought of as being like a 'tool
        tip'.</p>

        <p>Descriptions may be provided for objects, members (properties,
        collections and actions), and for individual parameters within an
        action method. <code class="literal">@DescribedAs</code>
        therefore works in a very similar manner to <code class="literal">@Named</code> (see <a class="xref" href="#sec.NamedAnnotation" title="@Named">the section called &#8220;@Named&#8221;</a>).</p>

        <div class="sect2" title="Providing a description for an object"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2658"></a>Providing a description for an object</h3></div></div></div>
          

          <p>To provide a description for an object, use the <code class="literal">@DescribedAs</code> annotation immediately before
          the declaration of that object class.</p>

          <p>For example:</p>

          <pre class="programlisting">@DescribedAs("A customer who may have originally become known to us via " +
             "the marketing system or who may have contacted us directly.")
public class ProspectiveSale {
   ...
}</pre>
        </div>

        <div class="sect2" title="Providing a description for an object member"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2664"></a>Providing a description for an object member</h3></div></div></div>
          

          <p>Any member (property, collection or action) may provide a
          description. To specify this description, use the <code class="literal">@DescribedAs</code> annotation immediately before
          the declaration of that member.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer {
    @DescribedAs("The name that the customer has indicated that they wish to be " +
                 "addressed as (e.g. Johnny rather than Jonathan)")
    public String getFirstName() { ... }
}</pre>
        </div>

        <div class="sect2" title="Providing a description for an action parameter"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2670"></a>Providing a description for an action parameter</h3></div></div></div>
          

          <p>To provide a description for an individual action parameter,
          use the <code class="literal">@DescribedAs</code> annotation
          in-line i.e. immediately before the parameter declaration.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer {
    public Order placeOrder(
                      Product product,
                      @Named("Quantity")
                      @DescribedAs("The quantity of the product being ordered")
                      int quantity) {
        Order order = createTransientInstance(Order.class);
        order.modifyCustomer(this);
        order.modifyProduct(product);
        order.setQuantity(quantity);        
        return order;
    }
    ...
}</pre>
        </div>
      </div>

      <div class="sect1" title="@Disabled"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2676"></a>@Disabled</h2></div></div></div>
        

        <p>The <code class="literal">@Disabled</code> annotation
        means that the member cannot be used in any instance of the class.
        When applied to the property it means that the user may not modify the
        value of that property (though it may still be modified
        programmatically). When applied to an action method, it means that the
        user cannot invoke that method.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Customer {
    @Disabled
    public void assessCreditWorthiness() { ... }

    @Disabled
    public int getInitialCreditRating(){ ... }
    public void setInitialCreditRating(int initialCreditRating) { ... }
}</pre>

        <p>Note that if an action is marked as <code class="literal">@Disabled</code>, it will be shown on the user
        interface but cannot ever be invoked. The only possible reason we can
        think to do this is during prototyping, to indicate an action that is
        still to be developed. If a method is intended for programmatic use,
        but not intended ever to be invoked directly by a user, then it should
        be marked as <code class="literal">@Hidden</code>
        instead.</p>

        <p>This annotation can also take two parameter indicating where (in
        the UI) it is to be disabled, and when (in the object's lifecycle) it
        is to be disabled. For example:</p>

        <pre class="programlisting">public class Customer {
    <span class="strong"><strong>@Disabled</strong></span>(when=When.UNTIL_PERSISTED)
    public void assessCreditWorthiness() { ... }
}</pre>

        <p>would disable the action until the object has been saved.
        And:</p>

        <pre class="programlisting">public class Customer {
    <span class="strong"><strong>@Disabled</strong></span>(where=Where.PARENTED_TABLES)
    public void getFirstName() { ... }
}</pre>

        <p>would disable the property in parented tables but not in regular
        object forms (though note: this would only be used by viewers that
        provide in-table editing capability).</p>

        <p>The acceptable values for the <code class="varname">where</code> parameter
        are:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="code">Where.ANYWHERE</code></p>

            <p>The member should be disabled everywhere.</p>
          </li><li class="listitem">
            <p><code class="code">Where.OBJECT_FORMS</code></p>

            <p>The member should be disabled when displayed within an
            object form. For most viewers, this applies to property and
            collection members, not actions.</p>
          </li><li class="listitem">
            <p><code class="code">Where.PARENTED_TABLES</code></p>

            <p>The member should be disabled when displayed as a column of
            a table within a parent object's collection. For most (all?)
            viewers, this will have meaning only if applied to a property
            member.</p>
          </li><li class="listitem">
            <p><code class="code">Where.STANDALONE_TABLES</code></p>

            <p>The member should be disabled when displayed as a column of
            a table showing a standalone list of objects, for example as
            returned by a repository query. For most (all?) viewers, this will
            have meaning only if applied to a property member.</p>
          </li><li class="listitem">
            <p><code class="code">Where.ALL_TABLES</code></p>

            <p>The member should be disabled when displayed as a column of
            a table, either an object's * collection or a standalone list.
            This combines PARENTED_TABLE} and STANDALONE_TABLE</p>
          </li><li class="listitem">
            <p><code class="code">Where.NOWHERE</code></p>

            <p>Has no meaning for the <code class="classname">@Disabled</code>
            annotation (though is used by the <code class="classname">@Hidden</code>
            annotation, see <a class="xref" href="#sec.HiddenAnnotation" title="@Hidden">the section called &#8220;@Hidden&#8221;</a>).</p>
          </li></ul></div>

        <p>The acceptable values for the <code class="varname">when</code> parameter
        are:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="code">When.ALWAYS</code></p>

            <p>The member should be disabled at all times.</p>
          </li><li class="listitem">
            <p><code class="code">When.NEVER</code></p>

            <p>The member should never be disabled (unless disabled through
            some other mechanism, for example an imperative
            <code class="methodname">disableXxx()</code> supporting method)..</p>
          </li><li class="listitem">
            <p><code class="code">When.ONCE_PERSISTED</code></p>

            <p>The member should be enabled for transient objects, but
            disabled for persisted objects.</p>
          </li><li class="listitem">
            <p><code class="code">When.UNTIL_PERSISTED</code></p>

            <p>The member should be disabled for transient objects, but
            enabled for persisted objects.</p>
          </li></ul></div>

        <p>By default the annotated property or action is always disabled
        (ie defaults to <code class="classname">Where.ANYWHERE</code>,
        <code class="classname">When.ALWAYS</code>).</p>
      </div>

      <div class="sect1" title="@Encodable"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2745"></a>@Encodable</h2></div></div></div>
        

        <p>Encodability means the ability to convert an object to-and-from
        a string, by way of the
        <code class="classname">org.apache.isis.applib.adapters.EncoderDecoder</code>
        interface. Generally this only applies to value types, where the
        <code class="classname">@Value</code> annotation (see <a class="xref" href="#sec.ValueAnnotation" title="@Value">the section called &#8220;@Value&#8221;</a>) implies encodability through the
        <code class="classname">ValueSemanticsProvider</code> interface (see <a class="xref" href="#chp.ValueTypes" title="Chapter&nbsp;10.&nbsp;Value Types">Chapter&nbsp;10, <i>Value Types</i></a>).</p>

        <p>For these reasons the <code class="classname">@Encodable</code>
        annotation is generally never applied directly, but can be thought of
        as a placeholder for future enhancements whereby non-value types might
        also be directly encoded.</p>
      </div>

      <div class="sect1" title="@EqualByContent"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2755"></a>@EqualByContent</h2></div></div></div>
        

        <p>Equal-by-content is a characteristic of value types, and is
        implied by any class annotated with the the
        <code class="classname">@Value</code> annotation (see <a class="xref" href="#sec.ValueAnnotation" title="@Value">the section called &#8220;@Value&#8221;</a> and also <a class="xref" href="#chp.ValueTypes" title="Chapter&nbsp;10.&nbsp;Value Types">Chapter&nbsp;10, <i>Value Types</i></a>).</p>

        <p>The <code class="classname">@EqualByContent</code> annotation exists so
        that this semantic could, if required, by applied directly to an
        object without it necessarily also being annotated as a value.</p>

        <p>That said, this annotation is only really for completeness.
        Moreover, the semantic captured by this annotation is currently used
        by the framework (not in any object store nor viewer).</p>
      </div>

      <div class="sect1" title="@Executed"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2764"></a>@Executed</h2></div></div></div>
        

        <p>The <code class="classname">@Executed</code> annotation is relevant only
        for client/server deployments (eg with the DnD viewer).</p>

        <p>In a client/server deployment, all methods for persistent
        objects are executed on the server-side and for transient objects are
        executed on the client-side.</p>

        <p>This annotation can be used to override that default.</p>

        <div class="sect2" title="Forcing a method to be executed on the client"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2770"></a>Forcing a method to be executed on the client</h3></div></div></div>
          

          <p>The <code class="classname">@Executed(Where.LOCALLY)</code> annotation
          marks an action method so that it executes on the client, rather
          than being forwarded to the server for execution. This is useful for
          methods that invoke a service that must be run client-side, for
          example spawning off a separate process (such as a web browser or
          Acrobat Reader).</p>
        </div>

        <div class="sect2" title="Forcing a method to be executed on the server"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2774"></a>Forcing a method to be executed on the server</h3></div></div></div>
          

          <p>The <code class="classname">@Executed(Where.REMOTELY)</code>
          annotation marks an action method so that it executes on the server,
          even though it would normally be executed on the client (as methods
          for transient objects are). This is useful for methods that although
          based on transient objects need access to persistent objects.</p>
        </div>
      </div>

      <div class="sect1" title="@Exploration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.ExplorationAnnotation"></a>@Exploration</h2></div></div></div>
        

        <p>The <code class="classname">@Exploration</code> annotation marks an
        action method as available in exploration mode only, and therefore not
        intended for use in the production system. An exploration action may
        or may not also be a debug action (annotated with
        <code class="classname">@Debug</code>, see <a class="xref" href="#sec.DebugAnnotation" title="@Debug">the section called &#8220;@Debug&#8221;</a>).</p>

        <p>For example:</p>

        <pre class="programlisting">public class Customer {
    public Order placeNewOrder() { ... }
    @Exploration
    public List&lt;Order&gt; listRecentOrders() { ... }
    ...
}</pre>

        <p>See also the <code class="classname">@Prototype</code> annotation, <a class="xref" href="#sec.PrototypeAnnotation" title="@Prototype">the section called &#8220;@Prototype&#8221;</a></p>
      </div>

      <div class="sect1" title="@Facets"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2789"></a>@Facets</h2></div></div></div>
        

        <p>The <code class="classname">@Facets</code> annotation specifies
        <code class="classname">FacetFactory</code> implementations and so can be used
        to run install arbitrary <code class="classname">Facet</code>s for a type.
        Generally this is not needed, but can be useful for overriding a
        custom programming model where a <code class="classname">FacetFactory</code>
        is not typically included.</p>

        <p>See the core documentation for more on writing
        <code class="classname">FacetFactory</code>s.</p>
      </div>

      <div class="sect1" title="@FieldOrder"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2798"></a>@FieldOrder</h2></div></div></div>
        

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>The recommended mechanism for specifying the order in which
          fields are listed to the user is <code class="code">@MemberOrder</code> (see
          <a class="xref" href="#sec.MemberOrderAnnotation" title="@MemberOrder">the section called &#8220;@MemberOrder&#8221;</a>)</p>
        </div>

        <p><code class="code">@FieldOrder</code> provides a mechanism to specify the
        order in which fields appear in the user interface, in which the order
        is specified in one place in the class.</p>

        <p>For example:</p>

        <pre class="programlisting">@FieldOrder("Name, Address, DateOfBirth, RecentOrders")
public class Customer {
    public Date getDateOfBirth() {...}
    public List&lt;Order&gt; getRecentOrders() {...}
    public String getAddress() {...}
    public String getName() {...}
    ...
}</pre>

        <p>The field names are not case sensitive.</p>

        <p>However, <code class="code">@FieldOrder</code> is more 'brittle' to change:
        if you change the name of an existing property you will need to ensure
        that the corresponding name within the <code class="code">@FieldOrder</code>
        annotation is also changed.</p>
      </div>

      <div class="sect1" title="@Hidden"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.HiddenAnnotation"></a>@Hidden</h2></div></div></div>
        

        <p>The <code class="literal">@Hidden</code> annotation
        indicates that the member (property, collection or action) to which it
        is applied should never be visible to the user. It can also be applied
        to service types (it has no effect if applied to entities or
        values).</p>

        <p>For example:</p>

        <pre class="programlisting">public class Customer {
    @Hidden
    public int getInternalId() { ... }

    @Hidden
    public void updateStatus() { ... }
    ...
}</pre>

        <p>Or, applied to a service:</p>

        <pre class="programlisting">@Hidden
public class EmailService {
    public void sendEmail(...) { ... }
    ...
}</pre>

        <p>This annotation can also take a parameters indicating where and
        when it is to be hidden. For example:</p>

        <pre class="programlisting">public class Customer {
    @Hidden(when=When.ONCE_PERSISTED)
    public int getInternalId() { ... }
    ...
}</pre>

        <p>would show the <code class="varname">Id</code> until the object has been
        saved, and then would hide it. And:</p>

        <pre class="programlisting">public class Customer {
    @Hidden(where=Where.ALL_TABLES)
    public int getDateOfBirth() { ... }
    ...
}</pre>

        <p>would suppress the <code class="varname">dateOfBirth</code> property of a
        Customer from all tables.</p>

        <p>The acceptable values for the <code class="varname">where</code> parameter
        are:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="code">Where.ANYWHERE</code></p>

            <p>The member should be hidden everywhere.</p>
          </li><li class="listitem">
            <p><code class="code">Where.OBJECT_FORMS</code></p>

            <p>The member should be hidden when displayed within an object
            form. For most viewers, this applies to property and collection
            members, not actions.</p>
          </li><li class="listitem">
            <p><code class="code">Where.PARENTED_TABLES</code></p>

            <p>The member should be hidden when displayed as a column of a
            table within a parent object's collection. For most (all?)
            viewers, this will have meaning only if applied to a property
            member.</p>
          </li><li class="listitem">
            <p><code class="code">Where.STANDALONE_TABLES</code></p>

            <p>The member should be hidden when displayed as a column of a
            table showing a standalone list of objects, for example as
            returned by a repository query. For most (all?) viewers, this will
            have meaning only if applied to a property member.</p>
          </li><li class="listitem">
            <p><code class="code">Where.ALL_TABLES</code></p>

            <p>The member should be /hidden when displayed as a column of a
            table, either an object's * collection or a standalone list. This
            combines <code class="classname">PARENTED_TABLES</code> and
            <code class="classname">STANDALONE_TABLES</code>.</p>
          </li><li class="listitem">
            <p><code class="code">Where.NOWHERE</code></p>

            <p>Acts as an override if a member would normally be hidden as
            a result of some other convention. For example, if a property is
            annotated with <code class="classname">@Title</code> (see <a class="xref" href="#sec.TitleAnnotation" title="@Title">the section called &#8220;@Title&#8221;</a>), then normally this should be
            hidden from all tables. Additionally annotating with
            <code class="code">@Hidden(where=Where.NOWHERE)</code> overrides this.</p>
          </li></ul></div>

        <p>The acceptable values for the <code class="varname">when</code> parameter
        are:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="code">When.ALWAYS</code></p>

            <p>The member should be hidden at all times.</p>
          </li><li class="listitem">
            <p><code class="code">When.NEVER</code></p>

            <p>The member should never be hidden (unless disabled through
            some other mechanism, for example an imperative
            <code class="methodname">disableXxx()</code> supporting method)..</p>
          </li><li class="listitem">
            <p><code class="code">When.ONCE_PERSISTED</code></p>

            <p>The member should be visible for transient objects, but
            hidden for persisted objects.</p>
          </li><li class="listitem">
            <p><code class="code">When.UNTIL_PERSISTED</code></p>

            <p>The member should be hidden for transient objects, but
            visible for persisted objects.</p>
          </li></ul></div>

        <p>By default the annotated property or action is always hidden (ie
        defaults to <code class="classname">Where.ANYWHERE</code>,
        <code class="classname">When.ALWAYS</code>).</p>
      </div>

      <div class="sect1" title="@Idempotent (deprecated)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2882"></a>@Idempotent (deprecated)</h2></div></div></div>
        

        <p>Equivalent to using <code class="code">@ActionSemantics(Of.IDEMPOTENT)</code>
        on an action.</p>
      </div>

      <div class="sect1" title="@Ignore (deprecated)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2886"></a>@Ignore (deprecated)</h2></div></div></div>
        

        <p>Equivalent to using <code class="code">@Programmatic</code>. The
        <code class="classname">@Programmatic</code> annotation was introduced because
        <code class="classname">@Ignore</code> can easily clash with
        <code class="classname">@org.junit.Ignore</code>.</p>
      </div>

      <div class="sect1" title="@Immutable"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2893"></a>@Immutable</h2></div></div></div>
        

        <p>The <code class="literal">@Immutable</code> annotation may
        be applied to a class, and indicates to the framework that the state
        of such objects may not be changed. The viewers will prevent any
        change through the user interface, and moreover the object stores will
        reject any changes to the objects that might have occurred
        programmatically.</p>

        <p>For example:</p>

        <pre class="programlisting">@Immutable
public class Country {
    ...
}</pre>

        <p>This annotation can also take a single parameter indicating when
        it is to become immutable. For example:</p>

        <pre class="programlisting">@Immutable(When.ONCE_PERSISTED)
public class Email {
    ...
}</pre>

        <p>This would allow the user to create an email object and set it
        up, and then prevent any changes once it has been saved.</p>

        <p>The acceptable values for the parameter are:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="code">When.ALWAYS</code></p>
          </li><li class="listitem">
            <p><code class="code">When.NEVER</code></p>
          </li><li class="listitem">
            <p><code class="code">When.ONCE_PERSISTED</code></p>
          </li><li class="listitem">
            <p><code class="code">When.UNTIL_PERSISTED</code></p>
          </li></ul></div>

        <p>By default the annotated property or action is always immutable
        (ie defaults to <code class="classname">When.ALWAYS</code>).</p>
      </div>

      <div class="sect1" title="@Mask"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.MaskAnnotation"></a>@Mask</h2></div></div></div>
        

        <p>The <code class="literal">@Mask</code> annotation may be
        applied to any property, or to any parameter within an action method,
        that allows the user to type in text as input. It can also annotate a
        string-based value type, and thereby apply to all properties or
        parameters of that type.</p>

        <p>The mask serves to validate, and potentially to normalise, the
        format of the input. The characters that can be used are based on
        Swing's <code class="classname">javax.swing.text.MaskFormatter</code>, and
        also Java's <code class="classname">java.util.SimpleDateFormat</code>.</p>

        <p>For example, on a property:</p>

        <pre class="programlisting">public class Email {
    @Mask("(NNN)NNN-NNNN")
    public String getTelephoneNumber() {...}
    public void setTelephoneNumber(String telNo) {...}
    ...
}</pre>

        <p>Or, on an action parameter:</p>

        <pre class="programlisting">public void ContactRepository {
    public void newContact(
            @Named("Contact Name") String contactName
           ,@Mask("(NNN)NNN-NNNN") 
            @Named("Telephone Number") String telNo) { 
        ...
    }
    ... 
}</pre>

        <p>Or, on a value type:</p>

        <pre class="programlisting">@Value(...)
@MaxLength(30)
public class CustomerFirstName {
    ...
}</pre>

        <p>See also <code class="classname">@RegEx</code> annotation, <a class="xref" href="#sec.RegExAnnotation" title="@RegEx">the section called &#8220;@RegEx&#8221;</a>.</p>
      </div>

      <div class="sect1" title="@MaxLength"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.MaxLengthAnnotation"></a>@MaxLength</h2></div></div></div>
        

        <p>The <code class="literal">@MaxLength</code> annotation
        indicates the maximum number of characters that the user may enter
        into a <code class="literal">String</code> property, or a
        <code class="literal">String</code> parameter in an action, or
        for a string-based value type. It is ignored if applied to any other
        type.</p>

        <p>For example, on a property:</p>

        <pre class="programlisting">public class Customer {
    @MaxLength(30)
    public String getFirstName() { ... }
    public void setFirstName(String firstName) { ... }
    ...
}</pre>

        <p>Or, on an action parameter:</p>

        <pre class="programlisting">public class CustomerRepository {
    public Customer newCustomer(
        @MaxLength(30)
        @Named("First Name") String firstName
       ,@MaxLength(30)
        @Named("Last Name") String lastName) {
    ...
}</pre>

        <p>Or, for a value type:</p>

        <pre class="programlisting">@Value(...)
@MaxLength(30)
public class CustomerFirstName {
    ...
}</pre>

        <p>If the model is being persisted to a relational database then
        <code class="literal">@MaxLength</code> should be specified for
        all <code class="literal">String</code> properties and action
        parameters.</p>
      </div>

      <div class="sect1" title="@MemberGroups"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.MemberGroupsAnnotation"></a>@MemberGroups</h2></div></div></div>
        

        <p><code class="code">@MemberGroups</code> is designed to work in conjunction
        with <code class="classname">@MemberOrder</code> (see <a class="xref" href="#sec.MemberOrderAnnotation" title="@MemberOrder">the section called &#8220;@MemberOrder&#8221;</a>), and specifies the order in
        which groups of members should be rendered.</p>

        <p>For example:</p>

        <pre class="programlisting">@MemberGroups({"General", "Dates", "Other"})
public Class Customer {
    @MemberOrder(name="General", sequence="1.1")
    public String getFirstName() {...}
    public void setFirstName(value as String) {...}

    @MemberOrder(name="General", sequence="1.2")
    public String getLastName() {...}
    public void setLastName(value as String) {...}

    @MemberOrder(name="Other", sequence="1")
    public String getAddress() {...}
    public void setAddress(value as String) {...}

    @MemberOrder(name="Dates", sequence="1")
    public Date getDateOfBirth() {...}
    public void setDateOfBirth(value as Date) {...}
    ...
}   </pre>

        <p>If the <code class="classname">@MemberOrder</code>'s name is not
        specified, then its group is assumed to be
        "<code class="literal">General</code>".</p>
      </div>

      <div class="sect1" title="@MemberOrder"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.MemberOrderAnnotation"></a>@MemberOrder</h2></div></div></div>
        

        <p><code class="code">@MemberOrder</code> is the recommended mechanism for
        specifying the order in which fields and/or actions are presented to
        the user. (<code class="code">@ActionOrder</code> and <code class="code">@FieldOrder</code>
        provide alternative, deprecated mechanisms).</p>

        <p><code class="code">@MemberOrder</code> is specified at the individual member
        level, relative to other members, as a string. The simplest convention
        is to use numbers - 1, 2, 3 - though it is a better idea to leave gaps
        in the numbers - 10, 20, 30 perhaps - such that a new member may be
        added without having to edit existing numbers. A useful alternative is
        to adopt the 'dewey-decimal' notation - 1, 1.1, 1.2, 2, 3, 5.1.1,
        5.2.2, 5.2, 5.3 - which allows for an indefinite amount of future
        insertion, and allows subclasses to insert their class members as
        required.</p>

        <p>For example:</p>

        <pre class="programlisting">public Class Customer {
    @MemberOrder(sequence="2.1")
    public String getAddress() {...}
    public void setAddress(value as String) {...}

    @MemberOrder(sequence="1.1")
    public String getFirstName() {...}
    public void setFirstName(value as String) {...}

    @MemberOrder(sequence="1.2")
    public String getLastName() {...}
    public void setLastName(value as String) {...}

    @MemberOrder(sequence="3")
    public Date getDateOfBirth() {...}
    public void setDateOfBirth(value as Date) {...}
    ...
}   </pre>

        <p>If a member does not have a specified order then it will be
        placed after those that are specified. Two members may have the same
        sequence specifier, but in such a case the relative ordering of those
        members will be indeterminate.</p>

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>Certain styles of user interface may lay out an object's
          properties and its collections separately, in which case the
          relative member order of properties and collections will be
          evaluated separately. In general, though, consider the layout of all
          properties and collections together, and of all actions
          together.</p>
        </div>

        <p>As a refinement to this, some viewers support the notion of
        grouping members together. In this case the <code class="varname">name</code>
        attribute can be specified.</p>

        <p>For example, the following can be used to group
        properties:</p>

        <pre class="programlisting">public Class Customer {
    @MemberOrder(name="General", sequence="1.1")
    public String getFirstName() {...}
    public void setFirstName(value as String) {...}

    @MemberOrder(name="General", sequence="1.2")
    public String getLastName() {...}
    public void setLastName(value as String) {...}

    @MemberOrder(name="Other", sequence="1")
    public String getAddress() {...}
    public void setAddress(value as String) {...}

    @MemberOrder(name="Dates", sequence="1")
    public Date getDateOfBirth() {...}
    public void setDateOfBirth(value as Date) {...}
    ...
}   </pre>

        <p>In this case the <code class="varname">sequence</code> is ordered with
        respect to the <code class="varname">name</code>. If using group names in this
        way, typically the MemberGroups annotation (see <a class="xref" href="#sec.MemberGroupsAnnotation" title="@MemberGroups">the section called &#8220;@MemberGroups&#8221;</a>) should also be specified,
        allowing the order of the groups themselves to be sorted.</p>

        <p>Grouping can also be performed on actions. Some viewers (for
        example the Wicket viewer) support the idea that the group name can be
        the name of a collection. In this case, the action is rendered "near
        to" the collection (for example, to support add or remove of
        elements).</p>

        <p>For example:</p>

        <pre class="programlisting">public Class Customer {

    public List&lt;CommunicationChannel&gt; getCommunicationChannels() { ... }

    ...
    @MemberOrder(name="communicationChannels", sequence="1.1")
    public void addCommunicationChannel(...) { ... }

    @MemberOrder(name="communicationChannels", sequence="1.2")
    public void removeCommunicationChannel(...) { ... }

    ...
}   </pre>
      </div>

      <div class="sect1" title="@MultiLine"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2984"></a>@MultiLine</h2></div></div></div>
        

        <p>The <code class="literal">@MultiLine</code> annotation
        provides information about the carriage returns in a <code class="literal">String</code> property or action parameter, or for
        a string-based value type. It also implies a hint to the viewer that
        the widget to be used should be over multiple lines (eg a text area
        rather than a text field), with appropriate wrapping and/or
        scrollbars.</p>

        <p>More formally, the annotation indicates that:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>the <code class="code">String</code> property or parameter may contain
            carriage returns, and</p>
          </li><li class="listitem">
            <p>(optionally) the typical number of such carriage returns
            (meaning the number of rows in the text area), and</p>
          </li><li class="listitem">
            <p>(optionally) that the text should be wrapped (the default is
            that text is not wrapped).</p>
          </li></ul></div>

        <div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
          <p>Currently the <code class="literal">preventWrapping</code> functionality is not fully
          implemented.</p>
        </div>

        <p>The syntax is:</p>

        <p><code class="literal">@MultiLine([numberOfLines=&lt;typicalNumberOfCRs&gt;]
        [,preventWrapping=&lt;false|true&gt;])</code></p>

        <p>For example:</p>

        <pre class="programlisting">public class BugReport {
    @MultiLine(numberOfLines=10)
    public String getStepsToReproduce() { ... }
    public void setStepsToReproduce(String stepsToReproduce) { ... }
    ...
}</pre>

        <p>Here the <code class="literal">stepsToReproduce</code> may
        be displayed in a text area of 10 rows, with no wrapping. A horizontal
        scrollbar may appear if the number of characters on any given row
        exceeds the width.</p>

        <p>Another example:</p>

        <pre class="programlisting">public class Email {
    @MultiLine(numberOfLines=20, preventWrapping=false)
    public String getBody() { ... }
    public void setBody(String body) { ... }
    ...
}</pre>

        <p>Here the body should be displayed in a text area of 20 rows,
        with wrapping.</p>

        <p>If the annotation is combined with the <code class="literal">@TypicalLength</code>, then the expected width of
        the text area in the user interface will be determined by the value of
        the typical length divided by the number of specified lines. For
        example:</p>

        <pre class="programlisting">public class Email {
    @MultiLine(numberOfLines=20, preventWrapping=false)
    @TypicalLength(800)
    public String getBody() { ... }
    public void setBody(String body) { ... }
    ...
}</pre>

        <p>Here the body will (likely be) displayed in a text area of 20
        rows, with 40 columns.</p>
      </div>

      <div class="sect1" title="@MustSatisfy"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e3015"></a>@MustSatisfy</h2></div></div></div>
        

        <p>The <code class="literal">@MustSatisfy</code> annotation
        allows validation to be applied to properties and parameters using an
        (implementation of a)
        <code class="classname">org.apache.isis.applib.spec.Specification</code>
        object.</p>

        <p>For example, on a property:</p>

        <pre class="programlisting">public class Customer {
    @MustSatisfy(StartWithCapitalLetterSpecification.class)
    public String getFirstName() { ... }
    ...
}</pre>

        <p>Or, on an action parameter:</p>

        <pre class="programlisting">public class CustomerRepository {
    public Customer newCustomer(
            @MustSatisfy(StartWithCapitalLetterSpecification.class)
            @Named("First Name") firstName
           ,@MustSatisfy(StartWithCapitalLetterSpecification.class)
            @Named("Last Name") lastName) {
        ...
    }
    ...
}</pre>

        <p>The <code class="classname">Specification</code> is consulted during
        validation, being passed the proposed value.</p>

        <p>An alternative to using <code class="classname">@MustSatisfy</code> is
        to define a custom value type, see <a class="xref" href="#chp.ValueTypes" title="Chapter&nbsp;10.&nbsp;Value Types">Chapter&nbsp;10, <i>Value Types</i></a>.</p>
      </div>

      <div class="sect1" title="@Named"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.NamedAnnotation"></a>@Named</h2></div></div></div>
        

        <p>The <code class="literal">@Named</code> annotation is used
        when you want to specify the way something is named on the user
        interface i.e. when you do not want to use the name generated
        automatically by the system. It can be applied to objects, members
        (properties, collections, and actions) and to parameters within an
        action method.</p>

        <div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
            <p>Generally speaking it is better to rename the property,
            collection or action. The only common case where
            <code class="literal">@Named</code> is common is to rename parameters for
            built-in value types. Even here though a custom value type can be
            defined using <code class="classname">@Value</code> so that the value type
            is used as the parameter name. <code class="classname">@Named</code> may
            also be used if the name needs punctuation or other symbols in the
            name presented to the user.</p>
          </div>

        <div class="sect2" title="Specifying the name of an object"><div class="titlepage"><div><div><h3 class="title"><a name="d5e3039"></a>Specifying the name of an object</h3></div></div></div>
          

          <p>By default the name of an object is derived, reflectively from
          the class name. To specify a different name for an object, use the
          <code class="literal">@Named</code> annotation in front of the
          class declaration.</p>

          <p>For example:</p>

          <pre class="programlisting">@Named("Customer")
public class CustomerImpl implements Customer{
   ...
}</pre>

          <p>See also the <code class="literal">@Plural</code>
          annotation, <a class="xref" href="#sec.PluralAnnotation" title="@Plural">the section called &#8220;@Plural&#8221;</a>.</p>
        </div>

        <div class="sect2" title="Specifying the name of a class member"><div class="titlepage"><div><div><h3 class="title"><a name="d5e3048"></a>Specifying the name of a class member</h3></div></div></div>
          

          <p>By default, the name of a class member (a property, collection
          or action) presented to the user is derived, reflectively, from the
          name of the member defined in the program code. To specify a
          different name use the <code class="literal">@Named
          </code>annotation immediately before the member
          declaration.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer {
    <span class="strong"><strong>@Named("Given Name")</strong></span>
    public String getFirstName() { ... }

    <span class="strong"><strong>@Named("Family Name")</strong></span>
    public String getSurname() { ... }

    public CreditRating getCreditRating() { ... }
}</pre>

          <p>Note that the framework provides a separate and more powerful
          mechanism for internationalisation.</p>
        </div>

        <div class="sect2" title="Specifying the name for an action parameter"><div class="titlepage"><div><div><h3 class="title"><a name="d5e3057"></a>Specifying the name for an action parameter</h3></div></div></div>
          

          <p>The most common usage of <code class="literal">@Named</code> is be to specify names for the
          parameters of an action. This is because the parameter name declared
          in the code for the action method cannot be picked up reflectively
          (by default, the user interface will use the type of the parameter
          as the name; for a String or a Boolean, this is almost certainly not
          what is required).</p>

          <p>To specify the name of a parameter, the <code class="literal">@Named</code> annotation is applied 'in-line'
          (i.e. preceding the individual parameter declaration.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer {
    public Order placeOrder(
            Product product
           ,@Named("Quantity")
            int quantity) {
        Order order = newTransientInstance(Order.class);
        order.modifyCustomer(this);
        order.modifyProduct(product);
        order.setQuantity(quantity);        
        return order;
    }
    ...
}</pre>

          <p>An alternative is to use a value type, as described in <a class="xref" href="#chp.ValueTypes" title="Chapter&nbsp;10.&nbsp;Value Types">Chapter&nbsp;10, <i>Value Types</i></a>.</p>
        </div>
      </div>

      <div class="sect1" title="@NotContributed"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.NotContributedAnnotation"></a>@NotContributed</h2></div></div></div>
        

        <p>The <code class="classname">@NotContributed</code> annotation applies
        only to action methods, and specifically to the actions of services.
        If present, it indicates that the action should not be contributed to
        any of its domain object arguments.</p>

        <p>For example:</p>

        <pre class="programlisting">public class OrderServices {
    @NotContributed
    public void cancel(Order order);
    ...
}</pre>

        <p>If the action should neither be contributed nor appear in the
        service's service menu (see <a class="xref" href="#sec.NotInServiceMenuAnnotation" title="@NotInServiceMenu">the section called &#8220;@NotInServiceMenu&#8221;</a>), then you could instead
        simply mark it as <code class="classname">@Hidden</code> (see <a class="xref" href="#sec.HiddenAnnotation" title="@Hidden">the section called &#8220;@Hidden&#8221;</a>).</p>
      </div>

      <div class="sect1" title="@NotInServiceMenu"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.NotInServiceMenuAnnotation"></a>@NotInServiceMenu</h2></div></div></div>
        

        <p>The <code class="classname">@NotInServiceMenu</code> annotation applies
        only to action methods, and specifically to the actions of services.
        If present, it indicates that the action should not appear in the
        service menu for the service. It may, however, still be contributed to
        any of its domain object arguments.</p>

        <p>For example:</p>

        <pre class="programlisting">public class OrderServices {
    @NotInServiceMenu
    public void cancel(Order order);
    ...
}</pre>

        <p>If the action should neither be contributed (see <a class="xref" href="#sec.NotContributedAnnotation" title="@NotContributed">the section called &#8220;@NotContributed&#8221;</a>) nor appear in the service's
        service menu, then you could instead simply mark it as
        <code class="classname">@Hidden</code> (see <a class="xref" href="#sec.HiddenAnnotation" title="@Hidden">the section called &#8220;@Hidden&#8221;</a>).</p>
      </div>

      <div class="sect1" title="@NotPersistable"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="not-persistable"></a>@NotPersistable</h2></div></div></div>
        

        <p>The <code class="classname">@NotPersistable</code> annotation indicates
        that transient instances of this class may be created but may not be
        persisted. The framework will not provide the user with an option to
        'save' the object, and attempting to persist such an object
        programmatically would be an error.</p>

        <p>For example:</p>

        <pre class="programlisting"><code class="classname">@NotPersistable</code>
public class InputForm {
    // members and actions here
}</pre>

        <p>This annotation can also take a single parameter indicating
        whether it is only the user that cannot persist the object, for
        example the following code would prevent the user from saving the
        object (via the viewer) but still allow the program to persist the
        object.</p>

        <p>For example:</p>

        <pre class="programlisting">@NotPersistable(By.USER)
public class InputForm {
    ...
}</pre>

        <p>The acceptable values for the parameter are:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="code">By.USER</code></p>
          </li><li class="listitem">
            <p><code class="code">By.USER_OR_PROGRAM</code></p>
          </li></ul></div>

        <p>By default the annotated object is effectively transient (ie
        default to
        <code class="classname">By</code>.<code class="varname">USER_OR_PROGRAM</code>).</p>
      </div>

      <div class="sect1" title="@NotPersisted"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e3108"></a>@NotPersisted</h2></div></div></div>
        

        <p>The <code class="classname">@NotPersisted</code> annotation indicates
        that the property is not to be persisted.</p>

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>In many cases the same thing can be achieved simply by
          providing the property with a 'getter' but no 'setter'.</p>
        </div>

        <p>For example:</p>

        <pre class="programlisting">public class Order {

    @NotPersisted
    public Order getPreviousOrder() {...}
    public void setPreviousOrder(Order previousOrder) {...}

    ...
}</pre>
      </div>

      <div class="sect1" title="@ObjectType"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e3116"></a>@ObjectType</h2></div></div></div>
        

        <p>The <code class="classname">@ObjectType</code> annotation is used to
        provide a unique abbreviation for the object's class name. This is
        used internally to generate a string representation of an objects
        identity (the Oid).</p>

        <p>For example:</p>

        <pre class="programlisting">@ObjectType("ORD")
public class Order {

    ...
}</pre>

        <p>If no <code class="code">@ObjectType</code> annotation is present, then the
        framework uses the fully-qualified class name.</p>

        <p>If an <code class="code">@ObjectType</code> is not unique, then the framework
        will fail to boot.</p>
      </div>

      <div class="sect1" title="@Optional"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e3126"></a>@Optional</h2></div></div></div>
        

        <p>By default, the system assumes that all properties of an object
        are required, and therefore will not let the user save a new object
        unless a value has been specified for each property. Similarly, by
        default, the system assumes that all parameters in an action are
        required and will not let the user execute that action unless values
        have been specified for each parameter.</p>

        <p>To indicate that either a property, or an action parameter, is
        optional, use the <code class="literal">@Optional</code>
        annotation.</p>

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>The <code class="literal">@Optional</code>annotation has
          no meaning for a primitive property (or parameter) such as <code class="literal">int</code> - because primitives will always
          return a default value (e.g. zero). If optionality is required, then
          use the corresponding wrapper class (e.g. java.lang.Integer).</p>
        </div>

        <div class="sect2" title="Making a property optional"><div class="titlepage"><div><div><h3 class="title"><a name="d5e3135"></a>Making a property optional</h3></div></div></div>
          

          <p>Annotate the getter to indicate that a property is
          <code class="classname">@Optional</code>. For example:</p>

          <pre class="programlisting">public class Order {
    public Product getProduct() { ... }
    
    public java.util.Date getShipDate() { ... }
    public void setShipDate(Date java.util.shipDate) { ... }

    @Optional
    public String getComments() { ... }
    public void setComments(String comments) { ... }
}</pre>

          <p>Here the <code class="literal">product</code> and
          <code class="literal">shipDate</code> properties are both
          required, but the <code class="literal">comments</code>
          property is optional.</p>
        </div>

        <div class="sect2" title="Making an action parameter optional"><div class="titlepage"><div><div><h3 class="title"><a name="d5e3144"></a>Making an action parameter optional</h3></div></div></div>
          

          <p>To indicate that an action may be invoked without having to
          specify a value for a particular parameter, annotate with
          <code class="literal">@Optional</code>. For example:</p>

          <pre class="programlisting">public class Customer {
    public Order placeOrder(
            Product product
           ,@Named("Quantity") int quantity
           ,@Optional @Named("Special Instructions") String instr) {
        ...
    }
    ...
}</pre>
        </div>
      </div>

      <div class="sect1" title="@Paged"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e3149"></a>@Paged</h2></div></div></div>
        

        <p>This annotation is used to indicate that parented and/or
        standalone collections should be paginated.</p>

        <p>When annotated on a collection, <code class="classname">@Paged</code>
        indicates the page size of a parented collection. When annotated on a
        type, <code class="classname">@Paged</code> indicates the page size of a
        standalone collection.</p>

        <p>For example:</p>

        <pre class="programlisting">@Paged(30)
public class Order {

    @Paged(15)
    public List&lt;LineItem&gt; getDetails() {...}
}</pre>

        <p>This indicates a page size of 15 for parented collections, and a
        page size of 30 for standalone collections.</p>

        <p>When omitting a parameter value or omitting the annotation
        completely, the configured defaults in
        <code class="filename">isis.properties</code> wil be used.</p>

        <p>For example:</p>

        <pre class="programlisting">isis.viewers.paged.standalone=20
isis.viewers.paged.parented=5</pre>

        <p>This indicates a page size of 5 for parented collections and a
        page size of 20 for standalone collections.</p>
      </div>

      <div class="sect1" title="@Parseable"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e3164"></a>@Parseable</h2></div></div></div>
        

        <p>Parseability means being able to parse a string representation
        into an object by way of the
        <code class="classname">org.apache.isis.applib.adapters.Parser</code>
        interface. Generally this only applies to value types, where the
        <code class="classname">@Value</code> annotation (see <a class="xref" href="#sec.ValueAnnotation" title="@Value">the section called &#8220;@Value&#8221;</a>) implies encodability through the
        <code class="classname">ValueSemanticsProvider</code> interface (see <a class="xref" href="#chp.ValueTypes" title="Chapter&nbsp;10.&nbsp;Value Types">Chapter&nbsp;10, <i>Value Types</i></a>).</p>

        <p>For these reasons the <code class="classname">@Parser</code> annotation
        is generally never applied directly, but can be thought of as a
        placeholder for future enhancements whereby non-value types might also
        have be able to be parsed. For example, a
        <code class="classname">Customer</code> could in theory be parsed from a
        string representing that <code class="classname">Customer</code>'s title
        (perhaps in conjunction with some other annotation to determine the
        repository by which to perform the lookup).</p>
      </div>

      <div class="sect1" title="@Plural"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.PluralAnnotation"></a>@Plural</h2></div></div></div>
        

        <p>When the framework displays a collection of several objects it
        may use the plural form of the object type in the title. By default
        the plural name will be created by adding an 's' to the end of the
        singular name (whether that is the class name or another name
        specified using <code class="literal">@Named</code>). Where the
        single name ends in 'y' then the default plural name will end in 'ies'
        - for example a collection of <code class="literal">Country</code> objects will be titled 'Countries'.
        Where these conventions do not work, the programmer may specify the
        plural form of the name using <code class="classname">@Plural</code>. For
        example:</p>

        <pre class="programlisting"><span class="strong"><strong>@Plural("Children")</strong></span>
public class Child {
    // members and actions here
}</pre>
      </div>

      <div class="sect1" title="@Programmatic"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e3184"></a>@Programmatic</h2></div></div></div>
        

        <p>The <code class="classname">@Programmatic</code> annotation can be used
        to cause Apache Isis to complete ignore a class member. This means it
        won't appear in any viewer, its value will not be persisted, and it
        won't appear in any XML snapshots (see <a class="xref" href="#chp.XmlSnapshots" title="Chapter&nbsp;14.&nbsp;XML Snapshots">Chapter&nbsp;14, <i>XML Snapshots</i></a>).</p>

        <p>A common use-case is to ignore implementation-level artifacts.
        For example:</p>

        <pre class="programlisting">public class Customer implements Comparable&lt;Customer&gt; {
    ...
    @Programmatic
    public int compareTo(Customer c) { 
        return getSalary() - c.getSalary();
    }
    ...
}</pre>

        <p>Note that <code class="methodname">@Programmatic</code> does not simply
        imply <code class="methodname">@Hidden</code> and
        <code class="methodname">@NotPersisted</code>; it actually means that the
        class member will not be part of the Isis metamodel.</p>
      </div>

      <div class="sect1" title="@Prototype"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.PrototypeAnnotation"></a>@Prototype</h2></div></div></div>
        

        <p>The <code class="classname">@Prototype</code> annotation marks an action
        method as available in prototype mode only, and therefore not intended
        for use in the production system. A prototype action may or may not
        also be a debug action (annotated with <code class="classname">@Debug</code>,
        see <a class="xref" href="#sec.DebugAnnotation" title="@Debug">the section called &#8220;@Debug&#8221;</a>).</p>

        <p>For example:</p>

        <pre class="programlisting">public class Customer {
    public Order placeNewOrder() { ... }
    @Prototype
    public List&lt;Order&gt; listRecentOrders() { ... }
    ...
}</pre>

        <p>See also the <code class="classname">@Exploration</code> annotation,
        <a class="xref" href="#sec.ExplorationAnnotation" title="@Exploration">the section called &#8220;@Exploration&#8221;</a></p>
      </div>

      <div class="sect1" title="@QueryOnly (deprecated)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e3206"></a>@QueryOnly (deprecated)</h2></div></div></div>
        

        <p>Equivalent to using <code class="code">@ActionSemantics(Of.SAFE)</code> on an
        action.</p>
      </div>

      <div class="sect1" title="@RegEx"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.RegExAnnotation"></a>@RegEx</h2></div></div></div>
        

        <p>The <code class="literal">@RegEx</code> annotation may be
        applied to any string property, or to any parameter within an action
        method. It can also be applied to any string-based value type. It
        serves both to validate and potentially to normalise the format of the
        input. <code class="literal">@Regex</code> is therefore similar
        in use to <code class="literal">@Mask</code> (see <a class="xref" href="#sec.MaskAnnotation" title="@Mask">the section called &#8220;@Mask&#8221;</a>) but provides more flexibility.</p>

        <p>The syntax is:</p>

        <p><code class="literal">@RegEx(validation = "regEx string",
        format = "regEx string", caseSensitive =
        &lt;true|false&gt;)</code></p>

        <p>Only the first parameter is required; the format defaults to "no
        formatting", and caseSensitive defaults to false.</p>

        <p>For example, on a property:</p>

        <pre class="programlisting">public class Customer {
    @RegEx(validation = "(\\w+\\.)*\\w+@(\\w+\\.)+[A-Za-z]+")
    public String getEmail() {}
    ...
}</pre>

        <p>Or, on a parameter:</p>

        <pre class="programlisting">public class Customer {
    public void updateEmail(
            @RegEx(validation = "(\\w+\\.)*\\w+@(\\w+\\.)+[A-Za-z]+")
            @Named("Email") String email) {
        ...
    }
    ...
)</pre>

        <p>Or, on a value type:</p>

        <pre class="programlisting">@Value(...)
@RegEx(validation = "(\\w+\\.)*\\w+@(\\w+\\.)+[A-Za-z]+")
public class EmailAddress {
   ...
y}</pre>
      </div>

      <div class="sect1" title="@Resolve"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e3227"></a>@Resolve</h2></div></div></div>
        

        <p>The <code class="classname">@Resolve</code> annotation is a hint for
        properties and collections to indicate that a value property should be
        resolved lazily (rather than eagerly, as usual), or that a reference
        property or collection should be resolved eagerly (rather than lazily,
        as usual).</p>

        <p>Viewers can use this to present the property/collection in an
        appropriate manner:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>an <code class="classname">Order</code>'s
            <code class="methodname">lineItems</code> collection might initially be
            rendered expanded form so that the user could see a list of line
            items immediately when the order is rendered.</p>
          </li><li class="listitem">
            <p>a (reference) property of type
            <code class="classname">Address</code> might show the details of the
            referenced <code class="classname">Address</code> in a box</p>
          </li></ul></div>

        <p>At the same time, an object store might use this to defer lazy
        loading of values that represent blobs or clobs.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Order {
    @Resolve(Type.EAGERLY)
    public List&lt;LineItem&gt; getDetails() { ... }

    ...
}</pre>

        <p>For properties and collections there is some similarity between
        this concept and that of eager-loading as supported by some object
        stores. Indeed, some object stores may choose use their own specific
        annotations (eg a JDO default fetch group) in order to infer this
        semantic.</p>
      </div>

      <div class="sect1" title="@Title"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.TitleAnnotation"></a>@Title</h2></div></div></div>
        

        <p>The <code class="literal">@Title</code> annotation is used
        to indicate which property or properties make up the object title. If
        more than one property is used, the order can be specified (using the
        same Dewey-decimal notation as used by
        <code class="classname">@MemberOrder</code>) and the string to use between the
        components can also be specified.</p>

        <p>For example:</p>

        <pre class="programlisting">public void Customer {
    @Title(sequence="1.0")
    public String lastName() { ... }
    ...
    @Title(sequence="1.5", prepend=", ")
    public String firstName() { ... }
    ...
    @Title(sequence="1.7", append=".")
    public String midInitial() { ... }
    ...
}</pre>

        <p>could be used to create names of the style "Bloggs, Joe
        K."</p>

        <p>It is also possible to annotate reference properties; in this
        case the title will return the title of the referenced object (rather
        than, say, its string representation).</p>

        <p>An additional convention for <code class="classname">@Title</code>
        properties is that they are hidden in tables (in other words, it
        implies <code class="code">@Hidden(where=Where.ALL_TABLES)</code>. For viewers that
        support this annotation (for example, the Wicket viewer), this
        convention excludes any properties whose value is already present in
        the title column. This convention can be overridden using
        <code class="code">@Hidden(where=Where.NOWHERE)</code>.</p>
      </div>

      <div class="sect1" title="@TypeOf"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e3258"></a>@TypeOf</h2></div></div></div>
        

        <p>The <code class="literal">@TypeOf</code> annotation is
        used to specify the type of elements in a collection, when for
        whatever reason it is not possible to use generics.</p>

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>Given that Apache Isis only supports Java 1.6 and later, it's
          not that obvious what such a reason might be...</p>
        </div>

        <p>For example:</p>

        <pre class="programlisting">public void AccountService {
    @TypeOf(Customer.class)
    public List errantAccounts() {
        return CustomerDatabase.allNewCustomers();
    }
    ...
}</pre>
      </div>

      <div class="sect1" title="@TypicalLength"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e3266"></a>@TypicalLength</h2></div></div></div>
        

        <p>The <code class="literal">@TypicalLength</code> annotation
        indicates the typical length of a <code class="literal">String</code> property or <code class="literal">String</code> parameter in an action. It can also
        be specified for string-based value types.</p>

        <p>The information is generally used by the viewing mechanism to
        determine the space that should be given to that property or parameter
        in the appropriate view. If the typical length is the same as the
        <code class="literal">@MaxLength</code> (see <a class="xref" href="#sec.MaxLengthAnnotation" title="@MaxLength">the section called &#8220;@MaxLength&#8221;</a>) then there is no need to specify
        <code class="literal">@TypicalLength</code> as well. If the
        value specified is zero or negative then it will be ignored.</p>

        <p>For example, for a property:</p>

        <pre class="programlisting">public class Customer {
    @MaxLength(30)
    @TypicalLength(20)
    public String getFirstName() { ... }
    public void setFirstName(String firstName) { ... }
}</pre>

        <p>Or, for a parameter:</p>

        <pre class="programlisting">public class CustomerRepository {
    public Customer newCustomer(
            @TypicalLength(20)
            @Named("First Name") String firstName
           ,@TypicalLength(20)
            @Named("Last Name") String lastName) {
        ...
    }
    ...
}</pre>

        <p>Or, for value type:</p>

        <pre class="programlisting">@Value(...)
@TypicalLength(20)
public class FirstName {
    ...
}</pre>
      </div>

      <div class="sect1" title="@Value"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.ValueAnnotation"></a>@Value</h2></div></div></div>
        

        <p>The <code class="literal">@Value</code> annotation
        indicates that a class should be treated as a value type rather than
        as a reference (or entity) type. It does this providing an
        implementation of a
        <code class="classname">org.apache.isis.applib.adapters.ValueSemanticsProvider</code>.</p>

        <p>For example:</p>

        <pre class="programlisting">@Value(semanticsProviderClass=ComplexNumberValueSemanticsProvider.class)
public class ComplexNumber {
    ...
}</pre>

        <p>The <code class="classname">ValueSemanticsProvider</code> allows the
        framework to interact with the value, parsing strings and displaying
        as text, and encoding/decoding (for serialization). For more
        information, see <a class="xref" href="#chp.ValueTypes" title="Chapter&nbsp;10.&nbsp;Value Types">Chapter&nbsp;10, <i>Value Types</i></a>.</p>
      </div>

      <div class="sect1" title="@ViewModel"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e3292"></a>@ViewModel</h2></div></div></div>
        

        <p>The <code class="classname">@ViewModel</code> annotation allows the
        developer to declare that a domain object is intended to be used as a
        view model. As such, any changes to its structure are guaranteed to be
        backwardly compatible.</p>

        <p>The annotation was originally introduced to support a
        requirement of the RestfulObjects viewer which directly expose the
        domain objects as RESTful representations</p>

        <p>For example, a domain object that represents a summary of a
        <code class="classname">Customer</code> and their most recent
        <code class="classname">Order</code>s might be annotated as:</p>

        <pre class="programlisting">@NotPersistable
@ViewModel
public class CustomerAndOrdersViewModel {
   ...
}</pre>
      </div>
    </div>

    <div class="appendix" title="Appendix&nbsp;C.&nbsp;DomainObjectContainer interface"><div class="titlepage"><div><div><h2 class="title"><a name="apx.DomainObjectContainer"></a>Appendix&nbsp;C.&nbsp;<code class="classname">DomainObjectContainer</code> interface</h2></div></div></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>Provides a single point of contact from domain objects into the
        <span class="emphasis"><em>Apache Isis</em></span> framework.</p>
      </div>

      <p>The <code class="classname">DomainObjectContainer</code> interface
      provides a single point of contact from domain objects into the
      <span class="emphasis"><em>Isis</em></span> framework. It can also be used as a
      lightweight general purpose repository during prototyping.</p>

      <div class="table"><a name="d5e3310"></a><p class="title"><b>Table&nbsp;C.1.&nbsp;DomainObjectContainer methods (1 of 2)</b></p><div class="table-contents">
        

        <table summary="DomainObjectContainer methods (1 of 2)" border="1"><colgroup><col width="70" align="center"><col width="180" align="left"><col align="left"></colgroup><thead><tr><th align="center">Category</th><th align="center">Method</th><th align="center">Description</th></tr></thead><tbody><tr><td rowspan="3" align="center">Object creation</td><td align="left"><code class="methodname">newTransientInstance(Class&lt;T&gt;)</code></td><td align="left">Creates new non-persisted object</td></tr><tr><td align="left"><code class="methodname">newPersistentInstance(Class&lt;T&gt;)</code></td><td align="left">Creates new object, will be persisted at end of
              action</td></tr><tr><td align="left"><code class="methodname">newInstance(Class&lt;T&gt;,
              Object)</code></td><td align="left">Creates object in state persistence state as that
              provided</td></tr><tr><td rowspan="2" align="center">Validation</td><td align="left"><code class="methodname">isValid(Object)</code></td><td align="left">whether object is valid</td></tr><tr><td align="left"><code class="methodname">validate(Object)</code></td><td align="left">reason why object is invalid (if any)</td></tr><tr><td rowspan="7" align="center">Generic Repository</td><td align="left"><code class="methodname">allInstances(Class&lt;T&gt;)</code></td><td align="left">All persisted instances of specified type</td></tr><tr><td align="left"><code class="methodname">allMatches(Class&lt;T&gt;,
              Filter&lt;T&gt;)</code></td><td align="left">All persistenced instances of specified type matching
              filter</td></tr><tr><td align="left"><code class="methodname">allMatches(Class&lt;T&gt;,
              String)</code></td><td align="left">All persisted instances with the specified string as
              their title</td></tr><tr><td align="left"><code class="methodname">allMatches(Class&lt;T&gt;,
              Object)</code></td><td align="left">All persisted instances matching object
              (query-by-example)</td></tr><tr><td align="left"><code class="methodname">allMatches(Query&lt;T&gt;)</code></td><td align="left">All instances satisfying the provided query</td></tr><tr><td align="left"><code class="methodname">firstMatch(...)</code></td><td align="left">As for <code class="methodname">allMatches(...)</code>, but
              returning first instance</td></tr><tr><td align="left"><code class="methodname">uniqueMatch(...)</code></td><td align="left">As for <code class="methodname">firstMatch(...)</code>, but
              requiring there to be only one match</td></tr></tbody></table>
      </div></div><br class="table-break">

      <div class="table"><a name="d5e3375"></a><p class="title"><b>Table&nbsp;C.2.&nbsp;DomainObjectContainer methods (2 of 2)</b></p><div class="table-contents">
        

        <table summary="DomainObjectContainer methods (2 of 2)" border="1"><colgroup><col width="70" align="center"><col width="180" align="left"><col align="left"></colgroup><thead><tr><th align="center">Category</th><th align="center">Method</th><th align="center">Description</th></tr></thead><tbody><tr><td rowspan="5" align="center">Object persistence</td><td align="left"><code class="methodname">isPersistent(Object)</code></td><td align="left">whether object is persistent</td></tr><tr><td align="left"><code class="methodname">persist(Object)</code></td><td align="left">persist the transient object</td></tr><tr><td align="left"><code class="methodname">persistIfNotAlready(Object)</code></td><td align="left">persist the object (provided is not already
              persisted)</td></tr><tr><td align="left"><code class="methodname">remove(Object)</code></td><td align="left">remove the persisted object</td></tr><tr><td align="left"><code class="methodname">removeIfNotAlready(Object)</code></td><td align="left">remove the object (provided is not already
              transient)</td></tr><tr><td align="center">Presentation</td><td align="left"><code class="methodname">titleOf(Object)</code></td><td align="left">Returns the title of the object.</td></tr><tr><td rowspan="3" align="center">Messages and warnings</td><td align="left"><code class="methodname">informUser(String)</code></td><td align="left">Inform the user</td></tr><tr><td align="left"><code class="methodname">warnUser(String)</code></td><td align="left">Warn the user about a situation, requiring
              acknowledgement.</td></tr><tr><td align="left"><code class="methodname">raiseError(String)</code></td><td align="left">Notify user of a serious application error, typically
              requiring further action on behalf of the user</td></tr><tr><td align="center">Security</td><td align="left"><code class="methodname">getUser()</code></td><td align="left">The currently-logged on user</td></tr><tr><td rowspan="2" align="center">Properties</td><td align="left"><code class="methodname">getProperty(String)</code></td><td align="left">Value of configuration property</td></tr><tr><td align="left"><code class="methodname">getPropertyNames()</code></td><td align="left">All configuration properties available</td></tr><tr><td rowspan="2" align="center">Lazy loading, dirty object tracking
              (*)</td><td align="left"><code class="methodname">resolve(Object)</code></td><td align="left">Lazy load object (overloaded to optionally load a
              property of object)</td></tr><tr><td align="left"><code class="methodname">objectChanged(Object)</code></td><td align="left">Mark object as dirty</td></tr><tr><td rowspan="2" align="center">Object store control (**)</td><td align="left"><code class="methodname">flush()</code></td><td align="left">Flush all pending changes to object store</td></tr><tr><td align="left"><code class="methodname">commit()</code></td><td align="left">Commit all pending changes to object store</td></tr></tbody></table>
      </div></div><br class="table-break">

      <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>(*) generally not necessary to call - performed by bytecode
          proxies</p>
        </div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>(**) the use of these methods is discouraged - they are
          typically used only for tests</p>
        </div>
    </div>

    <div class="appendix" title="Appendix&nbsp;D.&nbsp;Security Classes"><div class="titlepage"><div><div><h2 class="title"><a name="apx.SecurityClasses"></a>Appendix&nbsp;D.&nbsp;Security Classes</h2></div></div></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>A simple set of classes to represent the currently logged on
        user and their roles.</p>
      </div>

      <p>When the user logs onto an Isis application, the framework
      constructs a representation of their user and roles using classes from
      the applib. This allows the application to inspect and act upon those
      details if required.</p>

      <p>The user details are captured in the
      <code class="classname">org.apache.isis.applib.security.UserMemento</code> class
      ("memento" because it is a snapshot of their credentials at the point of
      logging on). The <code class="classname">UserMemento</code> class defines the
      following properties:</p>

      <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
          <p><code class="varname">name</code> (a
          <code class="classname">String</code>)</p>
        </li><li class="listitem">
          <p>collection of roles (as
          <code class="classname">RoleMemento</code>)</p>
        </li></ul></div>

      <p>The org.apache.isis.applib.security.RoleMemento class in turn
      defines two properties:</p>

      <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
          <p><code class="varname">name</code> (a
          <code class="classname">String</code>)</p>
        </li><li class="listitem">
          <p><code class="varname">description</code> (a
          <code class="classname">String</code>)</p>
        </li></ul></div>

      <p>To obtain the current user, the application can call
      <code class="methodname">DomainObjectContainer#getUser()</code>. For more on
      the <code class="classname">DomainObjectContainer</code>, see <a class="xref" href="#apx.DomainObjectContainer" title="Appendix&nbsp;C.&nbsp;DomainObjectContainer interface">Appendix&nbsp;C, <i><code class="classname">DomainObjectContainer</code> interface</i></a>.</p>
    </div>

    <div class="appendix" title="Appendix&nbsp;E.&nbsp;Utility Classes"><div class="titlepage"><div><div><h2 class="title"><a name="apx.UtilityClasses"></a>Appendix&nbsp;E.&nbsp;Utility Classes</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d5e3499">Title creation</a></span></dt><dt><span class="sect1"><a href="#d5e3506">Reason text creation (for disable and validate methods)</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>Simple utility classes for domain objects.</p>
      </div>

      <p>The <span class="package">org.apache.isis.applib.util</span> package has a
      number of simple utility classes designed to simplify the coding of some
      common tasks.</p>

      <div class="sect1" title="Title creation"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e3499"></a>Title creation</h2></div></div></div>
        

        <p>The <code class="classname">TitleBuffer</code> utility class is intended
        to make it easy to construct title strings (returned from the
        <code class="methodname">title()</code> method). For example, it has
        overloaded versions of methods called
        <code class="methodname">append()</code> and
        <code class="methodname">concat()</code>.</p>
      </div>

      <div class="sect1" title="Reason text creation (for disable and validate methods)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e3506"></a>Reason text creation (for disable and validate methods)</h2></div></div></div>
        

        <p>There are two different classes provided to help build reasons
        returned by <code class="methodname">disableXxX()</code> and
        <code class="methodname">validateXxx()</code> methods:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>the
            <code class="classname">org.apache.isis.applib.util.ReasonBuffer</code>
            helper class</p>
          </li><li class="listitem">
            <p>the
            <code class="classname">org.apache.isis.applib.util.Reasons</code> helper
            class</p>
          </li></ul></div>

        <p>For example:</p>

        <pre class="programlisting">public class Customer {
    ...
    public String validatePlaceOrder(Product p, int quantity) {
        return Reasons.coalesce(
            whetherCustomerBlacklisted(this),
            whetherProductOutOfStock(p)
        );
    }
}</pre>

        <p>Which you use (if any) is up to you.</p>
      </div>
    </div>

    <div class="appendix" title="Appendix&nbsp;F.&nbsp;Events"><div class="titlepage"><div><div><h2 class="title"><a name="d5e3521"></a>Appendix&nbsp;F.&nbsp;Events</h2></div></div></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>The <code class="classname">InteractionEvent</code> hierarchy.</p>
      </div>

      <p>Although not supported by the default programming model, the
      applib nevertheless defines an event hierarchy that characterizes all of
      the different types of interactions that can occur. This is used by the
      wrapper programming model, and is exploited by the JUnit viewer.</p>

      <p>The following <acronym class="acronym">UML</acronym> class diagram shows the
      hierarchy of events:</p>

      <div class="mediaobject"><img src="images/Events.png" width="162"></div>
    </div>

    <div class="appendix" title="Appendix&nbsp;G.&nbsp;Package Dependencies"><div class="titlepage"><div><div><h2 class="title"><a name="d5e3532"></a>Appendix&nbsp;G.&nbsp;Package Dependencies</h2></div></div></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>The dependencies between the packages.</p>
      </div>

      <p>The following diagram shows that the relationship between the
      different packages that make up the applib (note that there are no
      cyclic dependencies between the packages):</p>

      <div class="mediaobject"><img src="images/composition-perspective.png" width="378"></div>

      <p>The following diagram shows the same packages, but from a layered,
      architecture perspective:</p>

      <div class="mediaobject"><img src="images/architecture-perspective.png" width="378"></div>
    </div>
  </div>
</div></body></html>