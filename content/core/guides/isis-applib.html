<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Apache Isis Application Library</title><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book" title="Apache Isis Application Library"><div class="titlepage"><div><div><h1 class="title"><a name="d5e1"></a>Apache Isis Application Library</h1></div><div><h2 class="subtitle">Developing domain driven applications using Apache Isis</h2></div><div><div class="authorgroup">
      <div class="author"><h3 class="author"><span class="firstname">Dan</span> <span class="surname">Haywood</span></h3></div>

      <div class="author"><h3 class="author"><span class="firstname">Robert</span> <span class="surname">Matthews</span></h3></div>
    </div></div><div><p class="releaseinfo">1.0.0-SNAPSHOT</p></div><div><div class="legalnotice" title="Legal Notice"><a name="d5e13"></a>
      <p>Permission is granted to make and distribute verbatim copies of
      this manual provided that the copyright notice and this permission
      notice are preserved on all copies.</p>
    </div></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dt><span class="part"><a href="#prt.WritingDomainObjects">I. Writing Domain Objects</a></span></dt><dd><dl><dt><span class="chapter"><a href="#chp.Objects">1. How to write a basic Domain Entity or Service</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e44">How to have a domain entity be a POJO (not inherit from
        framework superclasses)</a></span></dt><dt><span class="sect1"><a href="#sec.AbstractService">How to have a domain service be a POJO (not inherit from
        framework superclasses)</a></span></dt><dt><span class="sect1"><a href="#d5e71">How to add a property to a domain entity</a></span></dt><dt><span class="sect1"><a href="#d5e91">How to add a collection to a domain entity</a></span></dt><dt><span class="sect1"><a href="#d5e119">How to add an action to a domain entity or service</a></span></dt><dt><span class="sect1"><a href="#d5e150">How to specify a title for a domain
        entity</a></span></dt><dt><span class="sect1"><a href="#sec.HowToSpecifyTheIconForAnObjectsClass">How to specify the icon for a domain
        entity</a></span></dt><dt><span class="sect1"><a href="#sec.MemberOrderForProperties">How to specify the order in which properties or collections are
        displayed</a></span></dt><dt><span class="sect1"><a href="#d5e200">How to specify the order in which actions appear on the
        menu</a></span></dt><dt><span class="sect1"><a href="#d5e209">How to make a property optional (when saving an object)</a></span></dt><dt><span class="sect1"><a href="#d5e214">How to make an action parameter optional</a></span></dt><dt><span class="sect1"><a href="#sec.SizeProperties">How to specify the size of <code class="classname">String</code>
        properties</a></span></dt><dt><span class="sect1"><a href="#d5e236">How to specify the size of <code class="classname">String</code> action
        parameters</a></span></dt><dt><span class="sect1"><a href="#sec.ActionParameterNames">How to specify names and/or descriptions for an action
        parameter</a></span></dt><dt><span class="sect1"><a href="#d5e266">How to inject services into a domain entity or other
        service</a></span></dt><dt><span class="sect1"><a href="#sec.HowToCreateAnObject">How to create or delete objects within your code</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.Properties">2. How to add business rules</a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.HiddenProperty">How to hide a property</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e350">Hiding a property always</a></span></dt><dt><span class="sect2"><a href="#d5e356">Hiding a property based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e367">Hiding a property under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e378">Hiding a property for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.HiddenCollection">How to hide a collection</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e388">Hiding a collection permanently</a></span></dt><dt><span class="sect2"><a href="#d5e394">Hiding a collection based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e405">Hiding a collection under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e416">Hiding a collection for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.HiddenActions">How to hide an action</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e426">Hiding an action permanently</a></span></dt><dt><span class="sect2"><a href="#d5e433">Hiding an action based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e444">Hiding an action under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e455">Hiding an action for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.Entity.Hidden">How to specify that none of an object's members is
        visible</a></span></dt><dt><span class="sect1"><a href="#sec.DisabledProperty">How to prevent a property from being modified</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e474">Disabling a property permanently</a></span></dt><dt><span class="sect2"><a href="#d5e481">Disabling a property based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e492">Disabling a property under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e505">Disabling a property for certain users/roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DisabledCollection">How to prevent a collection from being modified</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e516">Disabling a collection permanently</a></span></dt><dt><span class="sect2"><a href="#d5e525">Disabling a collection based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e536">Disabling a collection under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e545">Disabling a collection for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DisabledAction">How to prevent an action from being invoked</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e556">Disabling an action permanently</a></span></dt><dt><span class="sect2"><a href="#d5e560">Disabling an action based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e572">Based on the state of the object</a></span></dt><dt><span class="sect2"><a href="#d5e584">Disabling an action for certain users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.Entity.Disabled">How to specify that none of an object's members can be
        modified/invoked</a></span></dt><dt><span class="sect1"><a href="#sec.Immutable">How to specify that an object is
        immutable (that none of its members can ever be modified)</a></span></dt><dt><span class="sect1"><a href="#d5e614">How to validate user input for a property</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e616">Declarative validation</a></span></dt><dt><span class="sect2"><a href="#d5e631">Imperative validation</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e644">How to validate an object being added or removed from a
        collection</a></span></dt><dt><span class="sect1"><a href="#d5e659">How to validate an action parameter argument</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e661">Declarative validation</a></span></dt><dt><span class="sect2"><a href="#d5e676">Imperative validation</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.MustSpecify">How to validate declaratively using @MustSatisfy</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d5e722">3. How to provide drop-downs and default values</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e728">How to specify a set of choices for a property</a></span></dt><dt><span class="sect1"><a href="#d5e745">How to specify a set of choices for an action parameter</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e751">Per parameter syntax (preferred)</a></span></dt><dt><span class="sect2"><a href="#d5e759">All parameters syntax</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.Bounded">How to specify that a class of objects has a limited number of
        instances</a></span></dt><dt><span class="sect1"><a href="#d5e779">How to find an entity (for an action parameter or property)
        using auto-complete</a></span></dt><dt><span class="sect1"><a href="#d5e791">How to specify default values for an action parameter</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e795">Per-parameter syntax (preferred)</a></span></dt><dt><span class="sect2"><a href="#d5e802">All parameters syntax</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#d5e810">4. How to derive properties and collections, and other
      side-effects</a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.DerivedProperty">How to make a derived property</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e818">Read-only</a></span></dt><dt><span class="sect2"><a href="#d5e825">Read-write</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DerivedCollection">How to make a derived collection</a></span></dt><dt><span class="sect1"><a href="#d5e849">How to inline the results of a query-only repository
        action</a></span></dt><dt><span class="sect1"><a href="#sec.ModifyAndClear">How to trigger other behaviour when a property is
        changed</a></span></dt><dt><span class="sect1"><a href="#sec.AddToRemoveFrom">How to trigger other behaviour when an object is added or
        removed</a></span></dt><dt><span class="sect1"><a href="#sec.MutualRegistrationPattern">How to set up and maintain bidirectional relationships</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d5e919">5. How to provide additional UI hints</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e927">How to specify a name and/or description for an
        object</a></span></dt><dt><span class="sect1"><a href="#d5e939">How to specify a name and/or description for a property</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e941">Specifying the name for a property</a></span></dt><dt><span class="sect2"><a href="#d5e947">Specifying a description for a property</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e953">How to specify a name and/or description for a
        collection</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e955">Specifying the name for a collection</a></span></dt><dt><span class="sect2"><a href="#d5e961">Specifying a description for a collection</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e967">How to specify names and/or description for an action</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e969">Specifying the name for an action</a></span></dt><dt><span class="sect2"><a href="#d5e975">Specifying a description for a collection</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e981">How to specify the icon for an individual object's
        state</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d5e992">6. How to deal with errors</a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.passMessagesAndErrors">How to pass a messages and errors back to the user</a></span></dt><dt><span class="sect1"><a href="#d5e1017">How to deal with an unexpected error</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d5e1024">7. How to handle entity persistence lifecycle</a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.DefaultPropertyValue">How to set up the initial value of a property
        programmatically</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1033">By each property's default values</a></span></dt><dt><span class="sect2"><a href="#d5e1042">By the <code class="methodname">created()</code> lifecycle
          method</a></span></dt><dt><span class="sect2"><a href="#d5e1049">Programmatically, by the creator</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.LifecycleMethods">How to insert behaviour into the object life cycle</a></span></dt><dt><span class="sect1"><a href="#d5e1114">How to ensure object is in valid state</a></span></dt><dt><span class="sect1"><a href="#d5e1133">How to specify that an object should not be
        persisted</a></span></dt><dt><span class="sect1"><a href="#sec.ResolveAndObjectChanged">How to perform lazy loading (generally done
        automatically)</a></span></dt><dt><span class="sect1"><a href="#d5e1150">How to perform dirty object tracking (generally done
        automatically)</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d5e1159">8. How to handle security concerns</a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.BusinessRulesForCertainUsersOrRoles">Hiding, disabling or validating for specific users or
        roles</a></span></dt><dt><span class="sect1"><a href="#d5e1180">How to use Isis' authorization manager</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.DomainServices">9. Domain Services, Repositories and Factories</a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.Services">How to register domain services, repositories and
        factories</a></span></dt><dt><span class="sect1"><a href="#d5e1208">How to write a typical domain service</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1215">The <code class="methodname">getId()</code> method</a></span></dt><dt><span class="sect2"><a href="#d5e1223">(Suppressing) contributed actions</a></span></dt><dt><span class="sect2"><a href="#d5e1245">(Suppressing) service menu items</a></span></dt><dt><span class="sect2"><a href="#d5e1254">(Suppressing) service menus</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1259">How to use a generic repository</a></span></dt><dt><span class="sect1"><a href="#sec.CustomRepository">How to write a custom repository</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1307">Finding by Title</a></span></dt><dt><span class="sect2"><a href="#d5e1323">Finding by Pattern</a></span></dt><dt><span class="sect2"><a href="#d5e1345">Finding using the <code class="classname">Filter</code> API</a></span></dt><dt><span class="sect2"><a href="#d5e1368">Finding using the <code class="classname">Query</code> API</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1412">Factories</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.ValueTypes">10. Value Types</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e1454">Built-in Value Types</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1458">JDK Types</a></span></dt><dt><span class="sect2"><a href="#d5e1536">Value formats</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1633">Custom Value Types</a></span></dt><dt><span class="sect1"><a href="#d5e1672">Third-party Value Types</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#prt.SupportingFeatures">II. Supporting Features</a></span></dt><dd><dl><dt><span class="chapter"><a href="#chp.Clock">11. Clock</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e1703">Lazily Instantiated</a></span></dt><dt><span class="sect1"><a href="#d5e1712">Possibly Replaceable</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.UserProfiles">12. Profiles</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e1726">Profiles and Perspectives</a></span></dt><dt><span class="sect1"><a href="#d5e1749">Runtime and Viewer Support</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.Fixtures">13. Fixtures and SwitchUser</a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.HowToRegisterFixtures">How to register fixtures</a></span></dt><dt><span class="sect1"><a href="#d5e1780">How to write custom fixtures</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1786"><code class="classname">InstallableFixture</code> and
          <code class="classname">FixtureType</code></a></span></dt><dt><span class="sect2"><a href="#d5e1806"><code class="classname">BaseFixture</code> and
          <code class="classname">AbstractFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e1839"><code class="methodname">DateFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e1850"><code class="methodname">SwitchUserFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e1870"><code class="classname">LogonFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e1877"><code class="classname">UserProfileFixture</code></a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#chp.XmlSnapshots">14. XML Snapshots</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e1907">Generating an XML Snapshot</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1911">Basic Usage</a></span></dt><dt><span class="sect2"><a href="#d5e1920">Including other Elements</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1936">Using the Fluent API</a></span></dt><dt><span class="sect1"><a href="#d5e1941">The <code class="classname">SnapshottableWithInclusions</code>
        interface</a></span></dt><dt><span class="sect1"><a href="#d5e1950">Generating an XSD schema</a></span></dt><dt><span class="sect1"><a href="#d5e1957">Hints and Tips</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#prt.ReferenceAppendices">III. Reference Appendices</a></span></dt><dd><dl><dt><span class="appendix"><a href="#d5e1969">A. Recognized Methods and Prefixes</a></span></dt><dt><span class="appendix"><a href="#d5e2241">B. Recognized Annotations</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e2248">@ActionOrder</a></span></dt><dt><span class="sect1"><a href="#d5e2267">@ActionSemantics</a></span></dt><dt><span class="sect1"><a href="#d5e2277">@AutoComplete</a></span></dt><dt><span class="sect1"><a href="#d5e2286">@Aggregated</a></span></dt><dt><span class="sect1"><a href="#d5e2294">@Bounded</a></span></dt><dt><span class="sect1"><a href="#sec.DebugAnnotation">@Debug</a></span></dt><dt><span class="sect1"><a href="#d5e2313">@Defaulted</a></span></dt><dt><span class="sect1"><a href="#d5e2323">@DescribedAs</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2331">Providing a description for an object</a></span></dt><dt><span class="sect2"><a href="#d5e2337">Providing a description for an object member</a></span></dt><dt><span class="sect2"><a href="#d5e2343">Providing a description for an action parameter</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e2349">@Disabled</a></span></dt><dt><span class="sect1"><a href="#d5e2418">@Encodable</a></span></dt><dt><span class="sect1"><a href="#d5e2428">@EqualByContent</a></span></dt><dt><span class="sect1"><a href="#d5e2437">@Executed</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2443">Forcing a method to be executed on the client</a></span></dt><dt><span class="sect2"><a href="#d5e2447">Forcing a method to be executed on the server</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.ExplorationAnnotation">@Exploration</a></span></dt><dt><span class="sect1"><a href="#d5e2462">@Facets</a></span></dt><dt><span class="sect1"><a href="#d5e2471">@FieldOrder</a></span></dt><dt><span class="sect1"><a href="#sec.HiddenAnnotation">@Hidden</a></span></dt><dt><span class="sect1"><a href="#d5e2555">@Idempotent (deprecated)</a></span></dt><dt><span class="sect1"><a href="#d5e2559">@Ignore (deprecated)</a></span></dt><dt><span class="sect1"><a href="#d5e2566">@Immutable</a></span></dt><dt><span class="sect1"><a href="#sec.MaskAnnotation">@Mask</a></span></dt><dt><span class="sect1"><a href="#sec.MaxLengthAnnotation">@MaxLength</a></span></dt><dt><span class="sect1"><a href="#sec.MemberGroupsAnnotation">@MemberGroups</a></span></dt><dt><span class="sect1"><a href="#sec.MemberOrderAnnotation">@MemberOrder</a></span></dt><dt><span class="sect1"><a href="#d5e2657">@MultiLine</a></span></dt><dt><span class="sect1"><a href="#d5e2688">@MustSatisfy</a></span></dt><dt><span class="sect1"><a href="#sec.NamedAnnotation">@Named</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2712">Specifying the name of an object</a></span></dt><dt><span class="sect2"><a href="#d5e2721">Specifying the name of a class member</a></span></dt><dt><span class="sect2"><a href="#d5e2730">Specifying the name for an action parameter</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.NotContributedAnnotation">@NotContributed</a></span></dt><dt><span class="sect1"><a href="#sec.NotInServiceMenuAnnotation">@NotInServiceMenu</a></span></dt><dt><span class="sect1"><a href="#not-persistable">@NotPersistable</a></span></dt><dt><span class="sect1"><a href="#d5e2781">@NotPersisted</a></span></dt><dt><span class="sect1"><a href="#d5e2789">@ObjectType</a></span></dt><dt><span class="sect1"><a href="#d5e2799">@Optional</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2808">Making a property optional</a></span></dt><dt><span class="sect2"><a href="#d5e2817">Making an action parameter optional</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e2822">@Paged</a></span></dt><dt><span class="sect1"><a href="#d5e2837">@Parseable</a></span></dt><dt><span class="sect1"><a href="#sec.PluralAnnotation">@Plural</a></span></dt><dt><span class="sect1"><a href="#d5e2857">@Programmatic</a></span></dt><dt><span class="sect1"><a href="#sec.PrototypeAnnotation">@Prototype</a></span></dt><dt><span class="sect1"><a href="#d5e2879">@QueryOnly (deprecated)</a></span></dt><dt><span class="sect1"><a href="#sec.RegExAnnotation">@RegEx</a></span></dt><dt><span class="sect1"><a href="#d5e2900">@Resolve</a></span></dt><dt><span class="sect1"><a href="#sec.TitleAnnotation">@Title</a></span></dt><dt><span class="sect1"><a href="#d5e2931">@TypeOf</a></span></dt><dt><span class="sect1"><a href="#d5e2939">@TypicalLength</a></span></dt><dt><span class="sect1"><a href="#sec.ValueAnnotation">@Value</a></span></dt><dt><span class="sect1"><a href="#d5e2965">@ViewModel</a></span></dt></dl></dd><dt><span class="appendix"><a href="#apx.DomainObjectContainer">C. <code class="classname">DomainObjectContainer</code> interface</a></span></dt><dt><span class="appendix"><a href="#apx.SecurityClasses">D. Security Classes</a></span></dt><dt><span class="appendix"><a href="#apx.UtilityClasses">E. Utility Classes</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e3172">Title creation</a></span></dt><dt><span class="sect1"><a href="#d5e3179">Reason text creation (for disable and validate methods)</a></span></dt></dl></dd><dt><span class="appendix"><a href="#d5e3194">F. Events</a></span></dt><dt><span class="appendix"><a href="#d5e3205">G. Package Dependencies</a></span></dt></dl></dd></dl></div><div class="list-of-tables"><p><b>List of Tables</b></p><dl><dt>7.1. <a href="#d5e1063">Object lifecycle methods</a></dt><dt>A.1. <a href="#d5e1973">Recognized Method Prefixes</a></dt><dt>A.2. <a href="#d5e2186">Deprecated Method Prefixes</a></dt><dt>C.1. <a href="#d5e2983">DomainObjectContainer methods (1 of 2)</a></dt><dt>C.2. <a href="#d5e3048">DomainObjectContainer methods (2 of 2)</a></dt></dl></div>
  

  

  

  <div class="preface" title="Preface"><div class="titlepage"><div><div><h2 class="title"><a name="preface"></a>Preface</h2></div></div></div>
    

    <p><span class="emphasis"><em>Apache Isis</em></span> is designed to allow programmers
    rapidly develop domain-driven applications following the <a class="ulink" href="http://en.wikipedia.org/wiki/Naked_Objects" target="_top">Naked Objects</a>
    pattern. It is made up of a core plus a number of components for each of
    the main APIs: objectstores, security, viewers and profilestores.</p>

    <p>This guide is written for programmers looking to understand the
    programming conventions, annotations and supporting utilities within the
    <span class="emphasis"><em>Apache Isis</em></span> application library (or
    <span class="emphasis"><em>applib</em></span>), in order that the framework can correctly
    pick up and render the business rules and logic encoded within their
    domain objects.</p>

    <p><span class="emphasis"><em>Apache Isis</em></span> is hosted at the <a class="ulink" href="http://incubator.apache.org/isis" target="_top">Apache Foundation</a>, and is
    licensed under <a class="ulink" href="http://www.apache.org/licenses/LICENSE-2.0.html" target="_top">Apache Software
    License v2</a>.</p>
  </div>

  

  <div class="part" title="Part&nbsp;I.&nbsp;Writing Domain Objects"><div class="titlepage"><div><div><h1 class="title"><a name="prt.WritingDomainObjects"></a>Part&nbsp;I.&nbsp;Writing Domain Objects</h1></div></div></div>
    

    <div class="partintro" title="Writing Domain Objects"><div></div>
      <p>The conventions of the programming model are best described as
      'intentional' - they convey an intention as to how domain objects, their
      properties and behaviours, are to be made available to users. The
      specific way in which those intentions are interpreted or implemented
      will depend upon the framework, and/or the particular components or
      options selected within that framework.</p>

      <p>To pick a single example, marking up a domain class with the
      annotation <code class="code">@Bounded</code> is an indication that the class is
      intended to have only a small number of instances and that the set does
      not change very often - such as the class <code class="code">Country</code>. This is
      an indication to a viewer, for example, that the whole set of instances
      might be offered to the user in a convenient form such as a drop-down
      list. The programming convention has <span class="emphasis"><em>not</em></span> been
      defined as <code class="code">@DropDownList</code> because any equivalent mechanism
      will suffice: a viewer might not support drop-down-lists but instead
      might provide a capability to select from an <code class="code">@Bounded</code> class
      by typing the initial letters of the desired instance.</p>

      <p>This part of the guide is a set of chapters that provides how-to's
      for writing domain objects, by which we mean domain entities, value
      types, services and repositories/factories.</p>
    <div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="chapter"><a href="#chp.Objects">1. How to write a basic Domain Entity or Service</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e44">How to have a domain entity be a POJO (not inherit from
        framework superclasses)</a></span></dt><dt><span class="sect1"><a href="#sec.AbstractService">How to have a domain service be a POJO (not inherit from
        framework superclasses)</a></span></dt><dt><span class="sect1"><a href="#d5e71">How to add a property to a domain entity</a></span></dt><dt><span class="sect1"><a href="#d5e91">How to add a collection to a domain entity</a></span></dt><dt><span class="sect1"><a href="#d5e119">How to add an action to a domain entity or service</a></span></dt><dt><span class="sect1"><a href="#d5e150">How to specify a title for a domain
        entity</a></span></dt><dt><span class="sect1"><a href="#sec.HowToSpecifyTheIconForAnObjectsClass">How to specify the icon for a domain
        entity</a></span></dt><dt><span class="sect1"><a href="#sec.MemberOrderForProperties">How to specify the order in which properties or collections are
        displayed</a></span></dt><dt><span class="sect1"><a href="#d5e200">How to specify the order in which actions appear on the
        menu</a></span></dt><dt><span class="sect1"><a href="#d5e209">How to make a property optional (when saving an object)</a></span></dt><dt><span class="sect1"><a href="#d5e214">How to make an action parameter optional</a></span></dt><dt><span class="sect1"><a href="#sec.SizeProperties">How to specify the size of <code class="classname">String</code>
        properties</a></span></dt><dt><span class="sect1"><a href="#d5e236">How to specify the size of <code class="classname">String</code> action
        parameters</a></span></dt><dt><span class="sect1"><a href="#sec.ActionParameterNames">How to specify names and/or descriptions for an action
        parameter</a></span></dt><dt><span class="sect1"><a href="#d5e266">How to inject services into a domain entity or other
        service</a></span></dt><dt><span class="sect1"><a href="#sec.HowToCreateAnObject">How to create or delete objects within your code</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.Properties">2. How to add business rules</a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.HiddenProperty">How to hide a property</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e350">Hiding a property always</a></span></dt><dt><span class="sect2"><a href="#d5e356">Hiding a property based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e367">Hiding a property under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e378">Hiding a property for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.HiddenCollection">How to hide a collection</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e388">Hiding a collection permanently</a></span></dt><dt><span class="sect2"><a href="#d5e394">Hiding a collection based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e405">Hiding a collection under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e416">Hiding a collection for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.HiddenActions">How to hide an action</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e426">Hiding an action permanently</a></span></dt><dt><span class="sect2"><a href="#d5e433">Hiding an action based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e444">Hiding an action under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e455">Hiding an action for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.Entity.Hidden">How to specify that none of an object's members is
        visible</a></span></dt><dt><span class="sect1"><a href="#sec.DisabledProperty">How to prevent a property from being modified</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e474">Disabling a property permanently</a></span></dt><dt><span class="sect2"><a href="#d5e481">Disabling a property based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e492">Disabling a property under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e505">Disabling a property for certain users/roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DisabledCollection">How to prevent a collection from being modified</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e516">Disabling a collection permanently</a></span></dt><dt><span class="sect2"><a href="#d5e525">Disabling a collection based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e536">Disabling a collection under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e545">Disabling a collection for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DisabledAction">How to prevent an action from being invoked</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e556">Disabling an action permanently</a></span></dt><dt><span class="sect2"><a href="#d5e560">Disabling an action based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e572">Based on the state of the object</a></span></dt><dt><span class="sect2"><a href="#d5e584">Disabling an action for certain users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.Entity.Disabled">How to specify that none of an object's members can be
        modified/invoked</a></span></dt><dt><span class="sect1"><a href="#sec.Immutable">How to specify that an object is
        immutable (that none of its members can ever be modified)</a></span></dt><dt><span class="sect1"><a href="#d5e614">How to validate user input for a property</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e616">Declarative validation</a></span></dt><dt><span class="sect2"><a href="#d5e631">Imperative validation</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e644">How to validate an object being added or removed from a
        collection</a></span></dt><dt><span class="sect1"><a href="#d5e659">How to validate an action parameter argument</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e661">Declarative validation</a></span></dt><dt><span class="sect2"><a href="#d5e676">Imperative validation</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.MustSpecify">How to validate declaratively using @MustSatisfy</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d5e722">3. How to provide drop-downs and default values</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e728">How to specify a set of choices for a property</a></span></dt><dt><span class="sect1"><a href="#d5e745">How to specify a set of choices for an action parameter</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e751">Per parameter syntax (preferred)</a></span></dt><dt><span class="sect2"><a href="#d5e759">All parameters syntax</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.Bounded">How to specify that a class of objects has a limited number of
        instances</a></span></dt><dt><span class="sect1"><a href="#d5e779">How to find an entity (for an action parameter or property)
        using auto-complete</a></span></dt><dt><span class="sect1"><a href="#d5e791">How to specify default values for an action parameter</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e795">Per-parameter syntax (preferred)</a></span></dt><dt><span class="sect2"><a href="#d5e802">All parameters syntax</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#d5e810">4. How to derive properties and collections, and other
      side-effects</a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.DerivedProperty">How to make a derived property</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e818">Read-only</a></span></dt><dt><span class="sect2"><a href="#d5e825">Read-write</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DerivedCollection">How to make a derived collection</a></span></dt><dt><span class="sect1"><a href="#d5e849">How to inline the results of a query-only repository
        action</a></span></dt><dt><span class="sect1"><a href="#sec.ModifyAndClear">How to trigger other behaviour when a property is
        changed</a></span></dt><dt><span class="sect1"><a href="#sec.AddToRemoveFrom">How to trigger other behaviour when an object is added or
        removed</a></span></dt><dt><span class="sect1"><a href="#sec.MutualRegistrationPattern">How to set up and maintain bidirectional relationships</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d5e919">5. How to provide additional UI hints</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e927">How to specify a name and/or description for an
        object</a></span></dt><dt><span class="sect1"><a href="#d5e939">How to specify a name and/or description for a property</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e941">Specifying the name for a property</a></span></dt><dt><span class="sect2"><a href="#d5e947">Specifying a description for a property</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e953">How to specify a name and/or description for a
        collection</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e955">Specifying the name for a collection</a></span></dt><dt><span class="sect2"><a href="#d5e961">Specifying a description for a collection</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e967">How to specify names and/or description for an action</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e969">Specifying the name for an action</a></span></dt><dt><span class="sect2"><a href="#d5e975">Specifying a description for a collection</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e981">How to specify the icon for an individual object's
        state</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d5e992">6. How to deal with errors</a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.passMessagesAndErrors">How to pass a messages and errors back to the user</a></span></dt><dt><span class="sect1"><a href="#d5e1017">How to deal with an unexpected error</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d5e1024">7. How to handle entity persistence lifecycle</a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.DefaultPropertyValue">How to set up the initial value of a property
        programmatically</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1033">By each property's default values</a></span></dt><dt><span class="sect2"><a href="#d5e1042">By the <code class="methodname">created()</code> lifecycle
          method</a></span></dt><dt><span class="sect2"><a href="#d5e1049">Programmatically, by the creator</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.LifecycleMethods">How to insert behaviour into the object life cycle</a></span></dt><dt><span class="sect1"><a href="#d5e1114">How to ensure object is in valid state</a></span></dt><dt><span class="sect1"><a href="#d5e1133">How to specify that an object should not be
        persisted</a></span></dt><dt><span class="sect1"><a href="#sec.ResolveAndObjectChanged">How to perform lazy loading (generally done
        automatically)</a></span></dt><dt><span class="sect1"><a href="#d5e1150">How to perform dirty object tracking (generally done
        automatically)</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d5e1159">8. How to handle security concerns</a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.BusinessRulesForCertainUsersOrRoles">Hiding, disabling or validating for specific users or
        roles</a></span></dt><dt><span class="sect1"><a href="#d5e1180">How to use Isis' authorization manager</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.DomainServices">9. Domain Services, Repositories and Factories</a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.Services">How to register domain services, repositories and
        factories</a></span></dt><dt><span class="sect1"><a href="#d5e1208">How to write a typical domain service</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1215">The <code class="methodname">getId()</code> method</a></span></dt><dt><span class="sect2"><a href="#d5e1223">(Suppressing) contributed actions</a></span></dt><dt><span class="sect2"><a href="#d5e1245">(Suppressing) service menu items</a></span></dt><dt><span class="sect2"><a href="#d5e1254">(Suppressing) service menus</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1259">How to use a generic repository</a></span></dt><dt><span class="sect1"><a href="#sec.CustomRepository">How to write a custom repository</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1307">Finding by Title</a></span></dt><dt><span class="sect2"><a href="#d5e1323">Finding by Pattern</a></span></dt><dt><span class="sect2"><a href="#d5e1345">Finding using the <code class="classname">Filter</code> API</a></span></dt><dt><span class="sect2"><a href="#d5e1368">Finding using the <code class="classname">Query</code> API</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1412">Factories</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.ValueTypes">10. Value Types</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e1454">Built-in Value Types</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1458">JDK Types</a></span></dt><dt><span class="sect2"><a href="#d5e1536">Value formats</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1633">Custom Value Types</a></span></dt><dt><span class="sect1"><a href="#d5e1672">Third-party Value Types</a></span></dt></dl></dd></dl></div></div>

    <div class="chapter" title="Chapter&nbsp;1.&nbsp;How to write a basic Domain Entity or Service"><div class="titlepage"><div><div><h2 class="title"><a name="chp.Objects"></a>Chapter&nbsp;1.&nbsp;How to write a basic Domain Entity or Service</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d5e44">How to have a domain entity be a POJO (not inherit from
        framework superclasses)</a></span></dt><dt><span class="sect1"><a href="#sec.AbstractService">How to have a domain service be a POJO (not inherit from
        framework superclasses)</a></span></dt><dt><span class="sect1"><a href="#d5e71">How to add a property to a domain entity</a></span></dt><dt><span class="sect1"><a href="#d5e91">How to add a collection to a domain entity</a></span></dt><dt><span class="sect1"><a href="#d5e119">How to add an action to a domain entity or service</a></span></dt><dt><span class="sect1"><a href="#d5e150">How to specify a title for a domain
        entity</a></span></dt><dt><span class="sect1"><a href="#sec.HowToSpecifyTheIconForAnObjectsClass">How to specify the icon for a domain
        entity</a></span></dt><dt><span class="sect1"><a href="#sec.MemberOrderForProperties">How to specify the order in which properties or collections are
        displayed</a></span></dt><dt><span class="sect1"><a href="#d5e200">How to specify the order in which actions appear on the
        menu</a></span></dt><dt><span class="sect1"><a href="#d5e209">How to make a property optional (when saving an object)</a></span></dt><dt><span class="sect1"><a href="#d5e214">How to make an action parameter optional</a></span></dt><dt><span class="sect1"><a href="#sec.SizeProperties">How to specify the size of <code class="classname">String</code>
        properties</a></span></dt><dt><span class="sect1"><a href="#d5e236">How to specify the size of <code class="classname">String</code> action
        parameters</a></span></dt><dt><span class="sect1"><a href="#sec.ActionParameterNames">How to specify names and/or descriptions for an action
        parameter</a></span></dt><dt><span class="sect1"><a href="#d5e266">How to inject services into a domain entity or other
        service</a></span></dt><dt><span class="sect1"><a href="#sec.HowToCreateAnObject">How to create or delete objects within your code</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>How-to write a basic domain entity or service, specifying its
        properties, collections and actions, and using some of the most
        commonly-used additional semantics.</p>
      </div>

      <p>Domain entities are instances of some class, usually (the vast
      majority) being persisted. Domain services are singletons that act
      typically act as factories and repositories. Domain entities have state
      in the form of properties and collections; domain services do not. Both
      domain entities and services have behaviour, in the form of
      actions.</p>

      <div class="sect1" title="How to have a domain entity be a POJO (not inherit from framework superclasses)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e44"></a>How to have a domain entity be a POJO (not inherit from
        framework superclasses)</h2></div></div></div>
        

        <p>It isn't mandatory for domain entities to inherit from any
        framework superclass; they can be plain old java objects (pojos) if
        required. However, they do at a minimum need to have a
        <code class="classname">org.apache.isis.applib.DomainObjectContainer</code>
        injected into them (an interface), from which other framework services
        can be accessed.</p>

        <p>If you don't have a requirement to inherit from any other
        superclass, then it usually makes sense to inherit from mention
        <code class="classname">org.apache.isis.applib.AbstractDomainObject</code>,
        which already supports the
        <code class="classname">DomainObjectContainer</code> and has a number of
        convenience helper methods.</p>

        <p>There is further coverage of
        <code class="classname">DomainObjectContainer</code> in <a class="xref" href="#sec.LifecycleMethods" title="How to insert behaviour into the object life cycle">the section called &#8220;How to insert behaviour into the object life cycle&#8221;</a> and also in <a class="xref" href="#chp.DomainServices" title="Chapter&nbsp;9.&nbsp;Domain Services, Repositories and Factories">Chapter&nbsp;9, <i>Domain Services, Repositories and Factories</i></a>.</p>
      </div>

      <div class="sect1" title="How to have a domain service be a POJO (not inherit from framework superclasses)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.AbstractService"></a>How to have a domain service be a POJO (not inherit from
        framework superclasses)</h2></div></div></div>
        

        <p>Like entities, it isn't mandatory for domain services to inherit
        from any framework superclass; they can be plain-old pojos if
        required. However, again, like entities, they do at a minimum need to
        have a
        <code class="classname">org.apache.isis.applib.DomainObjectContainer</code>
        injected into them (an interface), from which other framework services
        can be accessed.</p>

        <p>If you don't have a requirement to inherit from any other
        superclass, then it usually makes sense to inherit from one of the
        abstract classes in the applib, either
        <code class="classname">org.apache.isis.applib.AbstractService</code> or
        <code class="classname">org.apache.isis.applib.AbstractRepositoryAndFactory</code>.
        These already supports the
        <code class="classname">DomainObjectContainer</code> and have a number of
        convenience helper methods.</p>

        <p>The <acronym class="acronym">UML</acronym> class diagram below shows the
        relationship between these types and the
        <code class="classname">DomainObjectContainer</code>.</p>

        <div class="mediaobject"><img src="images/AbstractContainedObject-hierarchy.png" width="351"></div>

        <p>What this means is that <span class="emphasis"><em>Apache Isis</em></span> treats
        factories and repositories as just another type of domain
        service.</p>
      </div>

      <div class="sect1" title="How to add a property to a domain entity"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e71"></a>How to add a property to a domain entity</h2></div></div></div>
        

        <p>A property is a scalar attribute or field of a domain entity.
        Its type can be either a value type (such as an int, Date or String),
        or a reference to another entity.</p>

        <p>Properties are specified using the JavaBean conventions,
        recognizing a standard accessor/mutator pair (<code class="code">get</code> and
        <code class="code">set</code>).</p>

        <p>The syntax is:</p>

        <pre class="programlisting">public PropertyType getPropertyName() 

public void setPropertyName(PropertyType param)</pre>

        <p>where <code class="literal">PropertyType</code> is a
        primitive, a value object or an entity object.</p>

        <p>Properties may either be for a value type or may reference
        another entity. Values include Java primitives, and JDK classes with
        value semantics (eg <code class="literal">java.lang.Strings</code> and <code class="literal">java.util.Dates</code>; see <a class="xref" href="#chp.ValueTypes" title="Chapter&nbsp;10.&nbsp;Value Types">Chapter&nbsp;10, <i>Value Types</i></a> for the full list). It is also possible to
        write your own value types (see <a class="xref" href="#chp.ValueTypes" title="Chapter&nbsp;10.&nbsp;Value Types">Chapter&nbsp;10, <i>Value Types</i></a>). A
        property referencing another domain object is sometimes called an
        association.</p>

        <p>For example, the following example contains both a value
        (<code class="literal">String</code>) property and a reference
        (<code class="literal">Organisation</code>) property:</p>

        <pre class="programlisting">public class Customer {

    private String firstName;
    public String getFirstName() {
        return firstName;
    }
    public void setFirstName(String firstName) {
        this.firstName = firstName;
    }


    private Organisation organisation;
    public Organisation getOrganisation() {
        return organisation;
    }
    public void setOrganisation(Organisation organisation) { 
        this.organisation = organisation;
    }

    ...
}</pre>
      </div>

      <div class="sect1" title="How to add a collection to a domain entity"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e91"></a>How to add a collection to a domain entity</h2></div></div></div>
        

        <p>A collection is a multi-valued attribute/field of a entity, in
        other words a <code class="code">List</code> or a <code class="code">Set</code>, containing
        references to other domain entities. <code class="code">Map</code>s are not
        supported. Collections of value types are not supported.</p>

        <p>A collection is recognized via an accessor/mutator method pair
        (<code class="code">get</code> and set) for any type of collection provided by the
        programming language.</p>

        <p>The syntax is either:</p>

        <pre class="programlisting">public Collection&lt;EntityType&gt; getCollectionName()
private void setCollectionName(Collection&lt;EntityType&gt; param)</pre>

        <p>or:</p>

        <pre class="programlisting">public List&lt;EntityType&gt; getCollectionName()
private void setCollectionName(List&lt;EntityType&gt; param)</pre>

        <p>or:</p>

        <pre class="programlisting">public Set&lt;EntityType&gt; getCollectionName()
private void setCollectionName(Set&lt;EntityType&gt; param)</pre>

        <p>A mutator is required, but it need only have
        <code class="code">private</code> visibility.</p>

        <p>Note:</p>

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p><code class="classname">Map</code>s cannot be used for
          collections.</p>
        </div>

        <p>It is recommended that the collections be specified using
        generics (for example: <code class="literal">List&lt;Customer&gt;</code> ). That way the
        framework will be able to display the collection based on that type
        definition. If a raw type is used then the framework will attempt to
        infer the type from the addToXxx() / removeFromXxx() supporting
        methods, if specified (see <a class="xref" href="#sec.AddToRemoveFrom" title="How to trigger other behaviour when an object is added or removed">the section called &#8220;How to trigger other behaviour when an object is added or
        removed&#8221;</a>). If
        the framework is unable to determine the type of the collection, it
        will mean that some viewers will represent the collection is a less
        sophisticated manner (eg a simple list of titles rather than a
        table).</p>

        <p>For example:</p>

        <pre class="programlisting">public class Employee { ... }

public class Department {
    private List&lt;Employee&gt; employees = new ArrayList&lt;Employee&gt;();
    public List &lt;Employee&gt; getEmployees() {
        return employees;
    }
    private void setEmployees(List&lt;Employee&gt; employees) { 
        this.employees = employees;
    }
    ...
}</pre>
      </div>

      <div class="sect1" title="How to add an action to a domain entity or service"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e119"></a>How to add an action to a domain entity or service</h2></div></div></div>
        

        <p>An 'action' is a method that we expect the user to be able to
        invoke on a domain entity via the user interface, though it may also
        be invoked programmatically within the object model. The following
        conventions are used to determine when and how methods are made
        available to the user as actions, and the means by which a user can
        interact with those actions</p>

        <p>By default, any <code class="literal">public</code>
        instance method that you add to a class will be treated as a user
        action, unless it represents a property, collection, or another
        reserved method defined in this guide.</p>

        <p>The syntax is:</p>

        <pre class="programlisting">public void actionName([ValueOrEntityType param] ...)</pre>

        <p>or</p>

        <pre class="programlisting">public ReturnType actionName([ValueOrEntityType param] ...)</pre>

        <p>When a method returns a reference the viewer will attempt to
        display that object. If the return value is <code class="code">null</code> then
        nothing is displayed.</p>

        <p>We refer to all methods that are intended to be invoked by users
        as 'action methods'.</p>

        <p>If you have a method that you don't want to be made available as
        a user-action you can either:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>make it non-<code class="literal">public</code> (eg <code class="literal">protected</code> or <code class="literal">private</code>)</p>
          </li><li class="listitem">
            <p>annotate it with <code class="classname">@Ignore</code></p>
          </li><li class="listitem">
            <p>annotate it with <code class="classname">@Hidden</code> (discussed
            further in <a class="xref" href="#sec.HiddenActions" title="How to hide an action">the section called &#8220;How to hide an action&#8221;</a>)</p>
          </li></ul></div>

        <p>Note also that <code class="literal">static</code> methods
        are ignored: such functionality should reside in a service, such as a
        repository or factory (see <a class="xref" href="#chp.DomainServices" title="Chapter&nbsp;9.&nbsp;Domain Services, Repositories and Factories">Chapter&nbsp;9, <i>Domain Services, Repositories and Factories</i></a>).</p>
      </div>

      <div class="sect1" title="How to specify a title for a domain entity"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e150"></a>How to specify a title for a domain
        entity</h2></div></div></div>
        

        <p>A title is used to identify an object to the user in the user
        interface. For example, a <code class="classname">Customer</code>'s title
        might be the organization's customer reference, or perhaps (more
        informally) their first and last names.</p>

        <p>By default, the framework will use the object's <code class="literal">toString()</code> method as the title. Most titles
        tend to be made up of the same set of elements: for example a
        Customer's name might be the concatenation of their customer first
        name and their ;ast name. For these the <code class="classname">@Title</code>
        annotation can be used:</p>

        <pre class="programlisting">public class Customer {
  @Title
  public String getFirstName() { ... }
  @Title
  public String getLastName() { ... }
  ...
}</pre>

        <p>For more control, the order of the title components can be
        specified using a sequence number (specified in Dewey decimal
        format):</p>

        <pre class="programlisting">public class Customer {
  @Title("1.0")
  public String getFirstName() { ... }
  @Title("1.1")
  public String getLastName() { ... }
  ...
}</pre>

        <p>For more control the title can be declared imperately using the
        <code class="literal">title()</code> method (returning a
        <code class="literal">String</code>). This leaves the programmer
        needs to make use of the <code class="literal">toString()</code>
        method for other purposes, such as for debugging. For example, to
        return the title for a customer which is their last name and then
        first initial of their first name, we could use:</p>

        <pre class="programlisting">public class Customer {
  public String title() {
    return getLastName() + ", " + getFirstName().substring(0,1);
  } 
  ...
}</pre>

        <p>The applib contains a class,
        <code class="classname">org.apache.isis.applib.util.TitleBuffer</code>, which
        you can use to help create title strings if you so wish. See <a class="xref" href="#apx.UtilityClasses" title="Appendix&nbsp;E.&nbsp;Utility Classes">Appendix&nbsp;E, <i>Utility Classes</i></a> for more details.</p>
      </div>

      <div class="sect1" title="How to specify the icon for a domain entity"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.HowToSpecifyTheIconForAnObjectsClass"></a>How to specify the icon for a domain
        entity</h2></div></div></div>
        

        <p>By default, the framework will look for an image
        in the <code class="filename">images</code>
        directory (either from the classpath or from the filesystem) that has
        the same name as the object class. Multiple file extensions are
        searched for, including <code class="filename">.png</code>,
        <code class="filename">.gif</code> and <code class="filename">.jpg</code> (in order of
        preference). For example, fan object of type
        <code class="classname">Customer</code> it will look for <code class="filename">Customer.png</code>, <code class="filename">Customer.gif</code>,
        <code class="filename">Customer.jpg</code> etc.</p>

        <p>If the framework finds no such file, then it
        will work up the inheritance hierarchy to see if there is an icon
        matching the name of any of the super-classes, and use that instead.
        If no matching icon is found then the framework will look for an image
        called <code class="filename">default.png</code>,
        <code class="filename">default.gif</code> or <code class="filename">default.jpg</code>
        in the images directory, and if this has not been specified, then the
        framework will use its own default image for an icon.</p>

        <p>We strongly recommend that you adopt 'pascal case' as the
        convention for icon file names: if you have a class called <code class="classname"> OrderLine</code>, then call the icon <code class="filename">OrderLine.png</code>. Actually,
        the framework will also recognise <code class="filename">orderline.png</code>, but some operating systems
        and deployment environments are case sensitive, so it is good practice
        to adopt an unambiguous convention.</p>

        <p>Alternatively, you can use the <code class="literal">iconName</code>() method instead:</p>

        <pre class="programlisting">public String iconName() {
    return "Person";
}</pre>

        <p>This makes it easy for more than one class to use the same icon,
        without having to duplicate the image file.</p>
      </div>

      <div class="sect1" title="How to specify the order in which properties or collections are displayed"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.MemberOrderForProperties"></a>How to specify the order in which properties or collections are
        displayed</h2></div></div></div>
        

        <p>The <code class="literal">@MemberOrder</code> annotation
        provides a hint to the viewer as to the order in which the properties
        and collections should appear in the <acronym class="acronym">GUI</acronym>.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Customer() {
    @MemberOrder("1")
    public String getFirstName() { ... }
    ...

    @MemberOrder("2")
    public String getLastName() { ... }
    ...

    @MemberOrder("3")
    public Collection&lt;Order&gt; getOrders() { ... }
    ...
}</pre>
      </div>

      <div class="sect1" title="How to specify the order in which actions appear on the menu"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e200"></a>How to specify the order in which actions appear on the
        menu</h2></div></div></div>
        

        <p>The <code class="literal">@MemberOrder</code> annotation
        provides a hint to the viewer as to the order in which the actions
        should be displayed, eg in a menu.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Customer {
    @MemberOrder("3")
    public void placeOrder(Product p) { ... }
    ...

    @MemberOrder("4")
    public void blackList() { ... }
    ...
}</pre>

        <p></p>

        <p>***</p>

        <p></p>
      </div>

      <div class="sect1" title="How to make a property optional (when saving an object)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e209"></a>How to make a property optional (when saving an object)</h2></div></div></div>
        

        <p>By default, when a new transient (unsaved) object is presented
        to the user, values must be specified for all properties before the
        object may be saved.</p>

        <p>To specify that a particular property is optional, use the
        <code class="literal">@Optional</code> annotation.</p>
      </div>

      <div class="sect1" title="How to make an action parameter optional"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e214"></a>How to make an action parameter optional</h2></div></div></div>
        

        <p>By default, the framework assumes that when an action method is
        to be invoked, all the parameters are mandatory. You may override this
        behaviour by marking up one or more of the paramaters with the
        <code class="literal">@Optional</code> annotation.</p>
      </div>

      <div class="sect1" title="How to specify the size of String properties"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.SizeProperties"></a>How to specify the size of <code class="classname">String</code>
        properties</h2></div></div></div>
        

        <p>Use:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>the <code class="literal">@MaxLength</code> to specify
            the maximum number of characters that may be stored within a
            <code class="classname">String</code> property.</p>
          </li><li class="listitem">
            <p>the <code class="literal">@TypicalLength</code> to
            specify the typical number of characters that are likely to be
            stored within a <code class="classname">String</code> property. Viewers
            are expected to use this as a hint as to the size of the field to
            render for the property.</p>
          </li><li class="listitem">
            <p>the <code class="literal">@MultiLine</code> annotation
            as a hint to indicate that the property should be displayed over
            multiple lines (eg as a text area rather than a text
            field).</p>
          </li></ul></div>

        <p>For example:</p>

        <pre class="programlisting">public class Ticket {
    @TypicalLength(50)
    @MaxLength(255)
    public String getDescription() { ... }
    ...

    @MaxLength(2048)
    @MultiLine
    public String getNotes() { ... }
    ...
}</pre>
      </div>

      <div class="sect1" title="How to specify the size of String action parameters"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e236"></a>How to specify the size of <code class="classname">String</code> action
        parameters</h2></div></div></div>
        

        <p>As for properties (see <a class="xref" href="#sec.SizeProperties" title="How to specify the size of String properties">the section called &#8220;How to specify the size of <code class="classname">String</code>
        properties&#8221;</a>),
        use:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>the <code class="literal">@MaxLength</code> to specify
            the maximum number of characters that may be stored within a
            <code class="classname">String</code> parameter.</p>
          </li><li class="listitem">
            <p>the <code class="literal">@TypicalLength</code> to
            specify the typical number of characters that are likely to be
            stored within a <code class="classname">String</code> parameter. Viewers
            are expected to use this as a hint as to the size of the field to
            render for the parameter.</p>
          </li><li class="listitem">
            <p>the <code class="literal">@MultiLine</code> annotation
            as a hint to indicate that the parameter should be displayed over
            multiple lines (eg as a text area rather than a text
            field).</p>
          </li></ul></div>

        <p>For example:</p>

        <pre class="programlisting">public class TicketRaiser {

    public void raiseTicket(
            @TypicalLength(50) @MaxLength(255) @Named("Description")
            String getDescription,
            @MaxLength(2048) @MultiLine @Named("Notes")
            String notes) {
        ...
    }
    ...
}</pre>
      </div>

      <div class="sect1" title="How to specify names and/or descriptions for an action parameter"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.ActionParameterNames"></a>How to specify names and/or descriptions for an action
        parameter</h2></div></div></div>
        

        <p>Unlike with properties, the framework cannot pick up the names
        of parameters that you use within the domain code. By default
        parameters will be labelled only with the type of the object required
        (e.g. 'String:' or 'Customer:)</p>

        <p>If you want a parameter to have a different name (such as 'First
        Name', 'Last Name') then that parameter should be marked up with an
        <code class="literal">@Named</code> annotation - very often
        taking the same form as the parameter name used in the code.
        Alternatively though, you could create a user-defined value type,
        using <code class="literal">@Value</code> (see <a class="xref" href="#chp.ValueTypes" title="Chapter&nbsp;10.&nbsp;Value Types">Chapter&nbsp;10, <i>Value Types</i></a>).</p>

        <p>Similarly, any parameter may be given a short user-description
        using the <code class="literal">@DescribedAs</code> annotation.
        The framework takes responsibility to make this available to the
        user.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Customer {
    public Order placeOrder(
            Product p, 
            @Named("Quantity")
            @DescribedAs("The number of units of the specified product in this order")
            int quantity) {
        ...
    }
    ...
}</pre>
      </div>

      <div class="sect1" title="How to inject services into a domain entity or other service"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e266"></a>How to inject services into a domain entity or other
        service</h2></div></div></div>
        

        <p>All that is required to inject a service into an entity (or
        indeed into another service) is to provide an appropriately typed
        setter. The name of the method does not matter, only that it is
        prefixed "set", is public, and has a single parameter of the correct
        type.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Customer {
    private OrderRepository orderRepository;
    public void setOrderRepository(OrderRepository orderRepository) {
        this.orderRepository = orderRepository;
    }
    ...
}</pre>

        <p>Note that we consider
        <code class="classname">DomainObjectContainer</code> to be a service too;
        hence it can be injected in exactly the same manner.</p>
      </div>

      <div class="sect1" title="How to create or delete objects within your code"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.HowToCreateAnObject"></a>How to create or delete objects within your code</h2></div></div></div>
        

        <p>When you create any domain object within your application code,
        it is important that the framework is made aware of the existence of
        this new object - in order that it may be persisted to the object
        store, and in order that any services that the new object needs are
        injected into it.</p>

        <p>Just specifying <code class="literal">new
        Customer()</code>, for example, will create a
        <code class="classname">Customer</code> object, but that object will
        <span class="emphasis"><em>not</em></span> be known to the framework. However, since we
        do not want to tie our domain objects to a particular framework, we
        use the idea of a 'container' to mediate, specified by the <code class="literal">org.apache.isis.applib.DomainObjectContainer</code>
        interface. See <a class="xref" href="#apx.DomainObjectContainer" title="Appendix&nbsp;C.&nbsp;DomainObjectContainer interface">Appendix&nbsp;C, <i><code class="classname">DomainObjectContainer</code> interface</i></a> for the
        full list of methods provided by
        <code class="classname">DomainObjectContainer</code>.</p>

        <p>This interface defines the following methods for managing domain
        objects:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="literal">&lt;T&gt; T
            newTransientInstance(final Class&lt;T&gt;
            ofClass)</code></p>

            <p>Returns a new instance of the specified class, that is
            transient (unsaved). The object may subsequently be saved either
            by the user invoking the Save action (that will automatically be
            rendered on the object view) or programmatically by calling
            <code class="literal">persist(Object
            transientObject)</code></p>
          </li><li class="listitem">
            <p><code class="methodname">&lt;T&gt; T newPersistentInstance(final
            Class&lt;T&gt; ofClass)</code></p>

            <p>Creates a new object already persisted.</p>
          </li><li class="listitem">
            <p><code class="methodname">boolean isPersistent()</code></p>

            <p>Checks whether an object has already been persisted. This is
            often useful in controlling visibility or availability of
            properties or actions.</p>
          </li><li class="listitem">
            <p><code class="methodname">void persist(Object
            transientObject)</code></p>

            <p>Persists a transient object (created using
            <code class="methodname">newTransientInstance(...)</code>, see
            above).</p>
          </li><li class="listitem">
            <p><code class="methodname">void persistIfNotAlready(Object
            domainObject)</code></p>

            <p>It is an error to persist an object if it is already
            persistent; this method will persist only if the object is not
            already persistent (otherwise it will do nothing).</p>
          </li><li class="listitem">
            <p><code class="methodname">void remove(Object
            persistentObject)</code></p>

            <p>Removes (deletes) from the object store, making the
            reference transient.</p>
          </li><li class="listitem">
            <p><code class="methodname">void removeIfNotAlready(Object
            domainObject)</code></p>

            <p>It is an error to remove an object if it is not persistent;
            this method will remove only if the object is known to be
            persistent (otherwise it will do nothing).</p>
          </li></ul></div>

        <p>A domain object specifies that it needs to have a reference to
        the <code class="classname">DomainObjectContainer</code> injected into by
        including the following code:</p>

        <pre class="programlisting">private DomainObjectContainer container;
protected DomainObjectContainer getContainer() {
    return container;
}
public final void setContainer(final DomainObjectContainer container) {
    this.container = container;
}</pre>

        <p>Creating or deleting objects is then done by invoking those
        methods on the container. For example the following code would then
        create a new <code class="classname">Customer</code> object within another
        method:</p>

        <pre class="programlisting">Customer newCust = getContainer().newTransientInstance(Customer.class);
newCust.setName("Charlie");
getContainer().persist(newCust);</pre>

        <p>If you are able to make your domain object inherit from <code class="literal">org.apache.isis.applib.AbstractDomainObject</code>
        then you have direct access to those methods, so the code would
        become:</p>

        <pre class="programlisting">Customer newCust = newTransientInstance(Customer.class);
newCust.setName("Charlie");
persist(newCust);</pre>

        <p>As an alternative to putting the creation logic within your
        domain objects, you could alternatively delegate to an injected
        factory (see <a class="xref" href="#chp.DomainServices" title="Chapter&nbsp;9.&nbsp;Domain Services, Repositories and Factories">Chapter&nbsp;9, <i>Domain Services, Repositories and Factories</i></a>). Ultimately
        factories just delegate back to
        <code class="classname">DomainObjectContainer</code> in the same way, so from
        a technical standpoint there is little difference. However it is
        generally worth introducing a factory because it provides a place to
        centralize any business logic. It also affords the opportunity to
        introduce a domain term (eg <code class="classname">ProductCatalog</code> or
        <code class="classname">StudentRegister</code>), thereby reinforcing the
        "ubiquitous language".</p>

        <p>These methods are actually provided by the
        <code class="classname">org.apache.isis.applib.AbstractContainedObject</code>
        and so are also available on <code class="literal">org.apache.isis.applib.AbstractService</code> (and,
        hence, on <code class="literal">org.apache.isis.applib.AbstractFactoryAndRepository</code>)
        for creating objects within a service.</p>

        <div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
          <p>It is possible to create a transient object within another
          transient object. When the framework persists any transient object,
          by default it will automatically persist any other transient object
          referenced by that object. However, if any of these transient
          objects are to be exposed to the user (while in their transient
          state), then you need to write your code very carefully -
          anticipating the fact that the user could elect to save any of the
          transient objects at any point - which could cause the graph of
          related objects to be persisted in an invalid state.</p>

          <p>The recommended approach is, if possible, to mark these
          supplementary classes as not persistable by the user (see <a class="xref" href="#not-persistable" title="@NotPersistable">the section called &#8220;@NotPersistable&#8221;</a>), or not to permit the user to create a
          new transient object that is a child of an existing transient
          object, but, rather, to require the user to save the parent object
          first.</p>
        </div>
      </div>
    </div>

    <div class="chapter" title="Chapter&nbsp;2.&nbsp;How to add business rules"><div class="titlepage"><div><div><h2 class="title"><a name="chp.Properties"></a>Chapter&nbsp;2.&nbsp;How to add business rules</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#sec.HiddenProperty">How to hide a property</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e350">Hiding a property always</a></span></dt><dt><span class="sect2"><a href="#d5e356">Hiding a property based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e367">Hiding a property under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e378">Hiding a property for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.HiddenCollection">How to hide a collection</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e388">Hiding a collection permanently</a></span></dt><dt><span class="sect2"><a href="#d5e394">Hiding a collection based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e405">Hiding a collection under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e416">Hiding a collection for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.HiddenActions">How to hide an action</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e426">Hiding an action permanently</a></span></dt><dt><span class="sect2"><a href="#d5e433">Hiding an action based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e444">Hiding an action under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e455">Hiding an action for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.Entity.Hidden">How to specify that none of an object's members is
        visible</a></span></dt><dt><span class="sect1"><a href="#sec.DisabledProperty">How to prevent a property from being modified</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e474">Disabling a property permanently</a></span></dt><dt><span class="sect2"><a href="#d5e481">Disabling a property based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e492">Disabling a property under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e505">Disabling a property for certain users/roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DisabledCollection">How to prevent a collection from being modified</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e516">Disabling a collection permanently</a></span></dt><dt><span class="sect2"><a href="#d5e525">Disabling a collection based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e536">Disabling a collection under certain conditions</a></span></dt><dt><span class="sect2"><a href="#d5e545">Disabling a collection for specific users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DisabledAction">How to prevent an action from being invoked</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e556">Disabling an action permanently</a></span></dt><dt><span class="sect2"><a href="#d5e560">Disabling an action based on the persistence state of the
          object</a></span></dt><dt><span class="sect2"><a href="#d5e572">Based on the state of the object</a></span></dt><dt><span class="sect2"><a href="#d5e584">Disabling an action for certain users or roles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.Entity.Disabled">How to specify that none of an object's members can be
        modified/invoked</a></span></dt><dt><span class="sect1"><a href="#sec.Immutable">How to specify that an object is
        immutable (that none of its members can ever be modified)</a></span></dt><dt><span class="sect1"><a href="#d5e614">How to validate user input for a property</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e616">Declarative validation</a></span></dt><dt><span class="sect2"><a href="#d5e631">Imperative validation</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e644">How to validate an object being added or removed from a
        collection</a></span></dt><dt><span class="sect1"><a href="#d5e659">How to validate an action parameter argument</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e661">Declarative validation</a></span></dt><dt><span class="sect2"><a href="#d5e676">Imperative validation</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.MustSpecify">How to validate declaratively using @MustSatisfy</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>How-to add business rules to domain entities and services,
        controlling whether a domain entity or service's class members are
        visible, if they are enabled, and to validate arguments. </p>
      </div>

      <p>Business rules can be added to domain objects in a number of ways.
      As well as the business logic encapsulated by domain object actions, the
      framework also supports a number of conventions that allow a domain
      entity or service's members to be made visible or hidden, to be enabled
      or disabled (greyed out), and to validate arguments when invoking an
      action, setting a new value for a property, or if adding a new element
      to a collection.</p>

      <p>Or, in other words: "see it, use it, do it".</p>

      <div class="sect1" title="How to hide a property"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.HiddenProperty"></a>How to hide a property</h2></div></div></div>
        

        <p>The mechanism for hiding a property is broadly the same as for
        hiding a collection (see <a class="xref" href="#sec.HiddenCollection" title="How to hide a collection">the section called &#8220;How to hide a collection&#8221;</a>) or
        an action (see <a class="xref" href="#sec.HiddenActions" title="How to hide an action">the section called &#8220;How to hide an action&#8221;</a>).</p>

        <p>For control over the entire object, see <a class="xref" href="#sec.Entity.Hidden" title="How to specify that none of an object's members is visible">the section called &#8220;How to specify that none of an object's members is
        visible&#8221;</a>.</p>

        <div class="sect2" title="Hiding a property always"><div class="titlepage"><div><div><h3 class="title"><a name="d5e350"></a>Hiding a property always</h3></div></div></div>
          

          <p>To prevent a user from viewing a property at all, use the
          <code class="literal">@Hidden</code> annotation. A common use
          case is to hide an internal Id, eg perhaps as required by the object
          store.</p>

          <p>For example:</p>

          <pre class="programlisting">public class OrderLine {
    private Integer id;
    @Hidden
    public Integer getId() { ... }
    public void setId(Integer id) { ... }
    ...
}</pre>
        </div>

        <div class="sect2" title="Hiding a property based on the persistence state of the object"><div class="titlepage"><div><div><h3 class="title"><a name="d5e356"></a>Hiding a property based on the persistence state of the
          object</h3></div></div></div>
          

          <p>As a refinement of the above, a property may be optionally
          hidden using the <code class="classname">@Hidden</code> annotation based on
          the persistence state of the object:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>to hide the property when the object is transient, use
              <code class="code">@Hidden(When.UNTIL_PERSISTED)</code></p>
            </li><li class="listitem">
              <p>to hide the property when the object is persistent, use
              <code class="code">@Hidden(When.ONCE_PERSISTED)</code></p>
            </li></ul></div>
        </div>

        <div class="sect2" title="Hiding a property under certain conditions"><div class="titlepage"><div><div><h3 class="title"><a name="d5e367"></a>Hiding a property under certain conditions</h3></div></div></div>
          

          <p>A <code class="literal">hideXxx()</code> method can be
          used to indicate that a particular object's property should be
          hidden under certain conditions, typically relating to the state of
          that instance.</p>

          <p>The syntax is:</p>

          <pre class="programlisting"><code class="literal">public boolean hidePropertyName()</code> </pre>

          <p>Returning a value of <code class="code">true</code> indicates that the
          property should be hidden.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Order {
    public String getShippingInstructions() { ... }
    public void setShippingInstructions(String shippingInstructions) { ... }
    public boolean hideShippingInstructions() {
        return hasShipped();
    }
    ...
}</pre>
        </div>

        <div class="sect2" title="Hiding a property for specific users or roles"><div class="titlepage"><div><div><h3 class="title"><a name="d5e378"></a>Hiding a property for specific users or roles</h3></div></div></div>
          

          <p>It is possible to hide properties for certain users/roles by
          calling the <code class="methodname">DomainObjectContainer#getUser()</code>
          method. See <a class="xref" href="#sec.BusinessRulesForCertainUsersOrRoles" title="Hiding, disabling or validating for specific users or roles">the section called &#8220;Hiding, disabling or validating for specific users or
        roles&#8221;</a>for further
          discussion.</p>
        </div>
      </div>

      <div class="sect1" title="How to hide a collection"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.HiddenCollection"></a>How to hide a collection</h2></div></div></div>
        

        <p>The mechanism for hiding a collection is broadly the same as for
        hiding a property (see <a class="xref" href="#sec.HiddenProperty" title="How to hide a property">the section called &#8220;How to hide a property&#8221;</a>) or an
        action (see <a class="xref" href="#sec.HiddenActions" title="How to hide an action">the section called &#8220;How to hide an action&#8221;</a>).</p>

        <div class="sect2" title="Hiding a collection permanently"><div class="titlepage"><div><div><h3 class="title"><a name="d5e388"></a>Hiding a collection permanently</h3></div></div></div>
          

          <p>To prevent a user from viewing a collection at all, use the
          <code class="literal">@Hidden</code> annotation.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Order {
    private List&lt;Order&gt; cancelledOrders = new ArrayList&lt;Order&gt;();
    @Hidden
    public List&lt;Order&gt; getCancelledOrders() { ... }
    private void setCancelledOrders(List&lt;Order&gt; cancelledOrders) { ... }
    ...
}</pre>
        </div>

        <div class="sect2" title="Hiding a collection based on the persistence state of the object"><div class="titlepage"><div><div><h3 class="title"><a name="d5e394"></a>Hiding a collection based on the persistence state of the
          object</h3></div></div></div>
          

          <p>As a refinement of the above, a collection may be optionally
          hidden using the <code class="classname">@Hidden</code> annotation based on
          the persistence state of the object:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>to hide the collection when the object is transient, use
              <code class="code">@Hidden(When.UNTIL_PERSISTED)</code></p>
            </li><li class="listitem">
              <p>to hide the collection when the object is persistent, use
              <code class="code">@Hidden(When.ONCE_PERSISTED)</code></p>
            </li></ul></div>
        </div>

        <div class="sect2" title="Hiding a collection under certain conditions"><div class="titlepage"><div><div><h3 class="title"><a name="d5e405"></a>Hiding a collection under certain conditions</h3></div></div></div>
          

          <p>A <code class="literal">hideXxx()</code> method can be
          used to indicate that a particular object's collection should be
          hidden under certain conditions, typically relating to the state of
          that instance.</p>

          <p>The syntax is:</p>

          <pre class="programlisting"><code class="literal">public boolean hideCollectionName()</code> </pre>

          <p>Returning a value of <code class="code">true</code> indicates that the
          collection should be hidden.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Order {
    @Hidden
    public List&lt;Order&gt; getRushOrders() { ... }
    ...
}</pre>
        </div>

        <div class="sect2" title="Hiding a collection for specific users or roles"><div class="titlepage"><div><div><h3 class="title"><a name="d5e416"></a>Hiding a collection for specific users or roles</h3></div></div></div>
          

          <p>It is possible to hide collections for certain users/roles by
          calling the <code class="methodname">DomainObjectContainer#getUser()</code>
          method. See <a class="xref" href="#sec.BusinessRulesForCertainUsersOrRoles" title="Hiding, disabling or validating for specific users or roles">the section called &#8220;Hiding, disabling or validating for specific users or
        roles&#8221;</a> for further
          discussion.</p>
        </div>
      </div>

      <div class="sect1" title="How to hide an action"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.HiddenActions"></a>How to hide an action</h2></div></div></div>
        

        <p>The mechanism for hiding an action is broadly the same as for
        hiding a property (see <a class="xref" href="#sec.HiddenProperty" title="How to hide a property">the section called &#8220;How to hide a property&#8221;</a>) or a
        collection (see <a class="xref" href="#sec.HiddenCollection" title="How to hide a collection">the section called &#8220;How to hide a collection&#8221;</a>).</p>

        <div class="sect2" title="Hiding an action permanently"><div class="titlepage"><div><div><h3 class="title"><a name="d5e426"></a>Hiding an action permanently</h3></div></div></div>
          

          <p>To prevent a user from viewing an action at all, use the
          <code class="literal">@Hidden</code> annotation. This is
          generally used where a <code class="literal">public</code>
          method on an object is not intended to be a user action</p>

          <p>For example:</p>

          <pre class="programlisting">public class Order {
    @Hidden
    public void markAsCancelled() { ... }
    ...
}</pre>
        </div>

        <div class="sect2" title="Hiding an action based on the persistence state of the object"><div class="titlepage"><div><div><h3 class="title"><a name="d5e433"></a>Hiding an action based on the persistence state of the
          object</h3></div></div></div>
          

          <p>As a refinement of the above, an action may be optionally
          hidden using the <code class="classname">@Hidden</code> annotation based on
          the persistence state of the object:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>to hide the action when the object is transient, use
              <code class="code">@Hidden(When.UNTIL_PERSISTED)</code></p>
            </li><li class="listitem">
              <p>to hide the action when the object is persistent, use
              <code class="code">@Hidden(When.ONCE_PERSISTED)</code></p>
            </li></ul></div>
        </div>

        <div class="sect2" title="Hiding an action under certain conditions"><div class="titlepage"><div><div><h3 class="title"><a name="d5e444"></a>Hiding an action under certain conditions</h3></div></div></div>
          

          <p>A <code class="literal">hideXxx()</code> method can be
          used to indicate that a particular object's action should be hidden
          under certain conditions, typically relating to the state of that
          instance.</p>

          <p>The syntax is:</p>

          <pre class="programlisting"><code class="literal">public boolean hideActionName([ValueOrEntityType param] ...)</code> </pre>

          <p>where the parameter types should match the action itself.
          Returning a value of <code class="code">true</code> indicates that the action
          should be hidden.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Order {
    public void applyDiscount(int percentage) { ... }
    public boolean hideApplyDiscount() {
        return isWholesaleOrder();
    }
}</pre>
        </div>

        <div class="sect2" title="Hiding an action for specific users or roles"><div class="titlepage"><div><div><h3 class="title"><a name="d5e455"></a>Hiding an action for specific users or roles</h3></div></div></div>
          

          <p>It is possible to hide actions for certain users/roles by
          calling the <code class="methodname">DomainObjectContainer#getUser()</code>
          method. See <a class="xref" href="#sec.BusinessRulesForCertainUsersOrRoles" title="Hiding, disabling or validating for specific users or roles">the section called &#8220;Hiding, disabling or validating for specific users or
        roles&#8221;</a> for further
          discussion.</p>
        </div>
      </div>

      <div class="sect1" title="How to specify that none of an object's members is visible"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.Entity.Hidden"></a>How to specify that none of an object's members is
        visible</h2></div></div></div>
        

        <p>To when an object is visible, provide a hidden() method:</p>

        <pre class="programlisting">public class TrackingAction implements Tracking {
   public boolean hidden(){
    ...
   }
}</pre><p>If the function returns true, all properties and actions
        will be hidden from the user, similar to <a class="xref" href="#sec.HiddenProperty" title="How to hide a property">the section called &#8220;How to hide a property&#8221;</a>.</p>
      </div>

      <div class="sect1" title="How to prevent a property from being modified"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.DisabledProperty"></a>How to prevent a property from being modified</h2></div></div></div>
        

        <p>Preventing the user from modifying a property value is known as
        'disabling' the property. Note that this doesn't prevent the property
        from being modified programmatically.</p>

        <p>The mechanism for disabling a property is broadly the same as
        for disabling a collection (see <a class="xref" href="#sec.DisabledCollection" title="How to prevent a collection from being modified">the section called &#8220;How to prevent a collection from being modified&#8221;</a>) or a collection (see <a class="xref" href="#sec.DisabledCollection" title="How to prevent a collection from being modified">the section called &#8220;How to prevent a collection from being modified&#8221;</a>).</p>

        <p>For control over the entire object, see <a class="xref" href="#sec.Entity.Disabled" title="How to specify that none of an object's members can be modified/invoked">the section called &#8220;How to specify that none of an object's members can be
        modified/invoked&#8221;</a>.</p>

        <div class="sect2" title="Disabling a property permanently"><div class="titlepage"><div><div><h3 class="title"><a name="d5e474"></a>Disabling a property permanently</h3></div></div></div>
          

          <p>To prevent a user from being able to modify the property at
          all, use the <code class="literal">@Disabled</code>
          annotation.</p>

          <p>For example:</p>

          <pre class="programlisting">public class OrderLine {
    private int quantity;
    @Disabled
    public String getQuantity() { ... }
    public void setQuantity(int quantity) { ... }
    ...
}</pre>

          <p>Note that a setter is still required; this is used by the
          framework to recreate the object when pulled back from the
          persistent object store.</p>
        </div>

        <div class="sect2" title="Disabling a property based on the persistence state of the object"><div class="titlepage"><div><div><h3 class="title"><a name="d5e481"></a>Disabling a property based on the persistence state of the
          object</h3></div></div></div>
          

          <p>As a refinement of the above, a property may be optionally
          disabled using the <code class="classname">@Disabled</code> annotation based
          on the persistence state of the object:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>to disable the property when the object is transient, use
              <code class="code">@Disabled(When.UNTIL_PERSISTED)</code></p>
            </li><li class="listitem">
              <p>to disable the property when the object is persistent, use
              <code class="code">@Disabled(When.ONCE_PERSISTED)</code></p>
            </li></ul></div>
        </div>

        <div class="sect2" title="Disabling a property under certain conditions"><div class="titlepage"><div><div><h3 class="title"><a name="d5e492"></a>Disabling a property under certain conditions</h3></div></div></div>
          

          <p>A supporting <code class="literal">disableXxx()</code>
          method can be used to disable a particular instance's member under
          certain conditions</p>

          <p>The syntax is:</p>

          <pre class="programlisting"><code class="literal">public String disablePropertyName()</code></pre>

          <p>A non-<code class="code">null</code> return value indicates the reason why
          the property cannot be modified. The framework is responsible for
          providing this feedback to the user.</p>

          <p>For example:</p>

          <pre class="programlisting">public class OrderLine {
    public String getQuantity() { ... }
    public void setQuantity(int quantity) { ... }
    public String disableQuantity() { 
        if (isSubmitted()) {
            return "Cannot alter any quantity after Order has been submitted"; 
        }
        return null;
    }
}</pre>

          <p>If there are multiple reasons to disable a property, take a
          look at the
          <code class="classname">org.apache.isis.applib.util.ReasonBuffer</code>
          helper.</p>
        </div>

        <div class="sect2" title="Disabling a property for certain users/roles"><div class="titlepage"><div><div><h3 class="title"><a name="d5e505"></a>Disabling a property for certain users/roles</h3></div></div></div>
          

          <p>It is possible to disable properties for certain users/roles
          by calling the
          <code class="methodname">DomainObjectContainer#getUser()</code> method. See
          <a class="xref" href="#sec.BusinessRulesForCertainUsersOrRoles" title="Hiding, disabling or validating for specific users or roles">the section called &#8220;Hiding, disabling or validating for specific users or
        roles&#8221;</a>for
          further discussion.</p>
        </div>
      </div>

      <div class="sect1" title="How to prevent a collection from being modified"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.DisabledCollection"></a>How to prevent a collection from being modified</h2></div></div></div>
        

        <p>Preventing the user from adding to or removing from a collection
        is known as 'disabling' the collection.</p>

        <p>The mechanism for disabling a collection is broadly the same as
        for disabling a property (see <a class="xref" href="#sec.DisabledProperty" title="How to prevent a property from being modified">the section called &#8220;How to prevent a property from being modified&#8221;</a>)
        or a action (see <a class="xref" href="#sec.DisabledAction" title="How to prevent an action from being invoked">the section called &#8220;How to prevent an action from being invoked&#8221;</a>).</p>

        <div class="sect2" title="Disabling a collection permanently"><div class="titlepage"><div><div><h3 class="title"><a name="d5e516"></a>Disabling a collection permanently</h3></div></div></div>
          

          <p>Some, though not all, viewers allow the user to directly
          manipulate the contents of a collection. For example, the DnD viewer
          will allow new objects to be "dropped" into a collection, and
          existing objects removed from a collection.</p>

          <p>Although it is possible to associate behaviour with such
          actions (see <a class="xref" href="#sec.AddToRemoveFrom" title="How to trigger other behaviour when an object is added or removed">the section called &#8220;How to trigger other behaviour when an object is added or
        removed&#8221;</a>), it may be
          preferred to only allow modification through actions. Or, the
          application may be deployed using a viewer that doesn't fully
          support direct manipulation of collections.</p>

          <p>In either case, annotate the collection using the <code class="literal">@Disabled</code> annotation.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Order {
    private List&lt;Order&gt; cancelledOrders = new ArrayList&lt;Order&gt;();
    @Disabled
    public List&lt;Order&gt; getCancelledOrders() { ... }
    private void setCancelledOrders(List&lt;Order&gt; cancelledOrders) { ... }
    ...
}</pre>
        </div>

        <div class="sect2" title="Disabling a collection based on the persistence state of the object"><div class="titlepage"><div><div><h3 class="title"><a name="d5e525"></a>Disabling a collection based on the persistence state of the
          object</h3></div></div></div>
          

          <p>As a refinement of the above, a collection may be optionally
          disabled using the <code class="classname">@Disabled</code> annotation based
          on the persistence state of the object:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>to disable the collection when the object is transient,
              use <code class="code">@Disabled(When.UNTIL_PERSISTED)</code></p>
            </li><li class="listitem">
              <p>to disable the collection when the object is persistent,
              use <code class="code">@Disabled(When.ONCE_PERSISTED)</code></p>
            </li></ul></div>
        </div>

        <div class="sect2" title="Disabling a collection under certain conditions"><div class="titlepage"><div><div><h3 class="title"><a name="d5e536"></a>Disabling a collection under certain conditions</h3></div></div></div>
          

          <p>A <code class="literal">disableXxx()</code> method can
          be used to disable a particular instance's collection under certain
          conditions:</p>

          <p>The syntax is:</p>

          <pre class="programlisting"><code class="literal">public String disableCollectionName()</code> </pre>

          <p>For example:</p>

          <pre class="programlisting">public class Department {
    public List&lt;Employee&gt; getEmployees() { ... }
    private void setEmployees(List&lt;Employee&gt; employees) { ... }
    public void disableEmployees() {
        return isClosed()? "This department is closed" : null;
    }
    ...
}</pre>
        </div>

        <div class="sect2" title="Disabling a collection for specific users or roles"><div class="titlepage"><div><div><h3 class="title"><a name="d5e545"></a>Disabling a collection for specific users or roles</h3></div></div></div>
          

          <p>It is possible to disable collections for certain users/roles
          by calling the
          <code class="methodname">DoymainObjectContainer#getUser()</code> method.
          See <a class="xref" href="#sec.BusinessRulesForCertainUsersOrRoles" title="Hiding, disabling or validating for specific users or roles">the section called &#8220;Hiding, disabling or validating for specific users or
        roles&#8221;</a> for
          further discussion.</p>
        </div>
      </div>

      <div class="sect1" title="How to prevent an action from being invoked"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.DisabledAction"></a>How to prevent an action from being invoked</h2></div></div></div>
        

        <p>Preventing the user from invoking an action is known as
        'disabling' the action.</p>

        <p>The mechanism for disabling an action is broadly the same as for
        disabling a property (see <a class="xref" href="#sec.DisabledProperty" title="How to prevent a property from being modified">the section called &#8220;How to prevent a property from being modified&#8221;</a>) or
        a collection (see <a class="xref" href="#sec.DisabledCollection" title="How to prevent a collection from being modified">the section called &#8220;How to prevent a collection from being modified&#8221;</a>).</p>

        <div class="sect2" title="Disabling an action permanently"><div class="titlepage"><div><div><h3 class="title"><a name="d5e556"></a>Disabling an action permanently</h3></div></div></div>
          

          <p>It is possible to prevent an action from ever being invoked
          using the <code class="classname">@Disabled</code> annotation, exactly
          equivalent to the use of the annotation for properties and
          collections. However, it's not a particularly meaningful usecase:
          why display an action that can never be invoked? The only reason we
          can think of is as a placeholder during prototyping - to indicate to
          the user that an action is planned, but has not yet been
          implemented.</p>
        </div>

        <div class="sect2" title="Disabling an action based on the persistence state of the object"><div class="titlepage"><div><div><h3 class="title"><a name="d5e560"></a>Disabling an action based on the persistence state of the
          object</h3></div></div></div>
          

          <p>Whereas annotating an action simply as
          <code class="classname">@Disabled</code> probably does not make sense (see
          above), it does make sense to optionally disable an action using the
          <code class="classname">@Disabled</code> annotation based on the persistence
          state of the object:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>to disable the action when the object is transient, use
              <code class="code">@Disabled(When.UNTIL_PERSISTED)</code></p>
            </li><li class="listitem">
              <p>to disable the action when the object is persistent, use
              <code class="code">@Disabled(When.ONCE_PERSISTED)</code></p>
            </li></ul></div>
        </div>

        <div class="sect2" title="Based on the state of the object"><div class="titlepage"><div><div><h3 class="title"><a name="d5e572"></a>Based on the state of the object</h3></div></div></div>
          

          <p>There may be circumstances in which we do not want the user to
          be able to initiate the action at all - for example because that
          action is not appropriate to the current state of the object on
          which the action resides. Such rules are enforced by means of a
          <code class="literal">disableXxx()</code> supporting
          method.</p>

          <p>The syntax is:</p>

          <pre class="programlisting">public String disableActionName([ValueOrEntityType param]...)</pre>

          <p>A non-<code class="literal">null</code> return <code class="code">String</code>
          indicates the reason why the action may not be invoked. The
          framework takes responsibility to provide this feedback to the
          user.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer {
    public Order placeOrder(Product p, int quantity) { ... }
    public String disablePlaceOrder(Product p, int quantity) { 
        return isBlackListed()?
            "Blacklisted customers cannot place orders"
            :null;
    }
    ...
}</pre>
        </div>

        <div class="sect2" title="Disabling an action for certain users or roles"><div class="titlepage"><div><div><h3 class="title"><a name="d5e584"></a>Disabling an action for certain users or roles</h3></div></div></div>
          

          <p>It is possible to disable actions for certain users/roles by
          calling the <code class="methodname">DomainObjectContainer#getUser()</code>
          method. See <a class="xref" href="#sec.BusinessRulesForCertainUsersOrRoles" title="Hiding, disabling or validating for specific users or roles">the section called &#8220;Hiding, disabling or validating for specific users or
        roles&#8221;</a> for further
          discussion.</p>
        </div>
      </div>

      <div class="sect1" title="How to specify that none of an object's members can be modified/invoked"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.Entity.Disabled"></a>How to specify that none of an object's members can be
        modified/invoked</h2></div></div></div>
        

        <p>Some objects have state which should not be modifiable only
        under certain conditions; for example an invoice can not be modified
        after it has been paid. The viewer is expected to interpret this by
        suppressing any sort of "edit" button.</p>

        <p>To indicate that an object cannot be modified, use the <code class="literal">String disabled(Type type)</code> method.</p>

        <p>For example:</p>

        <pre class="programlisting">public class FeeInvoice implements Invoice {
   public String disabled(Type type){
    ...
   }
}</pre>

        <p>The <code class="code">Type</code> is from
        <code class="classname">org.apache.isis.applib.Identifier</code>:</p>

        <pre class="programlisting">    /**
     * What type of feature this identifies.
     */
    public static enum Type {
        CLASS, PROPERTY_OR_COLLECTION, ACTION
    }</pre>

        <p>and provides fine grain control over disabling actions and
        properties.</p>

        <p>The return String is null if the the object (action or property)
        is not disabled, or the reason why it is disabled, similar to <a class="xref" href="#sec.DisabledProperty" title="How to prevent a property from being modified">the section called &#8220;How to prevent a property from being modified&#8221;</a>.</p>

        <p>See also <a class="xref" href="#sec.Entity.Disabled" title="How to specify that none of an object's members can be modified/invoked">the section called &#8220;How to specify that none of an object's members can be
        modified/invoked&#8221;</a>.</p>
      </div>

      <div class="sect1" title="How to specify that an object is immutable (that none of its members can ever be modified)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.Immutable"></a>How to specify that an object is
        immutable (that none of its members can ever be modified)</h2></div></div></div>
        

        <p>Some objects have state which should not be modifiable; for
        example those representing reference data. The viewer is expected to
        interpret this by which suppressing any sort of "edit" button.</p>

        <p>To indicate that an object cannot be modified, use the <code class="literal">@Immutable</code> annotation.</p>

        <p>For example:</p>

        <pre class="programlisting">@Immutable
public class ChasingLetter implements PaymentReclaimStrategy {
    ...
}</pre>

        <p>See also <a class="xref" href="#sec.Entity.Disabled" title="How to specify that none of an object's members can be modified/invoked">the section called &#8220;How to specify that none of an object's members can be
        modified/invoked&#8221;</a>.</p>
      </div>

      <div class="sect1" title="How to validate user input for a property"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e614"></a>How to validate user input for a property</h2></div></div></div>
        

        <div class="sect2" title="Declarative validation"><div class="titlepage"><div><div><h3 class="title"><a name="d5e616"></a>Declarative validation</h3></div></div></div>
          

          <p>For properties that accept a text input string, such as
          <code class="code">String</code> and <code class="code">Date</code>, there are convenient
          mechanisms to validate and/or normalise the values typed in:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>For <code class="literal">Date</code> and number
              values the <code class="literal">@Mask</code> annotation
              may be used.</p>
            </li><li class="listitem">
              <p>For <code class="literal">String</code> properties
              the <code class="literal">@RegEx</code> annotation may be
              used.</p>
            </li></ul></div>

          <p>More complex validation can also be performed imperatively
          (below).</p>
        </div>

        <div class="sect2" title="Imperative validation"><div class="titlepage"><div><div><h3 class="title"><a name="d5e631"></a>Imperative validation</h3></div></div></div>
          

          <p>A supporting <code class="literal">validateXxx()</code>
          method is used to check that a new value for a property is
          valid.</p>

          <p>If the proffered value is deemed to be invalid then the
          property will not be changed. A non-null return <code class="code">String</code>
          indicates the reason why the member cannot be modified/action be
          invoked; the framework is responsible for providing this feedback to
          the user.</p>

          <p>The syntax is:</p>

          <pre class="programlisting">public String validatePropertyName(PropertyType param)</pre>

          <p>where <code class="literal">PropertyType</code> is the
          same type as that of the property itself.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Exam {
    public int getMark() { ... }
    public void setMark(int mark) { ... }
    public validateMark(int mark) {
        return !withinRange(mark)? "Mark must be in range 0 to 30":null;
    }
    private boolean withinRange(int mark) { return mark &gt;= 0 &amp;&amp; mark &lt;= 30; }
}</pre>
        </div>
      </div>

      <div class="sect1" title="How to validate an object being added or removed from a collection"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e644"></a>How to validate an object being added or removed from a
        collection</h2></div></div></div>
        

        <p>A <code class="literal">validateAddToXxx()</code> method
        can be used to check that an object is valid to be added to a
        collection. Conversely, the
        <code class="methodname">validateRemoveFromXxx()</code> method can be used to
        check that it is valid to remove an object from a collection is
        valid.</p>

        <p>The syntax is:</p>

        <pre class="programlisting">public String validateAddToCollectionName(EntityType param)</pre>

        <p>and</p>

        <pre class="programlisting">public String validateRemoveFromCollectionName(EntityType param)</pre>

        <p>A non-<code class="code">null</code> return <code class="code">String</code> indicates the
        reason why the object cannot be added/removed, and the viewing
        mechanism will display this to the user.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Department {
    public List&lt;Employee&gt; getEmployees() { ... }
    private void setEmployees(List&lt;Employee&gt; employees) { ... }
    public String validateAddToEmployee(Employee employee) {
        return employee.isRetired()?
            "Cannot add retired employees to department"
            :null;
    ...
}</pre>
      </div>

      <div class="sect1" title="How to validate an action parameter argument"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e659"></a>How to validate an action parameter argument</h2></div></div></div>
        

        <div class="sect2" title="Declarative validation"><div class="titlepage"><div><div><h3 class="title"><a name="d5e661"></a>Declarative validation</h3></div></div></div>
          

          <p>For parameters that accept a text input string, such as
          <code class="code">String</code> and <code class="code">Date</code>, there are convenient
          mechanisms to validate and/or normalise the values typed in:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>For <code class="literal">Date</code> and number
              values the <code class="literal">@Mask</code> annotation
              may be used.</p>
            </li><li class="listitem">
              <p>For <code class="literal">String</code> parameters
              the <code class="literal">@RegEx</code> annotation may be
              used.</p>
            </li></ul></div>

          <p>More complex validation can also be performed imperatively
          (below).</p>
        </div>

        <div class="sect2" title="Imperative validation"><div class="titlepage"><div><div><h3 class="title"><a name="d5e676"></a>Imperative validation</h3></div></div></div>
          

          <p>A <code class="literal">validateXxx()</code> method is
          used to check that the set of arguments used by an action method is
          valid. If the arguments are invalid then the framework will not
          invoke the action.</p>

          <p>The syntax is:</p>

          <pre class="programlisting">public String validate&lt;ActionName&gt;([ValueOrEntityType param]...)</pre>

          <p>A non-<code class="code">null</code> return <code class="classname">String</code>
          indicates the reason why the member cannot be modified/action be
          invoked, and the viewing mechanism will display this feedback to the
          user.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer {
    public Order placeOrder(Product p, int quantity) { ... }
    public String validatePlaceOrder(Product p, int quantity) {
        if (p.isOutOfStock()) { return "Product is out of stock"; }
        if (quantity &lt;= 0) { return "Quantity must be a positive value"; }
        return null;
    }
    ...
}</pre>

          <p>For complex validation, you may wish to use the
          <code class="classname">org.apache.isis.applib.util.ReasonBuffer</code>
          helper class.</p>
        </div>
      </div>

      <div class="sect1" title="How to validate declaratively using @MustSatisfy"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.MustSpecify"></a>How to validate declaratively using @MustSatisfy</h2></div></div></div>
        

        <p>The <code class="literal">@MustSatisfy</code> annotation is an alternative
        to using imperative validation, allowing validation rules to be
        captured in an (implementation of a)
        <code class="classname">org.apache.isis.applib.spec.Specification</code>.</p>

        <p>For example:</p>

        <pre class="programlisting">public class DomainObjectWithMustSatisfyAnnotations extends AbstractDomainObject {

    private String lastName;
    @MustSatisfy(SpecificationRequiresFirstLetterToBeUpperCase.class)
    public String getLastName() {
        resolve(lastName);
        return lastName;
    }
    public void setLastName(String lastName) {
        this.lastName = lastName;
        objectChanged();
    }

    public void changeLastName(
            @MustSatisfy(SpecificationRequiresFirstLetterToBeUpperCase.class)
            String lastName
            ) {
        setLastName(lastName);
    }

}</pre>

        <p>To help you write your own
        <code class="classname">Specification</code>s, there are some adapter classes
        in <span class="package">org.apache.isis.applib.specs</span>:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="classname">AbstractSpecification</code>, which
            implements <code class="classname">Specification</code> and takes
            inspiration from the <a class="ulink" href="http://code.google.com/p/hamcrest/" target="_top">Hamcrest</a>
            library's <code class="classname">TypeSafeMatcher</code> class</p>
          </li><li class="listitem">
            <p><code class="classname">SpecificationAnd</code>, which allows a set
            of <code class="classname">Specification</code>s to be grouped together
            and require that <span class="emphasis"><em>all</em></span> of them are
            satisfied</p>
          </li><li class="listitem">
            <p><code class="classname">SpecificationOr</code>, which allows a set
            of <code class="classname">Specification</code>s to be grouped together
            and require that <span class="emphasis"><em>at least one</em></span> of them is
            satisfied</p>
          </li><li class="listitem">
            <p><code class="classname">SpecificationNot</code>, which requires that
            the provided <code class="classname">Specification</code> is
            <span class="emphasis"><em>not</em></span> satisfied</p>
          </li></ul></div>
      </div>
    </div>

    <div class="chapter" title="Chapter&nbsp;3.&nbsp;How to provide drop-downs and default values"><div class="titlepage"><div><div><h2 class="title"><a name="d5e722"></a>Chapter&nbsp;3.&nbsp;How to provide drop-downs and default values</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d5e728">How to specify a set of choices for a property</a></span></dt><dt><span class="sect1"><a href="#d5e745">How to specify a set of choices for an action parameter</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e751">Per parameter syntax (preferred)</a></span></dt><dt><span class="sect2"><a href="#d5e759">All parameters syntax</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.Bounded">How to specify that a class of objects has a limited number of
        instances</a></span></dt><dt><span class="sect1"><a href="#d5e779">How to find an entity (for an action parameter or property)
        using auto-complete</a></span></dt><dt><span class="sect1"><a href="#d5e791">How to specify default values for an action parameter</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e795">Per-parameter syntax (preferred)</a></span></dt><dt><span class="sect2"><a href="#d5e802">All parameters syntax</a></span></dt></dl></dd></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>How-to make actions easier to use from an end-user perspective,
        by providing sets of choices and defaults.</p>
      </div>

      <p>Invoking actions or setting properties requires that the user
      specify a valid value; of the correct type, and that passes any
      validation rules that may have been defined. To make things are easier
      for the user, you can provide lists of choices; viewers typically render
      these values in a drop-down list box.</p>

      <p>In a similar vein, there may be a default value for an action
      parameter; this can also be specified.</p>

      <div class="sect1" title="How to specify a set of choices for a property"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e728"></a>How to specify a set of choices for a property</h2></div></div></div>
        

        <p>The simplest way to provide the user with a set of choices for a
        property (possibly rendered as a drop-down list, for example) is to
        ensure that the type used by the property is marked up as
        <code class="code">@Bounded</code> (see <a class="xref" href="#sec.Bounded" title="How to specify that a class of objects has a limited number of instances">the section called &#8220;How to specify that a class of objects has a limited number of
        instances&#8221;</a>).</p>

        <p>However, this is not always appropriate. For example you might
        wish to provide the user with the choice of all the
        <code class="classname">Address</code>es known for that
        <code class="classname">Customer</code>, with the most recently-used address
        as the default.</p>

        <p>The syntax for specifying a list of choices is either:</p>

        <pre class="programlisting">public Collection&lt;PropertyType&gt; choicesPropertyName()</pre>

        <p>or alternatively</p>

        <pre class="programlisting">public PropertyType[] choicesPropertyName()</pre>

        <p>where <code class="literal">PropertyType</code> is the
        same type as that of the property itself.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Order {
    public Address getShippingAddress() { ... }
    public void setShippingAddress() { ... }
    public List&lt;Address&gt; choicesShippingAddress() {
        return getCustomer().allActiveAddresses();
    }
    ...
}</pre>
      </div>

      <div class="sect1" title="How to specify a set of choices for an action parameter"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e745"></a>How to specify a set of choices for an action parameter</h2></div></div></div>
        

        <p>The programmer may provide a set of choices for the value of any
        or all of the parameters of an action. These will be made available to
        the user - for example as a drop-down list.</p>

        <p>If the type of the parameter is annotated with <code class="literal">@Bounded</code>, then it is not necessary to
        specify the choices for that parameter, as the user will automatically
        be offered the full set to choose from.</p>

        <p>If this isn't the case, then - as for defaults - there are two
        different ways to specify parameters; either per parameter, or for all
        parameters.</p>

        <div class="sect2" title="Per parameter syntax (preferred)"><div class="titlepage"><div><div><h3 class="title"><a name="d5e751"></a>Per parameter syntax (preferred)</h3></div></div></div>
          

          <p>The per-parameter form is simpler and generally
          preferred.</p>

          <p>The syntax is:</p>

          <pre class="programlisting">public List&lt;ParameterType&gt; choicesNActionName()</pre>

          <p>where N indicates the 0-based parameter number.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Order {
    public Order placeOrder(
            Product product,
            @Named("Quantity") 
            int quantity) {
        ...
    }
    public List&lt;Product&gt; choices0PlaceOrder() {
        return lastFiveProductsOrderedBy(this.getCustomer());
    }
    public List&lt;Integer&gt; choices1PlaceOrder() {
        return Arrays.asList(1,2,3,4,5);
    }
    ....
}</pre>
        </div>

        <div class="sect2" title="All parameters syntax"><div class="titlepage"><div><div><h3 class="title"><a name="d5e759"></a>All parameters syntax</h3></div></div></div>
          

          <p>The alternative mechanism is to supply all the parameter
          choices in one go:</p>

          <pre class="programlisting">public Object[] choices&lt;ActionName&gt;([&lt;parameter type&gt; param]...)</pre>

          <p>returning an array, which must have one element per parameter
          in the method signature. Each element of the array should itself
          either be an array or a list, containing the set of values
          representing the choices for that parameter, or <code class="literal">null</code> if there are no choices to be
          specified for that parameter.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Order {
    public Order placeOrder(
            Product product,
            @Named("Quantity") 
            int quantity) {
        ...
    }
    public Object[] choicesPlaceOrder(
            Product product,
            int quantity) {
        return new Object[] {
            lastFiveProductsOrderedBy(this.getCustomer()).toArray(), 
            Arrays.asList(1,2,3,4,5)
        };
    }
    ...
}</pre>
        </div>
      </div>

      <div class="sect1" title="How to specify that a class of objects has a limited number of instances"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.Bounded"></a>How to specify that a class of objects has a limited number of
        instances</h2></div></div></div>
        

        <p>Sometimes an entity may only have a relatively small number of
        instances, for example the types of credit cards accepted (Visa,
        Mastercard, Amex). Viewers will typically expected to render the
        complete set of instances as a drop down list whenever the object type
        is used (ie as a property or action parameter).</p>

        <p>To indicate that a class has a limited number of instances, use
        the <code class="classname">@Bounded</code> annotation. Note that there is an
        implied expectation is that the list of objects is small, and
        relatively cheap to obtain from the object store.</p>

        <p>An alternative way to specify a selection of objects is using
        the <code class="classname">choicesXxx()</code> supporting methods.</p>

        <p>For example:</p>

        <pre class="programlisting">@Bounded
public class PaymentMethod {
    ...
}</pre>

        <p>Alternatively, you might want to use a (Java) <code class="code">enum</code>,
        because these are implicitly bounded.</p>
      </div>

      <div class="sect1" title="How to find an entity (for an action parameter or property) using auto-complete"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e779"></a>How to find an entity (for an action parameter or property)
        using auto-complete</h2></div></div></div>
        

        <p>Some viewers (eg the Wicket viewer) allow an entity to be
        specified (as an argument for an action parameter, or as the new value
        of a property) by enabling the user to type its title. The framework
        then searches for a matching instance, presenting them in a drop-down
        list.</p>

        <p>This is accomplished using two annotations. The
        <code class="classname">@AutoComplete</code> annotation is used on the entity
        type itself:</p>

        <pre class="programlisting">@AutoComplete(repository=Customers.class)
public class Customer {
    ...
}</pre>

        <p>The <code class="code">repository</code> attribute indicates the class of the
        domain service that has an autoComplete() method. This is required to
        accept a single <code class="classname">String</code> and return a
        <code class="classname">List</code> of candidates:</p>

        <pre class="programlisting">public class Customers {
    ...
    @Hidden
    public List&lt;Property&gt; autoComplete(String searchPhrase) {        
        return allMatches(new QueryDefault&lt;Customer&gt;("customers_findByName", "name", searchPhrase));
    }
}</pre>

        <p>If required, a different action name than "autoComplete" can be
        specified.</p>
      </div>

      <div class="sect1" title="How to specify default values for an action parameter"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e791"></a>How to specify default values for an action parameter</h2></div></div></div>
        

        <p>When an action is about to be invoked, then default values can
        be provided for any or all of its parameters.</p>

        <p>There are two different ways to specify parameters; either per
        parameter, or for all parameters.</p>

        <div class="sect2" title="Per-parameter syntax (preferred)"><div class="titlepage"><div><div><h3 class="title"><a name="d5e795"></a>Per-parameter syntax (preferred)</h3></div></div></div>
          

          <p>The per-parameter form is simpler and generally to be
          preferred.</p>

          <p>The syntax is:</p>

          <pre class="programlisting">public ParameterType defaultNActionName()</pre>

          <p>where N indicates the 0-based parameter number. For
          example:</p>

          <pre class="programlisting">public class Customer {
    public Order placeOrder(
             Product product,
             @Named("Quantity") 
             int quantity) {
        ...
    }
    public Product default0PlaceOrder() {
        return productMostRecentlyOrderedBy(this.getCustomer());
    }
    public int default1PlaceOrder() {
        return 1;
    }
}</pre>
        </div>

        <div class="sect2" title="All parameters syntax"><div class="titlepage"><div><div><h3 class="title"><a name="d5e802"></a>All parameters syntax</h3></div></div></div>
          

          <p>The syntax for specifying all the parameter default values in
          one go is:</p>

          <pre class="programlisting">public Object[] defaultActionName([ValueOrEntityType param]...)</pre>

          <p>returning an array which must have one element per parameter
          in the action method signature of corresponding default
          values.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer {
    public Order placeOrder(
            Product product,
            @Named("Quantity") 
            int quantity) {
        ...
    }
    public Object[] defaultPlaceOrder(
            Product product,
            int quantity) {
        return new Object[] {
            productMostRecentlyOrderedBy(this.getCustomer()),
            1
        };
    }
    ...
}</pre>
        </div>
      </div>
    </div>

    <div class="chapter" title="Chapter&nbsp;4.&nbsp;How to derive properties and collections, and other side-effects"><div class="titlepage"><div><div><h2 class="title"><a name="d5e810"></a>Chapter&nbsp;4.&nbsp;How to derive properties and collections, and other
      side-effects</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#sec.DerivedProperty">How to make a derived property</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e818">Read-only</a></span></dt><dt><span class="sect2"><a href="#d5e825">Read-write</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.DerivedCollection">How to make a derived collection</a></span></dt><dt><span class="sect1"><a href="#d5e849">How to inline the results of a query-only repository
        action</a></span></dt><dt><span class="sect1"><a href="#sec.ModifyAndClear">How to trigger other behaviour when a property is
        changed</a></span></dt><dt><span class="sect1"><a href="#sec.AddToRemoveFrom">How to trigger other behaviour when an object is added or
        removed</a></span></dt><dt><span class="sect1"><a href="#sec.MutualRegistrationPattern">How to set up and maintain bidirectional relationships</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>How-to derive properties and collections from persisting state,
        and provide other side-effects.</p>
      </div>

      <p>The Isis viewers will automatically render the state of properties
      and collections, but the values of such need not be persisted; they can
      be derived from other information available to the object. </p>

      <p>For collections</p>

      <div class="sect1" title="How to make a derived property"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.DerivedProperty"></a>How to make a derived property</h2></div></div></div>
        

        <div class="sect2" title="Read-only"><div class="titlepage"><div><div><h3 class="title"><a name="d5e818"></a>Read-only</h3></div></div></div>
          

          <p>Most derived properties are read-only, their value being
          derived from other information available to the object.</p>

          <p>Omitting the mutator (<code class="code">setXxx()</code>) method for a
          property indicates both that the field is derived, and is not be
          persisted.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Employee {
    public Department getDepartment() { ... }
    ...

    // this is the derived property
    public Employee getManager() {
        if (getDepartment() == null) { return null; }
        return getDepartment().getManager();
    }
    ...
}</pre>
        </div>

        <div class="sect2" title="Read-write"><div class="titlepage"><div><div><h3 class="title"><a name="d5e825"></a>Read-write</h3></div></div></div>
          

          <p>A derived property can be made updateable (in that it takes
          the provided value and does something sensible with it) by providing
          a <code class="code">modifyXxx()</code> supporting method:</p>

          <pre class="programlisting">public class Employee {
    public Department getDepartment() { ... }
    ...

    // this is the derived property
    public Employee getManager() { ... }

    // this makes the derived property modifiable
    public void modifyManager(Employee manager) {
        if (getDepartment() == null) { return; }
        getDepartment().modifyManager(manager);
    }

    ...
}</pre>

          <p>Note how the implementation of such a <code class="code">modifyXxx()</code>
          method typically modifies the original source of the information
          (the <code class="classname">Department</code> object).</p>

          <p>Alternatively, if you prefer to have a setter, then you can
          use Isis' <code class="classname">@NotPersisted</code> attribute.</p>

          <pre class="programlisting">public class Employee {
    public Department getDepartment() { ... }
    ...

    @NotPersisted
    public Employee getManager() { ... }
    public void setManager(Employee manager) {
        if (getDepartment() == null) { return; }
        getDepartment().modifyManager(manager);
    }
    ...
}</pre>

          <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
            <p>If you use this approach, then for some object stores you
            may also need to annotate the property to exclude it. For example
            the JDO/DataNucleus object store requires the property being
            annotated with
            <code class="classname">@javax.jdo.annotations.NotPersistent</code>.</p>
          </div>
        </div>
      </div>

      <div class="sect1" title="How to make a derived collection"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.DerivedCollection"></a>How to make a derived collection</h2></div></div></div>
        

        <p>Collections can be derived by omitting the mutator (the same way
        as properties, see <a class="xref" href="#sec.DerivedProperty" title="How to make a derived property">the section called &#8220;How to make a derived property&#8221;</a>).</p>

        <p>For example:</p>

        <pre class="programlisting">public class Department {
    // Standard collection
    private List&lt;Employee&gt; employees = new ArrayList&lt;Employee&gt;();
    public List&lt;Employee&gt; getEmployees() { ... }
    private void setEmployees(List&lt;Employee&gt;) { ... }

    // Derived collection
    public List&lt;Employee&gt; getTerminatedEmployees() {
        List&lt;Employee&gt; terminatedEmployees = new ArrayList&lt;Employee&gt;();
        for(Employee e: employees) {
            if (e.isTerminated()) {
                addTo(terminatedEmployees, e);
            }
        }
        return terminatedEmployees;
    }
    ...
}</pre>

        <p>Derived collections are not persisted, though may be modified if
        there is an <code class="code">addToXxx()</code> or <code class="code">removeFromXxx()</code>
        supporting method. As for derived properties, the implementations of
        these mutators change the underlying data. For example:</p>

        <pre class="programlisting">public class Department {
    ...

    public void addToTerminatedEmployees(Employee employee) {
        employee.setTerminated(true);
    }
    public void removeFromTerminatedEmployees(Employee employee) {
        employee.setTerminated(false);
    }
}</pre>
      </div>

      <div class="sect1" title="How to inline the results of a query-only repository action"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e849"></a>How to inline the results of a query-only repository
        action</h2></div></div></div>
        

        <p>While derived properties (<a class="xref" href="#sec.DerivedProperty" title="How to make a derived property">the section called &#8220;How to make a derived property&#8221;</a>) and derived collections (<a class="xref" href="#sec.DerivedCollection" title="How to make a derived collection">the section called &#8220;How to make a derived collection&#8221;</a>) typically "walk the graph" to
        associated objects, there is nothing to prevent the returned value
        being the result of invoking a repository (domain service)
        action.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Customer {
    ...
    public List&lt;Order&gt; getMostRecentOrders() {
        return orderRepo.findMostRecentOrders(this, 5);
    }
}</pre>
      </div>

      <div class="sect1" title="How to trigger other behaviour when a property is changed"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.ModifyAndClear"></a>How to trigger other behaviour when a property is
        changed</h2></div></div></div>
        

        <p>If you want to invoke functionality whenever a property is
        changed by the user, then you should create a supporting <code class="literal">modifyXxx()</code> method and include the
        functionality within that. The syntax is:</p>

        <pre class="programlisting">public void modifyPropertyName(PropertyType param)</pre>

        <p>Why not just put this functionality in the setter? Well, the
        setter is used by the object store to recreate the state of an already
        persisted object. Putting additional behaviour in the setter would
        cause it to be triggered incorrectly.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Order() {
    public Integer getAmount() { ... }
    public void setAmount(Integer amount) { ... }
    public void modifyAmount(Integer amount) {
        setAmount(amount);
        addToTotal(amount);
    }
    ...
}</pre>

        <p>Here the <code class="literal">modifyAmount()</code>
        method also calls the <code class="literal">addToTotal()</code>
        call as well as the <code class="literal">setAmount()</code>
        method. We don't want this <code class="methodname">addToCall()</code> method
        to be called when pulling the object back from the object store, so we
        put it into the modify, not the setter.</p>

        <p>You may optionally also specify a <code class="code">clearXxx()</code> which
        works the same way as modify <code class="literal">modify</code>
        <code class="literal">Xxx()</code> but is called when the
        property is cleared by the user (i.e. the current value replaced by
        nothing). The syntax is:</p>

        <pre class="programlisting">public void clearPropertyName()</pre>

        <p>To extend the above example:</p>

        <pre class="programlisting">public class Order() {
    public Integer getAmount() { ... }
    public void setAmount(Integer amount) { ... }
    public void modifyAmount(Integer amount) { ... }
    public void clearAmount() {
        removeFromTotal(this.amount);
        setAmount(null);
    }
    ...
}</pre>
      </div>

      <div class="sect1" title="How to trigger other behaviour when an object is added or removed"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.AddToRemoveFrom"></a>How to trigger other behaviour when an object is added or
        removed</h2></div></div></div>
        

        <p>A collection may have a corresponding <code class="literal">addToXxx()</code> and/or <code class="literal">removeFromXxx()</code> method. If present, and
        direct manipulation of the contents of the connection has not been
        disabled (see <a class="xref" href="#sec.DisabledCollection" title="How to prevent a collection from being modified">the section called &#8220;How to prevent a collection from being modified&#8221;</a>), then they
        will be called (instead of adding/removing an object directly to the
        collection returned by the accessor).</p>

        <p>The reason for this behaviour is to allow other behaviour to be
        triggered when the contents of the collection is altered. That is, it
        is directly equivalent to the supporting <code class="literal">modifyXxx()</code> and <code class="literal">clearXxx()</code> methods for properties (see <a class="xref" href="#sec.ModifyAndClear" title="How to trigger other behaviour when a property is changed">the section called &#8220;How to trigger other behaviour when a property is
        changed&#8221;</a>).</p>

        <p>The syntax is:</p>

        <pre class="programlisting">public void addTo&lt;CollectionName&gt;(EntityType param)</pre>

        <p>and</p>

        <pre class="programlisting">public void removeFromCollectionName(EntityType param)</pre>

        <p>where <code class="literal">EntityType</code> is the same
        type as the generic collection type.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Employee { ... }

public class Department {
    private List&lt;Employee&gt; employees = new ArrayList&lt;Employee&gt;();
    public List &lt;Employee&gt; getEmployees() {
        return employees;
    }
    private void setEmployees(List&lt;Employee&gt; employees) { 
        this.employees = employees;
    }
    public void addToEmployees(Employee employee) {
        numMaleEmployees += countOneMale(employee);
        numFemaleEmployees += countOneFemale(employee);
        employees.add(employee);
    }
    public void removeFromEmployees(Employee employee) {
        numMaleEmployees -= countOneMale(employee);
        numFemaleEmployees -= countOneFemale(employee);
        employees.remove(employee);
    }
    private int countOneMale(Employee employee) { return employee.isMale()?1:0; }
    private int countOneFemale(Employee employee) { return employee.isFemale()?1:0; }

    ...
}</pre>
      </div>

      <div class="sect1" title="How to set up and maintain bidirectional relationships"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.MutualRegistrationPattern"></a>How to set up and maintain bidirectional relationships</h2></div></div></div>
        

        <p>The <code class="methodname">modifyXxx()</code> and
        <code class="methodname">clearXxx()</code> methods (see <a class="xref" href="#sec.ModifyAndClear" title="How to trigger other behaviour when a property is changed">the section called &#8220;How to trigger other behaviour when a property is
        changed&#8221;</a>) can be used to setup bidirectional
        relationships. This is typically done with 1:m relationships, eg
        between <code class="classname">Order</code> and
        <code class="classname">OrderLine</code>, or <code class="classname">Department</code>
        and <code class="classname">Employee</code>.</p>

        <p>The recommended way of maintaining a bidirectional relationship
        is to use the 'mutual registration pattern', a write-up of which can
        be found at <a class="ulink" href="http://www.two-sdg.demon.co.uk/curbralan/papers/MutualRegistration.pdf" target="_top">http://www.two-sdg.demon.co.uk/curbralan/papers/MutualRegistration.pdf</a>.
        The general idea is that one side of the relationship is responsible
        for maintaining the associations, while the other side simply
        delegates.</p>

        <p>To implement this in <span class="emphasis"><em>Isis</em></span> for a 1:m
        relationship, use the <code class="methodname">addToXxx()</code> /
        <code class="methodname">removeFromXxx()</code> and
        <code class="methodname">modifyXxx()</code> /
        <code class="methodname">clearXxx()</code> methods.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Department {
    private List&lt;Employee&gt; employees = new ArrayList&lt;Employee&gt;();
    public List&lt;Employee&gt; getEmployees() { ... }
    private void setEmployees(List&lt;Employee&gt; employees) { ... }
    public void addToEmployees(Employee e) {
        if(e == null || employees.contains(e)) return;
        e.setDepartment(this);
        employees.add(e);
    }
    public void removeFromEmployees(Employee e) {
        if(e == null || !employees.contains(e)) return;
        e.setDepartment(null);
        employees.remove(e);
    }
    ...
}</pre>

        <p>and</p>

        <pre class="programlisting">public class Employee {
    private Department department;
    public Department getDepartment() { ... }
    private void setDepartment(Department department) { ... }
    public void modifyDepartment(Department d) {
        if(d==null || department==d) return;
        if(department != null) {
            department.removeFromEmployees(this);
        }
        d.addToEmployees(this);
    }
    public void clearDepartment() {
        if(department==null) return;
        department.removeFromEmployees(this);
    }
    ...
}</pre>

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>For some object stores this explicit coding may not be
          necessary; the object store automatically maintains the
          relationship.</p>
        </div>
      </div>
    </div>

    <div class="chapter" title="Chapter&nbsp;5.&nbsp;How to provide additional UI hints"><div class="titlepage"><div><div><h2 class="title"><a name="d5e919"></a>Chapter&nbsp;5.&nbsp;How to provide additional UI hints</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d5e927">How to specify a name and/or description for an
        object</a></span></dt><dt><span class="sect1"><a href="#d5e939">How to specify a name and/or description for a property</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e941">Specifying the name for a property</a></span></dt><dt><span class="sect2"><a href="#d5e947">Specifying a description for a property</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e953">How to specify a name and/or description for a
        collection</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e955">Specifying the name for a collection</a></span></dt><dt><span class="sect2"><a href="#d5e961">Specifying a description for a collection</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e967">How to specify names and/or description for an action</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e969">Specifying the name for an action</a></span></dt><dt><span class="sect2"><a href="#d5e975">Specifying a description for a collection</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e981">How to specify the icon for an individual object's
        state</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>How to override Isis' defaults for presentation.</p>
      </div>

      <p>With the exception of value types for action parameters (see <a class="xref" href="#sec.ActionParameterNames" title="How to specify names and/or descriptions for an action parameter">the section called &#8220;How to specify names and/or descriptions for an action
        parameter&#8221;</a>), Isis can normally infer a
      reasonable name for entity/service and its class members. However, these
      defaults can be overridden if required. One possible case is where the
      desired name is a reserved word in Java (eg "default", or
      "package").</p>

      <p>A slightly more advanced use-case is to specify an icon not for an
      entity's type, but for an entity instance. Typically this reflects that
      instance's state, eg with an overlay on top of the base icon. For
      example, this allows the user to distinguish between an
      <code class="classname">Order</code> that has been placed vs one that has been
      shipped.</p>

      <div class="sect1" title="How to specify a name and/or description for an object"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e927"></a>How to specify a name and/or description for an
        object</h2></div></div></div>
        

        <p>By default, the name (or type) of an object, as displayed to the
        user will be the class name. However, if an <code class="literal">@Named</code> annotation is included, then this
        will override the default name. This might be used to include
        punctuation or other characters that may not be used within a class
        name, or when - for whatever reason - the name of the class includes
        technical artifacts (for example project-defined prefixes or
        suffices). It is also useful if the required name cannot be used
        because it is a keyword in the language.</p>

        <p>By default the framework will create a plural version of the
        object name by adding an 's' to singular name, or a 'ies' to names
        ending 'y'. For irregular nouns or other special case, the
        <code class="code">@Plural</code> annotation may be used to specify the plural form
        of the name explicitly.t</p>

        <p>The programmer may optionally also provide a <code class="literal">@DescribedAs</code> annotations, containing a brief
        description of the object's purpose, from a user perspective. The
        framework will make this available to the user in a form appropriate
        to the user interface style - for example as a tooltip.</p>

        <p>For example:</p>

        <pre class="programlisting">@Named("Customer")
@Plural("Customers")
@DescribedAs("Individuals or organizations that have either "+
             "purchased from us in the past or "+
             "are likely to in the future")
public class CustomerImpl implements ICustomer {
    ...
}</pre>

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>There is an entirely separate mechanism for dealing with
          Internationalisation, details of which can be found in the core
          documentation.</p>
        </div>
      </div>

      <div class="sect1" title="How to specify a name and/or description for a property"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e939"></a>How to specify a name and/or description for a property</h2></div></div></div>
        

        <div class="sect2" title="Specifying the name for a property"><div class="titlepage"><div><div><h3 class="title"><a name="d5e941"></a>Specifying the name for a property</h3></div></div></div>
          

          <p>By default the framework will use the property name itself to
          label the property on the user interface. If you wish to override
          this, use the <code class="literal">@Named </code>annotation
          on the property.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer() {
    @Named("Given Name")
    public String getFirstName() { ... }
    ...
}</pre>
        </div>

        <div class="sect2" title="Specifying a description for a property"><div class="titlepage"><div><div><h3 class="title"><a name="d5e947"></a>Specifying a description for a property</h3></div></div></div>
          

          <p>An additional description can be provided on a property using
          the <code class="literal">@DescribedAs</code> annotation. The
          framework will take responsibility to make this description
          available to the user, for example in the form of a tooltip.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer() {
    @DescribedAs("The customer's given name")
    public String getFirstName() { ... }
    ...
}</pre>
        </div>
      </div>

      <div class="sect1" title="How to specify a name and/or description for a collection"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e953"></a>How to specify a name and/or description for a
        collection</h2></div></div></div>
        

        <div class="sect2" title="Specifying the name for a collection"><div class="titlepage"><div><div><h3 class="title"><a name="d5e955"></a>Specifying the name for a collection</h3></div></div></div>
          

          <p>By default the framework will use the collection name itself
          to label the collection on the user interface. If you wish to
          override this, use the <code class="literal">@Named</code>
          annotation on the collection.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer {
    @Named("Placed Orders")
    public List&lt;Order&gt; getOrders() { ... }
    ...
}</pre>
        </div>

        <div class="sect2" title="Specifying a description for a collection"><div class="titlepage"><div><div><h3 class="title"><a name="d5e961"></a>Specifying a description for a collection</h3></div></div></div>
          

          <p>An additional description can be provided on a collection
          using the <code class="literal">@DescribedAs</code>
          annotation. The framework will take responsibility to make this
          description available to the user, for example in the form of a
          tooltip.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer {
    @DescribedAs("Those orders that have been placed (and possibly shipped) " + 
                 "by this customer given name by which this customer is known")
    public List&lt;Order&gt; getOrders() { ... }
    ...
}</pre>
        </div>
      </div>

      <div class="sect1" title="How to specify names and/or description for an action"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e967"></a>How to specify names and/or description for an action</h2></div></div></div>
        

        <div class="sect2" title="Specifying the name for an action"><div class="titlepage"><div><div><h3 class="title"><a name="d5e969"></a>Specifying the name for an action</h3></div></div></div>
          

          <p>By default the framework will use the action name itself to
          label the menu item on the user interface. If you wish to override
          this, use the <code class="literal">@Named</code> annotation
          on the action.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer {
    @Named("Place Order")
    public void createOrder() { ... }
    ...
}</pre>
        </div>

        <div class="sect2" title="Specifying a description for a collection"><div class="titlepage"><div><div><h3 class="title"><a name="d5e975"></a>Specifying a description for a collection</h3></div></div></div>
          

          <p>An additional description can be provided on an action using
          the <code class="literal">@DescribedAs</code> annotation. The
          framework will take responsibility to make this description
          available to the user, for example in the form of a tooltip.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer {
    @DescribedAs("Places an order, causing a shipping note "+
                 "to be generated and invoice to be dispatched")
    public void createOrder() { ... }
    ...
}</pre>
        </div>
      </div>

      <div class="sect1" title="How to specify the icon for an individual object's state"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e981"></a>How to specify the icon for an individual object's
        state</h2></div></div></div>
        

        <p>As discussed in <a class="xref" href="#sec.HowToSpecifyTheIconForAnObjectsClass" title="How to specify the icon for a domain entity">the section called &#8220;How to specify the icon for a domain
        entity&#8221;</a>, the
        <code class="code">iconName()</code> method may be used to specify an object. The
        value returned from this method need not be static, and so it can be
        used to represent the state of an individual object.</p>

        <p>For example, an instance of <code class="classname">Product</code> could
        use a photograph of the product as an icon, using:</p>

        <pre class="programlisting">public class Product {
    public String iconName() {
        return "Product-" + getPhotograph();
    }
    ...
}</pre>

        <p>Alternatively, an <code class="classname">Order</code> might vary the
        icon according to the status of the object:</p><pre class="programlisting">public class Order {
    public String iconName() {
        return "Order-" + getStatus();
    }
    ...
}</pre>
      </div>
    </div>

    <div class="chapter" title="Chapter&nbsp;6.&nbsp;How to deal with errors"><div class="titlepage"><div><div><h2 class="title"><a name="d5e992"></a>Chapter&nbsp;6.&nbsp;How to deal with errors</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#sec.passMessagesAndErrors">How to pass a messages and errors back to the user</a></span></dt><dt><span class="sect1"><a href="#d5e1017">How to deal with an unexpected error</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>How to inform the user if an error occurs.</p>
      </div>

      <p>Things go wrong. Isis handles many of the usual error conditions,
      but your app may also wish to notify the user also when something goes
      awry.</p>

      <div class="sect1" title="How to pass a messages and errors back to the user"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.passMessagesAndErrors"></a>How to pass a messages and errors back to the user</h2></div></div></div>
        

        <p>Sometimes, within an action it is necessary or desirable to pass
        a message to the user, for example to inform them of the results of
        their action ('5 payments have been issued') or that the action was
        not successful ('No Customer found with name John Smith').</p>

        <p><code class="code">DomainObjectContainer</code> defines three methods for
        this purpose:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="methodname">informUser(String message)</code></p>

            <p>Inform the user of some event. The user should not be
            expected to acknowledge the message; typically the viewer will
            display the message for a period of time in a non-modal
            notification window.</p>
          </li><li class="listitem">
            <p><code class="methodname">warnUser(String message)</code></p>

            <p>Warn the user of some event. Because this is more serious,
            the viewer should require the user to acknowledge the
            message.</p>
          </li><li class="listitem">
            <p><code class="methodname">raiseError(String message)</code></p>

            <p>Indicate that a serious application error has occurred. The
            viewer should again require the user to acknowledge the message,
            and quite possibly indicate further steps that the user should
            perform (eg notify the help desk).</p>

            <p>In this last case, no changes will be made to any objects
            (the transaction is aborted).</p>
          </li></ul></div>

        <p>The precise mechanics of how each of these messages is rendered
        visible to the user is determined by the viewer being used.</p>
      </div>

      <div class="sect1" title="How to deal with an unexpected error"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1017"></a>How to deal with an unexpected error</h2></div></div></div>
        

        <p>An alternative to calling
        <code class="code">DomainObjectContainer#raiseError()</code> (see <a class="xref" href="#sec.passMessagesAndErrors" title="How to pass a messages and errors back to the user">the section called &#8220;How to pass a messages and errors back to the user&#8221;</a>) is to simply throw an
        org.apache.isis.applib.ApplicationException. Which you use is a matter
        of style, because the behaviour is exactly the same; internally
        <code class="code">raiseError()</code> just throws the
        <code class="code">ApplicationException</code>.</p>
      </div>
    </div>

    <div class="chapter" title="Chapter&nbsp;7.&nbsp;How to handle entity persistence lifecycle"><div class="titlepage"><div><div><h2 class="title"><a name="d5e1024"></a>Chapter&nbsp;7.&nbsp;How to handle entity persistence lifecycle</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#sec.DefaultPropertyValue">How to set up the initial value of a property
        programmatically</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1033">By each property's default values</a></span></dt><dt><span class="sect2"><a href="#d5e1042">By the <code class="methodname">created()</code> lifecycle
          method</a></span></dt><dt><span class="sect2"><a href="#d5e1049">Programmatically, by the creator</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.LifecycleMethods">How to insert behaviour into the object life cycle</a></span></dt><dt><span class="sect1"><a href="#d5e1114">How to ensure object is in valid state</a></span></dt><dt><span class="sect1"><a href="#d5e1133">How to specify that an object should not be
        persisted</a></span></dt><dt><span class="sect1"><a href="#sec.ResolveAndObjectChanged">How to perform lazy loading (generally done
        automatically)</a></span></dt><dt><span class="sect1"><a href="#d5e1150">How to perform dirty object tracking (generally done
        automatically)</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>How to hook into the entity persistence lifecycle and handle
        specific scenarios</p>
      </div>

      <p>Isis automatically persists domain entities, performing both lazy
      loading and dirty object tracking. As an application programmer you can
      get visibility into and influence this behaviour.</p>

      <div class="sect1" title="How to set up the initial value of a property programmatically"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.DefaultPropertyValue"></a>How to set up the initial value of a property
        programmatically</h2></div></div></div>
        

        <p>After an object has been created (see <a class="xref" href="#sec.HowToCreateAnObject" title="How to create or delete objects within your code">the section called &#8220;How to create or delete objects within your code&#8221;</a>), there are several different
        ways to setup the initial values for an object's properties.</p>

        <div class="sect2" title="By each property's default values"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1033"></a>By each property's default values</h3></div></div></div>
          

          <p>Firstly, the default value for a property can be supplied
          using a supporting <code class="methodname">defaultXxx()</code> method. The
          syntax for specifying a default value is:</p>

          <pre class="programlisting">public PropertyType defaultPropertyName()</pre>

          <p>where <code class="literal">PropertyType</code> is the
          same type as that of the property itself.</p>

          <pre class="programlisting">public class Order {
    public Address getShippingAddress() { ... }
    public void setShippingAddress() { ... }
    public Address defaultShippingAddress() {
        return getCustomer().normalAddress();
    }
    ...
}</pre>
        </div>

        <div class="sect2" title="By the created() lifecycle method"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1042"></a>By the <code class="methodname">created()</code> lifecycle
          method</h3></div></div></div>
          

          <p>Alternatively, the domain object may choose to initialize its
          property values in the <code class="literal">created()</code>
          lifecycle method (see <a class="xref" href="#sec.LifecycleMethods" title="How to insert behaviour into the object life cycle">the section called &#8220;How to insert behaviour into the object life cycle&#8221;</a>). This
          is called after any <code class="methodname">defaultXxx()</code> methods
          are called.</p>
        </div>

        <div class="sect2" title="Programmatically, by the creator"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1049"></a>Programmatically, by the creator</h3></div></div></div>
          

          <p>Third, and perhaps most obviously, the creator of the object
          could initialize the properties of the object immediately after
          calling <code class="methodname">newTransientInstance(...)</code>. This
          would be appropriate if the creator had reason to override any
          values setup in the <code class="methodname">defaultXxx()</code> or
          <code class="methodname">created()</code> methods discussed above.</p>
        </div>
      </div>

      <div class="sect1" title="How to insert behaviour into the object life cycle"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.LifecycleMethods"></a>How to insert behaviour into the object life cycle</h2></div></div></div>
        

        <p><span class="emphasis"><em>Apache Isis</em></span> is responsible for managing the
        object lifecycle, persisting, updating or removing objects from the
        persistent object store as required. For many applications the domain
        objects are unaware of this. If required, though, an object can
        provide callback methods (all optional) so that the framework can
        notify it of its persistence state.</p>

        <p>For example, the <code class="literal"><code class="methodname">persisted</code></code>() method
        is called after an object has been persisted. This could be used to
        setup a reverse association that should only be created once the new
        object has been persisted.</p>

        <p>The full list of callbacks is shown below.</p>

        <div class="table"><a name="d5e1063"></a><p class="title"><b>Table&nbsp;7.1.&nbsp;Object lifecycle methods</b></p><div class="table-contents">
          

          <table summary="Object lifecycle methods" border="1"><colgroup><col width="105" align="left"><col align="left"></colgroup><thead><tr><th align="center">Method</th><th align="center">When called by framework</th></tr></thead><tbody><tr><td align="left"><code class="methodname">created()</code></td><td align="left">following the logical creation of the object (that is,
                after <code class="methodname">newTransientInstance()</code> has been
                called)</td></tr><tr><td align="left"><code class="methodname">loading()</code></td><td align="left">when a persistent object is about to be loaded into
                memory</td></tr><tr><td align="left"><code class="methodname">loaded()</code></td><td align="left">once the persistent object has just been loaded into
                memory</td></tr><tr><td align="left"><code class="methodname">persisting()</code> or
                <code class="methodname">saving()</code></td><td align="left">just before a transient object is first
                persisted.</td></tr><tr><td align="left"><code class="methodname">persisted()</code> or
                <code class="methodname">saved()</code></td><td align="left">just after a transient object is first
                persisted.</td></tr><tr><td align="left"><code class="methodname">updating()</code></td><td align="left">after any property on a persistent object has been
                changed and just before this change is persisted</td></tr><tr><td align="left"><code class="methodname">updated()</code></td><td align="left">after a changed property on a persistent object has
                been persisted</td></tr><tr><td align="left"><code class="methodname">removing()</code> or
                <code class="methodname">deleting()</code></td><td align="left">when a persistent object is just about to be deleted
                from the persistent object store.</td></tr><tr><td align="left"><code class="methodname">removed()</code> or
                <code class="methodname">deleted()</code></td><td align="left">when a persistent object has just been deleted from the
                persistent object store.</td></tr></tbody></table>
        </div></div><br class="table-break">
      </div>

      <div class="sect1" title="How to ensure object is in valid state"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1114"></a>How to ensure object is in valid state</h2></div></div></div>
        

        <p>A <code class="methodname">validate()</code> method may be added to
        provided validation at object level, prior to making an object
        persistent.</p>

        <p>The syntax is:</p>

        <pre class="programlisting">public String validate()</pre>

        <p>A non-<code class="code">null</code> value is the taken to be the reason why
        the object cannot be saved.</p>

        <p>This is particularly useful for validating fields in relation to
        each other.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Booking {
    private Date fromDate;
    public Date getFromDate() {...}
    public void setFromDate(Date d) {...}
    
    private Date toDate;
    public Date getToDate() {...}
    public void setToDate(Date d) {...}

    public String validate() {
        if (fromDate.getTicks() &gt; toDate.getTicks()) {
            return "From Date cannot be after To Date";
        }
        return null;
    }
    ...
}</pre>

        <p>This will prevent the user from saving a transient
        <code class="code">Booking</code> where the From Date falls after the To Date. Note
        that in this example, the two date properties could also have their
        own individual validate methods - for example in order to test that
        each date was after today.</p>

        <div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
          <p>At the time of writing, the <code class="code">validate()</code> method is
          called only when the object is first saved, not when it is
          subsequently updated. For validation of subsequent updates, the
          workaround is necessary to build the validation logic into the
          individual property validation methods (though these could delegate
          to a common <code class="code">validate()</code> method).</p>

          <p>See <a class="ulink" href="https://issues.apache.org/jira/browse/ISIS-18" target="_top">ISIS-18</a>
          for the status of this issue.</p>
        </div>
      </div>

      <div class="sect1" title="How to specify that an object should not be persisted"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1133"></a>How to specify that an object should not be
        persisted</h2></div></div></div>
        

        <p>Non-persisted objects are intended to be used as view models;
        they aggregate some state with respect to a certain process. This may
        be read-only (eg a projection of certain informaiton) or read-write
        (eg a wizard-like process object). Either way, the viewer is expected
        to interpret this by not providing any sort of automatic "save" menu
        item if such an object is returned to the
        <acronym class="acronym">GUI</acronym>.</p>

        <p>Non-persisted objects that are read-only are typically also
        marked as immutable (see <a class="xref" href="#sec.Immutable" title="How to specify that an object is immutable (that none of its members can ever be modified)">the section called &#8220;How to specify that an object is
        immutable (that none of its members can ever be modified)&#8221;</a>).</p>

        <p>To indicate that an object cannot be persisted, use the <code class="literal">@NotPersistable</code> annotation.</p>
      </div>

      <div class="sect1" title="How to perform lazy loading (generally done automatically)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.ResolveAndObjectChanged"></a>How to perform lazy loading (generally done
        automatically)</h2></div></div></div>
        

        <p>The <code class="classname">DomainObjectContainer</code> provides the
        <code class="methodname">resolve()</code> method in order to lazily resolve
        the value of a property or a collection. In earlier versions of the
        framework it was necessary to call this method prior to accessing or
        mutating any property or collection. This is no longer required
        because <span class="emphasis"><em>Apache Isis</em></span> uses bytecode enhancement to
        automatically call this method.</p>

        <p>While it is possible to disable this bytecode enhancement using
        <code class="filename">isis.properties</code> file, this is not generally
        recommended. If it is disabled then the
        <code class="methodname">resolve()</code> method may need to be called
        manually.</p>
      </div>

      <div class="sect1" title="How to perform dirty object tracking (generally done automatically)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1150"></a>How to perform dirty object tracking (generally done
        automatically)</h2></div></div></div>
        

        <p>The <code class="classname">DomainObjectContainer</code> provides the
        <code class="methodname">objectChanged()</code> method in order to mark an
        object's state as having changed, and therefore requiring an update to
        the persistent object store. In earlier versions of the framework it
        was necessary to call this method after mutating any the property or
        collection. This is no longer required because <span class="emphasis"><em>Apache
        Isis</em></span> uses bytecode enhancement to automatically call this
        method.</p>

        <p>While it is possible to disable this bytecode enhancement using
        <code class="filename">isis.properties</code> file, this is not generally
        recommended. If it is disabled then the
        <code class="methodname">objectChanged()</code> method may need to be called
        manually.</p>
      </div>
    </div>

    <div class="chapter" title="Chapter&nbsp;8.&nbsp;How to handle security concerns"><div class="titlepage"><div><div><h2 class="title"><a name="d5e1159"></a>Chapter&nbsp;8.&nbsp;How to handle security concerns</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#sec.BusinessRulesForCertainUsersOrRoles">Hiding, disabling or validating for specific users or
        roles</a></span></dt><dt><span class="sect1"><a href="#d5e1180">How to use Isis' authorization manager</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>Further validation how-to's that apply across all class
        members</p>
      </div>

      <p>This chapter has some additional recipes/how-tos relating to
      implementing business rules. They apply across all class members.</p>

      <div class="sect1" title="Hiding, disabling or validating for specific users or roles"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.BusinessRulesForCertainUsersOrRoles"></a>Hiding, disabling or validating for specific users or
        roles</h2></div></div></div>
        

        <p>Generally it is not good practice to embed knowledge of roles
        and/or users into the domain classes; instead, this should be the
        responsibility of the framework or platform and should be specified
        and administered externally to the domain model. However, in rare
        circumstances it might be necessary or pragmatic to implement access
        control within the domain model.</p>

        <p>The current user can be obtained from
        <code class="classname">DomainObjectContainer</code>, using its
        <code class="methodname">getUser()</code> method. Alternatively, if the
        domain object inherits from
        <code class="classname">AbstractDomainObject</code>, then
        <code class="methodname">getUser()</code> is also inherited. In either case
        the method returns an object of type
        <code class="methodname">org.apache.isis.security.UserMemento</code>, which
        holds both username and the set of roles for that user. The full
        details of the security classes can be found in <a class="xref" href="#apx.SecurityClasses" title="Appendix&nbsp;D.&nbsp;Security Classes">Appendix&nbsp;D, <i>Security Classes</i></a>.</p>

        <p>The mechanism to apply a business rule is just to return an
        appropriate value from a supporting
        <code class="methodname">hideXxx()</code>,
        <code class="methodname">disableXxx()</code> or
        <code class="methodname">validateXxx()</code> method.</p>

        <p>For example, the following requires that the MODIFY_SALARY role
        is assigned to the current user in order to update a salary property
        beyond a certain value:</p>

        <pre class="programlisting">public class Employee extends AbstractDomainObject {
    public BigDecimal getSalary() { ... }
    public void setSalary(BigDecimal salary) { ... }
    public String validateSalary() {
        return salary.doubleValue() &gt;= 30000 &amp;&amp;
              !getUser().hasRole("MODIFY_SALARY")?
              "Need MODIFY_SALARY role to increase salary above 30000": null;
    }
}</pre>
      </div>

      <div class="sect1" title="How to use Isis' authorization manager"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1180"></a>How to use Isis' authorization manager</h2></div></div></div>
        

        <p>An alternative to hard-coding role names within the domain
        entities is instead to configure an authorization manager. This is a
        component that can either hide or disable access to class members
        (properties, collections, actions).</p>

        <p>The core "bypass" authorization manager simply provides access
        to all class members.</p>

        <p>To enable a different authorization manager, update the
        <code class="code">isis.properties</code> file, for example:</p>

        <pre class="programlisting">isis.authorization=file</pre>

        <p>Also update the <code class="filename">pom.xml</code> to reference this
        component, for example:</p>

        <pre class="programlisting">&lt;properties&gt;
    ...
    &lt;isis-security-file.version&gt;1.0.0-SNAPSHOT&lt;/isis-security-file.version&gt;
&lt;/properties&gt;

&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
        ...
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.isis.security&lt;/groupId&gt;
            &lt;artifactId&gt;isis-security-file&lt;/artifactId&gt;
            &lt;version&gt;${isis-security-file.version}&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;import&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;

&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.apache.isis.security&lt;/groupId&gt;
        &lt;artifactId&gt;isis-security-file&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</pre>

        <p>See the documentation for the chosen authorization manager as to
        how security information should be configured. For example, the
        file-based authorization manager reads from some configuration files
        alongside <code class="filename">isis.properties</code>.</p>
      </div>
    </div>

    <div class="chapter" title="Chapter&nbsp;9.&nbsp;Domain Services, Repositories and Factories"><div class="titlepage"><div><div><h2 class="title"><a name="chp.DomainServices"></a>Chapter&nbsp;9.&nbsp;Domain Services, Repositories and Factories</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#sec.Services">How to register domain services, repositories and
        factories</a></span></dt><dt><span class="sect1"><a href="#d5e1208">How to write a typical domain service</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1215">The <code class="methodname">getId()</code> method</a></span></dt><dt><span class="sect2"><a href="#d5e1223">(Suppressing) contributed actions</a></span></dt><dt><span class="sect2"><a href="#d5e1245">(Suppressing) service menu items</a></span></dt><dt><span class="sect2"><a href="#d5e1254">(Suppressing) service menus</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1259">How to use a generic repository</a></span></dt><dt><span class="sect1"><a href="#sec.CustomRepository">How to write a custom repository</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1307">Finding by Title</a></span></dt><dt><span class="sect2"><a href="#d5e1323">Finding by Pattern</a></span></dt><dt><span class="sect2"><a href="#d5e1345">Finding using the <code class="classname">Filter</code> API</a></span></dt><dt><span class="sect2"><a href="#d5e1368">Finding using the <code class="classname">Query</code> API</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1412">Factories</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>How-to's relating to writing services, repositories and
        factories.</p>
      </div>

      <p>This chapter contains how-to's for programming conventions that
      writing domain services (by which we also mean repositories and
      factories); ie everything that isn't a domain object or a value
      type.</p>

      <p>Domain services are instantiated once and once only by the
      framework, and are used to centralize any domain logic that does not
      logically belong in a domain entity or value. <span class="emphasis"><em>Isis</em></span>
      will automatically inject services into every domain entity that
      requests them, and into each other.</p>

      <div class="sect1" title="How to register domain services, repositories and factories"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.Services"></a>How to register domain services, repositories and
        factories</h2></div></div></div>
        

        <p>All domain services (which includes repositories and factories)
        should be registered in the isis.properties configuration file, under
        the <code class="varname">isis.services.prefix</code> (a common package name)
        and <code class="varname">isis.services</code> key (a comma-separated
        list).</p>

        <p>For example:</p>

        <pre class="programlisting">isis.services.prefix = org.apache.isis.support.prototype.objstore.dflt
isis.services = employee.EmployeeRepositoryDefault, claim.ClaimRepositoryDefault</pre>

        <p>This will instantiate a single instance of each of the two
        services listed.</p>
      </div>

      <div class="sect1" title="How to write a typical domain service"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1208"></a>How to write a typical domain service</h2></div></div></div>
        

        <p>Services consist of a set of logically grouped actions, and as
        such follow the same conventions as for entities (see <a class="xref" href="#">???</a>). However, a service cannot have (persisted)
        properties, nor can it have (persisted) collections.</p>

        <p>For convenience you can inherit from
        <code class="classname">AbstractService</code> or one of its subclasses (see
        <a class="xref" href="#sec.AbstractService" title="How to have a domain service be a POJO (not inherit from framework superclasses)">the section called &#8220;How to have a domain service be a POJO (not inherit from
        framework superclasses)&#8221;</a>), but this is not
        mandatory.</p>

        <div class="sect2" title="The getId() method"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1215"></a>The <code class="methodname">getId()</code> method</h3></div></div></div>
          

          <p>Optionally, a service may provide a
          <code class="methodname">getId()</code> method:</p>

          <pre class="programlisting">public String getId()</pre>

          <p>This method returns a logical identifier for a service,
          independent of its implementation. Currently it used only by
          perspectives, providing a label by which to record the services that
          are available for a current user's profile. See <a class="xref" href="#chp.UserProfiles" title="Chapter&nbsp;12.&nbsp;Profiles">Chapter&nbsp;12, <i>Profiles</i></a> for more about profiles and
          perspectives.</p>
        </div>

        <div class="sect2" title="(Suppressing) contributed actions"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1223"></a>(Suppressing) contributed actions</h3></div></div></div>
          

          <p>Any n-parameter action provided by a service will
          automatically be contributed to the list of actions for each of its
          (entity) parameters. From the viewpoint of the entity the action is
          called a contributed action.</p>

          <p>For example, given a service:</p>

          <pre class="programlisting">public interface Library {
    public Loan borrow(Loanable l, Borrower b);
}</pre>

          <p>and the entities:</p>

          <pre class="programlisting">public class Book implements Loanable { ... }y</pre>

          <p>and</p>

          <pre class="programlisting">public class LibraryMember implements Borrower { ... }</pre>

          <p>then the <code class="methodname">borrow(...)</code> action will be
          contributed to both <code class="classname">Book</code> and to
          <code class="classname">LibraryMember</code>.</p>

          <p>This is an important capability because it helps to decouple
          the concrete classes from the services.</p>

          <p>If necessary, though, this behaviour can be suppressed by
          annotating the service action with
          <code class="classname">@org.apache.isis.applib.annotations.NotContributed</code>.</p>

          <p>For example:</p>

          <pre class="programlisting">public interface Library {
    @NotContributed
    public Loan borrow(Loanable l, Borrower b);
}</pre>

          <p>If annotated at the interface level, then the annotation will
          be inherited by every concrete class. Alternatively the annotation
          can be applied at the implementation class level and only apply to
          that particular implementation.</p>

          <p>Note that an action annotated as being
          <code class="classname">@NotContributed</code> will still appear in the
          service menu for the service. If an action should neither be
          contributed nor appear in service menu items, then simply annotate
          it as <code class="classname">@Hidden</code>.</p>
        </div>

        <div class="sect2" title="(Suppressing) service menu items"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1245"></a>(Suppressing) service menu items</h3></div></div></div>
          

          <p>By default every action of a service (by which we also mean
          repositories and factories) will be rendered in the viewer, eg as a
          menu item for that service menu. This behaviour can be suppressed by
          annotating the action using
          <code class="classname">@org.apache.isis.applib.annotations.NotInServiceMenu</code>.</p>

          <p>For example:</p>

          <pre class="programlisting">public interface Library {
    @NotInServiceMenu
    public Loan borrow(Loanable l, Borrower b);
}</pre>

          <p>Note that an action annotated as being
          <code class="classname">@NotInServiceMenu</code> will still be contributed.
          If an action should neither be contributed nor appear in service
          menu items, then simply annotate it as
          <code class="classname">@Hidden</code>.</p>
        </div>

        <div class="sect2" title="(Suppressing) service menus"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1254"></a>(Suppressing) service menus</h3></div></div></div>
          

          <p>If none of the service menu items should appear, then the
          service itself should be annotated as @Hidden.</p>

          <p>For example:</p>

          <pre class="programlisting">@Hidden
public interface EmailService {
    public void sendEmail(String to, String from, String subject, String body);
    public void forwardEmail(String to, String from, String subject, String body);
}</pre>
        </div>
      </div>

      <div class="sect1" title="How to use a generic repository"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1259"></a>How to use a generic repository</h2></div></div></div>
        

        <p>To speed up initial prototype the framework allows so-called
        generic repositories to be defined, one per entity. Such a repository
        will, for its specified type, provide methods to:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>Create a new transient instance</p>
          </li><li class="listitem">
            <p>Create a new persisted instance</p>
          </li><li class="listitem">
            <p>Find all persisted instances</p>
          </li><li class="listitem">
            <p>Find instances with a specified title</p>
          </li></ul></div>

        <p>To register such a service prefix the class name with the prefix
        <code class="literal">repository#</code>.</p>

        <p>For example:</p>

        <pre class="programlisting">isis.services = repository#dom.Booking</pre>

        <p>Over time, you should expect most if not all of these generic
        repositories will be replaced with regular repository types (see <a class="xref" href="#sec.CustomRepository" title="How to write a custom repository">the section called &#8220;How to write a custom repository&#8221;</a>).</p>
      </div>

      <div class="sect1" title="How to write a custom repository"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.CustomRepository"></a>How to write a custom repository</h2></div></div></div>
        

        <p>Repositories are defined as interfaces within the domain, and
        their implementation will vary by object store. During prototyping and
        for much of development, you will probably find it easiest to use an
        in-memory object store or perhaps the <acronym class="acronym">XML</acronym> object
        store, with only a small number of instances. The
        <code class="classname">DomainObjectContainer</code> provides a set of methods
        that make it easy to pull back all instances from the object store
        which can then be filtered as required. Later on, you can replace the
        implementation depending upon the specifics of the object store that
        you'll be using for production.</p>

        <p>If you inherit from the <code class="literal">org.apache.isis.applib.AbstractFactoryAndRepository</code>
        adapter class then this will automatically have the
        <code class="classname">DomainObjectContainer</code> injected, and provides
        convenience methods that delegate to the container. Using this is not
        mandatory, however.</p>

        <p>The methods provided by the
        <code class="classname">DomainObjectContainer</code> to support repositories
        are:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="methodname">allInstances(Class&lt;T&gt;
            ofType)</code></p>

            <p>Returns all instances of the specified type. Note that this
            includes all instances of any subtypes.</p>
          </li><li class="listitem">
            <p><code class="methodname">allMatches(...)</code></p>

            <p>Returns all instances matching the provided
            arguments.</p>
          </li><li class="listitem">
            <p><code class="methodname">firstMatch(...)</code></p>

            <p>Returns the first instance matching the provided
            arguments.</p>
          </li><li class="listitem">
            <p><code class="methodname">uniqueMatch(...)</code></p>

            <p>Returns the one-and-only instance matching the provided
            arguments (else is an exception).</p>
          </li></ul></div>

        <p>The last three methods, <code class="methodname">*Match(...)</code> are
        all overloaded in order to return a subset of object instances. Some
        of these are "naive"; all instances are returned from the object
        store, and the filtering is performed within the repository. Others
        are designed to pass the query predicate back to the object store so
        that only the matching rows are returned.</p>

        <p>Each of these options are discussed in more detail below.</p>

        <div class="sect2" title="Finding by Title"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1307"></a>Finding by Title</h3></div></div></div>
          

          <p>The first version of finding instances is to specify the
          required title for the matching objects:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p><code class="methodname">allMatches(Class&lt;T&gt; ofType, String
              title)</code></p>
            </li><li class="listitem">
              <p><code class="methodname">firstMatch(Class&lt;T&gt; ofType, String
              title)</code></p>
            </li><li class="listitem">
              <p><code class="methodname">uniqueMatch(Class&lt;T&gt; ofType, String
              title)</code></p>
            </li></ul></div>

          <p>Although easy and intuitive, this isn't generally recommended
          for production use because (a) the matching is performed within the
          repository rather than the object store, and (b) the title string
          can often change as business requirements are refined.</p>

          <p>That said, it is possible to eliminate the first disadvantage
          by using the <code class="classname">Query</code> API, discussed below; this
          provides an implementation that is equivalent to find by
          title.</p>
        </div>

        <div class="sect2" title="Finding by Pattern"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1323"></a>Finding by Pattern</h3></div></div></div>
          

          <p>The next technique of finding instances is to specify pattern
          object to match against (sometimes called "query-by-example", or
          <acronym class="acronym">QBE</acronym>):</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p><code class="methodname">allMatches(Class&lt;T&gt; ofType, Object
              pattern)</code></p>
            </li><li class="listitem">
              <p><code class="methodname">firstMatch(Class&lt;T&gt; ofType, Object
              pattern)</code></p>
            </li><li class="listitem">
              <p><code class="methodname">uniqueMatch(Class&lt;T&gt; ofType, Object
              pattern)</code></p>
            </li></ul></div>

          <p>Any non-null value of the pattern object is used as the
          predicate.</p>

          <p>Although more robust that searching by title, this technique
          is also not likely to be valid for production code because the
          matching is still performed within the repository rather than within
          the object store.</p>

          <p>That said, it is possible to eliminate the first disadvantage
          by using the <code class="classname">Query</code> API, discussed below; this
          provides an implementation that is equivalent to find by
          pattern.</p>

          <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
            <p>If the pattern object is created using
            <code class="methodname">newTransientInstance(...)</code>, then any
            default values for properties will automatically be set (see <a class="xref" href="#sec.DefaultPropertyValue" title="How to set up the initial value of a property programmatically">the section called &#8220;How to set up the initial value of a property
        programmatically&#8221;</a>). If this isn't required,
            they will need to be manually cleared.</p>
          </div>
        </div>

        <div class="sect2" title="Finding using the Filter API"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1345"></a>Finding using the <code class="classname">Filter</code> API</h3></div></div></div>
          

          <p>The third overloaded version of the matching methods to find
          instances all take an
          <code class="classname">org.apache.isis.applib.Filter&lt;T&gt;</code>
          instance:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p><code class="methodname">allMatches(Class&lt;T&gt; ofType,
              Filter&lt;T&gt; filter)</code></p>
            </li><li class="listitem">
              <p><code class="methodname">firstMatch(Class&lt;T&gt; ofType,
              Filter&lt;T&gt; filter)</code></p>
            </li><li class="listitem">
              <p><code class="methodname">uniqueMatch(Class&lt;T&gt; ofType,
              Filter&lt;T&gt; filter)</code></p>
            </li></ul></div>

          <p>The <code class="classname">Filter&lt;T&gt;</code> interface is very
          straightforward:</p>

          <pre class="programlisting">public interface Filter&lt;T&gt; {
    public boolean accept(T obj);
}</pre>

          <p>Every object of the given type (and subclasses) is passed into
          the <code class="classname">Filter</code> instance; only those
          <code class="methodname">accept()</code>'ed are returned from the
          <code class="methodname">*Match()</code> method.</p>

          <p>Although flexible, with this technique the matching is also
          performed within the repository rather than the object store, and so
          is also likely not to be suitable for production use where there are
          many instances of the given type.</p>
        </div>

        <div class="sect2" title="Finding using the Query API"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1368"></a>Finding using the <code class="classname">Query</code> API</h3></div></div></div>
          

          <p>The finaly overloaded version of the matching methods take an
          instance of
          <code class="classname">org.apache.isis.applib.query.Query&lt;T&gt;</code>
          interface:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p><code class="methodname">allMatches(Query&lt;T&gt;
              query)</code></p>
            </li><li class="listitem">
              <p><code class="methodname">firstMatch(Query&lt;T&gt;
              query)</code></p>
            </li><li class="listitem">
              <p><code class="methodname">uniqueMatch(Query&lt;T&gt;
              query)</code></p>
            </li></ul></div>

          <p>Unlike all the other matching mechanisms, the point of the
          <code class="classname">Query</code> interface is for it to be passed back
          to the object store and evaluated there.</p>

          <p>The applib provides several implementations that implement the
          <code class="classname">Query&lt;T&gt;</code> interface. Probably the most
          important of these is <code class="classname">QueryDefault&lt;T&gt;</code>,
          which provides a set of factory methods for constructing
          <code class="classname">Query</code> instances that represent a named query
          with a map of parameter/argument pairs.</p>

          <p>For example:</p>

          <pre class="programlisting">public class CustomerRepositoryImpl implements CustomerRepository {
    public List&lt;Customer&gt; findCustomers(
            @Named("Last Name") String lastName,
            @Named("Postcode")  String postCode
        ) {
        QueryDefault&lt;Customer&gt; query = 
            QueryDefault.create(
                Customer.class, 
                "findCustomers", 
                "lastName", lastName, 
                "postCode", postCode);

        return getContainer().allMatches(query);
    }
    ...
}</pre>

          <p>Above it was noted that the other overloaded versions of the
          matching <acronym class="acronym">API</acronym> have the disadvantage that the
          matching is performed within the repository. As an alternative to
          using "find by title" or "find by pattern", you may wish to use
          QueryFindByTitle and QueryFind</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p><code class="classname">QueryFindByTitle&lt;T&gt;</code>, which
              corresponds to the <code class="methodname">allMatches(...)</code> for
              searching by title</p>
            </li><li class="listitem">
              <p><code class="classname">QueryFindByPattern&lt;T&gt;</code>, which
              corresponds to the <code class="methodname">allMatches(...)</code> for
              searching by pattern</p>
            </li></ul></div>

          <p>There is also a
          <code class="classname">QueryFindAllInstances&lt;T&gt;</code>, which
          corresponds to the <code class="methodname">allInstances()</code>
          method.</p>

          <p>The interpretation of a <code class="classname">Query</code> instance
          ultimately depends on the object store. All object stores will
          support <code class="classname">QueryFindAllInstances</code>, and most will
          provide a mechanism to support <code class="classname">QueryDefault</code>.
          Check the object store documentation to determine whether they
          support other <code class="classname">Query</code> implementations (ie,
          <code class="classname">QueryFindByTitle</code> and
          <code class="classname">QueryFindByPattern</code>).</p>
        </div>
      </div>

      <div class="sect1" title="Factories"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1412"></a>Factories</h2></div></div></div>
        

        <p>Like repositories, factories are defined by interface in the
        domain, decoupling the domain objects from their actual
        implementation. Unlike repositories, there is no particular need to
        change the implementation when moving from one object store to
        another, because in all cases the factory can simply delegate to its
        injected <code class="classname">DomainObjectContainer</code>.</p>

        <p>The methods for <code class="classname">DomainObjectContainer</code>
        that are relevant for a factory are:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="methodname">&lt;T&gt; T newTransientInstance(final
            Class&lt;T&gt; ofClass)</code></p>
          </li><li class="listitem">
            <p><code class="methodname">&lt;T&gt; T newPersistentInstance(final
            Class&lt;T&gt; ofClass)</code></p>
          </li><li class="listitem">
            <p><code class="methodname">persist(Object)</code></p>
          </li></ul></div>

        <p>These are discussed in more detail in <a class="xref" href="#sec.HowToCreateAnObject" title="How to create or delete objects within your code">the section called &#8220;How to create or delete objects within your code&#8221;</a>. See also <a class="xref" href="#apx.DomainObjectContainer" title="Appendix&nbsp;C.&nbsp;DomainObjectContainer interface">Appendix&nbsp;C, <i><code class="classname">DomainObjectContainer</code> interface</i></a> for full coverage of the
        methods available in
        <code class="classname">DomainObjectContainer</code>.</p>
      </div>
    </div>

    <div class="chapter" title="Chapter&nbsp;10.&nbsp;Value Types"><div class="titlepage"><div><div><h2 class="title"><a name="chp.ValueTypes"></a>Chapter&nbsp;10.&nbsp;Value Types</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d5e1454">Built-in Value Types</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1458">JDK Types</a></span></dt><dt><span class="sect2"><a href="#d5e1536">Value formats</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1633">Custom Value Types</a></span></dt><dt><span class="sect1"><a href="#d5e1672">Third-party Value Types</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>Built-in value types, writing your own value types, and
        supporting third-party value types.</p>
      </div>

      <p>The state of any given entity is characterized by properties
      (<a class="xref" href="#chp.Properties" title="Chapter&nbsp;2.&nbsp;How to add business rules">Chapter&nbsp;2, <i>How to add business rules</i></a>) and collections (<a class="xref" href="#">???</a>). A collections is a one-to-many reference
      to another entities, while a property is either a one-to-one reference
      to another entity, or it is a value.</p>

      <p>But what's a value? Well, it's an atomic piece of state. A string
      is a value, so is a number, so is a date. Values should be designed to
      be immutable (though some system value types, such as
      <code class="classname">java.util.Date</code>, famously are not).</p>

      <p><span class="emphasis"><em>Isis</em></span> supports all the standard JDK value
      types, and defines a number of its own (eg
      <code class="classname">Percentage</code> and <code class="classname">Color</code>). It
      also allows you to define your own value types, such as
      <code class="classname">LastName</code>, or <code class="classname">Celsius</code>, or
      <code class="classname">ComplexNumber</code>.</p>

      <p>Finally, it's also possible to make Isis integrate with
      third-party value types, such as <a class="ulink" href="http://joda-time.sourceforge.net/" target="_top">JodaTime</a>.</p>

      <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p><span class="emphasis"><em>Isis</em></span>' support for a particular value type
          does not necessarily imply that there is a custom widget for that
          type in a particular viewer. Rather, it means that the state of the
          object can be serialized, is expected to have equal-by-content
          semantics, and is expected to be immutable. It may also be parseable
          from a string.</p>
        </div>

      <div class="sect1" title="Built-in Value Types"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1454"></a>Built-in Value Types</h2></div></div></div>
        

        <p>The following are the value types supported by
        <span class="emphasis"><em>Isis</em></span> out-of-the-box.</p>

        <div class="sect2" title="JDK Types"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1458"></a>JDK Types</h3></div></div></div>
          

          <p>The following <acronym class="acronym">JDK</acronym> types are supported by
          <span class="emphasis"><em>Isis</em></span>.</p>

          <div class="sect3" title="Primitive Types"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1463"></a>Primitive Types</h4></div></div></div>
            

            <p>All the primitive types may be used as values:
            <code class="classname">byte</code>, <code class="classname">short</code>,
            <code class="classname">int</code>, <code class="classname">long</code>,
            <code class="classname">float</code>, <code class="classname">double</code>,
            <code class="classname">char</code>, and
            <code class="classname">boolean</code>.</p>
          </div>

          <div class="sect3" title="Wrapper Types"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1474"></a>Wrapper Types</h4></div></div></div>
            

            <p>The wrapper types for each of the primitives can also be
            used as value types: <code class="classname">java.lang.Byte</code>,
            <code class="classname">java.lang.Short</code>,
            <code class="classname">java.lang.Integer</code>,
            <code class="classname">java.lang.Long</code>,
            <code class="classname">java.lang.Float</code>,
            <code class="classname">java.lang.Double</code>,
            <code class="classname">java.lang.Character</code>,
            <code class="classname">java.lang.Boolean</code>.</p>
          </div>

          <div class="sect3" title="Java Classes"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1485"></a>Java Classes</h4></div></div></div>
            

            <p>The following java classes have value semantics and may be
            used as value types:</p>

            <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p><code class="classname">java.lang.String</code></p>
              </li><li class="listitem">
                <p><code class="classname">java.math.BigInteger</code> and
                <code class="classname">java.math.BigDecimal</code></p>
              </li><li class="listitem">
                <p><code class="classname">java.util.Date</code> (date and time),
                <code class="classname">java.sql.Date</code> (date only), and
                <code class="classname">java.sql.Time</code> (time only)</p>
              </li><li class="listitem">
                <p><code class="classname">java.sql.Timestamp</code></p>
              </li><li class="listitem">
                <p><code class="classname">java.awt.Image</code></p>
              </li></ul></div>
          </div>

          <div class="sect3" title="Isis AppLib"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1507"></a>Isis AppLib</h4></div></div></div>
            

            <p><span class="emphasis"><em>Isis</em></span> itself also provides a number of
            its own value types. These are all in the
            <code class="classname">org.apache.applib.value</code> package:</p>

            <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                <p><code class="classname">Color</code></p>
              </li><li class="listitem">
                <p><code class="classname">Date</code> (date only),
                <code class="classname">DateTime</code> (date and time) and
                <code class="classname">Time</code> (time only)</p>
              </li><li class="listitem">
                <p><code class="classname">TimeStamp</code></p>
              </li><li class="listitem">
                <p><code class="classname">Image</code></p>
              </li><li class="listitem">
                <p><code class="classname">Money</code></p>
              </li><li class="listitem">
                <p><code class="classname">Password</code></p>
              </li><li class="listitem">
                <p><code class="classname">Percentage</code></p>
              </li></ul></div>
          </div>
        </div>

        <div class="sect2" title="Value formats"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1536"></a>Value formats</h3></div></div></div>
          

          <p><span class="emphasis"><em>Isis</em></span> provides default formats for the
          inbuilt value types, according to type. These can be modified using
          <code class="filename">isis.properties</code>.</p>

          <p>These formats cut across the above categories; for example the
          byte format relates to both <code class="classname">byte</code> (primitive)
          and <code class="classname">java.lang.Byte</code> (wrapper). In all cases
          this setting can be overriden for a specific field using the @Mask
          annotation (see <a class="xref" href="#sec.MaskAnnotation" title="@Mask">the section called &#8220;@Mask&#8221;</a>).</p>

          <div class="sect3" title="Byte format"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1545"></a>Byte format</h4></div></div></div>
            

            <p>The format for all bytes can be set, replacing the default
            format derived from the system, using the following property to
            specify a mask:</p>

            <pre class="programlisting">isis.value.format.byte=####</pre>

            <p>The mask is used to set up a
            <code class="classname">java.text.DecimalFormat</code> formatting object
            so details of the mask format can be found in the Java
            documentation.</p>
          </div>

          <div class="sect3" title="Date Format"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1551"></a>Date Format</h4></div></div></div>
            

            <p>The format for all dates can be set, replacing the default
            format derived from the system, using the following property to
            specify one of <span class="emphasis"><em>long</em></span>,
            <span class="emphasis"><em>medium</em></span>, <span class="emphasis"><em>short</em></span>,
            <span class="emphasis"><em>isolong</em></span>, <span class="emphasis"><em>isoshort</em></span> or a
            mask:</p>

            <pre class="programlisting">isis.value.format.date=dd/MM/yy</pre>

            <p>When a mask is specified it is used to set up a
            <code class="classname">java.text.SimpleDateFormat</code> formatting
            object so details of the mask format can be found in the Java
            documentation.</p>
          </div>

          <div class="sect3" title="Date/time Format"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1562"></a>Date/time Format</h4></div></div></div>
            

            <p>The format for all date/time values can be set, replacing
            the default format derived from the system, using the following
            property to specify one of <span class="emphasis"><em>long</em></span>,
            <span class="emphasis"><em>medium</em></span>, <span class="emphasis"><em>short</em></span>,
            <span class="emphasis"><em>isolong</em></span>, <span class="emphasis"><em>isoshort</em></span> or a
            mask:</p>

            <pre class="programlisting">isis.value.format.datetime=dd/MM/yy</pre>

            <p>When a mask is specified it is used to set up a
            <code class="classname">java.text.SimpleDateFormat</code> formatting
            object so details of the mask format can be found in the Java
            documentation.</p>
          </div>

          <div class="sect3" title="Decimal format"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1573"></a>Decimal format</h4></div></div></div>
            

            <p>The format for <code class="classname">BigDecimal</code> values can
            be set, replacing the default format derived from the system,
            using the following property to specify a mask:</p>

            <pre class="programlisting">isis.value.format.decimal=####</pre>

            <p>The mask is used to set up a
            <code class="classname">java.text.DecimalFormat</code> formatting object
            so details of the mask format can be found in the Java
            documentation.</p>
          </div>

          <div class="sect3" title="Double format"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1580"></a>Double format</h4></div></div></div>
            

            <p>The format for all double values can be set, replacing the
            default format derived from the system, using the following
            property to specify a mask:</p>

            <pre class="programlisting">isis.value.format.double=####</pre>

            <p>The mask is used to set up a
            <code class="classname">java.text.DecimalFormat</code> formatting object
            so details of the mask format can be found in the Java
            documentation.</p>
          </div>

          <div class="sect3" title="Float format"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1586"></a>Float format</h4></div></div></div>
            

            <p>The format for all float values can be set, replacing the
            default format derived from the system, using the following
            property to specify a mask:</p>

            <pre class="programlisting">isis.value.format.float=####</pre>

            <p>The mask is used to set up a
            <code class="classname">java.text.DecimalFormat</code> formatting object
            so details of the mask format can be found in the Java
            documentation.</p>
          </div>

          <div class="sect3" title="Integer format"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1592"></a>Integer format</h4></div></div></div>
            

            <p>The format for all integers (including
            <code class="classname">BigInteger</code>) can be set, replacing the
            default format derived from the system, using the following
            property to specify a mask:</p>

            <pre class="programlisting">isis.value.format.int=####</pre>

            <p>The mask is used to set up a
            <code class="classname">java.text.DecimalFormat</code> formatting object
            so details of the mask format can be found in the Java
            documentation.</p>
          </div>

          <div class="sect3" title="Long format"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1599"></a>Long format</h4></div></div></div>
            

            <p>The format for all long values can be set, replacing the
            default format derived from the system, using the following
            property to specify a mask:</p>

            <pre class="programlisting">isis.value.format.long=####</pre>

            <p>The mask is used to set up a
            <code class="classname">java.text.DecimalFormat</code> formatting object
            so details of the mask format can be found in the Java
            documentation.</p>
          </div>

          <div class="sect3" title="Short format"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1605"></a>Short format</h4></div></div></div>
            

            <p>The format for all short values can be set, replacing the
            default format derived from the system, using the following
            property to specify a mask:</p>

            <pre class="programlisting">isis.value.format.short=####</pre>

            <p>The mask is used to set up a
            <code class="classname">java.text.DecimalFormat</code> formatting object
            so details of the mask format can be found in the Java
            documentation.</p>
          </div>

          <div class="sect3" title="Time Format"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1611"></a>Time Format</h4></div></div></div>
            

            <p>The format for all time values can be set, replacing the
            default format derived from the system, using the following
            property to specify one of <span class="emphasis"><em>long</em></span>,
            <span class="emphasis"><em>medium</em></span>, <span class="emphasis"><em>short</em></span>,
            <span class="emphasis"><em>isolong</em></span>, <span class="emphasis"><em>isoshort</em></span> or a
            mask:</p>

            <pre class="programlisting">isis.value.format.time=ddMMyyyy hhmm</pre>

            <p>When a mask is specified it is used to set up a
            <code class="classname">java.text.SimpleDateFormat</code> formatting
            object so details of the mask format can be found in the Java
            documentation.</p>
          </div>

          <div class="sect3" title="Timestamp Format"><div class="titlepage"><div><div><h4 class="title"><a name="d5e1622"></a>Timestamp Format</h4></div></div></div>
            

            <p>The format for time stamp values can be set, replacing the
            default format derived from the system, using the following
            property to specify one of <span class="emphasis"><em>long</em></span>,
            <span class="emphasis"><em>medium</em></span>, <span class="emphasis"><em>short</em></span>,
            <span class="emphasis"><em>isolong</em></span>, <span class="emphasis"><em>isoshort</em></span> or a
            mask:</p>

            <pre class="programlisting">isis.value.format.timestamp=hh:mm</pre>

            <p>When a mask is specified it is used to set up a
            <code class="classname">java.text.SimpleDateFormat</code> formatting
            object so details of the mask format can be found in the Java
            documentation.</p>
          </div>
        </div>
      </div>

      <div class="sect1" title="Custom Value Types"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1633"></a>Custom Value Types</h2></div></div></div>
        

        <p>In addition to the built-in value types it is also possible to
        define user-defined value types. This is typically done using the
        <code class="classname">@Value</code> annotation.</p>

        <p>The <code class="literal">@Value</code> annotation is used to provide an
        implementation of the
        <code class="classname">org.apache.isis.applib.adapters.ValueSemanticsProvider</code>
        interface. In turn this provides objects that allow the framework to
        interact with the value, specifically:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>the <code class="classname">EncoderDecoder</code> is used to convert
            the value into and back out of serializable form</p>

            <p>This is used by some object stores (eg the
            <acronym class="acronym">XML</acronym> Object Store), for remoting and also by the
            XML Snapshot capability (see <a class="xref" href="#chp.XmlSnapshots" title="Chapter&nbsp;14.&nbsp;XML Snapshots">Chapter&nbsp;14, <i>XML Snapshots</i></a>);</p>
          </li><li class="listitem">
            <p>the <code class="classname">Parser</code> is used to convert
            <code class="classname">String</code>s into the value type</p>

            <p>This is used as a fallback by viewers that do not have any
            specific widgets to support the particular value type, and make do
            with a simple text field instead.</p>

            <p>An obvious example is to parse a date. But it could be used
            to parse "TRUE" and "FALSE" into a boolean (as opposed to using a
            checkbox).</p>
          </li><li class="listitem">
            <p>the <code class="classname">DefaultsProvider</code> is used to
            provide a meaningful default for the value</p>

            <p>Not every value type will have a default, but some do (eg
            false for a boolean, 0 for a number). This is used as the default
            value for non-<code class="classname">@Optional</code> properties and
            parameters.</p>
          </li></ul></div>

        <p>Each of these interfaces also reside in
        <code class="classname">org.apache.isis.applib.adapters</code>.</p>

        <p>For more details, explore the built-in types within the applib,
        for example
        <code class="classname">org.apache.isis.applib.value.Money</code>.</p>

        <pre class="programlisting">@Value(semanticsProviderName = 
         "org.apache.isis.core.progmodel.facets.value.MoneyValueSemanticsProvider")
public class Money extends Magnitude {
    ...
}</pre>

        <p>where <code class="classname">MoneyValueSemanticsProvider</code> is the
        implementation of <code class="classname">ValueSemanticsProvider</code>
        described above.</p>

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
            <p>Using value types generally removes the need for using
            <code class="literal">@MustSatisfy</code> annotation (see <a class="xref" href="#sec.MustSpecify" title="How to validate declaratively using @MustSatisfy">the section called &#8220;How to validate declaratively using @MustSatisfy&#8221;</a>); the rules can instead move down
            into a <code class="methodname">validate()</code> method on the value
            type itself.</p>
          </div>
      </div>

      <div class="sect1" title="Third-party Value Types"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1672"></a>Third-party Value Types</h2></div></div></div>
        

        <p>Third party value types, such as those in <a class="ulink" href="http://joda-time.sourceforge.net/" target="_top">JodaTime</a>, can also
        supported, again through the use of a
        <code class="classname">ValueSemanticsProvider</code>. However, since the
        source code cannot be altered, the provider must be supplied using a
        key value in <code class="methodname">isis.properties</code> configuration
        file.</p>

        <p>For example, the following would register a semantics provider
        for <code class="classname">org.jodatime.time.DateTime</code>:</p>

        <pre class="programlisting">isis.core.progmodel.value.org.jodatime.time.DateTime.semanticsProviderName=\
    com.mycompany.values.CalendarIntervalValueSemanticsProvider</pre>

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>At the time of writing <span class="emphasis"><em>Apache Isis</em></span> does
          not currently ship with any
          <code class="classname">ValueSemanticsProvider</code>s, though doing so is
          on the roadmap.</p>
        </div>
      </div>
    </div>
  </div>

  <div class="part" title="Part&nbsp;II.&nbsp;Supporting Features"><div class="titlepage"><div><div><h1 class="title"><a name="prt.SupportingFeatures"></a>Part&nbsp;II.&nbsp;Supporting Features</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="chapter"><a href="#chp.Clock">11. Clock</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e1703">Lazily Instantiated</a></span></dt><dt><span class="sect1"><a href="#d5e1712">Possibly Replaceable</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.UserProfiles">12. Profiles</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e1726">Profiles and Perspectives</a></span></dt><dt><span class="sect1"><a href="#d5e1749">Runtime and Viewer Support</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chp.Fixtures">13. Fixtures and SwitchUser</a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.HowToRegisterFixtures">How to register fixtures</a></span></dt><dt><span class="sect1"><a href="#d5e1780">How to write custom fixtures</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1786"><code class="classname">InstallableFixture</code> and
          <code class="classname">FixtureType</code></a></span></dt><dt><span class="sect2"><a href="#d5e1806"><code class="classname">BaseFixture</code> and
          <code class="classname">AbstractFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e1839"><code class="methodname">DateFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e1850"><code class="methodname">SwitchUserFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e1870"><code class="classname">LogonFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e1877"><code class="classname">UserProfileFixture</code></a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#chp.XmlSnapshots">14. XML Snapshots</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e1907">Generating an XML Snapshot</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1911">Basic Usage</a></span></dt><dt><span class="sect2"><a href="#d5e1920">Including other Elements</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1936">Using the Fluent API</a></span></dt><dt><span class="sect1"><a href="#d5e1941">The <code class="classname">SnapshottableWithInclusions</code>
        interface</a></span></dt><dt><span class="sect1"><a href="#d5e1950">Generating an XSD schema</a></span></dt><dt><span class="sect1"><a href="#d5e1957">Hints and Tips</a></span></dt></dl></dd></dl></div>
    

    <div class="chapter" title="Chapter&nbsp;11.&nbsp;Clock"><div class="titlepage"><div><div><h2 class="title"><a name="chp.Clock"></a>Chapter&nbsp;11.&nbsp;Clock</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d5e1703">Lazily Instantiated</a></span></dt><dt><span class="sect1"><a href="#d5e1712">Possibly Replaceable</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>The default Clock and alternative implementations.</p>
      </div>

      <p>Many if not all enterprise applications deal with dates and times
      in one way or another. For example, if an <code class="classname">Order</code>
      is placed, then the <code class="classname">Customer</code> may have 30 days to
      pay the Invoice, otherwise a penalty may be levied. However, this can
      complicate automated testing: "today+30" will be a different date every
      time the test is run.</p>

      <p>A common solution is to require that domain objects do not go
      directly to the system for the current date (ie don't simply instantiate
      a new <code class="classname">java.util.Date</code> in order to get the current
      time); instead they should call some sort of facade.</p>

      <p>The <span class="emphasis"><em>Apache Isis</em></span> framework provides such a
      facade through the
      <code class="classname">org.apache.isis.applib.clock.Clock</code> class. The
      defaults for all values refer back to the <code class="classname">Clock</code>,
      and - because the <code class="classname">Clock</code> is a singleton - it is
      easy for any application code to obtain the current time also.</p>

      <p>For example:</p>

      <pre class="programlisting">public class Customer {
     public Order placeOrder(Product p) {
         Date now = Clock.getTimeAsDate();
         ...
     }
     ...
}</pre>

      <div class="sect1" title="Lazily Instantiated"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1703"></a>Lazily Instantiated</h2></div></div></div>
        

        <p>The first call to <code class="methodname">Clock.getTime()</code> will
        lazily instantiate the singleton, with the default implementation
        being one that simply delegates to the system's internal clock. To use
        a different <code class="classname">Clock</code> implementation, eg one that
        delegates to an NNTP server, all that is required is to instantiate it
        any time prior to bootstrapping <span class="emphasis"><em>Isis</em></span>
        itself.</p>

        <p>One notable implementation that notably takes advantage of this
        is <code class="classname">FixtureClock</code>, used for testing. See <a class="xref" href="#chp.Fixtures" title="Chapter&nbsp;13.&nbsp;Fixtures and SwitchUser">Chapter&nbsp;13, <i>Fixtures and SwitchUser</i></a> for more information.</p>
      </div>

      <div class="sect1" title="Possibly Replaceable"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1712"></a>Possibly Replaceable</h2></div></div></div>
        

        <p>Clock implementations can indicate whether they are replaceable
        as the singleton, or not.</p>

        <p>Most (all?) production implementations (eg the default system
        clock) are <span class="emphasis"><em>not</em></span> replaceable; once instantiated,
        any attempt to instantiate another subclass will be rejected with an
        exception.</p>

        <p>However implementations to work with tests (such as
        <code class="classname">FixtureClock</code>, already mentioned) are more
        likely to be replaceable, so that they can be setup multiple times as
        required.</p>
      </div>
    </div>

    <div class="chapter" title="Chapter&nbsp;12.&nbsp;Profiles"><div class="titlepage"><div><div><h2 class="title"><a name="chp.UserProfiles"></a>Chapter&nbsp;12.&nbsp;Profiles</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d5e1726">Profiles and Perspectives</a></span></dt><dt><span class="sect1"><a href="#d5e1749">Runtime and Viewer Support</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>Support for user profiles</p>
      </div>

      <p>As well as allowing domain entities to be persisted into object
      stores, <span class="emphasis"><em>Apache Isis</em></span> also allows user
      <span class="emphasis"><em>profiles</em></span> to be persisted into a profile
      store.</p>

      <div class="sect1" title="Profiles and Perspectives"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1726"></a>Profiles and Perspectives</h2></div></div></div>
        

        <p>Every user can have one profile associated with them, which
        consists of:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>a set of options or preferences</p>
          </li><li class="listitem">
            <p>a set of perspectives</p>
          </li></ul></div>

        <p>A perspective is something akin to a layout or desktop,
        representing a configuration of relevant objects as might be displayed
        on the home page of the viewer. In particular, perspectives allow the
        set of services available to a user (eg as icons in the
        <acronym class="acronym">DnD</acronym> viewer) to be customized for that user. Since
        these services represent the "start points" for the user to interact
        with the domain model, they in a sense define an application on a
        per-user basis.</p>

        <p>The elements that make up a perspective are:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>a set of services (identified by the string returned from
            each service's <code class="methodname">getId()</code> method, see <a class="xref" href="#chp.DomainServices" title="Chapter&nbsp;9.&nbsp;Domain Services, Repositories and Factories">Chapter&nbsp;9, <i>Domain Services, Repositories and Factories</i></a>)</p>

            <p>These are the services (eg icons) that can be accessed from
            that perspective</p>
          </li><li class="listitem">
            <p>a set of objects</p>

            <p>These might represent bookmarks to objects saved from a
            previous session.</p>
          </li></ul></div>

        <p>The applib contains types to define these two concepts;
        specifically <code class="classname">Profile</code> and
        <code class="classname">Perspective</code>. These are actually interfaces, the
        implementation is provided by framework itself.</p>
      </div>

      <div class="sect1" title="Runtime and Viewer Support"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1749"></a>Runtime and Viewer Support</h2></div></div></div>
        

        <p>Support for profiles will vary across runtime implementations
        and across viewers. The <span class="emphasis"><em>default runtime</em></span>
        implementation <span class="emphasis"><em>does</em></span> support profiles, however,
        and works such that if a user logs in and no perspective exists for
        that user one will automatically be created. This will either be a
        copy of the 'template' perspective, or, if no such template exists,
        then simply a perspective containing all the known services.</p>

        <p>Moreover, the runtime must be configured to use some sort of
        persistence mechanism for profiles such that they are persisted
        between runs. The default runtime does support this (though the
        default is the in-memory profilestore that does not persist any
        information between sessions).</p>

        <p>Even if the configured runtime does support profiles, not every
        viewer necessarily uses the concept. The most notable viewer that
        <span class="emphasis"><em>does</em></span> support the idea is the <span class="emphasis"><em>dnd
        viewer</em></span>.</p>
      </div>
    </div>

    <div class="chapter" title="Chapter&nbsp;13.&nbsp;Fixtures and SwitchUser"><div class="titlepage"><div><div><h2 class="title"><a name="chp.Fixtures"></a>Chapter&nbsp;13.&nbsp;Fixtures and SwitchUser</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#sec.HowToRegisterFixtures">How to register fixtures</a></span></dt><dt><span class="sect1"><a href="#d5e1780">How to write custom fixtures</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1786"><code class="classname">InstallableFixture</code> and
          <code class="classname">FixtureType</code></a></span></dt><dt><span class="sect2"><a href="#d5e1806"><code class="classname">BaseFixture</code> and
          <code class="classname">AbstractFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e1839"><code class="methodname">DateFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e1850"><code class="methodname">SwitchUserFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e1870"><code class="classname">LogonFixture</code></a></span></dt><dt><span class="sect2"><a href="#d5e1877"><code class="classname">UserProfileFixture</code></a></span></dt></dl></dd></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>Using fixtures to setup the system, generally for testing
        purposes.</p>
      </div>

      <p>Fixtures are used to setup the framework into a known state. This
      is predominantly done for testing, and in particular when running with
      the in-memory object store. However, fixtures can also be used to
      specify the user that has "logged on", and to set the clock.</p>

      <p>Whether a fixture has any effect will depend on several
      factors:</p>

      <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
          <p>the first is the <code class="classname">DeploymentType</code>;
          specifying the logged on user will only be honoured if running in
          exploration mode (or more precisely, where
          <code class="methodname">DeploymentType#isExploring()</code> returns
          true);</p>
        </li><li class="listitem">
          <p>the second is the object store; most persistent object stores
          will either ignore fixtures, or only allow them to be installed once
          or if run with an (object store-specific) flag set</p>
        </li></ul></div>

      <div class="sect1" title="How to register fixtures"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.HowToRegisterFixtures"></a>How to register fixtures</h2></div></div></div>
        

        <p>All domain services (which includes repositories and factories)
        should be registered in the <span class="emphasis"><em>isis.properties</em></span>
        configuration file, under the <code class="varname">isis.fixtures.prefix</code>
        and <code class="varname">isis.fixtures</code> keys.</p>

        <p>For example:</p>

        <pre class="programlisting">isis.fixtures.prefix= org.apache.isis.support.prototype.fixture
isis.fixtures= ClaimsFixture,LogOnAsCliveFixture</pre>

        <p>It is also possible to specify fixtures from the command line,
        using the --fixture flag.</p>
      </div>

      <div class="sect1" title="How to write custom fixtures"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1780"></a>How to write custom fixtures</h2></div></div></div>
        

        <p>The applib defines several interfaces and classes for writing
        fixtures. The following UML diagram shows their relationships:</p>

        <div class="mediaobject"><img src="images/Fixtures.png" width="351"></div>

        <div class="sect2" title="InstallableFixture and FixtureType"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1786"></a><code class="classname">InstallableFixture</code> and
          <code class="classname">FixtureType</code></h3></div></div></div>
          

          <p>The <code class="classname">InstallableFixture</code> interface
          defines the general contract between a fixture and the framework:
          the <code class="classname">FixtureType</code>, and an
          <code class="methodname">install()</code> method.</p>

          <p>The <code class="classname">FixtureType</code> is used to characterize
          whether the fixture:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>if <code class="classname">FixtureType.DOMAIN_OBJECTS</code> (the
              default), then the fixture will be installed only so long as the
              configured object store does not indicate that fixtures have
              already been installed</p>
            </li><li class="listitem">
              <p>if <code class="classname">FixtureType.USER_PROFILES</code>, then
              the fixture will be installed only so long as the configured
              profile store does not indicate that fixtures have already been
              installed</p>
            </li><li class="listitem">
              <p>if <code class="classname">FixtureType.OTHER</code>, then the
              fixture will always be installed. This usually refers to setting
              the clock or user.</p>
            </li></ul></div>
        </div>

        <div class="sect2" title="BaseFixture and AbstractFixture"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1806"></a><code class="classname">BaseFixture</code> and
          <code class="classname">AbstractFixture</code></h3></div></div></div>
          

          <p>The <code class="classname">BaseFixture</code> class is not API, but
          is responsible for instantiating
          <code class="classname">FixtureClock</code>. This is an implementation of
          <code class="classname">Clock</code> singleton, which (as described in <a class="xref" href="#chp.Clock" title="Chapter&nbsp;11.&nbsp;Clock">Chapter&nbsp;11, <i>Clock</i></a>), is used by the rest of the
          <span class="emphasis"><em>Isis</em></span> framework delegates to in order to obtain
          the current time. The <code class="classname">FixtureClock</code>'s purpose
          is to allow the current date/time to be set by other
          fixtures.</p>

          <p>The <code class="classname">AbstractFixture</code> class (inheriting
          from <code class="classname">BaseFixture</code>) is an general-purpose
          adapter for writing fixtures. It implements
          <code class="classname">CompositeFixture</code> interface, meaning that
          hierarchies of fixtures can be created following the composite
          design pattern. It also provides a number of convenience
          methods:</p>

          <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
              <p>the <code class="methodname">setDate(...)</code> and
              <code class="methodname">setTime(...)</code> method allow the date/time
              to be set.</p>

              <p>This is done using by obtaining the
              <code class="classname">FixtureClock</code> (from
              <code class="classname">BaseFixture</code>). There are also some
              convenience methods to move the date/time either earlier or
              later.</p>
            </li><li class="listitem">
              <p>the <code class="methodname">switchUser(...)</code> method allow
              the logged-on user to be changed</p>

              <p>This changes the user logged-on while the fixtures are
              being installed. This is to facilitate tests that have complex
              setup requirements, eg verifying workflow between different user
              roles.</p>
            </li></ul></div>

          <p>An alternative to using
          <code class="methodname">setDate(...)</code>/<code class="methodname">setTime(...)</code>
          is to use <code class="classname">DateFixture</code>, and an alternative to
          using <code class="methodname">switchUser(...)</code> is to use
          <code class="classname">SwitchUserFixture</code>. Which you use is largely a
          matter of personal preference.</p>
        </div>

        <div class="sect2" title="DateFixture"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1839"></a><code class="methodname">DateFixture</code></h3></div></div></div>
          

          <p>The <code class="classname">DateFixture</code> provides an alternative
          to <code class="classname">AbstractFixture</code>, just allowing the current
          date/time to be set.</p>

          <p>The main difference is one of style;
          <code class="classname">DateFixture</code> can be used in a declarative way,
          whereas <code class="classname">AbstractFixture</code> is more imperative.
          For example:</p>

          <pre class="programlisting">public class DateIs13Jan2007Fixture extends DateFixture {
    public DateIs13Jan2007Fixture() {
        super(2007,1,13);
    }
}</pre>

          <p>A fixture in this style could then be used within a composite
          fixture hierarchy.</p>
        </div>

        <div class="sect2" title="SwitchUserFixture"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1850"></a><code class="methodname">SwitchUserFixture</code></h3></div></div></div>
          

          <p>The <code class="classname">SwitchUserFixture</code> provides an
          alternative to <code class="classname">AbstractFixture</code>, just allowing
          the current user to be switched.</p>

          <p>The main difference is one of style;
          <code class="classname">SwitchUserFixture</code> can be used in a
          declarative way, whereas <code class="classname">AbstractFixture</code> is
          more imperative. For example:</p>

          <pre class="programlisting">public class SwitchToFrankSupervisorFixture extends SwitchUserFixture {
    public SwitchToFrankSupervisorFixture() {
        super("frank", "user", "supervisor");
    }
}</pre>

          <p>A fixture in this style could then be used within a composite
          fixture hierarchy.</p>

          <div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
            <p>Do be aware of when you call switchUser() in a
            <code class="classname">Fixture</code> as it causes the current
            transaction to be ended and a new one started (for the new user).
            If you share a reference between the two you will get an
            exception.</p>

            <p>For example:</p>

            <pre class="programlisting">Account account = accounts.createAccount(
    "ACME", "Peter Planner", "pplanner@acme.com");
Participant peterPlanner = account.getAdmin();
        
switchUser("pplanner@acme.com", new String[0]);

Work work = plan1.createWork();
BcpPlan plan = (BcpPlan) work.getTarget();
plan.getOwner().modifyLeader(peterPlanner);</pre>

            <p>This will fail because <code class="varname">peterPlanner</code>
            reference is no longer valid after the switch user.</p>

            <p>The solution is to retrieve the object again so it is part
            of the second transaction. In this example we can change to code
            to this:</p>

            <pre class="programlisting">accounts.createAccount("ACME", "Peter Planner", "pplanner@acme.com");
        
switchUser("pplanner@acme.com", new String[0]);

Account account = uniqueMatch(Account.class, "0 ACME");
Participant peterPlanner = account.getAdmin();

Work work = plan1.createWork();
BcpPlan plan = (BcpPlan) work.getTarget();
plan.getOwner().modifyLeader(peterPlanner);
</pre>
          </div>
        </div>

        <div class="sect2" title="LogonFixture"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1870"></a><code class="classname">LogonFixture</code></h3></div></div></div>
          

          <p>Unlike the very similar
          <code class="classname">SwitchUserFixture</code>, this fixture does not
          affect the currently logged on user while the fixtures are being
          installed. Instead, it is used to specify the user to logon as once
          all the fixtures have been installed.</p>

          <p>If more than one <code class="classname">LogonFixture</code> is
          specified, the last one encountered is used.</p>
        </div>

        <div class="sect2" title="UserProfileFixture"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1877"></a><code class="classname">UserProfileFixture</code></h3></div></div></div>
          

          <p>The <code class="classname">UserProfileFixture</code> is used to
          populate the configured profile store<sup>[<a name="d5e1882" href="#ftn.d5e1882" class="footnote">1</a>]</sup> with user profiles (the concept of which is described
          in <a class="xref" href="#chp.UserProfiles" title="Chapter&nbsp;12.&nbsp;Profiles">Chapter&nbsp;12, <i>Profiles</i></a>).</p>

          <p>To create a user profile for a specific user, inherit from
          <code class="classname">UserProfileFixture</code>, use the inherited
          <code class="methodname">newUserProfile()</code> to create a profile and
          use the inherited <code class="methodname">saveForUser(...)</code> method
          to save that profile.</p>

          <p>It is also possible to create a 'template' perspective using
          the <code class="methodname">saveAsDefault(...)</code> method. This is used
          as the basis for any new perspectives that are automatically
          created, eg for users who are logging in and for whom there is no
          perspective in existence.</p>

          <p>For example:</p>

          <pre class="programlisting">public class PerspectivesFixture extends UserProfileFixture {
  @Override
  protected void installProfiles() {
    Profile profile = newUserProfile();
    Perspective perspective = profile.newPerspective("ECS");
    perspective.addToServices(LocationFactory.class);
    perspective.addToServices(CustomerRepository.class);
    perspective.addToServices(PaymentMethodFactory.class);
        
    saveAsDefault(profile);
  }
}</pre>

          <p>With that set up, when a new user now logs in they will see
          three service icons on the screen for locations, customers and
          payment methods. In the <span class="emphasis"><em>dnd viewer</em></span> the user
          will be able to add and remove services from their perspective. See
          the DnD Viewer documentation for further details.</p>

          <p>Any fixtures, if specified, are only ever loaded once; the
          fixture installer checks with
          <code class="methodname">UserProfileSevice.isInitialized()</code> to see if
          the fixture is already installed. This allows fixtures to be used
          for seeding a persisting profile store, and then be ignored
          thereafter.</p>
        </div>
      </div>
    <div class="footnotes"><br><hr width="100" align="left"><div class="footnote">
              <p><sup>[<a id="ftn.d5e1882" href="#d5e1882" class="para">1</a>] </sup>A profile store is a persistence mechanism provided by the
              configured runtime that allows user profiles to be stored
              between runs. It is similar to, but independent of, an object
              store (which stores the domain objects themselves).</p>
            </div></div></div>

    <div class="chapter" title="Chapter&nbsp;14.&nbsp;XML Snapshots"><div class="titlepage"><div><div><h2 class="title"><a name="chp.XmlSnapshots"></a>Chapter&nbsp;14.&nbsp;XML Snapshots</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d5e1907">Generating an XML Snapshot</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1911">Basic Usage</a></span></dt><dt><span class="sect2"><a href="#d5e1920">Including other Elements</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e1936">Using the Fluent API</a></span></dt><dt><span class="sect1"><a href="#d5e1941">The <code class="classname">SnapshottableWithInclusions</code>
        interface</a></span></dt><dt><span class="sect1"><a href="#d5e1950">Generating an XSD schema</a></span></dt><dt><span class="sect1"><a href="#d5e1957">Hints and Tips</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>Generating <acronym class="acronym">XML</acronym> snapshots from domain
        objects.</p>
      </div>

      <p>The <span class="emphasis"><em>Apache Isis</em></span> framework provides the
      capability to generate <acronym class="acronym">XML</acronym> snapshots (and if required
      corresponding <acronym class="acronym">XSD</acronym> schemas) based on graphs of domain
      objects. This is done using the
      <code class="classname">org.apache.isis.core.runtime.snapshot.XmlSnapshot</code>
      class.</p>

      <div class="sect1" title="Generating an XML Snapshot"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1907"></a>Generating an XML Snapshot</h2></div></div></div>
        

        <p>The <code class="classname">XmlSnapshot</code> can be created either
        directly or using a builder.</p>

        <div class="sect2" title="Basic Usage"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1911"></a>Basic Usage</h3></div></div></div>
          

          <p>The standard usage is to instantiate directly.</p>

          <pre class="programlisting">XmlSnapshot snapshot = new XmlSnapshot(customer);
Element customerAsXml = snapshot.getXmlElement();</pre>

          <p>This will return the <code class="classname">Customer</code>'s fields,
          titles of simple references, number of items in collections.</p>

          <p>In order to use the <code class="classname">XmlSnapshot</code>, the
          domain object must implement
          <code class="classname">org.apache.isis.applib.snapshot.Snapshottable</code>.
          This is just a marker interface.</p>
        </div>

        <div class="sect2" title="Including other Elements"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1920"></a>Including other Elements</h3></div></div></div>
          

          <p>It's also possible to instruct the
          <code class="classname">XmlSnapshot</code> to "walk" the object graph and
          include other information within the generated
          <acronym class="acronym">XML</acronym>.</p>

          <p>For example:</p>

          <pre class="programlisting">XmlSnapshot snapshot = new XmlSnapshot(customer);
snapshot.include("placeOfBirth");   // (1)
snapshot.include("orders/product"); // (2)
Element customerAsXml = snapshot.getXmlElement();</pre>

          <p>In (1), we indicate that we want to also navigate to another
          domain object represented by simple reference "placeOfBirth"; in
          (2), we indicate that we want to navigate the "orders" collection
          (presumably of <code class="classname">Order</code>s) and for each
          referenced <code class="classname">Order</code>, to navigate in turn its
          "product" reference (presumably to a <code class="classname">Product</code>
          class).</p>

          <p>Note that <code class="classname">XmlSnapshot</code> is mutable, in
          that calls to its <code class="methodname">getXmlElement()</code> may
          return different <acronym class="acronym">XML</acronym> structures based on whether
          additional paths have been <code class="methodname">include()</code>'d, or
          whether the state of the domain objects themselves have
          changed.</p>
        </div>
      </div>

      <div class="sect1" title="Using the Fluent API"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1936"></a>Using the Fluent API</h2></div></div></div>
        

        <p>An <code class="classname">XmlSnapshot</code> can also be constructed
        using an alternative "fluent" API:</p>

        <pre class="programlisting">XmlSnapshot snapshot = 
     XmlSnapshot.create(customer)
                .includePath("placeOfBirth")
                .include("orders/product")
                .build();
Element customerAsXml = snapshot.getXmlElement();</pre>
      </div>

      <div class="sect1" title="The SnapshottableWithInclusions interface"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1941"></a>The <code class="classname">SnapshottableWithInclusions</code>
        interface</h2></div></div></div>
        

        <p>As already mentioned, in order to be snapshotted a domain object
        must implement the <code class="classname">Snapshot</code> interface. This is
        just a marker interface, so implementing it is trivial.</p>

        <p>Alternatively, the domain object can choose to implement the
        sub-interface, <code class="classname">SnapshottableWithInclusions</code>.
        This moves the responsibility for determining what is included within
        the snapshot from the caller to the snapshottable object
        itself:</p>

        <pre class="programlisting">public interface SnapshottableWithInclusions extends Snapshottable {
    List&lt;String&gt; snapshotInclusions();
}</pre>

        <p>If necessary, both approaches can be combined.</p>
      </div>

      <div class="sect1" title="Generating an XSD schema"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1950"></a>Generating an XSD schema</h2></div></div></div>
        

        <p>As well as obtaining the XML snapshot, it is also possible to
        obtain an XSD schema that the XML snapshot conforms to.</p>

        <pre class="programlisting">XmlSnapshot snapshot = ...;
Element customerAsXml = snapshot.getXmlElement();
Element customerXsd = snapshot.getXsdElement();</pre>

        <p>This can be useful for some tools. Note that for the
        <acronym class="acronym">XSD</acronym> to be correct, the object being snapshotted
        must have non-null values for the paths that are
        <code class="methodname">include()</code>'d. If this isn't done then the XSD
        will not be correct reflect for another snapshotted object that does
        have non-null values.</p>
      </div>

      <div class="sect1" title="Hints and Tips"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e1957"></a>Hints and Tips</h2></div></div></div>
        

        <p>As an alternative to using include(), you might consider
        building a non-persisted domain object (a "view model") which can
        reference only the relevant information required for the
        snapshot.</p>

        <p>For example, if only the 5 most recent
        <code class="classname">Order</code>s for a <code class="classname">Customer</code>
        were required, a <code class="classname">CustomerAndRecentOrders</code> view
        model could hold a collection of just those 5
        <code class="classname">Order</code>s.</p>

        <p>Typically such view models would implement
        <code class="classname">SnapshottableWithInclusions</code>.</p>
      </div>
    </div>
  </div>

  <div class="part" title="Part&nbsp;III.&nbsp;Reference Appendices"><div class="titlepage"><div><div><h1 class="title"><a name="prt.ReferenceAppendices"></a>Part&nbsp;III.&nbsp;Reference Appendices</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="appendix"><a href="#d5e1969">A. Recognized Methods and Prefixes</a></span></dt><dt><span class="appendix"><a href="#d5e2241">B. Recognized Annotations</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e2248">@ActionOrder</a></span></dt><dt><span class="sect1"><a href="#d5e2267">@ActionSemantics</a></span></dt><dt><span class="sect1"><a href="#d5e2277">@AutoComplete</a></span></dt><dt><span class="sect1"><a href="#d5e2286">@Aggregated</a></span></dt><dt><span class="sect1"><a href="#d5e2294">@Bounded</a></span></dt><dt><span class="sect1"><a href="#sec.DebugAnnotation">@Debug</a></span></dt><dt><span class="sect1"><a href="#d5e2313">@Defaulted</a></span></dt><dt><span class="sect1"><a href="#d5e2323">@DescribedAs</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2331">Providing a description for an object</a></span></dt><dt><span class="sect2"><a href="#d5e2337">Providing a description for an object member</a></span></dt><dt><span class="sect2"><a href="#d5e2343">Providing a description for an action parameter</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e2349">@Disabled</a></span></dt><dt><span class="sect1"><a href="#d5e2418">@Encodable</a></span></dt><dt><span class="sect1"><a href="#d5e2428">@EqualByContent</a></span></dt><dt><span class="sect1"><a href="#d5e2437">@Executed</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2443">Forcing a method to be executed on the client</a></span></dt><dt><span class="sect2"><a href="#d5e2447">Forcing a method to be executed on the server</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.ExplorationAnnotation">@Exploration</a></span></dt><dt><span class="sect1"><a href="#d5e2462">@Facets</a></span></dt><dt><span class="sect1"><a href="#d5e2471">@FieldOrder</a></span></dt><dt><span class="sect1"><a href="#sec.HiddenAnnotation">@Hidden</a></span></dt><dt><span class="sect1"><a href="#d5e2555">@Idempotent (deprecated)</a></span></dt><dt><span class="sect1"><a href="#d5e2559">@Ignore (deprecated)</a></span></dt><dt><span class="sect1"><a href="#d5e2566">@Immutable</a></span></dt><dt><span class="sect1"><a href="#sec.MaskAnnotation">@Mask</a></span></dt><dt><span class="sect1"><a href="#sec.MaxLengthAnnotation">@MaxLength</a></span></dt><dt><span class="sect1"><a href="#sec.MemberGroupsAnnotation">@MemberGroups</a></span></dt><dt><span class="sect1"><a href="#sec.MemberOrderAnnotation">@MemberOrder</a></span></dt><dt><span class="sect1"><a href="#d5e2657">@MultiLine</a></span></dt><dt><span class="sect1"><a href="#d5e2688">@MustSatisfy</a></span></dt><dt><span class="sect1"><a href="#sec.NamedAnnotation">@Named</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2712">Specifying the name of an object</a></span></dt><dt><span class="sect2"><a href="#d5e2721">Specifying the name of a class member</a></span></dt><dt><span class="sect2"><a href="#d5e2730">Specifying the name for an action parameter</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.NotContributedAnnotation">@NotContributed</a></span></dt><dt><span class="sect1"><a href="#sec.NotInServiceMenuAnnotation">@NotInServiceMenu</a></span></dt><dt><span class="sect1"><a href="#not-persistable">@NotPersistable</a></span></dt><dt><span class="sect1"><a href="#d5e2781">@NotPersisted</a></span></dt><dt><span class="sect1"><a href="#d5e2789">@ObjectType</a></span></dt><dt><span class="sect1"><a href="#d5e2799">@Optional</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2808">Making a property optional</a></span></dt><dt><span class="sect2"><a href="#d5e2817">Making an action parameter optional</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e2822">@Paged</a></span></dt><dt><span class="sect1"><a href="#d5e2837">@Parseable</a></span></dt><dt><span class="sect1"><a href="#sec.PluralAnnotation">@Plural</a></span></dt><dt><span class="sect1"><a href="#d5e2857">@Programmatic</a></span></dt><dt><span class="sect1"><a href="#sec.PrototypeAnnotation">@Prototype</a></span></dt><dt><span class="sect1"><a href="#d5e2879">@QueryOnly (deprecated)</a></span></dt><dt><span class="sect1"><a href="#sec.RegExAnnotation">@RegEx</a></span></dt><dt><span class="sect1"><a href="#d5e2900">@Resolve</a></span></dt><dt><span class="sect1"><a href="#sec.TitleAnnotation">@Title</a></span></dt><dt><span class="sect1"><a href="#d5e2931">@TypeOf</a></span></dt><dt><span class="sect1"><a href="#d5e2939">@TypicalLength</a></span></dt><dt><span class="sect1"><a href="#sec.ValueAnnotation">@Value</a></span></dt><dt><span class="sect1"><a href="#d5e2965">@ViewModel</a></span></dt></dl></dd><dt><span class="appendix"><a href="#apx.DomainObjectContainer">C. <code class="classname">DomainObjectContainer</code> interface</a></span></dt><dt><span class="appendix"><a href="#apx.SecurityClasses">D. Security Classes</a></span></dt><dt><span class="appendix"><a href="#apx.UtilityClasses">E. Utility Classes</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d5e3172">Title creation</a></span></dt><dt><span class="sect1"><a href="#d5e3179">Reason text creation (for disable and validate methods)</a></span></dt></dl></dd><dt><span class="appendix"><a href="#d5e3194">F. Events</a></span></dt><dt><span class="appendix"><a href="#d5e3205">G. Package Dependencies</a></span></dt></dl></div>
    

    <div class="appendix" title="Appendix&nbsp;A.&nbsp;Recognized Methods and Prefixes"><div class="titlepage"><div><div><h2 class="title"><a name="d5e1969"></a>Appendix&nbsp;A.&nbsp;Recognized Methods and Prefixes</h2></div></div></div>
      

      <p>The following table lists all of the methods or method prefixes
      that are recognized by <span class="emphasis"><em>Apache Isis</em></span>' default
      programming model:</p>

      <div class="table"><a name="d5e1973"></a><p class="title"><b>Table&nbsp;A.1.&nbsp;Recognized Method Prefixes</b></p><div class="table-contents">
        

        <table summary="Recognized Method Prefixes" border="1"><colgroup><col align="center"><col width="50" align="center"><col width="50" align="center"><col width="50" align="center"><col width="50" align="center"><col width="50" align="center"><col></colgroup><thead><tr><th align="center">Prefix</th><th align="center">object</th><th align="center">property</th><th align="center">collection</th><th align="center">action</th><th align="center">action param</th><th align="center">See also</th></tr></thead><tbody><tr><td align="center">addTo</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>removeFrom</td></tr><tr><td align="center">choices</td><td align="center">&nbsp;</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">Y</td><td>&nbsp;</td></tr><tr><td align="center">clear</td><td align="center">&nbsp;</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>modify</td></tr><tr><td align="center">created</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">default</td><td align="center">&nbsp;</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">Y</td><td>&nbsp;</td></tr><tr><td align="center">disable</td><td align="center">&nbsp;</td><td align="center">Y</td><td align="center">Y</td><td align="center">Y</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">get</td><td align="center">&nbsp;</td><td align="center">Y</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>set</td></tr><tr><td align="center">getId</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>(services only)</td></tr><tr><td align="center">hide</td><td align="center">&nbsp;</td><td align="center">Y</td><td align="center">Y</td><td align="center">Y</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">iconName</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">loaded</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">loading</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">modify</td><td align="center">&nbsp;</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>clear</td></tr><tr><td align="center">persisted</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">persisting</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">removing</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">removed</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">removeFrom</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>addTo</td></tr><tr><td align="center">set</td><td align="center">&nbsp;</td><td align="center">Y</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>get</td></tr><tr><td align="center">toString</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">title</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">updating</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">updated</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">validate</td><td align="center">Y</td><td align="center">Y</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">Y</td><td>&nbsp;</td></tr></tbody></table>
      </div></div><br class="table-break">

      <p>There are also a number of deprecated methods:</p>

      <div class="table"><a name="d5e2186"></a><p class="title"><b>Table&nbsp;A.2.&nbsp;Deprecated Method Prefixes</b></p><div class="table-contents">
        

        <table summary="Deprecated Method Prefixes" border="1"><colgroup><col align="center"><col width="50" align="center"><col width="50" align="center"><col width="50" align="center"><col width="50" align="center"><col width="50" align="center"><col></colgroup><thead><tr><th align="center">Prefix</th><th align="center">object</th><th align="center">property</th><th align="center">collection</th><th align="center">action</th><th align="center">action param</th><th align="center">See also</th></tr></thead><tbody><tr><td align="center">deleted</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">deleting</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">saved</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr><tr><td align="center">saving</td><td align="center">Y</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td>&nbsp;</td></tr></tbody></table>
      </div></div><br class="table-break">

      <p>In order to be recognized, all methods must be
      <code class="code">public</code>. Any methods that do not match are deemed to be
      action methods that the user can invoke from the user interface.</p>
    </div>

    <div class="appendix" title="Appendix&nbsp;B.&nbsp;Recognized Annotations"><div class="titlepage"><div><div><h2 class="title"><a name="d5e2241"></a>Appendix&nbsp;B.&nbsp;Recognized Annotations</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d5e2248">@ActionOrder</a></span></dt><dt><span class="sect1"><a href="#d5e2267">@ActionSemantics</a></span></dt><dt><span class="sect1"><a href="#d5e2277">@AutoComplete</a></span></dt><dt><span class="sect1"><a href="#d5e2286">@Aggregated</a></span></dt><dt><span class="sect1"><a href="#d5e2294">@Bounded</a></span></dt><dt><span class="sect1"><a href="#sec.DebugAnnotation">@Debug</a></span></dt><dt><span class="sect1"><a href="#d5e2313">@Defaulted</a></span></dt><dt><span class="sect1"><a href="#d5e2323">@DescribedAs</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2331">Providing a description for an object</a></span></dt><dt><span class="sect2"><a href="#d5e2337">Providing a description for an object member</a></span></dt><dt><span class="sect2"><a href="#d5e2343">Providing a description for an action parameter</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e2349">@Disabled</a></span></dt><dt><span class="sect1"><a href="#d5e2418">@Encodable</a></span></dt><dt><span class="sect1"><a href="#d5e2428">@EqualByContent</a></span></dt><dt><span class="sect1"><a href="#d5e2437">@Executed</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2443">Forcing a method to be executed on the client</a></span></dt><dt><span class="sect2"><a href="#d5e2447">Forcing a method to be executed on the server</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.ExplorationAnnotation">@Exploration</a></span></dt><dt><span class="sect1"><a href="#d5e2462">@Facets</a></span></dt><dt><span class="sect1"><a href="#d5e2471">@FieldOrder</a></span></dt><dt><span class="sect1"><a href="#sec.HiddenAnnotation">@Hidden</a></span></dt><dt><span class="sect1"><a href="#d5e2555">@Idempotent (deprecated)</a></span></dt><dt><span class="sect1"><a href="#d5e2559">@Ignore (deprecated)</a></span></dt><dt><span class="sect1"><a href="#d5e2566">@Immutable</a></span></dt><dt><span class="sect1"><a href="#sec.MaskAnnotation">@Mask</a></span></dt><dt><span class="sect1"><a href="#sec.MaxLengthAnnotation">@MaxLength</a></span></dt><dt><span class="sect1"><a href="#sec.MemberGroupsAnnotation">@MemberGroups</a></span></dt><dt><span class="sect1"><a href="#sec.MemberOrderAnnotation">@MemberOrder</a></span></dt><dt><span class="sect1"><a href="#d5e2657">@MultiLine</a></span></dt><dt><span class="sect1"><a href="#d5e2688">@MustSatisfy</a></span></dt><dt><span class="sect1"><a href="#sec.NamedAnnotation">@Named</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2712">Specifying the name of an object</a></span></dt><dt><span class="sect2"><a href="#d5e2721">Specifying the name of a class member</a></span></dt><dt><span class="sect2"><a href="#d5e2730">Specifying the name for an action parameter</a></span></dt></dl></dd><dt><span class="sect1"><a href="#sec.NotContributedAnnotation">@NotContributed</a></span></dt><dt><span class="sect1"><a href="#sec.NotInServiceMenuAnnotation">@NotInServiceMenu</a></span></dt><dt><span class="sect1"><a href="#not-persistable">@NotPersistable</a></span></dt><dt><span class="sect1"><a href="#d5e2781">@NotPersisted</a></span></dt><dt><span class="sect1"><a href="#d5e2789">@ObjectType</a></span></dt><dt><span class="sect1"><a href="#d5e2799">@Optional</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e2808">Making a property optional</a></span></dt><dt><span class="sect2"><a href="#d5e2817">Making an action parameter optional</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d5e2822">@Paged</a></span></dt><dt><span class="sect1"><a href="#d5e2837">@Parseable</a></span></dt><dt><span class="sect1"><a href="#sec.PluralAnnotation">@Plural</a></span></dt><dt><span class="sect1"><a href="#d5e2857">@Programmatic</a></span></dt><dt><span class="sect1"><a href="#sec.PrototypeAnnotation">@Prototype</a></span></dt><dt><span class="sect1"><a href="#d5e2879">@QueryOnly (deprecated)</a></span></dt><dt><span class="sect1"><a href="#sec.RegExAnnotation">@RegEx</a></span></dt><dt><span class="sect1"><a href="#d5e2900">@Resolve</a></span></dt><dt><span class="sect1"><a href="#sec.TitleAnnotation">@Title</a></span></dt><dt><span class="sect1"><a href="#d5e2931">@TypeOf</a></span></dt><dt><span class="sect1"><a href="#d5e2939">@TypicalLength</a></span></dt><dt><span class="sect1"><a href="#sec.ValueAnnotation">@Value</a></span></dt><dt><span class="sect1"><a href="#d5e2965">@ViewModel</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>All the annotations recognized in the <span class="emphasis"><em>Apache
        Isis</em></span> default programming model.</p>
      </div>

      <p>This chapter defines the set of annotations that are recognised by
      the <span class="emphasis"><em>Apache Isis</em></span> default programming model.</p>

      <div class="sect1" title="@ActionOrder"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2248"></a>@ActionOrder</h2></div></div></div>
        

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>The recommended mechanism for specifying the order in which
          actions are listed to the user is <code class="code">@MemberOrder</code> (see
          <a class="xref" href="#sec.MemberOrderAnnotation" title="@MemberOrder">the section called &#8220;@MemberOrder&#8221;</a>)</p>
        </div>

        <p><code class="code">@ActionOrder</code> provides a mechanism to specify the
        order in which actions appear in the user interface, in which the
        order is specified in one place in the class.</p>

        <p>For example:</p>

        <pre class="programlisting"><span class="strong"><strong>@ActionOrder("PlaceNewOrder, CheckCredit")</strong></span>
public class Customer {

    public Order placeNewOrder() {}

    public CreditRating checkCredit() {}

...
}</pre>

        <p>The action names are not case sensitive.</p>

        <p>Compared to <code class="classname">@MemberOrder</code>, there is
        (currently) one additional advantage in that you can easily specify
        groupings (which may be rendered by the viewer as sub-menus). This
        information may be used by the viewing mechanism to render actions
        into sub-menus.</p>

        <p>For example:</p>

        <pre class="programlisting">@ActionOrder("(Account Management: PlaceOrder, CheckCredit), (Personal Details: ChangeOfAddress, AddEmail)")
public class Customer {
    public CreditRating checkCredit() { ... }
    public void changeOfAddress() { ... }
    public Order placeNewOrder() { ... }
    public void addEmail(String emailAddress) { ... }
    ...
}</pre>

        <p>However, <code class="code">@ActionOrder</code> is more 'brittle' to change:
        if you change the name of an existing action you will need to ensure
        that the corresponding name within the <code class="code">@ActionOrder</code>
        annotation is also changed.</p>
      </div>

      <div class="sect1" title="@ActionSemantics"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2267"></a>@ActionSemantics</h2></div></div></div>
        

        <p>This annotation, which applies only to actions, describes
        whether the invocation is safe (as no side-effects), is idempotent
        (may have side-effects but always has the same postconditions), or is
        neither safe nor idempotent. If the annotation is missing then the
        framework assumes non-idempotent.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Customer {
    @ActionSemantics(Of.SAFE)
    public CreditRating checkCredit() { ... }

    @ActionSemantics(Of.IDEMPOTENT)
    public void changeOfAddress(Address address) { ... }

    @ActionSemantics(Of.NON_IDEMPOTENT)
    public Order placeNewOrder() { ... }
    ...
}</pre>

        <p>The annotation was introduced for the restfulobjects viewer in
        order that action invocations could be made available using either
        <acronym class="acronym">HTTP</acronym> <acronym class="acronym">GET</acronym>, <acronym class="acronym">PUT</acronym>
        or <acronym class="acronym">POST</acronym> (respectively). It is now also used in core
        runtime's in-built concurrency checking; the invocation of a safe
        action does not perform a concurrency check, whereas non-safe actions
        do perform a concurrency check.</p>
      </div>

      <div class="sect1" title="@AutoComplete"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2277"></a>@AutoComplete</h2></div></div></div>
        

        <p>This annotation is to support an auto-complete capability for
        reference properties and action parameters, the idea being that the
        user enters a few characters to locate a reference, and these are
        shown - for example - in a drop-down list box.</p>

        <p>The annotation is specified on the type, and specifies an action
        on a repository; this action should take a single string and should
        return a list of the type.</p>

        <p>For example:</p>

        <pre class="programlisting">@AutoComplete(repository=Customers.class, action="autoComplete")
public class Customer extends AbstractDomainObject {
   ....
}</pre>

        <p>where:</p>

        <pre class="programlisting">public interface Customers {

    @Hidden
    List&lt;Customer&gt; autoComplete(String search);
    ...
}</pre>

        <p>This annotation was first implemented in the Wicket
        viewer.</p>
      </div>

      <div class="sect1" title="@Aggregated"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2286"></a>@Aggregated</h2></div></div></div>
        

        <p>This annotation indicates that the object is aggregated, or
        wholly owned, by a root object. This information is of use by some
        object stores implementations (to store the aggregated objects
        "inline"). At the time of writing none of the viewers exploit this
        information, though this may change in the future. (For example, the
        <acronym class="acronym">DnD</acronym> viewer could be enhanced to prevent aggregated
        objects from being "dragged out" from their root object).</p>

        <p>All value types and all collections are automatically
        aggregated.</p>

        <div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
          <p>Outside of value types and collections, the
          <code class="classname">@Aggregated</code> semantics are not completely
          well-defined and so its use is currently discouraged.</p>
        </div>
      </div>

      <div class="sect1" title="@Bounded"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2294"></a>@Bounded</h2></div></div></div>
        

        <p>For immutable objects where there is a bounded set of instances,
        the <code class="literal">@Bounded</code> annotation can be
        used.</p>

        <p>For example:</p>

        <pre class="programlisting">@Bounded
public class County {
    ...
}</pre>

        <p>The number of instances is expected to be small enough that all
        instance can be held in memory. The viewer will use this information
        to render all the instances of this class in a drop-down list or
        equivalent.</p>

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>Although this is not enforced, <code class="literal">@Bounded</code> is intended for use on <code class="literal">final</code> classes. Its behaviour when used on
          interfaces, or classes with sub-classes is not specified</p>
        </div>
      </div>

      <div class="sect1" title="@Debug"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.DebugAnnotation"></a>@Debug</h2></div></div></div>
        

        <p>The <code class="classname">@Debug</code> annotation marks an action
        method as available in debug mode only, and so will not normally be
        displayed by the user interface.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Customer {
    public Order placeNewOrder() { ... }
    @Debug
    public List&lt;Order&gt; listRecentOrders() { ... }
    ...
}</pre>

        <p>The exact means to access <code class="classname">@Debug</code> actions
        depends on the viewer.</p>
      </div>

      <div class="sect1" title="@Defaulted"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2313"></a>@Defaulted</h2></div></div></div>
        

        <p>The concept of "defaulted" means being able to provide a default
        value for the type by way of the
        <code class="classname">org.apache.isis.applib.adapters.DefaultsProvider</code>
        interface. Generally this only applies to value types, where the
        <code class="classname">@Value</code> annotation (see <a class="xref" href="#sec.ValueAnnotation" title="@Value">the section called &#8220;@Value&#8221;</a>) implies encodability through the
        <code class="classname">ValueSemanticsProvider</code> interface (see <a class="xref" href="#chp.ValueTypes" title="Chapter&nbsp;10.&nbsp;Value Types">Chapter&nbsp;10, <i>Value Types</i></a>).</p>

        <p>For these reasons the <code class="classname">@Defaulted</code>
        annotation is generally never applied directly, but can be thought of
        as a placeholder for future enhancements whereby non-value types might
        also have a default value provided for them.</p>
      </div>

      <div class="sect1" title="@DescribedAs"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2323"></a>@DescribedAs</h2></div></div></div>
        

        <p>The <code class="literal">@DescribedAs</code> annotation
        is used to provide a short description of something that features on
        the user interface. How this description is used will depend upon the
        viewing mechanism - but it may be thought of as being like a 'tool
        tip'.</p>

        <p>Descriptions may be provided for objects, members (properties,
        collections and actions), and for individual parameters within an
        action method. <code class="literal">@DescribedAs</code>
        therefore works in a very similar manner to <code class="literal">@Named</code> (see <a class="xref" href="#sec.NamedAnnotation" title="@Named">the section called &#8220;@Named&#8221;</a>).</p>

        <div class="sect2" title="Providing a description for an object"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2331"></a>Providing a description for an object</h3></div></div></div>
          

          <p>To provide a description for an object, use the <code class="literal">@DescribedAs</code> annotation immediately before
          the declaration of that object class.</p>

          <p>For example:</p>

          <pre class="programlisting">@DescribedAs("A customer who may have originally become known to us via " +
             "the marketing system or who may have contacted us directly.")
public class ProspectiveSale {
   ...
}</pre>
        </div>

        <div class="sect2" title="Providing a description for an object member"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2337"></a>Providing a description for an object member</h3></div></div></div>
          

          <p>Any member (property, collection or action) may provide a
          description. To specify this description, use the <code class="literal">@DescribedAs</code> annotation immediately before
          the declaration of that member.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer {
    @DescribedAs("The name that the customer has indicated that they wish to be " +
                 "addressed as (e.g. Johnny rather than Jonathan)")
    public String getFirstName() { ... }
}</pre>
        </div>

        <div class="sect2" title="Providing a description for an action parameter"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2343"></a>Providing a description for an action parameter</h3></div></div></div>
          

          <p>To provide a description for an individual action parameter,
          use the <code class="literal">@DescribedAs</code> annotation
          in-line i.e. immediately before the parameter declaration.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer {
    public Order placeOrder(
                      Product product,
                      @Named("Quantity")
                      @DescribedAs("The quantity of the product being ordered")
                      int quantity) {
        Order order = createTransientInstance(Order.class);
        order.modifyCustomer(this);
        order.modifyProduct(product);
        order.setQuantity(quantity);        
        return order;
    }
    ...
}</pre>
        </div>
      </div>

      <div class="sect1" title="@Disabled"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2349"></a>@Disabled</h2></div></div></div>
        

        <p>The <code class="literal">@Disabled</code> annotation
        means that the member cannot be used in any instance of the class.
        When applied to the property it means that the user may not modify the
        value of that property (though it may still be modified
        programmatically). When applied to an action method, it means that the
        user cannot invoke that method.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Customer {
    @Disabled
    public void assessCreditWorthiness() { ... }

    @Disabled
    public int getInitialCreditRating(){ ... }
    public void setInitialCreditRating(int initialCreditRating) { ... }
}</pre>

        <p>Note that if an action is marked as <code class="literal">@Disabled</code>, it will be shown on the user
        interface but cannot ever be invoked. The only possible reason we can
        think to do this is during prototyping, to indicate an action that is
        still to be developed. If a method is intended for programmatic use,
        but not intended ever to be invoked directly by a user, then it should
        be marked as <code class="literal">@Hidden</code>
        instead.</p>

        <p>This annotation can also take two parameter indicating where (in
        the UI) it is to be disabled, and when (in the object's lifecycle) it
        is to be disabled. For example:</p>

        <pre class="programlisting">public class Customer {
    <span class="strong"><strong>@Disabled</strong></span>(when=When.UNTIL_PERSISTED)
    public void assessCreditWorthiness() { ... }
}</pre>

        <p>would disable the action until the object has been saved.
        And:</p>

        <pre class="programlisting">public class Customer {
    <span class="strong"><strong>@Disabled</strong></span>(where=Where.PARENTED_TABLES)
    public void getFirstName() { ... }
}</pre>

        <p>would disable the property in parented tables but not in regular
        object forms (though note: this would only be used by viewers that
        provide in-table editing capability).</p>

        <p>The acceptable values for the <code class="varname">where</code> parameter
        are:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="code">Where.ANYWHERE</code></p>

            <p>The member should be disabled everywhere.</p>
          </li><li class="listitem">
            <p><code class="code">Where.OBJECT_FORMS</code></p>

            <p>The member should be disabled when displayed within an
            object form. For most viewers, this applies to property and
            collection members, not actions.</p>
          </li><li class="listitem">
            <p><code class="code">Where.PARENTED_TABLES</code></p>

            <p>The member should be disabled when displayed as a column of
            a table within a parent object's collection. For most (all?)
            viewers, this will have meaning only if applied to a property
            member.</p>
          </li><li class="listitem">
            <p><code class="code">Where.STANDALONE_TABLES</code></p>

            <p>The member should be disabled when displayed as a column of
            a table showing a standalone list of objects, for example as
            returned by a repository query. For most (all?) viewers, this will
            have meaning only if applied to a property member.</p>
          </li><li class="listitem">
            <p><code class="code">Where.ALL_TABLES</code></p>

            <p>The member should be disabled when displayed as a column of
            a table, either an object's * collection or a standalone list.
            This combines PARENTED_TABLE} and STANDALONE_TABLE</p>
          </li><li class="listitem">
            <p><code class="code">Where.NOWHERE</code></p>

            <p>Has no meaning for the <code class="classname">@Disabled</code>
            annotation (though is used by the <code class="classname">@Hidden</code>
            annotation, see <a class="xref" href="#sec.HiddenAnnotation" title="@Hidden">the section called &#8220;@Hidden&#8221;</a>).</p>
          </li></ul></div>

        <p>The acceptable values for the <code class="varname">when</code> parameter
        are:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="code">When.ALWAYS</code></p>

            <p>The member should be disabled at all times.</p>
          </li><li class="listitem">
            <p><code class="code">When.NEVER</code></p>

            <p>The member should never be disabled (unless disabled through
            some other mechanism, for example an imperative
            <code class="methodname">disableXxx()</code> supporting method)..</p>
          </li><li class="listitem">
            <p><code class="code">When.ONCE_PERSISTED</code></p>

            <p>The member should be enabled for transient objects, but
            disabled for persisted objects.</p>
          </li><li class="listitem">
            <p><code class="code">When.UNTIL_PERSISTED</code></p>

            <p>The member should be disabled for transient objects, but
            enabled for persisted objects.</p>
          </li></ul></div>

        <p>By default the annotated property or action is always disabled
        (ie defaults to <code class="classname">Where.ANYWHERE</code>,
        <code class="classname">When.ALWAYS</code>).</p>
      </div>

      <div class="sect1" title="@Encodable"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2418"></a>@Encodable</h2></div></div></div>
        

        <p>Encodability means the ability to convert an object to-and-from
        a string, by way of the
        <code class="classname">org.apache.isis.applib.adapters.EncoderDecoder</code>
        interface. Generally this only applies to value types, where the
        <code class="classname">@Value</code> annotation (see <a class="xref" href="#sec.ValueAnnotation" title="@Value">the section called &#8220;@Value&#8221;</a>) implies encodability through the
        <code class="classname">ValueSemanticsProvider</code> interface (see <a class="xref" href="#chp.ValueTypes" title="Chapter&nbsp;10.&nbsp;Value Types">Chapter&nbsp;10, <i>Value Types</i></a>).</p>

        <p>For these reasons the <code class="classname">@Encodable</code>
        annotation is generally never applied directly, but can be thought of
        as a placeholder for future enhancements whereby non-value types might
        also be directly encoded.</p>
      </div>

      <div class="sect1" title="@EqualByContent"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2428"></a>@EqualByContent</h2></div></div></div>
        

        <p>Equal-by-content is a characteristic of value types, and is
        implied by any class annotated with the the
        <code class="classname">@Value</code> annotation (see <a class="xref" href="#sec.ValueAnnotation" title="@Value">the section called &#8220;@Value&#8221;</a> and also <a class="xref" href="#chp.ValueTypes" title="Chapter&nbsp;10.&nbsp;Value Types">Chapter&nbsp;10, <i>Value Types</i></a>).</p>

        <p>The <code class="classname">@EqualByContent</code> annotation exists so
        that this semantic could, if required, by applied directly to an
        object without it necessarily also being annotated as a value.</p>

        <p>That said, this annotation is only really for completeness.
        Moreover, the semantic captured by this annotation is currently used
        by the framework (not in any object store nor viewer).</p>
      </div>

      <div class="sect1" title="@Executed"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2437"></a>@Executed</h2></div></div></div>
        

        <p>The <code class="classname">@Executed</code> annotation is relevant only
        for client/server deployments (eg with the DnD viewer).</p>

        <p>In a client/server deployment, all methods for persistent
        objects are executed on the server-side and for transient objects are
        executed on the client-side.</p>

        <p>This annotation can be used to override that default.</p>

        <div class="sect2" title="Forcing a method to be executed on the client"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2443"></a>Forcing a method to be executed on the client</h3></div></div></div>
          

          <p>The <code class="classname">@Executed(Where.LOCALLY)</code> annotation
          marks an action method so that it executes on the client, rather
          than being forwarded to the server for execution. This is useful for
          methods that invoke a service that must be run client-side, for
          example spawning off a separate process (such as a web browser or
          Acrobat Reader).</p>
        </div>

        <div class="sect2" title="Forcing a method to be executed on the server"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2447"></a>Forcing a method to be executed on the server</h3></div></div></div>
          

          <p>The <code class="classname">@Executed(Where.REMOTELY)</code>
          annotation marks an action method so that it executes on the server,
          even though it would normally be executed on the client (as methods
          for transient objects are). This is useful for methods that although
          based on transient objects need access to persistent objects.</p>
        </div>
      </div>

      <div class="sect1" title="@Exploration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.ExplorationAnnotation"></a>@Exploration</h2></div></div></div>
        

        <p>The <code class="classname">@Exploration</code> annotation marks an
        action method as available in exploration mode only, and therefore not
        intended for use in the production system. An exploration action may
        or may not also be a debug action (annotated with
        <code class="classname">@Debug</code>, see <a class="xref" href="#sec.DebugAnnotation" title="@Debug">the section called &#8220;@Debug&#8221;</a>).</p>

        <p>For example:</p>

        <pre class="programlisting">public class Customer {
    public Order placeNewOrder() { ... }
    @Exploration
    public List&lt;Order&gt; listRecentOrders() { ... }
    ...
}</pre>

        <p>See also the <code class="classname">@Prototype</code> annotation, <a class="xref" href="#sec.PrototypeAnnotation" title="@Prototype">the section called &#8220;@Prototype&#8221;</a></p>
      </div>

      <div class="sect1" title="@Facets"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2462"></a>@Facets</h2></div></div></div>
        

        <p>The <code class="classname">@Facets</code> annotation specifies
        <code class="classname">FacetFactory</code> implementations and so can be used
        to run install arbitrary <code class="classname">Facet</code>s for a type.
        Generally this is not needed, but can be useful for overriding a
        custom programming model where a <code class="classname">FacetFactory</code>
        is not typically included.</p>

        <p>See the core documentation for more on writing
        <code class="classname">FacetFactory</code>s.</p>
      </div>

      <div class="sect1" title="@FieldOrder"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2471"></a>@FieldOrder</h2></div></div></div>
        

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>The recommended mechanism for specifying the order in which
          fields are listed to the user is <code class="code">@MemberOrder</code> (see
          <a class="xref" href="#sec.MemberOrderAnnotation" title="@MemberOrder">the section called &#8220;@MemberOrder&#8221;</a>)</p>
        </div>

        <p><code class="code">@FieldOrder</code> provides a mechanism to specify the
        order in which fields appear in the user interface, in which the order
        is specified in one place in the class.</p>

        <p>For example:</p>

        <pre class="programlisting">@FieldOrder("Name, Address, DateOfBirth, RecentOrders")
public class Customer {
    public Date getDateOfBirth() {...}
    public List&lt;Order&gt; getRecentOrders() {...}
    public String getAddress() {...}
    public String getName() {...}
    ...
}</pre>

        <p>The field names are not case sensitive.</p>

        <p>However, <code class="code">@FieldOrder</code> is more 'brittle' to change:
        if you change the name of an existing property you will need to ensure
        that the corresponding name within the <code class="code">@FieldOrder</code>
        annotation is also changed.</p>
      </div>

      <div class="sect1" title="@Hidden"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.HiddenAnnotation"></a>@Hidden</h2></div></div></div>
        

        <p>The <code class="literal">@Hidden</code> annotation
        indicates that the member (property, collection or action) to which it
        is applied should never be visible to the user. It can also be applied
        to service types (it has no effect if applied to entities or
        values).</p>

        <p>For example:</p>

        <pre class="programlisting">public class Customer {
    @Hidden
    public int getInternalId() { ... }

    @Hidden
    public void updateStatus() { ... }
    ...
}</pre>

        <p>Or, applied to a service:</p>

        <pre class="programlisting">@Hidden
public class EmailService {
    public void sendEmail(...) { ... }
    ...
}</pre>

        <p>This annotation can also take a parameters indicating where and
        when it is to be hidden. For example:</p>

        <pre class="programlisting">public class Customer {
    @Hidden(when=When.ONCE_PERSISTED)
    public int getInternalId() { ... }
    ...
}</pre>

        <p>would show the <code class="varname">Id</code> until the object has been
        saved, and then would hide it. And:</p>

        <pre class="programlisting">public class Customer {
    @Hidden(where=Where.ALL_TABLES)
    public int getDateOfBirth() { ... }
    ...
}</pre>

        <p>would suppress the <code class="varname">dateOfBirth</code> property of a
        Customer from all tables.</p>

        <p>The acceptable values for the <code class="varname">where</code> parameter
        are:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="code">Where.ANYWHERE</code></p>

            <p>The member should be hidden everywhere.</p>
          </li><li class="listitem">
            <p><code class="code">Where.OBJECT_FORMS</code></p>

            <p>The member should be hidden when displayed within an object
            form. For most viewers, this applies to property and collection
            members, not actions.</p>
          </li><li class="listitem">
            <p><code class="code">Where.PARENTED_TABLES</code></p>

            <p>The member should be hidden when displayed as a column of a
            table within a parent object's collection. For most (all?)
            viewers, this will have meaning only if applied to a property
            member.</p>
          </li><li class="listitem">
            <p><code class="code">Where.STANDALONE_TABLES</code></p>

            <p>The member should be hidden when displayed as a column of a
            table showing a standalone list of objects, for example as
            returned by a repository query. For most (all?) viewers, this will
            have meaning only if applied to a property member.</p>
          </li><li class="listitem">
            <p><code class="code">Where.ALL_TABLES</code></p>

            <p>The member should be /hidden when displayed as a column of a
            table, either an object's * collection or a standalone list. This
            combines <code class="classname">PARENTED_TABLES</code> and
            <code class="classname">STANDALONE_TABLES</code>.</p>
          </li><li class="listitem">
            <p><code class="code">Where.NOWHERE</code></p>

            <p>Acts as an override if a member would normally be hidden as
            a result of some other convention. For example, if a property is
            annotated with <code class="classname">@Title</code> (see <a class="xref" href="#sec.TitleAnnotation" title="@Title">the section called &#8220;@Title&#8221;</a>), then normally this should be
            hidden from all tables. Additionally annotating with
            <code class="code">@Hidden(where=Where.NOWHERE)</code> overrides this.</p>
          </li></ul></div>

        <p>The acceptable values for the <code class="varname">when</code> parameter
        are:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="code">When.ALWAYS</code></p>

            <p>The member should be hidden at all times.</p>
          </li><li class="listitem">
            <p><code class="code">When.NEVER</code></p>

            <p>The member should never be hidden (unless disabled through
            some other mechanism, for example an imperative
            <code class="methodname">disableXxx()</code> supporting method)..</p>
          </li><li class="listitem">
            <p><code class="code">When.ONCE_PERSISTED</code></p>

            <p>The member should be visible for transient objects, but
            hidden for persisted objects.</p>
          </li><li class="listitem">
            <p><code class="code">When.UNTIL_PERSISTED</code></p>

            <p>The member should be hidden for transient objects, but
            visible for persisted objects.</p>
          </li></ul></div>

        <p>By default the annotated property or action is always hidden (ie
        defaults to <code class="classname">Where.ANYWHERE</code>,
        <code class="classname">When.ALWAYS</code>).</p>
      </div>

      <div class="sect1" title="@Idempotent (deprecated)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2555"></a>@Idempotent (deprecated)</h2></div></div></div>
        

        <p>Equivalent to using <code class="code">@ActionSemantics(Of.IDEMPOTENT)</code>
        on an action.</p>
      </div>

      <div class="sect1" title="@Ignore (deprecated)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2559"></a>@Ignore (deprecated)</h2></div></div></div>
        

        <p>Equivalent to using <code class="code">@Programmatic</code>. The
        <code class="classname">@Programmatic</code> annotation was introduced because
        <code class="classname">@Ignore</code> can easily clash with
        <code class="classname">@org.junit.Ignore</code>.</p>
      </div>

      <div class="sect1" title="@Immutable"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2566"></a>@Immutable</h2></div></div></div>
        

        <p>The <code class="literal">@Immutable</code> annotation may
        be applied to a class, and indicates to the framework that the state
        of such objects may not be changed. The viewers will prevent any
        change through the user interface, and moreover the object stores will
        reject any changes to the objects that might have occurred
        programmatically.</p>

        <p>For example:</p>

        <pre class="programlisting">@Immutable
public class Country {
    ...
}</pre>

        <p>This annotation can also take a single parameter indicating when
        it is to become immutable. For example:</p>

        <pre class="programlisting">@Immutable(When.ONCE_PERSISTED)
public class Email {
    ...
}</pre>

        <p>This would allow the user to create an email object and set it
        up, and then prevent any changes once it has been saved.</p>

        <p>The acceptable values for the parameter are:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="code">When.ALWAYS</code></p>
          </li><li class="listitem">
            <p><code class="code">When.NEVER</code></p>
          </li><li class="listitem">
            <p><code class="code">When.ONCE_PERSISTED</code></p>
          </li><li class="listitem">
            <p><code class="code">When.UNTIL_PERSISTED</code></p>
          </li></ul></div>

        <p>By default the annotated property or action is always immutable
        (ie defaults to <code class="classname">When.ALWAYS</code>).</p>
      </div>

      <div class="sect1" title="@Mask"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.MaskAnnotation"></a>@Mask</h2></div></div></div>
        

        <p>The <code class="literal">@Mask</code> annotation may be
        applied to any property, or to any parameter within an action method,
        that allows the user to type in text as input. It can also annotate a
        string-based value type, and thereby apply to all properties or
        parameters of that type.</p>

        <p>The mask serves to validate, and potentially to normalise, the
        format of the input. The characters that can be used are based on
        Swing's <code class="classname">javax.swing.text.MaskFormatter</code>, and
        also Java's <code class="classname">java.util.SimpleDateFormat</code>.</p>

        <p>For example, on a property:</p>

        <pre class="programlisting">public class Email {
    @Mask("(NNN)NNN-NNNN")
    public String getTelephoneNumber() {...}
    public void setTelephoneNumber(String telNo) {...}
    ...
}</pre>

        <p>Or, on an action parameter:</p>

        <pre class="programlisting">public void ContactRepository {
    public void newContact(
            @Named("Contact Name") String contactName
           ,@Mask("(NNN)NNN-NNNN") 
            @Named("Telephone Number") String telNo) { 
        ...
    }
    ... 
}</pre>

        <p>Or, on a value type:</p>

        <pre class="programlisting">@Value(...)
@MaxLength(30)
public class CustomerFirstName {
    ...
}</pre>

        <p>See also <code class="classname">@RegEx</code> annotation, <a class="xref" href="#sec.RegExAnnotation" title="@RegEx">the section called &#8220;@RegEx&#8221;</a>.</p>
      </div>

      <div class="sect1" title="@MaxLength"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.MaxLengthAnnotation"></a>@MaxLength</h2></div></div></div>
        

        <p>The <code class="literal">@MaxLength</code> annotation
        indicates the maximum number of characters that the user may enter
        into a <code class="literal">String</code> property, or a
        <code class="literal">String</code> parameter in an action, or
        for a string-based value type. It is ignored if applied to any other
        type.</p>

        <p>For example, on a property:</p>

        <pre class="programlisting">public class Customer {
    @MaxLength(30)
    public String getFirstName() { ... }
    public void setFirstName(String firstName) { ... }
    ...
}</pre>

        <p>Or, on an action parameter:</p>

        <pre class="programlisting">public class CustomerRepository {
    public Customer newCustomer(
        @MaxLength(30)
        @Named("First Name") String firstName
       ,@MaxLength(30)
        @Named("Last Name") String lastName) {
    ...
}</pre>

        <p>Or, for a value type:</p>

        <pre class="programlisting">@Value(...)
@MaxLength(30)
public class CustomerFirstName {
    ...
}</pre>

        <p>If the model is being persisted to a relational database then
        <code class="literal">@MaxLength</code> should be specified for
        all <code class="literal">String</code> properties and action
        parameters.</p>
      </div>

      <div class="sect1" title="@MemberGroups"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.MemberGroupsAnnotation"></a>@MemberGroups</h2></div></div></div>
        

        <p><code class="code">@MemberGroups</code> is designed to work in conjunction
        with <code class="classname">@MemberOrder</code> (see <a class="xref" href="#sec.MemberOrderAnnotation" title="@MemberOrder">the section called &#8220;@MemberOrder&#8221;</a>), and specifies the order in
        which groups of members should be rendered.</p>

        <p>For example:</p>

        <pre class="programlisting">@MemberGroups({"General", "Dates", "Other"})
public Class Customer {
    @MemberOrder(name="General", sequence="1.1")
    public String getFirstName() {...}
    public void setFirstName(value as String) {...}

    @MemberOrder(name="General", sequence="1.2")
    public String getLastName() {...}
    public void setLastName(value as String) {...}

    @MemberOrder(name="Other", sequence="1")
    public String getAddress() {...}
    public void setAddress(value as String) {...}

    @MemberOrder(name="Dates", sequence="1")
    public Date getDateOfBirth() {...}
    public void setDateOfBirth(value as Date) {...}
    ...
}   </pre>

        <p>If the <code class="classname">@MemberOrder</code>'s name is not
        specified, then its group is assumed to be
        "<code class="literal">General</code>".</p>
      </div>

      <div class="sect1" title="@MemberOrder"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.MemberOrderAnnotation"></a>@MemberOrder</h2></div></div></div>
        

        <p><code class="code">@MemberOrder</code> is the recommended mechanism for
        specifying the order in which fields and/or actions are presented to
        the user. (<code class="code">@ActionOrder</code> and <code class="code">@FieldOrder</code>
        provide alternative, deprecated mechanisms).</p>

        <p><code class="code">@MemberOrder</code> is specified at the individual member
        level, relative to other members, as a string. The simplest convention
        is to use numbers - 1, 2, 3 - though it is a better idea to leave gaps
        in the numbers - 10, 20, 30 perhaps - such that a new member may be
        added without having to edit existing numbers. A useful alternative is
        to adopt the 'dewey-decimal' notation - 1, 1.1, 1.2, 2, 3, 5.1.1,
        5.2.2, 5.2, 5.3 - which allows for an indefinite amount of future
        insertion, and allows subclasses to insert their class members as
        required.</p>

        <p>For example:</p>

        <pre class="programlisting">public Class Customer {
    @MemberOrder(sequence="2.1")
    public String getAddress() {...}
    public void setAddress(value as String) {...}

    @MemberOrder(sequence="1.1")
    public String getFirstName() {...}
    public void setFirstName(value as String) {...}

    @MemberOrder(sequence="1.2")
    public String getLastName() {...}
    public void setLastName(value as String) {...}

    @MemberOrder(sequence="3")
    public Date getDateOfBirth() {...}
    public void setDateOfBirth(value as Date) {...}
    ...
}   </pre>

        <p>If a member does not have a specified order then it will be
        placed after those that are specified. Two members may have the same
        sequence specifier, but in such a case the relative ordering of those
        members will be indeterminate.</p>

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>Certain styles of user interface may lay out an object's
          properties and its collections separately, in which case the
          relative member order of properties and collections will be
          evaluated separately. In general, though, consider the layout of all
          properties and collections together, and of all actions
          together.</p>
        </div>

        <p>As a refinement to this, some viewers support the notion of
        grouping members together. In this case the <code class="varname">name</code>
        attribute can be specified.</p>

        <p>For example, the following can be used to group
        properties:</p>

        <pre class="programlisting">public Class Customer {
    @MemberOrder(name="General", sequence="1.1")
    public String getFirstName() {...}
    public void setFirstName(value as String) {...}

    @MemberOrder(name="General", sequence="1.2")
    public String getLastName() {...}
    public void setLastName(value as String) {...}

    @MemberOrder(name="Other", sequence="1")
    public String getAddress() {...}
    public void setAddress(value as String) {...}

    @MemberOrder(name="Dates", sequence="1")
    public Date getDateOfBirth() {...}
    public void setDateOfBirth(value as Date) {...}
    ...
}   </pre>

        <p>In this case the <code class="varname">sequence</code> is ordered with
        respect to the <code class="varname">name</code>. If using group names in this
        way, typically the MemberGroups annotation (see <a class="xref" href="#sec.MemberGroupsAnnotation" title="@MemberGroups">the section called &#8220;@MemberGroups&#8221;</a>) should also be specified,
        allowing the order of the groups themselves to be sorted.</p>

        <p>Grouping can also be performed on actions. Some viewers (for
        example the Wicket viewer) support the idea that the group name can be
        the name of a collection. In this case, the action is rendered "near
        to" the collection (for example, to support add or remove of
        elements).</p>

        <p>For example:</p>

        <pre class="programlisting">public Class Customer {

    public List&lt;CommunicationChannel&gt; getCommunicationChannels() { ... }

    ...
    @MemberOrder(name="communicationChannels", sequence="1.1")
    public void addCommunicationChannel(...) { ... }

    @MemberOrder(name="communicationChannels", sequence="1.2")
    public void removeCommunicationChannel(...) { ... }

    ...
}   </pre>
      </div>

      <div class="sect1" title="@MultiLine"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2657"></a>@MultiLine</h2></div></div></div>
        

        <p>The <code class="literal">@MultiLine</code> annotation
        provides information about the carriage returns in a <code class="literal">String</code> property or action parameter, or for
        a string-based value type. It also implies a hint to the viewer that
        the widget to be used should be over multiple lines (eg a text area
        rather than a text field), with appropriate wrapping and/or
        scrollbars.</p>

        <p>More formally, the annotation indicates that:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>the <code class="code">String</code> property or parameter may contain
            carriage returns, and</p>
          </li><li class="listitem">
            <p>(optionally) the typical number of such carriage returns
            (meaning the number of rows in the text area), and</p>
          </li><li class="listitem">
            <p>(optionally) that the text should be wrapped (the default is
            that text is not wrapped).</p>
          </li></ul></div>

        <div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
          <p>Currently the <code class="literal">preventWrapping</code> functionality is not fully
          implemented.</p>
        </div>

        <p>The syntax is:</p>

        <p><code class="literal">@MultiLine([numberOfLines=&lt;typicalNumberOfCRs&gt;]
        [,preventWrapping=&lt;false|true&gt;])</code></p>

        <p>For example:</p>

        <pre class="programlisting">public class BugReport {
    @MultiLine(numberOfLines=10)
    public String getStepsToReproduce() { ... }
    public void setStepsToReproduce(String stepsToReproduce) { ... }
    ...
}</pre>

        <p>Here the <code class="literal">stepsToReproduce</code> may
        be displayed in a text area of 10 rows, with no wrapping. A horizontal
        scrollbar may appear if the number of characters on any given row
        exceeds the width.</p>

        <p>Another example:</p>

        <pre class="programlisting">public class Email {
    @MultiLine(numberOfLines=20, preventWrapping=false)
    public String getBody() { ... }
    public void setBody(String body) { ... }
    ...
}</pre>

        <p>Here the body should be displayed in a text area of 20 rows,
        with wrapping.</p>

        <p>If the annotation is combined with the <code class="literal">@TypicalLength</code>, then the expected width of
        the text area in the user interface will be determined by the value of
        the typical length divided by the number of specified lines. For
        example:</p>

        <pre class="programlisting">public class Email {
    @MultiLine(numberOfLines=20, preventWrapping=false)
    @TypicalLength(800)
    public String getBody() { ... }
    public void setBody(String body) { ... }
    ...
}</pre>

        <p>Here the body will (likely be) displayed in a text area of 20
        rows, with 40 columns.</p>
      </div>

      <div class="sect1" title="@MustSatisfy"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2688"></a>@MustSatisfy</h2></div></div></div>
        

        <p>The <code class="literal">@MustSatisfy</code> annotation
        allows validation to be applied to properties and parameters using an
        (implementation of a)
        <code class="classname">org.apache.isis.applib.spec.Specification</code>
        object.</p>

        <p>For example, on a property:</p>

        <pre class="programlisting">public class Customer {
    @MustSatisfy(StartWithCapitalLetterSpecification.class)
    public String getFirstName() { ... }
    ...
}</pre>

        <p>Or, on an action parameter:</p>

        <pre class="programlisting">public class CustomerRepository {
    public Customer newCustomer(
            @MustSatisfy(StartWithCapitalLetterSpecification.class)
            @Named("First Name") firstName
           ,@MustSatisfy(StartWithCapitalLetterSpecification.class)
            @Named("Last Name") lastName) {
        ...
    }
    ...
}</pre>

        <p>The <code class="classname">Specification</code> is consulted during
        validation, being passed the proposed value.</p>

        <p>An alternative to using <code class="classname">@MustSatisfy</code> is
        to define a custom value type, see <a class="xref" href="#chp.ValueTypes" title="Chapter&nbsp;10.&nbsp;Value Types">Chapter&nbsp;10, <i>Value Types</i></a>.</p>
      </div>

      <div class="sect1" title="@Named"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.NamedAnnotation"></a>@Named</h2></div></div></div>
        

        <p>The <code class="literal">@Named</code> annotation is used
        when you want to specify the way something is named on the user
        interface i.e. when you do not want to use the name generated
        automatically by the system. It can be applied to objects, members
        (properties, collections, and actions) and to parameters within an
        action method.</p>

        <div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
            <p>Generally speaking it is better to rename the property,
            collection or action. The only common case where
            <code class="literal">@Named</code> is common is to rename parameters for
            built-in value types. Even here though a custom value type can be
            defined using <code class="classname">@Value</code> so that the value type
            is used as the parameter name. <code class="classname">@Named</code> may
            also be used if the name needs punctuation or other symbols in the
            name presented to the user.</p>
          </div>

        <div class="sect2" title="Specifying the name of an object"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2712"></a>Specifying the name of an object</h3></div></div></div>
          

          <p>By default the name of an object is derived, reflectively from
          the class name. To specify a different name for an object, use the
          <code class="literal">@Named</code> annotation in front of the
          class declaration.</p>

          <p>For example:</p>

          <pre class="programlisting">@Named("Customer")
public class CustomerImpl implements Customer{
   ...
}</pre>

          <p>See also the <code class="literal">@Plural</code>
          annotation, <a class="xref" href="#sec.PluralAnnotation" title="@Plural">the section called &#8220;@Plural&#8221;</a>.</p>
        </div>

        <div class="sect2" title="Specifying the name of a class member"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2721"></a>Specifying the name of a class member</h3></div></div></div>
          

          <p>By default, the name of a class member (a property, collection
          or action) presented to the user is derived, reflectively, from the
          name of the member defined in the program code. To specify a
          different name use the <code class="literal">@Named
          </code>annotation immediately before the member
          declaration.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer {
    <span class="strong"><strong>@Named("Given Name")</strong></span>
    public String getFirstName() { ... }

    <span class="strong"><strong>@Named("Family Name")</strong></span>
    public String getSurname() { ... }

    public CreditRating getCreditRating() { ... }
}</pre>

          <p>Note that the framework provides a separate and more powerful
          mechanism for internationalisation.</p>
        </div>

        <div class="sect2" title="Specifying the name for an action parameter"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2730"></a>Specifying the name for an action parameter</h3></div></div></div>
          

          <p>The most common usage of <code class="literal">@Named</code> is be to specify names for the
          parameters of an action. This is because the parameter name declared
          in the code for the action method cannot be picked up reflectively
          (by default, the user interface will use the type of the parameter
          as the name; for a String or a Boolean, this is almost certainly not
          what is required).</p>

          <p>To specify the name of a parameter, the <code class="literal">@Named</code> annotation is applied 'in-line'
          (i.e. preceding the individual parameter declaration.</p>

          <p>For example:</p>

          <pre class="programlisting">public class Customer {
    public Order placeOrder(
            Product product
           ,@Named("Quantity")
            int quantity) {
        Order order = newTransientInstance(Order.class);
        order.modifyCustomer(this);
        order.modifyProduct(product);
        order.setQuantity(quantity);        
        return order;
    }
    ...
}</pre>

          <p>An alternative is to use a value type, as described in <a class="xref" href="#chp.ValueTypes" title="Chapter&nbsp;10.&nbsp;Value Types">Chapter&nbsp;10, <i>Value Types</i></a>.</p>
        </div>
      </div>

      <div class="sect1" title="@NotContributed"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.NotContributedAnnotation"></a>@NotContributed</h2></div></div></div>
        

        <p>The <code class="classname">@NotContributed</code> annotation applies
        only to action methods, and specifically to the actions of services.
        If present, it indicates that the action should not be contributed to
        any of its domain object arguments.</p>

        <p>For example:</p>

        <pre class="programlisting">public class OrderServices {
    @NotContributed
    public void cancel(Order order);
    ...
}</pre>

        <p>If the action should neither be contributed nor appear in the
        service's service menu (see <a class="xref" href="#sec.NotInServiceMenuAnnotation" title="@NotInServiceMenu">the section called &#8220;@NotInServiceMenu&#8221;</a>), then you could instead
        simply mark it as <code class="classname">@Hidden</code> (see <a class="xref" href="#sec.HiddenAnnotation" title="@Hidden">the section called &#8220;@Hidden&#8221;</a>).</p>
      </div>

      <div class="sect1" title="@NotInServiceMenu"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.NotInServiceMenuAnnotation"></a>@NotInServiceMenu</h2></div></div></div>
        

        <p>The <code class="classname">@NotInServiceMenu</code> annotation applies
        only to action methods, and specifically to the actions of services.
        If present, it indicates that the action should not appear in the
        service menu for the service. It may, however, still be contributed to
        any of its domain object arguments.</p>

        <p>For example:</p>

        <pre class="programlisting">public class OrderServices {
    @NotInServiceMenu
    public void cancel(Order order);
    ...
}</pre>

        <p>If the action should neither be contributed (see <a class="xref" href="#sec.NotContributedAnnotation" title="@NotContributed">the section called &#8220;@NotContributed&#8221;</a>) nor appear in the service's
        service menu, then you could instead simply mark it as
        <code class="classname">@Hidden</code> (see <a class="xref" href="#sec.HiddenAnnotation" title="@Hidden">the section called &#8220;@Hidden&#8221;</a>).</p>
      </div>

      <div class="sect1" title="@NotPersistable"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="not-persistable"></a>@NotPersistable</h2></div></div></div>
        

        <p>The <code class="classname">@NotPersistable</code> annotation indicates
        that transient instances of this class may be created but may not be
        persisted. The framework will not provide the user with an option to
        'save' the object, and attempting to persist such an object
        programmatically would be an error.</p>

        <p>For example:</p>

        <pre class="programlisting"><code class="classname">@NotPersistable</code>
public class InputForm {
    // members and actions here
}</pre>

        <p>This annotation can also take a single parameter indicating
        whether it is only the user that cannot persist the object, for
        example the following code would prevent the user from saving the
        object (via the viewer) but still allow the program to persist the
        object.</p>

        <p>For example:</p>

        <pre class="programlisting">@NotPersistable(By.USER)
public class InputForm {
    ...
}</pre>

        <p>The acceptable values for the parameter are:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p><code class="code">By.USER</code></p>
          </li><li class="listitem">
            <p><code class="code">By.USER_OR_PROGRAM</code></p>
          </li></ul></div>

        <p>By default the annotated object is effectively transient (ie
        default to
        <code class="classname">By</code>.<code class="varname">USER_OR_PROGRAM</code>).</p>
      </div>

      <div class="sect1" title="@NotPersisted"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2781"></a>@NotPersisted</h2></div></div></div>
        

        <p>The <code class="classname">@NotPersisted</code> annotation indicates
        that the property is not to be persisted.</p>

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>In many cases the same thing can be achieved simply by
          providing the property with a 'getter' but no 'setter'.</p>
        </div>

        <p>For example:</p>

        <pre class="programlisting">public class Order {

    @NotPersisted
    public Order getPreviousOrder() {...}
    public void setPreviousOrder(Order previousOrder) {...}

    ...
}</pre>
      </div>

      <div class="sect1" title="@ObjectType"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2789"></a>@ObjectType</h2></div></div></div>
        

        <p>The <code class="classname">@ObjectType</code> annotation is used to
        provide a unique abbreviation for the object's class name. This is
        used internally to generate a string representation of an objects
        identity (the Oid).</p>

        <p>For example:</p>

        <pre class="programlisting">@ObjectType("ORD")
public class Order {

    ...
}</pre>

        <p>If no <code class="code">@ObjectType</code> annotation is present, then the
        framework uses the fully-qualified class name.</p>

        <p>If an <code class="code">@ObjectType</code> is not unique, then the framework
        will fail to boot.</p>
      </div>

      <div class="sect1" title="@Optional"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2799"></a>@Optional</h2></div></div></div>
        

        <p>By default, the system assumes that all properties of an object
        are required, and therefore will not let the user save a new object
        unless a value has been specified for each property. Similarly, by
        default, the system assumes that all parameters in an action are
        required and will not let the user execute that action unless values
        have been specified for each parameter.</p>

        <p>To indicate that either a property, or an action parameter, is
        optional, use the <code class="literal">@Optional</code>
        annotation.</p>

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>The <code class="literal">@Optional</code>annotation has
          no meaning for a primitive property (or parameter) such as <code class="literal">int</code> - because primitives will always
          return a default value (e.g. zero). If optionality is required, then
          use the corresponding wrapper class (e.g. java.lang.Integer).</p>
        </div>

        <div class="sect2" title="Making a property optional"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2808"></a>Making a property optional</h3></div></div></div>
          

          <p>Annotate the getter to indicate that a property is
          <code class="classname">@Optional</code>. For example:</p>

          <pre class="programlisting">public class Order {
    public Product getProduct() { ... }
    
    public java.util.Date getShipDate() { ... }
    public void setShipDate(Date java.util.shipDate) { ... }

    @Optional
    public String getComments() { ... }
    public void setComments(String comments) { ... }
}</pre>

          <p>Here the <code class="literal">product</code> and
          <code class="literal">shipDate</code> properties are both
          required, but the <code class="literal">comments</code>
          property is optional.</p>
        </div>

        <div class="sect2" title="Making an action parameter optional"><div class="titlepage"><div><div><h3 class="title"><a name="d5e2817"></a>Making an action parameter optional</h3></div></div></div>
          

          <p>To indicate that an action may be invoked without having to
          specify a value for a particular parameter, annotate with
          <code class="literal">@Optional</code>. For example:</p>

          <pre class="programlisting">public class Customer {
    public Order placeOrder(
            Product product
           ,@Named("Quantity") int quantity
           ,@Optional @Named("Special Instructions") String instr) {
        ...
    }
    ...
}</pre>
        </div>
      </div>

      <div class="sect1" title="@Paged"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2822"></a>@Paged</h2></div></div></div>
        

        <p>This annotation is used to indicate that parented and/or
        standalone collections should be paginated.</p>

        <p>When annotated on a collection, <code class="classname">@Paged</code>
        indicates the page size of a parented collection. When annotated on a
        type, <code class="classname">@Paged</code> indicates the page size of a
        standalone collection.</p>

        <p>For example:</p>

        <pre class="programlisting">@Paged(30)
public class Order {

    @Paged(15)
    public List&lt;LineItem&gt; getDetails() {...}
}</pre>

        <p>This indicates a page size of 15 for parented collections, and a
        page size of 30 for standalone collections.</p>

        <p>When omitting a parameter value or omitting the annotation
        completely, the configured defaults in
        <code class="filename">isis.properties</code> wil be used.</p>

        <p>For example:</p>

        <pre class="programlisting">isis.viewers.paged.standalone=20
isis.viewers.paged.parented=5</pre>

        <p>This indicates a page size of 5 for parented collections and a
        page size of 20 for standalone collections.</p>
      </div>

      <div class="sect1" title="@Parseable"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2837"></a>@Parseable</h2></div></div></div>
        

        <p>Parseability means being able to parse a string representation
        into an object by way of the
        <code class="classname">org.apache.isis.applib.adapters.Parser</code>
        interface. Generally this only applies to value types, where the
        <code class="classname">@Value</code> annotation (see <a class="xref" href="#sec.ValueAnnotation" title="@Value">the section called &#8220;@Value&#8221;</a>) implies encodability through the
        <code class="classname">ValueSemanticsProvider</code> interface (see <a class="xref" href="#chp.ValueTypes" title="Chapter&nbsp;10.&nbsp;Value Types">Chapter&nbsp;10, <i>Value Types</i></a>).</p>

        <p>For these reasons the <code class="classname">@Parser</code> annotation
        is generally never applied directly, but can be thought of as a
        placeholder for future enhancements whereby non-value types might also
        have be able to be parsed. For example, a
        <code class="classname">Customer</code> could in theory be parsed from a
        string representing that <code class="classname">Customer</code>'s title
        (perhaps in conjunction with some other annotation to determine the
        repository by which to perform the lookup).</p>
      </div>

      <div class="sect1" title="@Plural"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.PluralAnnotation"></a>@Plural</h2></div></div></div>
        

        <p>When the framework displays a collection of several objects it
        may use the plural form of the object type in the title. By default
        the plural name will be created by adding an 's' to the end of the
        singular name (whether that is the class name or another name
        specified using <code class="literal">@Named</code>). Where the
        single name ends in 'y' then the default plural name will end in 'ies'
        - for example a collection of <code class="literal">Country</code> objects will be titled 'Countries'.
        Where these conventions do not work, the programmer may specify the
        plural form of the name using <code class="classname">@Plural</code>. For
        example:</p>

        <pre class="programlisting"><span class="strong"><strong>@Plural("Children")</strong></span>
public class Child {
    // members and actions here
}</pre>
      </div>

      <div class="sect1" title="@Programmatic"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2857"></a>@Programmatic</h2></div></div></div>
        

        <p>The <code class="classname">@Programmatic</code> annotation can be used
        to cause Apache Isis to complete ignore a class member. This means it
        won't appear in any viewer, its value will not be persisted, and it
        won't appear in any XML snapshots (see <a class="xref" href="#chp.XmlSnapshots" title="Chapter&nbsp;14.&nbsp;XML Snapshots">Chapter&nbsp;14, <i>XML Snapshots</i></a>).</p>

        <p>A common use-case is to ignore implementation-level artifacts.
        For example:</p>

        <pre class="programlisting">public class Customer implements Comparable&lt;Customer&gt; {
    ...
    @Programmatic
    public int compareTo(Customer c) { 
        return getSalary() - c.getSalary();
    }
    ...
}</pre>

        <p>Note that <code class="methodname">@Programmatic</code> does not simply
        imply <code class="methodname">@Hidden</code> and
        <code class="methodname">@NotPersisted</code>; it actually means that the
        class member will not be part of the Isis metamodel.</p>
      </div>

      <div class="sect1" title="@Prototype"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.PrototypeAnnotation"></a>@Prototype</h2></div></div></div>
        

        <p>The <code class="classname">@Prototype</code> annotation marks an action
        method as available in prototype mode only, and therefore not intended
        for use in the production system. A prototype action may or may not
        also be a debug action (annotated with <code class="classname">@Debug</code>,
        see <a class="xref" href="#sec.DebugAnnotation" title="@Debug">the section called &#8220;@Debug&#8221;</a>).</p>

        <p>For example:</p>

        <pre class="programlisting">public class Customer {
    public Order placeNewOrder() { ... }
    @Prototype
    public List&lt;Order&gt; listRecentOrders() { ... }
    ...
}</pre>

        <p>See also the <code class="classname">@Exploration</code> annotation,
        <a class="xref" href="#sec.ExplorationAnnotation" title="@Exploration">the section called &#8220;@Exploration&#8221;</a></p>
      </div>

      <div class="sect1" title="@QueryOnly (deprecated)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2879"></a>@QueryOnly (deprecated)</h2></div></div></div>
        

        <p>Equivalent to using <code class="code">@ActionSemantics(Of.SAFE)</code> on an
        action.</p>
      </div>

      <div class="sect1" title="@RegEx"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.RegExAnnotation"></a>@RegEx</h2></div></div></div>
        

        <p>The <code class="literal">@RegEx</code> annotation may be
        applied to any string property, or to any parameter within an action
        method. It can also be applied to any string-based value type. It
        serves both to validate and potentially to normalise the format of the
        input. <code class="literal">@Regex</code> is therefore similar
        in use to <code class="literal">@Mask</code> (see <a class="xref" href="#sec.MaskAnnotation" title="@Mask">the section called &#8220;@Mask&#8221;</a>) but provides more flexibility.</p>

        <p>The syntax is:</p>

        <p><code class="literal">@RegEx(validation = "regEx string",
        format = "regEx string", caseSensitive =
        &lt;true|false&gt;)</code></p>

        <p>Only the first parameter is required; the format defaults to "no
        formatting", and caseSensitive defaults to false.</p>

        <p>For example, on a property:</p>

        <pre class="programlisting">public class Customer {
    @RegEx(validation = "(\\w+\\.)*\\w+@(\\w+\\.)+[A-Za-z]+")
    public String getEmail() {}
    ...
}</pre>

        <p>Or, on a parameter:</p>

        <pre class="programlisting">public class Customer {
    public void updateEmail(
            @RegEx(validation = "(\\w+\\.)*\\w+@(\\w+\\.)+[A-Za-z]+")
            @Named("Email") String email) {
        ...
    }
    ...
)</pre>

        <p>Or, on a value type:</p>

        <pre class="programlisting">@Value(...)
@RegEx(validation = "(\\w+\\.)*\\w+@(\\w+\\.)+[A-Za-z]+")
public class EmailAddress {
   ...
y}</pre>
      </div>

      <div class="sect1" title="@Resolve"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2900"></a>@Resolve</h2></div></div></div>
        

        <p>The <code class="classname">@Resolve</code> annotation is a hint for
        properties and collections to indicate that a value property should be
        resolved lazily (rather than eagerly, as usual), or that a reference
        property or collection should be resolved eagerly (rather than lazily,
        as usual).</p>

        <p>Viewers can use this to present the property/collection in an
        appropriate manner:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>an <code class="classname">Order</code>'s
            <code class="methodname">lineItems</code> collection might initially be
            rendered expanded form so that the user could see a list of line
            items immediately when the order is rendered.</p>
          </li><li class="listitem">
            <p>a (reference) property of type
            <code class="classname">Address</code> might show the details of the
            referenced <code class="classname">Address</code> in a box</p>
          </li></ul></div>

        <p>At the same time, an object store might use this to defer lazy
        loading of values that represent blobs or clobs.</p>

        <p>For example:</p>

        <pre class="programlisting">public class Order {
    @Resolve(Type.EAGERLY)
    public List&lt;LineItem&gt; getDetails() { ... }

    ...
}</pre>

        <p>For properties and collections there is some similarity between
        this concept and that of eager-loading as supported by some object
        stores. Indeed, some object stores may choose use their own specific
        annotations (eg a JDO default fetch group) in order to infer this
        semantic.</p>
      </div>

      <div class="sect1" title="@Title"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.TitleAnnotation"></a>@Title</h2></div></div></div>
        

        <p>The <code class="literal">@Title</code> annotation is used
        to indicate which property or properties make up the object title. If
        more than one property is used, the order can be specified (using the
        same Dewey-decimal notation as used by
        <code class="classname">@MemberOrder</code>) and the string to use between the
        components can also be specified.</p>

        <p>For example:</p>

        <pre class="programlisting">public void Customer {
    @Title(sequence="1.0")
    public String lastName() { ... }
    ...
    @Title(sequence="1.5", prepend=", ")
    public String firstName() { ... }
    ...
    @Title(sequence="1.7", append=".")
    public String midInitial() { ... }
    ...
}</pre>

        <p>could be used to create names of the style "Bloggs, Joe
        K."</p>

        <p>It is also possible to annotate reference properties; in this
        case the title will return the title of the referenced object (rather
        than, say, its string representation).</p>

        <p>An additional convention for <code class="classname">@Title</code>
        properties is that they are hidden in tables (in other words, it
        implies <code class="code">@Hidden(where=Where.ALL_TABLES)</code>. For viewers that
        support this annotation (for example, the Wicket viewer), this
        convention excludes any properties whose value is already present in
        the title column. This convention can be overridden using
        <code class="code">@Hidden(where=Where.NOWHERE)</code>.</p>
      </div>

      <div class="sect1" title="@TypeOf"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2931"></a>@TypeOf</h2></div></div></div>
        

        <p>The <code class="literal">@TypeOf</code> annotation is
        used to specify the type of elements in a collection, when for
        whatever reason it is not possible to use generics.</p>

        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>Given that Apache Isis only supports Java 1.6 and later, it's
          not that obvious what such a reason might be...</p>
        </div>

        <p>For example:</p>

        <pre class="programlisting">public void AccountService {
    @TypeOf(Customer.class)
    public List errantAccounts() {
        return CustomerDatabase.allNewCustomers();
    }
    ...
}</pre>
      </div>

      <div class="sect1" title="@TypicalLength"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2939"></a>@TypicalLength</h2></div></div></div>
        

        <p>The <code class="literal">@TypicalLength</code> annotation
        indicates the typical length of a <code class="literal">String</code> property or <code class="literal">String</code> parameter in an action. It can also
        be specified for string-based value types.</p>

        <p>The information is generally used by the viewing mechanism to
        determine the space that should be given to that property or parameter
        in the appropriate view. If the typical length is the same as the
        <code class="literal">@MaxLength</code> (see <a class="xref" href="#sec.MaxLengthAnnotation" title="@MaxLength">the section called &#8220;@MaxLength&#8221;</a>) then there is no need to specify
        <code class="literal">@TypicalLength</code> as well. If the
        value specified is zero or negative then it will be ignored.</p>

        <p>For example, for a property:</p>

        <pre class="programlisting">public class Customer {
    @MaxLength(30)
    @TypicalLength(20)
    public String getFirstName() { ... }
    public void setFirstName(String firstName) { ... }
}</pre>

        <p>Or, for a parameter:</p>

        <pre class="programlisting">public class CustomerRepository {
    public Customer newCustomer(
            @TypicalLength(20)
            @Named("First Name") String firstName
           ,@TypicalLength(20)
            @Named("Last Name") String lastName) {
        ...
    }
    ...
}</pre>

        <p>Or, for value type:</p>

        <pre class="programlisting">@Value(...)
@TypicalLength(20)
public class FirstName {
    ...
}</pre>
      </div>

      <div class="sect1" title="@Value"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec.ValueAnnotation"></a>@Value</h2></div></div></div>
        

        <p>The <code class="literal">@Value</code> annotation
        indicates that a class should be treated as a value type rather than
        as a reference (or entity) type. It does this providing an
        implementation of a
        <code class="classname">org.apache.isis.applib.adapters.ValueSemanticsProvider</code>.</p>

        <p>For example:</p>

        <pre class="programlisting">@Value(semanticsProviderClass=ComplexNumberValueSemanticsProvider.class)
public class ComplexNumber {
    ...
}</pre>

        <p>The <code class="classname">ValueSemanticsProvider</code> allows the
        framework to interact with the value, parsing strings and displaying
        as text, and encoding/decoding (for serialization). For more
        information, see <a class="xref" href="#chp.ValueTypes" title="Chapter&nbsp;10.&nbsp;Value Types">Chapter&nbsp;10, <i>Value Types</i></a>.</p>
      </div>

      <div class="sect1" title="@ViewModel"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e2965"></a>@ViewModel</h2></div></div></div>
        

        <p>The <code class="classname">@ViewModel</code> annotation allows the
        developer to declare that a domain object is intended to be used as a
        view model. As such, any changes to its structure are guaranteed to be
        backwardly compatible.</p>

        <p>The annotation was originally introduced to support a
        requirement of the RestfulObjects viewer which directly expose the
        domain objects as RESTful representations</p>

        <p>For example, a domain object that represents a summary of a
        <code class="classname">Customer</code> and their most recent
        <code class="classname">Order</code>s might be annotated as:</p>

        <pre class="programlisting">@NotPersistable
@ViewModel
public class CustomerAndOrdersViewModel {
   ...
}</pre>
      </div>
    </div>

    <div class="appendix" title="Appendix&nbsp;C.&nbsp;DomainObjectContainer interface"><div class="titlepage"><div><div><h2 class="title"><a name="apx.DomainObjectContainer"></a>Appendix&nbsp;C.&nbsp;<code class="classname">DomainObjectContainer</code> interface</h2></div></div></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>Provides a single point of contact from domain objects into the
        <span class="emphasis"><em>Apache Isis</em></span> framework.</p>
      </div>

      <p>The <code class="classname">DomainObjectContainer</code> interface
      provides a single point of contact from domain objects into the
      <span class="emphasis"><em>Isis</em></span> framework. It can also be used as a
      lightweight general purpose repository during prototyping.</p>

      <div class="table"><a name="d5e2983"></a><p class="title"><b>Table&nbsp;C.1.&nbsp;DomainObjectContainer methods (1 of 2)</b></p><div class="table-contents">
        

        <table summary="DomainObjectContainer methods (1 of 2)" border="1"><colgroup><col width="70" align="center"><col width="180" align="left"><col align="left"></colgroup><thead><tr><th align="center">Category</th><th align="center">Method</th><th align="center">Description</th></tr></thead><tbody><tr><td rowspan="3" align="center">Object creation</td><td align="left"><code class="methodname">newTransientInstance(Class&lt;T&gt;)</code></td><td align="left">Creates new non-persisted object</td></tr><tr><td align="left"><code class="methodname">newPersistentInstance(Class&lt;T&gt;)</code></td><td align="left">Creates new object, will be persisted at end of
              action</td></tr><tr><td align="left"><code class="methodname">newInstance(Class&lt;T&gt;,
              Object)</code></td><td align="left">Creates object in state persistence state as that
              provided</td></tr><tr><td rowspan="2" align="center">Validation</td><td align="left"><code class="methodname">isValid(Object)</code></td><td align="left">whether object is valid</td></tr><tr><td align="left"><code class="methodname">validate(Object)</code></td><td align="left">reason why object is invalid (if any)</td></tr><tr><td rowspan="7" align="center">Generic Repository</td><td align="left"><code class="methodname">allInstances(Class&lt;T&gt;)</code></td><td align="left">All persisted instances of specified type</td></tr><tr><td align="left"><code class="methodname">allMatches(Class&lt;T&gt;,
              Filter&lt;T&gt;)</code></td><td align="left">All persistenced instances of specified type matching
              filter</td></tr><tr><td align="left"><code class="methodname">allMatches(Class&lt;T&gt;,
              String)</code></td><td align="left">All persisted instances with the specified string as
              their title</td></tr><tr><td align="left"><code class="methodname">allMatches(Class&lt;T&gt;,
              Object)</code></td><td align="left">All persisted instances matching object
              (query-by-example)</td></tr><tr><td align="left"><code class="methodname">allMatches(Query&lt;T&gt;)</code></td><td align="left">All instances satisfying the provided query</td></tr><tr><td align="left"><code class="methodname">firstMatch(...)</code></td><td align="left">As for <code class="methodname">allMatches(...)</code>, but
              returning first instance</td></tr><tr><td align="left"><code class="methodname">uniqueMatch(...)</code></td><td align="left">As for <code class="methodname">firstMatch(...)</code>, but
              requiring there to be only one match</td></tr></tbody></table>
      </div></div><br class="table-break">

      <div class="table"><a name="d5e3048"></a><p class="title"><b>Table&nbsp;C.2.&nbsp;DomainObjectContainer methods (2 of 2)</b></p><div class="table-contents">
        

        <table summary="DomainObjectContainer methods (2 of 2)" border="1"><colgroup><col width="70" align="center"><col width="180" align="left"><col align="left"></colgroup><thead><tr><th align="center">Category</th><th align="center">Method</th><th align="center">Description</th></tr></thead><tbody><tr><td rowspan="5" align="center">Object persistence</td><td align="left"><code class="methodname">isPersistent(Object)</code></td><td align="left">whether object is persistent</td></tr><tr><td align="left"><code class="methodname">persist(Object)</code></td><td align="left">persist the transient object</td></tr><tr><td align="left"><code class="methodname">persistIfNotAlready(Object)</code></td><td align="left">persist the object (provided is not already
              persisted)</td></tr><tr><td align="left"><code class="methodname">remove(Object)</code></td><td align="left">remove the persisted object</td></tr><tr><td align="left"><code class="methodname">removeIfNotAlready(Object)</code></td><td align="left">remove the object (provided is not already
              transient)</td></tr><tr><td align="center">Presentation</td><td align="left"><code class="methodname">titleOf(Object)</code></td><td align="left">Returns the title of the object.</td></tr><tr><td rowspan="3" align="center">Messages and warnings</td><td align="left"><code class="methodname">informUser(String)</code></td><td align="left">Inform the user</td></tr><tr><td align="left"><code class="methodname">warnUser(String)</code></td><td align="left">Warn the user about a situation, requiring
              acknowledgement.</td></tr><tr><td align="left"><code class="methodname">raiseError(String)</code></td><td align="left">Notify user of a serious application error, typically
              requiring further action on behalf of the user</td></tr><tr><td align="center">Security</td><td align="left"><code class="methodname">getUser()</code></td><td align="left">The currently-logged on user</td></tr><tr><td rowspan="2" align="center">Properties</td><td align="left"><code class="methodname">getProperty(String)</code></td><td align="left">Value of configuration property</td></tr><tr><td align="left"><code class="methodname">getPropertyNames()</code></td><td align="left">All configuration properties available</td></tr><tr><td rowspan="2" align="center">Lazy loading, dirty object tracking
              (*)</td><td align="left"><code class="methodname">resolve(Object)</code></td><td align="left">Lazy load object (overloaded to optionally load a
              property of object)</td></tr><tr><td align="left"><code class="methodname">objectChanged(Object)</code></td><td align="left">Mark object as dirty</td></tr><tr><td rowspan="2" align="center">Object store control (**)</td><td align="left"><code class="methodname">flush()</code></td><td align="left">Flush all pending changes to object store</td></tr><tr><td align="left"><code class="methodname">commit()</code></td><td align="left">Commit all pending changes to object store</td></tr></tbody></table>
      </div></div><br class="table-break">

      <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>(*) generally not necessary to call - performed by bytecode
          proxies</p>
        </div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
          <p>(**) the use of these methods is discouraged - they are
          typically used only for tests</p>
        </div>
    </div>

    <div class="appendix" title="Appendix&nbsp;D.&nbsp;Security Classes"><div class="titlepage"><div><div><h2 class="title"><a name="apx.SecurityClasses"></a>Appendix&nbsp;D.&nbsp;Security Classes</h2></div></div></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>A simple set of classes to represent the currently logged on
        user and their roles.</p>
      </div>

      <p>When the user logs onto an Isis application, the framework
      constructs a representation of their user and roles using classes from
      the applib. This allows the application to inspect and act upon those
      details if required.</p>

      <p>The user details are captured in the
      <code class="classname">org.apache.isis.applib.security.UserMemento</code> class
      ("memento" because it is a snapshot of their credentials at the point of
      logging on). The <code class="classname">UserMemento</code> class defines the
      following properties:</p>

      <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
          <p><code class="varname">name</code> (a
          <code class="classname">String</code>)</p>
        </li><li class="listitem">
          <p>collection of roles (as
          <code class="classname">RoleMemento</code>)</p>
        </li></ul></div>

      <p>The org.apache.isis.applib.security.RoleMemento class in turn
      defines two properties:</p>

      <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
          <p><code class="varname">name</code> (a
          <code class="classname">String</code>)</p>
        </li><li class="listitem">
          <p><code class="varname">description</code> (a
          <code class="classname">String</code>)</p>
        </li></ul></div>

      <p>To obtain the current user, the application can call
      <code class="methodname">DomainObjectContainer#getUser()</code>. For more on
      the <code class="classname">DomainObjectContainer</code>, see <a class="xref" href="#apx.DomainObjectContainer" title="Appendix&nbsp;C.&nbsp;DomainObjectContainer interface">Appendix&nbsp;C, <i><code class="classname">DomainObjectContainer</code> interface</i></a>.</p>
    </div>

    <div class="appendix" title="Appendix&nbsp;E.&nbsp;Utility Classes"><div class="titlepage"><div><div><h2 class="title"><a name="apx.UtilityClasses"></a>Appendix&nbsp;E.&nbsp;Utility Classes</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#d5e3172">Title creation</a></span></dt><dt><span class="sect1"><a href="#d5e3179">Reason text creation (for disable and validate methods)</a></span></dt></dl></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>Simple utility classes for domain objects.</p>
      </div>

      <p>The <span class="package">org.apache.isis.applib.util</span> package has a
      number of simple utility classes designed to simplify the coding of some
      common tasks.</p>

      <div class="sect1" title="Title creation"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e3172"></a>Title creation</h2></div></div></div>
        

        <p>The <code class="classname">TitleBuffer</code> utility class is intended
        to make it easy to construct title strings (returned from the
        <code class="methodname">title()</code> method). For example, it has
        overloaded versions of methods called
        <code class="methodname">append()</code> and
        <code class="methodname">concat()</code>.</p>
      </div>

      <div class="sect1" title="Reason text creation (for disable and validate methods)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e3179"></a>Reason text creation (for disable and validate methods)</h2></div></div></div>
        

        <p>There are two different classes provided to help build reasons
        returned by <code class="methodname">disableXxX()</code> and
        <code class="methodname">validateXxx()</code> methods:</p>

        <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
            <p>the
            <code class="classname">org.apache.isis.applib.util.ReasonBuffer</code>
            helper class</p>
          </li><li class="listitem">
            <p>the
            <code class="classname">org.apache.isis.applib.util.Reasons</code> helper
            class</p>
          </li></ul></div>

        <p>For example:</p>

        <pre class="programlisting">public class Customer {
    ...
    public String validatePlaceOrder(Product p, int quantity) {
        return Reasons.coalesce(
            whetherCustomerBlacklisted(this),
            whetherProductOutOfStock(p)
        );
    }
}</pre>

        <p>Which you use (if any) is up to you.</p>
      </div>
    </div>

    <div class="appendix" title="Appendix&nbsp;F.&nbsp;Events"><div class="titlepage"><div><div><h2 class="title"><a name="d5e3194"></a>Appendix&nbsp;F.&nbsp;Events</h2></div></div></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>The <code class="classname">InteractionEvent</code> hierarchy.</p>
      </div>

      <p>Although not supported by the default programming model, the
      applib nevertheless defines an event hierarchy that characterizes all of
      the different types of interactions that can occur. This is used by the
      wrapper programming model, and is exploited by the JUnit viewer.</p>

      <p>The following <acronym class="acronym">UML</acronym> class diagram shows the
      hierarchy of events:</p>

      <div class="mediaobject"><img src="images/Events.png" width="162"></div>
    </div>

    <div class="appendix" title="Appendix&nbsp;G.&nbsp;Package Dependencies"><div class="titlepage"><div><div><h2 class="title"><a name="d5e3205"></a>Appendix&nbsp;G.&nbsp;Package Dependencies</h2></div></div></div>
      

      <div class="abstract" title="Abstract"><div class="titlepage"></div>
        <p>The dependencies between the packages.</p>
      </div>

      <p>The following diagram shows that the relationship between the
      different packages that make up the applib (note that there are no
      cyclic dependencies between the packages):</p>

      <div class="mediaobject"><img src="images/composition-perspective.png" width="378"></div>

      <p>The following diagram shows the same packages, but from a layered,
      architecture perspective:</p>

      <div class="mediaobject"><img src="images/architecture-perspective.png" width="378"></div>
    </div>
  </div>
</div></body></html>