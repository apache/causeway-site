<!doctype html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <title>Framework Internal Services</title>

    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->

    <!-- No caching headers -->
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="expires" content="-1" />


    <!-- TODO: need to (re)instate CDN in the future (not using for now just so can develop off-line -->
    <link href="../css/foundation/5.5.1/foundation.css" rel="stylesheet" />
    <script src="../js/foundation/5.5.1/vendor/modernizr.js"></script>
    <link href="../css/asciidoctor/colony.css" rel="stylesheet">
    <link href="../css/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">




    <link href="../css/github-fork-ribbon-css/0.1.1/gh-fork-ribbon.css" rel="stylesheet" />
    <!--[if lt IE 9]>
      <link href="../css/github-fork-ribbon-css/0.1.1/gh-fork-ribbon.ie.css" rel="stylesheet" />
    <![endif]-->



    <style type="text/css">
        pre code {
            background-color: inherit;
            border-style: none;
        }

        pre code > span:first-child {
            margin-left: -5px;
        }

    <style>

    <!--
    <style type="text/css">
        /* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}

        pre.CodeRay code {
            background-color: inherit;
            border-style: none;
        }

        pre.CodeRay code > span:first-child {
            margin-left: -5px;
        }

        .literalblock pre,
        .listingblock pre:not(.highlight),
        .listingblock pre[class="highlight"],
        .listingblock pre[class^="highlight "],
        .listingblock pre.CodeRay,
        .listingblock pre.prettyprint {
            background: rgb(253, 250, 246);
         }
        .sidebarblock .literalblock pre,
        .sidebarblock .listingblock pre:not(.highlight),
        .sidebarblock .listingblock pre[class="highlight"],
        .sidebarblock .listingblock pre[class^="highlight "],
        .sidebarblock .listingblock pre.CodeRay,
        .sidebarblock .listingblock pre.prettyprint {
            background: rgb(253, 250, 246);
         }

    <style>
    -->

    <style>
    .github-fork-ribbon-wrapper.right {
        position: fixed;
    }
    .github-fork-ribbon {
        background: #090;
    }
    .github-fork-ribbon a:hover {
        background:#0D0;
        color:#fff;
        font-size: 1.1em;
    }
    </style>

    <style>
        @media only screen and (min-width: 40.063em) {
          .top-bar {
            .contain-to-grid .top-bar {
                max-width: 80rem;
            }
          }
        }
        .row {
            max-width: 80rem;
        }
    </style>

    <style>
        .extended-quote,
        .extended-quote-first {
            margin-left: 40px;
            margin-right: 40px;
            font-style: italic;
        }
        .extended-quote-attribution {
            text-align: right;
            margin-right: 100px;
            color: #10B061;
        }

        .extended-quote-first:before {
            content: "\201c";
            float: left;
            font-size: 2.75em;
            font-weight: bold;
            line-height: 0.6em;
            margin-left: -0.6em;
            color: #003b6b;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
    </style>

    <style>
        body {
          position: relative;
        }

        *:not(pre) a > code {
            color: #210DDC;
        }

        *:not(pre) > code {
            background-color: inherit;
            border: none;
            font-weight: normal;
        }

        body div#toc li,
        body div#toc2 li {
            list-style-type: none;
        }

        div#doc-content {
            margin-top: 30px;
        }

        div.documentation-page table.frame-all {
            border-left: none;
            border-right: none;
        }

        body div#toc li.active-region:before,
        body div#toc2 li.active-region:before {
            content: "\00BB \0020";
            margin-left: -12px;
        }

        body div#toc li a.active,
        body div#toc2 li a.active {
            color: red;
        }

        body div#toc.toc,
        body div#toc.toc2 {
            position: fixed;
            left: auto;
            padding-top: 60px;
            z-index: auto;
            background-color: white;
            border-left-color: #eee;
            border-left-style: solid;
            border-right: none;
            min-height: 2000px;
        }

    </style>

    <style>

        @media only screen and (min-width: 768px) {
          #toc.toc2 ul ul { margin-left: -10px; }
        }


        body div#toc .tocify-subheader ul {
            margin-bottom: 0px;
        }

        body div#toc .tocify-subheader li {
            font-size: 14px;
        }
        .tocify li.tocify-item, .tocify ul.tocify-item {
            line-height: 24px;
        }

        body div#toc li.tocify-item.active:before,
        body div#toc2 li.tocify-item.active:before {
            content: "\00BB \0020";
            margin-left: -12px;
        }

        body div#toc li.tocify-item.active a,
        body div#toc2 li.tocify-item.active a {
            color: red;
        }
    </style>

    <style>
        footer {
            margin-top: 1000px;
        }
    </style>

    <style>
        /* overriding colony.css stylesheet */
        .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] {
           /*padding: 1.25em 1.5625em 1.125em 1.5625em;*/
           padding: 0.3em 0.6em 0.25em 0.6em;
        }
        @media only screen and (min-width: 1280px)
        #toc.toc2 {
          /*width: 20em;*/
          width: 25em;
        }

        #doc-content a {
          color: #210DDC;
        }

        .top-bar h1 {
            border-bottom: inherit;
        }

        h2 {
          margin-top: 80px;
        }
        h3 {
          margin-top: 40px;
        }
        h4,h5 {
          margin-top: 30px;
        }

        .admonitionblock.tip > table td.content {
            color: #10B061;
        }
        .admonitionblock.note > table td.content {
            color: #B509AB;
        }
        .admonitionblock.important > table td.content {
            color: #D5810A;
        }

        .admonitionblock .title {
            font-size: larger;
            font-style: italic;
        }

        .imageblock img {
            margin-bottom: 10px;
        }
    </style>

    <style>
        /* from http://ben.balter.com/2014/03/13/pages-anchor-links/ */
        .header-link {
          position: absolute;
          left: -0.5em;
          opacity: 0;

          /*
          -webkit-transition: opacity 0.2s ease-in-out 0.1s;
          -moz-transition: opacity 0.2s ease-in-out 0.1s;
          -ms-transition: opacity 0.2s ease-in-out 0.1s;
          */
        }

        h2:hover .header-link,
        h3:hover .header-link,
        h4:hover .header-link,
        h5:hover .header-link,
        h6:hover .header-link {
          opacity: 1;
        }
    </style>

    <style>
        .top-bar
        {
            -webkit-transition-duration: .5s;
            transition-duration: .5s;

            -webkit-transition-timing-function: cubic-bezier( 0.215, 0.610, 0.355, 1.000 );
            transition-timing-function: cubic-bezier( 0.215, 0.610, 0.355, 1.000 );

            -webkit-transition-property: -webkit-transform;
            transition-property: transform;
        }

        /*
        http://osvaldas.info/auto-hide-sticky-header
        MIT license
        */
        .header--hidden
        {
            -webkit-transform: translateY( -100% );
            -ms-transform: translateY( -100% );
            transform: translateY( -100% );

            transition-duration: .5s;
            transition-timing-function: cubic-bezier( 0.215, 0.610, 0.355, 1.000 );
            -webkit-transition-property: -webkit-transform;
            transition-property: transform;
        }
    </style>

    <style>
        #doc-content a.guide {
            color: white;
        }
    </style>

    <style>
        .tocify {
            margin-top: 80px;
        }
    </style>


</script>

</head>
<body>

<<div class="github-fork-ribbon-wrapper right" style="position: fixed;">
    <div class="github-fork-ribbon">
        <a href="https://github.com/apache/isis#fork-destination-box">Fork me on GitHub</a>
    </div>
</div>


<div class="row">

    <div class="fixed contain-to-grid header">
        <nav class="top-bar" data-topbar role="navigation" style="max-width: 80rem">
            <ul class="title-area">
                <li class="name">
                    <h1>
                        <a href="/index.html">Apache Isis&trade;</a>
                    </h1>
                </li>
                <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
                <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
            </ul>

            <section class="top-bar-section">
                <ul class="right">

                    <li class="has-form">
                       <FORM class="searchbox navbar-form navbar-right" id="searchbox_012614087480249044419:dn-q5gtwxya" action="http://www.google.com/cse">
                        <div class="row collapse">
                            <input type="hidden" name="cx" value="012614087480249044419:dn-q5gtwxya">
                            <INPUT type="hidden" name="cof" value="FORID:0">
                            <INPUT class="form-control" name="q" type="text" placeholder="Search">
                        </div>
                    </FORM>
                     </li>

                </ul>

                <!-- Left Nav Section -->
                <ul class="left">

                    <li><a href="/documentation.html">Documentation</a></li>
                    <li><a href="/downloads.html">Downloads</a></li>
                    <li><a href="/help.html">Help</a></li>
                    <li><a href="/asf.html">@ASF</a></li>

                </ul>

            </section>
        </nav>
    </div>
</div>

<div class="row">

    <div id="doc-content-left" class="large-9 medium-9 columns">


        <div id="doc-content">
          <div class="sect1">
<h2 id="_rgfis">1. Framework Internal Services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide documents a number of domain services that are not part of the framework&#8217;s formal API, they use classes that are outside of the applib.  They should be
thought of as part of the internal design of the framework, and are liable to change from release to release.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We do not guarantee that <a href="http://semver.org">semantic versioning</a> will be honoured for these services.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_other_guides">1.1. Other Guides</h3>
<div class="paragraph">
<p>Apache Isis documentation is broken out into a number of user, reference and "supporting procedures" guides.</p>
</div>
<div class="paragraph">
<p>The user guides available are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="ugfun.html">Fundamentals</a></p>
</li>
<li>
<p><a href="ugvw.html">Wicket viewer</a></p>
</li>
<li>
<p><a href="ugvro.html">Restful Objects viewer</a></p>
</li>
<li>
<p><a href="ugsec.html">Security</a></p>
</li>
<li>
<p><a href="ugtst.html">Testing</a></p>
</li>
<li>
<p><a href="ugbtb.html">Beyond the Basics</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The reference guides are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="rgant.html">Annotations</a></p>
</li>
<li>
<p><a href="rgsvc.html">Domain Services</a></p>
</li>
<li>
<p><a href="rgcfg.html">Configuration Properties</a></p>
</li>
<li>
<p><a href="rgcms.html">Classes, Methods and Schema</a></p>
</li>
<li>
<p><a href="rgmvn.html">Apache Isis Maven plugin</a></p>
</li>
<li>
<p><a href="#">Framework Internal Services</a> (this guide)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The remaining guides are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="dg.html">Developers' Guide</a> (how to set up a development environment for Apache Isis and contribute back to the project)</p>
</li>
<li>
<p><a href="cgcom.html">Committers' Guide</a> (release procedures and related practices)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rgfis_presentation-layer">2. Presentation Layer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>These domain services are internal to the framework, controlling various aspects of the presentation layer.</p>
</div>
<div class="paragraph">
<p>The table below summarizes the presentation layer internal SPIs defined by Apache Isis.  It also lists their
corresponding implementation, either a default implementation provided by Apache Isis itself, or provided by one of the
(non-ASF) <a href="http://www.isisaddons.org">Isis Addons</a> modules.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Internal Services</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">SPI</th>
<th class="tableblock halign-left valign-top">Maven Module<br>
Impl&#8217;n (g: a:)</th>
<th class="tableblock halign-left valign-top">Implementation</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rgfis_spi_ContentNegotiationService"><code>o.a.i.v.ro.</code><br>
<code>rendering.service.conneg.</code><br>
<code>ContentNegotiationService</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encodes the algorithm that delegates to any registered <a href="rgsvc.html#_rgsvc_spi_ContentMappingService"><code>ContentMappingService</code></a>s.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ContentNegotiationService-</code><br>
<code>XRoDomainType</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-viewer-restfulobjects-rendering</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rgfis_spi_RepresentationService"><code>o.a.i.v.ro.</code><br>
<code>rendering.service.</code><br>
<code>RepresentationService</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates the representations, delegating to any registered <a href="#_rgfis_spi_ContentNegotiationService"><code>ContentNegotiationService</code></a>s.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RepresentationService-</code><br>
<code>ForRestfulObjects</code><br>
<code>o.a.i.core</code><br>
<code>isis-core-viewer-restfulobjects-rendering</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Key:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>o.a.i</code> is an abbreviation for <code>org.apache.isis</code></p>
</li>
<li>
<p><code>o.ia.m</code> is an abbreviation for <code>org.isisaddons.module</code></p>
</li>
<li>
<p><code>o.a.i.c.m.s</code> is an abbreviation for <code>org.apache.isis.core.metamodel.services</code></p>
</li>
<li>
<p><code>o.a.i.c.r.s</code> is an abbreviation for <code>org.apache.isis.core.runtime.services</code></p>
</li>
<li>
<p><code>o.a.i.v.ro</code> is an abbreviation for <code>org.apache.isis.viewer.restfulobjects</code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_rgfis_spi_ContentNegotiationService">2.1. <code>ContentNegotiationService</code></h3>
<div class="paragraph">
<p>The <code>ContentNegotiationService</code> is a plug-in point for the <a href="ugvro.html">RestfulObjects viewer</a> so that it can generate representations according to HTTP <code>Accept</code> header of the request.  This idea is discussed in section 34.1 of the <a href="http://restfulobjects.org">Restful Objects spec</a> v1.0.</p>
</div>
<div class="paragraph">
<p>The principal motivation is to allow more flexible representations to be generated for REST clients that (perhaps through their use of a certain Javascript library, say) expect, or at least works best with, a certain style of representation.</p>
</div>
<div class="paragraph">
<p>Another use case is to support "third party" REST clients over which you have no control.  In this scenario you <em>must not</em> naively expose entities through the RO viewer, because over time those entities will inevitably evolve and change their structure.  If the entities were exposed directly then those REST clients will break.</p>
</div>
<div class="paragraph">
<p>Instead you need to create some sort of stable facade over your domain entities, one which you will preserve even if the domain entities change.  There are three ways in which you can do this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>first is to solve the problem at the domain layer by defining a regular Apache Isis <a href="ugbtb.html#_ugbtb_view-models">view model</a>.  This is then surfaced over the RO viewer. <br></p>
<div class="paragraph">
<p>If the underlying entities change, then care must be taken to ensure that structure of the view model nevertheless is unchanged.</p>
</div>
</li>
<li>
<p>a second option is to solve the problem at the persistence layer, but defining a (SQL) view in the database and then <a href="ugbtb.html#_ugbtb_other-techniques_mapping-rdbms-views">mapping this</a> to a (read-only) entity.  Again this is surfaced by the RO viewer. <br></p>
<div class="paragraph">
<p>If the underlying tables change (as the result of a change in their corresponding domain entities) then once more the view must be refactored so that it still presents the same structure.</p>
</div>
</li>
<li>
<p>our third option is to solve the problem at the presentation layer, using the <code>ContentNegotiationService</code> described in this section.<br></p>
<div class="paragraph">
<p>The <code>ContentNegotiationService</code> is responsible for inspecting the HTTP <code>Accept</code> header, and use this to select the correct representation to render. <br></p>
</div>
<div class="paragraph">
<p>The Apache Isis framework provides three implementations of <code>ContentNegotiationService</code> which inspects different elements of the HTTP <code>Accept</code> header.  One of these implementations, <code>ContentNegotiationServiceXRoDomainType</code> will further delegate down to the companion <a href="rgsvc.html#_rgsvc_spi_ContentMappingService"><code>ContentMappingService</code></a> service (if configured/available), based on the value of the "x-ro-domain-type" parameter of the header.<br></p>
</div>
<div class="paragraph">
<p>A typical implementation of <code>ContentMappingService</code> will convert the domain object into some sort of DTO (data transfer object) as specified by the "x-ro-domaintype".  If this DTO is annotated with JAXB or Jackson mappings, then the RO viewer (courtesy of the underlying <a href="http://resteasy.jboss.org/">RestEasy</a> framework) can serialize these directly.<br></p>
</div>
<div class="paragraph">
<p>What all that means is that, if the underlying entities change, we are required to update the mappings in the <code>ContentMappingService</code> to map to the same DTOs.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This diagram illustrates the three options available:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-services-spi/ContentNegotiationService/facade-choices.png"><img src="images/reference-services-spi/ContentNegotiationService/facade-choices.png" alt="facade choices" width="700px"></a>
</div>
</div>
<div class="sect3">
<h4 id="_spi">2.1.1. SPI</h4>
<div class="paragraph">
<p>The SPI defined by this service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ContentNegotiationService</span> {
    Response.ResponseBuilder buildResponse(                     <i class="conum" data-value="1"></i><b>(1)</b>
            RepresentationService.Context2 renderContext2,
            ObjectAdapter objectAdapter);
    Response.ResponseBuilder buildResponse(                     <i class="conum" data-value="2"></i><b>(2)</b>
            RepresentationService.Context2 renderContext2,
            ObjectAndProperty objectAndProperty);
    Response.ResponseBuilder buildResponse(                     <i class="conum" data-value="3"></i><b>(3)</b>
            RepresentationService.Context2 renderContext2,
            ObjectAndCollection objectAndCollection);
    Response.ResponseBuilder buildResponse(                     <i class="conum" data-value="4"></i><b>(4)</b>
            RepresentationService.Context2 renderContext2,
            ObjectAndAction objectAndAction);
    Response.ResponseBuilder buildResponse(                     <i class="conum" data-value="5"></i><b>(5)</b>
            RepresentationService.Context2 renderContext2,
            ObjectAndActionInvocation objectAndActionInvocation);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>representation of a single object, as per section 14.4 of the RO spec, v1.0</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>representation of a single property of an object, as per section 16.4 of the RO spec v1.0</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>representation of a single collection of an object, as per section 17.5 of the RO spec v1.0</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>representation of a single action (prompt) of an object, as per section 18.2 of the RO spec v1.0</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>representation of the results of a single action invocation, as per section 19.5 of the RO spec v1.0</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>These methods provide:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <code>RepresentationService.Context2</code> which provides access to request-specific context (eg HTTP headers), session-specific context (eg authentication) and global context (eg configuration settings)</p>
</li>
<li>
<p>an object representing the information to be rendered<br></p>
<div class="paragraph">
<p>eg <code>ObjectAdapter</code>, <code>ObjectAndProperty</code>, <code>ObjectAndCollection</code> etc</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In all cases, returning <code>null</code> will result in the regular RO spec representation being returned.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementation">2.1.2. Implementation</h4>
<div class="paragraph">
<p><code>ContentNegotiationServiceAbstract</code> (in <code>o.a.i.v.ro.rendering.service.conneg</code>) provides a no-op implementation of the SPI, along with supporting methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">ContentNegotiationServiceAbstract</span> <span class="directive">implements</span> ContentNegotiationService {
    ...
    protected <span class="predefined-type">Object</span> objectOf(<span class="directive">final</span> ObjectAdapter objectAdapter) { ... }
    <span class="directive">protected</span> <span class="predefined-type">Object</span> returnedObjectOf(ObjectAndActionInvocation objectAndActionInvocation) { ... }

    <span class="directive">protected</span> <span class="predefined-type">Class</span>&lt;?&gt; loadClass(<span class="predefined-type">String</span> cls) { ... }

    <span class="directive">protected</span> <span class="type">void</span> ensureJaxbAnnotated(<span class="predefined-type">Class</span>&lt;?&gt; domainType) { ... }
    <span class="directive">protected</span> <span class="type">void</span> ensureDomainObjectAssignable(
        <span class="predefined-type">String</span> xRoDomainType, <span class="predefined-type">Class</span>&lt;?&gt; domainType, <span class="predefined-type">Object</span> domainObject) { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As discussed in the introduction, the framework also provides three implementation of this service, one of which is <code>o.a.i.v.ro.rendering.service.conneg.ContentNegotiationServiceXRoDomainType</code>.   This implementation handles content negotiation for two of the possible representations, object representations and for action result representations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For object representations it will handle requests with HTTP <code>Accept</code> headers of the form:</p>
<div class="ulist">
<ul>
<li>
<p><code>application/json;profile=urn:org.restfulobjects:repr-types/object;x-ro-domain-type=&#8230;&#8203;</code></p>
</li>
<li>
<p><code>application/xml;profile=urn:org.restfulobjects:repr-types/object;x-ro-domain-type=&#8230;&#8203;</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>for action result representations it will similarly handle requests with HTTP <code>Accept</code> headers of the form:</p>
<div class="ulist">
<ul>
<li>
<p><code>application/json;profile=urn:org.restfulobjects:repr-types/action-result;x-ro-domain-type=&#8230;&#8203;</code><br></p>
</li>
<li>
<p><code>application/xml;profile=urn:org.restfulobjects:repr-types/action-result;x-ro-domain-type=&#8230;&#8203;</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The value of the <code>x-ro-domain-type</code> parameter corresponds to the DTO to be mapped into by the <a href="rgsvc.html#_rgsvc_spi_ContentMappingService"><code>ContentMappingService</code></a>.</p>
</div>
<div class="paragraph">
<p>If the DTO is annotated with JAXB, then also note that the runtime type must be annotated with the JAXB <code>javax.xml.bind.annotation.XmlRootElement</code> so that RestEasy is able to unambiguously serialize it.</p>
</div>
<div class="paragraph">
<p>The other two implementations of <code>ContentNegotiationService</code> are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ContentNegotiationServiceForRestfulObjectsV1_0</code><br></p>
<div class="paragraph">
<p>which returns representations according to the <a href="http://restfulobjects.org">Restful Objects</a> spec</p>
</div>
</li>
<li>
<p><code>ContentNegotiationServiceOrgApacheIsisV1</code><br></p>
<div class="paragraph">
<p>which returns <a href="ugvro.html#_ugvro_simplified-representations">simplified representations</a></p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_usage">2.1.3. Usage</h4>
<div class="paragraph">
<p>You can find an example of all these services in the (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a>.  This defines a <code>ToDoItemDto</code> class that is JAXB annotated (it is in fact generated from an XSD).</p>
</div>
<div class="paragraph">
<p>The example app also includes an implementation of <code>ContentMappingService</code> that maps <code>todoapp.dom.module.todoitem.ToDoItem</code> entities to <code>todoapp.dto.module.todoitem.ToDoItemDto</code> classes.</p>
</div>
<div class="paragraph">
<p>A REST client can therefore request a DTO representation of an entity by invoking</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://localhost:8080/restful/objects/TODO/0</code></pre>
</div>
</div>
<div class="paragraph">
<p>with an <code>Accept</code> header of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>application/xml;profile=urn:org.restfulobjects:repr-types/object;x-ro-domain-type=todoapp.dto.module.todoitem.ToDoItemDto</code></pre>
</div>
</div>
<div class="paragraph">
<p>will result in an XML serialization of that class:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-services-spi/ContentNegotiationService/accept-xml.png"><img src="images/reference-services-spi/ContentNegotiationService/accept-xml.png" alt="accept xml" width="700px"></a>
</div>
</div>
<div class="paragraph">
<p>while similarly hitting the same URL with an <code>Accept</code> header of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>application/json;profile=urn:org.restfulobjects:repr-types/object;x-ro-domain-type=todoapp.dto.module.todoitem.ToDoItemDto</code></pre>
</div>
</div>
<div class="paragraph">
<p>will result in the JSON serialization of that class:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-services-spi/ContentNegotiationService/accept-json.png"><img src="images/reference-services-spi/ContentNegotiationService/accept-json.png" alt="accept json" width="700px"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration">2.1.4. Configuration</h4>
<div class="paragraph">
<p>The default <code>ContentNegotiationServiceXRoDomainType</code> implementation provides a <a href="rgcfg.html#_rgcfg_configuring-core">configuration property</a> which controls whether a mapped domain object is pretty-printed (formatted, indented) or not:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">isis.services.ContentNegotiationServiceXRoDomainType.prettyPrint=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the property is not set, then the default depends on the <a href="rgcfg.html#_rgcfg_deployment-types">deployment type</a>; production mode will disable pretty printing, while prototyping mode will enable it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_services">2.1.5. Registering the Services</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured (implicit if using the
<code>AppManifest</code> to <a href="rgcms.html#_rgcms_classes_AppManifest-bootstrapping">bootstrap the app</a>) then Apache Isis' default
implementations of <code>ContentNegotiationService</code> service are automatically registered and injected (it is annotated with
<code>@DomainService</code>) so no further configuration is required.</p>
</div>
<div class="paragraph">
<p>To use an alternative implementation, use
<a href="rgant.html#_rgant-DomainServiceLayout_menuOrder"><code>@DomainServiceLayout#menuOrder()</code></a> (as explained
in the <a href="rgsvc.html#_rgsvc_intro_overriding-the-services">introduction</a> to this guide).</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services">2.1.6. Related Services</h4>
<div class="paragraph">
<p>The default implementation of <code>ContentNegotiationService</code> delegates to <a href="rgsvc.html#_rgsvc_spi_ContentMappingService"><code>ContentMappingService</code></a> (if present) to convert domain entities into a stable form (eg DTO).</p>
</div>
<div class="paragraph">
<p>The <code>ContentNegotiationService</code> is itself called by the (default implementation of) <a href="#_rgfis_spi_RepresentationService"><code>RepresentationService</code></a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rgfis_spi_RepresentationService">2.2. <code>RepresentationService</code></h3>
<div class="paragraph">
<p>The <code>RepresentationService</code> is the main plug-in point for the <a href="ugvro.html">RestfulObjects viewer</a> to generate representations.</p>
</div>
<div class="paragraph">
<p>The default implementation generates representations according to the <a href="http://restfulobjects.org">Restful Objects spec</a> v1.0.  However, it also delegates to the <a href="#_rgfis_spi_ContentNegotiationService"><code>ContentNegotiationService</code></a> which provides a mechanism for altering representations according to the HTTP <code>Accept</code> header.</p>
</div>
<div class="paragraph">
<p>The principal motivation is to allow more flexible representations to be generated for REST clients that (perhaps through their use of a certain Javascript library, say) expect, or at least works best with, a certain style of representation.</p>
</div>
<div class="paragraph">
<p>In all there are three domain services that can influence the representations generated: this service, <a href="#_rgfis_spi_ContentNegotiationService"><code>ContentNegotiationService</code></a>and the <a href="rgsvc.html#_rgsvc_spi_ContentMappingService"><code>ContentMappingService</code></a>.  The diagram below shows how these collaborate:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/reference-services-spi/RepresentationService/service-collaborations.png"><img src="images/reference-services-spi/RepresentationService/service-collaborations.png" alt="service collaborations" width="700px"></a>
</div>
</div>
<div class="paragraph">
<p>The <code>RepresentationServiceForRestfulObjects</code> is the default implementation of this service; likewise <code>ContentNegotiationServiceXRoDomainType</code> is the default implementation of the <code>ContentNegotiationService</code>.  If you inspect the source code you&#8217;ll see that the default implementation of this service&#8217;s primary responsibility is to generate the default Restful Objects representations.  Therefore, if you what you want to do is to generate a <em>different _representation then in many cases replacing either this service _or</em> the <code>ContentNegotiationService</code> will be equivalent (you&#8217;ll notice that their SPIs are very similar).</p>
</div>
<div class="sect3">
<h4 id="_spi_2">2.2.1. SPI</h4>
<div class="paragraph">
<p>The SPI defined by this service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">RepresentationService</span> {
    Response objectRepresentation(                  <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="predefined-type">Context</span> rendererContext,
            ObjectAdapter objectAdapter);
    Response propertyDetails(                       <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="predefined-type">Context</span> rendererContext,
            ObjectAndProperty objectAndProperty,
            MemberReprMode memberReprMode);
    Response collectionDetails(                     <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="predefined-type">Context</span> rendererContext,
            ObjectAndCollection objectAndCollection,
            MemberReprMode memberReprMode);
    Response actionPrompt(                          <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="predefined-type">Context</span> rendererContext,
            ObjectAndAction objectAndAction);
    Response actionResult(                          <i class="conum" data-value="5"></i><b>(5)</b>
            <span class="predefined-type">Context</span> rendererContext,
            ObjectAndActionInvocation objectAndActionInvocation,
            ActionResultReprRenderer.SelfLink selfLink);
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">interface</span> <span class="class">Context</span> <span class="directive">extends</span> RendererContext {
        ObjectAdapterLinkTo getAdapterLinkTo();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>representation of a single object, as per section 14.4 of the RO spec, v1.0</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>representation of a single property of an object, as per section 16.4 of the RO spec v1.0</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>representation of a single collection of an object, as per section 17.5 of the RO spec v1.0</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>representation of a single action (prompt) of an object, as per section 18.2 of the RO spec v1.0</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>representation of the results of a single action invocation, as per section 19.5 of the RO spec v1.0</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>These methods provide:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <code>RendererContext</code> which provides access to request-specific context (eg HTTP headers), session-specific context (eg authentication) and global context (eg configuration settings)</p>
</li>
<li>
<p>an object representing the information to be rendered<br></p>
<div class="paragraph">
<p>eg <code>ObjectAdapter</code>, <code>ObjectAndProperty</code>, <code>ObjectAndCollection</code> etc</p>
</div>
</li>
<li>
<p>for members, whether the representation is in read/write mode<br></p>
<div class="paragraph">
<p>ie <code>MemberReprMode</code></p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_2">2.2.2. Implementation</h4>
<div class="paragraph">
<p>As discussed in the introduction, the framework provides a default implementation, <code>o.a.i.v.ro.rendering.service.RepresentationServiceContentNegotiator</code>.   This delegates to <a href="#_rgfis_spi_ContentNegotiationService"><code>ContentNegotiationService</code></a> to generate an alternative representation; but if none is provided then it falls back on generating the representations as defined in the <a href="http://restfulobjects.org">Restful Objects spec</a> v1.0.</p>
</div>
<div class="paragraph">
<p>To use an alternative implementation, use
<a href="rgant.html#_rgant-DomainServiceLayout_menuOrder"><code>@DomainServiceLayout#menuOrder()</code></a> (as explained
in the <a href="rgsvc.html#_rgsvc_intro_overriding-the-services">introduction</a> to this guide).</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_services_2">2.2.3. Registering the Services</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured (implicit if using the
<code>AppManifest</code> to <a href="rgcms.html#_rgcms_classes_AppManifest-bootstrapping">bootstrap the app</a>) then Apache Isis' default implementation of <code>RepresentationService</code> service is automatically registered and injected (it is annotated with <code>@DomainService</code>) so no further configuration is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_2">2.2.4. Related Services</h4>
<div class="paragraph">
<p>The default implementation delegates to <a href="#_rgfis_spi_ContentNegotiationService"><code>ContentNegotiationService</code></a>, whose default implementation may delegate in turn to <a href="rgsvc.html#_rgsvc_spi_ContentMappingService"><code>ContentMappingService</code></a> (if present).</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rgfis_application-layer">3. Application Layer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>These domain services are internal to the framework, controlling various aspects of the application layer.</p>
</div>
<div class="paragraph">
<p>The table below summarizes the application layer internal SPIs defined by Apache Isis.  It also lists their
corresponding implementation, either a default implementation provided by Apache Isis itself, or provided by one of the
(non-ASF) <a href="http://www.isisaddons.org">Isis Addons</a> modules.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Internal Services</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">SPI</th>
<th class="tableblock halign-left valign-top">Maven Module<br>
Impl&#8217;n (g: a:)</th>
<th class="tableblock halign-left valign-top">Implementation</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rgfis_spi_AuthenticationSessionProvider"><code>o.a.i.core.commons.</code><br>
<code>authentication.</code><br>
<code>AuthenticationSessionProvider</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simply responsible for obtaining the current <code>AuthenticationSession</code> (the framework&#8217;s internal representation of the currently logged-in user).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthenticationSession-</code><br>
<code>ProviderDefault</code><br>
<code>isis-core-runtime</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Default implementation looks up from <code>IsisSessionFactory</code> singleton&#8217;s thread-local</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rgfis_spi_CommandDtoServiceInternal"><code>o.a.i.c.m.s.command</code><br>
<code>CommandDtoServiceInternal</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates memento of current action invocation, for use as a serializable XML reified command.  The
most notable usage of this is to allow the execution of the <code>Command</code> to be deferred to run in the background (via
<a href="rgant.html#_rgant-Action_command"><code>@Action#commandExecuteIn()</code></a> or
<a href="rgant.html#_rgant-Property_command"><code>@Property#commandExecuteIn()</code></a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CommandDtoService-</code><br>
<code>InternalServiceDefault</code><br>
<code>isis-core-runtime</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rgfis_spi_MessageBrokerServiceInternal"><code>o.a.i.c.m.s.msgbroker</code><br>
<code>MessageBrokerServiceInternal</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A wrapper around <a href="rgsvc.html#_rgsvc_api_MessageService"><code>MessageService</code></a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MessageBrokerService-`<br>
<code>InternalDefault</code><br>
<code>isis-core-runtime</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>This service does not provide any additional capabilities over <code>MessageService</code>, and will (most likely) be conflated with that service in the future.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rgfis_spi_InteractionDtoServiceInternal"><code>o.a.i.c.m.s.ixn</code><br>
<code>InteractionDtoServiceInternal</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates DTO for the current execution of an action invocation or property edit, for use either as a reified command or for implementations of the <a href="rgsvc.html#_rgsvc_spi_PublishingService"><code>PublishingService</code></a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CommandDtoService-</code><br>
<code>InternalServiceDefault</code><br>
<code>isis-core-metamodel</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Key:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>o.a.i</code> is an abbreviation for <code>org.apache.isis</code></p>
</li>
<li>
<p><code>o.ia.m</code> is an abbreviation for <code>org.isisaddons.module</code></p>
</li>
<li>
<p><code>o.a.i.c.m.s</code> is an abbreviation for <code>org.apache.isis.core.metamodel.services</code></p>
</li>
<li>
<p><code>o.a.i.c.r.s</code> is an abbreviation for <code>org.apache.isis.core.runtime.services</code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_rgfis_spi_AuthenticationSessionProvider">3.1. <code>AuthenticationSessionProvider</code></h3>
<div class="paragraph">
<p>The (internal) <code>AuthenticationSessionProvider</code> domain service is simply responsible for obtaining the <code>AuthenticationSession</code> (being the framework&#8217;s internal representation of the currently logged in user).</p>
</div>
<div class="sect3">
<h4 id="_spi_and_implementation">3.1.1. SPI and Implementation</h4>
<div class="paragraph">
<p>The SPI of the service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">AuthenticationSessionProvider</span> {
    AuthenticationSession getAuthenticationSession();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The framework provides a default implementation of the service, <code>AuthenticationSessionProviderDefault</code>, which looks up
the current <code>AuthenticationSession</code> from <code>IsisSessionFactory</code> singleton service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">isisSessionFactory.getCurrentSession().getAuthenticationSession();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rgfis_spi_CommandDtoServiceInternal">3.2. <code>CommandDtoServiceInternal</code></h3>
<div class="paragraph">
<p>The <code>CommandDtoServiceInternal</code> is responsible for creating an memento of the current action
invocation or property edit, to store in the <code>Command</code> object (from
<a href="rgsvc.html#_rgsvc_api_CommandContext"><code>CommandContext</code></a>).  This memento is a JAXB DTO being an instance of the
<a href="rgcms.html#_rgcms_schema-cmd">"cmd" schema</a>, so can be reified so that its execution can be deferred until later,
as a <a href="rgsvc.html#_rgsvc_spi_BackgroundCommandService">background command</a>.</p>
</div>
<div class="sect3">
<h4 id="_spi_implementation">3.2.1. SPI &amp; Implementation</h4>
<div class="paragraph">
<p>The SPI of the service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">CommandDtoServiceInternal</span> {
    <span class="annotation">@Deprecated</span>
    ActionInvocationMemento asActionInvocationMemento(      <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="predefined-type">Method</span> m,
            <span class="predefined-type">Object</span> domainObject, <span class="predefined-type">Object</span><span class="type">[]</span> args);
    CommandDto asCommandDto(                                <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="predefined-type">List</span>&lt;ObjectAdapter&gt; targetAdapters,
            ObjectAction objectAction,
            ObjectAdapter<span class="type">[]</span> argAdapters);
    CommandDto asCommandDto(                                <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="directive">final</span> <span class="predefined-type">List</span>&lt;ObjectAdapter&gt; targetAdapters,
            <span class="directive">final</span> OneToOneAssociation association,
            <span class="directive">final</span> ObjectAdapter valueAdapterOrNull);
    <span class="type">void</span> addActionArgs(                                     <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="directive">final</span> ObjectAction objectAction,
            <span class="directive">final</span> ActionDto actionDto,
            <span class="directive">final</span> ObjectAdapter<span class="type">[]</span> argAdapters);
    <span class="type">void</span> addPropertyValue(                                  <i class="conum" data-value="5"></i><b>(5)</b>
            <span class="directive">final</span> OneToOneAssociation property,
            <span class="directive">final</span> PropertyDto propertyDto,
            <span class="directive">final</span> ObjectAdapter valueAdapter);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note that this method (more precisely, <code>ActionInvocationMemento</code>) does <em>not</em> support mixins.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Returns a JAXB DTO being an instance of the <a href="rgcms.html#_rgcms_schema-cmd">"cmd" schema</a> (hence convertible to
XML) that represents the <em>intention</em> to invoke an action on a target object (or possibly many targets, for
bulk actions).  If an action, it can also be either mixin action or a contributed action.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Returns a JAXB DTO that represents the intention to edit (set or clear) a property on a target (or possibly many
targets, for symmetry with actions).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>add the arguments of an action to an <code>ActionDto</code>.  This is used when the command is actually executed (per <a href="rgsvc.html#_rgsvc_api_InteractionContext"><code>InteractionContext</code></a>) to populate the parameters of the equivalent <code>ActionInvocationDto</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>add the new value argument of a property to a <code>PropertyDto</code>.  This is used when the command is actually executed (per <a href="rgsvc.html#_rgsvc_api_InteractionContext"><code>InteractionContext</code></a>) to set the the new value of the equivalent <code>PropertyEditDto</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The SPI is implemented by <code>o.a.i.c.r.s.command.CommandDtoServiceInternalServiceDefault</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_3">3.2.2. Related Services</h4>
<div class="paragraph">
<p>The design of this service is similar to that of
<a href="#_rgfis_spi_InteractionDtoServiceInternal"><code>InteractionDtoServiceInternal</code></a>, used to create the
<code>MemberExecutionDto</code> (from the <a href="rgcms.html#_rgcms_schema-ixn">"ixn" schema</a>).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rgfis_spi_MessageBrokerServiceInternal">3.3. <code>MessageBrokerServiceInternal</code></h3>
<div class="paragraph">
<p>The (internal) <code>MessageBrokerServiceInternal</code> domain service is a wrapper around
<a href="rgsvc.html#_rgsvc_api_MessageService"><code>MessageService</code></a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The service does not provide any additional capabilities over and those of <code>MessageService</code>, and will (most likely) be
conflated with that service in the future.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_spi_3">3.3.1. SPI</h4>
<div class="paragraph">
<p>The SPI of the service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">MessageBrokerServiceInternal</span> {
    <span class="type">void</span> informUser(<span class="predefined-type">String</span> message);
    <span class="type">void</span> warnUser(<span class="predefined-type">String</span> message);
    <span class="type">void</span> raiseError(<span class="predefined-type">String</span> message);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_runtime_vs_noop_implementation">3.3.2. Runtime vs Noop implementation</h4>
<div class="paragraph">
<p>The framework provides two implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MessageBrokerServiceInternalDefault</code> is provided by <code>isis-core-runtime</code>, and is used during normal use and integration tests</p>
</li>
<li>
<p><code>MessageBrokerServiceInternalNoop</code> is provided as a fallback by <code>isis-core-metamodel</code>, and is provided to allow the <a href="#rgmvn.adoc">maven plugin</a> to be bootstrapped without any "backend" database.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>&#8230;&#8203;Default</code> implementation takes priority over the <code>&#8230;&#8203;Noop</code> implementation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rgfis_spi_InteractionDtoServiceInternal">3.4. <code>InteractionDtoServiceInternal</code></h3>
<div class="paragraph">
<p>The <code>InteractionDtoServiceInternal</code> internal domain service is used by the framework to create and update DTOs representing member executions, ie the invocation of an action or the editing of a property.  The DTO is in all cases a subclass of <code>MemberExecutionDto</code>, from the <a href="rgcms.html#_rgcms_schema-ixn">"ixn" schema</a>, and subsequently accessible from the <code>Interaction</code> object (per the <a href="rgsvc.html#_rgsvc_api_InteractionContext"><code>InteractionContext</code></a> service).</p>
</div>
<div class="sect3">
<h4 id="_spi_implementation_2">3.4.1. SPI &amp; Implementation</h4>
<div class="paragraph">
<p>The SPI of the service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">InteractionDtoServiceInternal</span> {
    ActionInvocationDto asActionInvocationDto(          <i class="conum" data-value="1"></i><b>(1)</b>
            ObjectAction objectAction,
            ObjectAdapter targetAdapter,
            <span class="predefined-type">List</span>&lt;ObjectAdapter&gt; argumentAdapters);
    PropertyEditDto asPropertyEditDto(                  <i class="conum" data-value="2"></i><b>(2)</b>
            OneToOneAssociation property,
            ObjectAdapter targetAdapter,
            ObjectAdapter newValueAdapterIfAny);
    ActionInvocationDto updateResult(                   <i class="conum" data-value="3"></i><b>(3)</b>
            ActionInvocationDto actionInvocationDto,
            ObjectAction objectAction,
            <span class="predefined-type">Object</span> resultPojo);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>called by the framework when invoking an action, to create a DTO capturing the details of the action invocation (target, arguments etc).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>called by the framework when editing a property, to create a DTO (for the <a href="rgcms.html#_rgcms_schema-ixn">"ixn" schema</a>) capturing the details of the property edit (target, new value etc).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>called by the framework to attach the result of an action invocation to the aforementioned DTO.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The service is implemented by <code>o.a.i.core.runtime.services.ixn.InteractionDtoServiceInternalDefault</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_services_4">3.4.2. Related Services</h4>
<div class="paragraph">
<p>The design of this service is similar to that of
<a href="#_rgfis_spi_CommandDtoServiceInternal"><code>CommandDtoServiceInternal</code></a>, used to create the <code>CommandDto</code>
(from the <a href="rgcms.html#_rgcms_schema-cmd">"cmd" schema</a>).</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rgfis_persistence-layer">4. Persistence Layer internal SPI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>These domain services are internal to the framework, controlling various aspects of the persistence layer.</p>
</div>
<div class="paragraph">
<p>The table below summarizes the persistence layer internal SPIs defined by Apache Isis.  It also lists their
corresponding implementation, either a default implementation provided by Apache Isis itself, or provided by one of the
(non-ASF) <a href="http://www.isisaddons.org">Isis Addons</a> modules.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. Internal Services</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">SPI</th>
<th class="tableblock halign-left valign-top">Maven Module<br>
Impl&#8217;n (g: a:)</th>
<th class="tableblock halign-left valign-top">Implementation</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rgfis_spi_AuditingServiceInternal"><code>o.a.i.c.r.s.auditing.</code><br>
<code>AuditingServiceInternal</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Co-ordinates between
<a href="#_rgfis_spi_ChangedObjectsServiceInternal"><code>ChangedObjectsServiceInternal</code></a> and
<a href="#_rgfis_spi_AuditerService"><code>AuditerService</code></a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">concrete class.</p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rgfis_spi_ChangedObjectsServiceInternal"><code>o.a.i.c.r.s.changes.</code><br>
<code>ChangedObjectsServiceInternal</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request-scoped service holding objects enlisted into current transaction.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">concrete class.</p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rgfis_spi_PersistenceSessionServiceInternal"><code>o.a.i.c.m.s.</code><br>
<code>persistsession.</code><br>
<code>PersistenceSessionServiceInternal</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Acts as a facade to the underlying JDO persistence session / database connection.  As such it provides methods for
querying and for persisting objects.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PersistenceSessionService-</code><br>
<code>InternalDefault</code><br>
<code>isis-core-runtime</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rgfis_spi_PublishingServiceInternal"><code>o.a.i.c.m.s.publishing.</code><br>
<code>PublishingServiceInternal</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Co-ordinates between
<a href="#_rgfis_spi_ChangedObjectsServiceInternal"><code>ChangedObjectsServiceInternal</code></a> and
<a href="rgsvc.html#_rgsvc_api_MetricsService"><code>MetricsService</code></a> and the SPI services,
<a href="rgsvc.html#_rgsvc_spi_PublisherService"><code>PublisherService</code></a> and (deprecated)
<a href="rgsvc.html#_rgsvc_spi_PublishingService"><code>PublishingService</code></a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PublishingService-</code><br>
<code>InternalDefault</code><br>
<code>isis-core-runtime</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_rgfis_spi_TransactionStateProviderInternal"><code>o.a.i.c.m.s.</code><br>
<code>transtate.</code><br>
<code>TransactionStateProviderInternal</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simply provides the ability to check as to the state of the current transaction.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TransactionStateProvider-</code><br>
<code>InternalDefault</code><br>
<code>isis-core-runtime</code></p></td>
<td class="tableblock halign-left valign-top"><div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Key:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>o.a.i</code> is an abbreviation for <code>org.apache.isis</code></p>
</li>
<li>
<p><code>o.ia.m</code> is an abbreviation for <code>org.isisaddons.module</code></p>
</li>
<li>
<p><code>o.a.i.c.m.s</code> is an abbreviation for <code>org.apache.isis.core.metamodel.services</code></p>
</li>
<li>
<p><code>o.a.i.c.r.s</code> is an abbreviation for <code>org.apache.isis.core.runtime.services</code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_rgfis_spi_AuditingServiceInternal">4.1. <code>AuditingServiceInternal</code></h3>
<div class="paragraph">
<p>The (internal) <code>AuditingServiceInternal</code> domain service acts as an internal facade to any
configured <a href="rgsvc.html#_rgsvc_spi_AuditingService"><code>AuditingService</code></a> and
<a href="rgsvc.html#_rgsvc_spi_AuditerService"><code>AuditerService</code></a> services.  It is responsible for obtaining the details
of all changes to domain objects within an interaction, and then to call the configured <code>AuditingService</code> to actually
create audit entries of those changes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a href="rgsvc.html#_rgsvc_spi_AuditingService"><code>AuditingService</code></a> is now deprecated, replaced by
<a href="rgsvc.html#_rgsvc_spi_AuditerService"><code>AuditerService</code></a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_spi_and_implementation_2">4.1.1. SPI and Implementation</h4>
<div class="paragraph">
<p>The SPI of the service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AuditingServiceInternal</span> {
    <span class="directive">public</span> <span class="type">boolean</span> canAudit();              <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="type">void</span> audit();                    <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>minor performance optimization as to whether any auditing services are actually enabled; checks to see if
any <a href="rgsvc.html#_rgsvc_spi_AuditingService"><code>AuditingService</code></a> has been configured, also if any
<a href="rgsvc.html#_rgsvc_spi_AuditerService"><code>AuditService</code></a> are enabled.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>uses the <a href="#_rgfis_spi_ChangedObjectsServiceInternal"><code>ChangedObjectsServiceInternal</code></a> to obtain details of the changed properties, then call the configured <a href="rgsvc.html#_rgsvc_spi_AuditingService"><code>AuditingService</code></a>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The service implementation is <code>o.a.i.c.r.s.auditing.AuditingServiceInternal</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_service">4.1.2. Registering the Service</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured (implicit if using the
<code>AppManifest</code> to <a href="rgcms.html#_rgcms_classes_AppManifest-bootstrapping">bootstrap the app</a>) then Apache Isis' default
implementation of <code>AuditingServiceInternal</code> class is automatically registered (it is annotated with <code>@DomainService</code>)
so no further configuration is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_classes">4.1.3. Related Classes</h4>
<div class="paragraph">
<p>The service delegates between the (internal) <a href="#_rgfis_spi_ChangedObjectsServiceInternal"><code>ChangedObjectsServiceInternal</code></a> domain service  to the configured <a href="rgsvc.html#_rgsvc_spi_AuditingService"><code>AuditingService</code></a>.  If no such <code>AuditingService</code> is configured, this service is in effect a no-op.</p>
</div>
<div class="paragraph">
<p>The (internal) <a href="#_rgfis_spi_PublishingServiceInternal"><code>PublishingServiceInternal</code></a> performs a similar function for the <a href="rgsvc.html#_rgsvc_spi_PublisherService"><code>PublisherService</code></a>, also collating details of the changed objects from <code>ChangedObjectsServiceInternal</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rgfis_spi_ChangedObjectsServiceInternal">4.2. <code>ChangedObjectsServiceInternal</code></h3>
<div class="paragraph">
<p>The <code>ChangedObjectsServiceInternal</code> class is an (internal) request-scoped domain service that is
responsible for collecting the details of all changes to domain objects within an interaction.  This is then used by
various other  (internal) domain services, notably
<a href="#_rgfis_spi_AuditingServiceInternal"><code>AuditingServiceInternal</code></a> and
<a href="#_rgfis_spi_PublishingServiceInternal"><code>PublishingServiceInternal</code></a>.</p>
</div>
<div class="sect3">
<h4 id="_spi_and_implementation_3">4.2.1. SPI and Implementation</h4>
<div class="paragraph">
<p>The SPI of the service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequestScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ChangedObjectsServiceInternal</span> {
    <span class="directive">public</span> <span class="type">void</span> enlistCreated(<span class="directive">final</span> ObjectAdapter adapter);                                     <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="type">void</span> enlistUpdating(<span class="directive">final</span> ObjectAdapter adapter);
    <span class="directive">public</span> <span class="type">void</span> enlistDeleting(<span class="directive">final</span> ObjectAdapter adapter);

    <span class="directive">public</span> <span class="type">boolean</span> hasChangedAdapters();                                                        <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="directive">public</span> <span class="predefined-type">Map</span>&lt;ObjectAdapter, PublishedObject.ChangeKind&gt; getChangeKindByEnlistedAdapter();     <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="directive">public</span> <span class="type">int</span> numberObjectsDirtied();
    <span class="directive">public</span> <span class="type">int</span> numberObjectPropertiesModified();

    <span class="directive">public</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Map</span>.Entry&lt;AdapterAndProperty, PreAndPostValues&gt;&gt; getChangedObjectProperties();   <i class="conum" data-value="4"></i><b>(4)</b>

    <span class="directive">public</span> <span class="type">void</span> clearChangedObjectProperties();                                                 <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enlists an object that has just been created, updated or deleted, capturing the pre-modification values of the properties.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Used by the framework to determine whether to set the "persist hint" on the <code>Command</code> object (as per <a href="rgsvc.html#_rgsvc_api_CommandContext"><code>CommandContext</code></a>).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Used by <a href="#_rgfis_spi_PublishingServiceInternal"><code>PublishingServiceInternal</code></a> to obtain details of and
counters of all objects changed within the transaction.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Used by <a href="#_rgfis_spi_AuditingServiceInternal"><code>AuditingServiceInternal</code></a> to obtain all pairs of
pre/post values of changed properties</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Called by the framework to for clean up after auditing and publishing has completed.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For enlisted objects, if just created, then a dummy value <code>"[NEW]"</code> is used for the pre-modification value; if just
deleted, then a dummy value <code>"[DELETED]"</code> is used for the post-modification value.  The post-modification values of
properties are captured when the transaction commits.</p>
</div>
<div class="paragraph">
<p>The service implementation is <code>o.a.i.c.r.s.changes.ChangedObjectsServiceInternal</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_service_2">4.2.2. Registering the Service</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured (implicit if using the
<code>AppManifest</code> to <a href="rgcms.html#_rgcms_classes_AppManifest-bootstrapping">bootstrap the app</a>) then Apache Isis' default
implementation of <code>ChangedObjectsServiceInternal</code> class is automatically registered (it is annotated with <code>@DomainService</code>)
so no further configuration is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_classes_2">4.2.3. Related Classes</h4>
<div class="paragraph">
<p>Both the <a href="#_rgfis_spi_AuditingServiceInternal"><code>AuditingServiceInternal</code></a> and
<a href="#_rgfis_spi_PublishingServiceInternal"><code>PublishingServiceInternal</code></a> (internal) domain services query
this object.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rgfis_spi_PersistenceSessionServiceInternal">4.3. <code>PersistenceSessionServiceInternal</code></h3>
<div class="paragraph">
<p>The (internal) <code>PersistenceSessionServiceInternal</code> domain service acts as a facade to the underlying JDO persistence session / database connection.  As such it provides methods for querying and for persisting objects.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The default implementation of this service is not (as of <code>1.13.0</code>) request-scoped, however all of the methods delegate
to the <code>PersistenceSession</code> of the current <code>IsisSession</code> - obtained from the thread-local of <code>IsisSessionFactory</code> singleton service.
So, in effect the service does act as if it is request scoped.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_spi_4">4.3.1. SPI</h4>
<div class="paragraph">
<p>The SPI of the service is a hierarchy of types.  First is <code>AdapterManagerBase</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">AdapterManagerBase</span> {
    ObjectAdapter getAdapterFor(<span class="predefined-type">Object</span> pojo);           <i class="conum" data-value="1"></i><b>(1)</b>
    ObjectAdapter adapterFor(<span class="predefined-type">Object</span> domainObject);      <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Gets the <code>ObjectAdapter</code> for the specified domain object if it exists in the identity map, else returns <code>null</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Looks up or creates a standalone (value) or root adapter.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>AdapterManager</code> is the immediate subtype:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">AdapterManager</span> <span class="directive">extends</span> AdapterManagerBase {
    ObjectAdapter getAdapterFor(<span class="predefined-type">Object</span> pojo);                       <i class="conum" data-value="1"></i><b>(1)</b>
    ObjectAdapter adapterFor(                                       <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="predefined-type">Object</span> pojo, ObjectAdapter parentAdapter,
        OneToManyAssociation collection);
    ObjectAdapter mapRecreatedPojo(Oid oid, <span class="predefined-type">Object</span> recreatedPojo);  <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="type">void</span> removeAdapter(ObjectAdapter adapter);                      <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Gets the <code>ObjectAdapter</code> for the <code>Oid</code> if it exists in the identity map.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Looks up or creates a collection adapter.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Enable RecreatableObjectFacet to 'temporarily' map an existing pojo to an oid.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Enable RecreatableObjectFacet to remove a 'temporarily' mapped an adapter for a pojo.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, <code>PersistenceSessionServiceInternal</code> is a subtype of <code>AdapterManager</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">PersistenceSessionServiceInternal</span> <span class="directive">extends</span> AdapterManager {

    <span class="comment">// instantiate</span>
    ObjectAdapter createTransientInstance(
                    ObjectSpecification spec);
    ObjectAdapter createViewModelInstance(
                    ObjectSpecification spec, <span class="predefined-type">String</span> memento);

    <span class="comment">// retrieve</span>
    <span class="type">void</span> resolve(<span class="predefined-type">Object</span> parent);
    <span class="annotation">@Deprecated</span>
    <span class="type">void</span> resolve(<span class="predefined-type">Object</span> parent, <span class="predefined-type">Object</span> field);
    <span class="predefined-type">Object</span> lookup(Bookmark bookmark, <span class="directive">final</span> BookmarkService2.FieldResetPolicy fieldResetPolicy);
    Bookmark bookmarkFor(<span class="predefined-type">Object</span> domainObject);
    Bookmark bookmarkFor(<span class="predefined-type">Class</span>&lt;?&gt; cls, <span class="predefined-type">String</span> identifier);

    <span class="comment">// beginTran, flush, commit, currentTransaction</span>
    <span class="type">void</span> beginTran();
    <span class="type">boolean</span> flush();
    <span class="type">void</span> commit();
    Transaction currentTransaction();
    <span class="type">void</span> executeWithinTransaction(TransactionalClosure transactionalClosure);

    <span class="comment">// makePersistent, remove</span>
    <span class="type">void</span> makePersistent(ObjectAdapter adapter);
    <span class="type">void</span> remove(ObjectAdapter adapter);
    <span class="comment">// allMatchingQuery, firstMatchingQuery</span>
    &lt;T&gt; <span class="predefined-type">List</span>&lt;ObjectAdapter&gt; allMatchingQuery(<span class="predefined-type">Query</span>&lt;T&gt; query);
    &lt;T&gt; ObjectAdapter firstMatchingQuery(<span class="predefined-type">Query</span>&lt;T&gt; query);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_runtime_vs_noop_implementation_2">4.3.2. Runtime vs Noop implementation</h4>
<div class="paragraph">
<p>The framework provides two implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PersistenceSessionServiceInternalDefault</code> is provided by <code>isis-core-runtime</code>, and is used during normal use and integration tests</p>
</li>
<li>
<p><code>PersistenceSessionServiceInternalNoop</code> is provided as a fallback by <code>isis-core-metamodel</code>, and is provided to allow the <a href="#rgmvn.adoc">maven plugin</a> to be bootstrapped without any "backend" database.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>&#8230;&#8203;Default</code> implementation takes priority over the <code>&#8230;&#8203;Noop</code> implementation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rgfis_spi_PublishingServiceInternal">4.4. <code>PublishingServiceInternal</code></h3>
<div class="paragraph">
<p>The (internal) <code>PublishingServiceInternal</code> domain service acts as an internal facade to any
configured <a href="rgsvc.html#_rgsvc_spi_PublisherService"><code>PublisherService</code></a> or (deprecated)
<a href="rgsvc.html#_rgsvc_spi_PublishingService"><code>PublishingService</code></a> domain services.</p>
</div>
<div class="paragraph">
<p>For published action invocations/ property edits, it provides an API for those member executions to call.</p>
</div>
<div class="paragraph">
<p>For published objects, it provides an API for the framework to call at the end of the interaction; it obtains details
of the changed objects (from the
<a href="#_rgfis_spi_ChangedObjectsServiceInternal"><code>ChangedObjectsServiceInternal</code></a>) and filters them to just
those objects that are to be published; these are then passed through to any configured <code>PublisherService</code> or
<code>PublishingService</code> implementations.</p>
</div>
<div class="sect3">
<h4 id="_spi_and_implementation_4">4.4.1. SPI and Implementation</h4>
<div class="paragraph">
<p>The SPI of the service is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">PublishingServiceInternal</span> {
    <span class="type">void</span> publishAction(
            Interaction.Execution execution,        <i class="conum" data-value="1"></i><b>(1)</b>
            ObjectAction objectAction,              <i class="conum" data-value="2"></i><b>(2)</b>
            IdentifiedHolder identifiedHolder,
            ObjectAdapter targetAdapter,
            <span class="predefined-type">List</span>&lt;ObjectAdapter&gt; parameterAdapters,
            ObjectAdapter resultAdapter);
    <span class="type">void</span> publishProperty(                           <i class="conum" data-value="3"></i><b>(3)</b>
            Interaction.Execution execution);
    <span class="type">void</span> publishObjects();                          <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>to publish an action invocation, as represented by the specified member <code>Execution</code> parameter and with the
<a href="rgant.html#_rgant-Action_publishing"><code>@Action#publishing()</code></a> annotation attribute or equivalent, to any configured
<a href="rgsvc.html#_rgsvc_spi_PublisherService"><code>PublisherService</code></a>.  The <code>Execution</code> object will be an instance of
<code>ActionInvocation</code> (see <a href="rgsvc.html#_rgsvc_api_InteractionContext"><code>InteractionContext</code></a> for details).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the remaining parameters are to support the publishing of the action to any configured
<a href="rgsvc.html#_rgsvc_spi_PublishingService"><code>PublishingService</code></a> services (deprecated).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>to publish a property edit, as as represented by the specified member <code>Execution</code> parameter and with the
<a href="rgant.html#_rgant-Property_publishing"><code>@Property#publishing()</code></a> annotation attribute or equivalent, to any
configured <a href="rgsvc.html#_rgsvc_spi_PublisherService"><code>PublisherService</code></a>.  The <code>Execution</code> object will be an instance
of <code>PropertyEdit</code> (see <a href="rgsvc.html#_rgsvc_api_InteractionContext"><code>InteractionContext</code></a> for details).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>to publish all changed objects that are to be published (with the
<a href="rgant.html#_rgant-DomainObject_publishing"><code>@DomainObject#publishing()</code></a> annotation attribute or equivalent).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The service implementation is <code>o.a.i.c.m.s.publishing.PublishingServiceInternal</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_registering_the_service_3">4.4.2. Registering the Service</h4>
<div class="paragraph">
<p>Assuming that the <code>configuration-and-annotation</code> services installer is configured (implicit if using the
<code>AppManifest</code> to <a href="rgcms.html#_rgcms_classes_AppManifest-bootstrapping">bootstrap the app</a>) then Apache Isis' default
implementation of <code>PublishingServiceInternal</code> class is automatically registered (it is annotated with <code>@DomainService</code>)
so no further configuration is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="_related_classes_3">4.4.3. Related Classes</h4>
<div class="paragraph">
<p>The service delegates between the (internal)
<a href="#_rgfis_spi_ChangedObjectsServiceInternal"><code>ChangedObjectsServiceInternal</code></a> domain service to the
configured <a href="rgsvc.html#_rgsvc_spi_PublisherService"><code>PublisherService</code></a> and
 <a href="rgsvc.html#_rgsvc_spi_PublishingService"><code>PublishingService</code></a>.</p>
</div>
<div class="paragraph">
<p>The (internal) <a href="#_rgfis_spi_AuditingServiceInternal"><code>AuditingServiceInternal</code></a> performs a similar
function for the <a href="rgsvc.html#_rgsvc_spi_PublisherService"><code>PublisherService</code></a>, also collating details of the
changed objects from <code>ChangedObjectsServiceInternal</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rgfis_spi_TransactionStateProviderInternal">4.5. <code>TransactionStateProviderInternal</code></h3>
<div class="paragraph">
<p>The (internal) <code>TransactionStateProviderInternal</code> domain service simply provides the ability to check as to the
state of the current transaction.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The service will probably be combined with <a href="rgsvc.html#_rgsvc_api_TransactionService"><code>TransactionService</code></a>
in the future.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_spi_and_implementation_5">4.5.1. SPI and Implementation</h4>
<div class="paragraph">
<p>The SPI of the service is simply:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">TransactionStateProviderInternal</span> {
    TransactionState getTransactionState();
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_runtime_vs_noop_implementation_3">4.5.2. Runtime vs Noop implementation</h4>
<div class="paragraph">
<p>The framework provides two implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TransactionStateProviderInternalDefault</code> is provided by <code>isis-core-runtime</code>, and is used during normal use and integration tests</p>
</li>
<li>
<p><code>TransactionStateProviderInternalNoop</code> is provided as a fallback by <code>isis-core-metamodel</code>, and is provided to allow the <a href="#rgmvn.adoc">maven plugin</a> to be bootstrapped without any "backend" database.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>&#8230;&#8203;Default</code> implementation takes priority over the <code>&#8230;&#8203;Noop</code> implementation.</p>
</div>
</div>
</div>
</div>
</div>
        </div>

        <footer>
          <hr>
          <p class="small">
          Copyright &copy; 2010~2016 The Apache&nbsp;Software&nbsp;Foundation, licensed under the Apache&nbsp;License,&nbsp;v2.0.
          <br/>
          Apache, the Apache feather logo, Apache&nbsp;Isis, and the Apache&nbsp;Isis project logo are all trademarks of The&nbsp;Apache&nbsp;Software&nbsp;Foundation.
          </p>
        </footer>

    </div>

    <div id="doc-content-right" class="large-3 medium-3 xcolumns">
        <div id="toc" class="toc2">
            <div class="fallback-toc">
                <ul class="sectlevel1">
<li><a href="#_rgfis">1. Framework Internal Services</a>
<ul class="sectlevel2">
<li><a href="#_other_guides">1.1. Other Guides</a></li>
</ul>
</li>
<li><a href="#_rgfis_presentation-layer">2. Presentation Layer</a>
<ul class="sectlevel2">
<li><a href="#_rgfis_spi_ContentNegotiationService">2.1. <code>ContentNegotiationService</code></a>
<ul class="sectlevel3">
<li><a href="#_spi">2.1.1. SPI</a></li>
<li><a href="#_implementation">2.1.2. Implementation</a></li>
<li><a href="#_usage">2.1.3. Usage</a></li>
<li><a href="#_configuration">2.1.4. Configuration</a></li>
<li><a href="#_registering_the_services">2.1.5. Registering the Services</a></li>
<li><a href="#_related_services">2.1.6. Related Services</a></li>
</ul>
</li>
<li><a href="#_rgfis_spi_RepresentationService">2.2. <code>RepresentationService</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_2">2.2.1. SPI</a></li>
<li><a href="#_implementation_2">2.2.2. Implementation</a></li>
<li><a href="#_registering_the_services_2">2.2.3. Registering the Services</a></li>
<li><a href="#_related_services_2">2.2.4. Related Services</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_rgfis_application-layer">3. Application Layer</a>
<ul class="sectlevel2">
<li><a href="#_rgfis_spi_AuthenticationSessionProvider">3.1. <code>AuthenticationSessionProvider</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_and_implementation">3.1.1. SPI and Implementation</a></li>
</ul>
</li>
<li><a href="#_rgfis_spi_CommandDtoServiceInternal">3.2. <code>CommandDtoServiceInternal</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_implementation">3.2.1. SPI &amp; Implementation</a></li>
<li><a href="#_related_services_3">3.2.2. Related Services</a></li>
</ul>
</li>
<li><a href="#_rgfis_spi_MessageBrokerServiceInternal">3.3. <code>MessageBrokerServiceInternal</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_3">3.3.1. SPI</a></li>
<li><a href="#_runtime_vs_noop_implementation">3.3.2. Runtime vs Noop implementation</a></li>
</ul>
</li>
<li><a href="#_rgfis_spi_InteractionDtoServiceInternal">3.4. <code>InteractionDtoServiceInternal</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_implementation_2">3.4.1. SPI &amp; Implementation</a></li>
<li><a href="#_related_services_4">3.4.2. Related Services</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_rgfis_persistence-layer">4. Persistence Layer internal SPI</a>
<ul class="sectlevel2">
<li><a href="#_rgfis_spi_AuditingServiceInternal">4.1. <code>AuditingServiceInternal</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_and_implementation_2">4.1.1. SPI and Implementation</a></li>
<li><a href="#_registering_the_service">4.1.2. Registering the Service</a></li>
<li><a href="#_related_classes">4.1.3. Related Classes</a></li>
</ul>
</li>
<li><a href="#_rgfis_spi_ChangedObjectsServiceInternal">4.2. <code>ChangedObjectsServiceInternal</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_and_implementation_3">4.2.1. SPI and Implementation</a></li>
<li><a href="#_registering_the_service_2">4.2.2. Registering the Service</a></li>
<li><a href="#_related_classes_2">4.2.3. Related Classes</a></li>
</ul>
</li>
<li><a href="#_rgfis_spi_PersistenceSessionServiceInternal">4.3. <code>PersistenceSessionServiceInternal</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_4">4.3.1. SPI</a></li>
<li><a href="#_runtime_vs_noop_implementation_2">4.3.2. Runtime vs Noop implementation</a></li>
</ul>
</li>
<li><a href="#_rgfis_spi_PublishingServiceInternal">4.4. <code>PublishingServiceInternal</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_and_implementation_4">4.4.1. SPI and Implementation</a></li>
<li><a href="#_registering_the_service_3">4.4.2. Registering the Service</a></li>
<li><a href="#_related_classes_3">4.4.3. Related Classes</a></li>
</ul>
</li>
<li><a href="#_rgfis_spi_TransactionStateProviderInternal">4.5. <code>TransactionStateProviderInternal</code></a>
<ul class="sectlevel3">
<li><a href="#_spi_and_implementation_5">4.5.1. SPI and Implementation</a></li>
<li><a href="#_runtime_vs_noop_implementation_3">4.5.2. Runtime vs Noop implementation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </div>
        </div>
    </div>

</div>


<script src="../js/foundation/5.5.1/vendor/jquery.js"></script>
<script src="../js/foundation/5.5.1/foundation.min.js"></script>


<link href="../css/jquery.tocify/1.9.0/jquery.tocify.css" rel="stylesheet">
<script src="../js/jqueryui/1.11.4/jquery-ui.min.js"></script>
<script src="../js/jquery.tocify/1.9.0/jquery.tocify.js"></script>



<script type="text/javascript">
    $(function () {
        $("#toc").tocify({
            scrollTo: 50,
            extendPage: true,
            context: "#doc-content",
            highlightOnScroll: true,
            hashGenerator: "pretty",
            hideEffect: "slideUp",
            selectors: "h2,h3,h4,h5"
        });
        $(".fallback-toc").hide();
    });
</script>

<script type="text/javascript">

  /****

      $(document).foundation();

      $(document).ready(function(){
        // Cache selectors
        var lastId,
            topMenu = $("div#toc ul"),
            topMenuHeight = 100,

            menuItems = topMenu.find("a"),
            menuItemsHrefs = menuItems.map(function(){
              var item = $($(this).attr("href"));
              if (item.length) { return item; }
            });

        // Bind click handler to menu items to scroll animation
        menuItems.click(function(e){
          var href = $(this).attr("href"),
              offsetTop = href === "#" ? 0 : $(href).offset().top-topMenuHeight+1;
          $('html, body').stop().animate({
              scrollTop: offsetTop
          }, 300);

          e.preventDefault();
        });

        // Bind to scroll of window
        $(  window ).scroll(function(){

           // Get container scroll position
           var fromTop = $(this).scrollTop()+topMenuHeight;

           var cur = menuItemsHrefs.map(function(){
             if ($(this).offset().top < fromTop)
               return this;
           });

           // Get the id of the current element
           cur = cur[cur.length-1];

           var id = cur && cur.length ? cur[0].id : "";

           if (lastId !== id && id) {
               scrollTo(id);
           }

           window.history.pushState({}, "", window.location.origin + window.location.pathname + "#" + id);
        });

        scrollTo = function(id) {
              lastId = id;

              menuItems
                .removeClass("active");

              menuItems
                .parents()
                .removeClass("active-region");

              menuItems
                .parents("ul").hide();

              menuItems
                .filter("[href=#"+id+"]")
                .addClass("active");

              menuItems
                .filter("[href=#"+id+"]")
                .parents("ul").show();

              menuItems
                .filter("[href=#"+id+"]")
                .parent().children("ul").show();

              menuItems
                .filter("[href=#"+id+"]")
                .parents("li").addClass("active-region");

        }
      menuItems
        .removeClass("active");

      menuItems
        .parents()
        .removeClass("active-region");

        var syncMenuItem;
        if(window.location.hash!=="") {
            var menuItemFor = $.grep(menuItems, function(e) {
                return e.hash === window.location.hash;
            });
            console.log(menuItemFor);
            if(menuItemFor.length === 1) {
                syncMenuItem = menuItemFor[0];
            }
        }

        if(!syncMenuItem){
            syncMenuItem = menuItems[0];
        }

        $(syncMenuItem).click();

      });

    ***/

</script>

<script type="text/javascript">

$(document).ready(function(){
    if("Documentation" === "Framework Internal Services") {
        console.log( "processing 'Documentation'" );

        $("#doc-content-left").removeClass("large-9").removeClass("medium-9").addClass("large-12").addClass("medium-12");
        $("#doc-content-right").removeClass("large-3").removeClass("medium-3").hide();
    }

});

</script>


<script>

$( document ).ready(function() {

    (function() {
      $(function() {
        return $("#doc-content h2, #doc-content h3, #doc-content h4, #doc-content h5, #doc-content h6").each(function(i, el) {
          var $el, icon, id;
          $el = $(el);
          id = $el.attr('id');
          icon = '<i class="fa fa-link"></i>';
          if (id) {
            return $el.prepend($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
          }
        });
      });
    }).call(this);



	/*
        http://osvaldas.info/auto-hide-sticky-header
        MIT license
	*/
	;( function( $, window, document, undefined )
	{
		'use strict';

		var elSelector		= '.header',
			elClassHidden	= 'header--hidden',
			throttleTimeout	= 500,
			$element		= $( elSelector );

		if( !$element.length ) return true;

		var $window			= $( window ),
			wHeight			= 0,
			wScrollCurrent	= 0,
			wScrollBefore	= 0,
			wScrollDiff		= 0,
			$document		= $( document ),
			dHeight			= 0,

			throttle = function( delay, fn )
			{
				var last, deferTimer;
				return function()
				{
					var context = this, args = arguments, now = +new Date;
					if( last && now < last + delay )
					{
						clearTimeout( deferTimer );
						deferTimer = setTimeout( function(){ last = now; fn.apply( context, args ); }, delay );
					}
					else
					{
						last = now;
						fn.apply( context, args );
					}
				};
			};

		$window.on( 'scroll', throttle( throttleTimeout, function()
		{
			dHeight			= $document.height();
			wHeight			= $window.height();
			wScrollCurrent	= $window.scrollTop();
			wScrollDiff		= wScrollBefore - wScrollCurrent;

			if( wScrollCurrent <= 0 ) // scrolled to the very top; element sticks to the top
				$element.removeClass( elClassHidden );

			else if( wScrollDiff > 0 && $element.hasClass( elClassHidden ) ) // scrolled up; element slides in
				$element.removeClass( elClassHidden );

			else if( wScrollDiff < 0 ) // scrolled down
			{
				if( wScrollCurrent + wHeight >= dHeight && $element.hasClass( elClassHidden ) ) // scrolled to the very bottom; element slides in
					$element.removeClass( elClassHidden );

				else // scrolled down; element slides out
					$element.addClass( elClassHidden );
			}

			wScrollBefore = wScrollCurrent;
		}));

	})( jQuery, window, document );


});
</script>

</body>
</html>
