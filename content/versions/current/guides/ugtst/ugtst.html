<!doctype html>
<html>
 <head> 
  <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    --> 
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
  <meta charset="utf-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <!-- No caching headers --> 
  <meta http-equiv="cache-control" content="no-cache"> 
  <meta http-equiv="pragma" content="no-cache"> 
  <meta http-equiv="expires" content="-1"> 
  <title>Testing</title> 
  <link rel="icon" type="image/png" href="../../images/isis-favicon.png"> 
  <!--
        Based on DataNucleus' template,
        that was in turn based on an earlier version of Apache Isis' template,
        that was in turn based on Apache Deltaspike's template.

        This template uses
        * Bootstrap v3.3.7 (https://getbootstrap.com/) for navbar.
        * Bootstrap TOC plugin v0.4.1 (https://afeld.github.io/bootstrap-toc/)
          for the table of contents.
        * jQuery (necessary for Bootstrap's JavaScript plugins)
        * Font-Awesome for some icons used by Asciidoctor

        Also:
        * Bootswatch "flatly" theme for Bootstrap (https://bootswatch.com/flatly).
        * slick.js (carousel)
        * add a link to all headers (home-grown, adapted from blog posts)
        * integration of elasticlunr.js (home-grown, adapted from blog posts)
    --> 
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet"> 
  <link href="../../css/bootstrap-toc/0.4.1/bootstrap-toc.min.css" rel="stylesheet"> 
  <link href="../../css/asciidoctor/foundation.css" rel="stylesheet"> 
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet"> 
  <link href="../../css/slick/1.5.0/slick.css" rel="stylesheet"> 
  <link href="../../css/slick/1.5.0/slick-theme.css" rel="stylesheet"> 
  <link href="../../css/search-panel/search-panel.css" rel="stylesheet"> 
  <link href="../../css/header-links/header-links.css" rel="stylesheet"> 
  <link href="../../css/sticky-header/sticky-header.css" rel="stylesheet"> 
  <link href="../../css/customisations.css" rel="stylesheet"> 
  <!-- Coderay syntax formatter --> 
  <style type="text/css">
        /* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
    </style> 
 </head> 
 <body data-spy="scroll" data-target="#toc"> 
  <div id="basedir" style="display:none;">
   ../../
  </div> 
  <div id="docname" style="display:none;">
   ugtst
  </div> 
  <div id="filetype" style="display:none;">
   html
  </div> 
  <!-- Navbar --> 
  <nav class="navbar navbar-default navbar-static-top header"> 
   <div class="container"> 
    <div class="navbar-header"> 
     <!-- Three line menu button for use on mobile screens --> 
     <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> 
     <a class="navbar-brand" href="../../index.html"> <img alt="Brand" src="../../images/isis-logo-48x48.png"> </a> 
     <a class="navbar-brand" href="../../index.html">Apache Isis</a> 
    </div> 
    <!-- Navbar that will collapse on mobile screens --> 
    <div id="navbar" class="navbar-collapse collapse"> 
     <ul class="nav navbar-nav"> 
      <li class="dropdown"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation<span class="caret"></span></a> 
       <ul class="dropdown-menu"> 
        <li><a href="../../documentation.html">Table of Contents</a></li> 
        <li role="separator" class="divider"></li> 
        <li class="dropdown-header">User Guides</li> 
        <li><a href="../../guides/ugfun/ugfun.html">Fundamentals</a></li> 
        <li><a href="../../guides/ugvw/ugvw.html">Wicket Viewer</a></li> 
        <li><a href="../../guides/ugvro/ugvro.html">Restful Objects Viewer</a></li> 
        <li><a href="../../guides/ugodn/ugodn.html">DataNucleus Object Store</a></li> 
        <li><a href="../../guides/ugsec/ugsec.html">Security</a></li> 
        <li><a href="../../guides/ugtst/ugtst.html">Testing</a></li> 
        <li><a href="../../guides/ugbtb/ugbtb.html">Beyond the Basics</a></li> 
        <li role="separator" class="divider"></li> 
        <li class="dropdown-header">Reference Guides</li> 
        <li><a href="../../guides/rgant/rgant.html">Annotations</a></li> 
        <li><a href="../../guides/rgsvc/rgsvc.html">Domain Services</a></li> 
        <li><a href="../../guides/rgcfg/rgcfg.html">Core Config' Properties</a></li> 
        <li><a href="../../guides/rgcms/rgcms.html">Classes, Methods and Schema</a></li> 
        <li><a href="../../guides/rgmvn/rgmvn.html">Maven plugin</a></li> 
        <li><a href="../../guides/rgfis/rgfis.html">Framework Internal Services</a></li> 
        <li role="separator" class="divider"></li> 
        <li class="dropdown-header">Javadoc</li> 
        <li><a href="http://javadoc.io/doc/org.apache.isis.core/isis-core-applib">Applib</a></li> 
       </ul> </li> 
      <li class="dropdown  hidden-sm hidden-md"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Downloads<span class="caret"></span></a> 
       <ul class="dropdown-menu"> 
        <li class="dropdown-header">Maven archetypes</li> 
        <li><a href="../../guides/ugfun/ugfun.html#_ugfun_getting-started_helloworld-archetype">helloworld</a></li> 
        <li><a href="../../guides/ugfun/ugfun.html#_ugfun_getting-started_simpleapp-archetype">simpleapp</a></li> 
        <li role="separator" class="divider"></li> 
        <li><a href="../../downloads.html">Downloads</a></li> 
        <li><a href="../../release-notes/release-notes.html">Release Notes</a></li> 
        <li><a href="../../migration-notes/migration-notes.html">Migration Notes</a></li> 
        <li role="separator" class="divider"></li> 
        <li><a href="https://github.com/apache/isis">Github mirror</a></li> 
       </ul> </li> 
      <li class="dropdown  hidden-sm"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Support<span class="caret"></span></a> 
       <ul class="dropdown-menu"> 
        <li class="dropdown-header">Guides</li> 
        <li><a href="../../guides/dg/dg.html">Developers' Guide</a></li> 
        <li><a href="../../guides/cgcom/cgcom.html">Committers' Guide</a></li> 
        <li><a href="../../guides/htg.html">Hints-n-Tips Guide</a></li> 
        <li role="separator" class="divider"></li> 
        <li class="dropdown-header">Mailing Lists</li> 
        <li><a href="../../support.html">How to subscribe</a></li> 
        <li><a href="https://lists.apache.org/list.html?users@isis.apache.org">Archives (ASF Pony mail)</a></li> 
        <li><a href="http://isis.markmail.org/search/?q=">Archives (Markmail)</a></li> 
        <li role="separator" class="divider"></li> 
        <li class="dropdown-header">Other Resources</li> 
        <li><a href="https://issues.apache.org/jira/browse/ISIS">ASF JIRA</a></li> 
        <li><a href="https://stackoverflow.com/questions/tagged/isis">Stack Overflow</a></li> 
        <li><a href="../../help.html">Wiki, Fisheye etc.</a></li> 
       </ul> </li> 
      <li class="dropdown hidden-sm hidden-md"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">@ASF<span class="caret"></span></a> 
       <ul class="dropdown-menu"> 
        <li><a href="https://www.apache.org/">Apache Homepage</a></li> 
        <li><a href="https://www.apache.org/events/current-event">Events</a></li> 
        <li><a href="https://www.apache.org/licenses/">Licenses</a></li> 
        <li><a href="https://www.apache.org/security/">Security</a></li> 
        <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li> 
        <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li> 
        <li role="separator" class="divider"></li> 
        <li><a href="https://whimsy.apache.org/board/minutes/Isis.html">PMC board minutes</a></li> 
       </ul> </li> 
     </ul> 
     <div class="nav navbar-nav navbar-right"> 
      <!-- 'style' added to fix height of input box. FIX THIS --> 
      <form class="navbar-form" role="search" id="search-form" style="padding: 1px 15px;"> 
       <div class="form-group"> 
        <input class="form-control" id="search-field" type="text" size="30" placeholder="Search"> 
       </div> 
      </form> 
     </div> 
     <p class="nav navbar-text navbar-right small">v1.17.0</p> 
    </div> 
   </div> 
  </nav> 
  <div class="container"> 
   <div class="row-fluid"> 
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-9"> 
     <div id="search-panel"> 
      <div id="search-results"></div> 
      <div> 
       <br> 
       <a href="#" id="search-results-clear">clear</a> 
      </div> 
     </div> 
     <span class="pdf-link"><a href="ugtst.pdf"><img src="../../images/PDF-50.png"></a></span> 
     <div class="page-title"> 
      <h1>Testing</h1> 
     </div> 
     <div id="doc-content">
      <div class="btn-group" style="float: right; font-size: small; padding: 6px;  ">
       <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/ugtst.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
       <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
       <ul class="dropdown-menu">
        <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/ugtst.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
        <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/ugtst.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
        <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/ugtst.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
        <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/ugtst.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
       </ul>
      </div> 
      <div class="sect1"> 
       <h2 id="__ugtst">1. Testing</h2> 
       <div class="sectionbody"> 
        <div class="paragraph"> 
         <p>If you are going to use Apache Isis for developing complex business-critical applications, then being able to write automated tests for those applications becomes massively important. As such Apache Isis treats the topic of testing very seriously. (Though we say it ourselves), the framework has support that goes way above what is provided by other application frameworks.</p> 
        </div> 
        <div class="paragraph"> 
         <p>This guide describes those features available to you for testing your Apache Isis application.</p> 
        </div> 
        <div class="sect2"> 
         <h3 id="_other_guides">1.1. Other Guides</h3> 
         <div class="paragraph"> 
          <p>Apache Isis documentation is broken out into a number of user, reference and "supporting procedures" guides.</p> 
         </div> 
         <div class="paragraph"> 
          <p>The user guides available are:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><a href="../ugfun/ugfun.html">Fundamentals</a></p> </li> 
           <li> <p><a href="../ugvw/ugvw.html">Wicket viewer</a></p> </li> 
           <li> <p><a href="../ugvro/ugvro.html">Restful Objects viewer</a></p> </li> 
           <li> <p><a href="../ugodn/ugodn.html">DataNucleus object store</a></p> </li> 
           <li> <p><a href="../ugsec/ugsec.html">Security</a></p> </li> 
           <li> <p><a href="../ugtst/ugtst.html">Testing</a> (this guide)</p> </li> 
           <li> <p><a href="../ugbtb/ugbtb.html">Beyond the Basics</a></p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>The reference guides are:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><a href="../rgant/rgant.html">Annotations</a></p> </li> 
           <li> <p><a href="../rgsvc/rgsvc.html">Domain Services</a></p> </li> 
           <li> <p><a href="../rgcfg/rgcfg.html">Configuration Properties</a></p> </li> 
           <li> <p><a href="../rgcms/rgcms.html">Classes, Methods and Schema</a></p> </li> 
           <li> <p><a href="../rgmvn/rgmvn.html">Apache Isis Maven plugin</a></p> </li> 
           <li> <p><a href="../rgfis/rgfis.html">Framework Internal Services</a></p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>The remaining guides are:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><a href="../dg/dg.html">Developers' Guide</a> (how to set up a development environment for Apache Isis and contribute back to the project)</p> </li> 
           <li> <p><a href="../cgcom/cgcom.html">Committers' Guide</a> (release procedures and related practices)</p> </li> 
          </ul> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect1"> 
       <h2 id="_ugtst_overview">2. Overview</h2>
       <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
        <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_overview.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
        <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
        <ul class="dropdown-menu">
         <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_overview.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
         <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_overview.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
         <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_overview.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
         <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_overview.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
        </ul>
       </div> 
       <div class="sectionbody"> 
        <div class="sect2"> 
         <h3 id="_unit_tests_vs_integ_tests">2.1. Unit tests vs Integ tests</h3> 
         <div class="paragraph"> 
          <p>We divide automated tests into two broad categories:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>unit tests exercise a single unit (usually a method) of a domain object, in isolation. <br></p> 
            <div class="paragraph"> 
             <p>Dependencies of that object are mocked out. These are written by a developer and for a developer; they are to ensure that a particular "cog in the machine" works correctly</p> 
            </div> </li> 
           <li> <p>integration tests exercise the application as a whole, usually focusing on one particular business operation (action). <br></p> 
            <div class="paragraph"> 
             <p>These are tests that represent the acceptance criteria of some business story; their intent should make sense to the domain expert (even if the domain expert is "non-technical")</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>To put it another way:</p> 
         </div> 
         <div class="admonitionblock tip"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>Integration tests help ensure that you are <strong><em>building the right system</em></strong></p> 
              </div> 
              <div class="paragraph"> 
               <p>Unit tests help ensure that you are <strong><em>building the system right</em></strong>.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_integ_tests_vs_bdd_specs">2.2. Integ tests vs BDD Specs</h3> 
         <div class="paragraph"> 
          <p>We further sub-divide integration tests into:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>those that are implemented in Java and JUnit (we call these simply <em>"integration tests"</em>)<br></p> 
            <div class="paragraph"> 
             <p>Even if a domain expert understands the intent of these tests, the actual implementation will be opaque to them. Also, the only output from the tests is a (hopefully) green CI job</p> 
            </div> </li> 
           <li> <p>tests (or rather, specifications) that are implemented in a <em>behaviour-driven design</em> (BDD) language such as <a href="https://cucumber.io/">Cucumber</a> (we call these <em>"BDD specs"</em>)<br></p> 
            <div class="paragraph"> 
             <p>The natural language specification then maps down onto some glue code that is used to drive the application. But the benefits of taking a BDD approach include the fact that your domain expert will be able to read the tests/specifications, and that when you run the specs, you also get documentation of the application’s behaviour ("living documentation").</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>It’s up to you whether you use BDD specs for your apps; it will depend on your development process and company culture. But if you don’t then you certainly should write integration tests: acceptance criteria for user stories should be automated!</p> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_simulated_ui_code_wrapperfactory_code">2.3. Simulated UI (<code>WrapperFactory</code>)</h3> 
         <div class="paragraph"> 
          <p>When we talk about integration tests/specs here, we mean tests that exercise the domain object logic, through to the actual database. But we also want the tests to exercise the app from the users’s perspective, which means including the user interface.</p> 
         </div> 
         <div class="paragraph"> 
          <p>For most other frameworks that would require having to test the application in a very heavy weight/fragile fashion using a tool such as <a href="http://docs.seleniumhq.org/">Selenium</a>, driving a web browser to navigate . In this regard though, Apache Isis has a significant trick up its sleeve. Because Apache Isis implements the naked objects pattern, it means that the UI is generated automatically from declared domain-objects, -views and -services. This therefore allows for other implementations of the UI.</p> 
         </div> 
         <div class="paragraph"> 
          <p>The <a href="../rgsvc/rgsvc.html#_rgsvc_application-layer-api_WrapperFactory"><code>WrapperFactory</code></a> domain service allows a test to wrap domain objects and thus to interact with said objects "as if" through the UI:</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/testing/integ-tests.png"><img src="images/testing/integ-tests.png" alt="integ tests" width="700px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>If the test invokes an action that is disabled, then the wrapper will throw an appropriate exception. If the action is ok to invoke, it delegates through.</p> 
         </div> 
         <div class="paragraph"> 
          <p>What this means is that an Apache Isis application can be tested end-to-end without having to deploy it onto a webserver; the whole app can be tested while running in-memory. Although integration tests re (necessarily) slower than unit tests, they are not any harder to write (in fact, in some respects they are easier).</p> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_dependency_injection">2.4. Dependency Injection</h3> 
         <div class="paragraph"> 
          <p>Isis provides autowiring dependency injection into every domain object. This is most useful when writing unit tests; simply mock out the service and inject into the domain object.</p> 
         </div> 
         <div class="paragraph"> 
          <p>There are a number of syntaxes supported, but the simplest is to use <code>@javax.inject.Inject</code> annotation; for example:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@javax</span>.inject.Inject
CustomerRepository customers;</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Isis can inject into this even if the field has package-level (or even <code>private</code>) visibility. We recommend that you use package-level visibility, though, so that your unit tests (in the same package as the class under test) are able to inject mocks.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Isis does also support a couple of other syntaxes:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> setCustomerRepository(CustomerRepository customers) { ... }</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>or</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> injectCustomerRepository(CustomerRepository customers) { ... }</code></pre> 
          </div> 
         </div> 
         <div class="admonitionblock tip"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>Apache Isis also supports automatic dependency injection into integration tests; just declare the service dependency in the usual fashion and it will be automatically injected.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_given_when_then">2.5. Given/When/Then</h3> 
         <div class="paragraph"> 
          <p>Whatever type of test/spec you are writing, we recommend you follow the given/when/then idiom:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><strong>given</strong> the system is in this state (preconditions)</p> </li> 
           <li> <p><strong>when</strong> I poke it with a stick</p> </li> 
           <li> <p><strong>then</strong> it looks like this (postconditions)</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>A good test should be 5 to 10 lines long; the test should be there to help you reason about the behaviour of the system. Certainly if the test becomes more than 20 lines it’ll be too difficult to understand.</p> 
         </div> 
         <div class="paragraph"> 
          <p>The "when" part is usually a one-liner, and in the "then" part there will often be only two or three assertions that you want to make that the system has changed as it should.</p> 
         </div> 
         <div class="paragraph"> 
          <p>For unit test the "given" part shouldn’t be too difficult either: just instantiate the class under test, wire in the appropriate mocks and set up the expectations. And if there are too many mock expectations to set up, then "listen to the tests" …​ they are telling you your design needs some work.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Where things get difficult though is the "given" for integration tests; which is the topic of the next section…​</p> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_fixture_management">2.6. Fixture Management</h3> 
         <div class="paragraph"> 
          <p>In the previous section we discussed using given/when/then as a form of organizing tests, and why you should keep your tests small.</p> 
         </div> 
         <div class="paragraph"> 
          <p>For integration tests though it can be difficult to keep the "given" short; there could be a lot of prerequisite data that needs to exist before you can actually exercise your system. Moreover, however we do set up that data, but we also want to do so in a way that is resilient to the system changing over time.</p> 
         </div> 
         <div class="paragraph"> 
          <p>The solution that Apache Isis provides is a domain service called <a href="../rgcms/rgcms.html#_rgcms_classes_super_FixtureScripts">Fixture Scripts</a>, that defines a pattern and supporting classes to help ensure that the "data setup" for your tests are reusable and maintainable over time.</p> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_fake_data">2.7. Fake data</h3> 
         <div class="paragraph"> 
          <p>In any given test there are often quite a few variables involved, to initialize the state of the objects, or to act as arguments for invoking a method, or when asserting on post-conditions. Sometimes those values are important (eg verifying that an `Order’s state went from PENDING to SHIPPED, say), but often they aren’t (a customer’s name, for example) but nevertheless need to be set up (especially in integration tests).</p> 
         </div> 
         <div class="paragraph"> 
          <p>We want our tests to be easily understood, and we want the reader’s eye to be drawn to the values that are significant and ignore those that are not.</p> 
         </div> 
         <div class="paragraph"> 
          <p>One way to do this is to use random (or fake) values for any insignificant data. This in effect tells the reader that "any value will do". Moreover, if it turns out that any data won’t do, and that there’s some behaviour that is sensitive to the value, then the test will start to flicker, passing and then failing depending on inputs. This is A Good Thing™.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Apache Isis does not, itself, ship with a fake data library. However, the (non-ASF) <a href="http://platform.incode.org" target="_blank" rel="noopener">Incode Platform</a>'s fakedata module (non-ASF) does provide exactly this capability.</p> 
         </div> 
         <div class="admonitionblock tip"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>Using fake data works very well with fixture scripts; the fixture script can invoke the business action with sensible (fake/random) defaults, and only require that the essential information is passed into it by the test.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_feature_toggles">2.8. Feature Toggles</h3> 
         <div class="paragraph"> 
          <p>Writing automated tests is just good development practice. Also good practice is developing on the mainline (master, trunk); so that your continuous integration system really is integrating all code. Said another way: <a href="http://martinfowler.com/bliki/FeatureBranch.html">don’t use branches</a>!</p> 
         </div> 
         <div class="paragraph"> 
          <p>Sometimes, though, a feature will take longer to implement than your iteration cycle. In such a case, how do you use continuous integration to keep everyone working on the mainline without revealing a half-implemented feature on your releases? One option is to use <a href="http://martinfowler.com/bliki/FeatureToggle.html">feature toggle</a>s.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Apache Isis does not, itself, ship with a feature toggle library. However, the (non-ASF) <a href="http://platform.incode.org" target="_blank" rel="noopener">Incode Platform</a>'s togglz module does provide exactly this capability.</p> 
         </div> 
         <div class="paragraph"> 
          <p>With all that said, let’s look in detail at the testing features provided by Apache Isis.</p> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect1"> 
       <h2 id="_ugtst_unit-test-support">3. Unit Test Support</h2>
       <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
        <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
        <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
        <ul class="dropdown-menu">
         <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
         <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
         <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
         <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
        </ul>
       </div> 
       <div class="sectionbody"> 
        <div class="paragraph"> 
         <p>Isis Core provides a number of unit test helpers for you to use (if you wish) to unit test your domain objects.</p> 
        </div> 
        <div class="sect2"> 
         <h3 id="_ugtst_unit-test-support_contract-tests">3.1. Contract Tests</h3>
         <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
          <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support_contract-tests.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
          <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
          <ul class="dropdown-menu">
           <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support_contract-tests.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
           <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support_contract-tests.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
           <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support_contract-tests.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
           <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support_contract-tests.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
          </ul>
         </div> 
         <div class="paragraph"> 
          <p>Contract tests ensure that all instances of a particular idiom/pattern that occur within your codebase are implemented correctly. You could think of them as being a way to enforce a certain type of coding standard. Implementation-wise they use <a href="https://code.google.com/p/reflections/">Reflections</a> library to scan for classes.</p> 
         </div> 
         <div class="sect3"> 
          <h4 id="_code_sortedset_code_s">3.1.1. <code>SortedSet</code>s</h4> 
          <div class="paragraph"> 
           <p>This contract test automatically checks that all fields of type <code>java.util.Collection</code> are declared as <code>java.util.SortedSet</code>. In other words, it precludes either <code>java.util.List</code> or <code>java.util.Set</code> from being used as a collection.</p> 
          </div> 
          <div class="paragraph"> 
           <p>For example, the following passes the contract test:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Department</span> {
    <span class="directive">private</span> <span class="predefined-type">SortedSet</span>&lt;Employee&gt; employees = <span class="keyword">new</span> <span class="predefined-type">TreeSet</span>&lt;Employee&gt;();
    ...
}</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>whereas this would not:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SomeDomainObject</span> {
    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;Employee&gt; employees = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;Employee&gt;();
    ...
}</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>If using DataNucleus against an RDBMS (as you probably are) then we strongly recommend that you implement this test, for several reasons:</p> 
          </div> 
          <div class="ulist"> 
           <ul> 
            <li> <p>first, <code>Set</code>s align more closely to the relational model than do <code>List</code>s. A <code>List</code> must have an additional index to specify order.</p> </li> 
            <li> <p>second, <code>SortedSet</code> is preferable to <code>Set</code> because then the order is well-defined and predictable (to an end user, to the programmer).<br></p> 
             <div class="paragraph"> 
              <p>The <a href="../rgcms/rgcms.html#_rgcms_classes_utility_ObjectContracts"><code>ObjectContracts</code></a> utility class substantially simplifies the task of implementing <code>Comparable</code> in your domain classes.</p> 
             </div> </li> 
            <li> <p>third, if the relationship is bidirectional then JDO/Objectstore will automatically maintain the relationship.</p> </li> 
           </ul> 
          </div> 
          <div class="paragraph"> 
           <p>To use the contract test, subclass <code>SortedSetsContractTestAbstract</code>, specifying the root package to search for domain classes.</p> 
          </div> 
          <div class="paragraph"> 
           <p>For example:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SortedSetsContractTestAll</span> <span class="directive">extends</span> SortedSetsContractTestAbstract {

    <span class="directive">public</span> SortedSetsContractTestAll() {
        <span class="local-variable">super</span>(<span class="string"><span class="delimiter">"</span><span class="content">org.estatio.dom</span><span class="delimiter">"</span></span>);
        withLoggingTo(<span class="predefined-type">System</span>.out);
    }
}</code></pre> 
           </div> 
          </div> 
         </div> 
         <div class="sect3"> 
          <h4 id="_bidirectional">3.1.2. Bidirectional</h4> 
          <div class="paragraph"> 
           <p>This contract test automatically checks that bidirectional 1:m or 1:1 associations are being maintained correctly (assuming that they follow the <a href="../ugfun/ugfun.html#_ugfun_how-tos_entity-relationships_managed-1-to-m-bidirectional-relationships">mutual registration pattern</a></p> 
          </div> 
          <div class="admonitionblock tip"> 
           <table> 
            <tbody>
             <tr> 
              <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> 
              <td class="content"> 
               <div class="paragraph"> 
                <p>(If using the JDO objectstore, then) there is generally no need to programmatically maintain 1:m relationships (indeed it may introduce subtle errors). For more details, see <a href="../ugfun/ugfun.html#_ugfun_how-tos_entity-relationships_managed-1-to-m-bidirectional-relationships">here</a>. Also check out the templates in the developers' guide (<a href="../dg/dg.html#<em>dg_ide_intellij_live-templates">live templates for IntelliJ</a> / <a href="../dg/dg.html#</em>dg_ide_eclipse_editor-templates">editor templates for Eclipse</a>) for further guidance.</p> 
               </div> </td> 
             </tr> 
            </tbody>
           </table> 
          </div> 
          <div class="paragraph"> 
           <p>For example, suppose that <code>ParentDomainObject</code> and <code>ChildDomainObject</code> have a 1:m relationship (<code>ParentDomainObject#children</code> / <code>ChildDomainObject#parent</code>), and also <code>PeerDomainObject</code> has a 1:1 relationship with itself (<code>PeerDomainObject#next</code> / <code>PeerDomainObject#previous</code>).</p> 
          </div> 
          <div class="paragraph"> 
           <p>The following will exercise these relationships:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">BidirectionalRelationshipContractTestAll</span>
        <span class="directive">extends</span> BidirectionalRelationshipContractTestAbstract {

    <span class="directive">public</span> BidirectionalRelationshipContractTestAll() {
        <span class="local-variable">super</span>(<span class="string"><span class="delimiter">"</span><span class="content">org.apache.isis.core.unittestsupport.bidir</span><span class="delimiter">"</span></span>,
                ImmutableMap.&lt;<span class="predefined-type">Class</span>&lt;?&gt;,Instantiator&gt;of(
                    ChildDomainObject.class, <span class="keyword">new</span> InstantiatorForChildDomainObject(),
                    PeerDomainObject.class, <span class="keyword">new</span> InstantiatorSimple(PeerDomainObjectForTesting.class)
                ));
        withLoggingTo(<span class="predefined-type">System</span>.out);
    }
}</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>The first argument to the constructor scopes the search for domain objects; usually this would be something like <code>"com.mycompany.dom"</code>.</p> 
          </div> 
          <div class="paragraph"> 
           <p>The second argument provides a map of <code>Instantiator</code> for certain of the domain object types. This has two main purposes. First, for abstract classes, it nominates an alternative concrete class to be instantiated. Second, for classes (such as <code>ChildDomainObject</code>) that are <code>Comparable</code> and are held in a <code>SortedSet</code>), it provides the ability to ensure that different instances are unique when compared against each other. If no <code>Instantiator</code> is provided, then the contract test simply attempts to instantiates the class.</p> 
          </div> 
          <div class="paragraph"> 
           <p>If any of the supporting methods (<code>addToXxx()</code>, <code>removeFromXxx()</code>, <code>modifyXxx()</code> or <code>clearXxx()</code>) are missing, the relationship is skipped.</p> 
          </div> 
          <div class="paragraph"> 
           <p>To see what’s going on (and to identify any skipped relationships), use the <code>withLoggingTo()</code> method call. If any assertion fails then the error should be descriptive enough to figure out the problem (without enabling logging).</p> 
          </div> 
          <div class="paragraph"> 
           <p>The example tests can be found <a href="https://github.com/apache/isis/tree/master/core/unittestsupport/src/test/java/org/apache/isis/core/unittestsupport/bidir">here</a>.</p> 
          </div> 
         </div> 
         <div class="sect3"> 
          <h4 id="_injected_services_method">3.1.3. Injected Services Method</h4> 
          <div class="paragraph"> 
           <p>It is quite common for some basic services to be injected in a project-specific domain object superclass; for example a <code>ClockService</code> might generally be injected everywhere:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">EstatioDomainObject</span> {
    <span class="annotation">@javax</span>.inject.Inject
    <span class="directive">protected</span> ClockService clockService;
}</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>If a subclass inadvertantly overrides this method and provides its own <code>ClockService</code> field, then the field in the superclass will never initialized. As you might imagine, <code>NullPointerException</code>s could then arise.</p> 
          </div> 
          <div class="paragraph"> 
           <p>This contract test automatically checks that the <code>injectXxx(…​)</code> method, to allow for injected services, is not overridable, ie <code>final</code>.</p> 
          </div> 
          <div class="admonitionblock note"> 
           <table> 
            <tbody>
             <tr> 
              <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> 
              <td class="content"> 
               <div class="paragraph"> 
                <p>This contract test is semi-obsolete; most of the time you will want to use <code>@javax.inject.Inject</code> on fields rather than the <code>injectXxx()</code> method. The feature dates from a time before Apache Isis supported the <code>@Inject</code> annotation.</p> 
               </div> </td> 
             </tr> 
            </tbody>
           </table> 
          </div> 
          <div class="paragraph"> 
           <p>To use the contract test, , subclass <code>SortedSetsContractTestAbstract</code>, specifying the root package to search for domain classes.</p> 
          </div> 
          <div class="paragraph"> 
           <p>For example:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">InjectServiceMethodMustBeFinalContractTestAll</span> <span class="directive">extends</span> InjectServiceMethodMustBeFinalContractTestAbstract {

    <span class="directive">public</span> InjectServiceMethodMustBeFinalContractTestAll() {
        <span class="local-variable">super</span>(<span class="string"><span class="delimiter">"</span><span class="content">org.estatio.dom</span><span class="delimiter">"</span></span>);
        withLoggingTo(<span class="predefined-type">System</span>.out);
    }
}</code></pre> 
           </div> 
          </div> 
         </div> 
         <div class="sect3"> 
          <h4 id="_value_objects">3.1.4. Value Objects</h4> 
          <div class="paragraph"> 
           <p>The <code>ValueTypeContractTestAbstract</code> automatically tests that a custom value type implements <code>equals()</code> and <code>hashCode()</code> correctly.</p> 
          </div> 
          <div class="paragraph"> 
           <p>For example, testing JDK’s own <code>java.math.BigInteger</code> can be done as follows:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ValueTypeContractTestAbstract_BigIntegerTest</span> <span class="directive">extends</span> ValueTypeContractTestAbstract&lt;<span class="predefined-type">BigInteger</span>&gt; {

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">BigInteger</span>&gt; getObjectsWithSameValue() {
        <span class="keyword">return</span> <span class="predefined-type">Arrays</span>.asList(<span class="keyword">new</span> <span class="predefined-type">BigInteger</span>(<span class="string"><span class="delimiter">"</span><span class="content">1</span><span class="delimiter">"</span></span>), <span class="keyword">new</span> <span class="predefined-type">BigInteger</span>(<span class="string"><span class="delimiter">"</span><span class="content">1</span><span class="delimiter">"</span></span>));
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">BigInteger</span>&gt; getObjectsWithDifferentValue() {
        <span class="keyword">return</span> <span class="predefined-type">Arrays</span>.asList(<span class="keyword">new</span> <span class="predefined-type">BigInteger</span>(<span class="string"><span class="delimiter">"</span><span class="content">2</span><span class="delimiter">"</span></span>));
    }
}</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>The example unit tests can be found <a href="https://github.com/apache/isis/tree/master/core/unittestsupport/src/test/java/org/apache/isis/core/unittestsupport/value">here</a>.</p> 
          </div> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_ugtst_unit-test-support_jmock-extensions">3.2. JMock Extensions</h3>
         <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
          <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support_jmock-extensions.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
          <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
          <ul class="dropdown-menu">
           <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support_jmock-extensions.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
           <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support_jmock-extensions.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
           <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support_jmock-extensions.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
           <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support_jmock-extensions.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
          </ul>
         </div> 
         <div class="paragraph"> 
          <p>As noted earlier, for unit tests we tend to use <a href="http://www.jmock.org">JMock</a> as our mocking library. The usual given/when/then format gets an extra step:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><strong>given</strong> the system is in this state</p> </li> 
           <li> <p><strong>expecting</strong> these interactions (set up the mock expectations here)</p> </li> 
           <li> <p><strong>when</strong> I poke it with a stick</p> </li> 
           <li> <p><strong>then</strong> these state changes and interactions with Mocks should have occurred.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>If using JMock then the interactions (in the "then") are checked automatically by a JUnit rule. However, you probably will still have some state changes to assert upon.</p> 
         </div> 
         <div class="admonitionblock tip"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> 
             <td class="content"> 
              <div class="title">
               Distinguish between queries vs mutators
              </div> 
              <div class="paragraph"> 
               <p>For mock interactions that simply retrieve some data, your test should not need to verify that it occurred. If the system were to be refactored and starts caching some data, you don’t really want your tests to start breaking because they are no longer performing a query that once they did. If using JMock API this means using the <code>allowing(..)</code> method to set up the expectation.</p> 
              </div> 
              <div class="paragraph"> 
               <p>On the other hand mocks that mutate the state of the system you probably should assert have occurred. If using JMock this typically means using the <code>oneOf(…​)</code> method.</p> 
              </div> 
              <div class="paragraph"> 
               <p>For more tips on using JMock and mocking in general, check out the <a href="http://www.growing-object-oriented-software.com/">GOOS</a> book, written by JMock’s authors, Steve Freeman and Nat Pryce and also <a href="http://natpryce.com/articles.html">Nat’s blog</a>.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>Apache Isis' unit test support provides <code>JUnitRuleMockery2</code> which is an extension to the <a href="http://www.jmock.org/">JMock</a>'s <code>JunitRuleMockery</code>. It provides a simpler API and also providing support for autowiring.</p> 
         </div> 
         <div class="paragraph"> 
          <p>For example, here we see that the class under test, an instance of <code>CollaboratingUsingSetterInjection</code>, is automatically wired up with its <code>Collaborator</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">JUnitRuleMockery2Test_autoWiring_setterInjection_happyCase</span> {

    <span class="annotation">@Rule</span>
    <span class="directive">public</span> JUnitRuleMockery2 context = JUnitRuleMockery2.createFor(Mode.INTERFACES_AND_CLASSES);

    <span class="annotation">@Mock</span>
    <span class="directive">private</span> Collaborator collaborator;

    <span class="annotation">@ClassUnderTest</span>
    <span class="directive">private</span> CollaboratingUsingSetterInjection collaborating;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> wiring() {
        assertThat(collaborating.collaborator, is(not(nullValue())));
    }
}</code></pre> 
          </div> 
         </div> 
         <div class="admonitionblock note"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>Isis also includes (and automatically uses) a <a href="http://www.javassist.org">Javassist</a>-based implementation of JMock’s <a href="http://www.jmock.org/mocking-classes.html"><code>ClassImposteriser</code></a> interface, so that you can mock out concrete classes as well as interfaces. We’ve provided this rather than JMock’s own cglib-based implementation (which is problematic for us given its own dependencies on <a href="http://asm.ow2.org/">asm</a>).</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>The example tests can be found <a href="https://github.com/apache/isis/tree/master/core/unittestsupport/src/test/java/org/apache/isis/core/unittestsupport/jmocking">here</a></p> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_ugtst_unit-test-support_soap-fake-server-junit-rule">3.3. SOAP Fake Endpoints</h3>
         <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
          <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support_soap-fake-server-junit-rule.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
          <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
          <ul class="dropdown-menu">
           <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support_soap-fake-server-junit-rule.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
           <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support_soap-fake-server-junit-rule.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
           <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support_soap-fake-server-junit-rule.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
           <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support_soap-fake-server-junit-rule.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
          </ul>
         </div> 
         <div class="paragraph"> 
          <p>No man is an island, and neither are most applications. Chances are that at some point you may need to integrate your Apache Isis application to other external systems, possibly using old-style SOAP web services. The SOAP client in this case could be a domain service within your app, or it might be externalized, eg invoked through a scheduler or using <a href="http://camel.apache.org">Apache Camel</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>While you will want to (of course) perform manual system testing/UAT with a test instance of that external system, it’s also useful to be able to perform unit testing of your SOAP client component.</p> 
         </div> 
         <div class="paragraph"> 
          <p>The <code>SoapEndpointPublishingRule</code> is a simple JUnit rule that allows you to run a fake SOAP endpoint within an unit test.</p> 
         </div> 
         <div class="admonitionblock tip"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>The (non-ASF) <a href="http://platform.incode.org" target="_blank" rel="noopener">Incode Platform</a>'s publishmq module provides a full example of how to integrate and test an Apache Isis application with a (faked out) external system.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="sect3"> 
          <h4 id="_code_soapendpointpublishingrule_code">3.3.1. <code>SoapEndpointPublishingRule</code></h4> 
          <div class="paragraph"> 
           <p>The idea behind this rule is that you write a fake server endpoint that implements the same WSDL contract as the "real" external system does, but which also exposes additional API to specify responses (or throw exceptions) from SOAP calls. It also typically records the requests and allows these to be queried.</p> 
          </div> 
          <div class="paragraph"> 
           <p>In its setup your unit test and gets the rule to instantiate and publish that fake server endpoint, and then obtains a reference to that server endpoint. It also instantiates the SOAP client, pointing it at the address (that is, a URL) that the fake server endpoint is running on. This way the unit test has control of both the SOAP client and server: the software under test and its collaborator.</p> 
          </div> 
          <div class="paragraph"> 
           <p>In the test methods your unit test sets up expectations on your fake server, and then exercises the SOAP client. The SOAP client calls the fake server, which then responds accordingly. The test can then assert that all expected interactions have occurred.</p> 
          </div> 
          <div class="paragraph"> 
           <p>So that tests don’t take too long to run, the rule puts the fake server endpoints onto a thread-local. Therefore the unit tests should clear up any state on the fake server endpoints.</p> 
          </div> 
          <div class="paragraph"> 
           <p>Your unit test uses the rule by specifying the endpoint class (must have a no-arg constructor):</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">FakeExternalSystemEndpointRuleTest</span> {
    <span class="annotation">@Rule</span>
    <span class="directive">public</span> SoapEndpointPublishingRule serverRule =
        <span class="keyword">new</span> SoapEndpointPublishingRule(FakeExternalSystemEndpoint.class);         <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">private</span> FakeExternalSystemEndpoint fakeServerEndpoint;
    <span class="directive">private</span> DemoObject externalSystemContract;                                    <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="annotation">@Before</span>
    <span class="directive">public</span> <span class="type">void</span> setUp() <span class="directive">throws</span> <span class="exception">Exception</span> {
        fakeServerEndpoint =
            serverRule.getEndpointImplementor(FakeExternalSystemEndpoint.class);  <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="directive">final</span> <span class="predefined-type">String</span> endpointAddress =
            serverRule.getEndpointAddress(FakeExternalSystemEndpoint.class);      <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="directive">final</span> DemoObjectService externalSystemService =                           <i class="conum" data-value="5"></i><b>(5)</b>
                <span class="keyword">new</span> DemoObjectService(ExternalSystemWsdl.getWsdl());              <i class="conum" data-value="6"></i><b>(6)</b>
        externalSystemContract = externalSystemService.getDemoObjectOverSOAP();
        BindingProvider provider = (BindingProvider) externalSystemContract;
        provider.getRequestContext().put(
                BindingProvider.ENDPOINT_ADDRESS_PROPERTY,
                endpointAddress)
        );
    }
    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> happy_case() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="comment">// given</span>
        <span class="directive">final</span> Update update = <span class="keyword">new</span> Update();                              <i class="conum" data-value="7"></i><b>(7)</b>
        ...
        <span class="comment">// expect</span>
        final UpdateResponse response = <span class="keyword">new</span> UpdateResponse();            <i class="conum" data-value="8"></i><b>(8)</b>
        ...
        fakeServerEndpoint.control().setResponse(updateResponse);
        <span class="comment">// when</span>
        PostResponse response = externalSystemContract.post(update);     <i class="conum" data-value="9"></i><b>(9)</b>
        <span class="comment">// then</span>
        <span class="directive">final</span> <span class="predefined-type">List</span>&lt;Update&gt; updates =                                     <i class="conum" data-value="10"></i><b>(10)</b>
            fakeServerEndpoint.control().getUpdates();
        ...
    }
}</code></pre> 
           </div> 
          </div> 
          <div class="colist arabic"> 
           <table> 
            <tbody>
             <tr> 
              <td><i class="conum" data-value="1"></i><b>1</b></td> 
              <td>specify the class that implements the endpoint (must have a no-arg constructor)</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="2"></i><b>2</b></td> 
              <td>the SOAP contract as defined in WSDL and generated by wsdl2java</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="3"></i><b>3</b></td> 
              <td>get hold of the fake server-side endpoint from the rule…​</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="4"></i><b>4</b></td> 
              <td>…​ and its endpoint address</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="5"></i><b>5</b></td> 
              <td>use factory (also generated by wsdl2java) to create client-side endpoint</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="6"></i><b>6</b></td> 
              <td><code>getWsdl()</code> is a utility method to return a URL for the WSDL (eg from the classpath)</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="7"></i><b>7</b></td> 
              <td>create a request object in order to invoke the SOAP web service</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="8"></i><b>8</b></td> 
              <td>instruct the fake server endpoint how to respond</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="9"></i><b>9</b></td> 
              <td>invoke the web service</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="10"></i><b>10</b></td> 
              <td>check the fake server endpoint was correctly invoked etc.</td> 
             </tr> 
            </tbody>
           </table> 
          </div> 
          <div class="paragraph"> 
           <p>The rule can also host multiple endpoints; just provide multiple classes in the constructor:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Rule</span>
<span class="directive">public</span> SoapEndpointPublishingRule serverRule =
                <span class="keyword">new</span> SoapEndpointPublishingRule(
                    FakeCustomersEndpoint.class,
                    FakeOrdersEndpoint.class,
                    FakeProductsEndpoint.class);</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>To lookup a particular endpoint, specify its type:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java">FakeProductsEndpoint fakeProductsServerEndpoint =
            serverRule.getPublishedEndpoint(FakeProductsEndpoint.class);</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>The endpoint addresses that the server endpoints run on are determined automatically. If you want more control, then you can call one of <code>SoapEndpointPublishingRule</code>'s overloaded constructors, passing in one or more <code>SoapEndpointSpec</code> instances.</p> 
          </div> 
         </div> 
         <div class="sect3"> 
          <h4 id="_xml_marshalling_support">3.3.2. XML Marshalling Support</h4> 
          <div class="paragraph"> 
           <p>Apache Isis' unit testing support also provides helper <code>JaxbUtil</code> and <code>JaxbMatchers</code> classes. These are useful if you have exampler XML-serialized representations of the SOAP requests and response payloads and want to use these within your tests.</p> 
          </div> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_ugtst_unit-test-support_maven-configuration">3.4. Maven Configuration</h3>
         <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
          <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support_maven-configuration.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
          <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
          <ul class="dropdown-menu">
           <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support_maven-configuration.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
           <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support_maven-configuration.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
           <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support_maven-configuration.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
           <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_unit-test-support_maven-configuration.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
          </ul>
         </div> 
         <div class="paragraph"> 
          <p>Apache Isis' unit test support is automatically configured if you use the <a href="../ugfun/ugfun.html#_ugfun_getting-started_helloworld-archetype">HelloWorld</a> or the <a href="../ugfun/ugfun.html#_ugfun_getting-started_simpleapp-archetype">SimpleApp</a> archetypes. To set it up manually, update the <code>pom.xml</code> of your domain object model module:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.apache.isis.core<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>isis-core-unittestsupport<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tag">&lt;/dependency&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="colist arabic"> 
          <table> 
           <tbody>
            <tr> 
             <td><i class="conum" data-value="1"></i><b>1</b></td> 
             <td>Normally <code>test</code>; usual Maven scoping rules apply.</td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="admonitionblock note"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>This can also be done by adding a dependency to <code>org.apache.isis.mavendeps:isis-mavendeps-testing</code> module; see the <a href="../ugfun/ugfun.html#_ugfun_getting-started_simpleapp-archetype">SimpleApp archetype</a>.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>We also recommend that you configure the <code>maven-surefire-plugin</code> to pick up the following class patterns:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.10<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;configuration&gt;</span>
        <span class="tag">&lt;includes&gt;</span>
            <span class="tag">&lt;include&gt;</span>**/*Test.java<span class="tag">&lt;/include&gt;</span>
            <span class="tag">&lt;include&gt;</span>**/*Test_*.java<span class="tag">&lt;/include&gt;</span>
            <span class="tag">&lt;include&gt;</span>**/*Spec*.java<span class="tag">&lt;/include&gt;</span>
        <span class="tag">&lt;/includes&gt;</span>
        <span class="tag">&lt;excludes&gt;</span>
            <span class="tag">&lt;exclude&gt;</span>**/Test*.java<span class="tag">&lt;/exclude&gt;</span>
            <span class="tag">&lt;exclude&gt;</span>**/*ForTesting.java<span class="tag">&lt;/exclude&gt;</span>
            <span class="tag">&lt;exclude&gt;</span>**/*Abstract*.java<span class="tag">&lt;/exclude&gt;</span>
        <span class="tag">&lt;/excludes&gt;</span>
        <span class="tag">&lt;useFile&gt;</span>true<span class="tag">&lt;/useFile&gt;</span>
        <span class="tag">&lt;printSummary&gt;</span>true<span class="tag">&lt;/printSummary&gt;</span>
        <span class="tag">&lt;outputDirectory&gt;</span>${project.build.directory}/surefire-reports<span class="tag">&lt;/outputDirectory&gt;</span>
    <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="admonitionblock note"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>This can also be done using mavenmixins; see the <a href="../ugfun/ugfun.html#_ugfun_getting-started_simpleapp-archetype">SimpleApp archetype</a>.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect1"> 
       <h2 id="_ugtst_integ-test-support">4. Integration Test Support</h2>
       <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
        <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
        <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
        <ul class="dropdown-menu">
         <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
         <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
         <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
         <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
        </ul>
       </div> 
       <div class="sectionbody"> 
        <div class="paragraph"> 
         <p>As discussed in the introductory overview of this chapter, Apache Isis allows you to integration test your domain objects from within JUnit. There are several parts to this:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>configuring the Apache Isis runtime so it can be bootstrapped (mostly boilerplate)</p> </li> 
          <li> <p>defining a base class to perform said bootstrapping</p> </li> 
          <li> <p>using fixture scripts to set up the app</p> </li> 
          <li> <p>using <code>WrapperFactory</code> so that the UI can be simulated.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>We’ll get to all that shortly, but let’s start by taking a look at what a typical integration test looks like.</p> 
        </div> 
        <div class="sect2"> 
         <h3 id="_ugtst_integ-test-support_typical-usage">4.1. Typical Usage</h3>
         <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
          <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_typical-usage.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
          <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
          <ul class="dropdown-menu">
           <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_typical-usage.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
           <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_typical-usage.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
           <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_typical-usage.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
           <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_typical-usage.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
          </ul>
         </div> 
         <div class="paragraph"> 
          <p>This example adapted from the <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a> (non-ASF). The code we want to test (simplified) is:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> ... {

    <span class="directive">private</span> <span class="type">boolean</span> complete;
    <span class="annotation">@Property</span>( editing = Editing.DISABLED )
    <span class="directive">public</span> <span class="type">boolean</span> isComplete() {
        <span class="keyword">return</span> complete;
    }
    <span class="directive">public</span> <span class="type">void</span> setComplete(<span class="directive">final</span> <span class="type">boolean</span> complete) {
        <span class="local-variable">this</span>.complete = complete;
    }

    <span class="annotation">@Action</span>()
    <span class="directive">public</span> ToDoItem completed() {
        setComplete(<span class="predefined-constant">true</span>);
        ...
        return <span class="local-variable">this</span>;
    }
    <span class="directive">public</span> <span class="predefined-type">String</span> disableCompleted() {
        <span class="keyword">return</span> isComplete() ? <span class="string"><span class="delimiter">"</span><span class="content">Already completed</span><span class="delimiter">"</span></span> : <span class="predefined-constant">null</span>;
    }
    ...
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>We typically put the bootstrapping of Apache Isis into a superclass (<code>AbstractToDoIntegTest</code> below), then subclass as required.</p> 
         </div> 
         <div class="paragraph"> 
          <p>For this test (of the "completed()" action) we need an instance of a <code>ToDoItem</code> that is not yet complete. Here’s the setup:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItemIntegTest</span> <span class="directive">extends</span> AbstractToDoIntegTest {

    <span class="annotation">@Inject</span>
    FixtureScripts fixtureScripts;                              <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Inject</span>
    ToDoItems toDoItems;                                        <i class="conum" data-value="2"></i><b>(2)</b>
    ToDoItem toDoItem;                                          <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="annotation">@Before</span>
    <span class="directive">public</span> <span class="type">void</span> setUp() <span class="directive">throws</span> <span class="exception">Exception</span> {
        RecreateToDoItemsForCurrentUser fixtureScript =         <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="keyword">new</span> RecreateToDoItemsForCurrentUser();
        fixtureScripts.runFixtureScript(fixtureScript, <span class="predefined-constant">null</span>);
        <span class="directive">final</span> <span class="predefined-type">List</span>&lt;ToDoItem&gt; all = toDoItems.notYetComplete();  <i class="conum" data-value="5"></i><b>(5)</b>
        toDoItem = wrap(all.get(<span class="integer">0</span>));                            <i class="conum" data-value="6"></i><b>(6)</b>
    }
    ...
}</code></pre> 
          </div> 
         </div> 
         <div class="colist arabic"> 
          <table> 
           <tbody>
            <tr> 
             <td><i class="conum" data-value="1"></i><b>1</b></td> 
             <td>the <a href="../rgcms/rgcms.html#_rgcms_classes_super_FixtureScripts"><code>FixtureScripts</code></a> domain service is injected, providing us with the ability to run fixture scripts</td> 
            </tr> 
            <tr> 
             <td><i class="conum" data-value="2"></i><b>2</b></td> 
             <td>likewise, an instance of the <code>ToDoItems</code> domain service is injected. We’ll use this to lookup…​</td> 
            </tr> 
            <tr> 
             <td><i class="conum" data-value="3"></i><b>3</b></td> 
             <td>the object under test, held as a field</td> 
            </tr> 
            <tr> 
             <td><i class="conum" data-value="4"></i><b>4</b></td> 
             <td>the fixture script for this test; it deletes all existing todo items (for the current user only) and then recreates them</td> 
            </tr> 
            <tr> 
             <td><i class="conum" data-value="5"></i><b>5</b></td> 
             <td>we lookup one of the just-created todo items…​</td> 
            </tr> 
            <tr> 
             <td><i class="conum" data-value="6"></i><b>6</b></td> 
             <td>and then wrap it so that our interactions with it are as if through the UI</td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>The following code tests the happy case, that a not-yet-completed <code>ToDoItem</code> can be completed by invoking the <code>completed()</code> action:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItemIntegTest</span> ... {
    ...
    public <span class="directive">static</span> <span class="type">class</span> <span class="class">Completed</span> <span class="directive">extends</span> ToDoItemIntegTest { <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="annotation">@Test</span>
        <span class="directive">public</span> <span class="type">void</span> happyCase() <span class="directive">throws</span> <span class="exception">Exception</span> {
            <span class="comment">// given</span>
            assertThat(toDoItem.isComplete()).isFalse();      <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="comment">// when</span>
            toDoItem.completed();
            <span class="comment">// then</span>
            assertThat(toDoItem.isComplete()).isTrue();
        }
        ...
    }
}</code></pre> 
          </div> 
         </div> 
         <div class="colist arabic"> 
          <table> 
           <tbody>
            <tr> 
             <td><i class="conum" data-value="1"></i><b>1</b></td> 
             <td>the idiom we follow is to use nested static classes to identify the class responsibility being tested</td> 
            </tr> 
            <tr> 
             <td><i class="conum" data-value="2"></i><b>2</b></td> 
             <td>the <a href="http://github.com/isisaddons/isis-app-todoapp">todoapp</a> uses <a href="http://joel-costigliola.github.io/assertj">AssertJ</a>.</td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>What about when a todo item is already completed? The <code>disableCompleted()</code> method in the class says that it shouldn’t be allowed (the action would be greyed out in the UI with an appropriate tooltip). The following test verifies this:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java">        <span class="annotation">@Test</span>
        <span class="directive">public</span> <span class="type">void</span> cannotCompleteIfAlreadyCompleted() <span class="directive">throws</span> <span class="exception">Exception</span> {
            <span class="comment">// given</span>
            unwrap(toDoItem).setComplete(<span class="predefined-constant">true</span>);                     <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="comment">// expect</span>
            expectedExceptions.expectMessage(<span class="string"><span class="delimiter">"</span><span class="content">Already completed</span><span class="delimiter">"</span></span>);  <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="comment">// when</span>
            toDoItem.completed();
        }</code></pre> 
          </div> 
         </div> 
         <div class="colist arabic"> 
          <table> 
           <tbody>
            <tr> 
             <td><i class="conum" data-value="1"></i><b>1</b></td> 
             <td>we unwrap the domain object in order to set its state directly</td> 
            </tr> 
            <tr> 
             <td><i class="conum" data-value="2"></i><b>2</b></td> 
             <td>the expectedExceptions <a href="http://junit.org/junit4/javadoc/latest/org/junit/rules/ExpectedException.html">JUnit rule</a> (defined by a superclass) verifies that the appropiate exception is indeed thrown (in the "when")</td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>And what about the fact that the underlying "complete" property is annotated as being disabled? If the <code>ToDoItem</code> is put into edit mode in the UI, the complete checkbox should remain read-only. Here’s a verify similar test that verifies this also:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java">        <span class="annotation">@Test</span>
        <span class="directive">public</span> <span class="type">void</span> cannotSetPropertyDirectly() <span class="directive">throws</span> <span class="exception">Exception</span> {
            <span class="comment">// expect</span>
            expectedExceptions.expectMessage(<span class="string"><span class="delimiter">"</span><span class="content">Always disabled</span><span class="delimiter">"</span></span>);  <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="comment">// when</span>
            toDoItem.setComplete(<span class="predefined-constant">true</span>);
        }</code></pre> 
          </div> 
         </div> 
         <div class="colist arabic"> 
          <table> 
           <tbody>
            <tr> 
             <td><i class="conum" data-value="1"></i><b>1</b></td> 
             <td>again we use the exceptedExceptions rule.</td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_ugtst_integ-test-support_bootstrapping">4.2. Bootstrapping</h3>
         <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
          <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_bootstrapping.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
          <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
          <ul class="dropdown-menu">
           <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_bootstrapping.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
           <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_bootstrapping.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
           <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_bootstrapping.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
           <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_bootstrapping.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
          </ul>
         </div> 
         <div class="paragraph"> 
          <p>Integration tests instantiate an Apache Isis "runtime" (as a singleton) within a JUnit test. Because (depending on the size of your app) it takes a little time to bootstrap Apache Isis, the framework caches the runtime on a thread-local from one test to the next.</p> 
         </div> 
         <div class="paragraph"> 
          <p>The recommended way to bootstrapping of integration tests is done using a <a href="../rgcms/rgcms.html#_rgcms_classes_AppManifest2-bootstrapping"><code>Module</code></a> implementation, along with the <code>IntegrationTestAbstract3</code> superclass.</p> 
         </div> 
         <div class="paragraph"> 
          <p>For example, the <a href="../ugfun/ugfun.html#_ugfun_getting-started_simpleapp-archetype">SimpleApp archetype</a>'s integration tests all inherit from this class:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">DomainAppIntegTestAbstract</span> <span class="directive">extends</span> IntegrationTestAbstract3 {

    <span class="directive">public</span> DomainAppIntegTestAbstract() {
        <span class="local-variable">super</span>(<span class="keyword">new</span> DomainAppApplicationModule());
    }
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>where <code>DomainAppApplicationModule</code> in turn declares all the dependencies that make up the application.</p> 
         </div> 
         <div class="paragraph"> 
          <p>If required, the <code>Module</code> can be customised first using the various <code>withXxx(…​)</code> methods to specify addition modules, domain services and configuration properties.</p> 
         </div> 
         <div class="sect3"> 
          <h4 id="_faster_bootstrapping">4.2.1. Faster Bootstrapping</h4> 
          <div class="paragraph"> 
           <p>The <code>IntegrationTestAbstract3</code> superclass also allows the introspection mode to be specified, which can reduce the time to bootstrap the test.</p> 
          </div> 
          <div class="paragraph"> 
           <p>By default integration tests are run in "production" deployment mode, so with the <code>isis.reflector.introspection.mode</code> set to its default of "lazy_unless_production" this will actually result in full introspection of the Apache Isis metamodel. The <em>does</em> have the benefit that the metamodel will be validated, but - as mentioned - with the corresponding downside of taking longer to bootstrap.</p> 
          </div> 
          <div class="paragraph"> 
           <p>To bootstrap lazily, override as follows:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">DomainAppIntegTestAbstract</span> <span class="directive">extends</span> IntegrationTestAbstract3 {

    <span class="directive">public</span> DomainAppIntegTestAbstract() {
        <span class="local-variable">super</span>(<span class="keyword">new</span> DomainAppApplicationModule(), IntrospectionMode.LAZY);
    }
}</code></pre> 
           </div> 
          </div> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_ugtst_integ-test-support_abstract-class">4.3. Abstract class</h3>
         <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
          <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_abstract-class.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
          <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
          <ul class="dropdown-menu">
           <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_abstract-class.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
           <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_abstract-class.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
           <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_abstract-class.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
           <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_abstract-class.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
          </ul>
         </div> 
         <div class="paragraph"> 
          <p>When writing integration tests, it’s easiest to inherit from the <code>IntegrationTestAbstract3</code> base class.</p> 
         </div> 
         <div class="paragraph"> 
          <p>This base class <a href="#_ugtst_integ-test-support_bootstrapping">bootstraps</a> the framework (caching the framework on a thread-local), and provides various utility methods and framework-provided services for use by your application’s subclass tests.</p> 
         </div> 
         <div class="sect3"> 
          <h4 id="__ugtst_integ-test-support_abstract-class_IntegrationTestAbstract3">4.3.1. <code>IntegrationTestAbstract3</code></h4> 
          <div class="paragraph"> 
           <p>We recommend that your integration tests inherit from Apache Isis' <code>IntegrationTestAbstract3</code> class. The primary benefit over its predecessor, <code>IntegrationTestAbstract2</code> (discussed <a href="#__ugtst_integ-test-support_abstract-class_IntegrationTestAbstract2">below</a> is that it allows the test to be bootstrapped by passing in a <code>Module</code> rather than an <code>AppManifest</code>.</p> 
          </div> 
          <div class="paragraph"> 
           <p>For example:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">DomainAppIntegTest</span>
                        <span class="directive">extends</span> IntegrationTestAbstract3 {

    <span class="directive">public</span> DomainAppIntegTestAbstract() {
        <span class="local-variable">super</span>(<span class="keyword">new</span> DomainAppApplicationModule());
    }
}</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>The <code>IntegrationTestAbstract3</code> class also allows the module to be specified externally, using either the <code>isis.integTest.module</code> or the (more general) <code>isis.headless.module</code> system property, eg by updating the <code>pom.xml</code>.</p> 
          </div> 
          <div class="paragraph"> 
           <p>For example:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;properties&gt;</span>
    <span class="tag">&lt;isis.integTest.module&gt;</span>
        org.estatio.module.application.EstatioApplicationModule
    <span class="tag">&lt;/isis.integTest.module&gt;</span>
<span class="tag">&lt;/properties&gt;</span></code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>This is required when the codebase is organised as multiple "logical" modules within a single Maven "physical" module (ie <code>src/main/java</code> compilation unit). The integration testing framework will bootstrap the module specified by the system property and cache for all tests discovered within the physical module.</p> 
          </div> 
          <div class="paragraph"> 
           <p>This test class provides a number of helper/convenience methods and JUnit rules:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Rule</span>
<span class="directive">public</span> IsisTransactionRule isisTransactionRule =                         <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="keyword">new</span> IsisTransactionRule();
<span class="annotation">@Rule</span>
<span class="directive">public</span> JUnitRuleMockery2 context =                                       <i class="conum" data-value="2"></i><b>(2)</b>
    JUnitRuleMockery2.createFor(Mode.INTERFACES_AND_CLASSES);
<span class="annotation">@Rule</span>
<span class="directive">public</span> ExpectedException expectedExceptions =                            <i class="conum" data-value="3"></i><b>(3)</b>
    ExpectedException.none();
<span class="annotation">@Rule</span>
<span class="directive">public</span> ExceptionRecognizerTranslate exceptionRecognizerTranslations =    <i class="conum" data-value="4"></i><b>(4)</b>
    ExceptionRecognizerTranslate.create();</code></pre> 
           </div> 
          </div> 
          <div class="colist arabic"> 
           <table> 
            <tbody>
             <tr> 
              <td><i class="conum" data-value="1"></i><b>1</b></td> 
              <td>ensures an Apache Isis session/transaction running for each test</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="2"></i><b>2</b></td> 
              <td>sets up a JMock context (using Apache Isis' extension to JMock as described in <a href="../ugtst/ugtst.html#_ugtst_unit-test-support_jmock-extensions">JMock Extensions</a>.</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="3"></i><b>3</b></td> 
              <td>standard JUnit rule for writing tests that throw exceptions</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="4"></i><b>4</b></td> 
              <td>to capture messages that require translation, as described in <a href="../ugbtb/ugbtb.html#_ugbtb_i18n">i18 support</a>.</td> 
             </tr> 
            </tbody>
           </table> 
          </div> 
          <div class="paragraph"> 
           <p>All of these rules could be inlined in your own base class; as we say, they are a convenience.</p> 
          </div> 
          <div class="paragraph"> 
           <p>The class also provides a number of injected domain services, notably <a href="../rgsvc/rgsvc.html#_rgsvc_persistence-layer-api_RepositoryService"><code>RepositoryService</code></a>, <a href="../rgsvc/rgsvc.html#_rgsvc_core-domain-api_FactoryService"><code>FactoryService</code></a>, <a href="../rgsvc/rgsvc.html#_rgsvc_metadata-api_ServiceRegistry"><code>ServiceRegistry2</code></a>, <a href="../rgsvc/rgsvc.html#_rgsvc_application-layer-api_WrapperFactory"><code>WrapperFactory</code></a> (to wrap objects simulating interaction through the user interface), <a href="../rgsvc/rgsvc.html#_rgsvc_application-layer-api_TransactionService"><code>TransactionService</code></a> (most commonly used to commit changes after the fixture setup) and <a href="../rgsvc/rgsvc.html#_rgsvc_application-layer-api_SessionManagementService"><code>SessionManagementService</code></a> (for tests that check interactions over multiple separate sessions).</p> 
          </div> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_ugtst_integ-test-support_configuration-properties">4.4. Configuration Properties</h3>
         <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
          <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_configuration-properties.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
          <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
          <ul class="dropdown-menu">
           <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_configuration-properties.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
           <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_configuration-properties.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
           <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_configuration-properties.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
           <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_configuration-properties.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
          </ul>
         </div> 
         <div class="paragraph"> 
          <p>The recommended way to run integration tests is against an HSQLDB in-memory database. This can be done using the application’s usual <a href="../rgcms/rgcms.html#_rgcms_classes_AppManifest-bootstrapping"><code>AppManifest</code></a>, and then overriding JDBC URL and similar.</p> 
         </div> 
         <div class="paragraph"> 
          <p>If inheriting from `IntegrationTestAbstract3’s then these configuration properties are set up automatically:</p> 
         </div> 
         <table class="tableblock frame-all grid-all spread"> 
          <caption class="title">
           Table 1. Default Configuration Properties for Integration Tests
          </caption> 
          <colgroup> 
           <col style="width: 33.3333%;"> 
           <col style="width: 16.6666%;"> 
           <col style="width: 50.0001%;"> 
          </colgroup> 
          <thead> 
           <tr> 
            <th class="tableblock halign-left valign-top">Property</th> 
            <th class="tableblock halign-left valign-top">Value</th> 
            <th class="tableblock halign-left valign-top">Description</th> 
           </tr> 
          </thead> 
          <tbody> 
           <tr> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p><code>isis.persistor.datanucleus.impl.</code><br> <code>javax.jdo.option.ConnectionURL</code></p> 
              </div>
             </div></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:hsqldb:mem:test</p></td> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p>JDBC URL</p> 
              </div>
             </div></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p><code>isis.persistor.datanucleus.impl.</code><br> <code>javax.jdo.option.ConnectionDriverName</code></p> 
              </div>
             </div></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">org.hsqldb.jdbcDriver</p></td> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p>JDBC Driver</p> 
              </div>
             </div></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p><code>isis.persistor.datanucleus.impl.</code><br> <code>javax.jdo.option.ConnectionUserName</code></p> 
              </div>
             </div></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">sa</p></td> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p>Username</p> 
              </div>
             </div></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p><code>isis.persistor.datanucleus.impl.</code><br> <code>javax.jdo.option.ConnectionPassword</code></p> 
              </div>
             </div></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">&lt;empty string&gt;</p></td> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p>Password, possibly encrypted (see <code>datanucleus.ConnectionPasswordEncrypter</code>, below).</p> 
              </div>
             </div></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p><code>isis.persistor.datanucleus.impl.</code><br> <code>datanucleus.ConnectionPasswordEncrypter</code></p> 
              </div>
             </div></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">&lt;empty string&gt;</p></td> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p>Specify the <code>datanucleus.ConnectionPasswordDecrypter</code> implementation used to decrypt the password.</p> 
              </div> 
              <div class="paragraph"> 
               <p>See the <a href="http://www.datanucleus.org/products/accessplatform_4_1/persistence_properties.html#ConnectionPasswordDecrypter">DataNucleus documentation</a> for further details.</p> 
              </div>
             </div></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p><code>isis.persistor.datanucleus.impl.</code><br> <code>datanucleus.schema.autoCreateAll</code></p> 
              </div>
             </div></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p>Recreate DB for each test run (an in-memory database)</p> 
              </div>
             </div></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p><code>isis.persistor.datanucleus.impl.</code><br> <code>datanucleus.schema.validateAll</code></p> 
              </div>
             </div></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p>Disable validations (minimize bootstrap time)</p> 
              </div>
             </div></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p><code>isis.persistor.datanucleus.impl.</code><br> <code>datanucleus.persistenceByReachabilityAtCommit</code></p> 
              </div>
             </div></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p>As per WEB-INF/persistor_datanucleus.properties</p> 
              </div>
             </div></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p><code>isis.persistor.datanucleus.impl.</code><br> <code>datanucleus.identifier.case</code></p> 
              </div>
             </div></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">MixedCase</p></td> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p>As per WEB-INF/persistor_datanucleus.properties</p> 
              </div>
             </div></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p><code>isis.persistor.datanucleus.impl.</code><br> <code>datanucleus.cache.level2.type</code></p> 
              </div>
             </div></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p>As per WEB-INF/persistor_datanucleus.properties</p> 
              </div>
             </div></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p><code>isis.persistor.datanucleus.impl.</code><br> <code>datanucleus.cache.level2.mode</code></p> 
              </div>
             </div></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">ENABLE_SELECTIVE</p></td> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p>As per WEB-INF/persistor_datanucleus.properties</p> 
              </div>
             </div></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p><code>isis.persistor.datanucleus.</code><br> <code>install-fixtures</code></p> 
              </div>
             </div></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p>Automatically install any fixtures that might have been registered</p> 
              </div>
             </div></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p><code>isis.persistor.</code><br> <code>enforceSafeSemantics</code></p> 
              </div>
             </div></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td> 
            <td class="tableblock halign-left valign-top">
             <div></div></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top">
             <div>
              <div class="paragraph"> 
               <p><code>isis.deploymentType</code></p> 
              </div>
             </div></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">server_prototype</p></td> 
            <td class="tableblock halign-left valign-top">
             <div></div></td> 
           </tr> 
          </tbody> 
         </table> 
        </div> 
        <div class="sect2"> 
         <h3 id="_ugtst_integ-test-support_wrapper-factory">4.5. Wrapper Factory</h3>
         <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
          <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_wrapper-factory.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
          <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
          <ul class="dropdown-menu">
           <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_wrapper-factory.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
           <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_wrapper-factory.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
           <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_wrapper-factory.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
           <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_wrapper-factory.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
          </ul>
         </div> 
         <div class="paragraph"> 
          <p>The <a href="../rgsvc/rgsvc.html#_rgsvc_application-layer-api_WrapperFactory"><code>WrapperFactory</code></a> service is responsible for wrapping a domain object in a dynamic proxy, of the same type as the object being proxied. And the role of this wrapper is to simulate the UI.</p> 
         </div> 
         <div class="admonitionblock note"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p><code>WrapperFactory</code> uses <a href="http://www.javassist.org">javassist</a> to perform its magic; this is the same technology that ORMs such as <a href="http://hibernate.org/">Hibernate</a> use to manage lazy loading/dirty tracking (DataNucleus uses a different mechanism).</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>It does this by allowing through method invocations that would be allowed if the user were interacting with the domain object through one of the viewers, but throwing an exception if the user attempts to interact with the domain object in a way that would not be possible if using the UI.</p> 
         </div> 
         <div class="paragraph"> 
          <p>The mechanics are as follows:</p> 
         </div> 
         <div class="olist arabic"> 
          <ol class="arabic"> 
           <li> <p>the integration test calls the <code>WrapperFactory</code> to obtain a wrapper for the domain object under test. This is usually done in the test’s <code>setUp()</code> method.</p> </li> 
           <li> <p>the test calls the methods on the wrapper rather than the domain object itself</p> </li> 
           <li> <p>the wrapper performs a reverse lookup from the method invoked (a regular <code>java.lang.reflect.Method</code> instance) into the Apache Isis metamodel</p> </li> 
           <li> <p>(like a viewer), the wrapper then performs the "see it/use it/do it" checks, checking that the member is visible, that it is enabled and (if there are arguments) that the arguments are valid</p> </li> 
           <li> <p>if the business rule checks pass, then the underlying member is invoked. Otherwise an exception is thrown.</p> </li> 
          </ol> 
         </div> 
         <div class="paragraph"> 
          <p>The type of exception depends upon what sort of check failed. It’s straightforward enough: if the member is invisible then a <code>HiddenException</code> is thrown; if it’s not usable then you’ll get a <code>DisabledException</code>, if the args are not valid then catch an <code>InvalidException</code>.</p> 
         </div> 
         <div class="imageblock"> 
          <div class="content"> 
           <a class="image" href="images/testing/wrapper-factory.png"><img src="images/testing/wrapper-factory.png" alt="wrapper factory" width="600px"></a> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Let’s look in a bit more detail at what the test can do with the wrapper.</p> 
         </div> 
         <div class="sect3"> 
          <h4 id="_wrapping_and_unwrapping">4.5.1. Wrapping and Unwrapping</h4> 
          <div class="paragraph"> 
           <p>Wrapping a domain object is very straightforward; simply call <code>WrapperFactory#wrap(…​)</code>.</p> 
          </div> 
          <div class="paragraph"> 
           <p>For example:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java">Customer customer = ...;
Customer wrappedCustomer = wrapperFactory.wrap(wrappedCustomer);</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>Going the other way — getting hold of the underlying (wrapped) domain object — is just as easy; just call <code>WrapperFactory#unwrap(…​)</code>.</p> 
          </div> 
          <div class="paragraph"> 
           <p>For example:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java">Customer wrappedCustomer = ...;
Customer customer = wrapperFactory.unwrap(wrappedCustomer);</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>If you prefer, you also can get the underlying object from the wrapper itself, by downcasting to <code>WrappingObject</code> and calling <code>__isis_wrapped()</code> method:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java">Customer wrappedCustomer = ...;
Customer customer = (Customer)((WrappingObject)wrappedCustomer).__isis_wrapped());</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>We’re not sure that’s any easier (in fact we’re certain it looks rather obscure). Stick with calling <code>unwrap(…​)</code>!</p> 
          </div> 
         </div> 
         <div class="sect3"> 
          <h4 id="_using_the_wrapper">4.5.2. Using the wrapper</h4> 
          <div class="paragraph"> 
           <p>As the wrapper is intended to simulate the UI, only those methods that correspond to the "primary" methods of the domain object’s members are allowed to be called. That means:</p> 
          </div> 
          <div class="ulist"> 
           <ul> 
            <li> <p>for <strong><em>object properties</em></strong> the test can call the getter or setter method</p> </li> 
            <li> <p>for <strong><em>object collections</em></strong> the test can call the getter.</p> 
             <div class="paragraph"> 
              <p>If there is a supporting <code>addTo…​()</code> or <code>removeFrom…​()</code> method, then these can be called. It can also call <code>add(…​)</code> or <code>remove(…​)</code> on the collection (returned by the gettter) itself.</p> 
             </div> 
             <div class="admonitionblock note"> 
              <table> 
               <tbody>
                <tr> 
                 <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> 
                 <td class="content"> 
                  <div class="paragraph"> 
                   <p>In this respect the wrapper is more functional than the <a href="../ugvw/ugvw.html">Wicket viewer</a> (which does not expose the ability to mutate collections directly).</p> 
                  </div> </td> 
                </tr> 
               </tbody>
              </table> 
             </div> </li> 
            <li> <p>for <strong><em>object actions</em></strong> the test can call the action method itself.</p> </li> 
           </ul> 
          </div> 
          <div class="paragraph"> 
           <p>As a convenience, we also allow the test to call any <code>default…​()</code>,<code>choices…​()</code> or <code>autoComplete…​()</code> method. These are often useful for obtaining a valid value to use.</p> 
          </div> 
          <div class="paragraph"> 
           <p>What the test can’t call is any of the remaining supporting methods, such as <code>hide…​()</code>, <code>disable…​()</code> or <code>validate…​()</code>. That’s because their value is implied by the exception being thrown.</p> 
          </div> 
          <div class="paragraph"> 
           <p>The wrapper <em>does</em> also allow the object’s <code>title()</code> method or its <code>toString()</code> , however this is little use for objects whose title is built up using the <code>@Title</code> annotation. Instead, we recommend that your test verifies an object’s title by calling <code>TitleService#titleOf(…​)</code> method.</p> 
          </div> 
         </div> 
         <div class="sect3"> 
          <h4 id="_firing_domain_events">4.5.3. Firing Domain Events</h4> 
          <div class="paragraph"> 
           <p>As well as enforcing business rules, the wrapper has another important feature, namely that it will cause domain events to be fired.</p> 
          </div> 
          <div class="paragraph"> 
           <p>For example, if we have an action annotated with <code>@Action(domainEvent=…​</code>):</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ToDoItem</span> ... {
    <span class="annotation">@Action</span>(
            domainEvent =CompletedEvent.class
    )
    <span class="directive">public</span> ToDoItem completed() { ... }
    ...
}</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>then invoking the action through the proxy will cause the event (<code>CompletedEvent</code> above) to be fired to any subscribers. A test might therefore look like:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> EventBusService eventBusService;                                          <i class="conum" data-value="1"></i><b>(1)</b>

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> subscriberReceivesEvents() <span class="directive">throws</span> <span class="exception">Exception</span> {

    <span class="comment">// given</span>
    <span class="directive">final</span> ToDoItem.CompletedEvent<span class="type">[]</span> evHolder = <span class="keyword">new</span> ToDoItem.CompletedEvent[<span class="integer">1</span>];    <i class="conum" data-value="2"></i><b>(2)</b>
    eventBusService.register(<span class="keyword">new</span> <span class="predefined-type">Object</span>() {
        <span class="annotation">@Subscribe</span>
        <span class="directive">public</span> <span class="type">void</span> on(<span class="directive">final</span> ToDoItem.CompletedEvent ev) {                        <i class="conum" data-value="3"></i><b>(3)</b>
            evHolder[<span class="integer">0</span>] = ev;
        }
    });

    <span class="comment">// when</span>
    toDoItem.completed();                                                         <i class="conum" data-value="4"></i><b>(4)</b>

    <span class="comment">// then</span>
    then(evHolder[<span class="integer">0</span>].getSource()).isEqualTo(unwrap(toDoItem));                    <i class="conum" data-value="5"></i><b>(5)</b>
    then(evHolder[<span class="integer">0</span>].getIdentifier().getMemberName()).isEqualTo(<span class="string"><span class="delimiter">"</span><span class="content">completed</span><span class="delimiter">"</span></span>);
}</code></pre> 
           </div> 
          </div> 
          <div class="colist arabic"> 
           <table> 
            <tbody>
             <tr> 
              <td><i class="conum" data-value="1"></i><b>1</b></td> 
              <td>inject <a href="../rgsvc/rgsvc.html#_rgsvc_core-domain-api_EventBusService"><code>EventBusService</code></a> into this test</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="2"></i><b>2</b></td> 
              <td>holder for subscriber to capture event to</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="3"></i><b>3</b></td> 
              <td>subscriber’s callback, using the guava subscriber syntax</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="4"></i><b>4</b></td> 
              <td>invoking the domain object using the wrapper</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="5"></i><b>5</b></td> 
              <td>assert that the event was populated</td> 
             </tr> 
            </tbody>
           </table> 
          </div> 
          <div class="paragraph"> 
           <p>The wrapper will also fire domain events for properties (if annotated with <code>@Property(domainEvent=…​)</code>) or collections (if annotated with <code>@Collection(domainEvent=…​)</code>).</p> 
          </div> 
          <div class="admonitionblock note"> 
           <table> 
            <tbody>
             <tr> 
              <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> 
              <td class="content"> 
               <div class="paragraph"> 
                <p>It isn’t possible to use the <code>WrapperFactory</code> in a unit test, because there needs to be a running instance of Apache Isis that holds the metamodel.</p> 
               </div> </td> 
             </tr> 
            </tbody>
           </table> 
          </div> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_ugtst_integ-test-support_maven-configuration">4.6. Maven Configuration</h3>
         <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
          <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_maven-configuration.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
          <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
          <ul class="dropdown-menu">
           <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_maven-configuration.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
           <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_maven-configuration.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
           <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_maven-configuration.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
           <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_integ-test-support_maven-configuration.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
          </ul>
         </div> 
         <div class="paragraph"> 
          <p>Apache Isis' integration test support is automatically configured if you use the <a href="../ugfun/ugfun.html#_ugfun_getting-started_simpleapp-archetype">SimpleApp archetype</a>. To set it up manually, update the <code>pom.xml</code> of your domain object model module:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.apache.isis.core<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>isis-core-integtestsupport<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.apache.isis.core<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>isis-core-wrapper<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="admonitionblock note"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>This can also be done by adding a dependency to <code>org.apache.isis.mavendeps:isis-mavendeps-testing</code> module; see the <a href="../ugfun/ugfun.html#_ugfun_getting-started_simpleapp-archetype">SimpleApp archetype</a>.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>We also recommend that you configure the <code>maven-surefire-plugin</code> to pick up the following class patterns:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.10<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;configuration&gt;</span>
        <span class="tag">&lt;includes&gt;</span>
            <span class="tag">&lt;include&gt;</span>**/*Test.java<span class="tag">&lt;/include&gt;</span>
            <span class="tag">&lt;include&gt;</span>**/*Test_*.java<span class="tag">&lt;/include&gt;</span>
            <span class="tag">&lt;include&gt;</span>**/*Spec*.java<span class="tag">&lt;/include&gt;</span>
        <span class="tag">&lt;/includes&gt;</span>
        <span class="tag">&lt;excludes&gt;</span>
            <span class="tag">&lt;exclude&gt;</span>**/Test*.java<span class="tag">&lt;/exclude&gt;</span>
            <span class="tag">&lt;exclude&gt;</span>**/*ForTesting.java<span class="tag">&lt;/exclude&gt;</span>
            <span class="tag">&lt;exclude&gt;</span>**/*Abstract*.java<span class="tag">&lt;/exclude&gt;</span>
        <span class="tag">&lt;/excludes&gt;</span>
        <span class="tag">&lt;useFile&gt;</span>true<span class="tag">&lt;/useFile&gt;</span>
        <span class="tag">&lt;printSummary&gt;</span>true<span class="tag">&lt;/printSummary&gt;</span>
        <span class="tag">&lt;outputDirectory&gt;</span>${project.build.directory}/surefire-reports<span class="tag">&lt;/outputDirectory&gt;</span>
    <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="admonitionblock note"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>This can also be done using mavenmixins; see the <a href="../ugfun/ugfun.html#_ugfun_getting-started_simpleapp-archetype">SimpleApp archetype</a>.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect1"> 
       <h2 id="_ugtst_bdd-spec-support">5. BDD Spec Support</h2>
       <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
        <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_bdd-spec-support.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
        <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
        <ul class="dropdown-menu">
         <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_bdd-spec-support.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
         <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_bdd-spec-support.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
         <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_bdd-spec-support.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
         <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_bdd-spec-support.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
        </ul>
       </div> 
       <div class="sectionbody"> 
        <div class="paragraph"> 
         <p><a href="http://en.wikipedia.org/wiki/Behavior-driven_development">Behaviour-driven design</a> (BDD) redefines testing not as an after-the-fact "let’s check the system works", but rather as a means to work with the domain expert to (a) specify the behaviour of the feature <em>before</em> starting implementation, and (b) provide a means that the domain expert can verify the feature after it has been implemented.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Since domain experts are usually non-technical (at least, they are unlikely to be able to read or want to learn how to read JUnit/Java code), then applying BDD typically requires writing specifications in using structured English text and (ASCII) tables. The BDD tooling parses this text and uses it to actually interact with the system under test. As a byproduct the BDD frameworks generate readable output of some form; this is often an annotated version of the original specification, marked up to indicate which specifications passed, which have failed. This readable output is a form of "living documentation"; it captures the actual behaviour of the system, and so is guaranteed to be accurate.</p> 
        </div> 
        <div class="paragraph"> 
         <p>There are many BDD tools out there; Apache Isis provides an integration with <a href="https://cucumber.io/docs/reference/jvm#java">Cucumber JVM</a> (see also the <a href="https://github.com/cucumber/cucumber-jvm">github site</a>):</p> 
        </div> 
        <div class="sect2"> 
         <h3 id="_ugtst_bdd-spec-support_how-it-works">5.1. How it works</h3>
         <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
          <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_bdd-spec-support_how-it-works.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
          <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
          <ul class="dropdown-menu">
           <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_bdd-spec-support_how-it-works.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
           <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_bdd-spec-support_how-it-works.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
           <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_bdd-spec-support_how-it-works.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
           <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_bdd-spec-support_how-it-works.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
          </ul>
         </div> 
         <div class="paragraph"> 
          <p>At a high level, here’s how Cucumber works</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>specifications are written in the <a href="https://github.com/cucumber/cucumber/wiki/Gherkin">Gherkin</a> DSL, following the <a href="https://github.com/cucumber/cucumber/wiki/Given-When-Then">"given/when/then"</a> format.</p> </li> 
           <li> <p>Cucumber-JVM itself is a JUnit runner, and searches for <a href="https://github.com/cucumber/cucumber/wiki/Feature-Introduction">feature files</a> on the classpath.</p> </li> 
           <li> <p>These in turn are matched to <a href="https://github.com/cucumber/cucumber/wiki/Step-Definitions">step definition</a>s through regular expressions.<br></p> 
            <div class="paragraph"> 
             <p>It is the step definitions (the "glue") that exercise the system.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>The code that goes in step definitions is broadly the same as the code that goes in an integration test method. One benefit of using step definitions (rather than integration tests) is that the step definitions are reusable across scenarios, so there may be less code overall to maintain. For example, if you have a step definition that maps to "given an uncompleted todo item", then this can be used for all the scenarios that start with that as their precondition.</p> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_ugtst_bdd-spec-support_writing-a-bdd-spec">5.2. Writing a BDD spec</h3>
         <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
          <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_bdd-spec-support_writing-a-bdd-spec.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
          <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
          <ul class="dropdown-menu">
           <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_bdd-spec-support_writing-a-bdd-spec.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
           <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_bdd-spec-support_writing-a-bdd-spec.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
           <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_bdd-spec-support_writing-a-bdd-spec.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
           <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_bdd-spec-support_writing-a-bdd-spec.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
          </ul>
         </div> 
         <div class="paragraph"> 
          <p>BDD specifications contain:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>a <code>XxxSpec.feature</code> file, describing the feature and the scenarios (given/when/then)s that constitute its acceptance criteria</p> </li> 
           <li> <p>a <code>RunSpecs.java</code> class file to run the specification (all boilerplate). This will run all <code>.feature</code> files in the same package or subpackages.</p> </li> 
           <li> <p>one or several <code>XxxGlue</code> constituting the step definitions to be matched against.<br></p> 
            <div class="paragraph"> 
             <p>The "glue" (step definitions) are intended to be reused across features. We therefore recommend that they reside in a separate package, and are organized by the entity type upon which they act.<br></p> 
            </div> 
            <div class="paragraph"> 
             <p>For example, given a feature that involves <code>Customer</code> and <code>Order</code>, have the step definitions pertaining to <code>Customer</code> reside in <code>CustomerGlue</code>, and the step definitions pertaining to <code>Order</code> reside in <code>OrderGlue</code>.<br></p> 
            </div> 
            <div class="paragraph"> 
             <p>The <code>glue</code> attribute of the Cucumber-JVM JUnit runner allows you to indicate which package(s) should be recursively searched to find any glue.</p> 
            </div> 
            <div class="paragraph"> 
             <p>There also needs to be one glue class that is used to bootstrap the runtime.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Here’s an example of a feature from the <a href="../ugfun/ugfun.html#_ugfun_getting-started_simpleapp-archetype">SimpleApp archetype</a>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainAppDemo</span>
Feature: <span class="predefined-type">List</span> and Create New Simple Objects

  Scenario: Existing simple objects can be listed and <span class="keyword">new</span> ones created
    Given there are initially <span class="integer">10</span> simple objects
    When  I create a <span class="keyword">new</span> simple object
    Then  there are <span class="integer">11</span> simple objects</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The "@DomainAppDemo" is a custom tag we’ve specified to indicate the prerequisite fixtures to be loaded; more on this in a moment.</p> 
         </div> 
         <div class="admonitionblock important"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-important" title="Important"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>BDD specs are assumed to run only as integration tests.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>The <code>RunBddSpecs</code> class to run this feature (and any other features in this package or subpackages) is just boilerplate</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(Cucumber.class)
<span class="annotation">@CucumberOptions</span>(
        format = {
                <span class="string"><span class="delimiter">"</span><span class="content">html:target/cucumber-html-report</span><span class="delimiter">"</span></span>
                ,<span class="string"><span class="delimiter">"</span><span class="content">json:target/cucumber.json</span><span class="delimiter">"</span></span>
        },
        glue={
                <span class="string"><span class="delimiter">"</span><span class="content">classpath:domainapp.application.bdd.specglue</span><span class="delimiter">"</span></span>,
                <span class="string"><span class="delimiter">"</span><span class="content">classpath:domainapp.modules.simple.specglue</span><span class="delimiter">"</span></span>
        },
        strict = <span class="predefined-constant">true</span>,
        tags = { <span class="string"><span class="delimiter">"</span><span class="content">~@backlog</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">~@ignore</span><span class="delimiter">"</span></span> }
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">RunBddSpecs</span> {
    <span class="comment">// intentionally empty</span>
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>The JSON formatter allows integration with enhanced reports. (Commented out) configuration for this is provided in the <a href="../ugfun/ugfun.html#_ugfun_getting-started_simpleapp-archetype">SimpleApp archetype</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>The bootstrapping of Apache Isis itself lives in a <code>BootstrappingGlue</code> step definition:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">BootstrappingGlue</span>
                <span class="directive">extends</span> HeadlessWithBootstrappingAbstract { <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="directive">public</span> BootstrappingGlue() {
        <span class="local-variable">super</span>(<span class="keyword">new</span> DomainAppApplicationModule());            <i class="conum" data-value="2"></i><b>(2)</b>
    }

    <span class="annotation">@Before</span>(order=<span class="integer">100</span>)                                      <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="directive">public</span> <span class="type">void</span> beforeScenario() {
        <span class="local-variable">super</span>.bootstrapAndSetupIfRequired();
    }
    <span class="annotation">@After</span>
    <span class="directive">public</span> <span class="type">void</span> afterScenario(cucumber.api.Scenario sc) {
        <span class="local-variable">super</span>.tearDownAllModules();
    }
}</code></pre> 
          </div> 
         </div> 
         <div class="colist arabic"> 
          <table> 
           <tbody>
            <tr> 
             <td><i class="conum" data-value="1"></i><b>1</b></td> 
             <td>superclass contains much of the bootstrapping logic (and is also used by the integration testing framework)</td> 
            </tr> 
            <tr> 
             <td><i class="conum" data-value="2"></i><b>2</b></td> 
             <td>the <code>Module</code> to use to bootstrap the application in headless mode.</td> 
            </tr> 
            <tr> 
             <td><i class="conum" data-value="3"></i><b>3</b></td> 
             <td>remainder of the class is just boilerplate.</td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="admonitionblock note"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>For BDD specs, the <code>CukeGlueBootstrappingAbstract</code> was previously provided (as a BDD counterpart to <code>IntegrationTestAbstract3</code>) to perform the relevant bootstrapping. <em>However</em>, it turns out that Cucumber does not allow subclassing of BDD specs. Therefore the bootstrapping boilerplate (that ideally would have been factored out into an abstract superclass) must be included within the BDD spec.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>The fixture to run also lives in its own step definition, <code>CatalogOfFixturesGlue</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CatalogOfFixturesGlue</span> <span class="directive">extends</span> CukeGlueAbstract2 {
    <span class="annotation">@Before</span>(value={<span class="string"><span class="delimiter">"</span><span class="content">@DomainAppDemo</span><span class="delimiter">"</span></span>}, order=<span class="integer">20000</span>)
    <span class="directive">public</span> <span class="type">void</span> runDomainAppDemo() {
        fixtureScripts.runFixtureScript(<span class="keyword">new</span> DomainAppDemo(), <span class="predefined-constant">null</span>); <i class="conum" data-value="1"></i><b>(1)</b>
    }
}</code></pre> 
          </div> 
         </div> 
         <div class="colist arabic"> 
          <table> 
           <tbody>
            <tr> 
             <td><i class="conum" data-value="1"></i><b>1</b></td> 
             <td>The <code>fixtureScripts</code> service is inherited from the superclass.</td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>This will only activate for feature files tagged with "@DomainAppDemo".</p> 
         </div> 
         <div class="paragraph"> 
          <p>Finally, the step definitions pertaining to <code>SimpleObject</code> domain entity then reside in the <code>SimpleObjectGlue</code> class. This is where the heavy lifting gets done:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleObjectMenuGlue</span> <span class="directive">extends</span> CukeGlueAbstract2 {

    <span class="annotation">@Given</span>(<span class="string"><span class="delimiter">"</span><span class="content">^there are.* (</span><span class="char">\\</span><span class="content">d+) simple objects$</span><span class="delimiter">"</span></span>)                           <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="type">void</span> there_are_N_simple_objects(<span class="type">int</span> n) <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
        <span class="directive">final</span> <span class="predefined-type">List</span>&lt;SimpleObject&gt; list = wrap(simpleObjectMenu).listAll();   <i class="conum" data-value="2"></i><b>(2)</b>
        assertThat(list.size(), is(n));
    }

    <span class="annotation">@When</span>(<span class="string"><span class="delimiter">"</span><span class="content">^.*create a .*simple object$</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> create_a_simple_object() <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
        wrap(simpleObjectMenu).create(<span class="predefined-type">UUID</span>.randomUUID().toString());
    }

    <span class="annotation">@Inject</span>
    SimpleObjectMenu simpleObjectMenu;                                      <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre> 
          </div> 
         </div> 
         <div class="colist arabic"> 
          <table> 
           <tbody>
            <tr> 
             <td><i class="conum" data-value="1"></i><b>1</b></td> 
             <td>regex to match to feature file specification</td> 
            </tr> 
            <tr> 
             <td><i class="conum" data-value="2"></i><b>2</b></td> 
             <td>the inherited <code>wrap(…​)</code> method delegates to <code>WrapperFactory#wrap(…​)</code></td> 
            </tr> 
            <tr> 
             <td><i class="conum" data-value="3"></i><b>3</b></td> 
             <td>injected in the usual way</td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="admonitionblock tip"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>The <a href="../rgsvc/rgsvc.html#_rgsvc_core-domain-api_Scratchpad"><code>Scratchpad</code></a> domain service is one way in which glue classes can pass state between each other. Or, for more type safety, you could develop your own custom domain services for each scenario, and inject these in as regular services. See <a href="http://www.thinkcode.se/blog/2017/04/01/sharing-state-between-steps-in-cucumberjvm-using-picocontainer">this blog</a> post for more details.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="admonitionblock tip"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>If using Java 8, note that Cucumber JVM supports a <a href="https://cucumber.io/docs/reference/jvm#java-8-lambdas">simplified syntax using lambdas</a>.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_ugtst_bdd-spec-support_maven-configuration">5.3. Maven Configuration</h3>
         <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
          <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_bdd-spec-support_maven-configuration.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
          <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
          <ul class="dropdown-menu">
           <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_bdd-spec-support_maven-configuration.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
           <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_bdd-spec-support_maven-configuration.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
           <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_bdd-spec-support_maven-configuration.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
           <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_bdd-spec-support_maven-configuration.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
          </ul>
         </div> 
         <div class="paragraph"> 
          <p>Apache Isis' BDD spec support is automatically configured if you use the <a href="../ugfun/ugfun.html#_ugfun_getting-started_simpleapp-archetype">SimpleApp archetype</a>. To set it up manually, update the <code>pom.xml</code> of your domain object model module:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.apache.isis.core<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>isis-core-specsupport<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tag">&lt;/dependency&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="colist arabic"> 
          <table> 
           <tbody>
            <tr> 
             <td><i class="conum" data-value="1"></i><b>1</b></td> 
             <td>Normally <code>test</code>; usual Maven scoping rules apply.</td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>The configuration is wrapped up as maven mixins:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugins&gt;</span>
    <span class="tag">&lt;plugin&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>com.github.odavid.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>mixin-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>0.1-alpha-39<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;extensions&gt;</span>true<span class="tag">&lt;/extensions&gt;</span>
        <span class="tag">&lt;configuration&gt;</span>
            <span class="tag">&lt;mixins&gt;</span>
                ...
                <span class="tag">&lt;mixin&gt;</span>
                    <span class="tag">&lt;groupId&gt;</span>com.danhaywood.mavenmixin<span class="tag">&lt;/groupId&gt;</span>
                    <span class="tag">&lt;artifactId&gt;</span>surefire<span class="tag">&lt;/artifactId&gt;</span>
                <span class="tag">&lt;/mixin&gt;</span>
                <span class="tag">&lt;mixin&gt;</span>
                    <span class="tag">&lt;groupId&gt;</span>com.danhaywood.mavenmixin<span class="tag">&lt;/groupId&gt;</span>
                    <span class="tag">&lt;artifactId&gt;</span>cucumberreporting<span class="tag">&lt;/artifactId&gt;</span>
                <span class="tag">&lt;/mixin&gt;</span>
            <span class="tag">&lt;/mixins&gt;</span>
        <span class="tag">&lt;/configuration&gt;</span>
    <span class="tag">&lt;/plugin&gt;</span>
<span class="tag">&lt;/plugins&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>You may also find it more convenient to place the <code>.feature</code> files in <code>src/test/java</code>, rather than <code>src/test/resources</code>. If you wish to do this, then your integtest module’s <code>pom.xml</code> must contain:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;build&gt;</span>
    <span class="tag">&lt;testResources&gt;</span>
        <span class="tag">&lt;testResource&gt;</span>
            <span class="tag">&lt;filtering&gt;</span>false<span class="tag">&lt;/filtering&gt;</span>
            <span class="tag">&lt;directory&gt;</span>src/test/resources<span class="tag">&lt;/directory&gt;</span>
        <span class="tag">&lt;/testResource&gt;</span>
        <span class="tag">&lt;testResource&gt;</span>
            <span class="tag">&lt;filtering&gt;</span>false<span class="tag">&lt;/filtering&gt;</span>
            <span class="tag">&lt;directory&gt;</span>src/test/java<span class="tag">&lt;/directory&gt;</span>
            <span class="tag">&lt;includes&gt;</span>
                <span class="tag">&lt;include&gt;</span>**<span class="tag">&lt;/include&gt;</span>
            <span class="tag">&lt;/includes&gt;</span>
            <span class="tag">&lt;excludes&gt;</span>
                <span class="tag">&lt;exclude&gt;</span>**/*.java<span class="tag">&lt;/exclude&gt;</span>
            <span class="tag">&lt;/excludes&gt;</span>
        <span class="tag">&lt;/testResource&gt;</span>
    <span class="tag">&lt;/testResources&gt;</span>
<span class="tag">&lt;/build&gt;</span></code></pre> 
          </div> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect1"> 
       <h2 id="_ugtst_fixture-scripts">6. Fixture Scripts</h2>
       <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
        <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
        <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
        <ul class="dropdown-menu">
         <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
         <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
         <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
         <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
        </ul>
       </div> 
       <div class="sectionbody"> 
        <div class="paragraph"> 
         <p>When writing integration tests (and implementing the glue for BDD specs) it can be difficult to keep the "given" short; there could be a lot of prerequisite data that needs to exist before you can actually exercise your system. Moreover, however we do set up that data, but we also want to do so in a way that is resilient to the system changing over time.</p> 
        </div> 
        <div class="paragraph"> 
         <p>On a very simple system you could probably get away with using SQL to insert directly into the database, or you could use a toolkit such as <a href="http://dbunit.sourceforge.net/howto.html">dbunit</a> to upload data from flat files. Such approaches aren’t particularly maintainable though. If in the future the domain entities (and therefore corresponding database tables) change their structure, then all of those data sets will need updating.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Even more significantly, there’s no way to guarantee that the data that’s being loaded is logically consistent with the business behaviour of the domain objects themselves. That is, there’s nothing to stop your test from putting data into the database that would be invalid if one attempted to add it through the app.</p> 
        </div> 
        <div class="paragraph"> 
         <p>The solution that Apache Isis provides is a small library called <strong><em>fixture scripts</em></strong>. A fixture script is basically a command object for executing arbitrary work, where the work in question is almost always invoking one or more business actions. In other words, the database is populating through the functionality of the domain object model itself.</p> 
        </div> 
        <div class="admonitionblock tip"> 
         <table> 
          <tbody>
           <tr> 
            <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> 
            <td class="content"> 
             <div class="paragraph"> 
              <p>If you want to learn more on this topic (with live coding!), check out this <a href="https://skillsmatter.com/skillscasts/5638-to-those-whom-much-is-given-much-is-expected">presentation</a> given at BDD Exchange 2014.</p> 
             </div> </td> 
           </tr> 
          </tbody>
         </table> 
        </div> 
        <div class="paragraph"> 
         <p>There is another benefit to Apache Isis' fixture script approach; the fixtures can be (in prototyping mode) run from your application. This means that fixture scripts can actually help all the way through the development lifecycle:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>when specifying a new feature, you can write a fixture script to get the system into the "given" state, and then start exploring the required functionality with the domain expert actually <em>within</em> the application<br></p> 
           <div class="paragraph"> 
            <p>And if you can’t write a fixture script for the story, it probably means that there’s some prerequisite feature that needs implementing that you hadn’t previously recognized</p> 
           </div> </li> 
          <li> <p>when the developer implements the story, s/he has a precanned script to run when they manually verify the functionality works</p> </li> 
          <li> <p>when the developer automates the story’s acceptance test as an integration test, they already have the "given" part of the test implemented</p> </li> 
          <li> <p>when you want to pass the feature over to the QA/tester for additional manual exploratory testing, they have a fixture script to get them to a jumping off point for their explorations</p> </li> 
          <li> <p>when you want to demonstrate the implemented feature to your domain expert, your demo can use the fixture script so you don’t bore your audience in performing lots of boring setup before getting to the actual feature</p> </li> 
          <li> <p>when you want to roll out training to your users, you can write fixture scripts as part of their training exercises</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>The following sections explain the API and how to go about using the API.</p> 
        </div> 
        <div class="sect2"> 
         <h3 id="_ugtst_fixture-scripts_api-and-usage">6.1. API and Usage</h3>
         <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
          <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
          <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
          <ul class="dropdown-menu">
           <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
           <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
           <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
           <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
          </ul>
         </div> 
         <div class="paragraph"> 
          <p>There are two main parts to using fixture scripts: the <code>FixtureScripts</code> domain service class, and the <code>FixtureScript</code> view model class:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>The role of the <code>FixtureScripts</code> domain service is to locate all fixture scripts from the classpath and to let them be invoked, either from an integration test/BDD spec or from the UI of your Isis app.</p> </li> 
           <li> <p>The role of <code>FixtureScript</code> meanwhile is to subclass for each of the scenarios that you want to define. You can also subclass from <code>FixtureScript</code> to create helpers; more on this below.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Let’s look at <code>FixtureScripts</code> domain service in more detail first.</p> 
         </div> 
         <div class="sect3"> 
          <h4 id="_ugtst_fixture-scripts_api-and-usage_FixtureScripts">6.1.1. <code>FixtureScripts</code></h4>
          <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
           <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage_FixtureScripts.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
           <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
           <ul class="dropdown-menu">
            <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage_FixtureScripts.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
            <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage_FixtureScripts.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
            <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage_FixtureScripts.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
            <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage_FixtureScripts.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
           </ul>
          </div> 
          <div class="paragraph"> 
           <p>The framework provides a default implementation of <code>FixtureScripts</code> domain service, namely the <a href="../rgsvc/rgsvc.html#_rgsvc_testing_FixtureScripts"><code>FixtureScriptsDefault</code></a> domain service. This is annotated to be rendered on the secondary "Prototyping" menu.</p> 
          </div> 
          <div class="paragraph"> 
           <p>The behaviour of this domain menu service can be refined by providing an implementation of the optional <a href="../rgsvc/rgsvc.html#_rgsvc_testing_FixtureScriptsSpecificationProvider"><code>FixtureScriptsSpecificationProvider</code></a> SPI.</p> 
          </div> 
          <div class="paragraph"> 
           <p>For example, here’s the <code>FixtureScriptsSpecificationProvider</code> service that’s generated by the <a href="../ugfun/ugfun.html#_ugfun_getting-started_simpleapp-archetype">SimpleApp archetype</a>:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DomainService</span>( nature = NatureOfService.DOMAIN )
<span class="directive">public</span> <span class="type">class</span> <span class="class">DomainAppFixtureScriptsSpecificationProvider</span>
                    <span class="directive">implements</span> FixtureScriptsSpecificationProvider {
    <span class="directive">public</span> FixtureScriptsSpecification getSpecification() {
        <span class="keyword">return</span> FixtureScriptsSpecification
            .builder(DomainAppFixtureScriptsSpecificationProvider.class)               <i class="conum" data-value="1"></i><b>(1)</b>
            .with(FixtureScripts.MultipleExecutionStrategy.EXECUTE)                    <i class="conum" data-value="2"></i><b>(2)</b>
            .withRunScriptDefault(DomainAppDemo.class)                                 <i class="conum" data-value="3"></i><b>(3)</b>
            .withRunScriptDropDown(FixtureScriptsSpecification.DropDownPolicy.CHOICES) <i class="conum" data-value="4"></i><b>(4)</b>
            .withRecreate(DomainAppDemo.class)                                         <i class="conum" data-value="5"></i><b>(5)</b>
            .build();
    }
}</code></pre> 
           </div> 
          </div> 
          <div class="colist arabic"> 
           <table> 
            <tbody>
             <tr> 
              <td><i class="conum" data-value="1"></i><b>1</b></td> 
              <td>search for all fixture scripts under the package containing this class</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="2"></i><b>2</b></td> 
              <td>if the same fixture script (class) is encountered more than once, then run anyway; more on this in <a href="../ugtst/ugtst.html#__ugtst_fixture-scripts_api-and-usage_organizing">Organizing Fixture scripts</a>], below.</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="3"></i><b>3</b></td> 
              <td>specify the fixture script class to provide as the default for the service’s "run fixture script" action</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="4"></i><b>4</b></td> 
              <td>whether the service’s "run fixture script" action should display other fixture scripts using a choices drop down or (if there are very many of them) using an auto-complete</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="5"></i><b>5</b></td> 
              <td>if present, enables a "recreate objects and return first" action to be displayed in the UI</td> 
             </tr> 
            </tbody>
           </table> 
          </div> 
          <div class="paragraph"> 
           <p>Here’s how the domain service looks like in the UI:</p> 
          </div> 
          <div class="imageblock"> 
           <div class="content"> 
            <a class="image" href="images/testing/fixture-scripts/prototyping-menu.png"><img src="images/testing/fixture-scripts/prototyping-menu.png" alt="prototyping menu" width="700px"></a> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>and here’s what the <code>runFixtureScript</code> action prompt looks like:</p> 
          </div> 
          <div class="imageblock"> 
           <div class="content"> 
            <a class="image" href="images/testing/fixture-scripts/prompt.png"><img src="images/testing/fixture-scripts/prompt.png" alt="prompt" width="700px"></a> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>when this is executed, the resultant objects (actually, instances of FixtureResult`) are shown in the UI:</p> 
          </div> 
          <div class="imageblock"> 
           <div class="content"> 
            <a class="image" href="images/testing/fixture-scripts/result-list.png"><img src="images/testing/fixture-scripts/result-list.png" alt="result list" width="700px"></a> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>If you had defined many fixture scripts then a drop-down might become unwieldy, in which case your code would probably override the <code>autoComplete…​())</code> instead:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;FixtureScript&gt; autoComplete0RunFixtureScript(<span class="directive">final</span> <span class="annotation">@MinLength</span>(<span class="integer">1</span>) <span class="predefined-type">String</span> searchArg) {
        <span class="keyword">return</span> <span class="local-variable">super</span>.autoComplete0RunFixtureScript(searchArg);
    }</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>You are free, of course, to add additional "convenience" actions into it if you wish for the most commonly used/demo’d setups ; you’ll find that the <a href="../ugfun/ugfun.html#_ugfun_getting-started_simpleapp-archetype">SimpleApp archetype</a> adds this additional action:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Action</span>(
            restrictTo = RestrictTo.PROTOTYPING
    )
    <span class="annotation">@ActionLayout</span>(
            cssClassFa=<span class="string"><span class="delimiter">"</span><span class="content">fa fa-refresh</span><span class="delimiter">"</span></span>
    )
    <span class="annotation">@MemberOrder</span>(sequence=<span class="string"><span class="delimiter">"</span><span class="content">20</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="predefined-type">Object</span> recreateObjectsAndReturnFirst() {
        <span class="directive">final</span> <span class="predefined-type">List</span>&lt;FixtureResult&gt; run = findFixtureScriptFor(RecreateSimpleObjects.class).run(<span class="predefined-constant">null</span>);
        <span class="keyword">return</span> run.get(<span class="integer">0</span>).getObject();
    }</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>Let’s now look at the <code>FixtureScript</code> class, where there’s a bit more going on.</p> 
          </div> 
         </div> 
         <div class="sect3"> 
          <h4 id="_ugtst_fixture-scripts_api-and-usage_FixtureScript">6.1.2. <code>FixtureScript</code></h4>
          <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
           <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage_FixtureScript.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
           <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
           <ul class="dropdown-menu">
            <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage_FixtureScript.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
            <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage_FixtureScript.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
            <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage_FixtureScript.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
            <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage_FixtureScript.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
           </ul>
          </div> 
          <div class="paragraph"> 
           <p>A fixture script is ultimately just a block of code that can be executed, so it’s up to you how you implement it to set up the system. However, we strongly recommend that you use it to invoke actions on business objects, in essence to replay what a real-life user would have done. That way, the fixture script will remain valid even if the underlying implementation of the system changes in the future.</p> 
          </div> 
          <div class="paragraph"> 
           <p>For example, here’s a fixture script called <code>RecreateSimpleObjects</code>. (This used to be part of the <a href="../ugfun/ugfun.html#_ugfun_getting-started_simpleapp-archetype">SimpleApp archetype</a>, though the archetype now ships with a more sophisticated design, discussed below):</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@lombok</span>.Accessors(chain = <span class="predefined-constant">true</span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">RecreateSimpleObjects</span> <span class="directive">extends</span> FixtureScript {                   <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="directive">public</span> <span class="directive">final</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; NAMES = <span class="predefined-type">Collections</span>.unmodifiableList(<span class="predefined-type">Arrays</span>.asList(
            <span class="string"><span class="delimiter">"</span><span class="content">Foo</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Bar</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Baz</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Frodo</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Froyo</span><span class="delimiter">"</span></span>,
            <span class="string"><span class="delimiter">"</span><span class="content">Fizz</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Bip</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Bop</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Bang</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Boo</span><span class="delimiter">"</span></span>));                           <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> RecreateSimpleObjects() {
        withDiscoverability(Discoverability.DISCOVERABLE);                   <i class="conum" data-value="3"></i><b>(3)</b>
    }

    <span class="annotation">@lombok</span>.Getter <span class="annotation">@lombok</span>.Setter
    <span class="directive">private</span> <span class="predefined-type">Integer</span> number;                                                  <i class="conum" data-value="4"></i><b>(4)</b>

    <span class="annotation">@lombok</span>.Getter
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">List</span>&lt;SimpleObject&gt; simpleObjects = Lists.newArrayList();   <i class="conum" data-value="5"></i><b>(5)</b>

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> execute(<span class="directive">final</span> ExecutionContext ec) {          <i class="conum" data-value="6"></i><b>(6)</b>
        <span class="comment">// defaults</span>
        <span class="directive">final</span> <span class="type">int</span> number = defaultParam(<span class="string"><span class="delimiter">"</span><span class="content">number</span><span class="delimiter">"</span></span>, ec, <span class="integer">3</span>);        <i class="conum" data-value="7"></i><b>(7)</b>
        <span class="comment">// validate</span>
        <span class="keyword">if</span>(number &lt; <span class="integer">0</span> || number &gt; NAMES.size()) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(
                <span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">"</span><span class="content">number must be in range [0,%d)</span><span class="delimiter">"</span></span>, NAMES.size()));
        }
        <span class="comment">// execute</span>
        ec.executeChild(<span class="local-variable">this</span>, <span class="keyword">new</span> SimpleObjectsTearDown());      <i class="conum" data-value="8"></i><b>(8)</b>
        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; number; i++) {
            <span class="directive">final</span> SimpleObjectCreate fs =
                <span class="keyword">new</span> SimpleObjectCreate().setName(NAMES.get(i));
            ec.executeChild(<span class="local-variable">this</span>, fs.getName(), fs);             <i class="conum" data-value="9"></i><b>(9)</b>
            simpleObjects.add(fs.getSimpleObject());             <i class="conum" data-value="10"></i><b>(10)</b>
        }
    }
}</code></pre> 
           </div> 
          </div> 
          <div class="colist arabic"> 
           <table> 
            <tbody>
             <tr> 
              <td><i class="conum" data-value="1"></i><b>1</b></td> 
              <td>inherit from <code>org.apache.isis.applib.fixturescripts.FixtureScript</code></td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="2"></i><b>2</b></td> 
              <td>a hard-coded list of values for the names. Note that the (non-ASF) <a href="http://platform.incode.org" target="_blank" rel="noopener">Incode Platform</a>'s fakedata module could also have been used</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="3"></i><b>3</b></td> 
              <td>whether the script is "discoverable"; in other words whether it should be rendered in the drop-down by the <code>FixtureScripts</code> service</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="4"></i><b>4</b></td> 
              <td>input property: the number of objects to create, up to 10; for the calling test to specify, but note this is optional and has a default (see below). It’s important that a wrapper class is used (ie <code>java.lang.Integer</code>, not <code>int</code>)</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="5"></i><b>5</b></td> 
              <td>output property: the generated list of objects, for the calling test to grab</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="6"></i><b>6</b></td> 
              <td>the mandatory execute(…​) API</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="7"></i><b>7</b></td> 
              <td>the <code>defaultParam(…​)</code> (inherited from <code>FixtureScript</code>) will default the <code>number</code> property (using Java’s Reflection API) if none was specified</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="8"></i><b>8</b></td> 
              <td>call another fixture script (<code>SimpleObjectsTearDown</code>) using the provided <code>ExecutionContext</code>. Note that although the fixture script is a view model, it’s fine to simply instantiate it (rather than using <code>FactoryService#instantiate(…​)</code>).</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="9"></i><b>9</b></td> 
              <td>calling another fixture script (<code>SimpleObjectCreate</code>) using the provided <code>ExecutionContext</code></td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="10"></i><b>10</b></td> 
              <td>adding the created object to the list, for the calling object to use.</td> 
             </tr> 
            </tbody>
           </table> 
          </div> 
          <div class="paragraph"> 
           <p>Because this script has exposed a "number" property, it’s possible to set this from within the UI. For example:</p> 
          </div> 
          <div class="imageblock"> 
           <div class="content"> 
            <a class="image" href="images/testing/fixture-scripts/prompt-specifying-number.png"><img src="images/testing/fixture-scripts/prompt-specifying-number.png" alt="prompt specifying number" width="700px"></a> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>When this is executed, the framework will parse the text and attempt to reflectively set the corresponding properties on the fixture result. So, in this case, when the fixture script is executed we actually get 6 objects created.</p> 
          </div> 
         </div> 
         <div class="sect3"> 
          <h4 id="_ugtst_fixture-scripts_api-and-usage_using-within-tests">6.1.3. Using within Tests</h4>
          <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
           <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage_using-within-tests.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
           <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
           <ul class="dropdown-menu">
            <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage_using-within-tests.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
            <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage_using-within-tests.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
            <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage_using-within-tests.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
            <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage_using-within-tests.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
           </ul>
          </div> 
          <div class="paragraph"> 
           <p>Fixture scripts can be called from integration tests just the same way that fixture scripts can call one another.</p> 
          </div> 
          <div class="paragraph"> 
           <p>For example, here’s an integration test from the <a href="../ugfun/ugfun.html#_ugfun_getting-started_simpleapp-archetype">SimpleApp archetype</a>:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleObjectIntegTest</span> <span class="directive">extends</span> SimpleAppIntegTest {
    SimpleObject simpleObjectWrapped;
    <span class="annotation">@Before</span>
    <span class="directive">public</span> <span class="type">void</span> setUp() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="comment">// given</span>
        RecreateSimpleObjects fs =
             <span class="keyword">new</span> RecreateSimpleObjects().setNumber(<span class="integer">1</span>);  <i class="conum" data-value="1"></i><b>(1)</b>
        fixtureScripts.runFixtureScript(fs, <span class="predefined-constant">null</span>);      <i class="conum" data-value="2"></i><b>(2)</b>

        SimpleObject simpleObjectPojo =
            fs.getSimpleObjects().get(<span class="integer">0</span>);               <i class="conum" data-value="3"></i><b>(3)</b>
        assertThat(simpleObjectPojo).isNotNull();

        simpleObjectWrapped = wrap(simpleObjectPojo);   <i class="conum" data-value="4"></i><b>(4)</b>
    }
    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> accessible() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="comment">// when</span>
        <span class="directive">final</span> <span class="predefined-type">String</span> name = simpleObjectWrapped.getName();
        <span class="comment">// then</span>
        assertThat(name).isEqualTo(fs.NAMES.get(<span class="integer">0</span>));
    }
    ...
    <span class="annotation">@Inject</span>
    FixtureScripts fixtureScripts;                      <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre> 
           </div> 
          </div> 
          <div class="colist arabic"> 
           <table> 
            <tbody>
             <tr> 
              <td><i class="conum" data-value="1"></i><b>1</b></td> 
              <td>instantiate the fixture script for this test, and configure</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="2"></i><b>2</b></td> 
              <td>execute the fixture script</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="3"></i><b>3</b></td> 
              <td>obtain the object under test from the fixture</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="4"></i><b>4</b></td> 
              <td>wrap the object (to simulate being interacted with through the UI)</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="5"></i><b>5</b></td> 
              <td>inject the <code>FixtureScripts</code> domain service (just like any other domain service)</td> 
             </tr> 
            </tbody>
           </table> 
          </div> 
         </div> 
         <div class="sect3"> 
          <h4 id="_ugtst_fixture-scripts_api-and-usage_persona-and-builders">6.1.4. Personas and Builders</h4>
          <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
           <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage_persona-and-builders.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
           <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
           <ul class="dropdown-menu">
            <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage_persona-and-builders.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
            <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage_persona-and-builders.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
            <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage_persona-and-builders.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
            <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_api-and-usage_persona-and-builders.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
           </ul>
          </div> 
          <div class="paragraph"> 
           <p>Good integration tests are probably the best way to understand the behaviour of the domain model: better, even, than reading the code itself. This requires though that the tests are as minimal as possible so that the developer reading the test knows that everything mentioned in the test is essential to the functionality under test.</p> 
          </div> 
          <div class="paragraph"> 
           <p>At the same time, "Persona" instances of entity classes help the developer become familiar with the data being set up. For example, "Steve Single" the Customer might be 21, single and no kids, whereas vs "Meghan Married-Mum" the Customer might be married 35 with 2 kids. Using "Steve" vs "Meghan" immediately informs the developer about the particular scenario being explored.</p> 
          </div> 
          <div class="paragraph"> 
           <p>The <code>PersonaWithBuilderScript</code> and <code>PersonaWithFinder</code> interfaces are intended to be implemented typically by "persona" enums, where each enum instance captures the essential data of some persona. So, going back to the previous example, we might have:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="xml">public enum Customer_persona
        implements PersonaWithBuilderScript<span class="tag">&lt;..&gt;</span>, PersonaWithFinder<span class="tag">&lt;..&gt;</span> {

    SteveSingle("Steve", "Single", 21, MaritalStatus.SINGLE, 0)
    MeghanMarriedMum("Meghan", "Married-Mum", 35, MaritalStatus.MARRIED, 2);
    ...
}</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>The <code>PersonaWithBuilderScript</code> interface means that this enum is able to act as a factory for a <code>BuilderScriptAbstract</code>. This is a specialization of <code>FixtureScript</code> that is used to actually create the entity (customer, or whatever), using the data taken out of the enum instance:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="xml">public interface PersonaWithBuilderScript<span class="tag">&lt;T</span><span class="error">,</span> <span class="attribute-name">F</span> <span class="attribute-name">extends</span> <span class="attribute-name">BuilderScriptAbstract</span><span class="error">&lt;</span><span class="attribute-name">T</span><span class="error">,</span><span class="attribute-name">F</span><span class="tag">&gt;</span><span class="error">&gt;</span>  {
    F builder();
}</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>The <code>PersonaWithFinder</code> interface meanwhile indicates that the enum can "lookup" its corresponding entity from the appropriate repository domain service:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="xml">public interface PersonaWithFinder<span class="tag">&lt;T&gt;</span> {
    T findUsing(final ServiceRegistry2 serviceRegistry);

}</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>The <a href="../ugfun/ugfun.html#_ugfun_getting-started_simpleapp-archetype">SimpleApp archetype</a> provides a sample implementation of these interfaces:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@lombok</span>.AllArgsConstructor
<span class="directive">public</span> <span class="type">enum</span> SimpleObject_persona
        <span class="directive">implements</span> PersonaWithBuilderScript&lt;SimpleObject, SimpleObjectBuilder&gt;,
                   PersonaWithFinder&lt;SimpleObject&gt; {
    FOO(<span class="string"><span class="delimiter">"</span><span class="content">Foo</span><span class="delimiter">"</span></span>),
    BAR(<span class="string"><span class="delimiter">"</span><span class="content">Bar</span><span class="delimiter">"</span></span>),
    BAZ(<span class="string"><span class="delimiter">"</span><span class="content">Baz</span><span class="delimiter">"</span></span>),
    FRODO(<span class="string"><span class="delimiter">"</span><span class="content">Frodo</span><span class="delimiter">"</span></span>),
    FROYO(<span class="string"><span class="delimiter">"</span><span class="content">Froyo</span><span class="delimiter">"</span></span>),
    FIZZ(<span class="string"><span class="delimiter">"</span><span class="content">Fizz</span><span class="delimiter">"</span></span>),
    BIP(<span class="string"><span class="delimiter">"</span><span class="content">Bip</span><span class="delimiter">"</span></span>),
    BOP(<span class="string"><span class="delimiter">"</span><span class="content">Bop</span><span class="delimiter">"</span></span>),
    BANG(<span class="string"><span class="delimiter">"</span><span class="content">Bang</span><span class="delimiter">"</span></span>),
    BOO(<span class="string"><span class="delimiter">"</span><span class="content">Boo</span><span class="delimiter">"</span></span>);

    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> name;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> SimpleObjectBuilder builder() {
        <span class="keyword">return</span> <span class="keyword">new</span> SimpleObjectBuilder().setName(name);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> SimpleObject findUsing(<span class="directive">final</span> ServiceRegistry2 serviceRegistry) {
        SimpleObjectRepository simpleObjectRepository =
            serviceRegistry.lookupService(SimpleObjectRepository.class);
        <span class="keyword">return</span> simpleObjectRepository.findByNameExact(name);
    }
}</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>where <code>SimpleObjectBuilder</code> in turn is:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@lombok</span>.Accessors(chain = <span class="predefined-constant">true</span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleObjectBuilder</span>
            <span class="directive">extends</span> BuilderScriptAbstract&lt;SimpleObject, SimpleObjectBuilder&gt; {

    <span class="annotation">@lombok</span>.Getter <span class="annotation">@lombok</span>.Setter
    <span class="directive">private</span> <span class="predefined-type">String</span> name;                                    <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> execute(<span class="directive">final</span> ExecutionContext ec) {
        checkParam(<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span>, ec, <span class="predefined-type">String</span>.class);               <i class="conum" data-value="2"></i><b>(2)</b>
        object = wrap(simpleObjectMenu).create(name);
    }

    <span class="annotation">@lombok</span>.Getter
    <span class="directive">private</span> SimpleObject object;                            <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="annotation">@javax</span>.inject.Inject
    SimpleObjectMenu simpleObjectMenu;
}</code></pre> 
           </div> 
          </div> 
          <div class="colist arabic"> 
           <table> 
            <tbody>
             <tr> 
              <td><i class="conum" data-value="1"></i><b>1</b></td> 
              <td>The persona class should set this value (copied from its own state)</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="2"></i><b>2</b></td> 
              <td>the inherited "checkParam" is used to ensure that a value is set</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="3"></i><b>3</b></td> 
              <td>the created entity is provided as an output</td> 
             </tr> 
            </tbody>
           </table> 
          </div> 
          <div class="paragraph"> 
           <p>This simplifies the integration tests considerably:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleObject_IntegTest</span> <span class="directive">extends</span> SimpleModuleIntegTestAbstract {

    SimpleObject simpleObject;

    <span class="annotation">@Before</span>
    <span class="directive">public</span> <span class="type">void</span> setUp() {
        <span class="comment">// given</span>
        simpleObject = fixtureScripts.runBuilderScript(SimpleObject_persona.FOO.builder());
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> accessible() {
        <span class="comment">// when</span>
        <span class="directive">final</span> <span class="predefined-type">String</span> name = wrap(simpleObject).getName();

        <span class="comment">// then</span>
        assertThat(name).isEqualTo(simpleObject.getName());
    }
    ...
}</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>Put together, the persona enums provide the "what" - hard-coded values for certain key data that the developer becomes very familiar with - while the builder provides the "how-to".</p> 
          </div> 
          <div class="paragraph"> 
           <p>These builder scripts (<code>BuilderScriptAbstract</code> implementations) can be used independently of the enum personas. And for more complex entity -where there might be many potential values that need to be provided - the builder script can automatically default some or even all of these values.</p> 
          </div> 
          <div class="paragraph"> 
           <p>For example, for a customer’s date of birth, the buider could default to a date making the customer an adult, aged between 18 and 65, say. For an email address or postal address, or an image, or some "lorem ipsum" text, the (non-ASF) <a href="http://platform.incode.org" target="_blank" rel="noopener">Incode Platform</a>'s fakedata module could provide randomised values.</p> 
          </div> 
          <div class="paragraph"> 
           <p>The benefit of an intelligent builder is that it further simplifies the test. The developer reading the test then knows that everything that has been specified exactly is of significance. Because non-specified values are randomised and change on each run, it also decreases the chance that the test passes "by accident" (based on some lucky hard-coded input value).</p> 
          </div> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_ugtst_fixture-scripts_ticking-clock-fixture">6.2. Ticking Clock Fixture</h3>
         <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
          <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_ticking-clock-fixture.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
          <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
          <ul class="dropdown-menu">
           <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_ticking-clock-fixture.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
           <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_ticking-clock-fixture.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
           <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_ticking-clock-fixture.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
           <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_ticking-clock-fixture.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
          </ul>
         </div> 
         <div class="paragraph"> 
          <p>The <code>TickingClockFixture</code> is a pre-built fixture script that resets the date/time returned by the <a href="../rgsvc/rgsvc.html#_rgsvc_core-domain-api_ClockService"><code>ClockService</code></a> to a known value.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Thereafter the time returned continues to tick forward (as would the real clock) until reset once more.</p> 
         </div> 
         <div class="paragraph"> 
          <p>For example, to set the clock to return "3 Sept 2014", use:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java">executionContext.executeChild(<span class="local-variable">this</span>, <span class="keyword">new</span> TickingClockFixture().setTo(<span class="string"><span class="delimiter">"</span><span class="content">2014-09-03</span><span class="delimiter">"</span></span>));</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>A variety of format strings are supported; the format "YYYY-MM-DD" (as shown above) will work in every locale.</p> 
         </div> 
         <div class="paragraph"> 
          <p>The fixture script requires that a <code>TickingFixtureClock</code> is initialized during bootstrapping. This is done automatically in <code>HeadlessWithBootstrappingAbstract</code> (the superclass of <code>IntegrationTestAbstract3</code> and for BDD bootstrapping classes).</p> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_ugtst_fixture-scripts_sudo-service">6.3. <code>SudoService</code></h3>
         <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
          <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_sudo-service.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
          <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
          <ul class="dropdown-menu">
           <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_sudo-service.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
           <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_sudo-service.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
           <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_sudo-service.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
           <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugtst/_ugtst_fixture-scripts_sudo-service.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
          </ul>
         </div> 
         <div class="paragraph"> 
          <p>Sometimes in our fixture scripts we want to perform a business action running as a particular user. This might be for the usual reason - so that our fixtures accurately reflect the reality of the system with all business constraints enforced using the <code>WrapperFactory</code> - or more straightforwardly it might be simply that the action depends on the identity of the user invoking the action.</p> 
         </div> 
         <div class="paragraph"> 
          <p>An example of the latter case is in the (non-ASF) <a href="http://github.com/isisaddons/isis-app-todoapp">Isis addons' todoapp</a>'s <code>ToDoItem</code> class:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="title">
           Production code that depends on current user
          </div> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> ToDoItem newToDo(
        <span class="annotation">@Parameter</span>(regexPattern = <span class="string"><span class="delimiter">"</span><span class="char">\\</span><span class="content">w[@&amp;:</span><span class="char">\\</span><span class="content">-</span><span class="char">\\</span><span class="content">,</span><span class="char">\\</span><span class="content">.</span><span class="char">\\</span><span class="content">+ </span><span class="char">\\</span><span class="content">w]*</span><span class="delimiter">"</span></span>) <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">"</span><span class="content">Description</span><span class="delimiter">"</span></span>)
        <span class="directive">final</span> <span class="predefined-type">String</span> description,
        <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">"</span><span class="content">Category</span><span class="delimiter">"</span></span>)
        <span class="directive">final</span> Category category,
        <span class="annotation">@Parameter</span>(optionality = Optionality.OPTIONAL) <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">"</span><span class="content">Subcategory</span><span class="delimiter">"</span></span>)
        <span class="directive">final</span> Subcategory subcategory,
        <span class="annotation">@Parameter</span>(optionality = Optionality.OPTIONAL) <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">"</span><span class="content">Due by</span><span class="delimiter">"</span></span>)
        <span class="directive">final</span> LocalDate dueBy,
        <span class="annotation">@Parameter</span>(optionality = Optionality.OPTIONAL) <span class="annotation">@ParameterLayout</span>(named=<span class="string"><span class="delimiter">"</span><span class="content">Cost</span><span class="delimiter">"</span></span>)
        <span class="directive">final</span> <span class="predefined-type">BigDecimal</span> cost) {
    <span class="keyword">return</span> newToDo(description, category, subcategory, currentUserName(), dueBy, cost);
}
<span class="directive">private</span> <span class="predefined-type">String</span> currentUserName() {
    <span class="keyword">return</span> container.getUser().getName(); <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre> 
          </div> 
         </div> 
         <div class="colist arabic"> 
          <table> 
           <tbody>
            <tr> 
             <td><i class="conum" data-value="1"></i><b>1</b></td> 
             <td>is the current user.</td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>The fixture for this can use the <code>SudoService</code> to run a block of code as a specified user:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="title">
           Fixture Script
          </div> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> <span class="predefined-type">String</span> description = ...
final Category category = ...
final Subcategory subcategory = ...
final LocalDate dueBy = ...
final <span class="predefined-type">BigDecimal</span> cost = ...
final Location location = ...

toDoItem = sudoService.sudo(username,
        <span class="keyword">new</span> <span class="predefined-type">Callable</span>&lt;ToDoItem&gt;() {
            <span class="annotation">@Override</span>
            <span class="directive">public</span> ToDoItem call() {
                <span class="directive">final</span> ToDoItem toDoItem = wrap(toDoItems).newToDo(
                        description, category, subcategory, dueBy, cost);
                wrap(toDoItem).setLocation(location);
                <span class="keyword">return</span> toDoItem;
            }
        });</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Behind the scenes the <code>SudoService</code> simply talks to the <code>UserService</code> to override the user returned by the <code>getUser()</code> API. It is possible to override both users and roles.</p> 
         </div> 
        </div> 
       </div> 
      </div> 
     </div> 
    </div> 
    <div class="hidden-xs hidden-sm hidden-md col-lg-3"> 
     <nav id="toc" data-spy="affix" data-toggle="toc"></nav> 
    </div> 
   </div> 
  </div> 
  <footer class="footer"> 
   <div class="container"> 
    <div class="row"> 
     <p class="text-center small text-muted"> Copyright © 2010~2018 The Apache&nbsp;Software&nbsp;Foundation, licensed under the Apache&nbsp;License,&nbsp;v2.0. <br> Apache, the Apache feather logo, Apache&nbsp;Isis, and the Apache&nbsp;Isis project logo are all trademarks of The&nbsp;Apache&nbsp;Software&nbsp;Foundation. </p> 
    </div> 
   </div> 
  </footer> 
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script> 
  <script src="../../js/bootstrap/3.3.7/bootstrap.min.js"></script> 
  <script src="../../js/bootstrap-toc/0.4.1/bootstrap-toc.min.js"></script> 
  <script src="../../js/slick/1.5.0/slick.min.js"></script> 
  <script src="../../js/elasticlunr/elasticlunr.min.js"></script> 
  <script src="../../js/sticky-header/sticky-header.js"></script> 
  <script src="../../js/search-panel/search-panel.js"></script> 
  <script src="../../js/header-link/header-link.js"></script> 
  <script src="../../js/toc-scroll/toc-scroll.js"></script>  
 </body>
</html>
