<!doctype html>
<html>
 <head> 
  <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    --> 
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
  <meta charset="utf-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <!-- No caching headers --> 
  <meta http-equiv="cache-control" content="no-cache"> 
  <meta http-equiv="pragma" content="no-cache"> 
  <meta http-equiv="expires" content="-1"> 
  <title>Beyond the Basics</title> 
  <link rel="icon" type="image/png" href="../../images/isis-favicon.png"> 
  <!--
        Based on DataNucleus' template,
        that was in turn based on an earlier version of Apache Isis' template,
        that was in turn based on Apache Deltaspike's template.

        This template uses
        * Bootstrap v3.3.7 (https://getbootstrap.com/) for navbar.
        * Bootstrap TOC plugin v0.4.1 (https://afeld.github.io/bootstrap-toc/)
          for the table of contents.
        * jQuery (necessary for Bootstrap's JavaScript plugins)
        * Font-Awesome for some icons used by Asciidoctor

        Also:
        * Bootswatch "flatly" theme for Bootstrap (https://bootswatch.com/flatly).
        * slick.js (carousel)
        * add a link to all headers (home-grown, adapted from blog posts)
        * integration of elasticlunr.js (home-grown, adapted from blog posts)
    --> 
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet"> 
  <link href="../../css/bootstrap-toc/0.4.1/bootstrap-toc.min.css" rel="stylesheet"> 
  <link href="../../css/asciidoctor/foundation.css" rel="stylesheet"> 
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet"> 
  <link href="../../css/slick/1.5.0/slick.css" rel="stylesheet"> 
  <link href="../../css/slick/1.5.0/slick-theme.css" rel="stylesheet"> 
  <link href="../../css/search-panel/search-panel.css" rel="stylesheet"> 
  <link href="../../css/header-links/header-links.css" rel="stylesheet"> 
  <link href="../../css/sticky-header/sticky-header.css" rel="stylesheet"> 
  <link href="../../css/customisations.css" rel="stylesheet"> 
  <!-- Coderay syntax formatter --> 
  <style type="text/css">
        /* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
    </style> 
 </head> 
 <body data-spy="scroll" data-target="#toc"> 
  <div id="basedir" style="display:none;">
   ../../
  </div> 
  <div id="docname" style="display:none;">
   ugbtb
  </div> 
  <div id="filetype" style="display:none;">
   html
  </div> 
  <!-- Navbar --> 
  <nav class="navbar navbar-default navbar-static-top header"> 
   <div class="container"> 
    <div class="navbar-header"> 
     <!-- Three line menu button for use on mobile screens --> 
     <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> 
     <a class="navbar-brand" href="../../index.html"> <img alt="Brand" src="../../images/isis-logo-48x48.png"> </a> 
     <a class="navbar-brand" href="../../index.html">Apache Isis</a> 
    </div> 
    <!-- Navbar that will collapse on mobile screens --> 
    <div id="navbar" class="navbar-collapse collapse"> 
     <ul class="nav navbar-nav"> 
      <li class="dropdown"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation<span class="caret"></span></a> 
       <ul class="dropdown-menu"> 
        <li><a href="../../documentation.html">Table of Contents</a></li> 
        <li role="separator" class="divider"></li> 
        <li class="dropdown-header">User Guides</li> 
        <li><a href="../../guides/ugfun/ugfun.html">Fundamentals</a></li> 
        <li><a href="../../guides/ugvw/ugvw.html">Wicket Viewer</a></li> 
        <li><a href="../../guides/ugvro/ugvro.html">Restful Objects Viewer</a></li> 
        <li><a href="../../guides/ugodn/ugodn.html">DataNucleus Object Store</a></li> 
        <li><a href="../../guides/ugsec/ugsec.html">Security</a></li> 
        <li><a href="../../guides/ugtst/ugtst.html">Testing</a></li> 
        <li><a href="../../guides/ugbtb/ugbtb.html">Beyond the Basics</a></li> 
        <li role="separator" class="divider"></li> 
        <li class="dropdown-header">Reference Guides</li> 
        <li><a href="../../guides/rgant/rgant.html">Annotations</a></li> 
        <li><a href="../../guides/rgsvc/rgsvc.html">Domain Services</a></li> 
        <li><a href="../../guides/rgcfg/rgcfg.html">Core Config' Properties</a></li> 
        <li><a href="../../guides/rgcms/rgcms.html">Classes, Methods and Schema</a></li> 
        <li><a href="../../guides/rgmvn/rgmvn.html">Maven plugin</a></li> 
        <li><a href="../../guides/rgfis/rgfis.html">Framework Internal Services</a></li> 
        <li role="separator" class="divider"></li> 
        <li class="dropdown-header">Javadoc</li> 
        <li><a href="http://javadoc.io/doc/org.apache.isis.core/isis-core-applib">Applib</a></li> 
       </ul> </li> 
      <li class="dropdown  hidden-sm hidden-md"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Downloads<span class="caret"></span></a> 
       <ul class="dropdown-menu"> 
        <li class="dropdown-header">Maven archetypes</li> 
        <li><a href="../../guides/ugfun/ugfun.html#_ugfun_getting-started_helloworld-archetype">helloworld</a></li> 
        <li><a href="../../guides/ugfun/ugfun.html#_ugfun_getting-started_simpleapp-archetype">simpleapp</a></li> 
        <li role="separator" class="divider"></li> 
        <li><a href="../../downloads.html">Downloads</a></li> 
        <li><a href="../../release-notes/release-notes.html">Release Notes</a></li> 
        <li><a href="../../migration-notes/migration-notes.html">Migration Notes</a></li> 
        <li role="separator" class="divider"></li> 
        <li><a href="https://github.com/apache/isis">Github mirror</a></li> 
       </ul> </li> 
      <li class="dropdown  hidden-sm"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Support<span class="caret"></span></a> 
       <ul class="dropdown-menu"> 
        <li class="dropdown-header">Guides</li> 
        <li><a href="../../guides/dg/dg.html">Developers' Guide</a></li> 
        <li><a href="../../guides/cgcom/cgcom.html">Committers' Guide</a></li> 
        <li><a href="../../guides/htg.html">Hints-n-Tips Guide</a></li> 
        <li role="separator" class="divider"></li> 
        <li class="dropdown-header">Mailing Lists</li> 
        <li><a href="../../support.html">How to subscribe</a></li> 
        <li><a href="https://lists.apache.org/list.html?users@isis.apache.org">Archives (ASF Pony mail)</a></li> 
        <li><a href="http://isis.markmail.org/search/?q=">Archives (Markmail)</a></li> 
        <li role="separator" class="divider"></li> 
        <li class="dropdown-header">Other Resources</li> 
        <li><a href="https://issues.apache.org/jira/browse/ISIS">ASF JIRA</a></li> 
        <li><a href="https://stackoverflow.com/questions/tagged/isis">Stack Overflow</a></li> 
        <li><a href="../../help.html">Wiki, Fisheye etc.</a></li> 
       </ul> </li> 
      <li class="dropdown hidden-sm hidden-md"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">@ASF<span class="caret"></span></a> 
       <ul class="dropdown-menu"> 
        <li><a href="https://www.apache.org/">Apache Homepage</a></li> 
        <li><a href="https://www.apache.org/events/current-event">Events</a></li> 
        <li><a href="https://www.apache.org/licenses/">Licenses</a></li> 
        <li><a href="https://www.apache.org/security/">Security</a></li> 
        <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li> 
        <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li> 
        <li role="separator" class="divider"></li> 
        <li><a href="https://whimsy.apache.org/board/minutes/Isis.html">PMC board minutes</a></li> 
       </ul> </li> 
     </ul> 
     <div class="nav navbar-nav navbar-right"> 
      <!-- 'style' added to fix height of input box. FIX THIS --> 
      <form class="navbar-form" role="search" id="search-form" style="padding: 1px 15px;"> 
       <div class="form-group"> 
        <input class="form-control" id="search-field" type="text" size="30" placeholder="Search"> 
       </div> 
      </form> 
     </div> 
     <p class="nav navbar-text navbar-right small">v2.0.0-M2</p> 
    </div> 
   </div> 
  </nav> 
  <div class="container"> 
   <div class="row-fluid"> 
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-9"> 
     <div id="search-panel"> 
      <div id="search-results"></div> 
      <div> 
       <br> 
       <a href="#" id="search-results-clear">clear</a> 
      </div> 
     </div> 
     <span class="pdf-link"><a href="ugbtb.pdf"><img src="../../images/PDF-50.png"></a></span> 
     <div class="page-title"> 
      <h1>Beyond the Basics</h1> 
     </div> 
     <div id="doc-content">
      <div class="btn-group" style="float: right; font-size: small; padding: 6px;  ">
       <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugbtb/ugbtb.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
       <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
       <ul class="dropdown-menu">
        <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugbtb/ugbtb.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
        <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugbtb/ugbtb.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
        <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugbtb/ugbtb.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
        <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugbtb/ugbtb.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
       </ul>
      </div> 
      <div class="sect1"> 
       <h2 id="__ugbtb">1. Beyond the Basics</h2> 
       <div class="sectionbody"> 
        <div class="paragraph"> 
         <p>This guide provides <a href="../ugbtb/ugbtb.html#_ugbtb_other-techniques">more advanced</a> guidance on writing maintainable larger applications.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Later chapters discuss how to <a href="../ugbtb/ugbtb.html#_ugbtb_deployment">deploy</a> your app, and discuss other ways in which you can <a href="../ugbtb/ugbtb.html">extend</a> or adapt the framework itself to your particular needs.</p> 
        </div> 
        <div class="sect2"> 
         <h3 id="_other_guides">1.1. Other Guides</h3> 
         <div class="paragraph"> 
          <p>Apache Isis documentation is broken out into a number of user, reference and "supporting procedures" guides.</p> 
         </div> 
         <div class="paragraph"> 
          <p>The user guides available are:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><a href="../ugfun/ugfun.html">Fundamentals</a></p> </li> 
           <li> <p><a href="../ugvw/ugvw.html">Wicket viewer</a></p> </li> 
           <li> <p><a href="../ugvro/ugvro.html">Restful Objects viewer</a></p> </li> 
           <li> <p><a href="../ugodn/ugodn.html">DataNucleus object store</a></p> </li> 
           <li> <p><a href="../ugsec/ugsec.html">Security</a></p> </li> 
           <li> <p><a href="../ugtst/ugtst.html">Testing</a></p> </li> 
           <li> <p><a href="../ugbtb/ugbtb.html">Beyond the Basics</a> (this guide)</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>The reference guides are:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><a href="../rgant/rgant.html">Annotations</a></p> </li> 
           <li> <p><a href="../rgsvc/rgsvc.html">Domain Services</a></p> </li> 
           <li> <p><a href="../rgcfg/rgcfg.html">Configuration Properties</a></p> </li> 
           <li> <p><a href="../rgcms/rgcms.html">Classes, Methods and Schema</a></p> </li> 
           <li> <p><a href="../rgmvn/rgmvn.html">Apache Isis Maven plugin</a></p> </li> 
           <li> <p><a href="../rgfis/rgfis.html">Framework Internal Services</a></p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>The remaining guides are:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><a href="../dg/dg.html">Developers' Guide</a> (how to set up a development environment for Apache Isis and contribute back to the project)</p> </li> 
           <li> <p><a href="../cgcom/cgcom.html">Committers' Guide</a> (release procedures and related practices)</p> </li> 
          </ul> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect1"> 
       <h2 id="_ugbtb_i18n">2. i18n</h2>
       <div class="btn-group" style="float: right; font-size: small; padding: 6px; margin-top: -55px; ">
        <button type="button" class="btn btn-xs btn-default" onclick="window.location.href=&quot;https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugbtb/_ugbtb_i18n.adoc&quot;"><i class="fa fa-pencil-square-o"></i>&nbsp;Edit</button>
        <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>
        <ul class="dropdown-menu">
         <li><a href="https://github.com/apache/isis/edit/master/adocs/documentation/src/main/asciidoc/guides/ugbtb/_ugbtb_i18n.adoc" target="_blank"><i class="fa fa-pencil-square-o fa-fw" aria-hidden="true"></i>&nbsp; Edit</a></li>
         <li><a href="https://github.com/apache/isis/commits/master/adocs/documentation/src/main/asciidoc/guides/ugbtb/_ugbtb_i18n.adoc" target="_blank"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>&nbsp; History</a></li>
         <li><a href="https://github.com/apache/isis/raw/master/adocs/documentation/src/main/asciidoc/guides/ugbtb/_ugbtb_i18n.adoc" target="_blank"><i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>&nbsp; Raw</a></li>
         <li><a href="https://github.com/apache/isis/blame/master/adocs/documentation/src/main/asciidoc/guides/ugbtb/_ugbtb_i18n.adoc" target="_blank"><i class="fa fa-hand-o-right fa-fw" aria-hidden="true"></i>&nbsp; Blame</a></li>
        </ul>
       </div> 
       <div class="sectionbody"> 
        <div class="paragraph"> 
         <p>Apache Isis' support for internationlization (i18n) allows every element of the domain model (the class names, property names, action names, parameter names and so forth) to be translated.</p> 
        </div> 
        <div class="paragraph"> 
         <p>It also supports translations of messages raised imperatively, by which we mean as the result of a call to <code>title()</code> to obtain an object’s title, or messages resulting from any business rule violations (eg <a href="../rgcms/rgcms.html#_rgcms_methods_prefixes_disable"><code>disable…​()</code></a> or <a href="../rgcms/rgcms.html#_rgcms_methods_prefixes_validate"><code>validate…​()</code></a>, and so on.</p> 
        </div> 
        <div class="paragraph"> 
         <p>The <a href="../ugvw/ugvw.html">Wicket viewer</a> (that is, its labels and messages) is also internationalized using the same mechanism. If no translations are available, then the Wicket viewer falls back to using Wicket resource bundles.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Isis does not translate the values of your domain objects, though. So, if you have a domain concept such as <code>Country</code> whose name is intended to be localized according to the current user, you will need to model this yourself.</p> 
        </div> 
        <div class="sect2"> 
         <h3 id="__ugbtb_i18n_implementation-approach">2.1. Implementation Approach</h3> 
         <div class="paragraph"> 
          <p>Most Java frameworks tackle i18n by using Java’s own <code>ResourceBundle</code> API. However, there are some serious drawbacks in this approach, including:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>if a string appears more than once (eg "name" or "description") then it must be translated everywhere it appears in every resource bundle file</p> </li> 
           <li> <p>there is no support for plural forms (see this <a href="http://stackoverflow.com/questions/14326653/java-internationalization-i18n-with-proper-plurals/14327683#14327683">SO answer</a>)</p> </li> 
           <li> <p>there is no tooling support for translators</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Apache Isis therefore takes a different approach, drawing inspiration from GNU’s <a href="https://www.gnu.org/software/gettext/manual/index.html">gettext</a> API and specifically its <code>.pot</code> and <code>.po</code> files. These are intended to be used as follows:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>the <code>.pot</code> (portable object template) file holds the message text to be translated</p> </li> 
           <li> <p>this file is translated into multiple <code>.po</code> (portable object) files, one per supported locale</p> </li> 
           <li> <p>these <code>.po</code> files are renamed according to their locale, and placed into the 'appropriate' location to be picked up by the runtime. The name of each <code>.po</code> resolved in a very similar way to resource bundles.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>The format of the <code>.pot</code> and <code>.po</code> files is identical; the only difference is that the <code>.po</code> file has translations for each of the message strings. These message strings can also have singular and plural forms.</p> 
         </div> 
         <div class="admonitionblock important"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-important" title="Important"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>Although Apache Isis' implementation is modelled after GNU’s API, it does <em>not</em> use any GNU software. This is for two reasons: (a) to simplify the toolchain/developer experience, and (b) because GNU software is usually GPL, which would be incompatible with the Apache license.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>This design tackles all the issues of <code>ResourceBundle</code>s:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>the <code>.po</code> message format is such that any given message text to translate need only be translated once, even if it appears in multiple places in the application (eg "Name")</p> </li> 
           <li> <p>the <code>.po</code> message format includes translations for (optional) plural form as well as singular form</p> </li> 
           <li> <p>there are lots of freely available editors <a href="https://www.google.co.uk/search?q=.po+file+editor">to be found</a>, many summarized on this <a href="https://www.drupal.org/node/11131">Drupal.org</a> webpage.<br></p> 
            <div class="paragraph"> 
             <p>In fact, there are also online communities/platforms of translators to assist with translating files. One such is <a href="https://crowdin.com/">crowdin</a> (nb: this link does not imply endorsement).</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>In Apache Isis' implementation, if the translation is missing from the <code>.po</code> file then the original message text from the <code>.pot</code> file will be returned. In fact, it isn’t even necessary for there to be any <code>.po</code> files; <code>.po</code> translations can be added piecemeal as the need arises.</p> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="__ugbtb_i18n_translation-service">2.2. <code>TranslationService</code></h3> 
         <div class="paragraph"> 
          <p>The cornerstone of Apache Isis' support for i18n is the <code>TranslationService</code> service. This is defined in the applib with the following API:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">TranslationService</span> {
    <span class="directive">public</span> <span class="predefined-type">String</span> translate(      <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="directive">final</span> <span class="predefined-type">String</span> context,
            <span class="directive">final</span> <span class="predefined-type">String</span> text);
    <span class="directive">public</span> <span class="predefined-type">String</span> translate(      <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="directive">final</span> <span class="predefined-type">String</span> context,
            <span class="directive">final</span> <span class="predefined-type">String</span> singularText,
            <span class="directive">final</span> <span class="predefined-type">String</span> pluralText,
            <span class="directive">final</span> <span class="type">int</span> num);
    <span class="directive">public</span> <span class="type">enum</span> Mode {
        READ,
        WRITE;
    }
    Mode getMode();               <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre> 
          </div> 
         </div> 
         <div class="colist arabic"> 
          <table> 
           <tbody>
            <tr> 
             <td><i class="conum" data-value="1"></i><b>1</b></td> 
             <td>is to translate the singular form of the text</td> 
            </tr> 
            <tr> 
             <td><i class="conum" data-value="2"></i><b>2</b></td> 
             <td>is to translate the plural form of the text</td> 
            </tr> 
            <tr> 
             <td><i class="conum" data-value="3"></i><b>3</b></td> 
             <td>indicates whether the translation service is in read or write mode.</td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>The <code>translate(…​)</code> methods are closely modelled on GNU’s gettext API. The first version is used when no translation is required, the second is when both a singular and plural form will be required, with the <code>num</code> parameter being used to select which is returned. In both cases the <code>context</code> parameter provides some contextual information for the translator; this generally corresponds to the class member.</p> 
         </div> 
         <div class="paragraph"> 
          <p>The mode meanwhile determines the behaviour of the service. More on this below.</p> 
         </div> 
         <div class="sect3"> 
          <h4 id="_code_translationservicepo_code">2.2.1. <code>TranslationServicePo</code></h4> 
          <div class="paragraph"> 
           <p>Isis provides a default implementation of <code>TranslationService</code>, namely <code>TranslationServicePo</code>.</p> 
          </div> 
          <div class="paragraph"> 
           <p>If the service is running in the normal read mode, then it simply provides translations for the locale of the current user. This means locates the appropriate <code>.po</code> file (based on the requesting user’s locale), finds the translation and returns it.</p> 
          </div> 
          <div class="paragraph"> 
           <p>If however the service is configured to run in write mode, then it instead records the fact that the message was requested to be translated (a little like a spy/mock in unit testing mock), and returns the original message. The service can then be queried to discover which messages need to be translated. All requested translations are written into the <code>.pot</code> file.</p> 
          </div> 
          <div class="paragraph"> 
           <p>To make the service as convenient as possible to use, the service configures itself as follows:</p> 
          </div> 
          <div class="ulist"> 
           <ul> 
            <li> <p>if running in prototype mode <a href="../rgcfg/rgcfg.html#_rgcfg_deployment-types">deployment type</a> or during integration tests, then the service runs in <strong>write</strong> mode, in which case it records all translations into the <code>.pot</code> file. The <code>.pot</code> file is written out when the system is shutdown.</p> </li> 
            <li> <p>if running in server (production) mode <a href="../rgcfg/rgcfg.html#_rgcfg_deployment-types">deployment type</a>, then the service runs in <strong>read</strong> mode. It is also possible to set a configuration setting in <code>isis.properties</code> to force read mode even if running in prototype mode (useful to manually test/demo the translations).</p> </li> 
           </ul> 
          </div> 
          <div class="paragraph"> 
           <p>When running in write mode the original text is returned to the caller untranslated. If in read mode, then the translated <code>.po</code> files are read and translations provided as required.</p> 
          </div> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="__ugbtb_i18n_imperative-messages">2.3. Imperative messages</h3> 
         <div class="paragraph"> 
          <p>The <code>TranslationService</code> is used internally by Apache Isis when building up the metamodel; the name and description of every class, property, collection, action and action parameter is automatically translated. Thus the simple act of bootstrapping Apache Isis will cause most of the messages requiring translation (that is: those for the Apache Isis metamodel) to be captured by the <code>TranslationService</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>However, for an application to be fully internationalized, any validation messages (from either <code>disableXxx()</code> or <code>validateXxx()</code> supporting methods) and also possibly an object’s title (from the <code>title()</code> method) will also require translation. Moreover, these messages must be captured in the <code>.pot</code> file such that they can be translated.</p> 
         </div> 
         <div class="sect3"> 
          <h4 id="_code_translatablestring_code">2.3.1. <code>TranslatableString</code></h4> 
          <div class="paragraph"> 
           <p>The first part of the puzzle is tackled by an extension to Apache Isis' programming model. Whereas previously the <code>disableXxx()</code> / <code>validateXxx()</code> / <code>title()</code> methods could only return a <code>java.lang.String</code>, they may now optionally return a <code>TranslatableString</code> (defined in Isis applib) instead.</p> 
          </div> 
          <div class="paragraph"> 
           <p>Here’s a (silly) example from the <a href="../ugfun/ugfun.html#_ugfun_getting-started_simpleapp-archetype">SimpleApp archetype</a>:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> TranslatableString validateUpdateName(<span class="directive">final</span> <span class="predefined-type">String</span> name) {
    <span class="keyword">return</span> name.contains(<span class="string"><span class="delimiter">"</span><span class="content">!</span><span class="delimiter">"</span></span>)? TranslatableString.tr(<span class="string"><span class="delimiter">"</span><span class="content">Exclamation mark is not allowed</span><span class="delimiter">"</span></span>): <span class="predefined-constant">null</span>;
}</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>This corresponds to the following entry in the <code>.pot</code> file:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="ini">#: dom.simple.SimpleObject#updateName()
msgid "Exclamation mark is not allowed"
msgstr ""</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>The full API of <code>TranslatableString</code> is modelled on the design of GNU gettext (in particular the <a href="https://code.google.com/p/gettext-commons/wiki/Tutorial">gettext-commons</a> library):</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">TranslatableString</span> {
    <span class="directive">public</span> <span class="directive">static</span> TranslatableString tr(       <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="directive">final</span> <span class="predefined-type">String</span> pattern,
            <span class="directive">final</span> <span class="predefined-type">Object</span>... paramArgs) { ... }
    <span class="directive">public</span> <span class="directive">static</span> TranslatableString trn(      <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="directive">final</span> <span class="predefined-type">String</span> singularPattern,
            <span class="directive">final</span> <span class="predefined-type">String</span> pluralPattern,
            <span class="directive">final</span> <span class="type">int</span> number,
            <span class="directive">final</span> <span class="predefined-type">Object</span>... paramArgs) { ... }
    <span class="directive">public</span> <span class="predefined-type">String</span> translate(                   <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="directive">final</span> TranslationService translationService,
            <span class="directive">final</span> <span class="predefined-type">String</span> context) { ... }
}</code></pre> 
           </div> 
          </div> 
          <div class="colist arabic"> 
           <table> 
            <tbody>
             <tr> 
              <td><i class="conum" data-value="1"></i><b>1</b></td> 
              <td>returns a translatable string with a single pattern for both singular and plural forms.</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="2"></i><b>2</b></td> 
              <td>returns a translatable string with different patterns for singular and plural forms; the one to use is determined by the 'number' argument</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="3"></i><b>3</b></td> 
              <td>translates the string using the provided <code>TranslationService</code>, using the appropriate singular/regular or plural form, and interpolating any arguments.</td> 
             </tr> 
            </tbody>
           </table> 
          </div> 
          <div class="paragraph"> 
           <p>The interpolation uses the format <code>{xxx}</code>, where the placeholder can occur multiple times.</p> 
          </div> 
          <div class="paragraph"> 
           <p>For example:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> TranslatableString ts = TranslatableString.tr(
    <span class="string"><span class="delimiter">"</span><span class="content">My name is {lastName}, {firstName} {lastName}.</span><span class="delimiter">"</span></span>,
    <span class="string"><span class="delimiter">"</span><span class="content">lastName</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Bond</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">firstName</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">James</span><span class="delimiter">"</span></span>);</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>would interpolate (for the English locale) as "My name is Bond, James Bond".</p> 
          </div> 
          <div class="paragraph"> 
           <p>For a German user, on the other hand, if the translation in the corresponding <code>.po</code> file was:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="ini">#: xxx.yyy.Whatever#context()
msgid "My name is {lastName}, {firstName} {lastName}."
msgstr "Ich heisse {firstName} {lastName}."</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>then the translation would be: "Ich heisse James Bond".</p> 
          </div> 
          <div class="paragraph"> 
           <p>The same class is used in <a href="../rgsvc/rgsvc.html#_rgsvc_core-domain-api_MessageService"><code>MessageService</code></a> so that you can raise translatable info, warning and error messages; each of the relevant methods are overloaded.</p> 
          </div> 
          <div class="paragraph"> 
           <p>For example:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">MessageService</span> {
    <span class="type">void</span> informUser(<span class="predefined-type">String</span> message);
    <span class="type">void</span> informUser(
        TranslatableMessage message,
        <span class="directive">final</span> <span class="predefined-type">Class</span>&lt;?&gt; contextClass, <span class="directive">final</span> <span class="predefined-type">String</span> contextMethod); <i class="conum" data-value="1"></i><b>(1)</b>
    ...
}</code></pre> 
           </div> 
          </div> 
          <div class="colist arabic"> 
           <table> 
            <tbody>
             <tr> 
              <td><i class="conum" data-value="1"></i><b>1</b></td> 
              <td>are concatenated together to form the context for the <code>.pot</code> file.</td> 
             </tr> 
            </tbody>
           </table> 
          </div> 
         </div> 
         <div class="sect3"> 
          <h4 id="_code_translatableexception_code">2.3.2. <code>TranslatableException</code></h4> 
          <div class="paragraph"> 
           <p>Another mechanism by which messages can be rendered to the user are as the result of exception messages thrown and recognized by an <a href="../rgsvc/rgsvc.html#_rgsvc_presentation-layer-spi_ExceptionRecognizer"><code>ExceptionRecognizer</code></a>.</p> 
          </div> 
          <div class="paragraph"> 
           <p>In this case, if the exception implements <code>TranslatableException</code>, then the message will automatically be translated before being rendered. The <code>TranslatableException</code> itself takes the form:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">TranslatableException</span> {
    TranslatableString getTranslatableMessage(); <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="predefined-type">String</span> getTranslationContext();              <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre> 
           </div> 
          </div> 
          <div class="colist arabic"> 
           <table> 
            <tbody>
             <tr> 
              <td><i class="conum" data-value="1"></i><b>1</b></td> 
              <td>the message to translate. If returns <code>null</code>, then the <code>Exception#getMessage()</code> is used as a fallback</td> 
             </tr> 
             <tr> 
              <td><i class="conum" data-value="2"></i><b>2</b></td> 
              <td>the context to use when translating the message</td> 
             </tr> 
            </tbody>
           </table> 
          </div> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="__ugbtb_i18n_wicket-viewer">2.4. Wicket Viewer</h3> 
         <div class="paragraph"> 
          <p>The <a href="../ugvw/ugvw.html">Wicket viewer</a> (its labels and messages) is also internationalized using the <code>TranslationService</code>. This is done through an Isis-specific implementation of the Wicket framework’s <code>org.apache.wicket.Localizer</code> class, namely <code>LocalizerForIsis</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>The Wicket <code>Localizer</code> defines the following API:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> getString(
        <span class="directive">final</span> <span class="predefined-type">String</span> key,               <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="directive">final</span> <span class="predefined-type">Component</span> component,      <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="directive">final</span> IModel&lt;?&gt; model,
        <span class="directive">final</span> <span class="predefined-type">Locale</span> locale,
        <span class="directive">final</span> <span class="predefined-type">String</span> style,
        <span class="directive">final</span> <span class="predefined-type">String</span> defaultValue)
    <span class="directive">throws</span> <span class="exception">MissingResourceException</span> { ... }</code></pre> 
          </div> 
         </div> 
         <div class="colist arabic"> 
          <table> 
           <tbody>
            <tr> 
             <td><i class="conum" data-value="1"></i><b>1</b></td> 
             <td>The key to obtain the resource for</td> 
            </tr> 
            <tr> 
             <td><i class="conum" data-value="2"></i><b>2</b></td> 
             <td>The component to get the resource for (if any)</td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>For example, <code>key</code> might be a value such as "okLabel", while <code>component</code> an internal class of the Wicket viewer, such as <code>EntityPropertiesForm</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>The <code>LocalizerForIsis</code> implementation uses the <code>key</code> as the <code>msgId</code>, while the fully qualified class name of the <code>component</code> is used as a context. There is one exception to this: if the component is the third-party select2 component (used for drop-downs), then that class name is used directly.</p> 
         </div> 
         <div class="paragraph"> 
          <p>In the main, using Isis' i18n support means simply adding the appropriate translations to the <code>translation.po</code> file, for each locale that you require. If the translations are missing then the original translations from the Wicket resource bundles will be used instead.</p> 
         </div> 
         <div class="sect3"> 
          <h4 id="_commonly_used">2.4.1. Commonly used</h4> 
          <div class="paragraph"> 
           <p>Most of the translation requirements can be covered by adding in the following <code>msgId</code>s:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="properties">#: org.apache.isis.viewer.wicket.ui.pages.entity.EntityPage
msgid "CollectionContentsAsAjaxTablePanelFactory.Table"
msgstr "Table"

#: org.apache.isis.viewer.wicket.ui.pages.entity.EntityPage
msgid "CollectionContentsAsUnresolvedPanel.Hide"
msgstr "Hide"

#: org.apache.isis.viewer.wicket.ui.pages.entity.EntityPage
msgid "aboutLabel"
msgstr "About"

#: org.apache.isis.viewer.wicket.ui.pages.entity.EntityPage
msgid "cancelLabel"
msgstr "Cancel"

#: org.apache.isis.viewer.wicket.ui.pages.entity.EntityPage
msgid "datatable.no-records-found"
msgstr "No Records Found"

#: org.apache.isis.viewer.wicket.ui.pages.entity.EntityPage
msgid "editLabel"
msgstr "Edit"

#: org.wicketstuff.select2.Select2Choice
msgid "inputTooShortPlural"
msgstr "Please enter {number} more characters"

#: org.wicketstuff.select2.Select2Choice
msgid "inputTooShortSingular"
msgstr "Please enter 1 more character"

#: org.wicketstuff.select2.Select2Choice
msgid "loadMore"
msgstr "Load more"

#: org.apache.isis.viewer.wicket.ui.pages.entity.EntityPage
msgid "logoutLabel"
msgstr "Logout"

#: org.wicketstuff.select2.Select2Choice
msgid "noMatches"
msgstr "No matches"

#: org.apache.isis.viewer.wicket.ui.pages.entity.EntityPage
msgid "okLabel"
msgstr "OK"

#: org.wicketstuff.select2.Select2Choice
msgid "searching"
msgstr "Searching..."

#: org.wicketstuff.select2.Select2Choice
msgid "selectionTooBigPlural"
msgstr "You can only select {limit} items"

#: org.wicketstuff.select2.Select2Choice
msgid "selectionTooBigSingular"
msgstr "You can only select 1 item"</code></pre> 
           </div> 
          </div> 
         </div> 
         <div class="sect3"> 
          <h4 id="_login_self_sign_up">2.4.2. Login/self-sign-up</h4> 
          <div class="paragraph"> 
           <p>In addition, there are a reasonably large number of messages that are used for both login and the <a href="../ugvw/ugvw.html#_ugvw_features_user-registration">user registration</a> (self sign-up) and password reset features.</p> 
          </div> 
          <div class="paragraph"> 
           <p>These are:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="properties">#: org.apache.isis.viewer.wicket.ui.pages.login.WicketSignInPage
msgid "AutoLabel.CSS.required"
msgstr "Required"

#: org.apache.isis.viewer.wicket.ui.pages.accmngt.signup.RegistrationFormPage
#: org.apache.isis.viewer.wicket.ui.pages.accmngt.register.RegisterPage
#: org.apache.isis.viewer.wicket.ui.pages.accmngt.password_reset.PasswordResetPage
msgid "confirmPasswordLabel"
msgstr "Confirm password"

#: org.apache.isis.viewer.wicket.ui.pages.accmngt.signup.RegistrationFormPage
#: org.apache.isis.viewer.wicket.ui.pages.accmngt.register.RegisterPage
msgid "emailIsNotAvailable"
msgstr "The given email is already in use"

#: org.apache.isis.viewer.wicket.ui.pages.accmngt.password_reset.PasswordResetPage
msgid "emailPlaceholder"
msgstr "Enter your email"

#: org.apache.isis.viewer.wicket.ui.pages.accmngt.signup.RegistrationFormPage
#: org.apache.isis.viewer.wicket.ui.pages.accmngt.register.RegisterPage
msgid "emailPlaceholder"
msgstr "Enter an email for the new account"

#: org.apache.isis.viewer.wicket.ui.pages.accmngt.signup.RegistrationFormPage
#: org.apache.isis.viewer.wicket.ui.pages.accmngt.register.RegisterPage
#: org.apache.isis.viewer.wicket.ui.pages.accmngt.password_reset.PasswordResetPage
msgid "emailLabel"
msgstr "Email"

#: org.apache.isis.viewer.wicket.ui.pages.accmngt.signup.RegistrationFormPage
#: org.apache.isis.viewer.wicket.ui.pages.accmngt.register.RegisterPage
#: org.apache.isis.viewer.wicket.ui.pages.accmngt.password_reset.PasswordResetPage
msgid "emailSentMessage"
msgstr "An email has been sent to '${email}' for verification."

#: org.apache.isis.viewer.wicket.ui.pages.login.WicketSignInPage
msgid "forgotPasswordLinkLabel"
msgstr "Forgot your password?"

#: org.apache.isis.viewer.wicket.ui.pages.login.WicketSignInPage
msgid "loginHeader"
msgstr "Login"

#: org.apache.isis.viewer.wicket.ui.pages.accmngt.password_reset.PasswordResetPage
msgid "noSuchUserByEmail"
msgstr "There is no account with this email"

#: org.apache.isis.viewer.wicket.ui.pages.accmngt.password_reset.PasswordResetPage
msgid "noUserForAnEmailValidToken"
msgstr "The account seems to be either already deleted or has changed its email address. Please try again."

#: org.apache.isis.viewer.wicket.ui.pages.accmngt.password_reset.PasswordResetPage
msgid "passwordChangeSuccessful"
msgstr "The password has been changed successfully. You can &lt;a class=\"alert-success\" style=\"text-decoration:underline;\" href=\"${signInUrl}\"&gt;login&lt;/a&gt; now."

#: org.apache.isis.viewer.wicket.ui.pages.accmngt.password_reset.PasswordResetPage
msgid "passwordChangeUnsuccessful"
msgstr "There was a problem while updating the password. Please try again."

#: org.apache.isis.viewer.wicket.ui.pages.accmngt.signup.RegistrationFormPage
#: org.apache.isis.viewer.wicket.ui.pages.accmngt.register.RegisterPage
#: org.apache.isis.viewer.wicket.ui.pages.login.WicketSignInPage
#: org.apache.isis.viewer.wicket.ui.pages.accmngt.password_reset.PasswordResetPage
msgid "passwordLabel"
msgstr "Password"

#: org.apache.isis.viewer.wicket.ui.pages.accmngt.signup.RegistrationFormPage
#: org.apache.isis.viewer.wicket.ui.pages.accmngt.register.RegisterPage
#: org.apache.isis.viewer.wicket.ui.pages.login.WicketSignInPage
#: org.apache.isis.viewer.wicket.ui.pages.accmngt.password_reset.PasswordResetPage
msgid "passwordPlaceholder"
msgstr "Enter password"

#: org.apache.isis.viewer.wicket.ui.pages.accmngt.password_reset.PasswordResetPage
msgid "passwordResetExpiredOrInvalidToken"
msgstr "You are trying to reset the password for an expired or invalid token"

#: org.apache.isis.viewer.wicket.ui.pages.accmngt.password_reset.PasswordResetPage
msgid "passwordResetHeader"
msgstr "Forgot password"

#: org.apache.isis.viewer.wicket.ui.pages.accmngt.password_reset.PasswordResetPage
msgid "passwordResetSubmitLabel"
msgstr "Submit"

#: org.apache.isis.viewer.wicket.ui.pages.login.WicketSignInPage
msgid "registerButtonLabel"
msgstr "Register"

#: org.apache.isis.viewer.wicket.ui.pages.accmngt.register.RegisterPage
msgid "registerHeader"
msgstr "Register"

#: org.apache.isis.viewer.wicket.ui.pages.login.WicketSignInPage
msgid "rememberMeLabel"
msgstr "Remember Me"

#: org.apache.isis.viewer.wicket.ui.pages.login.WicketSignInPage
msgid "resetButtonLabel"
msgstr "Reset"

#: org.apache.isis.viewer.wicket.ui.pages.login.WicketSignInPage
msgid "signInButtonLabel"
msgstr "Sign in"

#: org.apache.isis.viewer.wicket.ui.pages.login.WicketSignInPage
msgid "signUpButtonLabel"
msgstr "Don't have an account? Sign up now."

#: org.apache.isis.viewer.wicket.ui.pages.accmngt.signup.RegistrationFormPage
#: org.apache.isis.viewer.wicket.ui.pages.accmngt.register.RegisterPage
#: org.apache.isis.viewer.wicket.ui.pages.accmngt.password_reset.PasswordResetPage
msgid "signUpButtonLabel"
msgstr "Verify email"

#: org.apache.isis.viewer.wicket.ui.pages.accmngt.signup.RegistrationFormPage
msgid "signUpHeader"
msgstr "Sign Up"

#: org.apache.isis.viewer.wicket.ui.pages.accmngt.signup.RegistrationFormPage
#: org.apache.isis.viewer.wicket.ui.pages.accmngt.register.RegisterPage
#: org.apache.isis.viewer.wicket.ui.pages.accmngt.password_reset.PasswordResetPage
msgid "usernameIsNotAvailable"
msgstr "The provided username is already in use"

#: org.apache.isis.viewer.wicket.ui.pages.accmngt.signup.RegistrationFormPage
#: org.apache.isis.viewer.wicket.ui.pages.accmngt.register.RegisterPage
#: org.apache.isis.viewer.wicket.ui.pages.login.WicketSignInPage
#: org.apache.isis.viewer.wicket.ui.pages.accmngt.password_reset.PasswordResetPage
msgid "usernameLabel"
msgstr "Username"

#: org.apache.isis.viewer.wicket.ui.pages.accmngt.signup.RegistrationFormPage
#: org.apache.isis.viewer.wicket.ui.pages.accmngt.register.RegisterPage
#: org.apache.isis.viewer.wicket.ui.pages.login.WicketSignInPage
#: org.apache.isis.viewer.wicket.ui.pages.accmngt.password_reset.PasswordResetPage
msgid "usernamePlaceholder"
msgstr "Username"</code></pre> 
           </div> 
          </div> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="__ugbtb_i18n_integration-testing">2.5. Integration Testing</h3> 
         <div class="paragraph"> 
          <p>So much for the API; but as noted, it is also necessary to ensure that the required translations are recorded (by the <code>TranslationService</code>) into the <code>.pot</code> file.</p> 
         </div> 
         <div class="paragraph"> 
          <p>For this, we recommend that you ensure that all such methods are tested through an <a href="../ugtst/ugtst.html#_ugtst_integ-test-support">integration test</a> (not unit test).</p> 
         </div> 
         <div class="paragraph"> 
          <p>For example, here’s the corresponding integration test for the "Exclamation mark" example from the simpleapp (above):</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Rule</span>
<span class="directive">public</span> ExpectedException expectedException = ExpectedException.none();

<span class="annotation">@Inject</span>
FixtureScripts fixtureScripts;

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> failsValidation() <span class="directive">throws</span> <span class="exception">Exception</span> {
    <span class="comment">// given</span>
    RecreateSimpleObjects fs = <span class="keyword">new</span> RecreateSimpleObjects().setNumber(<span class="integer">1</span>);
    fixtureScripts.runFixtureScript(fs, <span class="predefined-constant">null</span>);
    SimpleObject simpleObjectWrapped = wrap(fs.getSimpleObjects().get(<span class="integer">0</span>));

    <span class="comment">// expect</span>
    expectedExceptions.expect(InvalidException.class);
    expectedExceptions.expectMessage(<span class="string"><span class="delimiter">"</span><span class="content">Exclamation mark is not allowed</span><span class="delimiter">"</span></span>);

    <span class="comment">// when</span>
    simpleObjectWrapped.updateName(<span class="string"><span class="delimiter">"</span><span class="content">new name!</span><span class="delimiter">"</span></span>);
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Running this test will result in the framework calling the <code>validateUpdateName(…​)</code> method, and thus to record that a translation is required in the <code>.pot</code> file.</p> 
         </div> 
         <div class="paragraph"> 
          <p>When the integration tests are complete (that is, when Apache Isis is shutdown), the <code>TranslationServicePo</code> will write out all captured translations to its log (more on this below). This will include all the translations captured from the Apache Isis metamodel, along with all translations as exercised by the integration tests.</p> 
         </div> 
         <div class="paragraph"> 
          <p>To ensure your app is fully internationalized app, you must therefore:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>use <code>TranslatableString</code> rather than <code>String</code> for all validation/disable and title methods.</p> </li> 
           <li> <p>ensure that (at a minimum) all validation messages and title methods are integration tested.</p> </li> 
          </ul> 
         </div> 
         <div class="admonitionblock note"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>We make no apologies for this requirement: one of the reasons that we decided to implement Apache Isis' i18n support in this way is because it encourages/requires the app to be properly tested.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Behind the scenes Apache Isis uses a JUnit rule (<code>ExceptionRecognizerTranslate</code>) to intercept any exceptions that are thrown. These are simply passed through to the registered <a href="../rgsvc/rgsvc.html#_rgsvc_presentation-layer-spi_ExceptionRecognizer"><code>ExceptionRecognizer</code></a>s so that any messages are recorded as requiring translation.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="_escaped_strings">2.6. Escaped strings</h3> 
         <div class="paragraph"> 
          <p>Translated messages can be escaped if required, eg to include embedded markup.</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="ini">#: com.mycompany.myapp.OrderItem#quantity
msgid "&lt;i&gt;Quantity&lt;/i&gt;"
msgstr "&lt;i&gt;Quantité&lt;/i&gt;"</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>For this to work, the <code>namedEscaped()</code> attribute must be specified using either the <a href="../ugvw/ugvw.html#_ugvw_layout_file-based">layout file</a>, or using an annotation such as <a href="../rgant/rgant.html#_rgant-PropertyLayout"><code>@PropertyLayout</code></a> or <a href="../rgant/rgant.html#_rgant-ParameterLayout"><code>@ParameterLayout</code></a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>For example:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ParameterLayout</span>(
    named=<span class="string"><span class="delimiter">"</span><span class="content">&lt;i&gt;Quantity&lt;/i&gt;</span><span class="delimiter">"</span></span>,      <i class="conum" data-value="1"></i><b>(1)</b>
    namedEscaped=<span class="predefined-constant">false</span>
)
<span class="directive">public</span> <span class="predefined-type">Integer</span> getQuantity() { ... }</code></pre> 
          </div> 
         </div> 
         <div class="colist arabic"> 
          <table> 
           <tbody>
            <tr> 
             <td><i class="conum" data-value="1"></i><b>1</b></td> 
             <td>required (even though it won’t be used when a translation is read; otherwise the escaped flag is ignored)</td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
        </div> 
        <div class="sect2"> 
         <h3 id="__ugbtb_i18n_configuration">2.7. Configuration</h3> 
         <div class="paragraph"> 
          <p>There are several different aspects of the translation service that can be configured.</p> 
         </div> 
         <div class="sect3"> 
          <h4 id="_logging">2.7.1. Logging</h4> 
          <div class="paragraph"> 
           <p>To configure the <code>TranslationServicePo</code> to write to out the <code>translations.pot</code> file, add the following to the <em>integtests</em> <code>logging.properties</code> file:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="ini">log4j.appender.translations-po=org.apache.log4j.FileAppender
log4j.appender.translations-po.File=./translations.pot
log4j.appender.translations-po.Append=false
log4j.appender.translations-po.layout=org.apache.log4j.PatternLayout
log4j.appender.translations-po.layout.ConversionPattern=%m%n

log4j.logger.org.apache.isis.core.runtime.services.i18n.po.PoWriter=INFO,translations-po
log4j.additivity.org.apache.isis.core.runtime.services.i18n.po.PotWriter=false</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>Just to repeat, this is <em>not</em> the <code>WEB-INF/logging.properties</code> file, it should instead be added to the <code>integtests/logging.properties</code> file.</p> 
          </div> 
         </div> 
         <div class="sect3"> 
          <h4 id="_location_of_the_code_po_code_files">2.7.2. Location of the <code>.po</code> files</h4> 
          <div class="paragraph"> 
           <p>The default location of the translated <code>.po</code> files is in the <code>WEB-INF</code> directory. These are named and searched for similarly to regular Java resource bundles.</p> 
          </div> 
          <div class="paragraph"> 
           <p>For example, assuming these translations:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="ini">/WEB-INF/translations-en-US.po
        /translations-en.po
        /translations-fr-FR.po
        /translations.po</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>then:</p> 
          </div> 
          <div class="ulist"> 
           <ul> 
            <li> <p>a user with <code>en-US</code> locale will use <code>translations-en-US.po</code></p> </li> 
            <li> <p>a user with <code>en-GB</code> locale will use <code>translations-en.po</code></p> </li> 
            <li> <p>a user with <code>fr-FR</code> locale will use <code>translations-fr-FR.po</code></p> </li> 
            <li> <p>a user with <code>fr-CA</code> locale will use <code>translations.po</code></p> </li> 
           </ul> 
          </div> 
          <div class="paragraph"> 
           <p>The basename for translation files is always <code>translations</code>; this cannot be altered.</p> 
          </div> 
         </div> 
         <div class="sect3"> 
          <h4 id="_externalized_translation_files">2.7.3. Externalized translation files</h4> 
          <div class="paragraph"> 
           <p>Normally Apache Isis configuration files are read from the <code>WEB-INF</code> file. However, Apache Isis can be configured to read config files from an <a href="../ugbtb/ugbtb.html#_ugbtb_deployment_externalized-configuration">external directory</a>; this is also supported for translations.</p> 
          </div> 
          <div class="paragraph"> 
           <p>Thus, if in <code>web.xml</code> the external configuration directory has been set:</p> 
          </div> 
          <div class="paragraph"> 
           <p>TODO: v2: this almost certainly no longer workd, because we now set up configuration very early on.</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>isis.config.dir<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>location of external config directory<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>Then this directory will be used as the base for searching for translations (rather than the default 'WEB-INF/' directory).</p> 
          </div> 
         </div> 
         <div class="sect3"> 
          <h4 id="_force_read_mode_or_disable">2.7.4. Force read mode, or disable</h4> 
          <div class="paragraph"> 
           <p>As noted above, if running in prototype mode then <code>TranslationServicePo</code> will be in write mode, if in production mode then will be in read mode. To force read mode (ie use translations) even if in prototype mode, add the following configuration property to <code>isis.properties</code>:</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="ini">isis.services.translation.po.mode=read</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>It’s also possible to disable the service completely (using values 'disable' or 'disabled'). This can sometimes be useful in integration tests.</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="ini">isis.services.translation.po.mode=disable</code></pre> 
           </div> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>== Supporting services

The `TranslationServicePo` has a number of supporting/related services.

=== `LocaleProvider`

The `LocaleProvider` API is used by the `TranslationServicePo` implementation to obtain the locale of the "current user".

A default implementation is provided by the Wicket viewer.

[NOTE]
====
Note that this default implementation does not support requests made through the Restful Objects viewer (there is no Wicket 'application' object available); the upshot is that requests through Restful Objects are never translated.
Registering a different implementation of `LocaleProvider` that taps into appropriate REST (RestEasy?) APIs would be the way to address this.
====


=== `TranslationsResolver`

The `TranslationResolver` is used by the `TranslationService` implementation to lookup translations for a specified locale.
It is this service that reads from the `WEB-INF/` (or externalized directory).


=== `TranslationServicePoMenu`

The `TranslationServicePoMenu` provides a couple of menu actions in the UI (prototype mode only) that interacts with the underlying `TranslationServicePo`:

* the `downloadTranslationsFile()` action - available only in write mode - allows the current `.pot` file to be downloaded. +
+
[NOTE]
====
While this will contain all the translations from the metamodel, it will not necessarily contain all translations for all imperative methods returning `TranslatableString` instances; which are present and which are missing will depend on which imperative methods have been called (recorded by the service) prior to downloading.
====

* the `clearTranslationsCache()` action - available only in read mode - will clear the cache so that new translations can be loaded. +
+
This allows a translator to edit the appropriate `translations-xx-XX.po` file and check the translation is correct without having to restart the app.





:leveloffset!:
:leveloffset: +1

[[_ugbtb_headless-access]]
= Headless access
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
:_basedir: ../../
:_imagesdir: images/

This section tackles the topic of enabling access to an Apache Isis application directly, or at least, not through either the xref:../ugvw/ugvw.adoc#[Wicket] or xref:../ugvro/ugvro.adoc#[Restful] viewers.

There are several main use-cases:

* enabling background execution, eg of a thread managed by Quartz scheduler and running within the webapp

* integration from other systems, eg for a subscriber on a pub/sub mechanism such as Camel, pushing changes through an Apache Isis domain model.

* leveraging an Apache Isis application within a batch process

Note that the calling thread runs in the same process space as the Apache Isis domain object model (must be physically linked to the JAR files containing the domain classes).  For use cases where the calling thread runs in some other process space (eg migrating data from a legacy system), then the xref:../ugvro/ugvro.adoc#[Restful Objects viewer] is usually the way to go.

The API described in this chapter is reasonably low-level, allowing code to interact very directly with the Apache Isis metamodel and runtime.  Such callers should be considered trusted: they do not (by default) honour any business rules eg implicit in the Isis annotations or hide/disable/validate methods.  However the xref:../rgsvc/rgsvc.adoc#_rgsvc_application-layer-api_WrapperFactory[`WrapperFactory`] service could be used to enforce such business rules if required.



:leveloffset: +1

[[_ugbtb_headless-access_AbstractIsisSessionTemplate]]
= AbstractIsisSessionTemplate
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
:_basedir: ../../
:_imagesdir: images/


The `AbstractIsisSessionTemplate` class (whose name is inspired by the Spring framework's naming convention for similar classes that query http://docs.spring.io/spring/docs/2.5.x/reference/jdbc.html#jdbc-JdbcTemplate[JDBC], http://docs.spring.io/spring/docs/2.5.x/reference/jms.html#jms-jmstemplate[JMS], http://docs.spring.io/spring/docs/2.5.x/reference/orm.html#orm-jpa-template[JPA] etc.) provides the mechanism to open up a 'session' within the Apache Isis framework, in order to resolve and interact with entities.

The class itself is intended to be subclassed:

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>public abstract class AbstractIsisSessionTemplate {</p> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>public void execute(final AuthenticationSession authSession, final Object context) { ... } <i class="conum" data-value="1"></i><b>(1)</b>
protected abstract void doExecute(Object context); <i class="conum" data-value="2"></i><b>(2)</b></pre> 
           </div> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>protected ObjectAdapter adapterFor(final Object targetObject) { ... }
protected ObjectAdapter adapterFor(final RootOid rootOid) { ... }</pre> 
           </div> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>    protected PersistenceSession getPersistenceSession() { ... }
    protected IsisTransactionManager getTransactionManager() { ... }
    protected AdapterManager getAdapterManager() { ... }
}</pre> 
           </div> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>&lt;1&gt; `execute(...)` sets up the `IsisSession` and delegates to ...
&lt;2&gt; `doExecute(...)`, the mandatory hook method for subclasses to implement.
The passed object represents passes a context from the caller (eg the scheduler, cron job, JMS etc) that instantiated and executed the class.

The `protected` methods expose key internal APIs within Apache Isis, for the subclass to use as necessary.


[TIP]
====
One notable feature of `AbstractIsisSessionTemplate` is that it will automatically inject any domain services into itself. Thus, it is relatively easy for the subclass to "reach into" the domain, through injected repository services.
====




:leveloffset: 1
:leveloffset: +1

[[_ugbtb_headless-access_BackgroundCommandExecution]]
= BackgroundCommandExecution
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
:_basedir: ../../
:_imagesdir: images/



The `BackgroundCommandExecution` class (a subclass of xref:../ugbtb/ugbtb.adoc#_ugbtb_headless-access_AbstractIsisSessionTemplate[AbstractIsisSessionTemplate]) is intended to simplify the execution of background ``Command``s persisted by way of the xref:../rgsvc/rgsvc.adoc#_rgsvc_application-layer-spi_CommandService[`CommandService`] and the xref:../rgsvc/rgsvc.adoc#_rgsvc_application-layer-spi_BackgroundCommandService[`BackgroundCommandService`].

Its signature is:

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>public abstract class BackgroundCommandExecution extends AbstractIsisSessionTemplate { protected void doExecute(Object context) { …​ } protected abstract List&lt;? extends Command&gt; findBackgroundCommandsToExecute(); // &lt;1&gt; }</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>&lt;1&gt; `findBackgroundCommandsToExecute()` is a mandatory hook method for subclasses to implement.

This allows for different implementations of the `CommandService` and `BackgroundCommandService` to persist to wherever.

The diagram below (http://yuml.me/edit/363b335f[yuml.me/363b335f]) shows the dependencies between these various classes:

.Inheritance Hierarchy for `BackgroundCommandExecution`
image::{_imagesdir}headless-access/BackgroundCommandExecution.png[width="400px",link="{_imagesdir}headless-access/BackgroundCommandExecution.png"]







== Background Execution

The `BackgroundCommandExecutionFromBackgroundCommandServiceJdo` is a concrete subclass of `BackgroundCommandExecution` (see the xref:../rgsvc/rgsvc.adoc#_rgsvc_application-layer-api_BackgroundService[`BackgroundCommandService`]), the intended use being for the class to be instantiated regularly (eg every 10 seconds) by a scheduler such as http://quartz-scheduler.org[Quartz]) to poll for ``Command``s to be executed, and then execute them.

This implementation queries for ``Command``s persisted by the (non-ASF) link:http://platform.incode.org[Incode Platform^]'s command module's  implementations of xref:../rgsvc/rgsvc.adoc#_rgsvc_application-layer-spi_CommandService[`CommandService`] and xref:../rgsvc/rgsvc.adoc#_rgsvc_application-layer-spi_BackgroundCommandService[`BackgroundCommandService`] using the `BackgroundCommandServiceJdoRepository`.

The diagram below (link:http://yuml.me/edit/25343da1[yuml.me/25343da1]) shows the inheritance hierarchy for this class:

.Inheritance Hierarchy for `BackgroundCommandExecutionFromBackgroundCommandServiceJdo`
image::{_imagesdir}headless-access/BackgroundCommandExecutionFromBackgroundCommandServiceJdo.png[width="500px"]


:leveloffset: 1




:leveloffset: 1
:leveloffset: +1

:_basedir: ../../
:_imagesdir: images/
[[_ugbtb_hints-and-tips]]
= Hints and Tips
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
:toc: right


This chapter provides some solutions for problems we've encountered ourselves or have been raised on the Apache Isis mailing lists.

See also hints-n-tips chapters in the:

* the xref:../dg/dg.adoc#_dg_hints-and-tips[Developers'] guide

* the xref:../ugvw/ugvw.adoc#_ugvw_hints-and-tips[Wicket viewer] guide

* the xref:../ugvro/ugvro.adoc#_ugvro_hints-and-tips[Restful Objects viewer] guide

* the xref:../ugodn/ugodn.adoc#_ugodn_hints-and-tips[Datanucleus ObjectStore] guide

* the xref:../ugsec/ugsec.adoc#_ugsec_hints-and-tips[Security] guide

* the xref:../ugbtb/ugbtb.adoc#_ugbtb_hints-and-tips[Beyond the Basics] guide (this chapter).


// tag::inclusions[]

:leveloffset: +1

[[_ugbtb_hints-and-tips_are-you-sure]]
= 'Are you sure?' idiom
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.


Sometimes an action might perform irreversible changes.
In such a case it's probably a good idea for the UI to require that the end-user explicitly confirms that they intended to invoke the action.

== Using action semantics

One way to meet this requirement is using the framework's built-in xref:../rgant/rgant.adoc#_rgant-Action_semantics[`@Action#semantics()`] attribute:

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>@Action( semantics = SemanticsOf.IDEMPOTENT_ARE_YOU_SURE ) public SimpleObject updateName( @Parameter(maxLength = NAME_LENGTH) @ParameterLayout(named = "New name") final String name) { setName(name); return this; }</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>This will render as:

image::{_imagesdir}hints-and-tips/action-semantics-are-you-sure.png[link="{_imagesdir}hints-and-tips/action-semantics-are-you-sure.png"]


== Using a checkbox

An alternative approach (for all versions of the framework) is to require the end-user to check a dummy checkbox parameter (and prevent the action from being invoked if the user hasn't checked that parameter).

For example:

image::{_imagesdir}hints-and-tips/are-you-sure.png[link="{_imagesdir}hints-and-tips/are-you-sure.png"]

[NOTE]
====
Note that these screenshots shows an earlier version of the xref:../ugvw/ugvw.adoc#[Wicket viewer] UI (specifically, pre 1.8.0).
====

If the user checks the box:

image::{_imagesdir}hints-and-tips/are-you-sure-happy-case.png[link="{_imagesdir}hints-and-tips/are-you-sure-happy-case.png"]

then the action will complete.

However, if the user fails to check the box, then a validation message is shown:

image::{_imagesdir}hints-and-tips/are-you-sure-sad-case.png[link="{_imagesdir}hints-and-tips/are-you-sure-sad-case.png"]



The code for this is pretty simple:

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>public List&lt;ToDoItem&gt; delete(@ParameterLayout(named="Are you sure?") boolean areYouSure) { repositoryService.remove(this); messageService.informUser("Deleted " + titleService.titleOf(this)); return toDoItems.notYetComplete(); // &lt;1&gt; } public String validateDelete(boolean areYouSure) { return areYouSure? null: "Please confirm you are sure"; }</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>&lt;1&gt; invalid to return `this` (cannot render a deleted object)

Note that the action itself does not use the boolean parameter, it is only used by the supporting xref:../rgcms/rgcms.adoc#_rgcms_methods_prefixes_validate[`validate...()`] method.

:leveloffset: 1
:leveloffset: +1

[[_ugbtb_hints-and-tips_replacing-default-service-implementations]]
= Overriding Default Service Implns
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.



The framework provides default implementations for many of the xref:../rgsvc/rgsvc.adoc#[domain services].
This is convenient, but sometimes you will want to replace the default implementation with your own service implementation.

For example, suppose you wanted to provide your own implementation of xref:../rgsvc/rgsvc.adoc#_rgsvc_presentation-layer-spi_LocaleProvider[`LocaleProvider`].
The trick is to use the xref:../rgant/rgant.adoc#_rgant-DomainService_menuOrder[`@DomainService#menuOrder()`] attribute, specifying a low number (typically `"1"`).

Here's how:

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>@DomainService( nature = NatureOfService.DOMAIN ) public class MyLocaleProvider implements LocaleProvider { @Override public Locale getLocale() { return …​ } }</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>The framework uses the value of the `menuOrder` attribute to determine priority; lowest number wins.

However, there is no need to specify the `menuOrder` attribute: its default value is now set to a lower value (specifically: `Integer.MAX_VALUE - 100`) than all of the framework-provided implementations, and thus always takes precedence.

Thus, if a single instance is to be injected, eg:

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>@javax.inject.Inject LocalProvider localeProvider;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>then the custom implementation will be used in preference to the framework's default implementation.

If multiple instances are injected, eg:

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>@javax.inject.Inject List&lt;LocalProvider&gt; localeProviders;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>then all implementations will be present in the list, ordered by priority; your custom implementation will be first in the list.





[NOTE]
====
It is also possible to use xref:../rgant/rgant.adoc#_rgant-DomainServiceLayout_menuOrder[`@DomainServiceLayout#menuOrder()`] attribute, rather than xref:../rgant/rgant.adoc#_rgant-DomainService_menuOrder[`@DomainService#menuOrder()`].
The general convention is to use the former only for services that are rendered in the UI, the latter for programmatic services.

If both attributes are present, then the value of xref:../rgant/rgant.adoc#_rgant-DomainServiceLayout_menuOrder[`@DomainServiceLayout#menuOrder()`] is used.
====



== Decorating existing implementations

It's also quite common to want to decorate the existing implementation (ie have your own implementation delegate to the default); this is also possible and quite easy:

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>@DomainService( nature = NatureOfService.DOMAIN ) @DomainServiceLayout( menuOrder = "1" // &lt;1&gt; ) public class MyLocaleProvider implements LocaleProvider { @Override public Locale getLocale() { return getDelegateLocaleProvider().getLocale(); // &lt;2&gt; } Optional&lt;LocaleProvider&gt; delegateLocaleProvider; // &lt;3&gt; private LocaleProvider getDelegateLocaleProvider() { if(delegateLocaleProvider == null) { delegateLocaleProvider = Iterables.tryFind(localeProviders, input → input != this); // &lt;4&gt; } return delegateLocaleProvider.orNull(); } @Inject List&lt;LocaleProvider&gt; localeProviders; // &lt;5&gt; }</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>&lt;1&gt; takes precedence over the default implementation when injected elsewhere.
&lt;2&gt; this implementation merely delegates to the default implementation
&lt;3&gt; lazily populated
&lt;4&gt; delegate to the first implementation that isn't _this_ implementation (else infinite loop!)
&lt;5&gt; Injects all implementations, including this implemenation


:leveloffset: 1
:leveloffset: +1

[[_ugbtb_hints-and-tips_vetoing-visibility]]
= Vetoing Visibility
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.


NOTE: FIXME - a write-up of the "vetoing subscriber" design pattern, eg as described in the  xref:../rgsvc/rgsvc.adoc#_rgsvc_integration-api_BookmarkService[`BookmarkService`]


eg if included an addon such as auditing or security.

solution is to write a domain event subscriber that vetoes the visibility

All the addons actions inherit from common base classes so this can be as broad-brush or fine-grained as required

:leveloffset: 1
:leveloffset: +1

[[_ugbtb_hints-and-tips_transactions-and-errors]]
= Transactions and Errors
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.

In Apache Isis, every interaction (action invocation or property edit) is automatically wrapped in a transaction,
and any repository query automatically does a flush before hand.

What that means is that there's no need to explicitly start or commit transactions in Apache Isis; this will be done
for you. Indeed, if you do try to manage transactions (eg by reaching into the JDO `PersistenceManager` exposed by the
xref:../rgsvc/rgsvc.adoc#_rgsvc_persistence-layer-api_IsisJdoSupport[IsisJdoSupport] domain service, then you are likely to confuse the
framework and get a stack trace for your trouble.

However, you can complete a given transaction and start a new one.  This is sometimes useful if writing a fixture
script which is going to perform some sort of bulk migration of data from an old system.  For this use case, use the
xref:../rgsvc/rgsvc.adoc#_rgsvc_application-layer-api_TransactionService[`TransactionService`].

For example:

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>public class SomeLongRunningFixtureScript extends FixtureScript</p> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>protected void execute(final ExecutionContext executionContext) {
    // do some work
    transactionService.nextTransaction();
    // do some work
    transactionService.nextTransaction();
    // do yet more work
}</pre> 
           </div> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>    @javax.inject.Inject
    TransactionService transactionService;
}</pre> 
           </div> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>You get the idea.


== Raise message in the UI

The framework provides the xref:../rgsvc/rgsvc.adoc#_rgsvc_application-layer-api_MessageService[`MessageService`] as a means to return an out-of-band
message to the end-user.  In the xref:../ugvw/ugvw.adoc#[Wicket viewer] these are shown as "toast" pop-ups; the
xref:../ugvro/ugvro.adoc#[Restful Objects viewer] returns an HTTP header.

The `UserService` provides three APIs, for different:

* `informUser()` - an informational message.  In the Wicket viewer these are short-lived pop-ups that disappear after a short time.
* `warnUser()` - a warning.  In the Wicket viewer these do not auto-close; they must be acknowledged.
* `raiseError()` - an error.  In the Wicket viewer these do not auto-close; they must be acknowledged.

Each pop-up has a different background colour indicating its severity.

None of these messages/errors has any influence on the transaction; any changes to objects will be committed.


== Aborting transactions

If you want to abort Apache Isis' transaction, this can be done by throwing an exception.  The exception message
is displayed to the user on the error page (if xref:../ugvw/ugvw.adoc#[Wicket viewer]) or a 500 status error code (if the
xref:../ugvro/ugvro.adoc#[Restful Objects] viewer).

If the exception thrown is because of an unexpected error (eg a `NullPointerException` in the domain app itself), then
the error page will include a stack trace.  If however you want to indicate that the exception is in some sense
"expected", then throw a `RecoverableException` (or any subclass, eg `ApplicationException`); the stack trace will then
be suppressed from the error page.

Another way in which exceptions might be considered "expected" could be as the result of attempting to persist an
object which then violates some type of database constraint.  Even if the domain application checks beforehand, it
could be that another user operating on the object at the same moment of time might result in the conflict.

To handle this the xref:../rgsvc/rgsvc.adoc#_rgsvc_presentation-layer-spi_ExceptionRecognizer[`ExceptionRecognizer`] SPI can be used.  The
framework provides a number of implementations out-of-the-box; whenever an exception is thrown it is passed to each
known recognizer implementation to see if it recognizes the exception and can return a user-meaningful error message.
For example, `ExceptionRecognizerForSQLIntegrityConstraintViolationUniqueOrIndexException` checks if the
exception inherits from `java.sql.SQLIntegrityConstraintViolationException`, and if so, constructs a suitable message.


:leveloffset: 1
:leveloffset: +1

[[_ugbtb_hints-and-tips_persisted-title]]
= Persisted Title
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.



Normally the title of an object is not persisted to the database, rather it is recomputed automatically from underlying properties.  On occasion though you might want the title to also be persisted; either to make things easier for the DBA, or for an integration scenario, or some other purpose.

We can implement this feature by leveraging the xref:../rgcms/rgcms.adoc#_rgcms_methods_lifecycle_jdo-api[JDO lifecycle].  In the design we discuss here we make it a responsibility of the entities to persist the title as a property, by implementing a `ObjectWithPersistedTitle` interface:

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>public interface ObjectWithPersistedTitle { @PropertyLayout(hidden = Where.EVERYWHERE) // &lt;1&gt; String getTitle(); void setTitle(final String title); }</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>&lt;1&gt; we don't want to expose this in the UI because the title is already prominently displayed.

We can then define a subscribing domain service that leverage this.

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>@DomainService(nature = NatureOfService.DOMAIN) public class TitlingService extends AbstractSubscriber { @Subscribe public void on(final ObjectPersistingEvent ev) { handle(ev.getSource()); } @Subscribe public void on(final ObjectUpdatingEvent ev) { handle(ev.getSource()); } private void handle(final Object persistentInstance) { if(persistentInstance instanceof ObjectWithPersistedTitle) { final ObjectWithPersistedTitle objectWithPersistedTitle = (ObjectWithPersistedTitle) persistentInstance; objectWithPersistedTitle.setTitle(titleService.titleOf(objectWithPersistedTitle)); } } @Inject TitleService titleService; }</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>It is also possible to accomplish this by accessing the JDO API directly:

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>@RequestScoped @DomainService(nature = NatureOfService.DOMAIN) public class TitlingService { @PostConstruct public void init() { isisJdoSupport.getJdoPersistenceManager().addInstanceLifecycleListener( new StoreLifecycleListener() { @Override public void preStore(final InstanceLifecycleEvent event) { final Object persistentInstance = event.getPersistentInstance(); if(persistentInstance instanceof ObjectWithPersistedTitle) { final ObjectWithPersistedTitle objectWithPersistedTitle = (ObjectWithPersistedTitle) persistentInstance; objectWithPersistedTitle.setTitle(titleService.titleOf(objectWithPersistedTitle)); } } @Override public void postStore(final InstanceLifecycleEvent event) { } }, null); } @Inject IsisJdoSupport isisJdoSupport; @Inject TitleService titleService; }</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>The above is probably the easiest and most straightforward design. One could imagine other designs where the persisted title is stored elsewhere.  It could even be stored off into an link:http://lucene.apache.org/[Apache Lucene] (or similar) database to allow for free-text searches.


:leveloffset: 1
:leveloffset: +1

[[_ugbtb_hints-and-tips_view-model-instantiation]]
= View Model Instantiation
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.


Vith view models, some care must be taken in how they are instantiated.
Specifically, it's important that the framework doesn't "know" about the view model until its state is "sufficiently" populated to distinguish from other view models.

In practical terms, this means that view models should be instantiated using a constructor, and then injecting services (if required) using the xref:../rgsvc/rgsvc.adoc#_rgsvc_metadata-api_ServiceRegistry[`ServiceRegistry`] service:

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>CustomerViewModel viewModel = new CustomerViewModel("Joe", "Bloggs"); serviceRegistry.injectServicesInto(viewModel);</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>What will most likely *fail* is to use the xref:../rgsvc/rgsvc.adoc#_rgsvc_core-domain-api_FactoryService[`FactoryService`]:


[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>CustomerViewModel viewModel = factoryService.instantiate(CustomerViewModel.class);</p> 
          </div> 
          <div class="paragraph"> 
           <p>viewModel.setFirstName("Joe"); viewModel.setLastName("Bloggs"); serviceRegistry.injectServicesInto(viewModel);</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>That's because the internal "OID" identifier that the framework creates to handle this view model will be incomplete.
Although the framework can handle changes to the OID (when the corresponding view model's state changes) once created, this isn't the case during initial instantiation process.


== Example

To explain further, here's an implementation using `FactoryService` that fails:

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>@XmlRootElement(name = "yearSummary") @XmlType( propOrder = { …​ } ) @XmlAccessorType(XmlAccessType.FIELD) public class YearSummary { // &lt;1&gt; …​ @XmlTransient @CollectionLayout(defaultView = "table") public List&lt;OfficeOptionViewModel&gt; getAmountsPerOffice() { List&lt;OfficeOptionViewModel&gt; amountsPerOffice = new ArrayList&lt;&gt;();</p> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>OfficeOptionViewModel office1 =                                     <i class="conum" data-value="2"></i><b>(2)</b>
    factoryService.instantiate(OfficeOptionViewModel.class);
office1.setOffice("Amsterdam");                                     <i class="conum" data-value="3"></i><b>(3)</b>
office1.setAmount(200);
amountsPerOffice.add(office1);</pre> 
           </div> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>OfficeOptionViewModel office2 =                                     <i class="conum" data-value="2"></i><b>(2)</b>
    factoryService.instantiate(OfficeOptionViewModel.class);
office2.setOffice("London");                                        <i class="conum" data-value="3"></i><b>(3)</b>
office2.setAmount(100);
amountsPerOffice.add(office2);</pre> 
           </div> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>        return amountsPerOffice;
    }
}</pre> 
           </div> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>&lt;1&gt; Parent view model
&lt;2&gt; Using `FactoryService`, incorrectly.
&lt;3&gt; Hard-coded just for demo purposes

This collection, is, confusing, rendered as:

image::{_imagesdir}hints-and-tips/view-model-fail.png[width="800px",link="{_imagesdir}hints-and-tips/view-model-fail.png"]

Even though the `amountsPerOffice` collection of view models is correctly populated, the framework/viewer maps these to their corresponding OIDs before they are rendered.
Because the "Amsterdam" pojo and "London" pojo each mapped to the same OID, when fetching out the results the viewer obtains the London pojo both times.

The following implementation, on the other hand, succeeds:



[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>@XmlRootElement(name = "yearSummary") @XmlType( propOrder = { …​ } ) @XmlAccessorType(XmlAccessType.FIELD) public class YearSummary { …​ @XmlTransient @CollectionLayout(defaultView = "table") public List&lt;OfficeOptionViewModel&gt; getAmountsPerOffice() { List&lt;OfficeOptionViewModel&gt; amountsPerOffice = new ArrayList&lt;&gt;();</p> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>OfficeOptionViewModel office1 = new OfficeOptionViewModel("Amsterdam", 200);    <i class="conum" data-value="1"></i><b>(1)</b>
serviceRegistry.injectServicesInto(office1);
amountsPerOffice.add(office1);</pre> 
           </div> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>OfficeOptionViewModel office2 = new OfficeOptionViewModel("London", 100);       <i class="conum" data-value="1"></i><b>(1)</b>
serviceRegistry.injectServicesInto(office2);
amountsPerOffice.add(office2);</pre> 
           </div> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>        return amountsPerOffice;
    }
}</pre> 
           </div> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>&lt;1&gt; Just instantiate with constructor.
The framework "sees" the domain object when services are injected into it.

As can be seen, this renders just fine:

image::{_imagesdir}hints-and-tips/view-model-success.png[width="800px",link="{_imagesdir}hints-and-tips/view-model-success.png"]


To complicate matters a little, note though that following "incorrect" implementation using `FactoryService` does also work correctly:

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>@XmlRootElement(name = "yearSummary") @XmlType( propOrder = { …​, "amountsPerOffice" } ) // &lt;1&gt; @XmlAccessorType(XmlAccessType.FIELD) public class YearSummary { …​</p> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>void init() {
    amountsPerOffice = calculateAmountsPerOffice();
}</pre> 
           </div> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>@XmlElementWrapper
@XmlElement(name = "officeOption")
@CollectionLayout(defaultView = "table")
@Getter @Setter
private List&lt;OfficeOptionViewModel&gt; amountsPerOffice = Lists.newArrayList();</pre> 
           </div> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>@XmlTransient
   @CollectionLayout(defaultView = "table")
   public List&lt;OfficeOptionViewModel&gt; calculateAmountsPerOffice() {
       List&lt;OfficeOptionViewModel&gt; amountsPerOffice = new ArrayList&lt;&gt;();</pre> 
           </div> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>OfficeOptionViewModel office1 = factoryService.instantiate(OfficeOptionViewModel.class);
office1.setOffice("Amsterdam");
office1.setAmount(200);</pre> 
           </div> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>amountsPerOffice.add(office1);</pre> 
           </div> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>OfficeOptionViewModel office2 = factoryService.instantiate(OfficeOptionViewModel.class);
office2.setOffice("London");
office2.setAmount(100);</pre> 
           </div> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>amountsPerOffice.add(office2);</pre> 
           </div> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>        return amountsPerOffice;
    }
}</pre> 
           </div> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>&lt;1&gt; "amountsPerOffice" is part of the state of the parent view model

In this case the `amountsPerOffice` collection is part of the state of the parent view model and so in this particular case everything works with either `FactoryService#instantiate` or using `ServiceRegistry`.


:leveloffset: 1

:leveloffset: +1

[[_ugbtb_hints-and-tips_simulating-collections-of-values]]
= Collections of values
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.



Although in Apache Isis you can have properties of either values (string, number, date etc) or of (references to other) entities, with collections the framework (currently) only supports collections of (references to) entities.  That is, collections of values (a bag of numbers, say) are not supported.

However, it is possible to simulate a bag of numbers using view models.


== View Model

NOTE: FIXME



== Persistence Concerns

NOTE: FIXME -  easiest to simply store using DataNucleus' support for collections, marked as xref:../rgant/rgant.adoc#_rgant-Programmatic[`@Programmatic`] so that it is ignored by Apache Isis.  Alternatively can store as json/xml in a varchar(4000) or clob and manually unpack.


:leveloffset: 1

:leveloffset: +1

[[_ugbtb_hints-and-tips_how-to-handle-void-and-null-results]]
= How to handle void/null results
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.



From this link:http://isis.markmail.org/thread/yf7qdeiu3vrvk2ei[thread] on the Apache Isis users mailing list:

* _When using a `void` action, let's say a remove action, the user is redirected to a
page "no results".
When clicking the back button in the browser the user sees "Object not found" (since you've just deleted this object)._

* _You can return a list for example to prevent the user from being redirect to a
  "No results" page, but I think it's not the responsibility of the controllers in
  the domain model._

* _A solution could be that wicket viewer goes back one page when
  encountering a deleted object.
And refresh the current page when receiving a null response or invoking a void action.
But how to implement this?_

One way to implement this idea is to provide a custom implementation of the xref:../rgsvc/rgsvc.adoc#_rgsvc_presentation-layer-spi_RoutingService[`RoutingService`] SPI domain service.
The default implementation will either return the current object (if not null), else the home page (as defined by xref:../rgant/rgant.adoc#_rgant-HomePage[`@HomePage`]) if one exists.

The following custom implementation refines this to use the breadcrumbs (available in the Wicket viewer) to return the first non-deleted domain object found in the list of breadcrumbs:

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>@DomainService(nature = NatureOfService.DOMAIN) @DomainServiceLayout(menuOrder = "1") // &lt;1&gt; public class RoutingServiceUsingBreadcrumbs extends RoutingServiceDefault { @Override public Object route(final Object original) { if(original != null) { // &lt;2&gt; return original; } repositoryService.flush(); // &lt;3&gt;</p> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>final BreadcrumbModelProvider wicketSession =                           <i class="conum" data-value="4"></i><b>(4)</b>
    (BreadcrumbModelProvider) AuthenticatedWebSession.get();
final BreadcrumbModel breadcrumbModel =
    wicketSession.getBreadcrumbModel();
final List&lt;EntityModel&gt; breadcrumbs = breadcrumbModel.getList();</pre> 
           </div> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>final Optional&lt;Object&gt; firstViewModelOrNonDeletedPojoIfAny =
        breadcrumbs.stream()                                            <i class="conum" data-value="5"></i><b>(5)</b>
        .filter(entityModel -&gt; entityModel != null)
        .map(EntityModel::getObject)                                    <i class="conum" data-value="6"></i><b>(6)</b>
        .filter(objectAdapter -&gt; objectAdapter != null)
        .map(ObjectAdapter::getObject)                                  <i class="conum" data-value="7"></i><b>(7)</b>
        .filter(pojo -&gt; !(pojo instanceof Persistable) ||
                        !((Persistable)pojo).dnIsDeleted())             <i class="conum" data-value="8"></i><b>(8)</b>
        .findFirst();</pre> 
           </div> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>        return firstViewModelOrNonDeletedPojoIfAny.orElse(homePage());          <i class="conum" data-value="9"></i><b>(9)</b>
    }
    private Object homePage() {
        return homePageProviderService.homePage();
    }
    @Inject
    HomePageProviderService homePageProviderService;
    @Inject
    RepositoryService repositoryService;
}</pre> 
           </div> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>&lt;1&gt; override the default imlpementation
&lt;2&gt; if a non-null object was returned, then return this
&lt;3&gt; ensure that any persisted objects have been deleted.
&lt;4&gt; reach inside the Wicket viewer's internals to obtain the list of breadcrumbs.
&lt;5&gt; loop over all breadcrumbs
&lt;6&gt; unwrap the Wicket viewer's serializable representation of each domain object (`EntityModel`) to the Isis runtime's
representation (`ObjectAdapter`)
&lt;7&gt; unwrap the Isis runtime's representation of each domain object (`ObjectAdapter`) to the domain object pojo itself
&lt;8&gt; if object is persistable (not a view model) then make sure it is not deleted
&lt;9&gt; return the first object if any, otherwise the home page object (if any).

Note that the above implementation uses Java 8, so if you are using Java 7 then you'll need to backport accordingly.

:leveloffset: 1
:leveloffset: +1

[[_ugbtb_hints-and-tips_multi-tenancy]]
= Multi-tenancy
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.


Of the various modules provided by the (non-ASF) link:http://platform.incode.org[Incode Platform^], the security module has the most features.
One significant feature is the ability to associate users and objects with a "tenancy".


For more details, see the link:http://platform.incode.org[Incode Platform^]'s security module README.



:leveloffset: 1

:leveloffset: +1

[[_ugbtb_hints-and-tips_subclass-properties-in-tables]]
= Subclass properties in tables
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.



Suppose you have a hierarchy of classes where a property is derived and abstract in the superclass, concrete implementations in the subclasses. For example:

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>public abstract class LeaseTerm { public abstract BigDecimal getEffectiveValue(); …​ }</p> 
          </div> 
          <div class="paragraph"> 
           <p>public class LeaseTermForIndexableTerm extends LeaseTerm { public BigDecimal getEffectveValue() { …​ } …​ }</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>Currently the Wicket viewer will not render the property in tables (though the property is correctly rendered in views).

[NOTE]
====
For more background on this workaround, see https://issues.apache.org/jira/browse/ISIS-582[ISIS-582].
====

The work-around is simple enough; make the method concrete in the superclass and return a dummy implementation, eg:

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>public abstract class LeaseTerm { public BigDecimal getEffectiveValue() { return null; // workaround for ISIS-582 } …​ }</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>Alternatively the implementation could throw a `RuntimeException`, eg

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>throw new RuntimeException("never called; workaround for ISIS-582");</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>:leveloffset: 1
:leveloffset: +1

[[_ugbtb_hints-and-tips_pushing-changes]]
= Pushing Changes (deprecated)
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.


[NOTE]
====
This technique is much less powerful than using ../ugfun/ugfun.adoc#_ugfun_building-blocks_events_domain-events[the event bus] or an SPI service.
We present it mostly for completeness.
====




== When a property is changed

If you want to invoke functionality whenever a property is changed by the user, then you can create a supporting `modifyXxx()` method and include the functionality within that. The syntax is:

[source,java]
--
public void modifyPropertyName(PropertyType param) { ... }
--

Why not just put this functionality in the setter? Well, the setter is used by the object store to recreate the state of an already persisted object. Putting additional behaviour in the setter would cause it to be triggered incorrectly.

For example:

[source,java]
--
public class Order() {
    public Integer getAmount() { ... }
    public void setAmount(Integer amount) { ... }
    public void modifyAmount(Integer amount) { <i class="conum" data-value="1"></i><b>(1)</b>
        setAmount(amount);  <i class="conum" data-value="3"></i><b>(3)</b>
        addToTotal(amount); <i class="conum" data-value="2"></i><b>(2)</b>
    }
    ...
}
--
&lt;1&gt; The `modifyAmount()` method calls ...
&lt;2&gt; ... the `addToTotal()` (not shown) to maintain some running total.

We don't want this `addToCall()` method to be called when pulling the object back from the object store, so we put it into the modify, not the setter.

You may optionally also specify a `clearXxx()` which works the same way as modify `modify Xxx()` but is called when the property is cleared by the user (i.e. the current value replaced by nothing). The syntax is:

[source,java]
--
public void clearPropertyName() { ... }
--

To extend the above example:

[source,java]
--
public class Order() {
    public Integer getAmount() { ... }
    public void setAmount(Integer amount) { ... }
    public void modifyAmount(Integer amount) { ... }
    public void clearAmount() {
        removeFromTotal(this.amount);
        setAmount(null);
    }
    ...
}
--



== When a collection is modified

A collection may have a corresponding `addToXxx()` and/or
`removeFromXxx()` method. If present, and direct manipulation of the
contents of the connection has not been disabled (see ?), then they will
be called (instead of adding/removing an object directly to the
collection returned by the accessor).

The reason for this behaviour is to allow other behaviour to be
triggered when the contents of the collection is altered. That is, it is
directly equivalent to the supporting `modifyXxx()` and `clearXxx()`
methods for properties (see ?).

The syntax is:

[source,java]
--
public void addTo&lt;CollectionName&gt;(EntityType param) { ... }
--

and

[source,java]
--
public void removeFromCollectionName(EntityType param) { ... }
--

where `EntityType` is the same type as the generic collection type.

For example:

[source,java]
--
public class Employee { ... }

public class Department {

    private int numMaleEmployees;                           <i class="conum" data-value="1"></i><b>(1)</b>
    private int numFemaleEmployees;                         <i class="conum" data-value="2"></i><b>(2)</b>

    private Set&lt;Employee&gt; employees = new TreeSet&lt;Employee&gt;();
    public Set&lt;Employee&gt; getEmployees() {
        return employees;
    }
    private void setEmployees(Set&lt;Employee&gt; employees) {
        this.employees = employees;
    }
    public void addToEmployees(Employee employee) {         <i class="conum" data-value="3"></i><b>(3)</b>
        numMaleEmployees += countOneMale(employee);
        numFemaleEmployees += countOneFemale(employee);
        employees.add(employee);
    }
    public void removeFromEmployees(Employee employee) {    <i class="conum" data-value="4"></i><b>(4)</b>
        numMaleEmployees -= countOneMale(employee);
        numFemaleEmployees -= countOneFemale(employee);
        employees.remove(employee);
    }
    private int countOneMale(Employee employee) { return employee.isMale()?1:0; }
    private int countOneFemale(Employee employee) { return employee.isFemale()?1:0; }

    ...
}
--
&lt;1&gt; maintain a count of the number of male ...
&lt;2&gt; ... and female employees (getters and setters omitted)
&lt;3&gt; the xref:../rgcms/rgcms.adoc#_rgcms_methods_prefixes_addTo[`addTo...()`] method increments the derived properties
&lt;4&gt; the xref:../rgcms/rgcms.adoc#_rgcms_methods_prefixes_removeFrom[`removeFrom...()`] method similarly decrements the derived properties



:leveloffset: 1
:leveloffset: +1

[[_ugbtb_hints-and-tips_how-to-implement-a-spellchecker]]
= How to implement a spellchecker?
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.



From this link:http://isis.markmail.org/thread/dduarjscrbnodfsi[thread] on the Apache Isis users mailing list:

* _What is the easiest way to add a spell checker to the text written in a field in
   a domain object, for instance to check English syntax?_

One way to implement is to use the xref:../rgsvc/rgsvc.adoc#_rgsvc_core-domain-api_EventBusService[event bus]:

* Set up a xref:../rgcms/rgcms.adoc#_rgcms_classes_domainevent[domain event] xref:../rgcms/rgcms.adoc#_rgcms_classes_super_AbstractSubscriber[subscriber] that can veto the changes.

* if the change is made through an action, you can use xref:../rgant/rgant.adoc#_rgant-Action_domainEvent[`@Action#domainEvent()`].

if if the change is made through an edit, you can use xref:../rgant/rgant.adoc#_rgant-Property_domainEvent[`@Property#domainEvent()`].

You'll need some way to know which fields should be spell checked.  Two ways spring to mind:

* either look at the domain event's identifier

* or subclass the domain event (recommended anyway) and have those subclass events implement some sort of marker interface, eg a `SpellCheckEvent`.

And you'll (obviously) also need some sort of spell checker implementation to call.


:leveloffset: 1


// end::inclusions[]

:leveloffset: 1
:leveloffset: +1

[[_ugbtb_programming-model]]
= Customizing the Prog Model
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
:_basedir: ../../
:_imagesdir: images/


This chapter explains the main APIs to extend or alter the programming conventions that Apache Isis understands to
build up its metamodel.

:leveloffset: +1

[[_ugbtb_programming-model_custom-validator]]
= Custom validator
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
:_basedir: ../../
:_imagesdir: images/

Apache Isis' programming model includes a validator component that detects and prevents (by failing fast) a number of situations where the domain model is logically inconsistent.

For example, the validator will detect any orphaned supporting methods (eg `hideXxx()`) if the corresponding property or action has been renamed or deleted but the supporting method was not also updated.  Another example is that a class cannot have a title specified both using `title()` method and also using `@Title` annotation.

[NOTE]
====
The support for xref:../rgant/rgant.adoc#_rgant-aaa_deprecated[disallowing deprecated annotations] is also implemented using the metamodel validator.
====

You can also impose your own application-specific rules by installing your own metamodel validator.  To give just one example, you could impose naming standards such as ensuring that a domain-specific abbreviation such as "ISBN" is always consistently capitalized wherever it appears in a class member.

[TIP]
====
Isis' xref:../rgmvn/rgmvn.adoc#[Maven plugin] will also validate the domain object model during build time.
====


== API and Implementation

There are several ways to go about implementing a validator.

=== `MetaModelValidator`

Any custom validator must implement Apache Isis' internal `MetaModelValidator` interface, so the simplest option is just to implement `MetaModelValidator` directly:


[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>public interface MetaModelValidator implements SpecificationLoaderSpiAware { // &lt;1&gt; public void validate( ValidationFailures validationFailures); // &lt;2&gt; }</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>&lt;1&gt; the `SpecificationLoader` is the internal API providing access to the Apache Isis metamodel.
&lt;2&gt; add any metamodel violations to the `ValidationFailures` parameter (the link:http://c2.com/cgi/wiki?CollectingParameter[collecting parameter] pattern)


=== `Visitor`

More often than not, you'll want to visit every element in the metamodel, and so for this you can instead subclass from `MetaModelValidatorVisiting.Visitor`:

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>public final class MetaModelValidatorVisiting …​ { public static interface Visitor { public boolean visit( // &lt;1&gt; ObjectSpecification objectSpec, // &lt;2&gt; ValidationFailures validationFailures); // &lt;3&gt; } …​ }</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>&lt;1&gt; return `true` continue visiting specs.
&lt;2&gt; `ObjectSpecification` is the internal API representing a class
&lt;3&gt; add any metamodel violations to the `ValidationFailures` parameter


You can then create your custom validator by subclassing `MetaModelValidatorComposite` and adding the visiting validator:

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>public class MyMetaModelValidator extends MetaModelValidatorComposite { public MyMetaModelValidator() { add(new MetaModelValidatorVisiting(new MyVisitor())); } }</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>If you have more than one rule then each can live in its own visitor.

=== `SummarizingVisitor`

As a slight refinement, you can also subclass from `MetaModelValidatorVisiting.SummarizingVisitor`:

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>public final class MetaModelValidatorVisiting …​ { public static interface SummarizingVisitor extends Visitor { public void summarize(ValidationFailures validationFailures); } …​ }</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>A `SummarizingVisitor` will be called once after every element in the metamodel has been visited.  This is great for performing checks on the metamodel as a whole.  For example, Apache Isis uses this to check that there is at least one `@Persistable` domain entity defined.




== Configuration

Once you have implemented your validator, you must register it with the framework by defining the appropriate configuration property:

[source,ini]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>isis.reflector.validator=com.mycompany.myapp.MyMetaModelValidator</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>:leveloffset: 1
:leveloffset: +1

[[_ugbtb_programming-model_finetuning]]
= Finetuning
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
:_basedir: ../../
:_imagesdir: images/


The core metamodel defines APIs and implementations for building the Apache Isis metamodel: a description of the set of entities, domain services and values that make up the domain model.


The description of each domain class consists of a number of elements:

https://github.com/apache/isis/blob/master/core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/ObjectSpecification.java[ObjectSpecification]::
Analogous to `java.lang.Class`; holds information about the class itself and holds collections of each of the three types of class' members (below);

https://github.com/apache/isis/blob/master/core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/feature/OneToOneAssociation.java[OneToOneAssociation]::
Represents a class member that is a single-valued property of the class. The property's type is either a reference to another entity, or is a value type.

https://github.com/apache/isis/blob/master/core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/feature/OneToManyAssociation.java[OneToManyAssociation]::
Represents a class member that is a collection of references to other entities. Note that Apache Isis does not currently support collections of values.

https://github.com/apache/isis/blob/master/core/metamodel/src/main/java/org/apache/isis/core/metamodel/spec/feature/ObjectAction.java[ObjectAction]::
Represents a class member that is an operation that can be performed on the action. Returns either a single value, a collection of entities, or is `void`.


The metamodel is built up through the https://github.com/apache/isis/blob/master/core/metamodel/src/main/java/org/apache/isis/core/metamodel/progmodel/ProgrammingModel.java[ProgrammingModel], which defines an API for registering a set of https://github.com/apache/isis/blob/master/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/FacetFactory.java[FacetFactory]s.  Two special `FacetFactory` implementations - https://github.com/apache/isis/blob/master/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/properties/accessor/PropertyAccessorFacetViaAccessorFactory.java[PropertyAccessorFacetFactory] and https://github.com/apache/isis/blob/master/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facets/collections/accessor/CollectionAccessorFacetViaAccessorFactory.java[CollectionAccessorFacetFactory] - are used to identify the class members.
Pretty much all the other ``FacetFactory``s are responsible for installing https://github.com/apache/isis/blob/master/core/metamodel/src/main/java/org/apache/isis/core/metamodel/facetapi/Facet.java[Facet]s onto the metamodel elements.

There are many many such ``Facet``s, and are used to do such things get values from properties or collections, modify properties or collections, invoke action, hide or disable class members, provide UI hints for class members, and so on. In short, the ``FacetFactory``s registered defines the Apache Isis programming conventions.



== Modifying the Prog. Model

The default implementation of `ProgrammingModel` is https://github.com/apache/isis/blob/master/core/metamodel/src/main/java/org/apache/isis/progmodels/dflt/ProgrammingModelFacetsJava5.java[ProgrammingModelFacetsJava5], which registers a large number of ``FacetFactory``s.

By editing `isis.properties` you can modify the programming conventions either by (a) using the default programming model, but tweaking it to include new `FacetFactory`s or exclude existing, or (b) by specifying a completely different programming model implementation.

Let's see how this is done.

=== Including or excluding facets

Suppose that you wanted to completely remove support for some existing facet, eg to support the "persisting()" and "persisted()" callback methods.
This would be done using:

[source,ini]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>isis.reflector.facets.exclude=\ org.apache.isis.core.metamodel.facets.object.callbacks.PersistCallbackFacetFactory</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>Or, suppose you wanted to use add some custom facet factory of your own, use:

[source,ini]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>isis.reflector.facets.include=com.mycompany.isis.facets.MyCoolFacetFactory</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>To include/exclude more than one `FacetFactory`, specify as a comma-separated list.

[TIP]
====
This http://isis.markmail.org/thread/472c3mrvcgnripst[thread] from the users mailing list (in Apr 2014) shows a typical customization (to enable per-instance security) (though note that xref:../ugbtb/ugbtb.adoc#_ugbtb_hints-and-tips_multi-tenancy[Multi-Tenancy] is now a better solution to that particular use-case.
====







:leveloffset: 1


:leveloffset: 1
:leveloffset: +1

[[_ugbtb_deployment]]
= Deployment
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
:_basedir: ../../
:_imagesdir: images/

This chapter provides guidance on some common deployment scenarios.

:leveloffset: +1

[[_ugbtb_deployment_cmd-line]]
= Command Line (`WebServer`)
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
:_basedir: ../../
:_imagesdir: images/



As well as deploying an Apache Isis application into a servlet container, it is also possible to invoke from the command line using the `org.apache.isis.WebServer` utility class.  This is especially useful while developing and testing, but may also suit some deployment scenarios (eg running as a standalone EXE within a Docker container, for example).  Internally the `WebServer` spins up a Jetty servlet container.

The class also supports a number of command line arguments:

.Command line args for `org.apache.isis.Webserver`
[cols="1a,2a,2a,4a", options="header"]
|===
| Flag
| Long format
| Values +
(default)
| Description

|`-t`
|`--type`
|`server_prototype`, `server` +
(`server`)
|Deployment type


|`-m`
|`--manifest`
|FQCN
|Fully qualified class name of the xref:../rgcms/rgcms.adoc#_rgcms_classes_super_AppManifest[`AppManifest`] to use to bootstrap the system. +

This flag sets/overrides the `isis.appManifest` configuration property to the specified class name.


|`-f`
|`--fixture`
|FQCN
|Fully qualified class name of the fixture (extending xref:../rgcms/rgcms.adoc#_rgcms_classes_super_FixtureScript[`FixtureScript`]) to be run to setup data. +

This flag sets/overrides the `isis.fixtures` configuration property to the specified class name, and also sets the `isis.persistor.datanucleus.install-fixtures` configuration property to `true` to instruct the JDO/DataNucleus objectstore to actually load in the fixtures. +

It is also possible to specify the fixture class name using either the `$IsisFixture` or `$IsisFixtures` environment variable (case insensitive).

|`-p`
|`--port`
|(8080)
|The port number to listen on. +

This flag sets/overrides the `isis.embedded-web-server.port` configuration property.



|`-c`
|`--config`
|filename
|configuration file containing additional configuration properties



|`-D`
|
|xxx=yyy
|Specify additional arbitrary configuration properties.  This can be specified multiple times. +

Further discussion below.

|`-v`
|`--version`
|
|Prints the version, then quits



|`-h`
|`--help`
|
|Prints a usage message, then quits


|===


Note that the `-D` argument is *not* a system property, it is parsed by `WebServer` itself.  That said, it is _also_ possible to specify system properties, and these will also be processed in the exact same way. +

Said another way, properties can be specified either as application arguments:

[source,ini]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>java org.apache.isis.WebServer -Dxxx=yyy -Daaa=bbb</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>or as system properties:

[source,ini]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>java -Dxxx=yyy -Daaa=bbb org.apache.isis.WebServer</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>[TIP]
.The `Dummy` class
====
The framework also provides the `org.apache.isis.Dummy` class, which consists of a single empty `main(String[])` method.  It was introduced as a convenience for developers using Eclipse in combination with the DataNucleus plugin; if used as a launch target then it allow the entities to be enhanced withouth the running an app.
====




:leveloffset: 1
:leveloffset: +1

    [[_ugbtb_deployment_externalized-configuration]]
= Externalized Configuration
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
:_basedir: ../../
:_imagesdir: images/



As described xref:../rgcfg/rgcfg.adoc#_rgcfg_configuration-files[here], by default Apache Isis itself bootstraps from the
`isis.properties` configuration file.
It will also read configuration from the (optional) component/implementation-specific configuration files (such as `persistor_datanucleus.properties` or `viewer_wicket.properties`), and also (optional) component-specific configuration files (such as `persistor.properties` or `viewer.properties`).

It's generally not good practice to have the same configuration property in more than one file, but if that does occur, then the subsequent configuration property will be ignored.

[TIP]
====
In addition the framework will also load the `overrides.properties` file.
This is intended to support deployment through Docker, as discussed xref:../ugbtb/ugbtb.adoc#_ugbtb_deployment_docker[next].
====

All of these files are read from the `WEB-INF` directory.
Having this configuration "baked into" the application is okay in a development environment, but when the app needs to be deployed to a test or production environment, this configuration should be read from an external location.

There are in fact several frameworks involved here, all of which need to be pointed to this external location:

* Apache Isis itself, which (as already discussed) reads `isis.properties` and optional component-specific config files.

* link:http://shiro.apache.org[Apache Shiro],  which reads the `shiro.ini` file (and may read other files referenced from that file)

* http://logging.apache.org/log4j/1.2[Apache log4j 1.2], for logging, which reads `logging.properties` file

* although not used by Apache Isis, there's a good chance you may be using the Spring framework (eg if using http://activemq.apache.org[Apache Active MQ] or http://camel.apache.org[Apache Camel].

Each of these frameworks has its own way of externalizing its configuration.


[TIP]
====
Subsequent sections explain how to externalize configuration for xref:ugbtb.adoc#_ugbtb_deployment_tomcat[Tomcat] and for xref:ugbtb.adoc#_ugbtb_deployment_docker[Docker].
====



[[__ugbtb_deployment_externalized-configuration_Isis]]
== Apache Isis' Config

To tell Apache Isis to load configuration from an external directory, specify the `isis.config.dir` context parameter.


If the external configuration directory is fixed for all environments (systest, UAT, prod etc), then you can specify within the `web.xml` itself:

TODO: v2: this has almost certainly changed, because the configuration is picked up earlier; this probably no longer works.

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;context-param&gt; &lt;param-name&gt;isis.config.dir&lt;/param-name&gt; &lt;param-value&gt;location of external config directory&lt;/param-value&gt; &lt;/context-param&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>If however the configuration directory varies by environment, then the context parameter will be specified to each installation of your servlet container.
Most (if not all) servlet containers will provide a means to define context parameters through proprietary config files.



[NOTE]
====
Note that running the app using Apache Isis' `org.apache.isis.WebServer` bootstrapper does not use externalized Apache Isis configuration.
====






[[__ugbtb_deployment_externalized-configuration_Shiro]]
== Shiro Config

If using Apache Isis' xref:../ugsec/ugsec.adoc#_ugsec_configuring-isis-to-use-shiro[Shiro integration] for authentication and/or authorization, note that it reads from the `shiro.ini` configuration file.
By default this also resides in `WEB-INF`.

Similar to Apache Isis, Shiro lets this configuration directory be altered, by specifying the `shiroConfigLocations` context parameter.

You can therefore override the default location using the same technique as described above for Apache Isis' `isis.config.dir` context parameter.
For example:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;Parameter name="shiroConfigLocations" value="file:/usr/local/myapp/conf/shiro.ini" override="false" /&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>[TIP]
====
Note that Shiro is more flexible than Apache Isis; it will read its configuration from any URL, not just a directory on the local filesystem.
====




[[__ugbtb_deployment_externalized-configuration_Log4j]]
== Log4j Config

By default Apache Isis configures log4j to read the `logging.properties` file in the `WEB-INF` directory.
This can be overridden by setting the `log4j.properties` system property to the URL of the log4j properties file.

=== Tomcat

For example, if deploying to Tomcat7 or Tomcat8, this amounts to adding the following to the `CATALINA_OPTS` flags:

[source,bash]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>export CATALINA_OPTS="-Dlog4j.configuration=/usr/local/tomcat/myapp/conf/logging.properties"</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>[TIP]
====
`CATALINA_OPTS` was called `TOMCAT_OPTS` in earlier versions of Tomcat.
====

Further details an be found in the link:https://logging.apache.org/log4j/1.2/manual.html#Example_Configurations[log4j documentation].




== Spring Config

Although Apache Isis does not use Spring, it's possible that your app may use other components that do use Spring.
For example, the (non-ASF) link:http://platform.incode.org[Incode Platform^]'s publishmq module uses ActiveMQ and Camel to support publishing; both of these leverage Spring.

There are several ways to externalized Spring config, but the mechanism described here is similar in nature to those that we use for externalizing Apache Isis' and Shiro's configuration.
In your `web.xml`, you will probably load the Spring application context using code such as:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;listener&gt; &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt; &lt;/listener&gt; &lt;context-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt; classpath:my-application-context-config.xml &lt;/param-value&gt; &lt;/context-param&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>Add a new application context `propertyPlaceholderConfigurer-config.xml` defining a `PropertyPlaceholderConfigurer` bean.

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.springframework.org/schema/beans <a href="http://www.springframework.org/schema/beans/spring-beans.xsd" class="bare">http://www.springframework.org/schema/beans/spring-beans.xsd</a> <a href="http://activemq.apache.org/schema/core" class="bare">http://activemq.apache.org/schema/core</a> <a href="http://activemq.apache.org/schema/core/activemq-core.xsd" &gt" class="bare">http://activemq.apache.org/schema/core/activemq-core.xsd"&gt;</a>; &lt;bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"&gt; &lt;property name="locations"&gt; &lt;list&gt; &lt;value&gt;${spring.config.file}&lt;/value&gt; &lt;/list&gt; &lt;/property&gt; &lt;/bean&gt; &lt;/beans&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>This reads the properties from a `spring.config.file`, defined as a context-param in the `web.xml`:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;context-param&gt; &lt;param-name&gt;spring.config.file&lt;/param-name&gt; &lt;param-value&gt;classpath:spring.properties&lt;/param-value&gt; &lt;/context-param&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>Then update the bootstrapping in `web.xml` to use this new application context, eg:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;context-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt; classpath:my-application-context-config.xml, classpath:propertyPlaceholderConfigurer-config.xml &lt;/param-value&gt; &lt;/context-param&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>To use some other externalized configuration, override the `spring.config.file` property, eg using Tomcat's config file:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;Parameter name="spring.config.dir" value="file:/usr/local/myapp/conf/spring.properties" override="false" /&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>=== An alternative approach

As mentioned, there are several other ways to externalize Spring's config; one approach is to use Spring's profile support.

For example, in the application context you could have:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;beans profile="default"&gt; &lt;bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"&gt; &lt;property name="locations"&gt; &lt;list&gt; &lt;value&gt;classpath:dev.properties&lt;/value&gt; &lt;/list&gt; &lt;/property&gt; &lt;/bean&gt; &lt;/beans&gt; &lt;beans profile="externalized"&gt; &lt;bean id="propertyPlaceHolder" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"&gt; &lt;property name="locations"&gt; &lt;list&gt; &lt;value&gt;classpath:prod.properties&lt;/value&gt; &lt;/list&gt; &lt;/property&gt; &lt;/bean&gt; &lt;/beans&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>The idea being that specifying the "prod" profile rather than the "default" profile would cause a different set of configuration properties to be read.

The active profile can be overridden with a system property, eg:

[source,bash]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>-Dspring.active.profiles=prod</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>take a look at link:http://stackoverflow.com/a/10041835/56880[this SO answer] on using Spring profiles.





== JVM Args

The xref:../rgsvc/rgsvc.adoc#_rgsvc_application-layer-api_WrapperFactory[`WrapperFactory`] uses link:http://www.javassist.org[Javassist] to create on-the-fly classes acting as a proxy.
The cost of these proxies can be mitigated using:

[source,ini]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>-XX:+CMSClassUnloadingEnabled -XX:+UseConcMarkSweepGC</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>== Using a JNDI Datasource

See the guidance in the xref:../ugodn/ugodn.adoc#_ugodn_configuring_using-jndi-data-source[configuring datanucleus] section.

:leveloffset: 1
:leveloffset: +1

[[_ugbtb_deployment_tomcat]]
= Deploying to Tomcat
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
:_basedir: ../../
:_imagesdir: images/


Some pointers on how to xref:ugbtb.adoc#_ugbtb_deployment_externalized-configuration[externalize configuration] when deploying to Tomcat.
Other servlet containers have similar mechanisms.


== Tomcat 8.0

If deploying Tomcat 8.0, create a file called `$TOMCAT_HOME/conf/Catalina/localhost/todoapp.xml`, where `todoapp.xml` corresponds to the name of the webapp being deployed, eg `todoapp.war`.

The contents of this file would be something like:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;Context&gt;</p> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>&lt;WatchedResource&gt;WEB-INF/web.xml&lt;/WatchedResource&gt;
&lt;Manager pathname="" /&gt;</pre> 
           </div> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>&lt;Parameter name="shiroConfigLocations"
           value="file:/var/todoapp/dev/shiro.ini"
           override="false" /&gt;</pre> 
           </div> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>&lt;Parameter name="isis.config.dir"
           value="/var/todoapp/dev/"
           override="false" /&gt;</pre> 
           </div> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>&lt;Parameter name="spring.config.file"
           value="file:/var/todoapp/dev/spring.properties"
           override="false" /&gt;</pre> 
           </div> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>&lt;Parameter name="wicket.configuration"
           value="development"
           override="false" /&gt;</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;/Context&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>[IMPORTANT]
====
Note that the `override` key should be set to "false", not "true".
It indicates whether the application's own `web.xml` can override the setting.
In most cases, you probably want to disallow that.
====

Thus, when `todoapp.war` is deployed to `$CATALINA_HOME/webapp`, then this configuration will be used.

For more detail, see the Tomcat 8.0 documentation on link:http://tomcat.apache.org/tomcat-8.0-doc/config/context.html#Defining_a_context[defining a context] and on link:http://tomcat.apache.org/tomcat-8.0-doc/config/context.html#Context_Parameters[context parameters].

== Tomcat 7.0

If using Tomcat 7.0, the process is similar to that of Tomcat 8.0, however the override file resides in `$TOMCAT_HOME/conf`, rather than `$TOMCAT_HOME/conf/Catalina/localhost`.

For more detail, see the Tomcat 7.0 documentation on link:http://tomcat.apache.org/tomcat-7.0-doc/config/context.html#Defining_a_context[defining a context] and on link:http://tomcat.apache.org/tomcat-7.0-doc/config/context.html#Context_Parameters[context parameters].


:leveloffset: 1
:leveloffset: +1

[[_ugbtb_deployment_docker]]
= Docker
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
:_basedir: ../../
:_imagesdir: images/


When running the application within a Docker container, the problem that must be solved is to override the
configuration properties baked into the war file, eg to point to the app to a different JDBC URL.

There are several options.

[WARNING]
====
All the options here rely on starting the Docker container with a set of arguments, some of which would very likely
be passwords for database connections etc.  As such these techniques are only suitable where the security of the
Docker host can be assured.
====


== Using an `overrides.properties`

In addition to loading the regular configuration properties from `WEB-INF` directory (described
xref:../rgcfg/rgcfg.adoc#_rgcfg_configuration-files[here]), Apache Isis will also load the `overrides.properties` file.

This file is treated slightly differently than the other configuration files; it is loaded last, and any configuration
properties defined in it will _override_ any configuration properties already read from other files (this includes
any properties specified via the command line).

While the regular configuration files are "baked into" the application WAR file, the `overrides.properties` file is
created dynamically as part of the Docker `ENTRYPOINT` script, eg as documented in the
link:https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/[Dockerfile best practices].

Thus, Docker can be supported as follows:

* use `mvn` (as currently) to create a WAR file; set up with the `pom.xml` with the JDBC drivers of all DB servers that
  you might want to connect to (hsqldb, sql server, postgresql etc)

* in the `Dockerfile`, specify a base image containing Tomcat 8 + Java 8 (say)

* also in the `Dockerfile`, arrange it such that the WAR file is "exploded" (there is no need to copy over the WAR file itself)

* write a script that:
** explodes the WAR file, copying it into the Tomcat's `webapp` directory.  There is no need to copy
over the WAR file itself.
** creates the `overrides.properties` file from any input arguments, placing it into the `WEB-INF` directory
** sets all files to read-only

* use `ENTRYPOINT` (and probably also `CMD`) to invoke above script.



== Using system properties

The servlet context initializer will search for any system properties called `isis.xxx`
 and if present will use them as overrides.

Thus, an alternative option for a Docker image is to bootstrap the servlet container (Tomcat, Jetty) with appropriate
system properties set up.  For example, with Tomcat this can be done by writing into the `conf/catalina.properties` file
(see for example link:http://stackoverflow.com/a/16566920[this stackoverflow] post).

The Docker's `ENTRYPOINT` therefore just needs to parse the Docker container's own command line arguments and use to
create this file.


== Using `$ISIS_OPTS`

The servlet context initializer will search for an environment variable called `$ISIS_OPTS`
 and if present will parse the content as a set of key/value pairs.  Each key/value pair is separated by "||".

For example:

[source,bash]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>export ISIS_OPTS="isis.appManifest=domainapp.app.DomainAppAppManifestWithFixtures||isis.objects.editing=false"</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>can be used to run with a different app manifest, and also to disable editing of properties.

To use a different separator, set the (optional) `$ISIS_OPTS_SEPARATOR` variable.

[source,bash]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>export ISIS_OPTS_SEPARATOR=";" export ISIS_OPTS="isis.appManifest=domainapp.app.DomainAppAppManifestWithFixtures;isis.objects.editing=false"</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>The Docker's `ENTRYPOINT` therefore just needs to parse the Docker container's own command line arguments and use to
set this environment variable.

:leveloffset: 1
:leveloffset: +1

[[_ugbtb_deployment_gae]]
= Deploying to Google App Engine
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
:_basedir: ../../
:_imagesdir: images/

The link:https://cloud.google.com/appengine/docs[Google App Engine] (GAE) provides a JDO API, meaning that you can deploy Apache Isis onto GAE using the JDO objectstore.

However, GAE is not an RDBMS, and so there are some limitations that it imposes. This page gathers together various hints, tips and workarounds.




== Primary Keys and Owned/Unowned Relationships

All entities must have a `@PrimaryKey`. Within GAE, the type of this key matters.

For an entity to be an aggregate root, (ie a root of an GAE entity group), its key must be a `Long`, eg:

Any collection that holds this entity type (eg `ToDoItem#dependencies` holding a collection of ``ToDoItem``s) should then be annotated with `@Unowned` (a GAE annotation).

If on the other hand you want the object to be owned (through a 1:m relationship somewhere) by some other root, then use a String:

Note: if you store a relationship with a String key it means that the parent object _owns_ the child, any attempt to change the relationship raise and exception.





== Custom Types

Currently Apache Isis' `Blob` and `Clob` types and the JODA types (`LocalDate` et al) are _not_ supported in GAE.

Instead, GAE defines a link:https://cloud.google.com/appengine/docs/java/datastore/entities#Properties_and_Value_Types[fixed set of value types], including `BlobKey`. Members of the Apache Isis community have this working, though I haven't seen the code.

The above notwithstanding, Andy Jefferson at DataNucleus tells us:

pass:[&lt;div class="extended-quote-first"&gt;&lt;p&gt;]GAE JDO/JPA does support _some_ type conversion, because looking at http://code.google.com/p/datanucleus-appengine/source/browse/trunk/src/com/google/appengine/datanucleus/StoreFieldManager.java#349[StoreFieldManager.java] for any field that is Object-based and not a relation nor Serialized it will call http://code.google.com/p/datanucleus-appengine/source/browse/trunk/src/com/google/appengine/datanucleus/TypeConversionUtils.java#736[TypeConverstionUtils.java] and that looks for a `TypeConverter` (specify `@Extension` with key of "type-converter-name" against a field and value as the `TypeConverter` class) and it should convert it. Similarly when getting the value from the datastore.
pass:[&lt;/p&gt;&lt;/div&gt;]

On further investigation, it seems that the GAE implementation performs a type check on a `SUPPORTED_TYPES` Java set, in `com.google.appengine.api.datastore.DataTypeUtils`:

[source,java]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>if (!supportedTypes.contains(value.getClass())) { throw new IllegalArgumentException(prefix + value.getClass().getName() + " is not a supported property type."); }</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>We still need to try out Andy's recipe, above.

:leveloffset: 1
:leveloffset: +1

[[_ugbtb_deployment_neo4j]]
= Neo4J
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
:_basedir: ../../
:_imagesdir: images/


Apache Isis has experimental support for Neo4J, courtesy of DataNucleus' http://www.datanucleus.org/products/datanucleus/datastores/neo4j.html[Neo4J Datastore] implementation.


[TIP]
====
In addition, the http://github.com/isisaddons/isis-app-neoapp[Isis addons' neoapp] (non-ASF) is configured to run with an embedded Neo4J server running alongside the Apache Isis webapp.
====

The steps below describe the configuration steps required to update an existing app.


== ConnectionURL

In `persistor.properties`, update the JDO `ConnectionURL` property, eg:

[source,ini]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>isis.persistor.datanucleus.impl.javax.jdo.option.ConnectionURL=neo4j:neo4j_DB</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>The other connection properties (`ConnectionDriverName`, `ConnectionUserName` and `ConnectionPassword`) should be commented out.

== Update pom.xml

Add the following dependency to the `webapp` project's `pom.xml`:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;dependencies&gt; …​ &lt;dependency&gt; &lt;groupId&gt;org.datanucleus&lt;/groupId&gt; &lt;artifactId&gt;datanucleus-neo4j&lt;/artifactId&gt; &lt;version&gt;4.0.5&lt;/version&gt; &lt;!--1-→ &lt;/dependency&gt; …​ &lt;/dependencies&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>&lt;1&gt; for Isis v1.9.0, use the value shown.  for Isis v1.8.0, use 3.2.3.

In the xref:../ugfun/ugfun.adoc#_ugfun_getting-started_simpleapp-archetype[SimpleApp archetype] this is defined under the "neo4j" profile so can be activated using `-P neo4j`.


== Try it out!

If you want to quickly try out neo4j for yourself:

* run the xref:../ugfun/ugfun.adoc#_ugfun_getting-started_simpleapp-archetype[SimpleApp archetype] (v1.8.0)

* build the app:

* run the app:

If you visit the about page you should see the neo4j JAR files are linked in, and a `neo4j_DB` subdirectory within the `webapp` directory.

:leveloffset: 1
:leveloffset: +1

[[_ugbtb_deployment_jvm-flags]]
= JVM Flags
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
:_basedir: ../../
:_imagesdir: images/

NOTE: FIXME


The default JVM configuration will most likely not be appropriate for running Isis as a webapp.  The table below suggests some JVM args that you will probably want to modify:

.JVM args
[cols="1,1", options="header"]
|===

|Flag
|Description

|-server
|Run the JVM in server mode, meaning that the JVM should spend more time on the optimization of the fragments of codes that are most often used (hotspots). This leads to better performance at the price of a higher overhead at startup.

|-Xms128m
Minimum heap size


|-Xmx768m
|Maximum heap size


|-XX:PermSize=64m
|Minimum perm size (for class definitions)


|-XX:MaxPermSize=256m
|Maximum perm size (for class definitions)


|-XX:+DisableExplicitGC
|Causes any explicit calls to &lt;tt&gt;System.gc()&lt;/tt&gt; to be ignored.  +
+
See link:http://stackoverflow.com/questions/12847151/setting-xxdisableexplicitgc-in-production-what-could-go-wrong[this stackoverflow] question.

|===

There are also a whole bunch of GC-related flags, that you might want to explore; see this detailed link:http://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html[Hotspot JVM] documentation and also this link:http://blog.ragozin.info/2011/09/hotspot-jvm-garbage-collection-options.html[blog post].



## Configuring in Tomcat

If using Tomcat, update the `CATALINA_OPTS` variable.  (This variable is also updated if xref:../ugbtb/ugbtb.adoc#__ugbtb_deployment_externalized-configuration_Log4j[configuring logging to run externally]).


:leveloffset: 1






:leveloffset: 1
:leveloffset: +1

[[_ugbtb_web-xml]]
= `web.xml`
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
:_basedir: ../../
:_imagesdir: images/


TODO: v2: a lot of this has changed, because we now use `WebModule_Xxx` instead of `web.xml`, ie set this stuff up programmatically.


Apache Isis provides two different viewers, the xref:../ugvw/ugvw.adoc#[Wicket viewer] and the xref:../ugvro/ugvro.adoc#[RestfulObjects viewer].
You can deploy both of these concurrently, or deploy just the Wicket viewer, or deploy just the Restful Objects viewer.
The configuration in `web.xml` varies accordingly, both in terms of the servlet context listeners, filters and servlets.

If you are using Apache Isis' integration with Apache Shiro (for security) then this also needs configuring in `web.xml`.
See the xref:../ugsec/ugsec.adoc#_ugsec_configuring-isis-to-use-shiro[security chapter] for full details on this topic.

The servlets and filters are mapped to three main pipelines:

* `/wicket` - the Wicket viewer UI
* `/restful` - the Restful Objects resources (REST API)
* other paths, also static resources (such as `.png`, `.css`)

With the following key:

image::{_imagesdir}runtime/web-xml/key.png[width="800px",link="{_imagesdir}runtime/web-xml/key.png"]

the diagram below shows the components to be configured if deploying both the Wicket viewer and Restful Objects viewer:

image::{_imagesdir}runtime/web-xml/wicket-and-ro.png[width="800px",link="{_imagesdir}runtime/web-xml/wicket-and-ro.png"]

Here the Wicket viewer is responsible for the main bootstrapping of Apache Isis itself, in other words the shared (global) metadata; this is done by the `IsisWicketApplication` class (extending the `WicketApplication` Wicket API).
This class is also responsible for Apache Isis' own session and transaction management.

The Restful Objects viewer - being a JAX-RS application implemented using the RestEasy framework - requires the `RestEasyBootstrapper` servlet context listener.
It is this context listener that also sets up the `RestfulObjectsApplication`, which is then delegated to by the RestEasy `HttpServletDispatcher`.
This pipeline uses the `IsisSessionFilter` and `IsisTransactionFilterForRestfulObjects` to perform the session and transaction management before it hits the RestEasy servlet.

If only the Wicket viewer is deployed, then the diagram is more or less the same: the RestEasy servlet, context listener and supporting filters are simply removed:

image::{_imagesdir}runtime/web-xml/wicket-only.png[width="800px",link="{_imagesdir}runtime/web-xml/wicket-only.png"]

Finally, if only the Restful Objects viewer is deployed, then things change a little more subtly.  Here, the Wicket filter is no longer needed.
In its place, though the `IsisWebAppBootstrapper` context listener is required: this is responsible for seting up the shared (global) metadata.

image::{_imagesdir}runtime/web-xml/ro-only.png[width="800px",link="{_imagesdir}runtime/web-xml/ro-only.png"]

The following sections detail these various listeners, filters and servlets in more detail.



[[__ugbtb_web-xml_servlet-context-listeners]]
== Servlet Context Listeners

Servlet context listeners are used to perform initialization on application startup.
Both Shiro (if configured as the security mechanism) and RestEasy (for the Restful Objects viewer) require their own context listener.
In addition, if the Wicket viewer is _not_ being used, then additional Apache Isis-specific listener is required for bootstrapping of the Apache Isis framework itself.


=== `EnvironmentLoaderListener` (Shiro)

Bootstrap listener to startup and shutdown the web application's Shiro `WebEnvironment` at startup and shutdown respectively.

Its definition is:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;listener&gt; &lt;listener-class&gt;org.apache.shiro.web.env.EnvironmentLoaderListener&lt;/listener-class&gt; &lt;/listener&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>=== `IsisWebAppBootstrapper`

The `IsisWebAppBootstrapper` servlet context listener bootstraps the shared (global) metadata for the Apache Isis framework.
This listener is not required (indeed must not be configured) if the Wicket viewer is in use.

Its definition is:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;listener&gt; &lt;listener-class&gt;org.apache.isis.core.webapp.IsisWebAppBootstrapper&lt;/listener-class&gt; &lt;/listener&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>Its context parameters are:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;context-param&gt; &lt;param-name&gt;deploymentType&lt;/param-name&gt; &lt;param-value&gt;SERVER_PROTOTYPE&lt;/param-value&gt; &lt;/context-param&gt; &lt;context-param&gt; &lt;param-name&gt;isis.viewers&lt;/param-name&gt; &lt;param-value&gt;restfulobjects&lt;/param-value&gt; &lt;/context-param&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>=== `ResteasyBootstrap` (RestEasy)

The `ResteasyBootstrap` servlet context listener initializes the RestEasy runtime, specifying that classes (namely, those specified in Isis' `RestfulObjectsApplication`) to be exposed as REST resources.
It is required if the Restful Objects viewer is to be deployed.

Its definition is:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;listener&gt; &lt;listener-class&gt;org.jboss.resteasy.plugins.server.servlet.ResteasyBootstrap&lt;/listener-class&gt; &lt;/listener&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>There are two relevant context parameters:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;context-param&gt; &lt;param-name&gt;javax.ws.rs.Application&lt;/param-name&gt; &lt;!--1-→ &lt;param-value&gt;org.apache.isis.viewer.restfulobjects.server.RestfulObjectsApplication&lt;/param-value&gt; &lt;/context-param&gt; &lt;context-param&gt; &lt;param-name&gt;resteasy.servlet.mapping.prefix&lt;/param-name&gt; &lt;param-value&gt;/restful/&lt;/param-value&gt; &lt;!--2-→ &lt;/context-param&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>&lt;1&gt; used by RestEasy to determine the JAX-RS resources and other related configuration
&lt;2&gt; should correspond to the filter mapping of the `HttpServletDispatcher` servlet



[[__ugbtb_web-xml_servlets]]
== Servlets

Servlets process HTTP requests and return corresponding responses.


=== `HttpServletDispatcher` (RestEasy)

This servlet is provided by the RestEasy framework, and does the dispatching to the resources defined by Apache Isis' `RestfulObjectsApplication` (see above).

Its definition is:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;servlet&gt; &lt;servlet-name&gt;RestfulObjectsRestEasyDispatcher&lt;/servlet-name&gt; &lt;servlet-class&gt;org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher&lt;/servlet-class&gt; &lt;/servlet&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>Its mapping is:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;servlet-mapping&gt; &lt;servlet-name&gt;RestfulObjectsRestEasyDispatcher&lt;/servlet-name&gt; &lt;url-pattern&gt;/restful/*&lt;/url-pattern&gt; &lt;/servlet-mapping&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>=== `ResourceServlet`

The `ResourceServlet` loads and services static content either from the filesystem or from the classpath, each with an appropriate mime type.

Static content here means request paths ending in `.js`, `.css`, `.html`, `.png`, `.jpg`, `.jpeg` and `gif`.


Its definition is:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;servlet&gt; &lt;servlet-name&gt;Resource&lt;/servlet-name&gt; &lt;servlet-class&gt;org.apache.isis.core.webapp.content.ResourceServlet&lt;/servlet-class&gt; &lt;/servlet&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>Its mapping is:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;servlet-mapping&gt; &lt;servlet-name&gt;Resource&lt;/servlet-name&gt; &lt;url-pattern&gt;*.css&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;Resource&lt;/servlet-name&gt; &lt;url-pattern&gt;*.png&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;Resource&lt;/servlet-name&gt; &lt;url-pattern&gt;*.jpg&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;Resource&lt;/servlet-name&gt; &lt;url-pattern&gt;*.jpeg&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;Resource&lt;/servlet-name&gt; &lt;url-pattern&gt;*.gif&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;Resource&lt;/servlet-name&gt; &lt;url-pattern&gt;*.svg&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;Resource&lt;/servlet-name&gt; &lt;url-pattern&gt;*.js&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;Resource&lt;/servlet-name&gt; &lt;url-pattern&gt;*.html&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;Resource&lt;/servlet-name&gt; &lt;url-pattern&gt;*.swf&lt;/url-pattern&gt; &lt;/servlet-mapping&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>[[__ugbtb_web-xml_filters]]
== Filters

The order in which filters appear in `web.xml` matters: first to last they define a pipeline.
This is shown in the above diagrams, and the subsections also list the in the same order that they should appear in your `web.xml`.


=== `ShiroFilter` (Shiro)

Shiro filter that sets up a Shiro security manager for the request, obtained from the Shiro `WebEnvironment` set up by the Shiro `EnvironmentLoaderListener` (discussed above).

Its definition is:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;filter&gt; &lt;filter-name&gt;ShiroFilter&lt;/filter-name&gt; &lt;filter-class&gt;org.apache.shiro.web.servlet.ShiroFilter&lt;/filter-class&gt; &lt;/filter&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>Its mapping is:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;filter-mapping&gt; &lt;filter-name&gt;ShiroFilter&lt;/filter-name&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt; &lt;/filter-mapping&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>=== `IsisLogOnExceptionFilter`

The `IsisLogOnExceptionFilter` filter simply logs the URL of any request that causes an exception to be thrown, then re-propagates the exception.
The use case is simply to ensure that all exceptions are logged (against the `IsisLogOnExceptionFilter` slf4j appender).

Its definition is:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;filter&gt; &lt;filter-name&gt;IsisLogOnExceptionFilter&lt;/filter-name&gt; &lt;filter-class&gt;org.apache.isis.core.webapp.diagnostics.IsisLogOnExceptionFilter&lt;/filter-class&gt; &lt;/filter&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>Its mapping is:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;filter-mapping&gt; &lt;filter-name&gt;IsisLogOnExceptionFilter&lt;/filter-name&gt; &lt;url-pattern&gt;/wicket/<strong>&lt;/url-pattern&gt; &lt;/filter-mapping&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;IsisLogOnExceptionFilter&lt;/filter-name&gt; &lt;url-pattern&gt;/restful/</strong>&lt;/url-pattern&gt; &lt;/filter-mapping&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>=== `ResourceCachingFilter`

The `ResourceCachingFilter` adds HTTP cache headers to specified resources, based on their pattern.

Its definition is:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;filter&gt; &lt;filter-name&gt;ResourceCachingFilter&lt;/filter-name&gt; &lt;filter-class&gt;org.apache.isis.core.webapp.content.ResourceCachingFilter&lt;/filter-class&gt; &lt;init-param&gt; &lt;param-name&gt;CacheTime&lt;/param-name&gt; &lt;!--1-→ &lt;param-value&gt;86400&lt;/param-value&gt; &lt;/init-param&gt; &lt;/filter&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>&lt;1&gt; cache time, in seconds

Its mapping is:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;filter-mapping&gt; &lt;filter-name&gt;ResourceCachingFilter&lt;/filter-name&gt; &lt;url-pattern&gt;*.css&lt;/url-pattern&gt; &lt;/filter-mapping&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;ResourceCachingFilter&lt;/filter-name&gt; &lt;url-pattern&gt;*.png&lt;/url-pattern&gt; &lt;/filter-mapping&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;ResourceCachingFilter&lt;/filter-name&gt; &lt;url-pattern&gt;*.jpg&lt;/url-pattern&gt; &lt;/filter-mapping&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;ResourceCachingFilter&lt;/filter-name&gt; &lt;url-pattern&gt;*.jpeg&lt;/url-pattern&gt; &lt;/filter-mapping&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;ResourceCachingFilter&lt;/filter-name&gt; &lt;url-pattern&gt;*.gif&lt;/url-pattern&gt; &lt;/filter-mapping&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;ResourceCachingFilter&lt;/filter-name&gt; &lt;url-pattern&gt;*.svg&lt;/url-pattern&gt; &lt;/filter-mapping&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;ResourceCachingFilter&lt;/filter-name&gt; &lt;url-pattern&gt;*.html&lt;/url-pattern&gt; &lt;/filter-mapping&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;ResourceCachingFilter&lt;/filter-name&gt; &lt;url-pattern&gt;*.js&lt;/url-pattern&gt; &lt;/filter-mapping&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;ResourceCachingFilter&lt;/filter-name&gt; &lt;url-pattern&gt;*.swf&lt;/url-pattern&gt; &lt;/filter-mapping&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>=== `WicketFilter`

The `WicketFilter` is responsible for initiating the handling of Wicket requests.

Its definition is:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;filter&gt; &lt;filter-name&gt;WicketFilter&lt;/filter-name&gt; &lt;filter-class&gt;org.apache.wicket.protocol.http.WicketFilter&lt;/filter-class&gt; &lt;init-param&gt; &lt;param-name&gt;applicationClassName&lt;/param-name&gt; &lt;param-value&gt;org.apache.isis.viewer.wicket.viewer.IsisWicketApplication&lt;/param-value&gt; &lt;/init-param&gt; &lt;/filter&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>This is generally boilerplate.
It is possible to specify a subclass of `IsisWicketApplication` (and in earlier versions of the framework this was generally required), but there now exist sufficient configuration properties that subclassing is generally not required.

Its mapping is:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;filter-mapping&gt; &lt;filter-name&gt;WicketFilter&lt;/filter-name&gt; &lt;url-pattern&gt;/wicket/*&lt;/url-pattern&gt; &lt;/filter-mapping&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>This filter reads one context parameter:
[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;context-param&gt; &lt;param-name&gt;configuration&lt;/param-name&gt; &lt;param-value&gt;deployment&lt;/param-value&gt; &lt;!--1-→ &lt;/context-param&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>&lt;1&gt; alternatively set to "development"; see xref:../rgcfg/rgcfg.adoc#_rgcfg_deployment-types[deployment types] for further discussion.


=== `IsisSessionFilter`

The `IsisSessionFilter` is responsible for the (persistence) session management; in effect a wrapper around DataNucleus' `PersistenceManager` object.
It is only required for the Restful Objects viewer.

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;filter&gt; &lt;filter-name&gt;IsisSessionFilterForRestfulObjects&lt;/filter-name&gt; &lt;filter-class&gt;org.apache.isis.core.webapp.IsisSessionFilter&lt;/filter-class&gt; &lt;init-param&gt; &lt;param-name&gt;authenticationSessionStrategy&lt;/param-name&gt; &lt;!--1-→ &lt;param-value&gt; org.apache.isis.viewer.restfulobjects.server.authentication.AuthenticationSessionStrategyBasicAuth &lt;/param-value&gt; &lt;/init-param&gt; &lt;init-param&gt; &lt;param-name&gt;whenNoSession&lt;/param-name&gt; &lt;!--2-→ &lt;param-value&gt;basicAuthChallenge&lt;/param-value&gt; &lt;/init-param&gt; &lt;init-param&gt; &lt;param-name&gt;passThru&lt;/param-name&gt; &lt;!--3-→ &lt;param-value&gt;/restful/swagger,/restful/health&lt;/param-value&gt; &lt;/init-param&gt; &lt;!-- &lt;init-param&gt; &lt;param-name&gt;restricted&lt;/param-name&gt; &lt;!--4-→ &lt;param-value&gt;…​&lt;/param-value&gt; &lt;/init-param&gt; &lt;init-param&gt; &lt;param-name&gt;redirectToOnException&lt;/param-name&gt; &lt;!--5-→ &lt;param-value&gt;…​&lt;/param-value&gt; &lt;/init-param&gt; -→ &lt;/filter&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>&lt;1&gt; pluggable strategy for determining what the authentication session (credentials) are of the request
&lt;2&gt; what the servlet should do if no existing session was found.
Usual values are either `unauthorized`, `basicAuthChallenge` or `auto`.
Discussed in more detail below.
&lt;3&gt; specify which URIs to ignore and simply pass through.
Originally introduced to allow the `SwaggerSpec` resource (which does not require a session) to be invoked.
&lt;4&gt; A comma separated list of paths that are allowed through even if not authenticated.
The servlets mapped to these paths are expected to be able to deal with there being no session.
Typically they will be logon pages, or for health checks (as per xref:../rgsvc/rgsvc.adoc#_rgsvc_application-layer-spi_HealthCheckService[`HealthCheckService`] SPI.
See below for further details.
&lt;5&gt; where to redirect to if an exception occurs.


The `whenNoSession` parameter determines what the behaviour should be if no existing session can be found.
There are a number of predetermined values available:

* `unauthorized` will generates a 401 response
* `basicAuthChallenge` will also generate a 401 response, and also issues a Basic Auth challenge using `WWW-Authenticate` response header
* `auto` combines the `unauthorized` and `basicAuthChallenge` strategies: it will generate a 401 response, but only issues a Basic Auth challenge if it detects that the request originates from a web browser (ie that the HTTP `Accept` header is set to `text/html`).
This means that custom Javascript apps can perform their authentication correctly, while the REST API can still be explored using the web browser (relying upon the web browser's in-built support for HTTP Basic Auth).
* `continue`, in which case the request is allowed to continue but the destination expected to know that there will be no open session
* `restricted`, which allows access to a restricted list of URLs, otherwise will redirect to the first of that list of URLs

If accessing the REST API through a web browser, then normally `basicAuthChallenge` is appropriate; the browser will automatically display a simple prompt.
If accessing the REST API through a custom Javascript app, then `unauthorized` is usually the one to use.

This filter should be mapped to the `servlet-name` for the RestEasy `HttpServletDispatcher`; for example:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;filter-mapping&gt; &lt;filter-name&gt;IsisSessionFilterForRestfulObjects&lt;/filter-name&gt; &lt;servlet-name&gt;RestfulObjectsRestEasyDispatcher&lt;/servlet-name&gt; &lt;/filter-mapping&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>=== `IsisTransactionFilterForRestfulObjects`

The `IsisTransactionFilterForRestfulObjects` filter simply ensures that a transaction is in progress for all calls routed to the xref:../ugvro/ugvro.adoc#[RestfulObjects viewer].

Its definition is:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;filter&gt; &lt;filter-name&gt;IsisTransactionFilterForRestfulObjects&lt;/filter-name&gt; &lt;filter-class&gt;org.apache.isis.viewer.restfulobjects.server.webapp.IsisTransactionFilterForRestfulObjects&lt;/filter-class&gt; &lt;/filter&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>This filter should be mapped to the `servlet-name` for the RestEasy `HttpServletDispatcher`; for example:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;filter-mapping&gt; &lt;filter-name&gt;IsisTransactionFilterForRestfulObjects&lt;/filter-name&gt; &lt;servlet-name&gt;RestfulObjectsRestEasyDispatcher&lt;/servlet-name&gt; &lt;/filter-mapping&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>[[__ugbtb_web-xml_context-parameters]]
== Configuration Files

However Apache Isis is bootstrapped (using the `IsisWicketApplication` or using `IsisWebAppBootstrapper`), it will read a number of configuration files, such as `isis.properties`.

By default these are read from `WEB-INF` directory.
This can be overridden using the `isis.config.dir` context parameter:

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;context-param&gt; &lt;param-name&gt;isis.config.dir&lt;/param-name&gt; &lt;param-value&gt;location of your config directory if fixed&lt;/param-value&gt; &lt;/context-param&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>Another context parameter, `isis.viewres` specifies which additional configuration files to search for (over and above the default ones of `isis.properties` et al):

[source,xml]</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>&lt;context-param&gt; &lt;param-name&gt;isis.viewers&lt;/param-name&gt; &lt;param-value&gt;wicket,restfulobjects&lt;/param-value&gt; &lt;/context-param&gt;</p> 
          </div> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre>For example, this will cause `viewer_wicket.properties` and `viewer_restfulobjects.properties` to also be loaded.


:leveloffset: 1</pre> 
           </div> 
          </div> 
         </div> 
        </div> 
       </div> 
      </div> 
     </div> 
    </div> 
    <div class="hidden-xs hidden-sm hidden-md col-lg-3"> 
     <nav id="toc" data-spy="affix" data-toggle="toc"></nav> 
    </div> 
   </div> 
  </div> 
  <footer class="footer"> 
   <div class="container"> 
    <div class="row"> 
     <p class="text-center small text-muted"> Copyright © 2010~2018 The Apache&nbsp;Software&nbsp;Foundation, licensed under the Apache&nbsp;License,&nbsp;v2.0. <br> Apache, the Apache feather logo, Apache&nbsp;Isis, and the Apache&nbsp;Isis project logo are all trademarks of The&nbsp;Apache&nbsp;Software&nbsp;Foundation. </p> 
    </div> 
   </div> 
  </footer> 
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script> 
  <script src="../../js/bootstrap/3.3.7/bootstrap.min.js"></script> 
  <script src="../../js/bootstrap-toc/0.4.1/bootstrap-toc.min.js"></script> 
  <script src="../../js/slick/1.5.0/slick.min.js"></script> 
  <script src="../../js/elasticlunr/elasticlunr.min.js"></script> 
  <script src="../../js/sticky-header/sticky-header.js"></script> 
  <script src="../../js/search-panel/search-panel.js"></script> 
  <script src="../../js/header-link/header-link.js"></script> 
  <script src="../../js/toc-scroll/toc-scroll.js"></script>  
 </body>
</html>
